<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="LLVM,Low Level Virtual Machine,C++,doxygen,API,documentation"/>
<meta name="description" content="C++ source code API documentation for LLVM."/>
<title>LLVM: ExecutionDepsFix.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">LLVM API Documentation</p>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ExecutionDepsFix_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ExecutionDepsFix.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ExecutionDepsFix_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- ExecutionDepsFix.cpp - Fix execution dependecy issues ----*- C++ -*-===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                     The LLVM Compiler Infrastructure</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is distributed under the University of Illinois Open Source</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License. See LICENSE.TXT for details.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// This file contains the execution dependency fix pass.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// Some X86 SSE instructions like mov, and, or, xor are available in different</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// variants for different operand types. These variant instructions are</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// equivalent, but on Nehalem and newer cpus there is extra latency</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// transferring data between integer and floating point domains.  ARM cores</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// have similar issues when they are configured with both VFP and NEON</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// pipelines.</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">// This pass changes the variant instructions to minimize domain crossings.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="ExecutionDepsFix_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   23</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;execution-fix&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CodeGen_2Passes_8h.html">llvm/CodeGen/Passes.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PostOrderIterator_8h.html">llvm/ADT/PostOrderIterator.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LiveRegUnits_8h.html">llvm/CodeGen/LiveRegUnits.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineFunctionPass_8h.html">llvm/CodeGen/MachineFunctionPass.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineRegisterInfo_8h.html">llvm/CodeGen/MachineRegisterInfo.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Allocator_8h.html">llvm/Support/Allocator.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetInstrInfo_8h.html">llvm/Target/TargetInstrInfo.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Target_2TargetMachine_8h.html">llvm/Target/TargetMachine.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">/// A DomainValue is a bit like LiveIntervals&#39; ValNo, but it also keeps track</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">/// of execution domains.</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">/// An open DomainValue represents a set of instructions that can still switch</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">/// execution domain. Multiple registers may refer to the same open</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">/// DomainValue - they will eventually be collapsed to the same execution</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">/// domain.</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">/// A collapsed DomainValue represents a single register that has been forced</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">/// into one of more execution domains. There is a separate collapsed</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">/// DomainValue for each register, but it may contain multiple execution</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">/// domains. A register value is initially created in a single execution</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">/// domain, but if we were forced to pay the penalty of a domain crossing, we</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">/// keep track of the fact that the register is now available in multiple</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">/// domains.</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"></span><span class="keyword">namespace </span>{</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">struct </span>DomainValue {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="comment">// Basic reference counting.</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keywordtype">unsigned</span> Refs;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">// Bitmask of available domains. For an open DomainValue, it is the still</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="comment">// possible domains for collapsing. For a collapsed DomainValue it is the</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="comment">// domains where the register is available for free.</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordtype">unsigned</span> AvailableDomains;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="comment">// Pointer to the next DomainValue in a chain.  When two DomainValues are</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="comment">// merged, Victim.Next is set to point to Victor, so old DomainValue</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="comment">// references can be updated by following the chain.</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  DomainValue *Next;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="comment">// Twiddleable instructions using or defining these registers.</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MachineInstr*, 8&gt;</a> Instrs;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="comment">// A collapsed DomainValue has no instructions to twiddle - it simply keeps</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="comment">// track of the domains where the registers are already available.</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordtype">bool</span> isCollapsed()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Instrs.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>(); }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="comment">// Is domain available?</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordtype">bool</span> hasDomain(<span class="keywordtype">unsigned</span> domain)<span class="keyword"> const </span>{</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">return</span> AvailableDomains &amp; (1u &lt;&lt; domain);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  }</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="comment">// Mark domain as available.</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordtype">void</span> addDomain(<span class="keywordtype">unsigned</span> domain) {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    AvailableDomains |= 1u &lt;&lt; domain;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  }</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">// Restrict to a single domain available.</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="keywordtype">void</span> setSingleDomain(<span class="keywordtype">unsigned</span> domain) {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    AvailableDomains = 1u &lt;&lt; domain;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="comment">// Return bitmask of domains that are available and in mask.</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordtype">unsigned</span> getCommonDomains(<span class="keywordtype">unsigned</span> mask)<span class="keyword"> const </span>{</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">return</span> AvailableDomains &amp; mask;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  }</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">// First domain available.</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keywordtype">unsigned</span> getFirstDomain()<span class="keyword"> const </span>{</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#abdaf1eaf6120421977095bd97eee892e">countTrailingZeros</a>(AvailableDomains);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  }</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  DomainValue() : Refs(0) { clear(); }</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">// Clear this DomainValue and point to next which has all its data.</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordtype">void</span> clear() {</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    AvailableDomains = 0;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    Next = 0;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    Instrs.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;};</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">/// LiveReg - Information about a live register.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"></span><span class="keyword">struct </span>LiveReg {<span class="comment"></span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">  /// Value currently in this register, or NULL when no value is being tracked.</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">  /// This counts as a DomainValue reference.</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"></span>  DomainValue *<a class="code" href="classllvm_1_1Value.html">Value</a>;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">  /// Instruction that defined this register, relative to the beginning of the</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">  /// current basic block.  When a LiveReg is used to represent a live-out</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">  /// register, this value is relative to the end of the basic block, so it</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">  /// will be a negative number.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment"></span>  <span class="keywordtype">int</span> <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;};</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;} <span class="comment">// anonynous namespace</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="keyword">class </span>ExeDepsFix : <span class="keyword">public</span> <a class="code" href="classllvm_1_1MachineFunctionPass.html">MachineFunctionPass</a> {</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a>;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <a class="code" href="classllvm_1_1SpecificBumpPtrAllocator.html">SpecificBumpPtrAllocator&lt;DomainValue&gt;</a> Allocator;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DomainValue*,16&gt;</a> Avail;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetRegisterClass.html">TargetRegisterClass</a> *<span class="keyword">const</span> RC;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> *MF;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetInstrInfo.html">TargetInstrInfo</a> *<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetRegisterInfo.html">TargetRegisterInfo</a> *TRI;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  std::vector&lt;int&gt; AliasMap;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> NumRegs;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  LiveReg *LiveRegs;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;MachineBasicBlock*, LiveReg*&gt;</a> LiveOutMap;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  LiveOutMap LiveOuts;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">  /// List of undefined register reads in this block in forward order.</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"></span>  std::vector&lt;std::pair&lt;MachineInstr*, unsigned&gt; &gt; UndefReads;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">  /// Storage for register unit liveness.</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1LiveRegUnits.html">LiveRegUnits</a> LiveUnits;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">  /// Current instruction number.</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">  /// The first instruction in each basic block is 0.</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment"></span>  <span class="keywordtype">int</span> CurInstr;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">  /// True when the current block has a predecessor that hasn&#39;t been visited</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">  /// yet.</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> SeenUnknownBackEdge;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  ExeDepsFix(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetRegisterClass.html">TargetRegisterClass</a> *rc)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    : <a class="code" href="classllvm_1_1MachineFunctionPass.html">MachineFunctionPass</a>(ID), RC(rc), NumRegs(RC-&gt;<a class="code" href="classllvm_1_1TargetRegisterClass.html#afca05003ab96838dace0b075e176f731">getNumRegs</a>()) {}</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const </span>{</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#af22b06a6a4f9df80454071685a0d6a02">setPreservesAll</a>();</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <a class="code" href="classllvm_1_1MachineFunctionPass.html#aa1eece37d175f86a6f4808c0c167f13b">MachineFunctionPass::getAnalysisUsage</a>(AU);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  }</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> runOnMachineFunction(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;MF);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *getPassName()<span class="keyword"> const </span>{</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Execution dependency fix&quot;</span>;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="comment">// Register mapping.</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keywordtype">int</span> regIndex(<span class="keywordtype">unsigned</span> <a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a>);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="comment">// DomainValue allocation.</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  DomainValue *alloc(<span class="keywordtype">int</span> domain = -1);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  DomainValue *retain(DomainValue *DV) {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">if</span> (DV) ++DV-&gt;Refs;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">return</span> DV;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keywordtype">void</span> release(DomainValue*);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  DomainValue *resolve(DomainValue*&amp;);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="comment">// LiveRegs manipulations.</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keywordtype">void</span> setLiveReg(<span class="keywordtype">int</span> rx, DomainValue *DV);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordtype">void</span> kill(<span class="keywordtype">int</span> rx);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="Target_2SystemZ_2README_8txt.html#a4c482947c920572e8a1aff348c7cb5cc">force</a>(<span class="keywordtype">int</span> rx, <span class="keywordtype">unsigned</span> domain);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordtype">void</span> collapse(DomainValue *dv, <span class="keywordtype">unsigned</span> domain);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordtype">bool</span> merge(DomainValue *<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>, DomainValue *<a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a>);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keywordtype">void</span> enterBasicBlock(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a>*);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keywordtype">void</span> leaveBasicBlock(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a>*);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordtype">void</span> visitInstr(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a>*);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordtype">void</span> processDefs(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a>*, <span class="keywordtype">bool</span> <a class="code" href="namespacellvm_1_1RegState.html#a079b254e749130fbe5d740f314ca92daa9ddde91ef09476d28a088fe57f8e2921">Kill</a>);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keywordtype">void</span> visitSoftInstr(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a>*, <span class="keywordtype">unsigned</span> mask);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordtype">void</span> visitHardInstr(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a>*, <span class="keywordtype">unsigned</span> domain);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keywordtype">bool</span> shouldBreakDependence(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a>*, <span class="keywordtype">unsigned</span> OpIdx, <span class="keywordtype">unsigned</span> Pref);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="keywordtype">void</span> processUndefReads(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a>*);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;};</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ExeDepsFix::ID</a> = 0;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">/// Translate TRI register number to an index into our smaller tables of</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">/// interesting registers. Return -1 for boring registers.</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment"></span><span class="keywordtype">int</span> ExeDepsFix::regIndex(<span class="keywordtype">unsigned</span> <a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a>) {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  assert(Reg &lt; AliasMap.size() &amp;&amp; <span class="stringliteral">&quot;Invalid register&quot;</span>);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordflow">return</span> AliasMap[<a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a>];</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;}</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;DomainValue *ExeDepsFix::alloc(<span class="keywordtype">int</span> domain) {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  DomainValue *dv = Avail.empty() ?</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                      <span class="keyword">new</span>(Allocator.Allocate()) DomainValue :</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                      Avail.pop_back_val();</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordflow">if</span> (domain &gt;= 0)</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    dv-&gt;addDomain(domain);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  assert(dv-&gt;Refs == 0 &amp;&amp; <span class="stringliteral">&quot;Reference count wasn&#39;t cleared&quot;</span>);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  assert(!dv-&gt;Next &amp;&amp; <span class="stringliteral">&quot;Chained DomainValue shouldn&#39;t have been recycled&quot;</span>);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="keywordflow">return</span> dv;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;}</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">/// release - Release a reference to DV.  When the last reference is released,</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">/// collapse if needed.</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ExeDepsFix::release(DomainValue *DV) {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordflow">while</span> (DV) {</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    assert(DV-&gt;Refs &amp;&amp; <span class="stringliteral">&quot;Bad DomainValue&quot;</span>);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">if</span> (--DV-&gt;Refs)</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// There are no more DV references. Collapse any contained instructions.</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">if</span> (DV-&gt;AvailableDomains &amp;&amp; !DV-&gt;isCollapsed())</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      collapse(DV, DV-&gt;getFirstDomain());</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    DomainValue *Next = DV-&gt;Next;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    DV-&gt;clear();</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    Avail.push_back(DV);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">// Also release the next DomainValue in the chain.</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    DV = Next;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">/// resolve - Follow the chain of dead DomainValues until a live DomainValue is</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">/// reached.  Update the referenced pointer when necessary.</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment"></span>DomainValue *ExeDepsFix::resolve(DomainValue *&amp;DVRef) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  DomainValue *DV = DVRef;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keywordflow">if</span> (!DV || !DV-&gt;Next)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">return</span> DV;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="comment">// DV has a chain. Find the end.</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keywordflow">do</span> DV = DV-&gt;Next;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordflow">while</span> (DV-&gt;Next);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="comment">// Update DVRef to point to DV.</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  retain(DV);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  release(DVRef);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  DVRef = DV;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordflow">return</span> DV;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;}</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">/// Set LiveRegs[rx] = dv, updating reference counts.</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ExeDepsFix::setLiveReg(<span class="keywordtype">int</span> rx, DomainValue *dv) {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  assert(<span class="keywordtype">unsigned</span>(rx) &lt; NumRegs &amp;&amp; <span class="stringliteral">&quot;Invalid index&quot;</span>);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  assert(LiveRegs &amp;&amp; <span class="stringliteral">&quot;Must enter basic block first.&quot;</span>);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordflow">if</span> (LiveRegs[rx].<a class="code" href="classllvm_1_1Value.html">Value</a> == dv)</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordflow">if</span> (LiveRegs[rx].<a class="code" href="classllvm_1_1Value.html">Value</a>)</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    release(LiveRegs[rx].Value);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  LiveRegs[rx].Value = retain(dv);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;}</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">// Kill register rx, recycle or collapse any DomainValue.</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="keywordtype">void</span> ExeDepsFix::kill(<span class="keywordtype">int</span> rx) {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  assert(<span class="keywordtype">unsigned</span>(rx) &lt; NumRegs &amp;&amp; <span class="stringliteral">&quot;Invalid index&quot;</span>);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  assert(LiveRegs &amp;&amp; <span class="stringliteral">&quot;Must enter basic block first.&quot;</span>);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keywordflow">if</span> (!LiveRegs[rx].<a class="code" href="classllvm_1_1Value.html">Value</a>)</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  release(LiveRegs[rx].Value);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  LiveRegs[rx].Value = 0;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;}</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">/// Force register rx into domain.</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="Target_2SystemZ_2README_8txt.html#a4c482947c920572e8a1aff348c7cb5cc">ExeDepsFix::force</a>(<span class="keywordtype">int</span> rx, <span class="keywordtype">unsigned</span> domain) {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  assert(<span class="keywordtype">unsigned</span>(rx) &lt; NumRegs &amp;&amp; <span class="stringliteral">&quot;Invalid index&quot;</span>);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  assert(LiveRegs &amp;&amp; <span class="stringliteral">&quot;Must enter basic block first.&quot;</span>);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keywordflow">if</span> (DomainValue *dv = LiveRegs[rx].<a class="code" href="classllvm_1_1Value.html">Value</a>) {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">if</span> (dv-&gt;isCollapsed())</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      dv-&gt;addDomain(domain);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dv-&gt;hasDomain(domain))</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      collapse(dv, domain);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="comment">// This is an incompatible open DomainValue. Collapse it to whatever and</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="comment">// force the new value into domain. This costs a domain crossing.</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      collapse(dv, dv-&gt;getFirstDomain());</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      assert(LiveRegs[rx].Value &amp;&amp; <span class="stringliteral">&quot;Not live after collapse?&quot;</span>);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      LiveRegs[rx].Value-&gt;addDomain(domain);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">// Set up basic collapsed DomainValue.</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    setLiveReg(rx, alloc(domain));</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  }</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">/// Collapse open DomainValue into given domain. If there are multiple</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">/// registers using dv, they each get a unique collapsed DomainValue.</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ExeDepsFix::collapse(DomainValue *dv, <span class="keywordtype">unsigned</span> domain) {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  assert(dv-&gt;hasDomain(domain) &amp;&amp; <span class="stringliteral">&quot;Cannot collapse&quot;</span>);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="comment">// Collapse all the instructions.</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keywordflow">while</span> (!dv-&gt;Instrs.empty())</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;setExecutionDomain(dv-&gt;Instrs.pop_back_val(), domain);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  dv-&gt;setSingleDomain(domain);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="comment">// If there are multiple users, give them new, unique DomainValues.</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordflow">if</span> (LiveRegs &amp;&amp; dv-&gt;Refs &gt; 1)</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> rx = 0; rx != NumRegs; ++rx)</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="keywordflow">if</span> (LiveRegs[rx].<a class="code" href="classllvm_1_1Value.html">Value</a> == dv)</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        setLiveReg(rx, alloc(domain));</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;}</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">/// Merge - All instructions and registers in B are moved to A, and B is</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">/// released.</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ExeDepsFix::merge(DomainValue *<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>, DomainValue *<a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a>) {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  assert(!A-&gt;isCollapsed() &amp;&amp; <span class="stringliteral">&quot;Cannot merge into collapsed&quot;</span>);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  assert(!B-&gt;isCollapsed() &amp;&amp; <span class="stringliteral">&quot;Cannot merge from collapsed&quot;</span>);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordflow">if</span> (A == B)</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="comment">// Restrict to the domains that A and B have in common.</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="Target_2X86_2README_8txt.html#a23011c5e3833afd34cdf77df5760c78b">common</a> = A-&gt;getCommonDomains(B-&gt;AvailableDomains);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="keywordflow">if</span> (!common)</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  A-&gt;AvailableDomains = <a class="code" href="Target_2X86_2README_8txt.html#a23011c5e3833afd34cdf77df5760c78b">common</a>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  A-&gt;Instrs.append(B-&gt;Instrs.begin(), B-&gt;Instrs.end());</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="comment">// Clear the old DomainValue so we won&#39;t try to swizzle instructions twice.</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  B-&gt;clear();</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="comment">// All uses of B are referred to A.</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  B-&gt;Next = retain(A);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> rx = 0; rx != NumRegs; ++rx)</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">if</span> (LiveRegs[rx].<a class="code" href="classllvm_1_1Value.html">Value</a> == B)</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      setLiveReg(rx, A);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;}</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">// enterBasicBlock - Set up LiveRegs by merging predecessor live-out values.</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="keywordtype">void</span> ExeDepsFix::enterBasicBlock(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB) {</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="comment">// Detect back-edges from predecessors we haven&#39;t processed yet.</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  SeenUnknownBackEdge = <span class="keyword">false</span>;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="comment">// Reset instruction counter in each basic block.</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  CurInstr = 0;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="comment">// Set up UndefReads to track undefined register reads.</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  UndefReads.clear();</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  LiveUnits.clear();</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="comment">// Set up LiveRegs to represent registers entering MBB.</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keywordflow">if</span> (!LiveRegs)</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    LiveRegs = <span class="keyword">new</span> LiveReg[NumRegs];</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="comment">// Default values are &#39;nothing happened a long time ago&#39;.</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> rx = 0; rx != NumRegs; ++rx) {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    LiveRegs[rx].Value = 0;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    LiveRegs[rx].Def = -(1 &lt;&lt; 20);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="comment">// This is the entry block.</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keywordflow">if</span> (MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ae1612b06274368fe13b574cbd9c4f768">pred_empty</a>()) {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#a7bab64c02d740522f94f5f45959a22fc">MachineBasicBlock::livein_iterator</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6833d4f80b7e44f505b2184b04ea2693">livein_begin</a>(),</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;         e = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#aa314325c7062fd067a3c0b9339aa8ea6">livein_end</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="keywordtype">int</span> rx = regIndex(*<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="keywordflow">if</span> (rx &lt; 0)</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="comment">// Treat function live-ins as if they were defined just before the first</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="comment">// instruction.  Usually, function arguments are set up immediately</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="comment">// before the call.</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      LiveRegs[rx].Def = -1;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;BB#&quot;</span> &lt;&lt; MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>() &lt;&lt; <span class="stringliteral">&quot;: entry\n&quot;</span>);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="comment">// Try to coalesce live-out registers from predecessors.</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#a502516f71f7824d46325d30ea41f34ba">MachineBasicBlock::const_pred_iterator</a> pi = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab644fcf07a4c2708333cf66276282357">pred_begin</a>(),</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;       pe = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a0359a738e0412c5a7ea55d61175e0661">pred_end</a>(); pi != pe; ++pi) {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    LiveOutMap::const_iterator fi = LiveOuts.find(*pi);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">if</span> (fi == LiveOuts.end()) {</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      SeenUnknownBackEdge = <span class="keyword">true</span>;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    }</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    assert(fi-&gt;second &amp;&amp; <span class="stringliteral">&quot;Can&#39;t have NULL entries&quot;</span>);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> rx = 0; rx != NumRegs; ++rx) {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="comment">// Use the most recent predecessor def for each register.</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      LiveRegs[rx].Def = std::max(LiveRegs[rx].<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a>, fi-&gt;second[rx].Def);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      DomainValue *pdv = resolve(fi-&gt;second[rx].Value);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="keywordflow">if</span> (!pdv)</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="keywordflow">if</span> (!LiveRegs[rx].<a class="code" href="classllvm_1_1Value.html">Value</a>) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        setLiveReg(rx, pdv);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="comment">// We have a live DomainValue from more than one predecessor.</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <span class="keywordflow">if</span> (LiveRegs[rx].Value-&gt;isCollapsed()) {</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="comment">// We are already collapsed, but predecessor is not. Force him.</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="keywordtype">unsigned</span> Domain = LiveRegs[rx].Value-&gt;getFirstDomain();</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <span class="keywordflow">if</span> (!pdv-&gt;isCollapsed() &amp;&amp; pdv-&gt;hasDomain(Domain))</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;          collapse(pdv, Domain);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      <span class="comment">// Currently open, merge in predecessor.</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      <span class="keywordflow">if</span> (!pdv-&gt;isCollapsed())</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        merge(LiveRegs[rx].Value, pdv);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <a class="code" href="Target_2SystemZ_2README_8txt.html#a4c482947c920572e8a1aff348c7cb5cc">force</a>(rx, pdv-&gt;getFirstDomain());</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    }</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  }</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;BB#&quot;</span> &lt;&lt; MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        &lt;&lt; (SeenUnknownBackEdge ? <span class="stringliteral">&quot;: incomplete\n&quot;</span> : <span class="stringliteral">&quot;: all preds known\n&quot;</span>));</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;}</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="keywordtype">void</span> ExeDepsFix::leaveBasicBlock(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB) {</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  assert(LiveRegs &amp;&amp; <span class="stringliteral">&quot;Must enter basic block first.&quot;</span>);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="comment">// Save live registers at end of MBB - used by enterBasicBlock().</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="comment">// Also use LiveOuts as a visited set to detect back-edges.</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="Target_2README_8txt.html#ab24db72f7bd10b13351812874015861b">First</a> = LiveOuts.insert(std::make_pair(MBB, LiveRegs)).second;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">if</span> (First) {</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="comment">// LiveRegs was inserted in LiveOuts.  Adjust all defs to be relative to</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="comment">// the end of this block instead of the beginning.</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = NumRegs; <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      LiveRegs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">Def</a> -= CurInstr;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">// Insertion failed, this must be the second pass.</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="comment">// Release all the DomainValues instead of keeping them.</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = NumRegs; <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      release(LiveRegs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="classllvm_1_1Value.html">Value</a>);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keyword">delete</span>[] LiveRegs;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  }</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  LiveRegs = 0;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;}</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="keywordtype">void</span> ExeDepsFix::visitInstr(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>) {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordflow">if</span> (MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a1e1d26226c627cf3dcf3c191b85e7d7d">isDebugValue</a>())</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="comment">// Update instructions with explicit execution domains.</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  std::pair&lt;uint16_t, uint16_t&gt; DomP = <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getExecutionDomain(MI);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordflow">if</span> (DomP.first) {</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">if</span> (DomP.second)</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      visitSoftInstr(MI, DomP.second);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      visitHardInstr(MI, DomP.first);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  }</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="comment">// Process defs to track register ages, and kill values clobbered by generic</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="comment">// instructions.</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  processDefs(MI, !DomP.first);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;}</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">/// \brief Return true to if it makes sense to break dependence on a partial def</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">/// or undef use.</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ExeDepsFix::shouldBreakDependence(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI, <span class="keywordtype">unsigned</span> OpIdx,</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                                       <span class="keywordtype">unsigned</span> Pref) {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="keywordtype">int</span> rx = regIndex(MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(OpIdx).<a class="code" href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">getReg</a>());</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordflow">if</span> (rx &lt; 0)</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="keywordtype">unsigned</span> Clearance = CurInstr - LiveRegs[rx].Def;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Clearance: &quot;</span> &lt;&lt; Clearance &lt;&lt; <span class="stringliteral">&quot;, want &quot;</span> &lt;&lt; Pref);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordflow">if</span> (Pref &gt; Clearance) {</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;: Break dependency.\n&quot;</span>);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  }</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="comment">// The current clearance seems OK, but we may be ignoring a def from a</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="comment">// back-edge.</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keywordflow">if</span> (!SeenUnknownBackEdge || Pref &lt;= <span class="keywordtype">unsigned</span>(CurInstr)) {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;: OK .\n&quot;</span>);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="comment">// A def from an unprocessed back-edge may make us break this dependency.</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;: Wait for back-edge to resolve.\n&quot;</span>);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;}</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">// Update def-ages for registers defined by MI.</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">// If Kill is set, also kill off DomainValues clobbered by the defs.</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">// Also break dependencies on partial defs and undef uses.</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="keywordtype">void</span> ExeDepsFix::processDefs(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI, <span class="keywordtype">bool</span> <a class="code" href="namespacellvm_1_1RegState.html#a079b254e749130fbe5d740f314ca92daa9ddde91ef09476d28a088fe57f8e2921">Kill</a>) {</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  assert(!MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a1e1d26226c627cf3dcf3c191b85e7d7d">isDebugValue</a>() &amp;&amp; <span class="stringliteral">&quot;Won&#39;t process debug values&quot;</span>);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="comment">// Break dependence on undef uses. Do this before updating LiveRegs below.</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="keywordtype">unsigned</span> OpNum;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordtype">unsigned</span> Pref = <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getUndefRegClearance(MI, OpNum, TRI);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="keywordflow">if</span> (Pref) {</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keywordflow">if</span> (shouldBreakDependence(MI, OpNum, Pref))</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      UndefReads.push_back(std::make_pair(MI, OpNum));</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  }</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1MCInstrDesc.html">MCInstrDesc</a> &amp;MCID = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a803a7424877fd049679b9aa2f07597b5">getDesc</a>();</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0,</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;         e = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a6223324306ef111aa9cdfc705365fe7c">isVariadic</a>() ? MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a7b5fe96d88954efc855e6c466207e535">getNumOperands</a>() : MCID.<a class="code" href="classllvm_1_1MCInstrDesc.html#a9d472a8ee447cef18a71beb229d4d252">getNumDefs</a>();</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;         <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> &amp;MO = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordflow">if</span> (!MO.<a class="code" href="classllvm_1_1MachineOperand.html#ad8198d6d83af9410d867136e33fbf4b2">isReg</a>())</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">if</span> (MO.<a class="code" href="classllvm_1_1MachineOperand.html#a40a5d6e03f5bfd15839355a7c39ab3a0">isImplicit</a>())</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">if</span> (MO.<a class="code" href="classllvm_1_1MachineOperand.html#a57bf9ee7219097ff0f98da23a3b3b782">isUse</a>())</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordtype">int</span> rx = regIndex(MO.<a class="code" href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">getReg</a>());</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">if</span> (rx &lt; 0)</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="comment">// This instruction explicitly defines rx.</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; TRI-&gt;getName(RC-&gt;getRegister(rx)) &lt;&lt; <span class="stringliteral">&quot;:\t&quot;</span> &lt;&lt; CurInstr</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                 &lt;&lt; <span class="charliteral">&#39;\t&#39;</span> &lt;&lt; *MI);</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="comment">// Check clearance before partial register updates.</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="comment">// Call breakDependence before setting LiveRegs[rx].Def.</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordtype">unsigned</span> Pref = <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getPartialRegUpdateClearance(MI, <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, TRI);</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordflow">if</span> (Pref &amp;&amp; shouldBreakDependence(MI, <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, Pref))</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;breakPartialRegDependency(MI, <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, TRI);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="comment">// How many instructions since rx was last written?</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    LiveRegs[rx].Def = CurInstr;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="comment">// Kill off domains redefined by generic instructions.</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordflow">if</span> (Kill)</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      kill(rx);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  }</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  ++CurInstr;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;}</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">/// \break Break false dependencies on undefined register reads.</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">/// Walk the block backward computing precise liveness. This is expensive, so we</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">/// only do it on demand. Note that the occurrence of undefined register reads</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">/// that should be broken is very rare, but when they occur we may have many in</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">/// a single block.</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ExeDepsFix::processUndefReads(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB) {</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="keywordflow">if</span> (UndefReads.empty())</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="comment">// Collect this block&#39;s live out register units.</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  LiveUnits.init(TRI);</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6198e2abdd4f41355b1a0931affde1a6">MachineBasicBlock::const_succ_iterator</a> SI = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6321b189ea8fd5058663f8a87d6c23e9">succ_begin</a>(),</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;         SE = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3ddd708642d60c1661992ff8ba1b215d">succ_end</a>(); SI != SE; ++SI) {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    LiveUnits.addLiveIns(*SI, *TRI);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  }</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *UndefMI = UndefReads.back().first;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="keywordtype">unsigned</span> OpIdx = UndefReads.back().second;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#a0848c971395758cf592821550b725853">MachineBasicBlock::reverse_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ad8c9657cfb03ef2ebf6364ba9d68c127">rbegin</a>(), E = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a2a25c462b91ac5da41f4ab7edc32b650">rend</a>();</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">// Update liveness, including the current instrucion&#39;s defs.</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    LiveUnits.stepBackward(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, *TRI);</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordflow">if</span> (UndefMI == &amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="keywordflow">if</span> (!LiveUnits.contains(UndefMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(OpIdx).<a class="code" href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">getReg</a>(), *TRI))</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;breakPartialRegDependency(UndefMI, OpIdx, TRI);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      UndefReads.pop_back();</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="keywordflow">if</span> (UndefReads.empty())</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      UndefMI = UndefReads.back().first;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      OpIdx = UndefReads.back().second;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    }</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  }</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;}</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">// A hard instruction only works in one domain. All input registers will be</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">// forced into that domain.</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="keywordtype">void</span> ExeDepsFix::visitHardInstr(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *mi, <span class="keywordtype">unsigned</span> domain) {</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="comment">// Collapse all uses.</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = mi-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a803a7424877fd049679b9aa2f07597b5">getDesc</a>().<a class="code" href="classllvm_1_1MCInstrDesc.html#a9d472a8ee447cef18a71beb229d4d252">getNumDefs</a>(),</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                e = mi-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a803a7424877fd049679b9aa2f07597b5">getDesc</a>().<a class="code" href="classllvm_1_1MCInstrDesc.html#a55194ec3a1e49d04eab64e993e614246">getNumOperands</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> &amp;mo = mi-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">if</span> (!mo.<a class="code" href="classllvm_1_1MachineOperand.html#ad8198d6d83af9410d867136e33fbf4b2">isReg</a>()) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordtype">int</span> rx = regIndex(mo.<a class="code" href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">getReg</a>());</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordflow">if</span> (rx &lt; 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <a class="code" href="Target_2SystemZ_2README_8txt.html#a4c482947c920572e8a1aff348c7cb5cc">force</a>(rx, domain);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  }</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="comment">// Kill all defs and force them.</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = mi-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a803a7424877fd049679b9aa2f07597b5">getDesc</a>().<a class="code" href="classllvm_1_1MCInstrDesc.html#a9d472a8ee447cef18a71beb229d4d252">getNumDefs</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> &amp;mo = mi-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordflow">if</span> (!mo.<a class="code" href="classllvm_1_1MachineOperand.html#ad8198d6d83af9410d867136e33fbf4b2">isReg</a>()) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordtype">int</span> rx = regIndex(mo.<a class="code" href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">getReg</a>());</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordflow">if</span> (rx &lt; 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    kill(rx);</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <a class="code" href="Target_2SystemZ_2README_8txt.html#a4c482947c920572e8a1aff348c7cb5cc">force</a>(rx, domain);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  }</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;}</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">// A soft instruction can be changed to work in other domains given by mask.</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="keywordtype">void</span> ExeDepsFix::visitSoftInstr(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *mi, <span class="keywordtype">unsigned</span> mask) {</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="comment">// Bitmask of available domains for this instruction after taking collapsed</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="comment">// operands into account.</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#afe8cc12d0d0c28bd5b1c8aedbc4e0040">available</a> = mask;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="comment">// Scan the explicit use operands for incoming domains.</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int, 4&gt;</a> <a class="code" href="README-SSE_8txt.html#aae2d2977835e891eef9c1569d44462d7">used</a>;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="keywordflow">if</span> (LiveRegs)</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = mi-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a803a7424877fd049679b9aa2f07597b5">getDesc</a>().<a class="code" href="classllvm_1_1MCInstrDesc.html#a9d472a8ee447cef18a71beb229d4d252">getNumDefs</a>(),</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                  e = mi-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a803a7424877fd049679b9aa2f07597b5">getDesc</a>().<a class="code" href="classllvm_1_1MCInstrDesc.html#a55194ec3a1e49d04eab64e993e614246">getNumOperands</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> &amp;mo = mi-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="keywordflow">if</span> (!mo.<a class="code" href="classllvm_1_1MachineOperand.html#ad8198d6d83af9410d867136e33fbf4b2">isReg</a>()) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      <span class="keywordtype">int</span> rx = regIndex(mo.<a class="code" href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">getReg</a>());</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      <span class="keywordflow">if</span> (rx &lt; 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      <span class="keywordflow">if</span> (DomainValue *dv = LiveRegs[rx].<a class="code" href="classllvm_1_1Value.html">Value</a>) {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <span class="comment">// Bitmask of domains that dv and available have in common.</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="Target_2X86_2README_8txt.html#a23011c5e3833afd34cdf77df5760c78b">common</a> = dv-&gt;getCommonDomains(available);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="comment">// Is it possible to use this collapsed register for free?</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="keywordflow">if</span> (dv-&gt;isCollapsed()) {</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;          <span class="comment">// Restrict available domains to the ones in common with the operand.</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;          <span class="comment">// If there are no common domains, we must pay the cross-domain</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;          <span class="comment">// penalty for this operand.</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;          <span class="keywordflow">if</span> (common) available = <a class="code" href="Target_2X86_2README_8txt.html#a23011c5e3833afd34cdf77df5760c78b">common</a>;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (common)</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;          <span class="comment">// Open DomainValue is compatible, save it for merging.</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;          used.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(rx);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;          <span class="comment">// Open DomainValue is not compatible with instruction. It is useless</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;          <span class="comment">// now.</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;          kill(rx);</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      }</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    }</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="comment">// If the collapsed operands force a single domain, propagate the collapse.</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#af4d1a918800291e75b01ce1447be0e83">isPowerOf2_32</a>(available)) {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordtype">unsigned</span> domain = <a class="code" href="namespacellvm.html#abdaf1eaf6120421977095bd97eee892e">countTrailingZeros</a>(available);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;setExecutionDomain(mi, domain);</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    visitHardInstr(mi, domain);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  }</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="comment">// Kill off any remaining uses that don&#39;t match available, and build a list of</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="comment">// incoming DomainValues that we want to merge.</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;LiveReg, 4&gt;</a> Regs;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;::iterator</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>=used.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), e=used.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>!=e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordtype">int</span> rx = *<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keyword">const</span> LiveReg &amp;LR = LiveRegs[rx];</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="comment">// This useless DomainValue could have been missed above.</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordflow">if</span> (!LR.Value-&gt;getCommonDomains(available)) {</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      kill(rx);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    }</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="comment">// Sorted insertion.</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordtype">bool</span> Inserted = <span class="keyword">false</span>;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classT.html">SmallVectorImpl&lt;LiveReg&gt;::iterator</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = Regs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), e = Regs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>();</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;           <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e &amp;&amp; !Inserted; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keywordflow">if</span> (LR.Def &lt; <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>-&gt;Def) {</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        Inserted = <span class="keyword">true</span>;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        Regs.<a class="code" href="classllvm_1_1SmallVectorImpl.html#af622128e353515efebccad40eae495cb">insert</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, LR);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    }</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordflow">if</span> (!Inserted)</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      Regs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(LR);</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  }</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="comment">// doms are now sorted in order of appearance. Try to merge them all, giving</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="comment">// priority to the latest ones.</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  DomainValue *dv = 0;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <span class="keywordflow">while</span> (!Regs.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">if</span> (!dv) {</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      dv = Regs.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>().Value;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      <span class="comment">// Force the first dv to match the current instruction.</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      dv-&gt;AvailableDomains = dv-&gt;getCommonDomains(available);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      assert(dv-&gt;AvailableDomains &amp;&amp; <span class="stringliteral">&quot;Domain should have been filtered&quot;</span>);</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    }</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    DomainValue *Latest = Regs.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>().Value;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="comment">// Skip already merged values.</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="keywordflow">if</span> (Latest == dv || Latest-&gt;Next)</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordflow">if</span> (merge(dv, Latest))</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="comment">// If latest didn&#39;t merge, it is useless now. Kill all registers using it.</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;::iterator</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>=used.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), e=used.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>!=e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      <span class="keywordflow">if</span> (LiveRegs[*<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="classllvm_1_1Value.html">Value</a> == Latest)</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        kill(*<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  }</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="comment">// dv is the DomainValue we are going to use for this instruction.</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="keywordflow">if</span> (!dv) {</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    dv = alloc();</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    dv-&gt;AvailableDomains = <a class="code" href="Target_2README_8txt.html#afe8cc12d0d0c28bd5b1c8aedbc4e0040">available</a>;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  }</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  dv-&gt;Instrs.push_back(mi);</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="comment">// Finally set all defs and non-collapsed uses to dv. We must iterate through</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <span class="comment">// all the operators, including imp-def ones.</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineOperand.html">MachineInstr::mop_iterator</a> ii = mi-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a0037ac891190e1408b04a48156c3368c">operands_begin</a>(),</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                                  ee = mi-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a6e6014fca5895fa5f9487ff7c79678b0">operands_end</a>();</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                                  ii != ee; ++ii) {</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> &amp;mo = *ii;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keywordflow">if</span> (!mo.<a class="code" href="classllvm_1_1MachineOperand.html#ad8198d6d83af9410d867136e33fbf4b2">isReg</a>()) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="keywordtype">int</span> rx = regIndex(mo.<a class="code" href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">getReg</a>());</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">if</span> (rx &lt; 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">if</span> (!LiveRegs[rx].<a class="code" href="classllvm_1_1Value.html">Value</a> || (mo.<a class="code" href="classllvm_1_1MachineOperand.html#a8de7d5cf38939044471c6ee60a01a3df">isDef</a>() &amp;&amp; LiveRegs[rx].Value != dv)) {</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      kill(rx);</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      setLiveReg(rx, dv);</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    }</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  }</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;}</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="keywordtype">bool</span> ExeDepsFix::runOnMachineFunction(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;mf) {</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  MF = &amp;mf;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a> = MF-&gt;getTarget().getInstrInfo();</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  TRI = MF-&gt;getTarget().<a class="code" href="classllvm_1_1HexagonInstrInfo.html#a768d8c24067887bc878ddedbf5ab701a">getRegisterInfo</a>();</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  LiveRegs = 0;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  assert(NumRegs == RC-&gt;getNumRegs() &amp;&amp; <span class="stringliteral">&quot;Bad regclass&quot;</span>);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;********** FIX EXECUTION DEPENDENCIES: &quot;</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;               &lt;&lt; RC-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; **********\n&quot;</span>);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <span class="comment">// If no relevant registers are used in the function, we can skip it</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="comment">// completely.</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <span class="keywordtype">bool</span> anyregs = <span class="keyword">false</span>;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1TargetRegisterClass.html#ae529314c316fb0b19c88b391b2b96072">TargetRegisterClass::const_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = RC-&gt;begin(), E = RC-&gt;end();</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">if</span> (MF-&gt;getRegInfo().isPhysRegUsed(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      anyregs = <span class="keyword">true</span>;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    }</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="keywordflow">if</span> (!anyregs) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="comment">// Initialize the AliasMap on the first use.</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="keywordflow">if</span> (AliasMap.empty()) {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="comment">// Given a PhysReg, AliasMap[PhysReg] is either the relevant index into RC,</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="comment">// or -1.</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    AliasMap.resize(TRI-&gt;getNumRegs(), -1);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = RC-&gt;getNumRegs(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MCRegAliasIterator.html">MCRegAliasIterator</a> AI(RC-&gt;getRegister(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>), TRI, <span class="keyword">true</span>);</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;           AI.<a class="code" href="classllvm_1_1MCRegAliasIterator.html#abf2eadac3ea84e2e2739444c40421eac">isValid</a>(); ++AI)</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        AliasMap[*AI] = <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  }</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *Entry = MF-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <a class="code" href="classllvm_1_1ReversePostOrderTraversal.html">ReversePostOrderTraversal&lt;MachineBasicBlock*&gt;</a> RPOT(Entry);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MachineBasicBlock*, 16&gt;</a> <a class="code" href="HexagonHardwareLoops_8cpp.html#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ReversePostOrderTraversal.html#aa447608e2881e813215c3f289496c6ea">ReversePostOrderTraversal&lt;MachineBasicBlock*&gt;::rpo_iterator</a></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;         MBBI = RPOT.<a class="code" href="classllvm_1_1ReversePostOrderTraversal.html#ac958000d711f19778f1b40792821b5b3">begin</a>(), MBBE = RPOT.<a class="code" href="classllvm_1_1ReversePostOrderTraversal.html#ae945899e1218a9240c3fed1e5789cbba">end</a>(); MBBI != MBBE; ++MBBI) {</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB = *MBBI;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    enterBasicBlock(MBB);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="keywordflow">if</span> (SeenUnknownBackEdge)</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      Loops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(MBB);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#ac51be7ff80fe8d6ae5e8c0acb194908a">MachineBasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">begin</a>(), E = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      visitInstr(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    processUndefReads(MBB);</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    leaveBasicBlock(MBB);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  }</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <span class="comment">// Visit all the loop blocks again in order to merge DomainValues from</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="comment">// back-edges.</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Loops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB = Loops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    enterBasicBlock(MBB);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#ac51be7ff80fe8d6ae5e8c0acb194908a">MachineBasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">begin</a>(), E = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isDebugValue())</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        processDefs(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="keyword">false</span>);</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    processUndefReads(MBB);</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    leaveBasicBlock(MBB);</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  }</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="comment">// Clear the LiveOuts vectors and collapse any remaining DomainValues.</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ReversePostOrderTraversal.html#aa447608e2881e813215c3f289496c6ea">ReversePostOrderTraversal&lt;MachineBasicBlock*&gt;::rpo_iterator</a></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;         MBBI = RPOT.<a class="code" href="classllvm_1_1ReversePostOrderTraversal.html#ac958000d711f19778f1b40792821b5b3">begin</a>(), MBBE = RPOT.<a class="code" href="classllvm_1_1ReversePostOrderTraversal.html#ae945899e1218a9240c3fed1e5789cbba">end</a>(); MBBI != MBBE; ++MBBI) {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    LiveOutMap::const_iterator FI = LiveOuts.find(*MBBI);</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordflow">if</span> (FI == LiveOuts.end() || !FI-&gt;second)</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = NumRegs; <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="keywordflow">if</span> (FI-&gt;second[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Value)</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        release(FI-&gt;second[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Value);</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="keyword">delete</span>[] FI-&gt;second;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  }</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  LiveOuts.clear();</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  UndefReads.clear();</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  Avail.clear();</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  Allocator.DestroyAll();</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;}</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> *</div><div class="line"><a name="l00796"></a><span class="lineno"><a class="line" href="namespacellvm.html#a7def58200ca2d0319f4ac3d42fcccae0">  796</a></span>&#160;<a class="code" href="namespacellvm.html#a7def58200ca2d0319f4ac3d42fcccae0">llvm::createExecutionDependencyFixPass</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetRegisterClass.html">TargetRegisterClass</a> *RC) {</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> ExeDepsFix(RC);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;}</div><div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a075e34e98605d0e7c289763a104869ac"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">llvm::SmallVectorTemplateCommon::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00114">SmallVector.h:114</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_a40a5d6e03f5bfd15839355a7c39ab3a0"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a40a5d6e03f5bfd15839355a7c39ab3a0">llvm::MachineOperand::isImplicit</a></div><div class="ttdeci">bool isImplicit() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00279">MachineOperand.h:279</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a22a311dfe4c28a897de8a9365a4f0a84"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">llvm::SmallVectorTemplateCommon&lt; T &gt;::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00127">SmallVector.h:127</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_ae1a10b90f22c0478960fb5798ff73916"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">llvm::SmallVectorTemplateBase::push_back</a></div><div class="ttdeci">void push_back(const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00236">SmallVector.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1TargetRegisterClass_html_ae529314c316fb0b19c88b391b2b96072"><div class="ttname"><a href="classllvm_1_1TargetRegisterClass.html#ae529314c316fb0b19c88b391b2b96072">llvm::TargetRegisterClass::const_iterator</a></div><div class="ttdeci">const MCPhysReg * const_iterator</div><div class="ttdef"><b>Definition:</b> <a href="TargetRegisterInfo_8h_source.html#l00039">TargetRegisterInfo.h:39</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_a6e6014fca5895fa5f9487ff7c79678b0"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a6e6014fca5895fa5f9487ff7c79678b0">llvm::MachineInstr::operands_end</a></div><div class="ttdeci">mop_iterator operands_end()</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00285">MachineInstr.h:285</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARM__PROC_html_aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5"><div class="ttname"><a href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">llvm::ARM_PROC::A</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInfo_8h_source.html#l00098">ARMBaseInfo.h:98</a></div></div>
<div class="ttc" id="namespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">List of target independent CodeGen pass IDs. </div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l00022">APFloat.h:22</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html"><div class="ttname"><a href="classllvm_1_1MachineFunction.html">llvm::MachineFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00075">MachineFunction.h:75</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a6acda287e5c19ffb173b0bf8f1dd9c5e"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">llvm::MachineBasicBlock::getNumber</a></div><div class="ttdeci">int getNumber() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00615">MachineBasicBlock.h:615</a></div></div>
<div class="ttc" id="classllvm_1_1MCInstrDesc_html_a9d472a8ee447cef18a71beb229d4d252"><div class="ttname"><a href="classllvm_1_1MCInstrDesc.html#a9d472a8ee447cef18a71beb229d4d252">llvm::MCInstrDesc::getNumDefs</a></div><div class="ttdeci">unsigned getNumDefs() const </div><div class="ttdoc">Return the number of MachineOperands that are register definitions. Register definitions always occur...</div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00198">MCInstrDesc.h:198</a></div></div>
<div class="ttc" id="namespacellvm_1_1RegState_html_a079b254e749130fbe5d740f314ca92daa9ddde91ef09476d28a088fe57f8e2921"><div class="ttname"><a href="namespacellvm_1_1RegState.html#a079b254e749130fbe5d740f314ca92daa9ddde91ef09476d28a088fe57f8e2921">llvm::RegState::Kill</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00033">MachineInstrBuilder.h:33</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a7bab64c02d740522f94f5f45959a22fc"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a7bab64c02d740522f94f5f45959a22fc">llvm::MachineBasicBlock::livein_iterator</a></div><div class="ttdeci">std::vector&lt; unsigned &gt;::const_iterator livein_iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00314">MachineBasicBlock.h:314</a></div></div>
<div class="ttc" id="classllvm_1_1MCInstrDesc_html"><div class="ttname"><a href="classllvm_1_1MCInstrDesc.html">llvm::MCInstrDesc</a></div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00137">MCInstrDesc.h:137</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00534">DenseMap.h:534</a></div></div>
<div class="ttc" id="Debug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a3ddd708642d60c1661992ff8ba1b215d"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a3ddd708642d60c1661992ff8ba1b215d">llvm::MachineBasicBlock::succ_end</a></div><div class="ttdeci">succ_iterator succ_end()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00278">MachineBasicBlock.h:278</a></div></div>
<div class="ttc" id="Target_2TargetMachine_8h_html"><div class="ttname"><a href="Target_2TargetMachine_8h.html">TargetMachine.h</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_af622128e353515efebccad40eae495cb"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#af622128e353515efebccad40eae495cb">llvm::SmallVectorImpl::insert</a></div><div class="ttdeci">iterator insert(iterator I, const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00537">SmallVector.h:537</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_a803a7424877fd049679b9aa2f07597b5"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a803a7424877fd049679b9aa2f07597b5">llvm::MachineInstr::getDesc</a></div><div class="ttdeci">const MCInstrDesc &amp; getDesc() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00257">MachineInstr.h:257</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_acbc921830578e2741be6549db716c0ce"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">llvm::MachineBasicBlock::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00238">MachineBasicBlock.h:238</a></div></div>
<div class="ttc" id="Target_2X86_2README_8txt_html_a23011c5e3833afd34cdf77df5760c78b"><div class="ttname"><a href="Target_2X86_2README_8txt.html#a23011c5e3833afd34cdf77df5760c78b">common</a></div><div class="ttdeci">compiles rbx movl r14d r14d testl r14d je LBB0_2 Instead of doing an we can use the flags off the sar This occurs in a bigger testcase like which is pretty common</div><div class="ttdef"><b>Definition:</b> <a href="Target_2X86_2README_8txt_source.html#l00098">Target/X86/README.txt:98</a></div></div>
<div class="ttc" id="Allocator_8h_html"><div class="ttname"><a href="Allocator_8h.html">Allocator.h</a></div></div>
<div class="ttc" id="X86DisassemblerDecoder_8h_html_a546839a5c4bcf9f9450967155f48de41"><div class="ttname"><a href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a></div><div class="ttdeci">Reg</div><div class="ttdef"><b>Definition:</b> <a href="X86DisassemblerDecoder_8h_source.html#l00428">X86DisassemblerDecoder.h:428</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a6833d4f80b7e44f505b2184b04ea2693"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a6833d4f80b7e44f505b2184b04ea2693">llvm::MachineBasicBlock::livein_begin</a></div><div class="ttdeci">livein_iterator livein_begin() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00315">MachineBasicBlock.h:315</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_ae1612b06274368fe13b574cbd9c4f768"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ae1612b06274368fe13b574cbd9c4f768">llvm::MachineBasicBlock::pred_empty</a></div><div class="ttdeci">bool pred_empty() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00275">MachineBasicBlock.h:275</a></div></div>
<div class="ttc" id="HexagonHardwareLoops_8cpp_html_ada7c1594a393ede3ce32602d64d7ddb2"><div class="ttname"><a href="HexagonHardwareLoops_8cpp.html#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a></div><div class="ttdeci">Hexagon Hardware Loops</div><div class="ttdef"><b>Definition:</b> <a href="HexagonHardwareLoops_8cpp_source.html#l00281">HexagonHardwareLoops.cpp:281</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunctionPass_html"><div class="ttname"><a href="classllvm_1_1MachineFunctionPass.html">llvm::MachineFunctionPass</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineFunctionPass_8h_source.html#l00032">MachineFunctionPass.h:32</a></div></div>
<div class="ttc" id="HexagonCopyToCombine_8cpp_html_a1d40004718218dbdf06b496766299101"><div class="ttname"><a href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a></div><div class="ttdeci">const HexagonInstrInfo * TII</div><div class="ttdef"><b>Definition:</b> <a href="HexagonCopyToCombine_8cpp_source.html#l00115">HexagonCopyToCombine.cpp:115</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a400eaca9881c8dcab97e9f42b1ab1815"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">llvm::SmallVectorImpl::pop_back_val</a></div><div class="ttdeci">T LLVM_ATTRIBUTE_UNUSED_RESULT pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00430">SmallVector.h:430</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00035">APInt.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_ad8198d6d83af9410d867136e33fbf4b2"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#ad8198d6d83af9410d867136e33fbf4b2">llvm::MachineOperand::isReg</a></div><div class="ttdeci">bool isReg() const </div><div class="ttdoc">isReg - Tests if this is a MO_Register operand. </div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00224">MachineOperand.h:224</a></div></div>
<div class="ttc" id="classllvm_1_1TargetRegisterClass_html"><div class="ttname"><a href="classllvm_1_1TargetRegisterClass.html">llvm::TargetRegisterClass</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetRegisterInfo_8h_source.html#l00036">TargetRegisterInfo.h:36</a></div></div>
<div class="ttc" id="classllvm_1_1MCRegAliasIterator_html_abf2eadac3ea84e2e2739444c40421eac"><div class="ttname"><a href="classllvm_1_1MCRegAliasIterator.html#abf2eadac3ea84e2e2739444c40421eac">llvm::MCRegAliasIterator::isValid</a></div><div class="ttdeci">bool isValid() const </div><div class="ttdef"><b>Definition:</b> <a href="MCRegisterInfo_8h_source.html#l00580">MCRegisterInfo.h:580</a></div></div>
<div class="ttc" id="namespacellvm_1_1CallingConv_html_a4f861731fc6dbfdccc05af5968d98974"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">llvm::CallingConv::ID</a></div><div class="ttdeci">ID</div><div class="ttdoc">LLVM Calling Convention Representation. </div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00026">CallingConv.h:26</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_a7b5fe96d88954efc855e6c466207e535"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a7b5fe96d88954efc855e6c466207e535">llvm::MachineInstr::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00265">MachineInstr.h:265</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorBase_html_a8a8df4d85555c7954a95f86080cd3b64"><div class="ttname"><a href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">llvm::SmallVectorBase::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00056">SmallVector.h:56</a></div></div>
<div class="ttc" id="namespacellvm_html_abdaf1eaf6120421977095bd97eee892e"><div class="ttname"><a href="namespacellvm.html#abdaf1eaf6120421977095bd97eee892e">llvm::countTrailingZeros</a></div><div class="ttdeci">enable_if_c&lt; std::numeric_limits&lt; T &gt;::is_integer &amp;&amp;!std::numeric_limits&lt; T &gt;::is_signed, std::size_t &gt;::type countTrailingZeros(T Val, ZeroBehavior ZB=ZB_Width)</div><div class="ttdoc">Count number of 0&amp;#39;s from the least significant bit to the most stopping at the first 1...</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00049">MathExtras.h:49</a></div></div>
<div class="ttc" id="classllvm_1_1ReversePostOrderTraversal_html_ac958000d711f19778f1b40792821b5b3"><div class="ttname"><a href="classllvm_1_1ReversePostOrderTraversal.html#ac958000d711f19778f1b40792821b5b3">llvm::ReversePostOrderTraversal::begin</a></div><div class="ttdeci">rpo_iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="PostOrderIterator_8h_source.html#l00273">PostOrderIterator.h:273</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a2a25c462b91ac5da41f4ab7edc32b650"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a2a25c462b91ac5da41f4ab7edc32b650">llvm::MachineBasicBlock::rend</a></div><div class="ttdeci">reverse_iterator rend()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00242">MachineBasicBlock.h:242</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_ad8c9657cfb03ef2ebf6364ba9d68c127"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ad8c9657cfb03ef2ebf6364ba9d68c127">llvm::MachineBasicBlock::rbegin</a></div><div class="ttdeci">reverse_iterator rbegin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00240">MachineBasicBlock.h:240</a></div></div>
<div class="ttc" id="README-SSE_8txt_html_aae2d2977835e891eef9c1569d44462d7"><div class="ttname"><a href="README-SSE_8txt.html#aae2d2977835e891eef9c1569d44462d7">used</a></div><div class="ttdeci">This might compile to this xmm1 xorps xmm0 movss xmm0 ret Now consider if the code caused xmm1 to get spilled This might produce this xmm1 movaps xmm0 movaps xmm1 movss xmm0 ret since the reload is only used by these we could fold it into the producing something like xmm1 movaps xmm0 ret saving two instructions The basic idea is that a reload from a spill if only one byte chunk is used</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00299">README-SSE.txt:299</a></div></div>
<div class="ttc" id="classllvm_1_1TargetInstrInfo_html"><div class="ttname"><a href="classllvm_1_1TargetInstrInfo.html">llvm::TargetInstrInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetInstrInfo_8h_source.html#l00047">TargetInstrInfo.h:47</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_a1e1d26226c627cf3dcf3c191b85e7d7d"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a1e1d26226c627cf3dcf3c191b85e7d7d">llvm::MachineInstr::isDebugValue</a></div><div class="ttdeci">bool isDebugValue() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00639">MachineInstr.h:639</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_ac51be7ff80fe8d6ae5e8c0acb194908a"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ac51be7ff80fe8d6ae5e8c0acb194908a">llvm::MachineBasicBlock::iterator</a></div><div class="ttdeci">bundle_iterator&lt; MachineInstr, instr_iterator &gt; iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00212">MachineBasicBlock.h:212</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a0359a738e0412c5a7ea55d61175e0661"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a0359a738e0412c5a7ea55d61175e0661">llvm::MachineBasicBlock::pred_end</a></div><div class="ttdeci">pred_iterator pred_end()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00262">MachineBasicBlock.h:262</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_aac0ea55010b7b1a301e65a0baea057aa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">llvm::SmallVectorImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00396">SmallVector.h:396</a></div></div>
<div class="ttc" id="namespacellvm_1_1tgtok_html_abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a"><div class="ttname"><a href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5aceb138f68fe183995736614928e3394a">llvm::tgtok::Def</a></div><div class="ttdef"><b>Definition:</b> <a href="TGLexer_8h_source.html#l00046">TGLexer.h:46</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_ab24db72f7bd10b13351812874015861b"><div class="ttname"><a href="Target_2README_8txt.html#ab24db72f7bd10b13351812874015861b">First</a></div><div class="ttdeci">into llvm powi allowing the code generator to produce balanced multiplication trees First</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00051">Target/README.txt:51</a></div></div>
<div class="ttc" id="classllvm_1_1ReversePostOrderTraversal_html"><div class="ttname"><a href="classllvm_1_1ReversePostOrderTraversal.html">llvm::ReversePostOrderTraversal</a></div><div class="ttdef"><b>Definition:</b> <a href="PostOrderIterator_8h_source.html#l00259">PostOrderIterator.h:259</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_aa314325c7062fd067a3c0b9339aa8ea6"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#aa314325c7062fd067a3c0b9339aa8ea6">llvm::MachineBasicBlock::livein_end</a></div><div class="ttdeci">livein_iterator livein_end() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00316">MachineBasicBlock.h:316</a></div></div>
<div class="ttc" id="TargetInstrInfo_8h_html"><div class="ttname"><a href="TargetInstrInfo_8h.html">TargetInstrInfo.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_a302e45878c6dc1714334c7ce96d56846"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">llvm::MachineInstr::getOperand</a></div><div class="ttdeci">const MachineOperand &amp; getOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00267">MachineInstr.h:267</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html">llvm::MachineBasicBlock</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00062">MachineBasicBlock.h:62</a></div></div>
<div class="ttc" id="classllvm_1_1MCRegAliasIterator_html"><div class="ttname"><a href="classllvm_1_1MCRegAliasIterator.html">llvm::MCRegAliasIterator</a></div><div class="ttdef"><b>Definition:</b> <a href="MCRegisterInfo_8h_source.html#l00555">MCRegisterInfo.h:555</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00037">PassAnalysisSupport.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_a6223324306ef111aa9cdfc705365fe7c"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a6223324306ef111aa9cdfc705365fe7c">llvm::MachineInstr::isVariadic</a></div><div class="ttdeci">bool isVariadic(QueryType Type=IgnoreBundle) const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00328">MachineInstr.h:328</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionPass_html"><div class="ttname"><a href="classllvm_1_1FunctionPass.html">llvm::FunctionPass</a></div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00293">Pass.h:293</a></div></div>
<div class="ttc" id="LiveRegUnits_8h_html"><div class="ttname"><a href="LiveRegUnits_8h.html">LiveRegUnits.h</a></div></div>
<div class="ttc" id="Target_2SystemZ_2README_8txt_html_a4c482947c920572e8a1aff348c7cb5cc"><div class="ttname"><a href="Target_2SystemZ_2README_8txt.html#a4c482947c920572e8a1aff348c7cb5cc">force</a></div><div class="ttdeci">therefore end up llgh r3 lr r0 br r14 but truncating the load would lh r3 br r14 Functions ret i64 and ought to be implemented ngr r0 br r14 but two address optimisations reverse the order of the AND and force</div><div class="ttdoc">Force register rx into domain. </div><div class="ttdef"><b>Definition:</b> <a href="Target_2SystemZ_2README_8txt_source.html#l00106">Target/SystemZ/README.txt:106</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a6321b189ea8fd5058663f8a87d6c23e9"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a6321b189ea8fd5058663f8a87d6c23e9">llvm::MachineBasicBlock::succ_begin</a></div><div class="ttdeci">succ_iterator succ_begin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00276">MachineBasicBlock.h:276</a></div></div>
<div class="ttc" id="classllvm_1_1TargetRegisterInfo_html"><div class="ttname"><a href="classllvm_1_1TargetRegisterInfo.html">llvm::TargetRegisterInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetRegisterInfo_8h_source.html#l00219">TargetRegisterInfo.h:219</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_ab644fcf07a4c2708333cf66276282357"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ab644fcf07a4c2708333cf66276282357">llvm::MachineBasicBlock::pred_begin</a></div><div class="ttdeci">pred_iterator pred_begin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00260">MachineBasicBlock.h:260</a></div></div>
<div class="ttc" id="classT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="classllvm_1_1ReversePostOrderTraversal_html_aa447608e2881e813215c3f289496c6ea"><div class="ttname"><a href="classllvm_1_1ReversePostOrderTraversal.html#aa447608e2881e813215c3f289496c6ea">llvm::ReversePostOrderTraversal::rpo_iterator</a></div><div class="ttdeci">std::vector&lt; NodeType * &gt;::reverse_iterator rpo_iterator</div><div class="ttdef"><b>Definition:</b> <a href="PostOrderIterator_8h_source.html#l00266">PostOrderIterator.h:266</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a502516f71f7824d46325d30ea41f34ba"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a502516f71f7824d46325d30ea41f34ba">llvm::MachineBasicBlock::const_pred_iterator</a></div><div class="ttdeci">std::vector&lt; MachineBasicBlock * &gt;::const_iterator const_pred_iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00248">MachineBasicBlock.h:248</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00029">Target/README.txt:29</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html"><div class="ttname"><a href="classllvm_1_1MachineOperand.html">llvm::MachineOperand</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00043">MachineOperand.h:43</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00880">SmallVector.h:880</a></div></div>
<div class="ttc" id="namespacellvm_html_a7def58200ca2d0319f4ac3d42fcccae0"><div class="ttname"><a href="namespacellvm.html#a7def58200ca2d0319f4ac3d42fcccae0">llvm::createExecutionDependencyFixPass</a></div><div class="ttdeci">FunctionPass * createExecutionDependencyFixPass(const TargetRegisterClass *RC)</div><div class="ttdef"><b>Definition:</b> <a href="ExecutionDepsFix_8cpp_source.html#l00796">ExecutionDepsFix.cpp:796</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_a8de7d5cf38939044471c6ee60a01a3df"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a8de7d5cf38939044471c6ee60a01a3df">llvm::MachineOperand::isDef</a></div><div class="ttdeci">bool isDef() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00274">MachineOperand.h:274</a></div></div>
<div class="ttc" id="classllvm_1_1SpecificBumpPtrAllocator_html"><div class="ttname"><a href="classllvm_1_1SpecificBumpPtrAllocator.html">llvm::SpecificBumpPtrAllocator</a></div><div class="ttdef"><b>Definition:</b> <a href="Allocator_8h_source.html#l00190">Allocator.h:190</a></div></div>
<div class="ttc" id="namespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs - Return a circular-buffered debug stream. </div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00101">Debug.cpp:101</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_afe8cc12d0d0c28bd5b1c8aedbc4e0040"><div class="ttname"><a href="Target_2README_8txt.html#afe8cc12d0d0c28bd5b1c8aedbc4e0040">available</a></div><div class="ttdeci">This requires reassociating to forms of expressions that are already available</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00092">Target/README.txt:92</a></div></div>
<div class="ttc" id="classllvm_1_1TargetRegisterClass_html_afca05003ab96838dace0b075e176f731"><div class="ttname"><a href="classllvm_1_1TargetRegisterClass.html#afca05003ab96838dace0b075e176f731">llvm::TargetRegisterClass::getNumRegs</a></div><div class="ttdeci">unsigned getNumRegs() const </div><div class="ttdef"><b>Definition:</b> <a href="TargetRegisterInfo_8h_source.html#l00066">TargetRegisterInfo.h:66</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html_af22b06a6a4f9df80454071685a0d6a02"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#af22b06a6a4f9df80454071685a0d6a02">llvm::AnalysisUsage::setPreservesAll</a></div><div class="ttdeci">void setPreservesAll()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00094">PassAnalysisSupport.h:94</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a8a045d250952c0867382a9840ee18fdf"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">llvm::SmallVectorTemplateCommon::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00112">SmallVector.h:112</a></div></div>
<div class="ttc" id="MachineRegisterInfo_8h_html"><div class="ttname"><a href="MachineRegisterInfo_8h.html">MachineRegisterInfo.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html"><div class="ttname"><a href="classllvm_1_1MachineInstr.html">llvm::MachineInstr</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00050">MachineInstr.h:50</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunctionPass_html_aa1eece37d175f86a6f4808c0c167f13b"><div class="ttname"><a href="classllvm_1_1MachineFunctionPass.html#aa1eece37d175f86a6f4808c0c167f13b">llvm::MachineFunctionPass::getAnalysisUsage</a></div><div class="ttdeci">virtual void getAnalysisUsage(AnalysisUsage &amp;AU) const </div><div class="ttdef"><b>Definition:</b> <a href="MachineFunctionPass_8cpp_source.html#l00036">MachineFunctionPass.cpp:36</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_a57bf9ee7219097ff0f98da23a3b3b782"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a57bf9ee7219097ff0f98da23a3b3b782">llvm::MachineOperand::isUse</a></div><div class="ttdeci">bool isUse() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00269">MachineOperand.h:269</a></div></div>
<div class="ttc" id="MD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00054">MD5.cpp:54</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_ab2d91e7bec944efcbc39d8e30644f111"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">llvm::MachineBasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00236">MachineBasicBlock.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1LiveRegUnits_html"><div class="ttname"><a href="classllvm_1_1LiveRegUnits.html">llvm::LiveRegUnits</a></div><div class="ttdef"><b>Definition:</b> <a href="LiveRegUnits_8h_source.html#l00031">LiveRegUnits.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_ab75f703d251cc0ce0206fe00a999db86"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">llvm::MachineOperand::getReg</a></div><div class="ttdeci">unsigned getReg() const </div><div class="ttdoc">getReg - Returns the register number. </div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00259">MachineOperand.h:259</a></div></div>
<div class="ttc" id="classllvm_1_1HexagonInstrInfo_html_a768d8c24067887bc878ddedbf5ab701a"><div class="ttname"><a href="classllvm_1_1HexagonInstrInfo.html#a768d8c24067887bc878ddedbf5ab701a">llvm::HexagonInstrInfo::getRegisterInfo</a></div><div class="ttdeci">virtual const HexagonRegisterInfo &amp; getRegisterInfo() const </div><div class="ttdef"><b>Definition:</b> <a href="HexagonInstrInfo_8h_source.html#l00041">HexagonInstrInfo.h:41</a></div></div>
<div class="ttc" id="classllvm_1_1ReversePostOrderTraversal_html_ae945899e1218a9240c3fed1e5789cbba"><div class="ttname"><a href="classllvm_1_1ReversePostOrderTraversal.html#ae945899e1218a9240c3fed1e5789cbba">llvm::ReversePostOrderTraversal::end</a></div><div class="ttdeci">rpo_iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="PostOrderIterator_8h_source.html#l00274">PostOrderIterator.h:274</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a6198e2abdd4f41355b1a0931affde1a6"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a6198e2abdd4f41355b1a0931affde1a6">llvm::MachineBasicBlock::const_succ_iterator</a></div><div class="ttdeci">std::vector&lt; MachineBasicBlock * &gt;::const_iterator const_succ_iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00250">MachineBasicBlock.h:250</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a0848c971395758cf592821550b725853"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a0848c971395758cf592821550b725853">llvm::MachineBasicBlock::reverse_iterator</a></div><div class="ttdeci">std::reverse_iterator&lt; iterator &gt; reverse_iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00216">MachineBasicBlock.h:216</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00066">Value.h:66</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_a0037ac891190e1408b04a48156c3368c"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a0037ac891190e1408b04a48156c3368c">llvm::MachineInstr::operands_begin</a></div><div class="ttdeci">mop_iterator operands_begin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00284">MachineInstr.h:284</a></div></div>
<div class="ttc" id="PostOrderIterator_8h_html"><div class="ttname"><a href="PostOrderIterator_8h.html">PostOrderIterator.h</a></div></div>
<div class="ttc" id="classllvm_1_1MCInstrDesc_html_a55194ec3a1e49d04eab64e993e614246"><div class="ttname"><a href="classllvm_1_1MCInstrDesc.html#a55194ec3a1e49d04eab64e993e614246">llvm::MCInstrDesc::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const </div><div class="ttdoc">Return the number of declared MachineOperands for this MachineInstruction. Note that variadic (isVari...</div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00190">MCInstrDesc.h:190</a></div></div>
<div class="ttc" id="MachineFunctionPass_8h_html"><div class="ttname"><a href="MachineFunctionPass_8h.html">MachineFunctionPass.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">llvm::A64CC::MI</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00035">AArch64BaseInfo.h:35</a></div></div>
<div class="ttc" id="Debug_8h_html_aef41e8aaf4c60819b30faf396cdf4978"><div class="ttname"><a href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a></div><div class="ttdeci">#define DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00097">Debug.h:97</a></div></div>
<div class="ttc" id="namespacellvm_html_af4d1a918800291e75b01ce1447be0e83"><div class="ttname"><a href="namespacellvm.html#af4d1a918800291e75b01ce1447be0e83">llvm::isPowerOf2_32</a></div><div class="ttdeci">bool isPowerOf2_32(uint32_t Value)</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00354">MathExtras.h:354</a></div></div>
<div class="ttc" id="raw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="CodeGen_2Passes_8h_html"><div class="ttname"><a href="CodeGen_2Passes_8h.html">Passes.h</a></div></div>
<div class="ttc" id="Target_2ARM_2README_8txt_html_a90cca76dd78688687e0d697679dbc799"><div class="ttname"><a href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional ldr LCPI1_0 ldr ldr tst movne lsr ldr LCPI1_1 and r0 bx lr it saves an instruction and a register It might be profitable to cse MOVi16 if there are lots of bit immediates with the same bottom half Robert Muth started working on an alternate jump table implementation that does not put the tables in line in the text This is more like the llvm default jump table implementation This might be useful sometime Several revisions of patches are on the mailing beginning while CMP sets them like a subtract Therefore to be able to use CMN for comparisons other than the Z we ll need additional logic to reverse the conditionals associated with the comparison Perhaps a pseudo instruction for the with a post codegen pass to clean up and handle the condition codes See PR5694 for testcase Given the following on int B</div><div class="ttdef"><b>Definition:</b> <a href="Target_2ARM_2README_8txt_source.html#l00592">Target/ARM/README.txt:592</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<p class="footer">
Generated on Sat Nov 10 2018 22:58:39 for <a href="http://llvm.org/">LLVM</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.8.11</a><br>
Copyright &copy; 2003-2013 University of Illinois at Urbana-Champaign.
All Rights Reserved.</p>
<hr>
<!--#include virtual="/attrib.incl" -->
</body>
</html>
