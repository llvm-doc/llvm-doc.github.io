<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="LLVM,Low Level Virtual Machine,C++,doxygen,API,documentation"/>
<meta name="description" content="C++ source code API documentation for LLVM."/>
<title>LLVM: MachineBlockPlacement.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">LLVM API Documentation</p>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('MachineBlockPlacement_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MachineBlockPlacement.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="MachineBlockPlacement_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===-- MachineBlockPlacement.cpp - Basic Block Code Layout optimization --===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                     The LLVM Compiler Infrastructure</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is distributed under the University of Illinois Open Source</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License. See LICENSE.TXT for details.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// This file implements basic block placement transformations using the CFG</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// structure and branch probability estimates.</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// The pass strives to preserve the structure of the CFG (that is, retain</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// a topological ordering of basic blocks) in the absence of a *strong* signal</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// to the contrary from probabilities. However, within the CFG structure, it</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// attempts to choose an ordering which favors placing more likely sequences of</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// blocks adjacent to each other.</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">// The algorithm works from the inner-most loop within a function outward, and</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">// at each stage walks through the basic blocks, trying to coalesce them into</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">// sequential chains where allowed by the CFG (or demanded by heavy</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">// probabilities). Finally, it walks the blocks in topological order, and the</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">// first time it reaches a chain of basic blocks, it schedules them in the</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">// function in-order.</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="MachineBlockPlacement_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   28</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;block-placement2&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CodeGen_2Passes_8h.html">llvm/CodeGen/Passes.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseMap_8h.html">llvm/ADT/DenseMap.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallPtrSet_8h.html">llvm/ADT/SmallPtrSet.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallVector_8h.html">llvm/ADT/SmallVector.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineBasicBlock_8h.html">llvm/CodeGen/MachineBasicBlock.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineBlockFrequencyInfo_8h.html">llvm/CodeGen/MachineBlockFrequencyInfo.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineBranchProbabilityInfo_8h.html">llvm/CodeGen/MachineBranchProbabilityInfo.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineFunction_8h.html">llvm/CodeGen/MachineFunction.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineFunctionPass_8h.html">llvm/CodeGen/MachineFunctionPass.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineLoopInfo_8h.html">llvm/CodeGen/MachineLoopInfo.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineModuleInfo_8h.html">llvm/CodeGen/MachineModuleInfo.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Allocator_8h.html">llvm/Support/Allocator.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetInstrInfo_8h.html">llvm/Target/TargetInstrInfo.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetLowering_8h.html">llvm/Target/TargetLowering.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<a class="code" href="MachineBlockPlacement_8cpp.html#a2e264c893cf4976155fc4f96f947d7cf">STATISTIC</a>(NumCondBranches, <span class="stringliteral">&quot;Number of conditional branches&quot;</span>);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<a class="code" href="MachineBlockPlacement_8cpp.html#a2e264c893cf4976155fc4f96f947d7cf">STATISTIC</a>(NumUncondBranches, <span class="stringliteral">&quot;Number of uncondittional branches&quot;</span>);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<a class="code" href="MachineBlockPlacement_8cpp.html#a2e264c893cf4976155fc4f96f947d7cf">STATISTIC</a>(CondBranchTakenFreq,</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;          <span class="stringliteral">&quot;Potential frequency of taking conditional branches&quot;</span>);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<a class="code" href="MachineBlockPlacement_8cpp.html#a2e264c893cf4976155fc4f96f947d7cf">STATISTIC</a>(UncondBranchTakenFreq,</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;          <span class="stringliteral">&quot;Potential frequency of taking unconditional branches&quot;</span>);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a> <a class="code" href="MachineBlockPlacement_8cpp.html#ae1420a70bd9f672063a1922566794c9c">AlignAllBlock</a>(<span class="stringliteral">&quot;align-all-blocks&quot;</span>,</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                                       <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Force the alignment of all &quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                                                <span class="stringliteral">&quot;blocks in the function.&quot;</span>),</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                                       <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(0), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keyword">class </span>BlockChain;<span class="comment"></span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">/// \brief Type for our function-wide basic block -&gt; block chain mapping.</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment"></span><span class="keyword">typedef</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;MachineBasicBlock *, BlockChain *&gt;</a> BlockToChainMapType;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;}</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">/// \brief A chain of blocks which will be laid out contiguously.</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">/// This is the datastructure representing a chain of consecutive blocks that</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">/// are profitable to layout together in order to maximize fallthrough</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">/// probabilities and code locality. We also can use a block chain to represent</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">/// a sequence of basic blocks which have some external (correctness)</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">/// requirement for sequential layout.</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">/// Chains can be built around a single basic block and can be merged to grow</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">/// them. They participate in a block-to-chain mapping, which is updated</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">/// automatically as chains are merged together.</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"></span><span class="keyword">class </span>BlockChain {<span class="comment"></span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">  /// \brief The sequence of blocks belonging to this chain.</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">  /// This is the sequence of blocks for a particular chain. These will be laid</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">  /// out in-order within the function.</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MachineBasicBlock *, 4&gt;</a> Blocks;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">  /// \brief A handle to the function-wide basic block to block chain mapping.</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">  /// This is retained in each block chain to simplify the computation of child</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">  /// block chains for SCC-formation and iteration. We store the edges to child</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">  /// basic blocks, and map them back to their associated chains using this</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">  /// structure.</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"></span>  BlockToChainMapType &amp;BlockToChain;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="keyword">public</span>:<span class="comment"></span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">  /// \brief Construct a new BlockChain.</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">  /// This builds a new block chain representing a single basic block in the</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">  /// function. It also registers itself as the chain that block participates</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">  /// in with the BlockToChain mapping.</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"></span>  BlockChain(BlockToChainMapType &amp;BlockToChain, <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    : Blocks(1, BB), BlockToChain(BlockToChain), LoopPredecessors(0) {</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    assert(BB &amp;&amp; <span class="stringliteral">&quot;Cannot create a chain with a null basic block&quot;</span>);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    BlockToChain[<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>] = <span class="keyword">this</span>;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  }</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">  /// \brief Iterator over blocks within the chain.</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"></span>  <span class="keyword">typedef</span> <a class="code" href="classT.html">SmallVectorImpl&lt;MachineBasicBlock *&gt;::iterator</a> iterator;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">  /// \brief Beginning of blocks within the chain.</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"></span>  iterator <a class="code" href="namespacellvm_1_1sys_1_1path.html#a33706aab89e700b8f79e1fa6f4f0e3ee">begin</a>() { <span class="keywordflow">return</span> Blocks.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(); }</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">  /// \brief End of blocks within the chain.</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment"></span>  iterator <a class="code" href="namespacellvm_1_1sys_1_1path.html#a214ec2f04ffd92636ed4bd2717607a1d">end</a>() { <span class="keywordflow">return</span> Blocks.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">  /// \brief Merge a block chain into this one.</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">  /// This routine merges a block chain into this one. It takes care of forming</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">  /// a contiguous sequence of basic blocks, updating the edge list, and</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">  /// updating the block -&gt; chain mapping. It does not free or tear down the</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">  /// old chain, but the old chain&#39;s block list is no longer valid.</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> merge(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, BlockChain *Chain) {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    assert(BB);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    assert(!Blocks.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>());</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// Fast path in case we don&#39;t have a chain already.</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">if</span> (!Chain) {</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      assert(!BlockToChain[BB]);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      Blocks.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(BB);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      BlockToChain[<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>] = <span class="keyword">this</span>;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    }</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    assert(BB == *Chain-&gt;begin());</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    assert(Chain-&gt;begin() != Chain-&gt;end());</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// Update the incoming blocks to point to this chain, and add them to the</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">// chain structure.</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classT.html">BlockChain::iterator</a> BI = Chain-&gt;begin(), BE = Chain-&gt;end();</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;         BI != BE; ++BI) {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      Blocks.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(*BI);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      assert(BlockToChain[*BI] == Chain &amp;&amp; <span class="stringliteral">&quot;Incoming blocks not in chain&quot;</span>);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      BlockToChain[*BI] = <span class="keyword">this</span>;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">  /// \brief Dump the blocks in this chain.</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>() <a class="code" href="Compiler_8h.html#a6881c00738b22a600dfee25a1c32dab3">LLVM_ATTRIBUTE_USED</a> {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">for</span> (iterator <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm_1_1sys_1_1path.html#a33706aab89e700b8f79e1fa6f4f0e3ee">begin</a>(), E = <a class="code" href="namespacellvm_1_1sys_1_1path.html#a214ec2f04ffd92636ed4bd2717607a1d">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      (*I)-&gt;dump();</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">#endif // NDEBUG</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">  /// \brief Count of predecessors within the loop currently being processed.</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">  /// This count is updated at each loop we process to represent the number of</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">  /// in-loop predecessors of this chain.</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment"></span>  <span class="keywordtype">unsigned</span> LoopPredecessors;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;};</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;}</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="keyword">class </span>MachineBlockPlacement : <span class="keyword">public</span> <a class="code" href="classllvm_1_1MachineFunctionPass.html">MachineFunctionPass</a> {<span class="comment"></span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">  /// \brief A typedef for a block filter set.</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment"></span>  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;MachineBasicBlock *, 16&gt;</a> BlockFilterSet;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">  /// \brief A handle to the branch probability pass.</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineBranchProbabilityInfo.html">MachineBranchProbabilityInfo</a> *MBPI;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">  /// \brief A handle to the function-wide block frequency pass.</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineBlockFrequencyInfo.html">MachineBlockFrequencyInfo</a> *MBFI;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">  /// \brief A handle to the loop info.</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineLoopInfo.html">MachineLoopInfo</a> *MLI;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">  /// \brief A handle to the target&#39;s instruction info.</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetInstrInfo.html">TargetInstrInfo</a> *<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">  /// \brief A handle to the target&#39;s lowering info.</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLoweringBase.html">TargetLoweringBase</a> *TLI;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">  /// \brief Allocator and owner of BlockChain structures.</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">  /// We build BlockChains lazily while processing the loop structure of</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">  /// a function. To reduce malloc traffic, we allocate them using this</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">  /// slab-like allocator, and destroy them after the pass completes. An</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">  /// important guarantee is that this allocator produces stable pointers to</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">  /// the chains.</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SpecificBumpPtrAllocator.html">SpecificBumpPtrAllocator&lt;BlockChain&gt;</a> ChainAllocator;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">  /// \brief Function wide BasicBlock to BlockChain mapping.</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">  /// This mapping allows efficiently moving from any given basic block to the</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">  /// BlockChain it participates in, if any. We use it to, among other things,</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">  /// allow implicitly defining edges between chains as the existing edges</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">  /// between basic blocks.</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;MachineBasicBlock *, BlockChain *&gt;</a> BlockToChain;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordtype">void</span> markChainSuccessors(BlockChain &amp;Chain,</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                           <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *LoopHeaderBB,</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                           <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;MachineBasicBlock *&gt;</a> &amp;BlockWorkList,</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                           <span class="keyword">const</span> BlockFilterSet *BlockFilter = 0);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *selectBestSuccessor(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BB,</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                                         BlockChain &amp;Chain,</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                                         <span class="keyword">const</span> BlockFilterSet *BlockFilter);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *selectBestCandidateBlock(</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      BlockChain &amp;Chain, <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;MachineBasicBlock *&gt;</a> &amp;WorkList,</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keyword">const</span> BlockFilterSet *BlockFilter);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *getFirstUnplacedBlock(</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>,</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="keyword">const</span> BlockChain &amp;PlacedChain,</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> &amp;PrevUnplacedBlockIt,</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      <span class="keyword">const</span> BlockFilterSet *BlockFilter);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keywordtype">void</span> buildChain(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BB, BlockChain &amp;Chain,</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;MachineBasicBlock *&gt;</a> &amp;BlockWorkList,</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                  <span class="keyword">const</span> BlockFilterSet *BlockFilter = 0);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *findBestLoopTop(<a class="code" href="classllvm_1_1MachineLoop.html">MachineLoop</a> &amp;L,</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                                     <span class="keyword">const</span> BlockFilterSet &amp;LoopBlockSet);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *findBestLoopExit(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>,</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                                      <a class="code" href="classllvm_1_1MachineLoop.html">MachineLoop</a> &amp;L,</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                                      <span class="keyword">const</span> BlockFilterSet &amp;LoopBlockSet);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordtype">void</span> buildLoopChains(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>, <a class="code" href="classllvm_1_1MachineLoop.html">MachineLoop</a> &amp;L);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordtype">void</span> rotateLoop(BlockChain &amp;LoopChain, <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *ExitingBB,</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                  <span class="keyword">const</span> BlockFilterSet &amp;LoopBlockSet);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordtype">void</span> buildCFGChains(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a>; <span class="comment">// Pass identification, replacement for typeid</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  MachineBlockPlacement() : <a class="code" href="classllvm_1_1MachineFunctionPass.html">MachineFunctionPass</a>(ID) {</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <a class="code" href="namespacellvm.html#af3e08655b0654029c7cf037651c8d7d6">initializeMachineBlockPlacementPass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordtype">bool</span> runOnMachineFunction(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const </span>{</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1MachineBranchProbabilityInfo.html">MachineBranchProbabilityInfo</a>&gt;();</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1MachineBlockFrequencyInfo.html">MachineBlockFrequencyInfo</a>&gt;();</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1MachineLoopInfo.html">MachineLoopInfo</a>&gt;();</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="classllvm_1_1MachineFunctionPass.html#aa1eece37d175f86a6f4808c0c167f13b">MachineFunctionPass::getAnalysisUsage</a>(AU);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;};</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;}</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">MachineBlockPlacement::ID</a> = 0;</div><div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="namespacellvm.html#adc14e69cab3ee0a21fdfdd40632b7ee1">  245</a></span>&#160;<span class="keywordtype">char</span> &amp;<a class="code" href="namespacellvm.html#adc14e69cab3ee0a21fdfdd40632b7ee1">llvm::MachineBlockPlacementID</a> = <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">MachineBlockPlacement::ID</a>;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<a class="code" href="MachineBlockPlacement_8cpp.html#ad499caec96089f300df66d7070e754ed">INITIALIZE_PASS_BEGIN</a>(MachineBlockPlacement, <span class="stringliteral">&quot;block-placement2&quot;</span>,</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                      <span class="stringliteral">&quot;Branch Probability Basic Block Placement&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<a class="code" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1MachineBranchProbabilityInfo.html">MachineBranchProbabilityInfo</a>)</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<a class="code" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1MachineBlockFrequencyInfo.html">MachineBlockFrequencyInfo</a>)</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<a class="code" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1MachineLoopInfo.html">MachineLoopInfo</a>)</div><div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="MachineBlockPlacement_8cpp.html#a394ba4b4bfba86da3410230b136ed90b">  251</a></span>&#160;<a class="code" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(MachineBlockPlacement, &quot;<a class="code" href="README__ALTIVEC_8txt.html#a3fd74718101152ceb7850d4a8bbe1391">block</a>-<a class="code" href="MachineBlockPlacement_8cpp.html#a394ba4b4bfba86da3410230b136ed90b">placement2</a>&quot;,</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                    &quot;<a class="code" href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba359237c780f7c8e40645575826da8a3c">Branch</a> Probability Basic Block <a class="code" href="MachineBlockPlacement_8cpp.html#a80e0b1823bee9dff0d9cbc44bc76b701">Placement</a>&quot;, <a class="code" href="namespacefalse.html">false</a>, false)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">/// \brief Helper to print the name of a MBB.</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment"></span><span class="comment">///</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment"></span><span class="comment">/// Only used by debug logging.</span></div><div class="line"><a name="l00258"></a><span class="lineno"><a class="line" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">  258</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> std::string <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BB) {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  std::string Result;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <a class="code" href="classllvm_1_1raw__string__ostream.html">raw_string_ostream</a> OS(Result);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  OS &lt;&lt; <span class="stringliteral">&quot;BB#&quot;</span> &lt;&lt; BB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; (derived from LLVM BB &#39;&quot;</span> &lt;&lt; BB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a454838c989e99a86bd804e056c367bd9">getName</a>() &lt;&lt; <span class="stringliteral">&quot;&#39;)&quot;</span>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  OS.<a class="code" href="classllvm_1_1raw__ostream.html#a520bdf57dfe3e73abb53d482893f0a27">flush</a>();</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordflow">return</span> Result;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;}</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">/// \brief Helper to print the number of a MBB.</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">/// Only used by debug logging.</span></div><div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="MachineBlockPlacement_8cpp.html#a16e802f1d512b19481a50b0e7d71eab5">  270</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> std::string <a class="code" href="MachineBlockPlacement_8cpp.html#a16e802f1d512b19481a50b0e7d71eab5">getBlockNum</a>(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BB) {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  std::string Result;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <a class="code" href="classllvm_1_1raw__string__ostream.html">raw_string_ostream</a> OS(Result);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  OS &lt;&lt; <span class="stringliteral">&quot;BB#&quot;</span> &lt;&lt; BB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>();</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  OS.<a class="code" href="classllvm_1_1raw__ostream.html#a520bdf57dfe3e73abb53d482893f0a27">flush</a>();</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keywordflow">return</span> Result;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">/// \brief Mark a chain&#39;s successors as having one fewer preds.</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">/// When a chain is being merged into the &quot;placed&quot; chain, this routine will</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">/// quickly walk the successors of each block in the chain and mark them as</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">/// having one fewer active predecessor. It also adds any successors of this</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">/// chain which reach the zero-predecessor state to the worklist passed in.</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> MachineBlockPlacement::markChainSuccessors(</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    BlockChain &amp;Chain,</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *LoopHeaderBB,</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;MachineBasicBlock *&gt;</a> &amp;BlockWorkList,</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keyword">const</span> BlockFilterSet *BlockFilter) {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="comment">// Walk all the blocks in this chain, marking their successors as having</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="comment">// a predecessor placed.</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classT.html">BlockChain::iterator</a> CBI = Chain.begin(), CBE = Chain.end();</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;       CBI != CBE; ++CBI) {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="comment">// Add any successors for which this is the only un-placed in-loop</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="comment">// predecessor to the worklist as a viable candidate for CFG-neutral</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">// placement. No subsequent placement of this block will violate the CFG</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">// shape, so we get to use heuristics to choose a favorable placement.</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#aefba5f2af370add1bc8aaceedf7878ef">MachineBasicBlock::succ_iterator</a> SI = (*CBI)-&gt;succ_begin(),</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                                          SE = (*CBI)-&gt;succ_end();</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;         SI != SE; ++SI) {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="keywordflow">if</span> (BlockFilter &amp;&amp; !BlockFilter-&gt;count(*SI))</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      BlockChain &amp;SuccChain = *BlockToChain[*SI];</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="comment">// Disregard edges within a fixed chain, or edges to the loop header.</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="keywordflow">if</span> (&amp;Chain == &amp;SuccChain || *SI == LoopHeaderBB)</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="comment">// This is a cross-chain edge that is within the loop, so decrement the</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="comment">// loop predecessor count of the destination chain.</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keywordflow">if</span> (SuccChain.LoopPredecessors &gt; 0 &amp;&amp; --SuccChain.LoopPredecessors == 0)</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        BlockWorkList.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(*SuccChain.begin());</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    }</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">/// \brief Select the best successor for a block.</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">/// This looks across all successors of a particular block and attempts to</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">/// select the &quot;best&quot; one to be the layout successor. It only considers direct</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">/// successors which also pass the block filter. It will attempt to avoid</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">/// breaking CFG structure, but cave and break such structures in the case of</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">/// very hot successor edges.</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">/// \returns The best successor block found, or null if none are viable.</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MachineBlockPlacement::selectBestSuccessor(</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BB, BlockChain &amp;Chain,</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keyword">const</span> BlockFilterSet *BlockFilter) {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1BranchProbability.html">BranchProbability</a> HotProb(4, 5); <span class="comment">// 80%</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BestSucc = 0;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="comment">// FIXME: Due to the performance of the probability and weight routines in</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="comment">// the MBPI analysis, we manually compute probabilities using the edge</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="comment">// weights. This is suboptimal as it means that the somewhat subtle</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="comment">// definition of edge weight semantics is encoded here as well. We should</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="comment">// improve the MBPI interface to efficiently support query patterns such as</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="comment">// this.</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  uint32_t BestWeight = 0;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  uint32_t WeightScale = 0;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  uint32_t SumWeight = MBPI-&gt;getSumForBlock(BB, WeightScale);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Attempting merge from: &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(BB) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#aefba5f2af370add1bc8aaceedf7878ef">MachineBasicBlock::succ_iterator</a> SI = BB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6321b189ea8fd5058663f8a87d6c23e9">succ_begin</a>(),</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                                        SE = BB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3ddd708642d60c1661992ff8ba1b215d">succ_end</a>();</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;       SI != SE; ++SI) {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">if</span> (BlockFilter &amp;&amp; !BlockFilter-&gt;count(*SI))</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    BlockChain &amp;SuccChain = *BlockToChain[*SI];</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">if</span> (&amp;SuccChain == &amp;Chain) {</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;    &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*SI) &lt;&lt; <span class="stringliteral">&quot; -&gt; Already merged!\n&quot;</span>);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    }</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">if</span> (*SI != *SuccChain.begin()) {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;    &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*SI) &lt;&lt; <span class="stringliteral">&quot; -&gt; Mid chain!\n&quot;</span>);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    }</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    uint32_t SuccWeight = MBPI-&gt;getEdgeWeight(BB, *SI);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <a class="code" href="classllvm_1_1BranchProbability.html">BranchProbability</a> SuccProb(SuccWeight / WeightScale, SumWeight);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">// Only consider successors which are either &quot;hot&quot;, or wouldn&#39;t violate</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">// any CFG constraints.</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">if</span> (SuccChain.LoopPredecessors != 0) {</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="keywordflow">if</span> (SuccProb &lt; HotProb) {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;    &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*SI) &lt;&lt; <span class="stringliteral">&quot; -&gt; CFG conflict\n&quot;</span>);</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="comment">// Make sure that a hot successor doesn&#39;t have a globally more important</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="comment">// predecessor.</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> CandidateEdgeFreq</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        = MBFI-&gt;getBlockFreq(BB) * SuccProb * HotProb.<a class="code" href="classllvm_1_1BranchProbability.html#abdacde00feddf9907be65c48669c98e6">getCompl</a>();</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="keywordtype">bool</span> BadCFGConflict = <span class="keyword">false</span>;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#a7e7a1a247b7725a24fe19a91f90782cc">MachineBasicBlock::pred_iterator</a> PI = (*SI)-&gt;pred_begin(),</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                                            PE = (*SI)-&gt;pred_end();</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;           PI != PE; ++PI) {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="keywordflow">if</span> (*PI == *SI || (BlockFilter &amp;&amp; !BlockFilter-&gt;count(*PI)) ||</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            BlockToChain[*PI] == &amp;Chain)</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> PredEdgeFreq</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;          = MBFI-&gt;getBlockFreq(*PI) * MBPI-&gt;getEdgeProbability(*PI, *SI);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="keywordflow">if</span> (PredEdgeFreq &gt;= CandidateEdgeFreq) {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;          BadCFGConflict = <span class="keyword">true</span>;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        }</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      }</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="keywordflow">if</span> (BadCFGConflict) {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;    &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*SI)</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                               &lt;&lt; <span class="stringliteral">&quot; -&gt; non-cold CFG conflict\n&quot;</span>);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      }</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    }</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;    &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*SI) &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; SuccProb</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; (prob)&quot;</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                 &lt;&lt; (SuccChain.LoopPredecessors != 0 ? <span class="stringliteral">&quot; (CFG break)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">if</span> (BestSucc &amp;&amp; BestWeight &gt;= SuccWeight)</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    BestSucc = *SI;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    BestWeight = SuccWeight;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  }</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keywordflow">return</span> BestSucc;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;}</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">/// \brief Predicate struct to detect blocks already placed.</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment"></span><span class="keyword">class </span>IsBlockPlaced {</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keyword">const</span> BlockChain &amp;PlacedChain;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keyword">const</span> BlockToChainMapType &amp;BlockToChain;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  IsBlockPlaced(<span class="keyword">const</span> BlockChain &amp;PlacedChain,</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                <span class="keyword">const</span> BlockToChainMapType &amp;BlockToChain)</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      : PlacedChain(PlacedChain), BlockToChain(BlockToChain) {}</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordtype">bool</span> operator()(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BB)<span class="keyword"> const </span>{</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">return</span> BlockToChain.lookup(BB) == &amp;PlacedChain;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  }</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;};</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;}</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">/// \brief Select the best block from a worklist.</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">/// This looks through the provided worklist as a list of candidate basic</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">/// blocks and select the most profitable one to place. The definition of</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">/// profitable only really makes sense in the context of a loop. This returns</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">/// the most frequently visited block in the worklist, which in the case of</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">/// a loop, is the one most desirable to be physically close to the rest of the</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">/// loop body in order to improve icache behavior.</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">/// \returns The best block found, or null if none are viable.</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MachineBlockPlacement::selectBestCandidateBlock(</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    BlockChain &amp;Chain, <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;MachineBasicBlock *&gt;</a> &amp;WorkList,</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keyword">const</span> BlockFilterSet *BlockFilter) {</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="comment">// Once we need to walk the worklist looking for a candidate, cleanup the</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="comment">// worklist of already placed entries.</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="comment">// FIXME: If this shows up on profiles, it could be folded (at the cost of</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="comment">// some code complexity) into the loop below.</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  WorkList.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">erase</a>(std::remove_if(WorkList.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), WorkList.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(),</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                                IsBlockPlaced(Chain, BlockToChain)),</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                 WorkList.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>());</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BestBlock = 0;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> BestFreq;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classT.html">SmallVectorImpl&lt;MachineBasicBlock *&gt;::iterator</a> WBI = WorkList.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                                                      WBE = WorkList.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>();</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;       WBI != WBE; ++WBI) {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    BlockChain &amp;SuccChain = *BlockToChain[*WBI];</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">if</span> (&amp;SuccChain == &amp;Chain) {</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;    &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*WBI)</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot; -&gt; Already merged!\n&quot;</span>);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    }</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    assert(SuccChain.LoopPredecessors == 0 &amp;&amp; <span class="stringliteral">&quot;Found CFG-violating block&quot;</span>);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> CandidateFreq = MBFI-&gt;getBlockFreq(*WBI);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;    &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*WBI) &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; CandidateFreq</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; (freq)\n&quot;</span>);</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">if</span> (BestBlock &amp;&amp; BestFreq &gt;= CandidateFreq)</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    BestBlock = *WBI;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    BestFreq = CandidateFreq;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  }</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="keywordflow">return</span> BestBlock;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;}</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">/// \brief Retrieve the first unplaced basic block.</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">/// This routine is called when we are unable to use the CFG to walk through</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">/// all of the basic blocks and form a chain due to unnatural loops in the CFG.</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">/// We walk through the function&#39;s blocks in order, starting from the</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">/// LastUnplacedBlockIt. We update this iterator on each call to avoid</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">/// re-scanning the entire sequence on repeated calls to this routine.</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MachineBlockPlacement::getFirstUnplacedBlock(</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>, <span class="keyword">const</span> BlockChain &amp;PlacedChain,</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> &amp;PrevUnplacedBlockIt,</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keyword">const</span> BlockFilterSet *BlockFilter) {</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = PrevUnplacedBlockIt, E = F.<a class="code" href="classllvm_1_1MachineFunction.html#a9d017af749f76484cb9aec9ff6e4330c">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;       ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">if</span> (BlockFilter &amp;&amp; !BlockFilter-&gt;count(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">if</span> (BlockToChain[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] != &amp;PlacedChain) {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      PrevUnplacedBlockIt = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="comment">// Now select the head of the chain to which the unplaced block belongs</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="comment">// as the block to place. This will force the entire chain to be placed,</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      <span class="comment">// and satisfies the requirements of merging chains.</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <span class="keywordflow">return</span> *BlockToChain[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]-&gt;begin();</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    }</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  }</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;}</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="keywordtype">void</span> MachineBlockPlacement::buildChain(</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BB,</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    BlockChain &amp;Chain,</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;MachineBasicBlock *&gt;</a> &amp;BlockWorkList,</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keyword">const</span> BlockFilterSet *BlockFilter) {</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  assert(BB);</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  assert(BlockToChain[BB] == &amp;Chain);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;F = *BB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#af2e482ff2a9253ec6bc2285491496bd6">getParent</a>();</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> PrevUnplacedBlockIt = F.<a class="code" href="classllvm_1_1MachineFunction.html#ab0789854909cf47f640a85fa2bac29c7">begin</a>();</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *LoopHeaderBB = <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  markChainSuccessors(Chain, LoopHeaderBB, BlockWorkList, BlockFilter);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  BB = *<a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(Chain.end());</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    assert(BB);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    assert(BlockToChain[BB] == &amp;Chain);</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    assert(*<a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(Chain.end()) == BB);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="comment">// Look for the best viable successor if there is one to place immediately</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="comment">// after this block.</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BestSucc = selectBestSuccessor(BB, Chain, BlockFilter);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="comment">// If an immediate successor isn&#39;t available, look for the best viable</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="comment">// block among those we&#39;ve identified as not violating the loop&#39;s CFG at</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="comment">// this point. This won&#39;t be a fallthrough, but it will increase locality.</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordflow">if</span> (!BestSucc)</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      BestSucc = selectBestCandidateBlock(Chain, BlockWorkList, BlockFilter);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">if</span> (!BestSucc) {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      BestSucc = getFirstUnplacedBlock(F, Chain, PrevUnplacedBlockIt,</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                                       BlockFilter);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <span class="keywordflow">if</span> (!BestSucc)</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Unnatural loop CFG detected, forcibly merging the &quot;</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                      <span class="stringliteral">&quot;layout successor until the CFG reduces\n&quot;</span>);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    }</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="comment">// Place this block, updating the datastructures to reflect its placement.</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    BlockChain &amp;SuccChain = *BlockToChain[BestSucc];</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="comment">// Zero out LoopPredecessors for the successor we&#39;re about to merge in case</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="comment">// we selected a successor that didn&#39;t fit naturally into the CFG.</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    SuccChain.LoopPredecessors = 0;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Merging from &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a16e802f1d512b19481a50b0e7d71eab5">getBlockNum</a>(BB)</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a16e802f1d512b19481a50b0e7d71eab5">getBlockNum</a>(BestSucc) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    markChainSuccessors(SuccChain, LoopHeaderBB, BlockWorkList, BlockFilter);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    Chain.merge(BestSucc, &amp;SuccChain);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    BB = *<a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(Chain.end());</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  }</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Finished forming chain for header block &quot;</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;               &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a16e802f1d512b19481a50b0e7d71eab5">getBlockNum</a>(*Chain.begin()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;}</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">/// \brief Find the best loop top block for layout.</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">/// Look for a block which is strictly better than the loop header for laying</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">/// out at the top of the loop. This looks for one and only one pattern:</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">/// a latch block with no conditional exit. This block will cause a conditional</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">/// jump around it or will be the bottom of the loop if we lay it out in place,</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">/// but if it it doesn&#39;t end up at the bottom of the loop for any reason,</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">/// rotation alone won&#39;t fix it. Because such a block will always result in an</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">/// unconditional jump (for the backedge) rotating it in front of the loop</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">/// header is always profitable.</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;MachineBlockPlacement::findBestLoopTop(<a class="code" href="classllvm_1_1MachineLoop.html">MachineLoop</a> &amp;L,</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                                       <span class="keyword">const</span> BlockFilterSet &amp;LoopBlockSet) {</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="comment">// Check that the header hasn&#39;t been fused with a preheader block due to</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="comment">// crazy branches. If it has, we need to start with the header at the top to</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="comment">// prevent pulling the preheader into the loop body.</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  BlockChain &amp;HeaderChain = *BlockToChain[L.<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>()];</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keywordflow">if</span> (!LoopBlockSet.count(*HeaderChain.begin()))</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordflow">return</span> L.<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>();</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Finding best loop top for: &quot;</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;               &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(L.<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> BestPredFreq;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BestPred = 0;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#a7e7a1a247b7725a24fe19a91f90782cc">MachineBasicBlock::pred_iterator</a> PI = L.<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>()-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab644fcf07a4c2708333cf66276282357">pred_begin</a>(),</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                                        PE = L.<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>()-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a0359a738e0412c5a7ea55d61175e0661">pred_end</a>();</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;       PI != PE; ++PI) {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *Pred = *PI;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">if</span> (!LoopBlockSet.count(Pred))</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;    header pred: &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(Pred) &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                 &lt;&lt; Pred-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a9ac05913a143322136efcad10ed7548c">succ_size</a>() &lt;&lt; <span class="stringliteral">&quot; successors, &quot;</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                 &lt;&lt; MBFI-&gt;getBlockFreq(Pred) &lt;&lt; <span class="stringliteral">&quot; freq\n&quot;</span>);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordflow">if</span> (Pred-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a9ac05913a143322136efcad10ed7548c">succ_size</a>() &gt; 1)</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> PredFreq = MBFI-&gt;getBlockFreq(Pred);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">if</span> (!BestPred || PredFreq &gt; BestPredFreq ||</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        (!(PredFreq &lt; BestPredFreq) &amp;&amp;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;         Pred-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a0fc7a349a4ab737607def6cb461791fd">isLayoutSuccessor</a>(L.<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>()))) {</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      BestPred = Pred;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      BestPredFreq = PredFreq;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    }</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="comment">// If no direct predecessor is fine, just use the loop header.</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  <span class="keywordflow">if</span> (!BestPred)</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordflow">return</span> L.<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>();</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="comment">// Walk backwards through any straight line of predecessors.</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="keywordflow">while</span> (BestPred-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ac9786455bc217ebd35377bb5d5ec8f20">pred_size</a>() == 1 &amp;&amp;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;         (*BestPred-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab644fcf07a4c2708333cf66276282357">pred_begin</a>())-&gt;succ_size() == 1 &amp;&amp;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;         *BestPred-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab644fcf07a4c2708333cf66276282357">pred_begin</a>() != L.<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>())</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    BestPred = *BestPred-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab644fcf07a4c2708333cf66276282357">pred_begin</a>();</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;    final top: &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(BestPred) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="keywordflow">return</span> BestPred;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;}</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">/// \brief Find the best loop exiting block for layout.</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">/// This routine implements the logic to analyze the loop looking for the best</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">/// block to layout at the top of the loop. Typically this is done to maximize</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">/// fallthrough opportunities.</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;MachineBlockPlacement::findBestLoopExit(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;F,</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                                        <a class="code" href="classllvm_1_1MachineLoop.html">MachineLoop</a> &amp;L,</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                                        <span class="keyword">const</span> BlockFilterSet &amp;LoopBlockSet) {</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="comment">// We don&#39;t want to layout the loop linearly in all cases. If the loop header</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <span class="comment">// is just a normal basic block in the loop, we want to look for what block</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="comment">// within the loop is the best one to layout at the top. However, if the loop</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <span class="comment">// header has be pre-merged into a chain due to predecessors not having</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="comment">// analyzable branches, *and* the predecessor it is merged with is *not* part</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <span class="comment">// of the loop, rotating the header into the middle of the loop will create</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="comment">// a non-contiguous range of blocks which is Very Bad. So start with the</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="comment">// header and only rotate if safe.</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  BlockChain &amp;HeaderChain = *BlockToChain[L.<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>()];</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="keywordflow">if</span> (!LoopBlockSet.count(*HeaderChain.begin()))</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> BestExitEdgeFreq;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="keywordtype">unsigned</span> BestExitLoopDepth = 0;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *ExitingBB = 0;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="comment">// If there are exits to outer loops, loop rotation can severely limit</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="comment">// fallthrough opportunites unless it selects such an exit. Keep a set of</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="comment">// blocks where rotating to exit with that block will reach an outer loop.</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;MachineBasicBlock *, 4&gt;</a> BlocksExitingToOuterLoop;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Finding best loop exit for: &quot;</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;               &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(L.<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1LoopBase.html#ab39f9623eaa8cd22213aa716c6fb9994">MachineLoop::block_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = L.<a class="code" href="classllvm_1_1LoopBase.html#a3df1c508a7b1c89247367cab269076e2">block_begin</a>(),</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                                   E = L.<a class="code" href="classllvm_1_1LoopBase.html#a91e3f5f9bf6ecbd058624a479e150603">block_end</a>();</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    BlockChain &amp;Chain = *BlockToChain[*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="comment">// Ensure that this block is at the end of a chain; otherwise it could be</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="comment">// mid-way through an inner loop or a successor of an analyzable branch.</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">if</span> (*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != *<a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(Chain.end()))</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="comment">// Now walk the successors. We need to establish whether this has a viable</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="comment">// exiting successor and whether it has a viable non-exiting successor.</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="comment">// We store the old exiting state and restore it if a viable looping</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="comment">// successor isn&#39;t found.</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *OldExitingBB = ExitingBB;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> OldBestExitEdgeFreq = BestExitEdgeFreq;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keywordtype">bool</span> HasLoopingSucc = <span class="keyword">false</span>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="comment">// FIXME: Due to the performance of the probability and weight routines in</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="comment">// the MBPI analysis, we use the internal weights and manually compute the</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="comment">// probabilities to avoid quadratic behavior.</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    uint32_t WeightScale = 0;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    uint32_t SumWeight = MBPI-&gt;getSumForBlock(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, WeightScale);</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#aefba5f2af370add1bc8aaceedf7878ef">MachineBasicBlock::succ_iterator</a> SI = (*I)-&gt;succ_begin(),</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                                          SE = (*I)-&gt;succ_end();</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;         SI != SE; ++SI) {</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="keywordflow">if</span> ((*SI)-&gt;isLandingPad())</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="keywordflow">if</span> (*SI == *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      BlockChain &amp;SuccChain = *BlockToChain[*SI];</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="comment">// Don&#39;t split chains, either this chain or the successor&#39;s chain.</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="keywordflow">if</span> (&amp;Chain == &amp;SuccChain) {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;    exiting: &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                     &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*SI) &lt;&lt; <span class="stringliteral">&quot; (chain conflict)\n&quot;</span>);</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      }</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      uint32_t SuccWeight = MBPI-&gt;getEdgeWeight(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, *SI);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <span class="keywordflow">if</span> (LoopBlockSet.count(*SI)) {</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;    looping: &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                     &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*SI) &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; SuccWeight &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        HasLoopingSucc = <span class="keyword">true</span>;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      }</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      <span class="keywordtype">unsigned</span> SuccLoopDepth = 0;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MachineLoop.html">MachineLoop</a> *ExitLoop = MLI-&gt;getLoopFor(*SI)) {</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        SuccLoopDepth = ExitLoop-&gt;getLoopDepth();</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordflow">if</span> (ExitLoop-&gt;contains(&amp;L))</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;          BlocksExitingToOuterLoop.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      }</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <a class="code" href="classllvm_1_1BranchProbability.html">BranchProbability</a> SuccProb(SuccWeight / WeightScale, SumWeight);</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> ExitEdgeFreq = MBFI-&gt;getBlockFreq(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) * SuccProb;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;    exiting: &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                   &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*SI) &lt;&lt; <span class="stringliteral">&quot; [L:&quot;</span> &lt;&lt; SuccLoopDepth</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot;] (&quot;</span> &lt;&lt; ExitEdgeFreq &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>);</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      <span class="comment">// Note that we slightly bias this toward an existing layout successor to</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      <span class="comment">// retain incoming order in the absence of better information.</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="comment">// FIXME: Should we bias this more strongly? It&#39;s pretty weak.</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      <span class="keywordflow">if</span> (!ExitingBB || BestExitLoopDepth &lt; SuccLoopDepth ||</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;          ExitEdgeFreq &gt; BestExitEdgeFreq ||</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;          ((*I)-&gt;isLayoutSuccessor(*SI) &amp;&amp;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;           !(ExitEdgeFreq &lt; BestExitEdgeFreq))) {</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        BestExitEdgeFreq = ExitEdgeFreq;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        ExitingBB = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      }</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    }</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="comment">// Restore the old exiting state, no viable looping successor was found.</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">if</span> (!HasLoopingSucc) {</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      ExitingBB = OldExitingBB;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      BestExitEdgeFreq = OldBestExitEdgeFreq;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    }</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  }</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="comment">// Without a candidate exiting block or with only a single block in the</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="comment">// loop, just use the loop header to layout the loop.</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="keywordflow">if</span> (!ExitingBB || L.<a class="code" href="classllvm_1_1LoopBase.html#a9a89d64fefa63ff782d8f29e53a01873">getNumBlocks</a>() == 1)</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="comment">// Also, if we have exit blocks which lead to outer loops but didn&#39;t select</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="comment">// one of them as the exiting block we are rotating toward, disable loop</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="comment">// rotation altogether.</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="keywordflow">if</span> (!BlocksExitingToOuterLoop.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a095445850ef2c64e96b4c05120cecf66">empty</a>() &amp;&amp;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      !BlocksExitingToOuterLoop.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(ExitingBB))</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Best exiting block: &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(ExitingBB) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="keywordflow">return</span> ExitingBB;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;}</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">/// \brief Attempt to rotate an exiting block to the bottom of the loop.</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="comment">/// Once we have built a chain, try to rotate it to line up the hot exit block</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment">/// with fallthrough out of the loop if doing so doesn&#39;t introduce unnecessary</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="comment">/// branches. For example, if the loop has fallthrough into its header and out</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment">/// of its bottom already, don&#39;t rotate it.</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> MachineBlockPlacement::rotateLoop(BlockChain &amp;LoopChain,</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                                       <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *ExitingBB,</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                                       <span class="keyword">const</span> BlockFilterSet &amp;LoopBlockSet) {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="keywordflow">if</span> (!ExitingBB)</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *Top = *LoopChain.begin();</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="keywordtype">bool</span> ViableTopFallthrough = <span class="keyword">false</span>;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#a7e7a1a247b7725a24fe19a91f90782cc">MachineBasicBlock::pred_iterator</a> PI = Top-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab644fcf07a4c2708333cf66276282357">pred_begin</a>(),</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                                        PE = Top-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a0359a738e0412c5a7ea55d61175e0661">pred_end</a>();</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;       PI != PE; ++PI) {</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    BlockChain *PredChain = BlockToChain[*PI];</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keywordflow">if</span> (!LoopBlockSet.count(*PI) &amp;&amp;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        (!PredChain || *PI == *<a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(PredChain-&gt;end()))) {</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      ViableTopFallthrough = <span class="keyword">true</span>;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    }</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  }</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="comment">// If the header has viable fallthrough, check whether the current loop</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="comment">// bottom is a viable exiting block. If so, bail out as rotating will</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  <span class="comment">// introduce an unnecessary branch.</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="keywordflow">if</span> (ViableTopFallthrough) {</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *Bottom = *<a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(LoopChain.end());</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#aefba5f2af370add1bc8aaceedf7878ef">MachineBasicBlock::succ_iterator</a> SI = Bottom-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6321b189ea8fd5058663f8a87d6c23e9">succ_begin</a>(),</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                                          SE = Bottom-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3ddd708642d60c1661992ff8ba1b215d">succ_end</a>();</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;         SI != SE; ++SI) {</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      BlockChain *SuccChain = BlockToChain[*SI];</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      <span class="keywordflow">if</span> (!LoopBlockSet.count(*SI) &amp;&amp;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;          (!SuccChain || *SI == *SuccChain-&gt;begin()))</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    }</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  }</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <a class="code" href="classT.html">BlockChain::iterator</a> ExitIt = std::find(LoopChain.begin(), LoopChain.end(),</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                                          ExitingBB);</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="keywordflow">if</span> (ExitIt == LoopChain.end())</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <a class="code" href="Target_2README_8txt.html#a468c151b353d817979d3225dc1d7658b">std::rotate</a>(LoopChain.begin(), <a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(ExitIt), LoopChain.end());</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;}</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="comment">/// \brief Forms basic block chains from the natural loop structures.</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment">/// These chains are designed to preserve the existing *structure* of the code</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment">/// as much as possible. We can then stitch the chains together in a way which</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment">/// both preserves the topological structure and minimizes taken conditional</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment">/// branches.</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> MachineBlockPlacement::buildLoopChains(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;F,</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                                            <a class="code" href="classllvm_1_1MachineLoop.html">MachineLoop</a> &amp;L) {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <span class="comment">// First recurse through any nested loops, building chains for those inner</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="comment">// loops.</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1LoopBase.html#a4b2d2c2ddd3ccf5630c18731a162977d">MachineLoop::iterator</a> LI = L.<a class="code" href="classllvm_1_1LoopBase.html#a22b3e904c08bd922efd707282aed89d9">begin</a>(), <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588">LE</a> = L.<a class="code" href="classllvm_1_1LoopBase.html#a5a3b8a8269ba0c61102f71a2a3bd42cd">end</a>(); LI != <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588">LE</a>; ++LI)</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    buildLoopChains(F, **LI);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MachineBasicBlock *, 16&gt;</a> BlockWorkList;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  BlockFilterSet LoopBlockSet(L.<a class="code" href="classllvm_1_1LoopBase.html#a3df1c508a7b1c89247367cab269076e2">block_begin</a>(), L.<a class="code" href="classllvm_1_1LoopBase.html#a91e3f5f9bf6ecbd058624a479e150603">block_end</a>());</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="comment">// First check to see if there is an obviously preferable top block for the</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <span class="comment">// loop. This will default to the header, but may end up as one of the</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="comment">// predecessors to the header if there is one which will result in strictly</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="comment">// fewer branches in the loop body.</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *LoopTop = findBestLoopTop(L, LoopBlockSet);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="comment">// If we selected just the header for the loop top, look for a potentially</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="comment">// profitable exit block in the event that rotating the loop can eliminate</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  <span class="comment">// branches by placing an exit edge at the bottom.</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *ExitingBB = 0;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keywordflow">if</span> (LoopTop == L.<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>())</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    ExitingBB = findBestLoopExit(F, L, LoopBlockSet);</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  BlockChain &amp;LoopChain = *BlockToChain[LoopTop];</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="comment">// FIXME: This is a really lame way of walking the chains in the loop: we</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <span class="comment">// walk the blocks, and use a set to prevent visiting a particular chain</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="comment">// twice.</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BlockChain *, 4&gt;</a> UpdatedPreds;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  assert(LoopChain.LoopPredecessors == 0);</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  UpdatedPreds.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(&amp;LoopChain);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1LoopBase.html#ab39f9623eaa8cd22213aa716c6fb9994">MachineLoop::block_iterator</a> BI = L.<a class="code" href="classllvm_1_1LoopBase.html#a3df1c508a7b1c89247367cab269076e2">block_begin</a>(),</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                                   BE = L.<a class="code" href="classllvm_1_1LoopBase.html#a91e3f5f9bf6ecbd058624a479e150603">block_end</a>();</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;       BI != BE; ++BI) {</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    BlockChain &amp;Chain = *BlockToChain[*BI];</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">if</span> (!UpdatedPreds.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(&amp;Chain))</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    assert(Chain.LoopPredecessors == 0);</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classT.html">BlockChain::iterator</a> BCI = Chain.begin(), BCE = Chain.end();</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;         BCI != BCE; ++BCI) {</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      assert(BlockToChain[*BCI] == &amp;Chain);</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#a7e7a1a247b7725a24fe19a91f90782cc">MachineBasicBlock::pred_iterator</a> PI = (*BCI)-&gt;pred_begin(),</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                                            PE = (*BCI)-&gt;pred_end();</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;           PI != PE; ++PI) {</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        <span class="keywordflow">if</span> (BlockToChain[*PI] == &amp;Chain || !LoopBlockSet.count(*PI))</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        ++Chain.LoopPredecessors;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      }</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    }</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">if</span> (Chain.LoopPredecessors == 0)</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      BlockWorkList.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(*Chain.begin());</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  }</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  buildChain(LoopTop, LoopChain, BlockWorkList, &amp;LoopBlockSet);</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  rotateLoop(LoopChain, ExitingBB, LoopBlockSet);</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>({</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="comment">// Crash at the end so we get all of the debugging output first.</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="keywordtype">bool</span> BadLoop = <span class="keyword">false</span>;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="keywordflow">if</span> (LoopChain.LoopPredecessors) {</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      BadLoop = true;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      dbgs() &lt;&lt; <span class="stringliteral">&quot;Loop chain contains a block without its preds placed!\n&quot;</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;  Loop header:  &quot;</span> &lt;&lt; getBlockName(*L.block_begin()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;  Chain header: &quot;</span> &lt;&lt; getBlockName(*LoopChain.begin()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    }</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <a class="code" href="Target_2README_8txt.html#a7df6ed7588301267782c2bd4b7f6899d">for</a> (<a class="code" href="classT.html">BlockChain::iterator</a> BCI = LoopChain.begin(), BCE = LoopChain.end();</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;         BCI != BCE; ++BCI) {</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;          ... &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*BCI) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      <span class="keywordflow">if</span> (!LoopBlockSet.erase(*BCI)) {</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="comment">// We don&#39;t mark the loop as bad here because there are real situations</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="comment">// where this can occur. For example, with an unanalyzable fallthrough</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <span class="comment">// from a loop block to a non-loop block or vice versa.</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Loop chain contains a block not contained by the loop!\n&quot;</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;  Loop header:  &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*L.<a class="code" href="classllvm_1_1LoopBase.html#a3df1c508a7b1c89247367cab269076e2">block_begin</a>()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;  Chain header: &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*LoopChain.begin()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;  Bad block:    &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*BCI) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      }</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    }</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">if</span> (!LoopBlockSet.empty()) {</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      BadLoop = <span class="keyword">true</span>;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <span class="keywordflow">for</span> (BlockFilterSet::iterator LBI = LoopBlockSet.begin(),</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                                    LBE = LoopBlockSet.end();</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;           LBI != LBE; ++LBI)</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Loop contains blocks never placed into a chain!\n&quot;</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;  Loop header:  &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*L.<a class="code" href="classllvm_1_1LoopBase.html#a3df1c508a7b1c89247367cab269076e2">block_begin</a>()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;  Chain header: &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*LoopChain.begin()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;  Bad block:    &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*LBI) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    }</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    assert(!BadLoop &amp;&amp; <span class="stringliteral">&quot;Detected problems with the placement of this loop.&quot;</span>);</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  });</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;}</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="keywordtype">void</span> MachineBlockPlacement::buildCFGChains(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;F) {</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="comment">// Ensure that every BB in the function has an associated chain to simplify</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="comment">// the assumptions of the remaining algorithm.</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MachineOperand, 4&gt;</a> Cond; <span class="comment">// For AnalyzeBranch.</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> FI = F.<a class="code" href="classllvm_1_1MachineFunction.html#ab0789854909cf47f640a85fa2bac29c7">begin</a>(), FE = F.<a class="code" href="classllvm_1_1MachineFunction.html#a9d017af749f76484cb9aec9ff6e4330c">end</a>(); FI != FE; ++FI) {</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BB = FI;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    BlockChain *Chain</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      = <span class="keyword">new</span> (ChainAllocator.Allocate()) BlockChain(BlockToChain, BB);</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="comment">// Also, merge any blocks which we cannot reason about and must preserve</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="comment">// the exact fallthrough behavior for.</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      Cond.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *TBB = 0, *FBB = 0; <span class="comment">// For AnalyzeBranch.</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;<a class="code" href="classllvm_1_1HexagonInstrInfo.html#a6f9cdb0ade88e5375e97bb0905925c5d">AnalyzeBranch</a>(*BB, TBB, FBB, Cond) || !FI-&gt;canFallThrough())</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      <a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> NextFI(<a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(FI));</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NextBB = NextFI;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      <span class="comment">// Ensure that the layout successor is a viable block, as we know that</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <span class="comment">// fallthrough is a possibility.</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      assert(NextFI != FE &amp;&amp; <span class="stringliteral">&quot;Can&#39;t fallthrough past the last block.&quot;</span>);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Pre-merging due to unanalyzable fallthrough: &quot;</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                   &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(BB) &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(NextBB)</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      Chain-&gt;merge(NextBB, 0);</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      FI = NextFI;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      BB = NextBB;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    }</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  }</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <span class="comment">// Build any loop-based chains.</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineLoopInfo.html#a73d7a343f01b71b7adaa75d867a5f67e">MachineLoopInfo::iterator</a> LI = MLI-&gt;begin(), <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588">LE</a> = MLI-&gt;end(); LI != <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588">LE</a>;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;       ++LI)</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    buildLoopChains(F, **LI);</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MachineBasicBlock *, 16&gt;</a> BlockWorkList;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BlockChain *, 4&gt;</a> UpdatedPreds;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> FI = F.<a class="code" href="classllvm_1_1MachineFunction.html#ab0789854909cf47f640a85fa2bac29c7">begin</a>(), FE = F.<a class="code" href="classllvm_1_1MachineFunction.html#a9d017af749f76484cb9aec9ff6e4330c">end</a>(); FI != FE; ++FI) {</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BB = &amp;*FI;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    BlockChain &amp;Chain = *BlockToChain[<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>];</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="keywordflow">if</span> (!UpdatedPreds.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(&amp;Chain))</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    assert(Chain.LoopPredecessors == 0);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classT.html">BlockChain::iterator</a> BCI = Chain.begin(), BCE = Chain.end();</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;         BCI != BCE; ++BCI) {</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      assert(BlockToChain[*BCI] == &amp;Chain);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#a7e7a1a247b7725a24fe19a91f90782cc">MachineBasicBlock::pred_iterator</a> PI = (*BCI)-&gt;pred_begin(),</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                                            PE = (*BCI)-&gt;pred_end();</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;           PI != PE; ++PI) {</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <span class="keywordflow">if</span> (BlockToChain[*PI] == &amp;Chain)</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        ++Chain.LoopPredecessors;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      }</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    }</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">if</span> (Chain.LoopPredecessors == 0)</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      BlockWorkList.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(*Chain.begin());</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  }</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  BlockChain &amp;FunctionChain = *BlockToChain[&amp;F.<a class="code" href="classllvm_1_1MachineFunction.html#af562445435f18637f07676da054ba02c">front</a>()];</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  buildChain(&amp;F.<a class="code" href="classllvm_1_1MachineFunction.html#af562445435f18637f07676da054ba02c">front</a>(), FunctionChain, BlockWorkList);</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;MachineBasicBlock *, 16&gt;</a> FunctionBlockSetType;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>({</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="comment">// Crash at the end so we get all of the debugging output first.</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="keywordtype">bool</span> BadFunc = <span class="keyword">false</span>;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    FunctionBlockSetType FunctionBlockSet;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> FI = F.<a class="code" href="classllvm_1_1MachineFunction.html#ab0789854909cf47f640a85fa2bac29c7">begin</a>(), FE = F.<a class="code" href="classllvm_1_1MachineFunction.html#a9d017af749f76484cb9aec9ff6e4330c">end</a>(); FI != FE; ++FI)</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      FunctionBlockSet.insert(FI);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classT.html">BlockChain::iterator</a> BCI = FunctionChain.begin(),</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                              BCE = FunctionChain.end();</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;         BCI != BCE; ++BCI)</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      <span class="keywordflow">if</span> (!FunctionBlockSet.erase(*BCI)) {</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        BadFunc = <span class="keyword">true</span>;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Function chain contains a block not in the function!\n&quot;</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;  Bad block:    &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*BCI) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      }</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordflow">if</span> (!FunctionBlockSet.empty()) {</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      BadFunc = <span class="keyword">true</span>;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      <span class="keywordflow">for</span> (FunctionBlockSetType::iterator FBI = FunctionBlockSet.begin(),</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                                          FBE = FunctionBlockSet.end();</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;           FBI != FBE; ++FBI)</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Function contains blocks never placed into a chain!\n&quot;</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;  Bad block:    &quot;</span> &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*FBI) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    }</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    assert(!BadFunc &amp;&amp; <span class="stringliteral">&quot;Detected problems with the block placement.&quot;</span>);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  });</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="comment">// Splice the blocks into place.</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> InsertPos = F.<a class="code" href="classllvm_1_1MachineFunction.html#ab0789854909cf47f640a85fa2bac29c7">begin</a>();</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classT.html">BlockChain::iterator</a> BI = FunctionChain.begin(),</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                            BE = FunctionChain.end();</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;       BI != BE; ++BI) {</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; (BI == FunctionChain.begin() ? <span class="stringliteral">&quot;Placing chain &quot;</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                                                  : <span class="stringliteral">&quot;          ... &quot;</span>)</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;          &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(*BI) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keywordflow">if</span> (InsertPos != <a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a>(*BI))</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      F.<a class="code" href="classllvm_1_1MachineFunction.html#adf74e9faccaee21b521a0973568d4738">splice</a>(InsertPos, *BI);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      ++InsertPos;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="comment">// Update the terminator of the previous block.</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="keywordflow">if</span> (BI == FunctionChain.begin())</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *PrevBB = <a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a>(*BI));</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="comment">// FIXME: It would be awesome of updateTerminator would just return rather</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="comment">// than assert when the branch cannot be analyzed in order to remove this</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="comment">// boiler plate.</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    Cond.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *TBB = 0, *FBB = 0; <span class="comment">// For AnalyzeBranch.</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;<a class="code" href="classllvm_1_1HexagonInstrInfo.html#a6f9cdb0ade88e5375e97bb0905925c5d">AnalyzeBranch</a>(*PrevBB, TBB, FBB, Cond)) {</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      <span class="comment">// The &quot;PrevBB&quot; is not yet updated to reflect current code layout, so,</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <span class="comment">//   o. it may fall-through to a block without explict &quot;goto&quot; instruction</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="comment">//      before layout, and no longer fall-through it after layout; or </span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <span class="comment">//   o. just opposite.</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      <span class="comment">// </span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      <span class="comment">// AnalyzeBranch() may return erroneous value for FBB when these two</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <span class="comment">// situations take place. For the first scenario FBB is mistakenly set</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      <span class="comment">// NULL; for the 2nd scenario, the FBB, which is expected to be NULL,</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      <span class="comment">// is mistakenly pointing to &quot;*BI&quot;.</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      <span class="comment">//</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      <span class="keywordtype">bool</span> needUpdateBr = <span class="keyword">true</span>;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;      <span class="keywordflow">if</span> (!Cond.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>() &amp;&amp; (!FBB || FBB == *BI)) {</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        PrevBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#adae3eecba34e135c8ad4e05e29ea8be1">updateTerminator</a>();</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        needUpdateBr = <span class="keyword">false</span>;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        Cond.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        TBB = FBB = 0;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;<a class="code" href="classllvm_1_1HexagonInstrInfo.html#a6f9cdb0ade88e5375e97bb0905925c5d">AnalyzeBranch</a>(*PrevBB, TBB, FBB, Cond)) {</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;          <span class="comment">// FIXME: This should never take place.</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;          TBB = FBB = 0;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        }</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      }</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      <span class="comment">// If PrevBB has a two-way branch, try to re-order the branches</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <span class="comment">// such that we branch to the successor with higher weight first.</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <span class="keywordflow">if</span> (TBB &amp;&amp; !Cond.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>() &amp;&amp; FBB &amp;&amp;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;          MBPI-&gt;getEdgeWeight(PrevBB, FBB) &gt; MBPI-&gt;getEdgeWeight(PrevBB, TBB) &amp;&amp;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;          !<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;<a class="code" href="classllvm_1_1HexagonInstrInfo.html#ad6aff542dc74ce9024d0de5427339f7c">ReverseBranchCondition</a>(Cond)) {</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Reverse order of the two branches: &quot;</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                     &lt;&lt; <a class="code" href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a>(PrevBB) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;    Edge weight: &quot;</span> &lt;&lt; MBPI-&gt;getEdgeWeight(PrevBB, FBB)</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                     &lt;&lt; <span class="stringliteral">&quot; vs &quot;</span> &lt;&lt; MBPI-&gt;getEdgeWeight(PrevBB, TBB) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a> dl;  <span class="comment">// FIXME: this is nowhere</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;<a class="code" href="classllvm_1_1HexagonInstrInfo.html#a4a753587c7751fc7804429aec5453c2d">RemoveBranch</a>(*PrevBB);</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;<a class="code" href="classllvm_1_1HexagonInstrInfo.html#a95f554978b4efc4c1ca8b0ed5e017ff6">InsertBranch</a>(*PrevBB, FBB, TBB, Cond, dl);</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        needUpdateBr = <span class="keyword">true</span>;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      }</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <span class="keywordflow">if</span> (needUpdateBr)</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        PrevBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#adae3eecba34e135c8ad4e05e29ea8be1">updateTerminator</a>();</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    }</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  }</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  <span class="comment">// Fixup the last block.</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  Cond.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *TBB = 0, *FBB = 0; <span class="comment">// For AnalyzeBranch.</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;<a class="code" href="classllvm_1_1HexagonInstrInfo.html#a6f9cdb0ade88e5375e97bb0905925c5d">AnalyzeBranch</a>(F.<a class="code" href="classllvm_1_1MachineFunction.html#a0112d77d429a9eff5d852287b14871dd">back</a>(), TBB, FBB, Cond))</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    F.<a class="code" href="classllvm_1_1MachineFunction.html#a0112d77d429a9eff5d852287b14871dd">back</a>().<a class="code" href="classllvm_1_1MachineBasicBlock.html#adae3eecba34e135c8ad4e05e29ea8be1">updateTerminator</a>();</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="comment">// Walk through the backedges of the function now that we have fully laid out</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <span class="comment">// the basic blocks and align the destination of each backedge. We don&#39;t rely</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="comment">// exclusively on the loop info here so that we can align backedges in</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  <span class="comment">// unnatural CFGs and backedges that were introduced purely because of the</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  <span class="comment">// loop rotations done during this layout pass.</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <span class="keywordflow">if</span> (F.<a class="code" href="classllvm_1_1MachineFunction.html#ad784a6594990530bffb2018aeeed56f3">getFunction</a>()-&gt;<a class="code" href="classllvm_1_1Function.html#a72873ed64b7be01507a2248b8e756ec8">getAttributes</a>().</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        hasAttribute(AttributeSet::FunctionIndex, <a class="code" href="classllvm_1_1Attribute.html#aab7ee4b8fd1d3e7e4cea87868855e60ea2ac83e0612ce8f8d69651cd529061feb">Attribute::OptimizeForSize</a>))</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="ARMSubtarget_8cpp.html#a4bd80d4e433d9f72af26b364036900dc">Align</a> = TLI-&gt;getPrefLoopAlignment();</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <span class="keywordflow">if</span> (!Align)</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <span class="keywordflow">return</span>;  <span class="comment">// Don&#39;t care about loop alignment.</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <span class="keywordflow">if</span> (FunctionChain.begin() == FunctionChain.end())</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <span class="keywordflow">return</span>;  <span class="comment">// Empty chain.</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1BranchProbability.html">BranchProbability</a> ColdProb(1, 5); <span class="comment">// 20%</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> EntryFreq = MBFI-&gt;getBlockFreq(F.<a class="code" href="classllvm_1_1MachineFunction.html#ab0789854909cf47f640a85fa2bac29c7">begin</a>());</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> WeightedEntryFreq = EntryFreq * ColdProb;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classT.html">BlockChain::iterator</a> BI = <a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(FunctionChain.begin()),</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                            BE = FunctionChain.end();</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;       BI != BE; ++BI) {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <span class="comment">// Don&#39;t align non-looping basic blocks. These are unlikely to execute</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <span class="comment">// enough times to matter in practice. Note that we&#39;ll still handle</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="comment">// unnatural CFGs inside of a natural outer loop (the common case) and</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="comment">// rotated loops.</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <a class="code" href="classllvm_1_1MachineLoop.html">MachineLoop</a> *L = MLI-&gt;getLoopFor(*BI);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="keywordflow">if</span> (!L)</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="comment">// If the block is cold relative to the function entry don&#39;t waste space</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="comment">// aligning it.</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> Freq = MBFI-&gt;getBlockFreq(*BI);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="keywordflow">if</span> (Freq &lt; WeightedEntryFreq)</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="comment">// If the block is cold relative to its loop header, don&#39;t align it</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="comment">// regardless of what edges into the block exist.</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *LoopHeader = L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>();</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> LoopHeaderFreq = MBFI-&gt;getBlockFreq(LoopHeader);</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <span class="keywordflow">if</span> (Freq &lt; (LoopHeaderFreq * ColdProb))</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="comment">// Check for the existence of a non-layout predecessor which would benefit</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="comment">// from aligning this block.</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *LayoutPred = *<a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(BI);</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="comment">// Force alignment if all the predecessors are jumps. We already checked</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="comment">// that the block isn&#39;t cold above.</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="keywordflow">if</span> (!LayoutPred-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a57f25804288bc580d7b2e4016a38aec9">isSuccessor</a>(*BI)) {</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      (*BI)-&gt;setAlignment(Align);</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    }</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="comment">// Align this block if the layout predecessor&#39;s edge into this block is</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <span class="comment">// cold relative to the block. When this is true, other predecessors make up</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="comment">// all of the hot entries into the block and thus alignment is likely to be</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="comment">// important.</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <a class="code" href="classllvm_1_1BranchProbability.html">BranchProbability</a> LayoutProb = MBPI-&gt;getEdgeProbability(LayoutPred, *BI);</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> LayoutEdgeFreq = MBFI-&gt;getBlockFreq(LayoutPred) * LayoutProb;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <span class="keywordflow">if</span> (LayoutEdgeFreq &lt;= (Freq * ColdProb))</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;      (*BI)-&gt;setAlignment(Align);</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  }</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;}</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="keywordtype">bool</span> MachineBlockPlacement::runOnMachineFunction(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;F) {</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  <span class="comment">// Check for single-block functions and skip them.</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(F.<a class="code" href="classllvm_1_1MachineFunction.html#ab0789854909cf47f640a85fa2bac29c7">begin</a>()) == F.<a class="code" href="classllvm_1_1MachineFunction.html#a9d017af749f76484cb9aec9ff6e4330c">end</a>())</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  MBPI = &amp;getAnalysis&lt;MachineBranchProbabilityInfo&gt;();</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  MBFI = &amp;getAnalysis&lt;MachineBlockFrequencyInfo&gt;();</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  MLI = &amp;getAnalysis&lt;MachineLoopInfo&gt;();</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a> = F.<a class="code" href="classllvm_1_1MachineFunction.html#a6745c3bfdfc5b0643b078b96df2db252">getTarget</a>().<a class="code" href="classllvm_1_1TargetMachine.html#ac13d0f6f2c915757013b101ef6e8afbc">getInstrInfo</a>();</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  TLI = F.<a class="code" href="classllvm_1_1MachineFunction.html#a6745c3bfdfc5b0643b078b96df2db252">getTarget</a>().<a class="code" href="classllvm_1_1TargetMachine.html#ac962b1af600c2e418625a5fecc5e0f95">getTargetLowering</a>();</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;  assert(BlockToChain.empty());</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  buildCFGChains(F);</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  BlockToChain.clear();</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  ChainAllocator.DestroyAll();</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="MachineBlockPlacement_8cpp.html#ae1420a70bd9f672063a1922566794c9c">AlignAllBlock</a>)</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="comment">// Align all of the blocks in the function to a specific alignment.</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> FI = F.<a class="code" href="classllvm_1_1MachineFunction.html#ab0789854909cf47f640a85fa2bac29c7">begin</a>(), FE = F.<a class="code" href="classllvm_1_1MachineFunction.html#a9d017af749f76484cb9aec9ff6e4330c">end</a>();</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;         FI != FE; ++FI)</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;      FI-&gt;setAlignment(<a class="code" href="MachineBlockPlacement_8cpp.html#ae1420a70bd9f672063a1922566794c9c">AlignAllBlock</a>);</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  <span class="comment">// We always return true as we have no way to track whether the final order</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <span class="comment">// differs from the original order.</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;}</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment">/// \brief A pass to compute block placement statistics.</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment">/// A separate pass to compute interesting statistics for evaluating block</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment">/// placement. This is separate from the actual placement pass so that they can</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment">/// be computed in the absence of any placement transformations or when using</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment">/// alternative placement strategies.</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment"></span><span class="keyword">class </span>MachineBlockPlacementStats : <span class="keyword">public</span> <a class="code" href="classllvm_1_1MachineFunctionPass.html">MachineFunctionPass</a> {<span class="comment"></span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment">  /// \brief A handle to the branch probability pass.</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineBranchProbabilityInfo.html">MachineBranchProbabilityInfo</a> *MBPI;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="comment">  /// \brief A handle to the function-wide block frequency pass.</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineBlockFrequencyInfo.html">MachineBlockFrequencyInfo</a> *MBFI;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a>; <span class="comment">// Pass identification, replacement for typeid</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  MachineBlockPlacementStats() : <a class="code" href="classllvm_1_1MachineFunctionPass.html">MachineFunctionPass</a>(ID) {</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <a class="code" href="namespacellvm.html#a44d0c54f06e770c47e8d36af9f09b4af">initializeMachineBlockPlacementStatsPass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  }</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  <span class="keywordtype">bool</span> runOnMachineFunction(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;F);</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const </span>{</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1MachineBranchProbabilityInfo.html">MachineBranchProbabilityInfo</a>&gt;();</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1MachineBlockFrequencyInfo.html">MachineBlockFrequencyInfo</a>&gt;();</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#af22b06a6a4f9df80454071685a0d6a02">setPreservesAll</a>();</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <a class="code" href="classllvm_1_1MachineFunctionPass.html#aa1eece37d175f86a6f4808c0c167f13b">MachineFunctionPass::getAnalysisUsage</a>(AU);</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  }</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;};</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;}</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">MachineBlockPlacementStats::ID</a> = 0;</div><div class="line"><a name="l01164"></a><span class="lineno"><a class="line" href="namespacellvm.html#aed6261eb88354cb0f52273e9fdcce729"> 1164</a></span>&#160;<span class="keywordtype">char</span> &amp;<a class="code" href="namespacellvm.html#aed6261eb88354cb0f52273e9fdcce729">llvm::MachineBlockPlacementStatsID</a> = <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">MachineBlockPlacementStats::ID</a>;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<a class="code" href="MachineBlockPlacement_8cpp.html#ad499caec96089f300df66d7070e754ed">INITIALIZE_PASS_BEGIN</a>(MachineBlockPlacementStats, <span class="stringliteral">&quot;block-placement-stats&quot;</span>,</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;                      <span class="stringliteral">&quot;Basic Block Placement Stats&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<a class="code" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1MachineBranchProbabilityInfo.html">MachineBranchProbabilityInfo</a>)</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<a class="code" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1MachineBlockFrequencyInfo.html">MachineBlockFrequencyInfo</a>)</div><div class="line"><a name="l01169"></a><span class="lineno"><a class="line" href="MachineBlockPlacement_8cpp.html#a971b2fc3751cade0a6b2f76c92774317"> 1169</a></span>&#160;<a class="code" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(MachineBlockPlacementStats, &quot;<a class="code" href="README__ALTIVEC_8txt.html#a3fd74718101152ceb7850d4a8bbe1391">block</a>-<a class="code" href="SpillPlacement_8cpp.html#a6e1dbdf6b8d5e2d870e4a8d792f72299">placement</a>-<a class="code" href="namespacestats.html">stats</a>&quot;,</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                    &quot;Basic Block Placement <a class="code" href="MachineBlockPlacement_8cpp.html#a086f939e29b718dc5a01e4bcfe6af2a1">Stats</a>&quot;, false, false)</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="keywordtype">bool</span> MachineBlockPlacementStats::runOnMachineFunction(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;F) {</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="comment">// Check for single-block functions and skip them.</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(F.begin()) == F.end())</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  MBPI = &amp;getAnalysis&lt;MachineBranchProbabilityInfo&gt;();</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  MBFI = &amp;getAnalysis&lt;MachineBlockFrequencyInfo&gt;();</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = F.begin(), E = F.end(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> BlockFreq = MBFI-&gt;getBlockFreq(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <a class="code" href="classllvm_1_1Statistic.html">Statistic</a> &amp;NumBranches = (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;succ_size() &gt; 1) ? NumCondBranches</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                                                  : NumUncondBranches;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <a class="code" href="classllvm_1_1Statistic.html">Statistic</a> &amp;BranchTakenFreq = (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;succ_size() &gt; 1) ? CondBranchTakenFreq</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                                                      : UncondBranchTakenFreq;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#aefba5f2af370add1bc8aaceedf7878ef">MachineBasicBlock::succ_iterator</a> SI = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;succ_begin(),</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                                          SE = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;succ_end();</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;         SI != SE; ++SI) {</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      <span class="comment">// Skip if this successor is a fallthrough.</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isLayoutSuccessor(*SI))</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> EdgeFreq = BlockFreq * MBPI-&gt;getEdgeProbability(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, *SI);</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      ++NumBranches;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      BranchTakenFreq += EdgeFreq.<a class="code" href="classllvm_1_1BlockFrequency.html#acd0d5be21046a46d1ffa3646dc8790fc">getFrequency</a>();</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    }</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  }</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;}</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div><div class="ttc" id="classllvm_1_1HexagonInstrInfo_html_ad6aff542dc74ce9024d0de5427339f7c"><div class="ttname"><a href="classllvm_1_1HexagonInstrInfo.html#ad6aff542dc74ce9024d0de5427339f7c">llvm::HexagonInstrInfo::ReverseBranchCondition</a></div><div class="ttdeci">virtual bool ReverseBranchCondition(SmallVectorImpl&lt; MachineOperand &gt; &amp;Cond) const </div><div class="ttdef"><b>Definition:</b> <a href="HexagonInstrInfo_8cpp_source.html#l01063">HexagonInstrInfo.cpp:1063</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a075e34e98605d0e7c289763a104869ac"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">llvm::SmallVectorTemplateCommon&lt; T &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00114">SmallVector.h:114</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a9ac05913a143322136efcad10ed7548c"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a9ac05913a143322136efcad10ed7548c">llvm::MachineBasicBlock::succ_size</a></div><div class="ttdeci">unsigned succ_size() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00288">MachineBasicBlock.h:288</a></div></div>
<div class="ttc" id="MachineBlockPlacement_8cpp_html_ae1420a70bd9f672063a1922566794c9c"><div class="ttname"><a href="MachineBlockPlacement_8cpp.html#ae1420a70bd9f672063a1922566794c9c">AlignAllBlock</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; AlignAllBlock(&quot;align-all-blocks&quot;, cl::desc(&quot;Force the alignment of all &quot;&quot;blocks in the function.&quot;), cl::init(0), cl::Hidden)</div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_ae1a10b90f22c0478960fb5798ff73916"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">llvm::SmallVectorTemplateBase&lt; T, isPodLike&lt; T &gt;::value &gt;::push_back</a></div><div class="ttdeci">void push_back(const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00236">SmallVector.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_af2e482ff2a9253ec6bc2285491496bd6"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#af2e482ff2a9253ec6bc2285491496bd6">llvm::MachineBasicBlock::getParent</a></div><div class="ttdeci">const MachineFunction * getParent() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00137">MachineBasicBlock.h:137</a></div></div>
<div class="ttc" id="namespacellvm_1_1sys_1_1path_html_a214ec2f04ffd92636ed4bd2717607a1d"><div class="ttname"><a href="namespacellvm_1_1sys_1_1path.html#a214ec2f04ffd92636ed4bd2717607a1d">llvm::sys::path::end</a></div><div class="ttdeci">const_iterator end(StringRef path)</div><div class="ttdoc">Get end iterator over path. </div><div class="ttdef"><b>Definition:</b> <a href="Path_8cpp_source.html#l00181">Path.cpp:181</a></div></div>
<div class="ttc" id="classllvm_1_1HexagonInstrInfo_html_a4a753587c7751fc7804429aec5453c2d"><div class="ttname"><a href="classllvm_1_1HexagonInstrInfo.html#a4a753587c7751fc7804429aec5453c2d">llvm::HexagonInstrInfo::RemoveBranch</a></div><div class="ttdeci">virtual unsigned RemoveBranch(MachineBasicBlock &amp;MBB) const </div><div class="ttdef"><b>Definition:</b> <a href="HexagonInstrInfo_8cpp_source.html#l00307">HexagonInstrInfo.cpp:307</a></div></div>
<div class="ttc" id="classllvm_1_1TargetMachine_html_ac962b1af600c2e418625a5fecc5e0f95"><div class="ttname"><a href="classllvm_1_1TargetMachine.html#ac962b1af600c2e418625a5fecc5e0f95">llvm::TargetMachine::getTargetLowering</a></div><div class="ttdeci">virtual const TargetLowering * getTargetLowering() const </div><div class="ttdef"><b>Definition:</b> <a href="Target_2TargetMachine_8h_source.html#l00121">Target/TargetMachine.h:121</a></div></div>
<div class="ttc" id="classllvm_1_1LoopBase_html_a5a3b8a8269ba0c61102f71a2a3bd42cd"><div class="ttname"><a href="classllvm_1_1LoopBase.html#a5a3b8a8269ba0c61102f71a2a3bd42cd">llvm::LoopBase::end</a></div><div class="ttdeci">iterator end() const </div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00131">LoopInfo.h:131</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588">llvm::A64CC::LE</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00044">AArch64BaseInfo.h:44</a></div></div>
<div class="ttc" id="MachineBlockPlacement_8cpp_html_a2e264c893cf4976155fc4f96f947d7cf"><div class="ttname"><a href="MachineBlockPlacement_8cpp.html#a2e264c893cf4976155fc4f96f947d7cf">STATISTIC</a></div><div class="ttdeci">STATISTIC(NumCondBranches,&quot;Number of conditional branches&quot;)</div></div>
<div class="ttc" id="classllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00035">PassRegistry.cpp:35</a></div></div>
<div class="ttc" id="classllvm_1_1HexagonInstrInfo_html_a6f9cdb0ade88e5375e97bb0905925c5d"><div class="ttname"><a href="classllvm_1_1HexagonInstrInfo.html#a6f9cdb0ade88e5375e97bb0905925c5d">llvm::HexagonInstrInfo::AnalyzeBranch</a></div><div class="ttdeci">virtual bool AnalyzeBranch(MachineBasicBlock &amp;MBB, MachineBasicBlock *&amp;TBB, MachineBasicBlock *&amp;FBB, SmallVectorImpl&lt; MachineOperand &gt; &amp;Cond, bool AllowModify) const </div><div class="ttdef"><b>Definition:</b> <a href="HexagonInstrInfo_8cpp_source.html#l00172">HexagonInstrInfo.cpp:172</a></div></div>
<div class="ttc" id="namespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">List of target independent CodeGen pass IDs. </div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l00022">APFloat.h:22</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_a9d017af749f76484cb9aec9ff6e4330c"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#a9d017af749f76484cb9aec9ff6e4330c">llvm::MachineFunction::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00317">MachineFunction.h:317</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html"><div class="ttname"><a href="classllvm_1_1MachineFunction.html">llvm::MachineFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00075">MachineFunction.h:75</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a6acda287e5c19ffb173b0bf8f1dd9c5e"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">llvm::MachineBasicBlock::getNumber</a></div><div class="ttdeci">int getNumber() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00615">MachineBasicBlock.h:615</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_ab0789854909cf47f640a85fa2bac29c7"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#ab0789854909cf47f640a85fa2bac29c7">llvm::MachineFunction::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00315">MachineFunction.h:315</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00534">DenseMap.h:534</a></div></div>
<div class="ttc" id="Debug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="README__ALTIVEC_8txt_html_a3fd74718101152ceb7850d4a8bbe1391"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a3fd74718101152ceb7850d4a8bbe1391">block</a></div><div class="ttdeci">we get the following basic block</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00100">README_ALTIVEC.txt:100</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a3ddd708642d60c1661992ff8ba1b215d"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a3ddd708642d60c1661992ff8ba1b215d">llvm::MachineBasicBlock::succ_end</a></div><div class="ttdeci">succ_iterator succ_end()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00278">MachineBasicBlock.h:278</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a9b6dd0fc7a648a939e571246045b673e"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">llvm::SmallPtrSet::insert</a></div><div class="ttdeci">bool insert(PtrType Ptr)</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00253">SmallPtrSet.h:253</a></div></div>
<div class="ttc" id="namespacellvm_html_a44d0c54f06e770c47e8d36af9f09b4af"><div class="ttname"><a href="namespacellvm.html#a44d0c54f06e770c47e8d36af9f09b4af">llvm::initializeMachineBlockPlacementStatsPass</a></div><div class="ttdeci">void initializeMachineBlockPlacementStatsPass(PassRegistry &amp;)</div></div>
<div class="ttc" id="classllvm_1_1MachineBlockFrequencyInfo_html"><div class="ttname"><a href="classllvm_1_1MachineBlockFrequencyInfo.html">llvm::MachineBlockFrequencyInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineBlockFrequencyInfo_8h_source.html#l00030">MachineBlockFrequencyInfo.h:30</a></div></div>
<div class="ttc" id="namespacellvm_1_1sys_1_1path_html_a33706aab89e700b8f79e1fa6f4f0e3ee"><div class="ttname"><a href="namespacellvm_1_1sys_1_1path.html#a33706aab89e700b8f79e1fa6f4f0e3ee">llvm::sys::path::begin</a></div><div class="ttdeci">const_iterator begin(StringRef path)</div><div class="ttdoc">Get begin iterator over path. </div><div class="ttdef"><b>Definition:</b> <a href="Path_8cpp_source.html#l00173">Path.cpp:173</a></div></div>
<div class="ttc" id="classllvm_1_1DebugLoc_html"><div class="ttname"><a href="classllvm_1_1DebugLoc.html">llvm::DebugLoc</a></div><div class="ttdef"><b>Definition:</b> <a href="DebugLoc_8h_source.html#l00028">DebugLoc.h:28</a></div></div>
<div class="ttc" id="LLParser_8cpp_html_a33ece1ef8074506a15d7f86eb76dbae6"><div class="ttname"><a href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a></div><div class="ttdeci">F(f)</div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_ad784a6594990530bffb2018aeeed56f3"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#ad784a6594990530bffb2018aeeed56f3">llvm::MachineFunction::getFunction</a></div><div class="ttdeci">const Function * getFunction() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00151">MachineFunction.h:151</a></div></div>
<div class="ttc" id="MachineBlockPlacement_8cpp_html_a16e802f1d512b19481a50b0e7d71eab5"><div class="ttname"><a href="MachineBlockPlacement_8cpp.html#a16e802f1d512b19481a50b0e7d71eab5">getBlockNum</a></div><div class="ttdeci">static std::string getBlockNum(MachineBasicBlock *BB)</div><div class="ttdoc">Helper to print the number of a MBB. </div><div class="ttdef"><b>Definition:</b> <a href="MachineBlockPlacement_8cpp_source.html#l00270">MachineBlockPlacement.cpp:270</a></div></div>
<div class="ttc" id="classllvm_1_1BlockFrequency_html_acd0d5be21046a46d1ffa3646dc8790fc"><div class="ttname"><a href="classllvm_1_1BlockFrequency.html#acd0d5be21046a46d1ffa3646dc8790fc">llvm::BlockFrequency::getFrequency</a></div><div class="ttdeci">uint64_t getFrequency() const </div><div class="ttdoc">Returns the frequency as a fixpoint number scaled by the entry frequency. </div><div class="ttdef"><b>Definition:</b> <a href="BlockFrequency_8h_source.html#l00046">BlockFrequency.h:46</a></div></div>
<div class="ttc" id="Statistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_a7df6ed7588301267782c2bd4b7f6899d"><div class="ttname"><a href="Target_2README_8txt.html#a7df6ed7588301267782c2bd4b7f6899d">for</a></div><div class="ttdeci">this could be done in SelectionDAGISel along with other special for</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00141">Target/README.txt:141</a></div></div>
<div class="ttc" id="namespacellvm_html_aed6261eb88354cb0f52273e9fdcce729"><div class="ttname"><a href="namespacellvm.html#aed6261eb88354cb0f52273e9fdcce729">llvm::MachineBlockPlacementStatsID</a></div><div class="ttdeci">char &amp; MachineBlockPlacementStatsID</div><div class="ttdef"><b>Definition:</b> <a href="MachineBlockPlacement_8cpp_source.html#l01164">MachineBlockPlacement.cpp:1164</a></div></div>
<div class="ttc" id="namespacellvm_1_1cl_html_a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6"><div class="ttname"><a href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">llvm::cl::Hidden</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00109">CommandLine.h:109</a></div></div>
<div class="ttc" id="Allocator_8h_html"><div class="ttname"><a href="Allocator_8h.html">Allocator.h</a></div></div>
<div class="ttc" id="classllvm_1_1LoopBase_html_ab39f9623eaa8cd22213aa716c6fb9994"><div class="ttname"><a href="classllvm_1_1LoopBase.html#ab39f9623eaa8cd22213aa716c6fb9994">llvm::LoopBase&lt; MachineBasicBlock, MachineLoop &gt;::block_iterator</a></div><div class="ttdeci">std::vector&lt; MachineBasicBlock * &gt;::const_iterator block_iterator</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00139">LoopInfo.h:139</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html_ae5c60fd282ee894c87ea02c3f0fcb6d0"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">llvm::AnalysisUsage::addRequired</a></div><div class="ttdeci">AnalysisUsage &amp; addRequired()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00055">PassAnalysisSupport.h:55</a></div></div>
<div class="ttc" id="PassSupport_8h_html_a14724f1ccf528e73bb29bc9230737967"><div class="ttname"><a href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a></div><div class="ttdeci">#define INITIALIZE_PASS_DEPENDENCY(depName)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00167">PassSupport.h:167</a></div></div>
<div class="ttc" id="MachineFunction_8h_html"><div class="ttname"><a href="MachineFunction_8h.html">MachineFunction.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunctionPass_html"><div class="ttname"><a href="classllvm_1_1MachineFunctionPass.html">llvm::MachineFunctionPass</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineFunctionPass_8h_source.html#l00032">MachineFunctionPass.h:32</a></div></div>
<div class="ttc" id="HexagonCopyToCombine_8cpp_html_a1d40004718218dbdf06b496766299101"><div class="ttname"><a href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a></div><div class="ttdeci">const HexagonInstrInfo * TII</div><div class="ttdef"><b>Definition:</b> <a href="HexagonCopyToCombine_8cpp_source.html#l00115">HexagonCopyToCombine.cpp:115</a></div></div>
<div class="ttc" id="PassSupport_8h_html_a74ce8276b89067e806f67c45a6d92575"><div class="ttname"><a href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a></div><div class="ttdeci">#define INITIALIZE_PASS_END(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00172">PassSupport.h:172</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00035">APInt.h:35</a></div></div>
<div class="ttc" id="MachineBasicBlock_8h_html"><div class="ttname"><a href="MachineBasicBlock_8h.html">MachineBasicBlock.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_aefba5f2af370add1bc8aaceedf7878ef"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#aefba5f2af370add1bc8aaceedf7878ef">llvm::MachineBasicBlock::succ_iterator</a></div><div class="ttdeci">std::vector&lt; MachineBasicBlock * &gt;::iterator succ_iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00249">MachineBasicBlock.h:249</a></div></div>
<div class="ttc" id="namespacellvm_1_1MCID_html_a8035044d40d3758eb45b65dce69dc90ba359237c780f7c8e40645575826da8a3c"><div class="ttname"><a href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba359237c780f7c8e40645575826da8a3c">llvm::MCID::Branch</a></div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00108">MCInstrDesc.h:108</a></div></div>
<div class="ttc" id="classllvm_1_1LoopBase_html_a22b3e904c08bd922efd707282aed89d9"><div class="ttname"><a href="classllvm_1_1LoopBase.html#a22b3e904c08bd922efd707282aed89d9">llvm::LoopBase::begin</a></div><div class="ttdeci">iterator begin() const </div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00130">LoopInfo.h:130</a></div></div>
<div class="ttc" id="namespacefalse_html"><div class="ttname"><a href="namespacefalse.html">false</a></div><div class="ttdef"><b>Definition:</b> <a href="StackSlotColoring_8cpp_source.html#l00126">StackSlotColoring.cpp:126</a></div></div>
<div class="ttc" id="MachineBlockPlacement_8cpp_html_a086f939e29b718dc5a01e4bcfe6af2a1"><div class="ttname"><a href="MachineBlockPlacement_8cpp.html#a086f939e29b718dc5a01e4bcfe6af2a1">Stats</a></div><div class="ttdeci">block placement Basic Block Placement Stats</div><div class="ttdef"><b>Definition:</b> <a href="MachineBlockPlacement_8cpp_source.html#l01169">MachineBlockPlacement.cpp:1169</a></div></div>
<div class="ttc" id="namespacellvm_1_1CallingConv_html_a4f861731fc6dbfdccc05af5968d98974"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">llvm::CallingConv::ID</a></div><div class="ttdeci">ID</div><div class="ttdoc">LLVM Calling Convention Representation. </div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00026">CallingConv.h:26</a></div></div>
<div class="ttc" id="classllvm_1_1LoopBase_html_a4b2d2c2ddd3ccf5630c18731a162977d"><div class="ttname"><a href="classllvm_1_1LoopBase.html#a4b2d2c2ddd3ccf5630c18731a162977d">llvm::LoopBase&lt; MachineBasicBlock, MachineLoop &gt;::iterator</a></div><div class="ttdeci">std::vector&lt; MachineLoop * &gt;::const_iterator iterator</div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00127">LoopInfo.h:127</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_af562445435f18637f07676da054ba02c"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#af562445435f18637f07676da054ba02c">llvm::MachineFunction::front</a></div><div class="ttdeci">const MachineBasicBlock &amp; front() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00327">MachineFunction.h:327</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_a468c151b353d817979d3225dc1d7658b"><div class="ttname"><a href="Target_2README_8txt.html#a468c151b353d817979d3225dc1d7658b">rotate</a></div><div class="ttdeci">The same transformation can work with an even modulo with the addition of a rotate</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00718">Target/README.txt:718</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a2ced6343b8ad006a757059554bbf9f37"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">llvm::SmallPtrSet::count</a></div><div class="ttdeci">bool count(PtrType Ptr) const </div><div class="ttdoc">count - Return true if the specified pointer is in the set. </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00264">SmallPtrSet.h:264</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorBase_html_a8a8df4d85555c7954a95f86080cd3b64"><div class="ttname"><a href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">llvm::SmallVectorBase::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00056">SmallVector.h:56</a></div></div>
<div class="ttc" id="SmallPtrSet_8h_html"><div class="ttname"><a href="SmallPtrSet_8h.html">SmallPtrSet.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineLoop_html"><div class="ttname"><a href="classllvm_1_1MachineLoop.html">llvm::MachineLoop</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineLoopInfo_8h_source.html#l00044">MachineLoopInfo.h:44</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a7e7a1a247b7725a24fe19a91f90782cc"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a7e7a1a247b7725a24fe19a91f90782cc">llvm::MachineBasicBlock::pred_iterator</a></div><div class="ttdeci">std::vector&lt; MachineBasicBlock * &gt;::iterator pred_iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00247">MachineBasicBlock.h:247</a></div></div>
<div class="ttc" id="classllvm_1_1TargetInstrInfo_html"><div class="ttname"><a href="classllvm_1_1TargetInstrInfo.html">llvm::TargetInstrInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetInstrInfo_8h_source.html#l00047">TargetInstrInfo.h:47</a></div></div>
<div class="ttc" id="classllvm_1_1BranchProbability_html"><div class="ttname"><a href="classllvm_1_1BranchProbability.html">llvm::BranchProbability</a></div><div class="ttdef"><b>Definition:</b> <a href="BranchProbability_8h_source.html#l00025">BranchProbability.h:25</a></div></div>
<div class="ttc" id="MachineBlockFrequencyInfo_8h_html"><div class="ttname"><a href="MachineBlockFrequencyInfo_8h.html">MachineBlockFrequencyInfo.h</a></div></div>
<div class="ttc" id="CommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1cl_html_a10a041239ae1870cfcc064bfaa79fb65"><div class="ttname"><a href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00314">CommandLine.h:314</a></div></div>
<div class="ttc" id="namespacellvm_html_a03503773241005f01b090b9862aad304"><div class="ttname"><a href="namespacellvm.html#a03503773241005f01b090b9862aad304">llvm::dump</a></div><div class="ttdeci">void dump(const SparseBitVector&lt; ElementSize &gt; &amp;LHS, raw_ostream &amp;out)</div><div class="ttdef"><b>Definition:</b> <a href="SparseBitVector_8h_source.html#l00882">SparseBitVector.h:882</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a0359a738e0412c5a7ea55d61175e0661"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a0359a738e0412c5a7ea55d61175e0661">llvm::MachineBasicBlock::pred_end</a></div><div class="ttdeci">pred_iterator pred_end()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00262">MachineBasicBlock.h:262</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_aac0ea55010b7b1a301e65a0baea057aa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">llvm::SmallVectorImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00396">SmallVector.h:396</a></div></div>
<div class="ttc" id="TargetInstrInfo_8h_html"><div class="ttname"><a href="TargetInstrInfo_8h.html">TargetInstrInfo.h</a></div></div>
<div class="ttc" id="structllvm_1_1cl_1_1desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1desc.html">llvm::cl::desc</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00286">CommandLine.h:286</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html">llvm::MachineBasicBlock</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00062">MachineBasicBlock.h:62</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00037">PassAnalysisSupport.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1LoopBase_html_ac4f141a355e5898255f2cbc57c5b54c3"><div class="ttname"><a href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">llvm::LoopBase::getHeader</a></div><div class="ttdeci">BlockT * getHeader() const </div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00095">LoopInfo.h:95</a></div></div>
<div class="ttc" id="namespacellvm_html_aa1704159f75e6eacd595962ea6d93ffe"><div class="ttname"><a href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a></div><div class="ttdeci">ItTy next(ItTy it, Dist n)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00154">STLExtras.h:154</a></div></div>
<div class="ttc" id="classllvm_1_1HexagonInstrInfo_html_a95f554978b4efc4c1ca8b0ed5e017ff6"><div class="ttname"><a href="classllvm_1_1HexagonInstrInfo.html#a95f554978b4efc4c1ca8b0ed5e017ff6">llvm::HexagonInstrInfo::InsertBranch</a></div><div class="ttdeci">virtual unsigned InsertBranch(MachineBasicBlock &amp;MBB, MachineBasicBlock *TBB, MachineBasicBlock *FBB, const SmallVectorImpl&lt; MachineOperand &gt; &amp;Cond, DebugLoc DL) const </div><div class="ttdef"><b>Definition:</b> <a href="HexagonInstrInfo_8cpp_source.html#l00119">HexagonInstrInfo.cpp:119</a></div></div>
<div class="ttc" id="SpillPlacement_8cpp_html_a6e1dbdf6b8d5e2d870e4a8d792f72299"><div class="ttname"><a href="SpillPlacement_8cpp.html#a6e1dbdf6b8d5e2d870e4a8d792f72299">placement</a></div><div class="ttdeci">spill code placement</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00049">SpillPlacement.cpp:49</a></div></div>
<div class="ttc" id="MachineBlockPlacement_8cpp_html_a394ba4b4bfba86da3410230b136ed90b"><div class="ttname"><a href="MachineBlockPlacement_8cpp.html#a394ba4b4bfba86da3410230b136ed90b">placement2</a></div><div class="ttdeci">block placement2</div><div class="ttdef"><b>Definition:</b> <a href="MachineBlockPlacement_8cpp_source.html#l00251">MachineBlockPlacement.cpp:251</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSetImpl_html_a095445850ef2c64e96b4c05120cecf66"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a095445850ef2c64e96b4c05120cecf66">llvm::SmallPtrSetImpl::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00074">SmallPtrSet.h:74</a></div></div>
<div class="ttc" id="MachineBlockPlacement_8cpp_html_ad499caec96089f300df66d7070e754ed"><div class="ttname"><a href="MachineBlockPlacement_8cpp.html#ad499caec96089f300df66d7070e754ed">INITIALIZE_PASS_BEGIN</a></div><div class="ttdeci">INITIALIZE_PASS_BEGIN(MachineBlockPlacement,&quot;block-placement2&quot;,&quot;Branch Probability Basic Block Placement&quot;, false, false) INITIALIZE_PASS_END(MachineBlockPlacement</div></div>
<div class="ttc" id="DenseMap_8h_html"><div class="ttname"><a href="DenseMap_8h.html">DenseMap.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBranchProbabilityInfo_html"><div class="ttname"><a href="classllvm_1_1MachineBranchProbabilityInfo.html">llvm::MachineBranchProbabilityInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineBranchProbabilityInfo_8h_source.html#l00024">MachineBranchProbabilityInfo.h:24</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a6321b189ea8fd5058663f8a87d6c23e9"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a6321b189ea8fd5058663f8a87d6c23e9">llvm::MachineBasicBlock::succ_begin</a></div><div class="ttdeci">succ_iterator succ_begin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00276">MachineBasicBlock.h:276</a></div></div>
<div class="ttc" id="classllvm_1_1Statistic_html"><div class="ttname"><a href="classllvm_1_1Statistic.html">llvm::Statistic</a></div><div class="ttdef"><b>Definition:</b> <a href="Statistic_8h_source.html#l00035">Statistic.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a18c110c35e9133222a37b28d30f8a90f"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">llvm::SmallVectorImpl::erase</a></div><div class="ttdeci">iterator erase(iterator I)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00478">SmallVector.h:478</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_ab644fcf07a4c2708333cf66276282357"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ab644fcf07a4c2708333cf66276282357">llvm::MachineBasicBlock::pred_begin</a></div><div class="ttdeci">pred_iterator pred_begin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00260">MachineBasicBlock.h:260</a></div></div>
<div class="ttc" id="classT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="namespacellvm_html_af3e08655b0654029c7cf037651c8d7d6"><div class="ttname"><a href="namespacellvm.html#af3e08655b0654029c7cf037651c8d7d6">llvm::initializeMachineBlockPlacementPass</a></div><div class="ttdeci">void initializeMachineBlockPlacementPass(PassRegistry &amp;)</div></div>
<div class="ttc" id="classllvm_1_1TargetLoweringBase_html"><div class="ttname"><a href="classllvm_1_1TargetLoweringBase.html">llvm::TargetLoweringBase</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetLowering_8h_source.html#l00073">TargetLowering.h:73</a></div></div>
<div class="ttc" id="classllvm_1_1LoopBase_html_a9a89d64fefa63ff782d8f29e53a01873"><div class="ttname"><a href="classllvm_1_1LoopBase.html#a9a89d64fefa63ff782d8f29e53a01873">llvm::LoopBase::getNumBlocks</a></div><div class="ttdeci">unsigned getNumBlocks() const </div><div class="ttdoc">getNumBlocks - Get the number of blocks in this loop in constant time. </div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00144">LoopInfo.h:144</a></div></div>
<div class="ttc" id="classllvm_1_1TargetMachine_html_ac13d0f6f2c915757013b101ef6e8afbc"><div class="ttname"><a href="classllvm_1_1TargetMachine.html#ac13d0f6f2c915757013b101ef6e8afbc">llvm::TargetMachine::getInstrInfo</a></div><div class="ttdeci">virtual const TargetInstrInfo * getInstrInfo() const </div><div class="ttdef"><b>Definition:</b> <a href="Target_2TargetMachine_8h_source.html#l00119">Target/TargetMachine.h:119</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html">llvm::SmallPtrSet</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00236">SmallPtrSet.h:236</a></div></div>
<div class="ttc" id="MachineBlockPlacement_8cpp_html_a80e0b1823bee9dff0d9cbc44bc76b701"><div class="ttname"><a href="MachineBlockPlacement_8cpp.html#a80e0b1823bee9dff0d9cbc44bc76b701">Placement</a></div><div class="ttdeci">block Branch Probability Basic Block Placement</div><div class="ttdef"><b>Definition:</b> <a href="MachineBlockPlacement_8cpp_source.html#l00251">MachineBlockPlacement.cpp:251</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_adf74e9faccaee21b521a0973568d4738"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#adf74e9faccaee21b521a0973568d4738">llvm::MachineFunction::splice</a></div><div class="ttdeci">void splice(iterator InsertPt, iterator MBBI)</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00337">MachineFunction.h:337</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00880">SmallVector.h:880</a></div></div>
<div class="ttc" id="classllvm_1_1Attribute_html_aab7ee4b8fd1d3e7e4cea87868855e60ea2ac83e0612ce8f8d69651cd529061feb"><div class="ttname"><a href="classllvm_1_1Attribute.html#aab7ee4b8fd1d3e7e4cea87868855e60ea2ac83e0612ce8f8d69651cd529061feb">llvm::Attribute::OptimizeForSize</a></div><div class="ttdoc">opt_size </div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l00091">Attributes.h:91</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_adae3eecba34e135c8ad4e05e29ea8be1"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#adae3eecba34e135c8ad4e05e29ea8be1">llvm::MachineBasicBlock::updateTerminator</a></div><div class="ttdeci">void updateTerminator()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l00386">MachineBasicBlock.cpp:386</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a57f25804288bc580d7b2e4016a38aec9"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a57f25804288bc580d7b2e4016a38aec9">llvm::MachineBasicBlock::isSuccessor</a></div><div class="ttdeci">bool isSuccessor(const MachineBasicBlock *MBB) const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l00619">MachineBasicBlock.cpp:619</a></div></div>
<div class="ttc" id="MachineBlockPlacement_8cpp_html_a420a575a5cc23a356c5cbdbe9f98ca78"><div class="ttname"><a href="MachineBlockPlacement_8cpp.html#a420a575a5cc23a356c5cbdbe9f98ca78">getBlockName</a></div><div class="ttdeci">block Branch Probability Basic Block static false std::string getBlockName(MachineBasicBlock *BB)</div><div class="ttdoc">Helper to print the name of a MBB. </div><div class="ttdef"><b>Definition:</b> <a href="MachineBlockPlacement_8cpp_source.html#l00258">MachineBlockPlacement.cpp:258</a></div></div>
<div class="ttc" id="classllvm_1_1LoopBase_html_a3df1c508a7b1c89247367cab269076e2"><div class="ttname"><a href="classllvm_1_1LoopBase.html#a3df1c508a7b1c89247367cab269076e2">llvm::LoopBase::block_begin</a></div><div class="ttdeci">block_iterator block_begin() const </div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00140">LoopInfo.h:140</a></div></div>
<div class="ttc" id="classllvm_1_1LoopBase_html_a91e3f5f9bf6ecbd058624a479e150603"><div class="ttname"><a href="classllvm_1_1LoopBase.html#a91e3f5f9bf6ecbd058624a479e150603">llvm::LoopBase::block_end</a></div><div class="ttdeci">block_iterator block_end() const </div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00141">LoopInfo.h:141</a></div></div>
<div class="ttc" id="classllvm_1_1SpecificBumpPtrAllocator_html"><div class="ttname"><a href="classllvm_1_1SpecificBumpPtrAllocator.html">llvm::SpecificBumpPtrAllocator</a></div><div class="ttdef"><b>Definition:</b> <a href="Allocator_8h_source.html#l00190">Allocator.h:190</a></div></div>
<div class="ttc" id="namespacestats_html"><div class="ttname"><a href="namespacestats.html">stats</a></div><div class="ttdef"><b>Definition:</b> <a href="MCAssembler_8cpp_source.html#l00035">MCAssembler.cpp:35</a></div></div>
<div class="ttc" id="namespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs - Return a circular-buffered debug stream. </div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00101">Debug.cpp:101</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a72873ed64b7be01507a2248b8e756ec8"><div class="ttname"><a href="classllvm_1_1Function.html#a72873ed64b7be01507a2248b8e756ec8">llvm::Function::getAttributes</a></div><div class="ttdeci">AttributeSet getAttributes() const </div><div class="ttdoc">Return the attribute list for this Function. </div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00170">Function.h:170</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a454838c989e99a86bd804e056c367bd9"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a454838c989e99a86bd804e056c367bd9">llvm::MachineBasicBlock::getName</a></div><div class="ttdeci">StringRef getName() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l00245">MachineBasicBlock.cpp:245</a></div></div>
<div class="ttc" id="CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="CodeGen_2README_8txt_source.html#l00036">CodeGen/README.txt:36</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html_af22b06a6a4f9df80454071685a0d6a02"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#af22b06a6a4f9df80454071685a0d6a02">llvm::AnalysisUsage::setPreservesAll</a></div><div class="ttdeci">void setPreservesAll()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00094">PassAnalysisSupport.h:94</a></div></div>
<div class="ttc" id="classllvm_1_1raw__ostream_html_a520bdf57dfe3e73abb53d482893f0a27"><div class="ttname"><a href="classllvm_1_1raw__ostream.html#a520bdf57dfe3e73abb53d482893f0a27">llvm::raw_ostream::flush</a></div><div class="ttdeci">void flush()</div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8h_source.html#l00129">raw_ostream.h:129</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a8a045d250952c0867382a9840ee18fdf"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">llvm::SmallVectorTemplateCommon&lt; T &gt;::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00112">SmallVector.h:112</a></div></div>
<div class="ttc" id="MachineModuleInfo_8h_html"><div class="ttname"><a href="MachineModuleInfo_8h.html">MachineModuleInfo.h</a></div></div>
<div class="ttc" id="classllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l01149">CommandLine.h:1149</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunctionPass_html_aa1eece37d175f86a6f4808c0c167f13b"><div class="ttname"><a href="classllvm_1_1MachineFunctionPass.html#aa1eece37d175f86a6f4808c0c167f13b">llvm::MachineFunctionPass::getAnalysisUsage</a></div><div class="ttdeci">virtual void getAnalysisUsage(AnalysisUsage &amp;AU) const </div><div class="ttdef"><b>Definition:</b> <a href="MachineFunctionPass_8cpp_source.html#l00036">MachineFunctionPass.cpp:36</a></div></div>
<div class="ttc" id="MD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00054">MD5.cpp:54</a></div></div>
<div class="ttc" id="namespacellvm_html_adc14e69cab3ee0a21fdfdd40632b7ee1"><div class="ttname"><a href="namespacellvm.html#adc14e69cab3ee0a21fdfdd40632b7ee1">llvm::MachineBlockPlacementID</a></div><div class="ttdeci">char &amp; MachineBlockPlacementID</div><div class="ttdef"><b>Definition:</b> <a href="MachineBlockPlacement_8cpp_source.html#l00245">MachineBlockPlacement.cpp:245</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_a6745c3bfdfc5b0643b078b96df2db252"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#a6745c3bfdfc5b0643b078b96df2db252">llvm::MachineFunction::getTarget</a></div><div class="ttdeci">const TargetMachine &amp; getTarget() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00163">MachineFunction.h:163</a></div></div>
<div class="ttc" id="MachineBranchProbabilityInfo_8h_html"><div class="ttname"><a href="MachineBranchProbabilityInfo_8h.html">MachineBranchProbabilityInfo.h</a></div></div>
<div class="ttc" id="ARMSubtarget_8cpp_html_a4bd80d4e433d9f72af26b364036900dc"><div class="ttname"><a href="ARMSubtarget_8cpp.html#a4bd80d4e433d9f72af26b364036900dc">Align</a></div><div class="ttdeci">static cl::opt&lt; AlignMode &gt; Align(cl::desc(&quot;Load/store alignment support&quot;), cl::Hidden, cl::init(DefaultAlign), cl::values(clEnumValN(DefaultAlign,&quot;arm-default-align&quot;,&quot;Generate unaligned accesses only on hardware/OS &quot;&quot;combinations that are known to support them&quot;), clEnumValN(StrictAlign,&quot;arm-strict-align&quot;,&quot;Disallow all unaligned memory accesses&quot;), clEnumValN(NoStrictAlign,&quot;arm-no-strict-align&quot;,&quot;Allow unaligned memory accesses&quot;), clEnumValEnd))</div></div>
<div class="ttc" id="classllvm_1_1raw__string__ostream_html"><div class="ttname"><a href="classllvm_1_1raw__string__ostream.html">llvm::raw_string_ostream</a></div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8h_source.html#l00426">raw_ostream.h:426</a></div></div>
<div class="ttc" id="SmallVector_8h_html"><div class="ttname"><a href="SmallVector_8h.html">SmallVector.h</a></div></div>
<div class="ttc" id="MachineFunctionPass_8h_html"><div class="ttname"><a href="MachineFunctionPass_8h.html">MachineFunctionPass.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_a340712de3e78fec11c338735cab17df7"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">llvm::MachineFunction::iterator</a></div><div class="ttdeci">BasicBlockListType::iterator iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00303">MachineFunction.h:303</a></div></div>
<div class="ttc" id="namespacellvm_html_a7923e3e207de8bc1d0d6a5091316ddde"><div class="ttname"><a href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a></div><div class="ttdeci">ItTy prior(ItTy it, Dist n)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00167">STLExtras.h:167</a></div></div>
<div class="ttc" id="Debug_8h_html_aef41e8aaf4c60819b30faf396cdf4978"><div class="ttname"><a href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a></div><div class="ttdeci">#define DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00097">Debug.h:97</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_a0112d77d429a9eff5d852287b14871dd"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#a0112d77d429a9eff5d852287b14871dd">llvm::MachineFunction::back</a></div><div class="ttdeci">const MachineBasicBlock &amp; back() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00329">MachineFunction.h:329</a></div></div>
<div class="ttc" id="classllvm_1_1BlockFrequency_html"><div class="ttname"><a href="classllvm_1_1BlockFrequency.html">llvm::BlockFrequency</a></div><div class="ttdef"><b>Definition:</b> <a href="BlockFrequency_8h_source.html#l00025">BlockFrequency.h:25</a></div></div>
<div class="ttc" id="classllvm_1_1MachineLoopInfo_html"><div class="ttname"><a href="classllvm_1_1MachineLoopInfo.html">llvm::MachineLoopInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineLoopInfo_8h_source.html#l00072">MachineLoopInfo.h:72</a></div></div>
<div class="ttc" id="CodeGen_2Passes_8h_html"><div class="ttname"><a href="CodeGen_2Passes_8h.html">Passes.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineLoopInfo_html_a73d7a343f01b71b7adaa75d867a5f67e"><div class="ttname"><a href="classllvm_1_1MachineLoopInfo.html#a73d7a343f01b71b7adaa75d867a5f67e">llvm::MachineLoopInfo::iterator</a></div><div class="ttdeci">LoopInfoBase&lt; MachineBasicBlock, MachineLoop &gt;::iterator iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineLoopInfo_8h_source.html#l00091">MachineLoopInfo.h:91</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a0fc7a349a4ab737607def6cb461791fd"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a0fc7a349a4ab737607def6cb461791fd">llvm::MachineBasicBlock::isLayoutSuccessor</a></div><div class="ttdeci">bool isLayoutSuccessor(const MachineBasicBlock *MBB) const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l00623">MachineBasicBlock.cpp:623</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_ac9786455bc217ebd35377bb5d5ec8f20"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ac9786455bc217ebd35377bb5d5ec8f20">llvm::MachineBasicBlock::pred_size</a></div><div class="ttdeci">unsigned pred_size() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00272">MachineBasicBlock.h:272</a></div></div>
<div class="ttc" id="TargetLowering_8h_html"><div class="ttname"><a href="TargetLowering_8h.html">TargetLowering.h</a></div></div>
<div class="ttc" id="classllvm_1_1BranchProbability_html_abdacde00feddf9907be65c48669c98e6"><div class="ttname"><a href="classllvm_1_1BranchProbability.html#abdacde00feddf9907be65c48669c98e6">llvm::BranchProbability::getCompl</a></div><div class="ttdeci">BranchProbability getCompl() const </div><div class="ttdef"><b>Definition:</b> <a href="BranchProbability_8h_source.html#l00045">BranchProbability.h:45</a></div></div>
<div class="ttc" id="Compiler_8h_html_a6881c00738b22a600dfee25a1c32dab3"><div class="ttname"><a href="Compiler_8h.html#a6881c00738b22a600dfee25a1c32dab3">LLVM_ATTRIBUTE_USED</a></div><div class="ttdeci">#define LLVM_ATTRIBUTE_USED</div><div class="ttdef"><b>Definition:</b> <a href="Compiler_8h_source.html#l00179">Compiler.h:179</a></div></div>
<div class="ttc" id="MachineLoopInfo_8h_html"><div class="ttname"><a href="MachineLoopInfo_8h.html">MachineLoopInfo.h</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<p class="footer">
Generated on Sat Nov 10 2018 22:59:46 for <a href="http://llvm.org/">LLVM</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.8.11</a><br>
Copyright &copy; 2003-2013 University of Illinois at Urbana-Champaign.
All Rights Reserved.</p>
<hr>
<!--#include virtual="/attrib.incl" -->
</body>
</html>
