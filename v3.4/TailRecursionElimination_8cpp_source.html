<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="LLVM,Low Level Virtual Machine,C++,doxygen,API,documentation"/>
<meta name="description" content="C++ source code API documentation for LLVM."/>
<title>LLVM: TailRecursionElimination.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">LLVM API Documentation</p>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('TailRecursionElimination_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">TailRecursionElimination.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="TailRecursionElimination_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- TailRecursionElimination.cpp - Eliminate Tail Calls ----------------===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                     The LLVM Compiler Infrastructure</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is distributed under the University of Illinois Open Source</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License. See LICENSE.TXT for details.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// This file transforms calls of the current function (self recursion) followed</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// by a return instruction with a branch to the entry of the function, creating</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// a loop.  This pass also implements the following extensions to the basic</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// algorithm:</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//  1. Trivial instructions between the call and return do not prevent the</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//     transformation from taking place, though currently the analysis cannot</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//     support moving any really useful instructions (only dead ones).</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//  2. This pass transforms functions that are prevented from being tail</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//     recursive by an associative and commutative expression to use an</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//     accumulator variable, thus compiling the typical naive factorial or</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//     &#39;fib&#39; implementation into efficient code.</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//  3. TRE is performed if the function returns void, if the return</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//     returns the result returned by the call, or if the function returns a</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//     run-time constant on all exits from the function.  It is possible, though</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">//     unlikely, that the return returns something else (like constant 0), and</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">//     can still be TRE&#39;d.  It can be TRE&#39;d if ALL OTHER return instructions in</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">//     the function return the exact same value.</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">//  4. If it can prove that callees do not access their caller stack frame,</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">//     they are marked as eligible for tail call elimination (by the code</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">//     generator).</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">// There are several improvements that could be made:</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">//  1. If the function has any alloca instructions, these instructions will be</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">//     moved out of the entry block of the function, causing them to be</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">//     evaluated each time through the tail recursion.  Safely keeping allocas</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">//     in the entry block requires analysis to proves that the tail-called</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">//     function does not read or write the stack object.</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">//  2. Tail recursion is only performed if the call immediately precedes the</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">//     return instruction.  It&#39;s possible that there could be a jump between</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">//     the call and the return.</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">//  3. There can be intervening operations between the call and the return that</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">//     prevent the TRE from occurring.  For example, there could be GEP&#39;s and</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">//     stores to memory that will not be read or written by the call.  This</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">//     requires some substantial analysis (such as with DSA) to prove safe to</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">//     move ahead of the call, but doing so could allow many more TREs to be</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">//     performed, for example in TreeAdd/TreeAlloc from the treeadd benchmark.</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">//  4. The algorithm we use to detect if callees access their caller stack</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">//     frames is very primitive.</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="TailRecursionElimination_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   53</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;tailcallelim&quot;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Transforms_2Scalar_8h.html">llvm/Transforms/Scalar.h</a>&quot;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallPtrSet_8h.html">llvm/ADT/SmallPtrSet.h</a>&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CaptureTracking_8h.html">llvm/Analysis/CaptureTracking.h</a>&quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InlineCost_8h.html">llvm/Analysis/InlineCost.h</a>&quot;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstructionSimplify_8h.html">llvm/Analysis/InstructionSimplify.h</a>&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Loads_8h.html">llvm/Analysis/Loads.h</a>&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetTransformInfo_8h.html">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DerivedTypes_8h.html">llvm/IR/DerivedTypes.h</a>&quot;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Function_8h.html">llvm/IR/Function.h</a>&quot;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IntrinsicInst_8h.html">llvm/IR/IntrinsicInst.h</a>&quot;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Module_8h.html">llvm/IR/Module.h</a>&quot;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Pass_8h.html">llvm/Pass.h</a>&quot;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Support_2CFG_8h.html">llvm/Support/CFG.h</a>&quot;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CallSite_8h.html">llvm/Support/CallSite.h</a>&quot;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueHandle_8h.html">llvm/Support/ValueHandle.h</a>&quot;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlockUtils_8h.html">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Local_8h.html">llvm/Transforms/Utils/Local.h</a>&quot;</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<a class="code" href="TailRecursionElimination_8cpp.html#a1264977982aab76bcb6c0afe0a8775db">STATISTIC</a>(NumEliminated, <span class="stringliteral">&quot;Number of tail calls removed&quot;</span>);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<a class="code" href="TailRecursionElimination_8cpp.html#a1264977982aab76bcb6c0afe0a8775db">STATISTIC</a>(NumRetDuped,   <span class="stringliteral">&quot;Number of return duplicated&quot;</span>);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<a class="code" href="TailRecursionElimination_8cpp.html#a1264977982aab76bcb6c0afe0a8775db">STATISTIC</a>(NumAccumAdded, <span class="stringliteral">&quot;Number of accumulators introduced&quot;</span>);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="keyword">struct </span>TailCallElim : <span class="keyword">public</span> <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> *TTI;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a>; <span class="comment">// Pass identification, replacement for typeid</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    TailCallElim() : <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a>(ID) {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <a class="code" href="namespacellvm.html#a2bf5c022e65321bcf45328366c64276a">initializeTailCallElimPass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    }</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU) <span class="keyword">const</span>;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> runOnFunction(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="keyword">private</span>:</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *FindTRECandidate(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                               <span class="keywordtype">bool</span> CannotTailCallElimCallsMarkedTail);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordtype">bool</span> EliminateRecursiveTailCall(<a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI, <a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *<a class="code" href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">Ret</a>,</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                                    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *&amp;OldEntry,</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                                    <span class="keywordtype">bool</span> &amp;TailCallsAreMarkedTail,</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                                    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;PHINode *&gt;</a> &amp;ArgumentPHIs,</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                                    <span class="keywordtype">bool</span> CannotTailCallElimCallsMarkedTail);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordtype">bool</span> FoldReturnAndProcessPred(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                                  <a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *<a class="code" href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">Ret</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *&amp;OldEntry,</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                                  <span class="keywordtype">bool</span> &amp;TailCallsAreMarkedTail,</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                                  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;PHINode *&gt;</a> &amp;ArgumentPHIs,</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                                  <span class="keywordtype">bool</span> CannotTailCallElimCallsMarkedTail);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordtype">bool</span> ProcessReturningBlock(<a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *RI, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *&amp;OldEntry,</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                               <span class="keywordtype">bool</span> &amp;TailCallsAreMarkedTail,</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                               <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;PHINode *&gt;</a> &amp;ArgumentPHIs,</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                               <span class="keywordtype">bool</span> CannotTailCallElimCallsMarkedTail);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordtype">bool</span> CanMoveAboveCall(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *CanTransformAccumulatorRecursion(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  };</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">TailCallElim::ID</a> = 0;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<a class="code" href="TailRecursionElimination_8cpp.html#a43c6edf4b9facf9ba13368f67c65f653">INITIALIZE_PASS_BEGIN</a>(TailCallElim, <span class="stringliteral">&quot;tailcallelim&quot;</span>,</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                      <span class="stringliteral">&quot;Tail Call Elimination&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<a class="code" href="PassSupport_8h.html#af0564bcdde2dd4400c670ca278c6035f">INITIALIZE_AG_DEPENDENCY</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a>)</div><div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="TailRecursionElimination_8cpp.html#a56e52fc9cad88fd469d962f83b918cf0">  122</a></span>&#160;<a class="code" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(TailCallElim, &quot;<a class="code" href="TailRecursionElimination_8cpp.html#a56e52fc9cad88fd469d962f83b918cf0">tailcallelim</a>&quot;,</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                    &quot;Tail <a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Call</a> <a class="code" href="TailRecursionElimination_8cpp.html#a8b5e010ec24b31e0466f88d3b583d97b">Elimination</a>&quot;, <a class="code" href="namespacefalse.html">false</a>, false)</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">// Public interface to the TailCallElimination pass</span></div><div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="namespacellvm.html#a0ea2361bffa7838dd88ff68a438f1ecf">  126</a></span>&#160;<a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> *<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="namespacellvm.html#a0ea2361bffa7838dd88ff68a438f1ecf">createTailCallEliminationPass</a>() {</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> TailCallElim();</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;}</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keywordtype">void</span> TailCallElim::getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const </span>{</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a>&gt;();</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;}</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">/// CanTRE - Scan the specified basic block for alloca instructions.</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">/// If it contains any that are variable-sized or not in the entry block,</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">/// returns false.</span></div><div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="TailRecursionElimination_8cpp.html#a433aaebc4120630d0522d3f4b1d1e4a6">  137</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="TailRecursionElimination_8cpp.html#a433aaebc4120630d0522d3f4b1d1e4a6">CanTRE</a>(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI) {</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="comment">// Because of PR962, we don&#39;t TRE allocas outside the entry block.</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">// If this alloca is in the body of the function, or if it is a variable</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="comment">// sized allocation, we cannot tail call eliminate calls marked &#39;tail&#39;</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="comment">// with this mechanism.</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordflow">return</span> BB == &amp;BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>()-&gt;<a class="code" href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">getEntryBlock</a>() &amp;&amp;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;         isa&lt;ConstantInt&gt;(AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a642f52c0f081ad0de10258c1d8d67b23">getArraySize</a>());</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="keyword">struct </span>AllocaCaptureTracker : <span class="keyword">public</span> <a class="code" href="structllvm_1_1CaptureTracker.html">CaptureTracker</a> {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  AllocaCaptureTracker() : Captured(<span class="keyword">false</span>) {}</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordtype">void</span> tooManyUses() <a class="code" href="Compiler_8h.html#a68c26c4a3531dcda6b04ab5ca7955947">LLVM_OVERRIDE</a> { Captured = <span class="keyword">true</span>; }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordtype">bool</span> shouldExplore(<a class="code" href="classllvm_1_1Use.html">Use</a> *U) <a class="code" href="Compiler_8h.html#a68c26c4a3531dcda6b04ab5ca7955947">LLVM_OVERRIDE</a> {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = U-&gt;getUser();</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">if</span> (isa&lt;CallInst&gt;(V) || isa&lt;InvokeInst&gt;(V))</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      UsesAlloca.insert(V);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordtype">bool</span> captured(<a class="code" href="classllvm_1_1Use.html">Use</a> *U) <a class="code" href="Compiler_8h.html#a68c26c4a3531dcda6b04ab5ca7955947">LLVM_OVERRIDE</a> {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">if</span> (isa&lt;ReturnInst&gt;(U-&gt;getUser()))</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    Captured = <span class="keyword">true</span>;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordtype">bool</span> Captured;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const Value *, 16&gt;</a> UsesAlloca;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;};</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;} <span class="comment">// end anonymous namespace</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="keywordtype">bool</span> TailCallElim::runOnFunction(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>) {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="comment">// If this function is a varargs function, we won&#39;t be able to PHI the args</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="comment">// right, so don&#39;t even try to convert it...</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordflow">if</span> (F.<a class="code" href="classllvm_1_1Function.html#adf66d58e85fb4e46e9c1ae55186a6930">getFunctionType</a>()-&gt;<a class="code" href="classllvm_1_1FunctionType.html#ab9b67f93a2231970abb3d95636660ffc">isVarArg</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  TTI = &amp;getAnalysis&lt;TargetTransformInfo&gt;();</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *OldEntry = 0;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordtype">bool</span> TailCallsAreMarkedTail = <span class="keyword">false</span>;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;PHINode*, 8&gt;</a> ArgumentPHIs;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="comment">// CanTRETailMarkedCall - If false, we cannot perform TRE on tail calls</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="comment">// marked with the &#39;tail&#39; attribute, because doing so would cause the stack</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="comment">// size to increase (real TRE would deallocate variable sized allocas, TRE</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="comment">// doesn&#39;t).</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordtype">bool</span> CanTRETailMarkedCall = <span class="keyword">true</span>;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="comment">// Find calls that can be marked tail.</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  AllocaCaptureTracker ACT;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Function::iterator</a> <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = F.<a class="code" href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">begin</a>(), EE = F.<a class="code" href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">end</a>(); <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> != EE; ++<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin(), E = <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;end(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI = dyn_cast&lt;AllocaInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        CanTRETailMarkedCall &amp;= <a class="code" href="TailRecursionElimination_8cpp.html#a433aaebc4120630d0522d3f4b1d1e4a6">CanTRE</a>(AI);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <a class="code" href="namespacellvm.html#a0b8531ebccf07d33408272bd51999962">PointerMayBeCaptured</a>(AI, &amp;ACT);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="comment">// If any allocas are captured, exit.</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">if</span> (ACT.Captured)</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="comment">// Second pass, change any tail recursive calls to loops.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="comment">// FIXME: The code generator produces really bad code when an &#39;escaping</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="comment">// alloca&#39; is changed from being a static alloca to being a dynamic alloca.</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="comment">// Until this is resolved, disable this transformation if that would ever</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="comment">// happen.  This bug is PR962.</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordflow">if</span> (ACT.UsesAlloca.empty()) {</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Function::iterator</a> <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = F.<a class="code" href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">begin</a>(), E = F.<a class="code" href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">end</a>(); <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> != E; ++<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *<a class="code" href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">Ret</a> = dyn_cast&lt;ReturnInst&gt;(<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getTerminator())) {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordtype">bool</span> Change = ProcessReturningBlock(<a class="code" href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">Ret</a>, OldEntry, TailCallsAreMarkedTail,</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                                            ArgumentPHIs, !CanTRETailMarkedCall);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">if</span> (!Change &amp;&amp; <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;getFirstNonPHIOrDbg() == <a class="code" href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">Ret</a>)</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;          Change = FoldReturnAndProcessPred(<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <a class="code" href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">Ret</a>, OldEntry,</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                                            TailCallsAreMarkedTail, ArgumentPHIs,</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                                            !CanTRETailMarkedCall);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        MadeChange |= Change;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      }</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    }</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  }</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="comment">// If we eliminated any tail recursions, it&#39;s possible that we inserted some</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="comment">// silly PHI nodes which just merge an initial value (the incoming operand)</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="comment">// with themselves.  Check to see if we did and clean up our mess if so.  This</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="comment">// occurs when a function passes an argument straight through to its tail</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="comment">// call.</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordflow">if</span> (!ArgumentPHIs.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = ArgumentPHIs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = ArgumentPHIs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <span class="comment">// If the PHI Node is a dynamic constant, replace it with the value it is.</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *PNV = <a class="code" href="namespacellvm.html#a50f8f41fccbea466816345520e9bfabb">SimplifyInstruction</a>(PN)) {</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        PN-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(PNV);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    }</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="comment">// At this point, we know that the function does not have any captured</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="comment">// allocas. If additionally the function does not call setjmp, mark all calls</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="comment">// in the function that do not access stack memory with the tail keyword. This</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="comment">// implies ensuring that there does not exist any path from a call that takes</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">// in an alloca but does not capture it and the call which we wish to mark</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="comment">// with &quot;tail&quot;.</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordflow">if</span> (!F.<a class="code" href="classllvm_1_1Function.html#ab79bcc780b834b4aab6e392c55831e2a">callsFunctionThatReturnsTwice</a>()) {</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Function::iterator</a> <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = F.<a class="code" href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">begin</a>(), E = F.<a class="code" href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">end</a>(); <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> != E; ++<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin(), E = <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;end(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = dyn_cast&lt;CallInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;          <span class="keywordflow">if</span> (!ACT.UsesAlloca.count(CI)) {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            CI-&gt;setTailCall();</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;          }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      }</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;}</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">/// CanMoveAboveCall - Return true if it is safe to move the specified</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">/// instruction from after the call to before the call, assuming that all</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">/// instructions between the call and this instruction are movable.</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> TailCallElim::CanMoveAboveCall(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI) {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="comment">// FIXME: We can move load/store/call/free instructions above the call if the</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="comment">// call does not mod/ref the memory location being processed.</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordflow">if</span> (I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a573063aad4c101462893d0490d867524">mayHaveSideEffects</a>())  <span class="comment">// This also handles volatile loads.</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *L = dyn_cast&lt;LoadInst&gt;(I)) {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">// Loads may always be moved above calls without side effects.</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a573063aad4c101462893d0490d867524">mayHaveSideEffects</a>()) {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="comment">// Non-volatile loads may be moved above a call with side effects if it</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="comment">// does not write to memory and the load provably won&#39;t trap.</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      <span class="comment">// FIXME: Writes to memory only matter if they may alias the pointer</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="comment">// being loaded from.</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#aa26de3d6e38997b9041e824ea558c770">mayWriteToMemory</a>() ||</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;          !<a class="code" href="namespacellvm.html#a2bb15e529c55b5356aabfb006d1e98aa">isSafeToLoadUnconditionally</a>(L-&gt;getPointerOperand(), L,</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                                       L-&gt;getAlignment()))</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  }</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="comment">// Otherwise, if this is a side-effect free instruction, check to make sure</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="comment">// that it does not use the return value of the call.  If it doesn&#39;t use the</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="comment">// return value of the call, it must only use things that are defined before</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="comment">// the call, or movable instructions between the call and the instruction</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">// itself.</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = I-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">if</span> (I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) == CI)</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;}</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">// isDynamicConstant - Return true if the specified value is the same when the</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">// return would exit as it was when the initial iteration of the recursive</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">// function was executed.</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">// We currently handle static constants and arguments that are not modified as</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">// part of the recursion.</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00306"></a><span class="lineno"><a class="line" href="TailRecursionElimination_8cpp.html#a55552678f30bafd309428c2bae96ac28">  306</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="TailRecursionElimination_8cpp.html#a55552678f30bafd309428c2bae96ac28">isDynamicConstant</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI, <a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *RI) {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordflow">if</span> (isa&lt;Constant&gt;(V)) <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// Static constants are always dyn consts</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="comment">// Check to see if this is an immutable argument, if so, the value</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="comment">// will be available to initialize the accumulator.</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Argument.html">Argument</a> *Arg = dyn_cast&lt;Argument&gt;(V)) {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="comment">// Figure out which argument number this is...</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordtype">unsigned</span> ArgNo = 0;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> *F = CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>();</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Function::arg_iterator</a> AI = F-&gt;<a class="code" href="classllvm_1_1Function.html#a8bf193a781a92cae52d7f9216d0824f8">arg_begin</a>(); &amp;*AI != Arg; ++AI)</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      ++ArgNo;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="comment">// If we are passing this argument into call as the corresponding</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="comment">// argument operand, then the argument is dynamically constant.</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">// Otherwise, we cannot transform this function safely.</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(ArgNo) == Arg)</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  }</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="comment">// Switch cases are always constant integers. If the value is being switched</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="comment">// on and the return is only reachable from one of its cases, it&#39;s</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="comment">// effectively constant.</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *UniquePred = RI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a748ffcf2c4af9d1fdb458470a4c368f9">getUniquePredecessor</a>())</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI = dyn_cast&lt;SwitchInst&gt;(UniquePred-&gt;getTerminator()))</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keywordflow">if</span> (SI-&gt;getCondition() == V)</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keywordflow">return</span> SI-&gt;getDefaultDest() != RI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="comment">// Not a constant or immutable argument, we can&#39;t safely transform.</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;}</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">// getCommonReturnValue - Check to see if the function containing the specified</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">// tail call consistently returns the same runtime-constant value at all exit</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">// points except for IgnoreRI.  If so, return the returned value.</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00341"></a><span class="lineno"><a class="line" href="TailRecursionElimination_8cpp.html#a60ba522bf071270f84981cc956af3d36">  341</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="TailRecursionElimination_8cpp.html#a60ba522bf071270f84981cc956af3d36">getCommonReturnValue</a>(<a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *IgnoreRI, <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI) {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *F = CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>();</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ReturnedValue = 0;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Function::iterator</a> BBI = F-&gt;<a class="code" href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">begin</a>(), E = F-&gt;<a class="code" href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">end</a>(); BBI != E; ++BBI) {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *RI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a>&gt;(BBI-&gt;getTerminator());</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">if</span> (RI == 0 || RI == IgnoreRI) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">// We can only perform this transformation if the value returned is</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">// evaluatable at the start of the initial invocation of the function,</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="comment">// instead of at the end of the evaluation.</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *RetOp = RI-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="TailRecursionElimination_8cpp.html#a55552678f30bafd309428c2bae96ac28">isDynamicConstant</a>(RetOp, CI, RI))</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">if</span> (ReturnedValue &amp;&amp; RetOp != ReturnedValue)</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <span class="keywordflow">return</span> 0;     <span class="comment">// Cannot transform if differing values are returned.</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    ReturnedValue = RetOp;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  }</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordflow">return</span> ReturnedValue;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;}</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">/// CanTransformAccumulatorRecursion - If the specified instruction can be</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">/// transformed using accumulator recursion elimination, return the constant</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">/// which is the start of the accumulator value.  Otherwise return null.</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1Value.html">Value</a> *TailCallElim::CanTransformAccumulatorRecursion(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I,</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                                                      <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI) {</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordflow">if</span> (!I-&gt;<a class="code" href="classllvm_1_1Instruction.html#aa113b8a9ef3de9c2f075a046ad658717">isAssociative</a>() || !I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a1c2048f254df730c4de1643ec791ddf9">isCommutative</a>()) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  assert(I-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>() == 2 &amp;&amp;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;         <span class="stringliteral">&quot;Associative/commutative operations should have 2 args!&quot;</span>);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="comment">// Exactly one operand should be the result of the call instruction.</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="keywordflow">if</span> ((I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0) == CI &amp;&amp; I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1) == CI) ||</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      (I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0) != CI &amp;&amp; I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1) != CI))</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="comment">// The only user of this instruction we allow is a single return instruction.</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keywordflow">if</span> (!I-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>() || !isa&lt;ReturnInst&gt;(I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">use_back</a>()))</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="comment">// Ok, now we have to check all of the other return instructions in this</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="comment">// function.  If they return non-constants or differing values, then we cannot</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="comment">// transform the function safely.</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="TailRecursionElimination_8cpp.html#a60ba522bf071270f84981cc956af3d36">getCommonReturnValue</a>(cast&lt;ReturnInst&gt;(I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">use_back</a>()), CI);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;}</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="line"><a name="l00389"></a><span class="lineno"><a class="line" href="TailRecursionElimination_8cpp.html#a0f880faf6d322eaf7440ff13ea5351c8">  389</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="TailRecursionElimination_8cpp.html#a0f880faf6d322eaf7440ff13ea5351c8">FirstNonDbg</a>(<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> I) {</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(I))</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordflow">return</span> &amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;}</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<a class="code" href="classllvm_1_1CallInst.html">CallInst</a>*</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;TailCallElim::FindTRECandidate(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TI,</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                               <span class="keywordtype">bool</span> CannotTailCallElimCallsMarkedTail) {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *F = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>();</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keywordflow">if</span> (&amp;BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a33603355becfb1a050b62aa015c1cc57">front</a>() == TI) <span class="comment">// Make sure there is something before the terminator.</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="comment">// Scan backwards from the return, checking to see if there is a tail call in</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <span class="comment">// this block.  If so, set CI to it.</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = 0;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = TI;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    CI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1CallInst.html">CallInst</a>&gt;(BBI);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">if</span> (CI &amp;&amp; CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a0bcd4131e1a1d92215f5385b4e16cd2e">getCalledFunction</a>() == <a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>)</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">if</span> (BBI == BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>())</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      <span class="keywordflow">return</span> 0;          <span class="comment">// Didn&#39;t find a potential tail call.</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    --BBI;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  }</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="comment">// If this call is marked as a tail call, and if there are dynamic allocas in</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="comment">// the function, we cannot perform this optimization.</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a5e07dea70b41ad610edbfc21bd54154a">isTailCall</a>() &amp;&amp; CannotTailCallElimCallsMarkedTail)</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="comment">// As a special case, detect code like this:</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="comment">//   double fabs(double f) { return __builtin_fabs(f); } // a &#39;fabs&#39; call</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="comment">// and disable this xform in this case, because the code generator will</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="comment">// lower the call to fabs into inline code.</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="keywordflow">if</span> (BB == &amp;F-&gt;<a class="code" href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">getEntryBlock</a>() &amp;&amp;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <a class="code" href="TailRecursionElimination_8cpp.html#a0f880faf6d322eaf7440ff13ea5351c8">FirstNonDbg</a>(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a33603355becfb1a050b62aa015c1cc57">front</a>()) == CI &amp;&amp;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <a class="code" href="TailRecursionElimination_8cpp.html#a0f880faf6d322eaf7440ff13ea5351c8">FirstNonDbg</a>(<a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>())) == TI &amp;&amp;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a0bcd4131e1a1d92215f5385b4e16cd2e">getCalledFunction</a>() &amp;&amp;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      !TTI-&gt;isLoweredToCall(CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a0bcd4131e1a1d92215f5385b4e16cd2e">getCalledFunction</a>())) {</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="comment">// A single-block function with just a call and a return. Check that</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="comment">// the arguments match.</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <a class="code" href="classllvm_1_1CallSiteBase.html#a9c293af587813d72fdc976697dd07f23">CallSite::arg_iterator</a> I = <a class="code" href="classllvm_1_1CallSite.html">CallSite</a>(CI).<a class="code" href="classllvm_1_1CallSiteBase.html#affa0f3ae92ab8696fccd107c0addf5a2">arg_begin</a>(),</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                           E = <a class="code" href="classllvm_1_1CallSite.html">CallSite</a>(CI).<a class="code" href="classllvm_1_1CallSiteBase.html#acc2eeccdf71d83b3c08d6218317a1430">arg_end</a>();</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <a class="code" href="classllvm_1_1ilist__iterator.html">Function::arg_iterator</a> FI = F-&gt;<a class="code" href="classllvm_1_1Function.html#a8bf193a781a92cae52d7f9216d0824f8">arg_begin</a>(),</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                           FE = F-&gt;<a class="code" href="classllvm_1_1Function.html#a8300ac1ef141b8a7c63c13fa9369d976">arg_end</a>();</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">for</span> (; I != E &amp;&amp; FI != FE; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ++FI)</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="keywordflow">if</span> (*I != &amp;*FI) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">if</span> (I == E &amp;&amp; FI == FE)</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  }</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordflow">return</span> CI;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;}</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="keywordtype">bool</span> TailCallElim::EliminateRecursiveTailCall(<a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI, <a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *<a class="code" href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">Ret</a>,</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                                       <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *&amp;OldEntry,</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                                       <span class="keywordtype">bool</span> &amp;TailCallsAreMarkedTail,</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                                       <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;PHINode *&gt;</a> &amp;ArgumentPHIs,</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                                       <span class="keywordtype">bool</span> CannotTailCallElimCallsMarkedTail) {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="comment">// If we are introducing accumulator recursion to eliminate operations after</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="comment">// the call instruction that are both associative and commutative, the initial</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="comment">// value for the accumulator is placed in this variable.  If this value is set</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="comment">// then we actually perform accumulator recursion elimination instead of</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="comment">// simple tail recursion elimination.  If the operation is an LLVM instruction</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="comment">// (eg: &quot;add&quot;) then it is recorded in AccumulatorRecursionInstr.  If not, then</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="comment">// we are handling the case when the return instruction returns a constant C</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="comment">// which is different to the constant returned by other return instructions</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="comment">// (which is recorded in AccumulatorRecursionEliminationInitVal).  This is a</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="comment">// special case of accumulator recursion, the operation being &quot;return C&quot;.</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *AccumulatorRecursionEliminationInitVal = 0;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *AccumulatorRecursionInstr = 0;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="comment">// Ok, we found a potential tail call.  We can currently only transform the</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="comment">// tail call if all of the instructions between the call and the return are</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="comment">// movable to above the call itself, leaving the call next to the return.</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="comment">// Check that this is the case now.</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = CI;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keywordflow">for</span> (++BBI; &amp;*BBI != <a class="code" href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">Ret</a>; ++BBI) {</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">if</span> (CanMoveAboveCall(BBI, CI)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">// If we can&#39;t move the instruction above the call, it might be because it</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="comment">// is an associative and commutative operation that could be transformed</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment">// using accumulator recursion elimination.  Check to see if this is the</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="comment">// case, and if so, remember the initial accumulator value for later.</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">if</span> ((AccumulatorRecursionEliminationInitVal =</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                           CanTransformAccumulatorRecursion(BBI, CI))) {</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <span class="comment">// Yes, this is accumulator recursion.  Remember which instruction</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="comment">// accumulates.</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      AccumulatorRecursionInstr = BBI;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;   <span class="comment">// Otherwise, we cannot eliminate the tail recursion!</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  }</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="comment">// We can only transform call/return pairs that either ignore the return value</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="comment">// of the call and return void, ignore the value of the call and return a</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="comment">// constant, return the value returned by the tail call, or that are being</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="comment">// accumulator recursion variable eliminated.</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keywordflow">if</span> (Ret-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>() == 1 &amp;&amp; Ret-&gt;<a class="code" href="classllvm_1_1ReturnInst.html#a7f6ab6ba1947d832a651e3589614a10d">getReturnValue</a>() != CI &amp;&amp;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      !isa&lt;UndefValue&gt;(Ret-&gt;<a class="code" href="classllvm_1_1ReturnInst.html#a7f6ab6ba1947d832a651e3589614a10d">getReturnValue</a>()) &amp;&amp;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      AccumulatorRecursionEliminationInitVal == 0 &amp;&amp;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      !<a class="code" href="TailRecursionElimination_8cpp.html#a60ba522bf071270f84981cc956af3d36">getCommonReturnValue</a>(0, CI)) {</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">// One case remains that we are able to handle: the current return</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="comment">// instruction returns a constant, and all other return instructions</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="comment">// return a different constant.</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="TailRecursionElimination_8cpp.html#a55552678f30bafd309428c2bae96ac28">isDynamicConstant</a>(Ret-&gt;<a class="code" href="classllvm_1_1ReturnInst.html#a7f6ab6ba1947d832a651e3589614a10d">getReturnValue</a>(), CI, <a class="code" href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">Ret</a>))</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Current return instruction does not return a constant.</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="comment">// Check that all other return instructions return a common constant.  If</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="comment">// so, record it in AccumulatorRecursionEliminationInitVal.</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    AccumulatorRecursionEliminationInitVal = <a class="code" href="TailRecursionElimination_8cpp.html#a60ba522bf071270f84981cc956af3d36">getCommonReturnValue</a>(Ret, CI);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">if</span> (!AccumulatorRecursionEliminationInitVal)</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = Ret-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *F = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>();</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="comment">// OK! We can transform this tail call.  If this is the first one found,</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <span class="comment">// create the new entry block, allowing us to branch back to the old entry.</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <span class="keywordflow">if</span> (OldEntry == 0) {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    OldEntry = &amp;F-&gt;<a class="code" href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">getEntryBlock</a>();</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NewEntry = <a class="code" href="classllvm_1_1BasicBlock.html#ae1d53a21892854816885c7288f8b46f1">BasicBlock::Create</a>(F-&gt;<a class="code" href="classllvm_1_1Function.html#a2da53ac53516a3f16191f4c8a8eaa3e5">getContext</a>(), <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>, OldEntry);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    NewEntry-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(OldEntry);</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    OldEntry-&gt;<a class="code" href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">setName</a>(<span class="stringliteral">&quot;tailrecurse&quot;</span>);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html#ae9cbc599309fd2da33ec1c61df01ce1f">BranchInst::Create</a>(OldEntry, NewEntry);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="comment">// If this tail call is marked &#39;tail&#39; and if there are any allocas in the</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">// entry block, move them up to the new entry block.</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    TailCallsAreMarkedTail = CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a5e07dea70b41ad610edbfc21bd54154a">isTailCall</a>();</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordflow">if</span> (TailCallsAreMarkedTail)</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <span class="comment">// Move all fixed sized allocas from OldEntry to NewEntry.</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> OEBI = OldEntry-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), E = OldEntry-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(),</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;             NEBI = NewEntry-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); OEBI != E; )</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI = dyn_cast&lt;AllocaInst&gt;(OEBI++))</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;          <span class="keywordflow">if</span> (isa&lt;ConstantInt&gt;(AI-&gt;getArraySize()))</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            AI-&gt;moveBefore(NEBI);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="comment">// Now that we have created a new block, which jumps to the entry</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="comment">// block, insert a PHI node for each argument of the function.</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="comment">// For now, we initialize each PHI to only have the real arguments</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="comment">// which are passed in.</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertPos = OldEntry-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Function::arg_iterator</a> I = F-&gt;<a class="code" href="classllvm_1_1Function.html#a8bf193a781a92cae52d7f9216d0824f8">arg_begin</a>(), E = F-&gt;<a class="code" href="classllvm_1_1Function.html#a8300ac1ef141b8a7c63c13fa9369d976">arg_end</a>();</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;         I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = <a class="code" href="classllvm_1_1PHINode.html#afb5e83bf5123ff7c51058eb0ebebcdc6">PHINode::Create</a>(I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), 2,</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                                    I-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() + <span class="stringliteral">&quot;.tr&quot;</span>, InsertPos);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      I-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(PN); <span class="comment">// Everyone use the PHI node now!</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(I, NewEntry);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      ArgumentPHIs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(PN);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    }</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  }</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="comment">// If this function has self recursive calls in the tail position where some</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="comment">// are marked tail and some are not, only transform one flavor or another.  We</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="comment">// have to choose whether we move allocas in the entry block to the new entry</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="comment">// block or not, so we can&#39;t make a good choice for both.  NOTE: We could do</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="comment">// slightly better here in the case that the function has no entry block</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="comment">// allocas.</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="keywordflow">if</span> (TailCallsAreMarkedTail &amp;&amp; !CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a5e07dea70b41ad610edbfc21bd54154a">isTailCall</a>())</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="comment">// Ok, now that we know we have a pseudo-entry block WITH all of the</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="comment">// required PHI nodes, add entries into the PHI node for the actual</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="comment">// parameters passed into the tail-recursive call.</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#ac88b95273e6c753188f6a54d65548579">getNumArgOperands</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    ArgumentPHIs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;addIncoming(CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>), <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="comment">// If we are introducing an accumulator variable to eliminate the recursion,</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="comment">// do so now.  Note that we _know_ that no subsequent tail recursion</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="comment">// eliminations will happen on this function because of the way the</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="comment">// accumulator recursion predicate is set up.</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="keywordflow">if</span> (AccumulatorRecursionEliminationInitVal) {</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *AccRecInstr = AccumulatorRecursionInstr;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="comment">// Start by inserting a new PHI node for the accumulator.</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <a class="code" href="classllvm_1_1PredIterator.html">pred_iterator</a> PB = <a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(OldEntry), PE = <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(OldEntry);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *AccPN =</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html#afb5e83bf5123ff7c51058eb0ebebcdc6">PHINode::Create</a>(AccumulatorRecursionEliminationInitVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(),</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                      std::distance(PB, PE) + 1,</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                      <span class="stringliteral">&quot;accumulator.tr&quot;</span>, OldEntry-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="comment">// Loop over all of the predecessors of the tail recursion block.  For the</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="comment">// real entry into the function we seed the PHI with the initial value,</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">// computed earlier.  For any other existing branches to this block (due to</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="comment">// other tail recursions eliminated) the accumulator is not modified.</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="comment">// Because we haven&#39;t added the branch in the current block to OldEntry yet,</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="comment">// it will not show up as a predecessor.</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PredIterator.html">pred_iterator</a> PI = PB; PI != PE; ++PI) {</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = *PI;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <span class="keywordflow">if</span> (P == &amp;F-&gt;<a class="code" href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">getEntryBlock</a>())</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        AccPN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(AccumulatorRecursionEliminationInitVal, P);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        AccPN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(AccPN, P);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    }</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">if</span> (AccRecInstr) {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      <span class="comment">// Add an incoming argument for the current block, which is computed by</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="comment">// our associative and commutative accumulator instruction.</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      AccPN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(AccRecInstr, BB);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="comment">// Next, rewrite the accumulator recursion instruction so that it does not</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <span class="comment">// use the result of the call anymore, instead, use the PHI node we just</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      <span class="comment">// inserted.</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      AccRecInstr-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(AccRecInstr-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0) != CI, AccPN);</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <span class="comment">// Add an incoming argument for the current block, which is just the</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <span class="comment">// constant returned by the current return instruction.</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      AccPN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(Ret-&gt;<a class="code" href="classllvm_1_1ReturnInst.html#a7f6ab6ba1947d832a651e3589614a10d">getReturnValue</a>(), <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    }</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="comment">// Finally, rewrite any return instructions in the program to return the PHI</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="comment">// node instead of the &quot;initval&quot; that they do currently.  This loop will</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">// actually rewrite the return value we are destroying, but that&#39;s ok.</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Function::iterator</a> BBI = F-&gt;<a class="code" href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">begin</a>(), E = F-&gt;<a class="code" href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">end</a>(); BBI != E; ++BBI)</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *RI = dyn_cast&lt;ReturnInst&gt;(BBI-&gt;getTerminator()))</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        RI-&gt;setOperand(0, AccPN);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    ++NumAccumAdded;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="comment">// Now that all of the PHI nodes are in place, remove the call and</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="comment">// ret instructions, replacing them with an unconditional branch.</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *NewBI = <a class="code" href="classllvm_1_1BranchInst.html#ae9cbc599309fd2da33ec1c61df01ce1f">BranchInst::Create</a>(OldEntry, Ret);</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  NewBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a7bd545769621a0a9d2cfb074f86f4295">setDebugLoc</a>(CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">getDebugLoc</a>());</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#a5c2aa38108db7a66ac5e8da547f64ad7">erase</a>(Ret);  <span class="comment">// Remove return.</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#a5c2aa38108db7a66ac5e8da547f64ad7">erase</a>(CI);   <span class="comment">// Remove call.</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  ++NumEliminated;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;}</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="keywordtype">bool</span> TailCallElim::FoldReturnAndProcessPred(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                                       <a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *Ret, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *&amp;OldEntry,</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                                       <span class="keywordtype">bool</span> &amp;TailCallsAreMarkedTail,</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                                       <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;PHINode *&gt;</a> &amp;ArgumentPHIs,</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                                       <span class="keywordtype">bool</span> CannotTailCallElimCallsMarkedTail) {</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="keywordtype">bool</span> Change = <span class="keyword">false</span>;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="comment">// If the return block contains nothing but the return and PHI&#39;s,</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="comment">// there might be an opportunity to duplicate the return in its</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="comment">// predecessors and perform TRC there. Look for predecessors that end</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="comment">// in unconditional branch and recursive call(s).</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BranchInst*, 8&gt;</a> UncondBranchPreds;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PredIterator.html">pred_iterator</a> PI = <a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(BB), E = <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(BB); PI != E; ++PI) {</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = *PI;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *PTI = Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>();</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(PTI))</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="keywordflow">if</span> (BI-&gt;isUnconditional())</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        UncondBranchPreds.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(BI);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  }</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="keywordflow">while</span> (!UncondBranchPreds.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = UncondBranchPreds.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = FindTRECandidate(BI, CannotTailCallElimCallsMarkedTail)){</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;FOLDING: &quot;</span> &lt;&lt; *BB</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;INTO UNCOND BRANCH PRED: &quot;</span> &lt;&lt; *Pred);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      EliminateRecursiveTailCall(CI, <a class="code" href="namespacellvm.html#a2b8a0d5fd8cacf34a300e31e25eaa77f">FoldReturnIntoUncondBranch</a>(Ret, BB, Pred),</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                                 OldEntry, TailCallsAreMarkedTail, ArgumentPHIs,</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                                 CannotTailCallElimCallsMarkedTail);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      ++NumRetDuped;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      Change = <span class="keyword">true</span>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    }</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  }</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="keywordflow">return</span> Change;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;}</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;TailCallElim::ProcessReturningBlock(<a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *Ret, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *&amp;OldEntry,</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                                    <span class="keywordtype">bool</span> &amp;TailCallsAreMarkedTail,</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                                    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;PHINode *&gt;</a> &amp;ArgumentPHIs,</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                                    <span class="keywordtype">bool</span> CannotTailCallElimCallsMarkedTail) {</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = FindTRECandidate(Ret, CannotTailCallElimCallsMarkedTail);</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="keywordflow">if</span> (!CI)</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <span class="keywordflow">return</span> EliminateRecursiveTailCall(CI, Ret, OldEntry, TailCallsAreMarkedTail,</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                                    ArgumentPHIs,</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                                    CannotTailCallElimCallsMarkedTail);</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;}</div><div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a22a311dfe4c28a897de8a9365a4f0a84"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">llvm::SmallVectorTemplateCommon&lt; T &gt;::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00127">SmallVector.h:127</a></div></div>
<div class="ttc" id="classllvm_1_1ReturnInst_html"><div class="ttname"><a href="classllvm_1_1ReturnInst.html">llvm::ReturnInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02279">Instructions.h:2279</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_ae1a10b90f22c0478960fb5798ff73916"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">llvm::SmallVectorTemplateBase&lt; T, isPodLike&lt; T &gt;::value &gt;::push_back</a></div><div class="ttdeci">void push_back(const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00236">SmallVector.h:236</a></div></div>
<div class="ttc" id="Loads_8h_html"><div class="ttname"><a href="Loads_8h.html">Loads.h</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a748ffcf2c4af9d1fdb458470a4c368f9"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a748ffcf2c4af9d1fdb458470a4c368f9">llvm::BasicBlock::getUniquePredecessor</a></div><div class="ttdeci">BasicBlock * getUniquePredecessor()</div><div class="ttdoc">Return this block if it has a unique predecessor block. Otherwise return a null pointer. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00196">BasicBlock.cpp:196</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a089cccb6f231efee72abc76d0f9c695f"><div class="ttname"><a href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">llvm::PHINode::addIncoming</a></div><div class="ttdeci">void addIncoming(Value *V, BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02100">Instructions.h:2100</a></div></div>
<div class="ttc" id="classllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00035">PassRegistry.cpp:35</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a2da53ac53516a3f16191f4c8a8eaa3e5"><div class="ttname"><a href="classllvm_1_1Function.html#a2da53ac53516a3f16191f4c8a8eaa3e5">llvm::Function::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00167">Function.cpp:167</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a6fe2f06b8a4b2c3d6308afb223a0238a"><div class="ttname"><a href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">llvm::Instruction::eraseFromParent</a></div><div class="ttdeci">void eraseFromParent()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00072">Instruction.cpp:72</a></div></div>
<div class="ttc" id="classllvm_1_1Argument_html"><div class="ttname"><a href="classllvm_1_1Argument.html">llvm::Argument</a></div><div class="ttdoc">LLVM Argument representation. </div><div class="ttdef"><b>Definition:</b> <a href="Argument_8h_source.html#l00035">Argument.h:35</a></div></div>
<div class="ttc" id="structllvm_1_1CaptureTracker_html"><div class="ttname"><a href="structllvm_1_1CaptureTracker.html">llvm::CaptureTracker</a></div><div class="ttdef"><b>Definition:</b> <a href="CaptureTracking_8h_source.html#l00036">CaptureTracking.h:36</a></div></div>
<div class="ttc" id="Instructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="namespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">List of target independent CodeGen pass IDs. </div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l00022">APFloat.h:22</a></div></div>
<div class="ttc" id="DerivedTypes_8h_html"><div class="ttname"><a href="DerivedTypes_8h.html">DerivedTypes.h</a></div></div>
<div class="ttc" id="classllvm_1_1CallSiteBase_html_acc2eeccdf71d83b3c08d6218317a1430"><div class="ttname"><a href="classllvm_1_1CallSiteBase.html#acc2eeccdf71d83b3c08d6218317a1430">llvm::CallSiteBase::arg_end</a></div><div class="ttdeci">IterTy arg_end() const </div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00143">CallSite.h:143</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_ae4ca2261b8b901e415fda7feac5051ea"><div class="ttname"><a href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">llvm::Function::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00397">Function.h:397</a></div></div>
<div class="ttc" id="IntrinsicInst_8h_html"><div class="ttname"><a href="IntrinsicInst_8h.html">IntrinsicInst.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a3f2f98c2a67c9e79f58aad9150a62e42"><div class="ttname"><a href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">llvm::dyn_cast</a></div><div class="ttdeci">enable_if_c&lt;!is_simple_type&lt; Y &gt;::value, typename cast_retty&lt; X, const Y &gt;::ret_type &gt;::type dyn_cast(const Y &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="Casting_8h_source.html#l00266">Casting.h:266</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a2f81e0c1fc6554df7ad2eafabf5fc5a5"><div class="ttname"><a href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">llvm::User::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const </div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00108">User.h:108</a></div></div>
<div class="ttc" id="README-SSE_8txt_html_a63d206a063eefcdf8c318ded97b65020"><div class="ttname"><a href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a></div><div class="ttdeci">This currently compiles esp xmm0 movsd esp eax eax esp ret We should use not the dag combiner This is because dagcombine2 needs to be able to see through the X86ISD::Wrapper which DAGCombine can t really do The code for turning x load into a single vector load is target independent and should be moved to the dag combiner The code for turning x load into a vector load can only handle a direct load from a global or a direct load from the stack It should be generalized to handle any load from P</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00427">README-SSE.txt:427</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html"><div class="ttname"><a href="classllvm_1_1PHINode.html">llvm::PHINode</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01978">Instructions.h:1978</a></div></div>
<div class="ttc" id="Debug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html"><div class="ttname"><a href="classllvm_1_1CallInst.html">llvm::CallInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01161">Instructions.h:1161</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a573063aad4c101462893d0490d867524"><div class="ttname"><a href="classllvm_1_1Instruction.html#a573063aad4c101462893d0490d867524">llvm::Instruction::mayHaveSideEffects</a></div><div class="ttdeci">bool mayHaveSideEffects() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00324">Instruction.h:324</a></div></div>
<div class="ttc" id="TailRecursionElimination_8cpp_html_a56e52fc9cad88fd469d962f83b918cf0"><div class="ttname"><a href="TailRecursionElimination_8cpp.html#a56e52fc9cad88fd469d962f83b918cf0">tailcallelim</a></div><div class="ttdeci">tailcallelim</div><div class="ttdef"><b>Definition:</b> <a href="TailRecursionElimination_8cpp_source.html#l00122">TailRecursionElimination.cpp:122</a></div></div>
<div class="ttc" id="InlineCost_8h_html"><div class="ttname"><a href="InlineCost_8h.html">InlineCost.h</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_aca229503e4f5c83a187a6a921c625fa8"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">llvm::BasicBlock::getParent</a></div><div class="ttdeci">const Function * getParent() const </div><div class="ttdoc">Return the enclosing method, or null if none. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00116">BasicBlock.h:116</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a8300ac1ef141b8a7c63c13fa9369d976"><div class="ttname"><a href="classllvm_1_1Function.html#a8300ac1ef141b8a7c63c13fa9369d976">llvm::Function::arg_end</a></div><div class="ttdeci">arg_iterator arg_end()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00418">Function.h:418</a></div></div>
<div class="ttc" id="classllvm_1_1PredIterator_html"><div class="ttname"><a href="classllvm_1_1PredIterator.html">llvm::PredIterator</a></div><div class="ttdef"><b>Definition:</b> <a href="Support_2CFG_8h_source.html#l00029">Support/CFG.h:29</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a33603355becfb1a050b62aa015c1cc57"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a33603355becfb1a050b62aa015c1cc57">llvm::BasicBlock::front</a></div><div class="ttdeci">const Instruction &amp; front() const </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00205">BasicBlock.h:205</a></div></div>
<div class="ttc" id="LLParser_8cpp_html_a33ece1ef8074506a15d7f86eb76dbae6"><div class="ttname"><a href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a></div><div class="ttdeci">F(f)</div></div>
<div class="ttc" id="namespacellvm_html_a2bb15e529c55b5356aabfb006d1e98aa"><div class="ttname"><a href="namespacellvm.html#a2bb15e529c55b5356aabfb006d1e98aa">llvm::isSafeToLoadUnconditionally</a></div><div class="ttdeci">bool isSafeToLoadUnconditionally(Value *V, Instruction *ScanFrom, unsigned Align, const DataLayout *TD=0)</div><div class="ttdef"><b>Definition:</b> <a href="Loads_8cpp_source.html#l00056">Loads.cpp:56</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00070">Function.h:70</a></div></div>
<div class="ttc" id="classllvm_1_1LoadInst_html"><div class="ttname"><a href="classllvm_1_1LoadInst.html">llvm::LoadInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00136">Instructions.h:136</a></div></div>
<div class="ttc" id="InstructionSimplify_8h_html"><div class="ttname"><a href="InstructionSimplify_8h.html">InstructionSimplify.h</a></div></div>
<div class="ttc" id="Statistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a7bd545769621a0a9d2cfb074f86f4295"><div class="ttname"><a href="classllvm_1_1Instruction.html#a7bd545769621a0a9d2cfb074f86f4295">llvm::Instruction::setDebugLoc</a></div><div class="ttdeci">void setDebugLoc(const DebugLoc &amp;Loc)</div><div class="ttdoc">setDebugLoc - Set the debug location information for this instruction. </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00175">Instruction.h:175</a></div></div>
<div class="ttc" id="CallSite_8h_html"><div class="ttname"><a href="CallSite_8h.html">CallSite.h</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad452febc1ac0b394876e640ec03ffa38"><div class="ttname"><a href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00167">Value.cpp:167</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0ed5f3ab3c2e4196ee0cffffa080c062"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">llvm::BasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00193">BasicBlock.h:193</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html_ae5c60fd282ee894c87ea02c3f0fcb6d0"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">llvm::AnalysisUsage::addRequired</a></div><div class="ttdeci">AnalysisUsage &amp; addRequired()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00055">PassAnalysisSupport.h:55</a></div></div>
<div class="ttc" id="CaptureTracking_8h_html"><div class="ttname"><a href="CaptureTracking_8h.html">CaptureTracking.h</a></div></div>
<div class="ttc" id="classllvm_1_1ReturnInst_html_a7f6ab6ba1947d832a651e3589614a10d"><div class="ttname"><a href="classllvm_1_1ReturnInst.html#a7f6ab6ba1947d832a651e3589614a10d">llvm::ReturnInst::getReturnValue</a></div><div class="ttdeci">Value * getReturnValue() const </div><div class="ttdoc">Convenience accessor. Returns null if there is no return value. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02318">Instructions.h:2318</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a400eaca9881c8dcab97e9f42b1ab1815"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">llvm::SmallVectorImpl::pop_back_val</a></div><div class="ttdeci">T LLVM_ATTRIBUTE_UNUSED_RESULT pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00430">SmallVector.h:430</a></div></div>
<div class="ttc" id="classllvm_1_1Use_html"><div class="ttname"><a href="classllvm_1_1Use.html">llvm::Use</a></div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00060">Use.h:60</a></div></div>
<div class="ttc" id="PassSupport_8h_html_a74ce8276b89067e806f67c45a6d92575"><div class="ttname"><a href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a></div><div class="ttdeci">#define INITIALIZE_PASS_END(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00172">PassSupport.h:172</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00035">APInt.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_ac88b95273e6c753188f6a54d65548579"><div class="ttname"><a href="classllvm_1_1CallInst.html#ac88b95273e6c753188f6a54d65548579">llvm::CallInst::getNumArgOperands</a></div><div class="ttdeci">unsigned getNumArgOperands() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01241">Instructions.h:1241</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html_ae9cbc599309fd2da33ec1c61df01ce1f"><div class="ttname"><a href="classllvm_1_1BranchInst.html#ae9cbc599309fd2da33ec1c61df01ce1f">llvm::BranchInst::Create</a></div><div class="ttdeci">static BranchInst * Create(BasicBlock *IfTrue, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02373">Instructions.h:2373</a></div></div>
<div class="ttc" id="STLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="namespacefalse_html"><div class="ttname"><a href="namespacefalse.html">false</a></div><div class="ttdef"><b>Definition:</b> <a href="StackSlotColoring_8cpp_source.html#l00126">StackSlotColoring.cpp:126</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a35ee267850af7c235474a8c46c7ac5af"><div class="ttname"><a href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">llvm::Value::setName</a></div><div class="ttdeci">void setName(const Twine &amp;Name)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00175">Value.cpp:175</a></div></div>
<div class="ttc" id="namespacellvm_1_1CallingConv_html_a4f861731fc6dbfdccc05af5968d98974"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">llvm::CallingConv::ID</a></div><div class="ttdeci">ID</div><div class="ttdoc">LLVM Calling Convention Representation. </div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00026">CallingConv.h:26</a></div></div>
<div class="ttc" id="TailRecursionElimination_8cpp_html_a1264977982aab76bcb6c0afe0a8775db"><div class="ttname"><a href="TailRecursionElimination_8cpp.html#a1264977982aab76bcb6c0afe0a8775db">STATISTIC</a></div><div class="ttdeci">STATISTIC(NumEliminated,&quot;Number of tail calls removed&quot;)</div></div>
<div class="ttc" id="classllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00031">Instruction.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorBase_html_a8a8df4d85555c7954a95f86080cd3b64"><div class="ttname"><a href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">llvm::SmallVectorBase::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00056">SmallVector.h:56</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_aa113b8a9ef3de9c2f075a046ad658717"><div class="ttname"><a href="classllvm_1_1Instruction.html#aa113b8a9ef3de9c2f075a046ad658717">llvm::Instruction::isAssociative</a></div><div class="ttdeci">bool isAssociative() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00482">Instruction.cpp:482</a></div></div>
<div class="ttc" id="SmallPtrSet_8h_html"><div class="ttname"><a href="SmallPtrSet_8h.html">SmallPtrSet.h</a></div></div>
<div class="ttc" id="namespacellvm_html_af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51"><div class="ttname"><a href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">llvm::Call</a></div><div class="ttdef"><b>Definition:</b> <a href="CallingConvLower_8h_source.html#l00149">CallingConvLower.h:149</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00303">Value.cpp:303</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ae855357b6c5e6e7ed1869272708a3a84"><div class="ttname"><a href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">llvm::Value::takeName</a></div><div class="ttdeci">void takeName(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00239">Value.cpp:239</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a88a5e60837674780a9d812d661897ac5"><div class="ttname"><a href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">llvm::Function::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00395">Function.h:395</a></div></div>
<div class="ttc" id="classllvm_1_1CallSiteBase_html_a9c293af587813d72fdc976697dd07f23"><div class="ttname"><a href="classllvm_1_1CallSiteBase.html#a9c293af587813d72fdc976697dd07f23">llvm::CallSiteBase&lt; Function, Value, User, Instruction, CallInst, InvokeInst, User::op_iterator &gt;::arg_iterator</a></div><div class="ttdeci">User::op_iterator arg_iterator</div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00133">CallSite.h:133</a></div></div>
<div class="ttc" id="namespacellvm_1_1AArch64ISD_html_a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e"><div class="ttname"><a href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">llvm::AArch64ISD::Ret</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64ISelLowering_8h_source.html#l00060">AArch64ISelLowering.h:60</a></div></div>
<div class="ttc" id="classllvm_1_1TerminatorInst_html"><div class="ttname"><a href="classllvm_1_1TerminatorInst.html">llvm::TerminatorInst</a></div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00035">InstrTypes.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00072">BasicBlock.h:72</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html"><div class="ttname"><a href="classllvm_1_1BranchInst.html">llvm::BranchInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02350">Instructions.h:2350</a></div></div>
<div class="ttc" id="namespacellvm_html_a0ea2361bffa7838dd88ff68a438f1ecf"><div class="ttname"><a href="namespacellvm.html#a0ea2361bffa7838dd88ff68a438f1ecf">llvm::createTailCallEliminationPass</a></div><div class="ttdeci">FunctionPass * createTailCallEliminationPass()</div><div class="ttdef"><b>Definition:</b> <a href="TailRecursionElimination_8cpp_source.html#l00126">TailRecursionElimination.cpp:126</a></div></div>
<div class="ttc" id="Support_2CFG_8h_html"><div class="ttname"><a href="Support_2CFG_8h.html">CFG.h</a></div></div>
<div class="ttc" id="Constants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="TailRecursionElimination_8cpp_html_a55552678f30bafd309428c2bae96ac28"><div class="ttname"><a href="TailRecursionElimination_8cpp.html#a55552678f30bafd309428c2bae96ac28">isDynamicConstant</a></div><div class="ttdeci">static bool isDynamicConstant(Value *V, CallInst *CI, ReturnInst *RI)</div><div class="ttdef"><b>Definition:</b> <a href="TailRecursionElimination_8cpp_source.html#l00306">TailRecursionElimination.cpp:306</a></div></div>
<div class="ttc" id="namespacellvm_html_a7e108932dc3da5294aed99a353aac9c4"><div class="ttname"><a href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">llvm::pred_begin</a></div><div class="ttdeci">Interval::pred_iterator pred_begin(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00117">Interval.h:117</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_aab8e16a35183ce39aad394714087bcff"><div class="ttname"><a href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">llvm::Instruction::getDebugLoc</a></div><div class="ttdeci">const DebugLoc &amp; getDebugLoc() const </div><div class="ttdoc">getDebugLoc - Return the debug location for this node as a DebugLoc. </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00178">Instruction.h:178</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00037">PassAnalysisSupport.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_afb5e83bf5123ff7c51058eb0ebebcdc6"><div class="ttname"><a href="classllvm_1_1PHINode.html#afb5e83bf5123ff7c51058eb0ebebcdc6">llvm::PHINode::Create</a></div><div class="ttdeci">static PHINode * Create(Type *Ty, unsigned NumReservedValues, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02013">Instructions.h:2013</a></div></div>
<div class="ttc" id="namespacellvm_html_aa1704159f75e6eacd595962ea6d93ffe"><div class="ttname"><a href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a></div><div class="ttdeci">ItTy next(ItTy it, Dist n)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00154">STLExtras.h:154</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a531d11ba36ed48d86057d507cc8d5567"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">llvm::BasicBlock::getInstList</a></div><div class="ttdeci">const InstListType &amp; getInstList() const </div><div class="ttdoc">Return the underlying instruction list container. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00214">BasicBlock.h:214</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionPass_html"><div class="ttname"><a href="classllvm_1_1FunctionPass.html">llvm::FunctionPass</a></div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00293">Pass.h:293</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a997ff6a1758bf732b9b263fc61011644"><div class="ttname"><a href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">llvm::User::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00088">User.h:88</a></div></div>
<div class="ttc" id="namespacellvm_html_a5eeaf08e96168c2cac8960f87f0ef360"><div class="ttname"><a href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">llvm::pred_end</a></div><div class="ttdeci">Interval::pred_iterator pred_end(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00120">Interval.h:120</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a1c2048f254df730c4de1643ec791ddf9"><div class="ttname"><a href="classllvm_1_1Instruction.html#a1c2048f254df730c4de1643ec791ddf9">llvm::Instruction::isCommutative</a></div><div class="ttdeci">bool isCommutative() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00269">Instruction.h:269</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a8bf193a781a92cae52d7f9216d0824f8"><div class="ttname"><a href="classllvm_1_1Function.html#a8bf193a781a92cae52d7f9216d0824f8">llvm::Function::arg_begin</a></div><div class="ttdeci">arg_iterator arg_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00410">Function.h:410</a></div></div>
<div class="ttc" id="TailRecursionElimination_8cpp_html_a8b5e010ec24b31e0466f88d3b583d97b"><div class="ttname"><a href="TailRecursionElimination_8cpp.html#a8b5e010ec24b31e0466f88d3b583d97b">Elimination</a></div><div class="ttdeci">Tail Call Elimination</div><div class="ttdef"><b>Definition:</b> <a href="TailRecursionElimination_8cpp_source.html#l00122">TailRecursionElimination.cpp:122</a></div></div>
<div class="ttc" id="PassSupport_8h_html_af0564bcdde2dd4400c670ca278c6035f"><div class="ttname"><a href="PassSupport_8h.html#af0564bcdde2dd4400c670ca278c6035f">INITIALIZE_AG_DEPENDENCY</a></div><div class="ttdeci">#define INITIALIZE_AG_DEPENDENCY(depName)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00169">PassSupport.h:169</a></div></div>
<div class="ttc" id="namespacellvm_html_a50f8f41fccbea466816345520e9bfabb"><div class="ttname"><a href="namespacellvm.html#a50f8f41fccbea466816345520e9bfabb">llvm::SimplifyInstruction</a></div><div class="ttdeci">Value * SimplifyInstruction(Instruction *I, const DataLayout *TD=0, const TargetLibraryInfo *TLI=0, const DominatorTree *DT=0)</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8cpp_source.html#l03036">InstructionSimplify.cpp:3036</a></div></div>
<div class="ttc" id="namespacellvm_html_a0b8531ebccf07d33408272bd51999962"><div class="ttname"><a href="namespacellvm.html#a0b8531ebccf07d33408272bd51999962">llvm::PointerMayBeCaptured</a></div><div class="ttdeci">bool PointerMayBeCaptured(const Value *V, bool ReturnCaptures, bool StoreCaptures)</div><div class="ttdef"><b>Definition:</b> <a href="CaptureTracking_8cpp_source.html#l00061">CaptureTracking.cpp:61</a></div></div>
<div class="ttc" id="classllvm_1_1iplist_html_a5c2aa38108db7a66ac5e8da547f64ad7"><div class="ttname"><a href="classllvm_1_1iplist.html#a5c2aa38108db7a66ac5e8da547f64ad7">llvm::iplist::erase</a></div><div class="ttdeci">iterator erase(iterator where)</div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00465">ilist.h:465</a></div></div>
<div class="ttc" id="TailRecursionElimination_8cpp_html_a60ba522bf071270f84981cc956af3d36"><div class="ttname"><a href="TailRecursionElimination_8cpp.html#a60ba522bf071270f84981cc956af3d36">getCommonReturnValue</a></div><div class="ttdeci">static Value * getCommonReturnValue(ReturnInst *IgnoreRI, CallInst *CI)</div><div class="ttdef"><b>Definition:</b> <a href="TailRecursionElimination_8cpp_source.html#l00341">TailRecursionElimination.cpp:341</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_aa26de3d6e38997b9041e824ea558c770"><div class="ttname"><a href="classllvm_1_1Instruction.html#aa26de3d6e38997b9041e824ea558c770">llvm::Instruction::mayWriteToMemory</a></div><div class="ttdeci">bool mayWriteToMemory() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00441">Instruction.cpp:441</a></div></div>
<div class="ttc" id="classllvm_1_1ilist__iterator_html"><div class="ttname"><a href="classllvm_1_1ilist__iterator.html">llvm::ilist_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00050">ilist.h:50</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html">llvm::SmallPtrSet</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00236">SmallPtrSet.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1TargetTransformInfo_html"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html">llvm::TargetTransformInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00039">TargetTransformInfo.h:39</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00029">Target/README.txt:29</a></div></div>
<div class="ttc" id="TailRecursionElimination_8cpp_html_a43c6edf4b9facf9ba13368f67c65f653"><div class="ttname"><a href="TailRecursionElimination_8cpp.html#a43c6edf4b9facf9ba13368f67c65f653">INITIALIZE_PASS_BEGIN</a></div><div class="ttdeci">INITIALIZE_PASS_BEGIN(TailCallElim,&quot;tailcallelim&quot;,&quot;Tail Call Elimination&quot;, false, false) INITIALIZE_PASS_END(TailCallElim</div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0b4e7bee9b8575cc7db73329f1a561bd"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">llvm::BasicBlock::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00195">BasicBlock.h:195</a></div></div>
<div class="ttc" id="TailRecursionElimination_8cpp_html_a0f880faf6d322eaf7440ff13ea5351c8"><div class="ttname"><a href="TailRecursionElimination_8cpp.html#a0f880faf6d322eaf7440ff13ea5351c8">FirstNonDbg</a></div><div class="ttdeci">static Instruction * FirstNonDbg(BasicBlock::iterator I)</div><div class="ttdef"><b>Definition:</b> <a href="TailRecursionElimination_8cpp_source.html#l00389">TailRecursionElimination.cpp:389</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00880">SmallVector.h:880</a></div></div>
<div class="ttc" id="Module_8h_html"><div class="ttname"><a href="Module_8h.html">Module.h</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a0cf3748dba54f931bb1241ae4adc76bc"><div class="ttname"><a href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00111">Value.h:111</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_a0bcd4131e1a1d92215f5385b4e16cd2e"><div class="ttname"><a href="classllvm_1_1CallInst.html#a0bcd4131e1a1d92215f5385b4e16cd2e">llvm::CallInst::getCalledFunction</a></div><div class="ttdeci">Function * getCalledFunction() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01357">Instructions.h:1357</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a30f2c362631e3728d2f47a8203071ade"><div class="ttname"><a href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">llvm::Function::getEntryBlock</a></div><div class="ttdeci">const BasicBlock &amp; getEntryBlock() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00380">Function.h:380</a></div></div>
<div class="ttc" id="TailRecursionElimination_8cpp_html_a433aaebc4120630d0522d3f4b1d1e4a6"><div class="ttname"><a href="TailRecursionElimination_8cpp.html#a433aaebc4120630d0522d3f4b1d1e4a6">CanTRE</a></div><div class="ttdeci">static bool CanTRE(AllocaInst *AI)</div><div class="ttdef"><b>Definition:</b> <a href="TailRecursionElimination_8cpp_source.html#l00137">TailRecursionElimination.cpp:137</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a5fa9b8e1842b354f64c1ba6be0a4a17f"><div class="ttname"><a href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">llvm::User::setOperand</a></div><div class="ttdeci">void setOperand(unsigned i, Value *Val)</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00092">User.h:92</a></div></div>
<div class="ttc" id="namespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs - Return a circular-buffered debug stream. </div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00101">Debug.cpp:101</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_a150b33ecedbc8c7803c2db8040fbe3f8"><div class="ttname"><a href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">llvm::CallInst::getArgOperand</a></div><div class="ttdeci">Value * getArgOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01245">Instructions.h:1245</a></div></div>
<div class="ttc" id="namespacellvm_html_a2bf5c022e65321bcf45328366c64276a"><div class="ttname"><a href="namespacellvm.html#a2bf5c022e65321bcf45328366c64276a">llvm::initializeTailCallElimPass</a></div><div class="ttdeci">void initializeTailCallElimPass(PassRegistry &amp;)</div></div>
<div class="ttc" id="CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="CodeGen_2README_8txt_source.html#l00036">CodeGen/README.txt:36</a></div></div>
<div class="ttc" id="Pass_8h_html"><div class="ttname"><a href="Pass_8h.html">Pass.h</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a5ac211f24970dea81fa9a7118a8ce36b"><div class="ttname"><a href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">llvm::Instruction::use_back</a></div><div class="ttdeci">Instruction * use_back()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00049">Instruction.h:49</a></div></div>
<div class="ttc" id="Function_8h_html"><div class="ttname"><a href="Function_8h.html">Function.h</a></div></div>
<div class="ttc" id="ValueHandle_8h_html"><div class="ttname"><a href="ValueHandle_8h.html">ValueHandle.h</a></div></div>
<div class="ttc" id="Transforms_2Scalar_8h_html"><div class="ttname"><a href="Transforms_2Scalar_8h.html">Scalar.h</a></div></div>
<div class="ttc" id="MD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00054">MD5.cpp:54</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a5cb76a65b6524dba1493dd2b9dc3abbe"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">llvm::BasicBlock::getTerminator</a></div><div class="ttdeci">TerminatorInst * getTerminator()</div><div class="ttdoc">Returns the terminator instruction if the block is well formed or null if the block is not well forme...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00120">BasicBlock.cpp:120</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_adf66d58e85fb4e46e9c1ae55186a6930"><div class="ttname"><a href="classllvm_1_1Function.html#adf66d58e85fb4e46e9c1ae55186a6930">llvm::Function::getFunctionType</a></div><div class="ttdeci">FunctionType * getFunctionType() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00171">Function.cpp:171</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a085b82f074c28030fb8e194377ed2d0c"><div class="ttname"><a href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">llvm::Value::hasOneUse</a></div><div class="ttdeci">bool hasOneUse() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00161">Value.h:161</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_ab79bcc780b834b4aab6e392c55831e2a"><div class="ttname"><a href="classllvm_1_1Function.html#ab79bcc780b834b4aab6e392c55831e2a">llvm::Function::callsFunctionThatReturnsTwice</a></div><div class="ttdeci">bool callsFunctionThatReturnsTwice() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00728">Function.cpp:728</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_a5e07dea70b41ad610edbfc21bd54154a"><div class="ttname"><a href="classllvm_1_1CallInst.html#a5e07dea70b41ad610edbfc21bd54154a">llvm::CallInst::isTailCall</a></div><div class="ttdeci">bool isTailCall() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01230">Instructions.h:1230</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_ae1d53a21892854816885c7288f8b46f1"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#ae1d53a21892854816885c7288f8b46f1">llvm::BasicBlock::Create</a></div><div class="ttdeci">static BasicBlock * Create(LLVMContext &amp;Context, const Twine &amp;Name=&quot;&quot;, Function *Parent=0, BasicBlock *InsertBefore=0)</div><div class="ttdoc">Creates a new BasicBlock. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00109">BasicBlock.h:109</a></div></div>
<div class="ttc" id="BasicBlockUtils_8h_html"><div class="ttname"><a href="BasicBlockUtils_8h.html">BasicBlockUtils.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a2b8a0d5fd8cacf34a300e31e25eaa77f"><div class="ttname"><a href="namespacellvm.html#a2b8a0d5fd8cacf34a300e31e25eaa77f">llvm::FoldReturnIntoUncondBranch</a></div><div class="ttdeci">ReturnInst * FoldReturnIntoUncondBranch(ReturnInst *RI, BasicBlock *BB, BasicBlock *Pred)</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00594">BasicBlockUtils.cpp:594</a></div></div>
<div class="ttc" id="classllvm_1_1CallSiteBase_html_affa0f3ae92ab8696fccd107c0addf5a2"><div class="ttname"><a href="classllvm_1_1CallSiteBase.html#affa0f3ae92ab8696fccd107c0addf5a2">llvm::CallSiteBase::arg_begin</a></div><div class="ttdeci">IterTy arg_begin() const </div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00137">CallSite.h:137</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionType_html_ab9b67f93a2231970abb3d95636660ffc"><div class="ttname"><a href="classllvm_1_1FunctionType.html#ab9b67f93a2231970abb3d95636660ffc">llvm::FunctionType::isVarArg</a></div><div class="ttdeci">bool isVarArg() const </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00120">DerivedTypes.h:120</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html"><div class="ttname"><a href="classllvm_1_1SwitchInst.html">llvm::SwitchInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02449">Instructions.h:2449</a></div></div>
<div class="ttc" id="Local_8h_html"><div class="ttname"><a href="Local_8h.html">Local.h</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00066">Value.h:66</a></div></div>
<div class="ttc" id="classllvm_1_1AllocaInst_html_a642f52c0f081ad0de10258c1d8d67b23"><div class="ttname"><a href="classllvm_1_1AllocaInst.html#a642f52c0f081ad0de10258c1d8d67b23">llvm::AllocaInst::getArraySize</a></div><div class="ttdeci">const Value * getArraySize() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00086">Instructions.h:86</a></div></div>
<div class="ttc" id="Debug_8h_html_aef41e8aaf4c60819b30faf396cdf4978"><div class="ttname"><a href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a></div><div class="ttdeci">#define DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00097">Debug.h:97</a></div></div>
<div class="ttc" id="raw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="TargetTransformInfo_8h_html"><div class="ttname"><a href="TargetTransformInfo_8h.html">TargetTransformInfo.h</a></div></div>
<div class="ttc" id="classllvm_1_1CallSite_html"><div class="ttname"><a href="classllvm_1_1CallSite.html">llvm::CallSite</a></div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00295">CallSite.h:295</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a9cd49851904f15060edb782ef4dd1b2d"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00052">Instruction.h:52</a></div></div>
<div class="ttc" id="classllvm_1_1AllocaInst_html"><div class="ttname"><a href="classllvm_1_1AllocaInst.html">llvm::AllocaInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00058">Instructions.h:58</a></div></div>
<div class="ttc" id="Compiler_8h_html_a68c26c4a3531dcda6b04ab5ca7955947"><div class="ttname"><a href="Compiler_8h.html#a68c26c4a3531dcda6b04ab5ca7955947">LLVM_OVERRIDE</a></div><div class="ttdeci">#define LLVM_OVERRIDE</div><div class="ttdef"><b>Definition:</b> <a href="Compiler_8h_source.html#l00155">Compiler.h:155</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<p class="footer">
Generated on Sat Nov 10 2018 23:02:50 for <a href="http://llvm.org/">LLVM</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.8.11</a><br>
Copyright &copy; 2003-2013 University of Illinois at Urbana-Champaign.
All Rights Reserved.</p>
<hr>
<!--#include virtual="/attrib.incl" -->
</body>
</html>
