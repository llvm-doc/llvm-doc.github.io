<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="LLVM,Low Level Virtual Machine,C++,doxygen,API,documentation"/>
<meta name="description" content="C++ source code API documentation for LLVM."/>
<title>LLVM: LoopStrengthReduce.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">LLVM API Documentation</p>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('LoopStrengthReduce_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">LoopStrengthReduce.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="LoopStrengthReduce_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- LoopStrengthReduce.cpp - Strength Reduce IVs in Loops --------------===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                     The LLVM Compiler Infrastructure</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is distributed under the University of Illinois Open Source</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License. See LICENSE.TXT for details.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// This transformation analyzes and transforms the induction variables (and</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// computations derived from them) into forms suitable for efficient execution</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// on the target.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// This pass performs a strength reduction on array references inside loops that</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// have as one or more of their components the loop induction variable, it</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// rewrites expressions to take advantage of scaled-index addressing modes</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// available on the target, and it performs a variety of other optimizations</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// related to loop induction variables.</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">// Terminology note: this code has a lot of handling for &quot;post-increment&quot; or</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">// &quot;post-inc&quot; users. This is not talking about post-increment addressing modes;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">// it is instead talking about code like this:</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//   %i = phi [ 0, %entry ], [ %i.next, %latch ]</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">//   ...</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">//   %i.next = add %i, 1</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">//   %c = icmp eq %i.next, %n</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">// The SCEV for %i is {0,+,1}&lt;%L&gt;. The SCEV for %i.next is {1,+,1}&lt;%L&gt;, however</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">// it&#39;s useful to think about these as the same register, with some uses using</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">// the value of the register before the add and some using // it after. In this</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">// example, the icmp is a post-increment user, since it uses %i.next, which is</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">// the value of the induction variable after the increment. The other common</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">// case of post-increment users is users outside the loop.</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">// TODO: More sophistication in the way Formulae are generated and filtered.</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">// TODO: Handle multiple loops at a time.</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">// TODO: Should the addressing mode BaseGV be changed to a ConstantExpr instead</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">//       of a GlobalValue?</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">// TODO: When truncation is free, truncate ICmp users&#39; operands to make it a</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">//       smaller encoding (on x86 at least).</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">// TODO: When a negated register is used by an add (such as in a list of</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">//       multiple base registers, or as the increment expression in an addrec),</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">//       we may not actually need both reg and (-1 * reg) in registers; the</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">//       negation can be implemented by using a sub instead of an add. The</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">//       lack of support for taking this into consideration when making</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">//       register pressure decisions is partly worked around by the &quot;Special&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">//       use kind.</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   56</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;loop-reduce&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Transforms_2Scalar_8h.html">llvm/Transforms/Scalar.h</a>&quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseSet_8h.html">llvm/ADT/DenseSet.h</a>&quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SetVector_8h.html">llvm/ADT/SetVector.h</a>&quot;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallBitVector_8h.html">llvm/ADT/SmallBitVector.h</a>&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Dominators_8h.html">llvm/Analysis/Dominators.h</a>&quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IVUsers_8h.html">llvm/Analysis/IVUsers.h</a>&quot;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LoopPass_8h.html">llvm/Analysis/LoopPass.h</a>&quot;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ScalarEvolutionExpander_8h.html">llvm/Analysis/ScalarEvolutionExpander.h</a>&quot;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetTransformInfo_8h.html">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Writer_8h.html">llvm/Assembly/Writer.h</a>&quot;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DerivedTypes_8h.html">llvm/IR/DerivedTypes.h</a>&quot;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IntrinsicInst_8h.html">llvm/IR/IntrinsicInst.h</a>&quot;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueHandle_8h.html">llvm/Support/ValueHandle.h</a>&quot;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlockUtils_8h.html">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Local_8h.html">llvm/Transforms/Utils/Local.h</a>&quot;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">/// MaxIVUsers is an arbitrary threshold that provides an early opportunitiy for</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">/// bail out. This threshold is far beyond the number of users that LSR can</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">/// conceivably solve, so it should not affect generated code, but catches the</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">/// worst cases before LSR burns too much compile time and stack space.</span></div><div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a73b3c5e7c72bf97886e2ed1f12e28d54">   85</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a73b3c5e7c72bf97886e2ed1f12e28d54">MaxIVUsers</a> = 200;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">// Temporary flag to cleanup congruent phis after LSR phi expansion.</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">// It&#39;s currently disabled until we can determine whether it&#39;s truly useful or</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">// not. The flag should be removed after the v3.0 release.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">// This is now needed for ivchains.</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="LoopStrengthReduce_8cpp.html#add283613989eaa5682d8f97d6b9a8fd4">EnablePhiElim</a>(</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="stringliteral">&quot;enable-lsr-phielim&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Enable LSR phi elimination&quot;</span>));</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">// Stress test IV chain generation.</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a> <a class="code" href="LoopStrengthReduce_8cpp.html#a215e6a56a2614297e0d0fd643464ba11">StressIVChain</a>(</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="stringliteral">&quot;stress-ivchain&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Stress test LSR IV chains&quot;</span>));</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a215e6a56a2614297e0d0fd643464ba11">StressIVChain</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">/// RegSortData - This class holds data which is used to order reuse candidates.</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"></span><span class="keyword">class </span>RegSortData {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="keyword">public</span>:<span class="comment"></span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">  /// UsedByIndices - This represents the set of LSRUse indices which reference</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">  /// a particular register.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> UsedByIndices;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  RegSortData() {}</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordtype">void</span> print(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS) <span class="keyword">const</span>;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>() <span class="keyword">const</span>;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;};</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;}</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="keywordtype">void</span> RegSortData::print(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS)<span class="keyword"> const </span>{</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  OS &lt;&lt; <span class="stringliteral">&quot;[NumUses=&quot;</span> &lt;&lt; UsedByIndices.count() &lt;&lt; <span class="charliteral">&#39;]&#39;</span>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;}</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor">#if !defined(NDEBUG) || defined(LLVM_ENABLE_DUMP)</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">RegSortData::dump</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  print(<a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>()); <a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;}</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">/// RegUseTracker - Map register candidates to information about how they are</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">/// used.</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment"></span><span class="keyword">class </span>RegUseTracker {</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const SCEV *, RegSortData&gt;</a> RegUsesTy;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  RegUsesTy RegUsesMap;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 16&gt;</a> RegSequence;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordtype">void</span> CountRegister(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a>, <span class="keywordtype">size_t</span> LUIdx);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordtype">void</span> DropRegister(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a>, <span class="keywordtype">size_t</span> LUIdx);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordtype">void</span> SwapAndDropUse(<span class="keywordtype">size_t</span> LUIdx, <span class="keywordtype">size_t</span> LastLUIdx);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordtype">bool</span> isRegUsedByUsesOtherThan(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a>, <span class="keywordtype">size_t</span> LUIdx) <span class="keyword">const</span>;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> &amp;getUsedByIndices(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a>) <span class="keyword">const</span>;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordtype">void</span> clear();</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classT.html">SmallVectorImpl&lt;const SCEV *&gt;::iterator</a> iterator;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a> const_iterator;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  iterator <a class="code" href="namespacellvm_1_1sys_1_1path.html#a33706aab89e700b8f79e1fa6f4f0e3ee">begin</a>() { <span class="keywordflow">return</span> RegSequence.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(); }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  iterator <a class="code" href="namespacellvm_1_1sys_1_1path.html#a214ec2f04ffd92636ed4bd2717607a1d">end</a>()   { <span class="keywordflow">return</span> RegSequence.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); }</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  const_iterator <a class="code" href="namespacellvm_1_1sys_1_1path.html#a33706aab89e700b8f79e1fa6f4f0e3ee">begin</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> RegSequence.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(); }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  const_iterator <a class="code" href="namespacellvm_1_1sys_1_1path.html#a214ec2f04ffd92636ed4bd2717607a1d">end</a>()<span class="keyword"> const   </span>{ <span class="keywordflow">return</span> RegSequence.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;};</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;}</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;RegUseTracker::CountRegister(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a>, <span class="keywordtype">size_t</span> LUIdx) {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  std::pair&lt;RegUsesTy::iterator, bool&gt; Pair =</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    RegUsesMap.insert(std::make_pair(Reg, RegSortData()));</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  RegSortData &amp;RSD = Pair.first-&gt;second;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordflow">if</span> (Pair.second)</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    RegSequence.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Reg);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  RSD.UsedByIndices.resize(std::max(RSD.UsedByIndices.size(), LUIdx + 1));</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  RSD.UsedByIndices.set(LUIdx);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;}</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;RegUseTracker::DropRegister(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Reg, <span class="keywordtype">size_t</span> LUIdx) {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  RegUsesTy::iterator It = RegUsesMap.find(Reg);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  assert(It != RegUsesMap.end());</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  RegSortData &amp;RSD = It-&gt;second;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  assert(RSD.UsedByIndices.size() &gt; LUIdx);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  RSD.UsedByIndices.reset(LUIdx);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;}</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;RegUseTracker::SwapAndDropUse(<span class="keywordtype">size_t</span> LUIdx, <span class="keywordtype">size_t</span> LastLUIdx) {</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  assert(LUIdx &lt;= LastLUIdx);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="comment">// Update RegUses. The data structure is not optimized for this purpose;</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="comment">// we must iterate through it and update each of the bit vectors.</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordflow">for</span> (RegUsesTy::iterator <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = RegUsesMap.begin(), E = RegUsesMap.end();</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> &amp;UsedByIndices = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second.UsedByIndices;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">if</span> (LUIdx &lt; UsedByIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#a4858616488fffbdebc85aad588b175c4">size</a>())</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      UsedByIndices[LUIdx] =</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        LastLUIdx &lt; UsedByIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#a4858616488fffbdebc85aad588b175c4">size</a>() ? UsedByIndices[LastLUIdx] : 0;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    UsedByIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#aa79d9a55d612eb330a0e25dc4170470d">resize</a>(std::min(UsedByIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#a4858616488fffbdebc85aad588b175c4">size</a>(), LastLUIdx));</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;}</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;RegUseTracker::isRegUsedByUsesOtherThan(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Reg, <span class="keywordtype">size_t</span> LUIdx)<span class="keyword"> const </span>{</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  RegUsesTy::const_iterator <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = RegUsesMap.find(Reg);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">if</span> (I == RegUsesMap.end())</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> &amp;UsedByIndices = I-&gt;second.UsedByIndices;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = UsedByIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#a486e5364d2ad0d281f7627750f5f829a">find_first</a>();</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">if</span> (i == -1) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordflow">if</span> ((<span class="keywordtype">size_t</span>)i != LUIdx) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">return</span> UsedByIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#aec7155f96e634c2d65d82c5be3285a5f">find_next</a>(i) != -1;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;}</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> &amp;RegUseTracker::getUsedByIndices(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Reg)<span class="keyword"> const </span>{</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  RegUsesTy::const_iterator I = RegUsesMap.find(Reg);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  assert(I != RegUsesMap.end() &amp;&amp; <span class="stringliteral">&quot;Unknown register!&quot;</span>);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordflow">return</span> I-&gt;second.UsedByIndices;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;}</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="keywordtype">void</span> RegUseTracker::clear() {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  RegUsesMap.<a class="code" href="classllvm_1_1SmallBitVector.html#a7d809e29a928b187955f2858a9d98583">clear</a>();</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  RegSequence.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;}</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">/// Formula - This class holds information that describes a formula for</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">/// computing satisfying a use. It may include broken-out immediates and scaled</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">/// registers.</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment"></span><span class="keyword">struct </span>Formula {<span class="comment"></span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">  /// Global base address used for complex addressing.</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *BaseGV;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">  /// Base offset for complex addressing.</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment"></span>  int64_t BaseOffset;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">  /// Whether any complex addressing has a base register.</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> HasBaseReg;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">  /// The scale of any complex addressing.</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment"></span>  int64_t Scale;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">  /// BaseRegs - The list of &quot;base&quot; registers for this use. When this is</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">  /// non-empty,</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> BaseRegs;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">  /// ScaledReg - The &#39;scaled&#39; register for this use. This should be non-null</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">  /// when Scale is not zero.</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *ScaledReg;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">  /// UnfoldedOffset - An additional constant offset which added near the</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">  /// use. This requires a temporary register, but the offset itself can</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">  /// live in an add immediate field rather than a register.</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment"></span>  int64_t UnfoldedOffset;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  Formula()</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      : BaseGV(0), BaseOffset(0), HasBaseReg(<a class="code" href="namespacefalse.html">false</a>), Scale(0), ScaledReg(0),</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        UnfoldedOffset(0) {}</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordtype">void</span> InitialMatch(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordtype">unsigned</span> getNumRegs() <span class="keyword">const</span>;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="namespacellvm_1_1Intrinsic.html#ac015f68d60ea67a2e31bc10bc720d3e8">getType</a>() <span class="keyword">const</span>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordtype">void</span> DeleteBaseReg(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *&amp;<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordtype">bool</span> referencesReg(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>) <span class="keyword">const</span>;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordtype">bool</span> hasRegsUsedByUsesOtherThan(<span class="keywordtype">size_t</span> LUIdx,</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                                  <span class="keyword">const</span> RegUseTracker &amp;RegUses) <span class="keyword">const</span>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordtype">void</span> print(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS) <span class="keyword">const</span>;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>() <span class="keyword">const</span>;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;};</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">/// DoInitialMatch - Recursion helper for InitialMatch.</span></div><div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#aa59a46776e15b1f1bd597c4e1e769f59">  274</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="LoopStrengthReduce_8cpp.html#aa59a46776e15b1f1bd597c4e1e769f59">DoInitialMatch</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L,</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                           <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;</a> &amp;Good,</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                           <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;</a> &amp;Bad,</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                           <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE) {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="comment">// Collect expressions which properly dominate the loop header.</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ae0d036af111b8aafe90db0771b8e9ce3">properlyDominates</a>(S, L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>())) {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    Good.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(S);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  }</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="comment">// Look at add operands.</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddExpr.html">SCEVAddExpr</a> *Add = dyn_cast&lt;SCEVAddExpr&gt;(S)) {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SCEVNAryExpr.html#a82ad83d40ce0e57efef84b421c7f805a">SCEVAddExpr::op_iterator</a> I = Add-&gt;op_begin(), E = Add-&gt;op_end();</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;         I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <a class="code" href="LoopStrengthReduce_8cpp.html#aa59a46776e15b1f1bd597c4e1e769f59">DoInitialMatch</a>(*I, L, Good, Bad, SE);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">// Look at addrec operands.</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddRecExpr.html">SCEVAddRecExpr</a> *AR = dyn_cast&lt;SCEVAddRecExpr&gt;(S))</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">if</span> (!AR-&gt;getStart()-&gt;isZero()) {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <a class="code" href="LoopStrengthReduce_8cpp.html#aa59a46776e15b1f1bd597c4e1e769f59">DoInitialMatch</a>(AR-&gt;getStart(), L, Good, Bad, SE);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <a class="code" href="LoopStrengthReduce_8cpp.html#aa59a46776e15b1f1bd597c4e1e769f59">DoInitialMatch</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a659b27f6737fcb7eaf333b0279da1154">getAddRecExpr</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(AR-&gt;getType(), 0),</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                                      AR-&gt;getStepRecurrence(SE),</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                                      <span class="comment">// FIXME: AR-&gt;getNoWrapFlags()</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                                      AR-&gt;getLoop(), <a class="code" href="classllvm_1_1SCEV.html#af43000d4dcb7d6d63cb6e36933ed3f6fa23e74052c4d79cfdaa23460a3c946656">SCEV::FlagAnyWrap</a>),</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                     L, Good, Bad, SE);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    }</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="comment">// Handle a multiplication by -1 (negation) if it didn&#39;t fold.</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVMulExpr.html">SCEVMulExpr</a> *Mul = dyn_cast&lt;SCEVMulExpr&gt;(S))</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">if</span> (Mul-&gt;getOperand(0)-&gt;isAllOnesValue()) {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> Ops(Mul-&gt;op_begin()+1, Mul-&gt;op_end());</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *NewMul = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad5829d76e14852080c205f8b94d830f1">getMulExpr</a>(Ops);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> MyGood;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> MyBad;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <a class="code" href="LoopStrengthReduce_8cpp.html#aa59a46776e15b1f1bd597c4e1e769f59">DoInitialMatch</a>(NewMul, L, MyGood, MyBad, SE);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *NegOne = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(<a class="code" href="classllvm_1_1Constant.html#a4d51384de6e1798bb6aa875aebeea9f0">ConstantInt::getAllOnesValue</a>(</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#abb976145b00ae108c1d6b98c4f099d27">getEffectiveSCEVType</a>(NewMul-&gt;getType())));</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a> I = MyGood.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;           E = MyGood.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        Good.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad5829d76e14852080c205f8b94d830f1">getMulExpr</a>(NegOne, *I));</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a> I = MyBad.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;           E = MyBad.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        Bad.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad5829d76e14852080c205f8b94d830f1">getMulExpr</a>(NegOne, *I));</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    }</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="comment">// Ok, we can&#39;t do anything interesting. Just stuff the whole thing into a</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="comment">// register and hope for the best.</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  Bad.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(S);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;}</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">/// InitialMatch - Incorporate loop-variant parts of S into this Formula,</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">/// attempting to keep all loop-invariant and loop-computable values in a</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">/// single base register.</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> Formula::InitialMatch(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>, <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE) {</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> Good;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> Bad;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <a class="code" href="LoopStrengthReduce_8cpp.html#aa59a46776e15b1f1bd597c4e1e769f59">DoInitialMatch</a>(S, L, Good, Bad, SE);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordflow">if</span> (!Good.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="Target_2X86_2README_8txt.html#a0ed5c5d6ff68f354e354920a3680185c">Sum</a> = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(Good);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span> (!Sum-&gt;<a class="code" href="classllvm_1_1SCEV.html#a3f76d2fd4788225548dc36ef9e417030">isZero</a>())</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      BaseRegs.push_back(Sum);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    HasBaseReg = <span class="keyword">true</span>;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keywordflow">if</span> (!Bad.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="Target_2X86_2README_8txt.html#a0ed5c5d6ff68f354e354920a3680185c">Sum</a> = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(Bad);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">if</span> (!Sum-&gt;<a class="code" href="classllvm_1_1SCEV.html#a3f76d2fd4788225548dc36ef9e417030">isZero</a>())</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      BaseRegs.push_back(Sum);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    HasBaseReg = <span class="keyword">true</span>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">/// getNumRegs - Return the total number of register operands used by this</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">/// formula. This does not include register uses implied by non-constant</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">/// addrec strides.</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment"></span><span class="keywordtype">unsigned</span> Formula::getNumRegs()<span class="keyword"> const </span>{</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="keywordflow">return</span> !!ScaledReg + BaseRegs.size();</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;}</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">/// getType - Return the type of this formula, if it has one, or null</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">/// otherwise. This type is meaningless except for the bit size.</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="namespacellvm_1_1Intrinsic.html#ac015f68d60ea67a2e31bc10bc720d3e8">Formula::getType</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">return</span> !BaseRegs.empty() ? BaseRegs.front()-&gt;getType() :</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;         ScaledReg ? ScaledReg-&gt;getType() :</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;         BaseGV ? BaseGV-&gt;getType() :</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;         0;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;}</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">/// DeleteBaseReg - Delete the given base reg from the BaseRegs list.</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> Formula::DeleteBaseReg(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *&amp;S) {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keywordflow">if</span> (&amp;S != &amp;BaseRegs.back())</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(S, BaseRegs.back());</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  BaseRegs.pop_back();</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;}</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">/// referencesReg - Test if this formula references the given register.</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> Formula::referencesReg(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *S)<span class="keyword"> const </span>{</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="keywordflow">return</span> S == ScaledReg ||</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;         std::find(BaseRegs.begin(), BaseRegs.end(), <a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>) != BaseRegs.end();</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;}</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">/// hasRegsUsedByUsesOtherThan - Test whether this formula uses registers</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">/// which are used by uses other than the use with the given index.</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> Formula::hasRegsUsedByUsesOtherThan(<span class="keywordtype">size_t</span> LUIdx,</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                                         <span class="keyword">const</span> RegUseTracker &amp;RegUses)<span class="keyword"> const </span>{</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordflow">if</span> (ScaledReg)</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">if</span> (RegUses.isRegUsedByUsesOtherThan(ScaledReg, LUIdx))</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a> I = BaseRegs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;       E = BaseRegs.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordflow">if</span> (RegUses.isRegUsedByUsesOtherThan(*I, LUIdx))</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;}</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="keywordtype">void</span> Formula::print(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS)<span class="keyword"> const </span>{</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="Target_2README_8txt.html#ab24db72f7bd10b13351812874015861b">First</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordflow">if</span> (BaseGV) {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">if</span> (!First) OS &lt;&lt; <span class="stringliteral">&quot; + &quot;</span>; <span class="keywordflow">else</span> First = <span class="keyword">false</span>;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <a class="code" href="namespacellvm.html#ae712552495c21ee77ad82ced255ad6df">WriteAsOperand</a>(OS, BaseGV, <span class="comment">/*PrintType=*/</span><span class="keyword">false</span>);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordflow">if</span> (BaseOffset != 0) {</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">if</span> (!First) OS &lt;&lt; <span class="stringliteral">&quot; + &quot;</span>; <span class="keywordflow">else</span> First = <span class="keyword">false</span>;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    OS &lt;&lt; BaseOffset;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a> I = BaseRegs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;       E = BaseRegs.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">if</span> (!First) OS &lt;&lt; <span class="stringliteral">&quot; + &quot;</span>; <span class="keywordflow">else</span> First = <span class="keyword">false</span>;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;reg(&quot;</span> &lt;&lt; **I &lt;&lt; <span class="charliteral">&#39;)&#39;</span>;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keywordflow">if</span> (HasBaseReg &amp;&amp; BaseRegs.empty()) {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">if</span> (!First) OS &lt;&lt; <span class="stringliteral">&quot; + &quot;</span>; <span class="keywordflow">else</span> First = <span class="keyword">false</span>;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;**error: HasBaseReg**&quot;</span>;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!HasBaseReg &amp;&amp; !BaseRegs.empty()) {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordflow">if</span> (!First) OS &lt;&lt; <span class="stringliteral">&quot; + &quot;</span>; <span class="keywordflow">else</span> First = <span class="keyword">false</span>;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;**error: !HasBaseReg**&quot;</span>;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  }</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordflow">if</span> (Scale != 0) {</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">if</span> (!First) OS &lt;&lt; <span class="stringliteral">&quot; + &quot;</span>; <span class="keywordflow">else</span> First = <span class="keyword">false</span>;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    OS &lt;&lt; Scale &lt;&lt; <span class="stringliteral">&quot;*reg(&quot;</span>;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">if</span> (ScaledReg)</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      OS &lt;&lt; *ScaledReg;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      OS &lt;&lt; <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    OS &lt;&lt; <span class="charliteral">&#39;)&#39;</span>;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordflow">if</span> (UnfoldedOffset != 0) {</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">if</span> (!First) OS &lt;&lt; <span class="stringliteral">&quot; + &quot;</span>; <span class="keywordflow">else</span> First = <span class="keyword">false</span>;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;imm(&quot;</span> &lt;&lt; UnfoldedOffset &lt;&lt; <span class="charliteral">&#39;)&#39;</span>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  }</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;}</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="preprocessor">#if !defined(NDEBUG) || defined(LLVM_ENABLE_DUMP)</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">Formula::dump</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  print(<a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>()); <a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;}</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">/// isAddRecSExtable - Return true if the given addrec can be sign-extended</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">/// without changing its value.</span></div><div class="line"><a name="l00438"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a9b6b892760677b9b11c517eb5a46557f">  438</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a9b6b892760677b9b11c517eb5a46557f">isAddRecSExtable</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddRecExpr.html">SCEVAddRecExpr</a> *AR, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE) {</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *WideTy =</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#aa89f44fd7549e81b02f2be1be894f098">getContext</a>(), SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(AR-&gt;<a class="code" href="classllvm_1_1SCEVNAryExpr.html#aed1b1d3b764c76210c67dd1b4a6be2f2">getType</a>()) + 1);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="keywordflow">return</span> isa&lt;SCEVAddRecExpr&gt;(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a63d4f693eb205bb9d556e067464f943c">getSignExtendExpr</a>(AR, WideTy));</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;}</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">/// isAddSExtable - Return true if the given add can be sign-extended</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">/// without changing its value.</span></div><div class="line"><a name="l00446"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a1509f8a0c11e955037b00ce7542e24a7">  446</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a1509f8a0c11e955037b00ce7542e24a7">isAddSExtable</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddExpr.html">SCEVAddExpr</a> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE) {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *WideTy =</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#aa89f44fd7549e81b02f2be1be894f098">getContext</a>(), SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(A-&gt;<a class="code" href="classllvm_1_1SCEVAddExpr.html#adaa7ea82a902c95919c4bb6f7f6bf904">getType</a>()) + 1);</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordflow">return</span> isa&lt;SCEVAddExpr&gt;(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a63d4f693eb205bb9d556e067464f943c">getSignExtendExpr</a>(A, WideTy));</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;}</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">/// isMulSExtable - Return true if the given mul can be sign-extended</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">/// without changing its value.</span></div><div class="line"><a name="l00454"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a32cdb4a97c185f1acbe11f45fcc70d12">  454</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a32cdb4a97c185f1acbe11f45fcc70d12">isMulSExtable</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVMulExpr.html">SCEVMulExpr</a> *<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE) {</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *WideTy =</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#aa89f44fd7549e81b02f2be1be894f098">getContext</a>(),</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                     SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(M-&gt;<a class="code" href="classllvm_1_1SCEVNAryExpr.html#aed1b1d3b764c76210c67dd1b4a6be2f2">getType</a>()) * M-&gt;<a class="code" href="classllvm_1_1SCEVNAryExpr.html#a97221eb4fea7333f0b7b35b35e1169b2">getNumOperands</a>());</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keywordflow">return</span> isa&lt;SCEVMulExpr&gt;(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a63d4f693eb205bb9d556e067464f943c">getSignExtendExpr</a>(M, WideTy));</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;}</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">/// getExactSDiv - Return an expression for LHS /s RHS, if it can be determined</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">/// and if the remainder is known to be zero,  or null otherwise. If</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">/// IgnoreSignificantBits is true, expressions like (X * Y) /s Y are simplified</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">/// to Y, ignoring that the multiplication may overflow, which is useful when</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">/// the result will be used in a context where the most significant bits are</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">/// ignored.</span></div><div class="line"><a name="l00467"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a1fc3b7fba8416494790a73f61248b553">  467</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="LoopStrengthReduce_8cpp.html#a1fc3b7fba8416494790a73f61248b553">getExactSDiv</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *LHS, <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *RHS,</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                                <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE,</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                                <span class="keywordtype">bool</span> IgnoreSignificantBits = <span class="keyword">false</span>) {</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="comment">// Handle the trivial case, which works for any SCEV type.</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">if</span> (LHS == RHS)</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">return</span> SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(LHS-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>(), 1);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="comment">// Handle a few RHS special cases.</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a> *RC = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a>&gt;(RHS);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="keywordflow">if</span> (RC) {</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;RA = RC-&gt;<a class="code" href="classllvm_1_1SCEVConstant.html#a64f0133adf37f9513005465580a19a66">getValue</a>()-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>();</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="comment">// Handle x /s -1 as x * -1, to give ScalarEvolution a chance to do</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="comment">// some folding.</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">if</span> (RA.<a class="code" href="classllvm_1_1APInt.html#a21260f8037e665d235ace5718cf68bc4">isAllOnesValue</a>())</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <span class="keywordflow">return</span> SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad5829d76e14852080c205f8b94d830f1">getMulExpr</a>(LHS, RC);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="comment">// Handle x /s 1 as x.</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">if</span> (RA == 1)</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="keywordflow">return</span> LHS;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  }</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="comment">// Check for a division of a constant by a constant.</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;SCEVConstant&gt;(LHS)) {</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">if</span> (!RC)</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;LA = <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue()-&gt;getValue();</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;RA = RC-&gt;<a class="code" href="classllvm_1_1SCEVConstant.html#a64f0133adf37f9513005465580a19a66">getValue</a>()-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>();</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">if</span> (LA.<a class="code" href="classllvm_1_1APInt.html#aab38583da48d509785e3571edec58183">srem</a>(RA) != 0)</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">return</span> SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(LA.<a class="code" href="classllvm_1_1APInt.html#a482ad0f63ec145fdba2497e2298a5aa1">sdiv</a>(RA));</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  }</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="comment">// Distribute the sdiv over addrec operands, if the addrec doesn&#39;t overflow.</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddRecExpr.html">SCEVAddRecExpr</a> *AR = dyn_cast&lt;SCEVAddRecExpr&gt;(LHS)) {</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">if</span> (IgnoreSignificantBits || <a class="code" href="LoopStrengthReduce_8cpp.html#a9b6b892760677b9b11c517eb5a46557f">isAddRecSExtable</a>(AR, SE)) {</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Step = <a class="code" href="LoopStrengthReduce_8cpp.html#a1fc3b7fba8416494790a73f61248b553">getExactSDiv</a>(AR-&gt;getStepRecurrence(SE), RHS, SE,</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                                      IgnoreSignificantBits);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <span class="keywordflow">if</span> (!Step) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Start = <a class="code" href="LoopStrengthReduce_8cpp.html#a1fc3b7fba8416494790a73f61248b553">getExactSDiv</a>(AR-&gt;getStart(), RHS, SE,</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                                       IgnoreSignificantBits);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="keywordflow">if</span> (!Start) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="comment">// FlagNW is independent of the start value, step direction, and is</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <span class="comment">// preserved with smaller magnitude steps.</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <span class="comment">// FIXME: AR-&gt;getNoWrapFlags(SCEV::FlagNW)</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="keywordflow">return</span> SE.getAddRecExpr(Start, Step, AR-&gt;getLoop(), <a class="code" href="classllvm_1_1SCEV.html#af43000d4dcb7d6d63cb6e36933ed3f6fa23e74052c4d79cfdaa23460a3c946656">SCEV::FlagAnyWrap</a>);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    }</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  }</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="comment">// Distribute the sdiv over add operands, if the add doesn&#39;t overflow.</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddExpr.html">SCEVAddExpr</a> *Add = dyn_cast&lt;SCEVAddExpr&gt;(LHS)) {</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordflow">if</span> (IgnoreSignificantBits || <a class="code" href="LoopStrengthReduce_8cpp.html#a1509f8a0c11e955037b00ce7542e24a7">isAddSExtable</a>(Add, SE)) {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 8&gt;</a> Ops;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SCEVNAryExpr.html#a82ad83d40ce0e57efef84b421c7f805a">SCEVAddExpr::op_iterator</a> I = Add-&gt;op_begin(), E = Add-&gt;op_end();</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;           I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Op = <a class="code" href="LoopStrengthReduce_8cpp.html#a1fc3b7fba8416494790a73f61248b553">getExactSDiv</a>(*I, RHS, SE,</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                                      IgnoreSignificantBits);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keywordflow">if</span> (!Op) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Op);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      }</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <span class="keywordflow">return</span> SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(Ops);</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    }</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  }</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="comment">// Check for a multiply operand that we can pull RHS out of.</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVMulExpr.html">SCEVMulExpr</a> *Mul = dyn_cast&lt;SCEVMulExpr&gt;(LHS)) {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordflow">if</span> (IgnoreSignificantBits || <a class="code" href="LoopStrengthReduce_8cpp.html#a32cdb4a97c185f1acbe11f45fcc70d12">isMulSExtable</a>(Mul, SE)) {</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> Ops;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="keywordtype">bool</span> Found = <span class="keyword">false</span>;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SCEVNAryExpr.html#a82ad83d40ce0e57efef84b421c7f805a">SCEVMulExpr::op_iterator</a> I = Mul-&gt;op_begin(), E = Mul-&gt;op_end();</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;           I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *S = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keywordflow">if</span> (!Found)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Q = <a class="code" href="LoopStrengthReduce_8cpp.html#a1fc3b7fba8416494790a73f61248b553">getExactSDiv</a>(S, RHS, SE,</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                                           IgnoreSignificantBits)) {</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            S = Q;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            Found = <span class="keyword">true</span>;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;          }</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(S);</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      }</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">return</span> Found ? SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad5829d76e14852080c205f8b94d830f1">getMulExpr</a>(Ops) : 0;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    }</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  }</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="comment">// Otherwise we don&#39;t know.</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;}</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">/// ExtractImmediate - If S involves the addition of a constant integer value,</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">/// return that integer value, and mutate S to point to a new SCEV with that</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">/// value excluded.</span></div><div class="line"><a name="l00559"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#ac2da0a3b05aba66c95b7f0b91b5c7c55">  559</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> int64_t <a class="code" href="LoopStrengthReduce_8cpp.html#ac2da0a3b05aba66c95b7f0b91b5c7c55">ExtractImmediate</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *&amp;S, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE) {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;SCEVConstant&gt;(S)) {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue()-&gt;getValue().getMinSignedBits() &lt;= 64) {</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      S = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getType(), 0);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue()-&gt;getSExtValue();</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    }</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddExpr.html">SCEVAddExpr</a> *Add = dyn_cast&lt;SCEVAddExpr&gt;(S)) {</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 8&gt;</a> NewOps(Add-&gt;op_begin(), Add-&gt;op_end());</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    int64_t Result = <a class="code" href="LoopStrengthReduce_8cpp.html#ac2da0a3b05aba66c95b7f0b91b5c7c55">ExtractImmediate</a>(NewOps.front(), SE);</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordflow">if</span> (Result != 0)</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      S = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(NewOps);</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">return</span> Result;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddRecExpr.html">SCEVAddRecExpr</a> *AR = dyn_cast&lt;SCEVAddRecExpr&gt;(S)) {</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 8&gt;</a> NewOps(AR-&gt;op_begin(), AR-&gt;op_end());</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    int64_t Result = <a class="code" href="LoopStrengthReduce_8cpp.html#ac2da0a3b05aba66c95b7f0b91b5c7c55">ExtractImmediate</a>(NewOps.front(), SE);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">if</span> (Result != 0)</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      S = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a659b27f6737fcb7eaf333b0279da1154">getAddRecExpr</a>(NewOps, AR-&gt;getLoop(),</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                           <span class="comment">// FIXME: AR-&gt;getNoWrapFlags(SCEV::FlagNW)</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                           <a class="code" href="classllvm_1_1SCEV.html#af43000d4dcb7d6d63cb6e36933ed3f6fa23e74052c4d79cfdaa23460a3c946656">SCEV::FlagAnyWrap</a>);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">return</span> Result;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  }</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;}</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">/// ExtractSymbol - If S involves the addition of a GlobalValue address,</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">/// return that symbol, and mutate S to point to a new SCEV with that</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">/// value excluded.</span></div><div class="line"><a name="l00586"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a88366d91f44b9aa74c0408339b23b509">  586</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *<a class="code" href="LoopStrengthReduce_8cpp.html#a88366d91f44b9aa74c0408339b23b509">ExtractSymbol</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *&amp;S, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE) {</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVUnknown.html">SCEVUnknown</a> *U = dyn_cast&lt;SCEVUnknown&gt;(S)) {</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *GV = dyn_cast&lt;GlobalValue&gt;(U-&gt;getValue())) {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      S = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(GV-&gt;getType(), 0);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="keywordflow">return</span> GV;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    }</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddExpr.html">SCEVAddExpr</a> *Add = dyn_cast&lt;SCEVAddExpr&gt;(S)) {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 8&gt;</a> NewOps(Add-&gt;op_begin(), Add-&gt;op_end());</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *Result = <a class="code" href="LoopStrengthReduce_8cpp.html#a88366d91f44b9aa74c0408339b23b509">ExtractSymbol</a>(NewOps.back(), SE);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordflow">if</span> (Result)</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      S = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(NewOps);</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">return</span> Result;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddRecExpr.html">SCEVAddRecExpr</a> *AR = dyn_cast&lt;SCEVAddRecExpr&gt;(S)) {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 8&gt;</a> NewOps(AR-&gt;op_begin(), AR-&gt;op_end());</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *Result = <a class="code" href="LoopStrengthReduce_8cpp.html#a88366d91f44b9aa74c0408339b23b509">ExtractSymbol</a>(NewOps.front(), SE);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keywordflow">if</span> (Result)</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      S = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a659b27f6737fcb7eaf333b0279da1154">getAddRecExpr</a>(NewOps, AR-&gt;getLoop(),</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                           <span class="comment">// FIXME: AR-&gt;getNoWrapFlags(SCEV::FlagNW)</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                           <a class="code" href="classllvm_1_1SCEV.html#af43000d4dcb7d6d63cb6e36933ed3f6fa23e74052c4d79cfdaa23460a3c946656">SCEV::FlagAnyWrap</a>);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">return</span> Result;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  }</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;}</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">/// isAddressUse - Returns true if the specified instruction is using the</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">/// specified value as an address.</span></div><div class="line"><a name="l00612"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#ad291a495c56b2c53e65dc8afe823b073">  612</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ad291a495c56b2c53e65dc8afe823b073">isAddressUse</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1Value.html">Value</a> *OperandVal) {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keywordtype">bool</span> isAddress = isa&lt;LoadInst&gt;(Inst);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(Inst)) {</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">if</span> (SI-&gt;getOperand(1) == OperandVal)</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      isAddress = <span class="keyword">true</span>;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II = dyn_cast&lt;IntrinsicInst&gt;(Inst)) {</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="comment">// Addressing modes can also be folded into prefetches and a variety</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="comment">// of intrinsics.</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordflow">switch</span> (II-&gt;getIntrinsicID()) {</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ab2f7e70ed06cb0e8b85773f9d858e9c3">Intrinsic::prefetch</a>:</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ac3a45308c2814e385046198c11f79bfe">Intrinsic::x86_sse_storeu_ps</a>:</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90a75f892c9958157f8cc32c269e880a8b7">Intrinsic::x86_sse2_storeu_pd</a>:</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90a3512192e06440d9892109eda52ea7244">Intrinsic::x86_sse2_storeu_dq</a>:</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90a48512bbd76143cefbda53ba3c7137b94">Intrinsic::x86_sse2_storel_dq</a>:</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="keywordflow">if</span> (II-&gt;getArgOperand(0) == OperandVal)</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;          isAddress = <span class="keyword">true</span>;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    }</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  }</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="keywordflow">return</span> isAddress;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;}</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">/// getAccessType - Return the type of the memory being accessed.</span></div><div class="line"><a name="l00636"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a4f07d245cf5f31e5b86ee80c06ab949a">  636</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="LoopStrengthReduce_8cpp.html#a4f07d245cf5f31e5b86ee80c06ab949a">getAccessType</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst) {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy = Inst-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>();</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(Inst))</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    AccessTy = SI-&gt;getOperand(0)-&gt;getType();</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II = dyn_cast&lt;IntrinsicInst&gt;(Inst)) {</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">// Addressing modes can also be folded into prefetches and a variety</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="comment">// of intrinsics.</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keywordflow">switch</span> (II-&gt;getIntrinsicID()) {</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ac3a45308c2814e385046198c11f79bfe">Intrinsic::x86_sse_storeu_ps</a>:</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90a75f892c9958157f8cc32c269e880a8b7">Intrinsic::x86_sse2_storeu_pd</a>:</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90a3512192e06440d9892109eda52ea7244">Intrinsic::x86_sse2_storeu_dq</a>:</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90a48512bbd76143cefbda53ba3c7137b94">Intrinsic::x86_sse2_storel_dq</a>:</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      AccessTy = II-&gt;getArgOperand(0)-&gt;getType();</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    }</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  }</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="comment">// All pointers have the same requirements, so canonicalize them to an</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="comment">// arbitrary pointer type to minimize variation.</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PointerType.html">PointerType</a> *PTy = dyn_cast&lt;PointerType&gt;(AccessTy))</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    AccessTy = <a class="code" href="classllvm_1_1PointerType.html#a050a395d1656e546679d8b144d951bb2">PointerType::get</a>(<a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(PTy-&gt;getContext(), 1),</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                                PTy-&gt;getAddressSpace());</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="keywordflow">return</span> AccessTy;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;}</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">/// isExistingPhi - Return true if this AddRec is already a phi in its loop.</span></div><div class="line"><a name="l00664"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a3c81223cabf643af27adba3b3ceb680c">  664</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a3c81223cabf643af27adba3b3ceb680c">isExistingPhi</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddRecExpr.html">SCEVAddRecExpr</a> *AR, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE) {</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> I = AR-&gt;<a class="code" href="classllvm_1_1SCEVAddRecExpr.html#a7fcbbc51eef313e675a2442bb2053ae9">getLoop</a>()-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;       <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ae9623974341419bfd1d185cfdc65bedd">isSCEVable</a>(PN-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()) &amp;&amp;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#abb976145b00ae108c1d6b98c4f099d27">getEffectiveSCEVType</a>(PN-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()) ==</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;         SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#abb976145b00ae108c1d6b98c4f099d27">getEffectiveSCEVType</a>(AR-&gt;<a class="code" href="classllvm_1_1SCEVNAryExpr.html#aed1b1d3b764c76210c67dd1b4a6be2f2">getType</a>())) &amp;&amp;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(PN) == AR)</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  }</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;}</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment">/// Check if expanding this expression is likely to incur significant cost. This</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment">/// is tricky because SCEV doesn&#39;t track which expressions are actually computed</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment">/// by the current IR.</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">/// We currently allow expansion of IV increments that involve adds,</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">/// multiplication by constants, and AddRecs from existing phis.</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">/// TODO: Allow UDivExpr if we can find an existing IV increment that is an</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">/// obvious multiple of the UDivExpr.</span></div><div class="line"><a name="l00685"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#ab64b1c61d33b56b06309856e9f9ccf9d">  685</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ab64b1c61d33b56b06309856e9f9ccf9d">isHighCostExpansion</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *S,</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                                <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV*, 8&gt;</a> &amp;Processed,</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                                <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE) {</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="comment">// Zero/One operand expressions</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keywordflow">switch</span> (S-&gt;<a class="code" href="classllvm_1_1SCEV.html#ac08c8d9d93b387dc10681b6f156095bf">getSCEVType</a>()) {</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5a80488550b42b6548ec4d5c7118c7ff1d">scUnknown</a>:</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5abcb1f797cb330e61a5879fc260aaec5b">scConstant</a>:</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5ad3656bcc84af213cc488acb56c60de22">scTruncate</a>:</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ab64b1c61d33b56b06309856e9f9ccf9d">isHighCostExpansion</a>(cast&lt;SCEVTruncateExpr&gt;(S)-&gt;getOperand(),</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                               Processed, SE);</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5add4a8d5cb0d78c9be22d01e1546bafc6">scZeroExtend</a>:</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ab64b1c61d33b56b06309856e9f9ccf9d">isHighCostExpansion</a>(cast&lt;SCEVZeroExtendExpr&gt;(S)-&gt;getOperand(),</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                               Processed, SE);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5ad05711646a19cb20775cfbc8ef0a8c09">scSignExtend</a>:</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ab64b1c61d33b56b06309856e9f9ccf9d">isHighCostExpansion</a>(cast&lt;SCEVSignExtendExpr&gt;(S)-&gt;getOperand(),</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                               Processed, SE);</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  }</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keywordflow">if</span> (!Processed.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(S))</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddExpr.html">SCEVAddExpr</a> *Add = dyn_cast&lt;SCEVAddExpr&gt;(S)) {</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SCEVNAryExpr.html#a82ad83d40ce0e57efef84b421c7f805a">SCEVAddExpr::op_iterator</a> I = Add-&gt;op_begin(), E = Add-&gt;op_end();</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;         I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="LoopStrengthReduce_8cpp.html#ab64b1c61d33b56b06309856e9f9ccf9d">isHighCostExpansion</a>(*I, Processed, SE))</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    }</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  }</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVMulExpr.html">SCEVMulExpr</a> *Mul = dyn_cast&lt;SCEVMulExpr&gt;(S)) {</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">if</span> (Mul-&gt;getNumOperands() == 2) {</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <span class="comment">// Multiplication by a constant is ok</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      <span class="keywordflow">if</span> (isa&lt;SCEVConstant&gt;(Mul-&gt;getOperand(0)))</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ab64b1c61d33b56b06309856e9f9ccf9d">isHighCostExpansion</a>(Mul-&gt;getOperand(1), Processed, SE);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      <span class="comment">// If we have the value of one operand, check if an existing</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="comment">// multiplication already generates this expression.</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVUnknown.html">SCEVUnknown</a> *U = dyn_cast&lt;SCEVUnknown&gt;(Mul-&gt;getOperand(1))) {</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *UVal = U-&gt;getValue();</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = UVal-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), UE = UVal-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;             UI != UE; ++UI) {</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;          <span class="comment">// If U is a constant, it may be used by a ConstantExpr.</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;          <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(*UI);</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;          <span class="keywordflow">if</span> (User &amp;&amp; User-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>() == Instruction::Mul</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;              &amp;&amp; SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ae9623974341419bfd1d185cfdc65bedd">isSCEVable</a>(User-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())) {</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            <span class="keywordflow">return</span> SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(User) == Mul;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;          }</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        }</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      }</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    }</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  }</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddRecExpr.html">SCEVAddRecExpr</a> *AR = dyn_cast&lt;SCEVAddRecExpr&gt;(S)) {</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="LoopStrengthReduce_8cpp.html#a3c81223cabf643af27adba3b3ceb680c">isExistingPhi</a>(AR, SE))</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  }</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  <span class="comment">// Fow now, consider any other type of expression (div/mul/min/max) high cost.</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;}</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment">/// DeleteTriviallyDeadInstructions - If any of the instructions is the</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment">/// specified set are trivially dead, delete them and see if this makes any of</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment">/// their operands subsequently dead.</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span></div><div class="line"><a name="l00752"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#afc5995e3a119d2cf2da1c4707890d1f3">  752</a></span>&#160;<a class="code" href="LoopStrengthReduce_8cpp.html#afc5995e3a119d2cf2da1c4707890d1f3">DeleteTriviallyDeadInstructions</a>(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;WeakVH&gt;</a> &amp;DeadInsts) {</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="keywordflow">while</span> (!DeadInsts.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = DeadInsts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I = dyn_cast_or_null&lt;Instruction&gt;(V);</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="keywordflow">if</span> (I == 0 || !<a class="code" href="namespacellvm.html#abe283966f269761ee387642061c4451e">isInstructionTriviallyDead</a>(I))</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> OI = I-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>(), E = I-&gt;<a class="code" href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">op_end</a>(); OI != E; ++OI)</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *U = dyn_cast&lt;Instruction&gt;(*OI)) {</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        *OI = 0;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="keywordflow">if</span> (U-&gt;use_empty())</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;          DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(U);</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;      }</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  }</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;}</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="keyword">class </span>LSRUse;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;}</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment">// Check if it is legal to fold 2 base registers.</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ac7db1af29fc90ec685f6f0c2bc39d3ef">isLegal2RegAMUse</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI, <span class="keyword">const</span> LSRUse &amp;LU,</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                             <span class="keyword">const</span> Formula &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>);</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment">// Get the cost of the scaling factor used in F for LU.</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ae4cc657febc6dbfa190deb899e1f0126">getScalingFactorCost</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI,</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                                     <span class="keyword">const</span> LSRUse &amp;LU, <span class="keyword">const</span> Formula &amp;F);</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment">/// Cost - This class is used to measure and compare candidate formulae.</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment"></span><span class="keyword">class </span>Cost {<span class="comment"></span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">  /// TODO: Some of these could be merged. Also, a lexical ordering</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment">  /// isn&#39;t always optimal.</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment"></span>  <span class="keywordtype">unsigned</span> NumRegs;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="keywordtype">unsigned</span> AddRecCost;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <span class="keywordtype">unsigned</span> NumIVMuls;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="keywordtype">unsigned</span> NumBaseAdds;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="keywordtype">unsigned</span> ImmCost;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="keywordtype">unsigned</span> SetupCost;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="keywordtype">unsigned</span> ScaleCost;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  Cost()</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    : NumRegs(0), AddRecCost(0), NumIVMuls(0), NumBaseAdds(0), ImmCost(0),</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      SetupCost(0), ScaleCost(0) {}</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a7c469a194119a14e5a018ebb9b847cf0">operator&lt;</a>(<span class="keyword">const</span> Cost &amp;Other) <span class="keyword">const</span>;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="keywordtype">void</span> Loose();</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="comment">// Once any of the metrics loses, they must all remain losers.</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <span class="keywordtype">bool</span> isValid() {</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">return</span> ((NumRegs | AddRecCost | NumIVMuls | NumBaseAdds</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;             | ImmCost | SetupCost | ScaleCost) != ~0u)</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;      || ((NumRegs &amp; AddRecCost &amp; NumIVMuls &amp; NumBaseAdds</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;           &amp; ImmCost &amp; SetupCost &amp; ScaleCost) == ~0u);</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  }</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="keywordtype">bool</span> isLoser() {</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    assert(isValid() &amp;&amp; <span class="stringliteral">&quot;invalid cost&quot;</span>);</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">return</span> NumRegs == ~0u;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  }</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <span class="keywordtype">void</span> RateFormula(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI,</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                   <span class="keyword">const</span> Formula &amp;F,</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                   <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> &amp;Regs,</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;const SCEV *&gt;</a> &amp;VisitedRegs,</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L,</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int64_t&gt;</a> &amp;Offsets,</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                   <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE, <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT,</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                   <span class="keyword">const</span> LSRUse &amp;LU,</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                   <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> *LoserRegs = 0);</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="keywordtype">void</span> print(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS) <span class="keyword">const</span>;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>() <span class="keyword">const</span>;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="keywordtype">void</span> RateRegister(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Reg,</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> &amp;Regs,</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L,</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                    <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE, <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT);</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="keywordtype">void</span> RatePrimaryRegister(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Reg,</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                           <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> &amp;Regs,</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                           <span class="keyword">const</span> <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L,</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                           <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE, <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT,</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                           <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> *LoserRegs);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;};</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;}</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment">/// RateRegister - Tally up interesting quantities from the given register.</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> Cost::RateRegister(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Reg,</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                        <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> &amp;Regs,</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                        <span class="keyword">const</span> <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L,</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                        <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE, <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT) {</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddRecExpr.html">SCEVAddRecExpr</a> *AR = dyn_cast&lt;SCEVAddRecExpr&gt;(Reg)) {</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="comment">// If this is an addrec for another loop, don&#39;t second-guess its addrec phi</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="comment">// nodes. LSR isn&#39;t currently smart enough to reason about more than one</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="comment">// loop at a time. LSR has already run on inner loops, will not run on outer</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="comment">// loops, and cannot be expected to change sibling loops.</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordflow">if</span> (AR-&gt;getLoop() != L) {</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      <span class="comment">// If the AddRec exists, consider it&#39;s register free and leave it alone.</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="LoopStrengthReduce_8cpp.html#a3c81223cabf643af27adba3b3ceb680c">isExistingPhi</a>(AR, SE))</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <span class="comment">// Otherwise, do not consider this formula at all.</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      Loose();</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    }</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    AddRecCost += 1; <span class="comment">/// TODO: This should be a function of the stride.</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="comment">// Add the step value register, if it needs one.</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="comment">// TODO: The non-affine case isn&#39;t precisely modeled here.</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <span class="keywordflow">if</span> (!AR-&gt;isAffine() || !isa&lt;SCEVConstant&gt;(AR-&gt;getOperand(1))) {</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;      <span class="keywordflow">if</span> (!Regs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(AR-&gt;getOperand(1))) {</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        RateRegister(AR-&gt;getOperand(1), Regs, L, SE, DT);</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        <span class="keywordflow">if</span> (isLoser())</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;          <span class="keywordflow">return</span>;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      }</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    }</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  }</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  ++NumRegs;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="comment">// Rough heuristic; favor registers which don&#39;t require extra setup</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="comment">// instructions in the preheader.</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;SCEVUnknown&gt;(Reg) &amp;&amp;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      !isa&lt;SCEVConstant&gt;(<a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a>) &amp;&amp;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      !(isa&lt;SCEVAddRecExpr&gt;(Reg) &amp;&amp;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        (isa&lt;SCEVUnknown&gt;(cast&lt;SCEVAddRecExpr&gt;(<a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a>)-&gt;getStart()) ||</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;         isa&lt;SCEVConstant&gt;(cast&lt;SCEVAddRecExpr&gt;(Reg)-&gt;getStart()))))</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    ++SetupCost;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    NumIVMuls += isa&lt;SCEVMulExpr&gt;(<a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a>) &amp;&amp;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                 SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ac258f0361a1c35f5814a2b529139d15c">hasComputableLoopEvolution</a>(Reg, L);</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;}</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">/// RatePrimaryRegister - Record this register in the set. If we haven&#39;t seen it</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment">/// before, rate it. Optional LoserRegs provides a way to declare any formula</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">/// that refers to one of those regs an instant loser.</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> Cost::RatePrimaryRegister(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Reg,</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                               <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> &amp;Regs,</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                               <span class="keyword">const</span> <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L,</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;                               <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE, <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT,</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                               <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> *LoserRegs) {</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <span class="keywordflow">if</span> (LoserRegs &amp;&amp; LoserRegs-&gt;<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(Reg)) {</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    Loose();</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  }</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="keywordflow">if</span> (Regs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(Reg)) {</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    RateRegister(Reg, Regs, L, SE, DT);</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="keywordflow">if</span> (LoserRegs &amp;&amp; isLoser())</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      LoserRegs-&gt;<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(Reg);</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  }</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;}</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="keywordtype">void</span> Cost::RateFormula(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI,</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                       <span class="keyword">const</span> Formula &amp;F,</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                       <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> &amp;Regs,</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;const SCEV *&gt;</a> &amp;VisitedRegs,</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L,</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int64_t&gt;</a> &amp;Offsets,</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                       <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE, <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT,</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                       <span class="keyword">const</span> LSRUse &amp;LU,</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                       <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> *LoserRegs) {</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="comment">// Tally up the registers.</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *ScaledReg = F.ScaledReg) {</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordflow">if</span> (VisitedRegs.<a class="code" href="classllvm_1_1DenseSet.html#abbac11d593e7d40675ac3dfe1dd324bd">count</a>(ScaledReg)) {</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      Loose();</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    RatePrimaryRegister(ScaledReg, Regs, L, SE, DT, LoserRegs);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keywordflow">if</span> (isLoser())</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  }</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a> I = F.BaseRegs.begin(),</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;       E = F.BaseRegs.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *BaseReg = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="keywordflow">if</span> (VisitedRegs.<a class="code" href="classllvm_1_1DenseSet.html#abbac11d593e7d40675ac3dfe1dd324bd">count</a>(BaseReg)) {</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      Loose();</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    }</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    RatePrimaryRegister(BaseReg, Regs, L, SE, DT, LoserRegs);</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keywordflow">if</span> (isLoser())</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  }</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="comment">// Determine how many (unfolded) adds we&#39;ll need inside the loop.</span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keywordtype">size_t</span> NumBaseParts = F.BaseRegs.size() + (F.UnfoldedOffset != 0);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <span class="keywordflow">if</span> (NumBaseParts &gt; 1)</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="comment">// Do not count the base and a possible second register if the target</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="comment">// allows to fold 2 registers.</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    NumBaseAdds += NumBaseParts - (1 + <a class="code" href="LoopStrengthReduce_8cpp.html#ac7db1af29fc90ec685f6f0c2bc39d3ef">isLegal2RegAMUse</a>(TTI, LU, F));</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="comment">// Accumulate non-free scaling amounts.</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  ScaleCost += <a class="code" href="LoopStrengthReduce_8cpp.html#ae4cc657febc6dbfa190deb899e1f0126">getScalingFactorCost</a>(TTI, LU, F);</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="comment">// Tally up the non-zero immediates.</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int64_t&gt;::const_iterator</a> I = Offsets.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;       E = Offsets.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    int64_t Offset = (uint64_t)*I + F.BaseOffset;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <a class="code" href="LLParser_8cpp.html#aae58e3df0180401e8f3ab75c18fbc07a">if</a> (F.BaseGV)</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      ImmCost += 64; <span class="comment">// Handle symbolic values conservatively.</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                     <span class="comment">// TODO: This should probably be the pointer size.</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Offset != 0)</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      ImmCost += <a class="code" href="classllvm_1_1APInt.html">APInt</a>(64, Offset, <span class="keyword">true</span>).<a class="code" href="classllvm_1_1APInt.html#a5d15af723179356228265f1f12b9f4e2">getMinSignedBits</a>();</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  }</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  assert(isValid() &amp;&amp; <span class="stringliteral">&quot;invalid cost&quot;</span>);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;}</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="comment">/// Loose - Set this cost to a losing value.</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> Cost::Loose() {</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  NumRegs = ~0u;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  AddRecCost = ~0u;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  NumIVMuls = ~0u;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  NumBaseAdds = ~0u;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  ImmCost = ~0u;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  SetupCost = ~0u;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  ScaleCost = ~0u;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;}</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment">/// operator&lt; - Choose the lower cost.</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a7c469a194119a14e5a018ebb9b847cf0">Cost::operator&lt;</a>(<span class="keyword">const</span> Cost &amp;Other)<span class="keyword"> const </span>{</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  <span class="keywordflow">if</span> (NumRegs != Other.NumRegs)</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="keywordflow">return</span> NumRegs &lt; Other.NumRegs;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordflow">if</span> (AddRecCost != Other.AddRecCost)</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keywordflow">return</span> AddRecCost &lt; Other.AddRecCost;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keywordflow">if</span> (NumIVMuls != Other.NumIVMuls)</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="keywordflow">return</span> NumIVMuls &lt; Other.NumIVMuls;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="keywordflow">if</span> (NumBaseAdds != Other.NumBaseAdds)</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="keywordflow">return</span> NumBaseAdds &lt; Other.NumBaseAdds;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="keywordflow">if</span> (ScaleCost != Other.ScaleCost)</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keywordflow">return</span> ScaleCost &lt; Other.ScaleCost;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="keywordflow">if</span> (ImmCost != Other.ImmCost)</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordflow">return</span> ImmCost &lt; Other.ImmCost;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="keywordflow">if</span> (SetupCost != Other.SetupCost)</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="keywordflow">return</span> SetupCost &lt; Other.SetupCost;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;}</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="keywordtype">void</span> Cost::print(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS)<span class="keyword"> const </span>{</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  OS &lt;&lt; NumRegs &lt;&lt; <span class="stringliteral">&quot; reg&quot;</span> &lt;&lt; (NumRegs == 1 ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;s&quot;</span>);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <span class="keywordflow">if</span> (AddRecCost != 0)</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;, with addrec cost &quot;</span> &lt;&lt; AddRecCost;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <span class="keywordflow">if</span> (NumIVMuls != 0)</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;, plus &quot;</span> &lt;&lt; NumIVMuls &lt;&lt; <span class="stringliteral">&quot; IV mul&quot;</span> &lt;&lt; (NumIVMuls == 1 ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;s&quot;</span>);</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="keywordflow">if</span> (NumBaseAdds != 0)</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;, plus &quot;</span> &lt;&lt; NumBaseAdds &lt;&lt; <span class="stringliteral">&quot; base add&quot;</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;       &lt;&lt; (NumBaseAdds == 1 ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;s&quot;</span>);</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="keywordflow">if</span> (ScaleCost != 0)</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;, plus &quot;</span> &lt;&lt; ScaleCost &lt;&lt; <span class="stringliteral">&quot; scale cost&quot;</span>;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="keywordflow">if</span> (ImmCost != 0)</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;, plus &quot;</span> &lt;&lt; ImmCost &lt;&lt; <span class="stringliteral">&quot; imm cost&quot;</span>;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="keywordflow">if</span> (SetupCost != 0)</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;, plus &quot;</span> &lt;&lt; SetupCost &lt;&lt; <span class="stringliteral">&quot; setup cost&quot;</span>;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;}</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="preprocessor">#if !defined(NDEBUG) || defined(LLVM_ENABLE_DUMP)</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">Cost::dump</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  print(<a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>()); <a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;}</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">/// LSRFixup - An operand value in an instruction which is to be replaced</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">/// with some equivalent, possibly strength-reduced, replacement.</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment"></span><span class="keyword">struct </span>LSRFixup {<span class="comment"></span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">  /// UserInst - The instruction which will be updated.</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserInst;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment">  /// OperandValToReplace - The operand of the instruction which will</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment">  /// be replaced. The operand may be used more than once; every instance</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment">  /// will be replaced.</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Value.html">Value</a> *OperandValToReplace;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">  /// PostIncLoops - If this user is to use the post-incremented value of an</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment">  /// induction variable, this variable is non-null and holds the loop</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment">  /// associated with the induction variable.</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallPtrSet.html">PostIncLoopSet</a> PostIncLoops;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment">  /// LUIdx - The index of the LSRUse describing the expression which</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment">  /// this fixup needs, minus an offset (below).</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment"></span>  <span class="keywordtype">size_t</span> LUIdx;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">  /// Offset - A constant offset to be added to the LSRUse expression.</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment">  /// This allows multiple fixups to share the same LSRUse with different</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="comment">  /// offsets, for example in an unrolled loop.</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="comment"></span>  int64_t Offset;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <span class="keywordtype">bool</span> isUseFullyOutsideLoop(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L) <span class="keyword">const</span>;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  LSRFixup();</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  <span class="keywordtype">void</span> print(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS) <span class="keyword">const</span>;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>() <span class="keyword">const</span>;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;};</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;}</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;LSRFixup::LSRFixup()</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  : UserInst(0), OperandValToReplace(0), LUIdx(~<span class="keywordtype">size_t</span>(0)), Offset(0) {}</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment">/// isUseFullyOutsideLoop - Test whether this fixup always uses its</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">/// value outside of the given loop.</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> LSRFixup::isUseFullyOutsideLoop(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L)<span class="keyword"> const </span>{</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <span class="comment">// PHI nodes use their value in their incoming blocks.</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(UserInst)) {</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0, e = PN-&gt;getNumIncomingValues(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <span class="keywordflow">if</span> (PN-&gt;getIncomingValue(i) == OperandValToReplace &amp;&amp;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;          L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a92a38e2e3412bde7fd2b71db212b61aa">contains</a>(PN-&gt;getIncomingBlock(i)))</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  }</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="keywordflow">return</span> !L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a92a38e2e3412bde7fd2b71db212b61aa">contains</a>(UserInst);</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;}</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="keywordtype">void</span> LSRFixup::print(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS)<span class="keyword"> const </span>{</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  OS &lt;&lt; <span class="stringliteral">&quot;UserInst=&quot;</span>;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <span class="comment">// Store is common and interesting enough to be worth special-casing.</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *<a class="code" href="namespacellvm_1_1SPII.html#a11e9b8fca4a074643a6a21f444e51406a36b3dd3b84fde3f8494a9b18af131856">Store</a> = dyn_cast&lt;StoreInst&gt;(UserInst)) {</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;store &quot;</span>;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <a class="code" href="namespacellvm.html#ae712552495c21ee77ad82ced255ad6df">WriteAsOperand</a>(OS, <a class="code" href="namespacellvm_1_1SPII.html#a11e9b8fca4a074643a6a21f444e51406a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getOperand(0), <span class="comment">/*PrintType=*/</span><span class="keyword">false</span>);</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (UserInst-&gt;getType()-&gt;isVoidTy())</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    OS &lt;&lt; UserInst-&gt;getOpcodeName();</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <a class="code" href="namespacellvm.html#ae712552495c21ee77ad82ced255ad6df">WriteAsOperand</a>(OS, UserInst, <span class="comment">/*PrintType=*/</span><span class="keyword">false</span>);</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  OS &lt;&lt; <span class="stringliteral">&quot;, OperandValToReplace=&quot;</span>;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <a class="code" href="namespacellvm.html#ae712552495c21ee77ad82ced255ad6df">WriteAsOperand</a>(OS, OperandValToReplace, <span class="comment">/*PrintType=*/</span><span class="keyword">false</span>);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">PostIncLoopSet::const_iterator</a> I = PostIncLoops.begin(),</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;       E = PostIncLoops.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;, PostIncLoop=&quot;</span>;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <a class="code" href="namespacellvm.html#ae712552495c21ee77ad82ced255ad6df">WriteAsOperand</a>(OS, (*I)-&gt;getHeader(), <span class="comment">/*PrintType=*/</span><span class="keyword">false</span>);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  }</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  <span class="keywordflow">if</span> (LUIdx != ~<span class="keywordtype">size_t</span>(0))</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;, LUIdx=&quot;</span> &lt;&lt; LUIdx;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="keywordflow">if</span> (Offset != 0)</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;, Offset=&quot;</span> &lt;&lt; Offset;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;}</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="preprocessor">#if !defined(NDEBUG) || defined(LLVM_ENABLE_DUMP)</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">LSRFixup::dump</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  print(<a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>()); <a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;}</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment">/// UniquifierDenseMapInfo - A DenseMapInfo implementation for holding</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment">/// DenseMaps and DenseSets of sorted SmallVectors of const SCEV*.</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment"></span><span class="keyword">struct </span>UniquifierDenseMapInfo {</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  <span class="keyword">static</span> <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> getEmptyKey() {</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a>  V;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    V.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(reinterpret_cast&lt;const SCEV *&gt;(-1));</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="keywordflow">return</span> V;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  }</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  <span class="keyword">static</span> <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> getTombstoneKey() {</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> V;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    V.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(reinterpret_cast&lt;const SCEV *&gt;(-2));</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="keywordflow">return</span> V;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  }</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span> getHashValue(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> &amp;V) {</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="keywordtype">unsigned</span> Result = 0;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a> I = V.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;         E = V.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      Result ^= <a class="code" href="structllvm_1_1DenseMapInfo.html">DenseMapInfo&lt;const SCEV *&gt;::getHashValue</a>(*I);</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="keywordflow">return</span> Result;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  }</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> isEqual(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> &amp;LHS,</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> &amp;RHS) {</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <span class="keywordflow">return</span> LHS == RHS;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  }</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;};</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment">/// LSRUse - This class holds the state that LSR keeps for each use in</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="comment">/// IVUsers, as well as uses invented by LSR itself. It includes information</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment">/// about what kinds of things can be folded into the user, information about</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment">/// the user itself, and information about how the use may be satisfied.</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment">/// TODO: Represent multiple users of the same expression in common?</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment"></span><span class="keyword">class </span>LSRUse {</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;SmallVector&lt;const SCEV *, 4&gt;</a>, UniquifierDenseMapInfo&gt; Uniquifier;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="keyword">public</span>:<span class="comment"></span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment">  /// KindType - An enum for a kind of use, indicating what types of</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment">  /// scaled and immediate operands it might support.</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment"></span>  <span class="keyword">enum</span> KindType {</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    Basic,   <span class="comment">///&lt; A normal use, with no folding.</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="comment"></span>    Special, <span class="comment">///&lt; A special case of basic, allowing -1 scales.</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment"></span>    Address, <span class="comment">///&lt; An address use; folding according to TargetLowering</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment"></span>    ICmpZero <span class="comment">///&lt; An equality icmp with both operands folded into one.</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment"></span>    <span class="comment">// TODO: Add a generic icmp too?</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  };</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  KindType <a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">Kind</a>;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int64_t, 8&gt;</a> Offsets;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  int64_t MinOffset;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  int64_t MaxOffset;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="comment">  /// AllFixupsOutsideLoop - This records whether all of the fixups using this</span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment">  /// LSRUse are outside of the loop, in which case some special-case heuristics</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment">  /// may be used.</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> AllFixupsOutsideLoop;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment">  /// RigidFormula is set to true to guarantee that this use will be associated</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment">  /// with a single formula--the one that initially matched. Some SCEV</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment">  /// expressions cannot be expanded. This allows LSR to consider the registers</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="comment">  /// used by those expressions without the need to expand them later after</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="comment">  /// changing the formula.</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> RigidFormula;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="comment">  /// WidestFixupType - This records the widest use type for any fixup using</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment">  /// this LSRUse. FindUseWithSimilarFormula can&#39;t consider uses with different</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment">  /// max fixup widths to be equivalent, because the narrower one may be relying</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment">  /// on the implicit truncation to truncate away bogus bits.</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Type.html">Type</a> *WidestFixupType;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment">  /// Formulae - A list of ways to build a value that can satisfy this user.</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="comment">  /// After the list is populated, one of these is selected heuristically and</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="comment">  /// used to formulate a replacement for OperandValToReplace in UserInst.</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Formula, 12&gt;</a> Formulae;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="comment">  /// Regs - The set of register candidates used by all formulae in this LSRUse.</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 4&gt;</a> Regs;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  LSRUse(KindType K, <a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="classT.html">T</a>) : <a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">Kind</a>(K), AccessTy(T),</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                                      MinOffset(INT64_MAX),</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                                      MaxOffset(INT64_MIN),</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                                      AllFixupsOutsideLoop(<span class="keyword">true</span>),</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;                                      RigidFormula(<span class="keyword">false</span>),</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;                                      WidestFixupType(0) {}</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  <span class="keywordtype">bool</span> HasFormulaWithSameRegs(<span class="keyword">const</span> Formula &amp;F) <span class="keyword">const</span>;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  <span class="keywordtype">bool</span> InsertFormula(<span class="keyword">const</span> Formula &amp;F);</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  <span class="keywordtype">void</span> DeleteFormula(Formula &amp;F);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <span class="keywordtype">void</span> RecomputeRegs(<span class="keywordtype">size_t</span> LUIdx, RegUseTracker &amp;Reguses);</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  <span class="keywordtype">void</span> print(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS) <span class="keyword">const</span>;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>() <span class="keyword">const</span>;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;};</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;}</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="comment">/// HasFormula - Test whether this use as a formula which has the same</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="comment">/// registers as the given formula.</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> LSRUse::HasFormulaWithSameRegs(<span class="keyword">const</span> Formula &amp;F)<span class="keyword"> const </span>{</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> Key = F.BaseRegs;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  <span class="keywordflow">if</span> (F.ScaledReg) Key.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(F.ScaledReg);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  <span class="comment">// Unstable sort by host order ok, because this is only used for uniquifying.</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;  std::sort(Key.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Key.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>());</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  <span class="keywordflow">return</span> Uniquifier.count(Key);</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;}</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="comment">/// InsertFormula - If the given formula has not yet been inserted, add it to</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment">/// the list, and return true. Return false otherwise.</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> LSRUse::InsertFormula(<span class="keyword">const</span> Formula &amp;F) {</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  <span class="keywordflow">if</span> (!Formulae.empty() &amp;&amp; RigidFormula)</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> Key = F.BaseRegs;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <span class="keywordflow">if</span> (F.ScaledReg) Key.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(F.ScaledReg);</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  <span class="comment">// Unstable sort by host order ok, because this is only used for uniquifying.</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  std::sort(Key.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Key.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>());</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  <span class="keywordflow">if</span> (!Uniquifier.insert(Key).second)</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="comment">// Using a register to hold the value of 0 is not profitable.</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  assert((!F.ScaledReg || !F.ScaledReg-&gt;isZero()) &amp;&amp;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;         <span class="stringliteral">&quot;Zero allocated in a scaled register!&quot;</span>);</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a> I =</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;       F.BaseRegs.begin(), E = F.BaseRegs.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    assert(!(*I)-&gt;isZero() &amp;&amp; <span class="stringliteral">&quot;Zero allocated in a base register!&quot;</span>);</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  <span class="comment">// Add the formula to the list.</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  Formulae.push_back(F);</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <span class="comment">// Record registers now being used by this use.</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  Regs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(F.BaseRegs.begin(), F.BaseRegs.end());</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;}</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment">/// DeleteFormula - Remove the given formula from this use&#39;s list.</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRUse::DeleteFormula(Formula &amp;F) {</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  <span class="keywordflow">if</span> (&amp;F != &amp;Formulae.back())</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(F, Formulae.back());</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  Formulae.pop_back();</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;}</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment">/// RecomputeRegs - Recompute the Regs field, and update RegUses.</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRUse::RecomputeRegs(<span class="keywordtype">size_t</span> LUIdx, RegUseTracker &amp;RegUses) {</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  <span class="comment">// Now that we&#39;ve filtered out some formulae, recompute the Regs set.</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 4&gt;</a> OldRegs = Regs;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  Regs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#aa72472422d95c7052d62432ec279ff85">clear</a>();</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Formula&gt;::const_iterator</a> I = Formulae.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;       E = Formulae.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="keyword">const</span> Formula &amp;F = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="keywordflow">if</span> (F.ScaledReg) Regs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(F.ScaledReg);</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    Regs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(F.BaseRegs.begin(), F.BaseRegs.end());</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  }</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  <span class="comment">// Update the RegTracker.</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;const SCEV *, 4&gt;::iterator</a> I = OldRegs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">begin</a>(),</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;       E = OldRegs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a7f055d0b03ebf1d6a5988b178e9b8f4f">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <span class="keywordflow">if</span> (!Regs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(*I))</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      RegUses.DropRegister(*I, LUIdx);</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;}</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="keywordtype">void</span> LSRUse::print(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS)<span class="keyword"> const </span>{</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  OS &lt;&lt; <span class="stringliteral">&quot;LSR Use: Kind=&quot;</span>;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">Kind</a>) {</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <span class="keywordflow">case</span> Basic:    OS &lt;&lt; <span class="stringliteral">&quot;Basic&quot;</span>; <span class="keywordflow">break</span>;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="keywordflow">case</span> Special:  OS &lt;&lt; <span class="stringliteral">&quot;Special&quot;</span>; <span class="keywordflow">break</span>;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <span class="keywordflow">case</span> ICmpZero: OS &lt;&lt; <span class="stringliteral">&quot;ICmpZero&quot;</span>; <span class="keywordflow">break</span>;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  <span class="keywordflow">case</span> Address:</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;Address of &quot;</span>;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <span class="keywordflow">if</span> (AccessTy-&gt;isPointerTy())</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      OS &lt;&lt; <span class="stringliteral">&quot;pointer&quot;</span>; <span class="comment">// the full pointer type could be really verbose</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      OS &lt;&lt; *AccessTy;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  }</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  OS &lt;&lt; <span class="stringliteral">&quot;, Offsets={&quot;</span>;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int64_t&gt;::const_iterator</a> I = Offsets.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;       E = Offsets.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    OS &lt;&lt; *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(I) != E)</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;      OS &lt;&lt; <span class="charliteral">&#39;,&#39;</span>;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  }</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  OS &lt;&lt; <span class="charliteral">&#39;}&#39;</span>;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  <span class="keywordflow">if</span> (AllFixupsOutsideLoop)</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;, all-fixups-outside-loop&quot;</span>;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  <span class="keywordflow">if</span> (WidestFixupType)</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;, widest fixup type: &quot;</span> &lt;&lt; *WidestFixupType;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;}</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="preprocessor">#if !defined(NDEBUG) || defined(LLVM_ENABLE_DUMP)</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">LSRUse::dump</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  print(<a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>()); <a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;}</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="comment">/// isLegalUse - Test whether the use described by AM is &quot;legal&quot;, meaning it can</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment">/// be completely folded into the user instruction at isel time. This includes</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="comment">/// address-mode folding and special icmp tricks.</span></div><div class="line"><a name="l01319"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d"> 1319</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI, LSRUse::KindType <a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">Kind</a>,</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                       <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy, <a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *BaseGV, int64_t BaseOffset,</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                       <span class="keywordtype">bool</span> HasBaseReg, int64_t Scale) {</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  <span class="keywordflow">switch</span> (Kind) {</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  <span class="keywordflow">case</span> LSRUse::Address:</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="keywordflow">return</span> TTI.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a6b125b01caa4a2ad5c9b621d6540f568">isLegalAddressingMode</a>(AccessTy, BaseGV, BaseOffset, HasBaseReg, Scale);</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="comment">// Otherwise, just guess that reg+reg addressing is legal.</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <span class="comment">//return ;</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  <span class="keywordflow">case</span> LSRUse::ICmpZero:</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <span class="comment">// There&#39;s not even a target hook for querying whether it would be legal to</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="comment">// fold a GV into an ICmp.</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="keywordflow">if</span> (BaseGV)</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <span class="comment">// ICmp only has two operands; don&#39;t allow more than two non-trivial parts.</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <span class="keywordflow">if</span> (Scale != 0 &amp;&amp; HasBaseReg &amp;&amp; BaseOffset != 0)</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <span class="comment">// ICmp only supports no scale or a -1 scale, as we can &quot;fold&quot; a -1 scale by</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <span class="comment">// putting the scaled register in the other operand of the icmp.</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="keywordflow">if</span> (Scale != 0 &amp;&amp; Scale != -1)</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <span class="comment">// If we have low-level target information, ask the target if it can fold an</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <span class="comment">// integer immediate on an icmp.</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <span class="keywordflow">if</span> (BaseOffset != 0) {</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;      <span class="comment">// We have one of:</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      <span class="comment">// ICmpZero     BaseReg + BaseOffset =&gt; ICmp BaseReg, -BaseOffset</span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      <span class="comment">// ICmpZero -1*ScaleReg + BaseOffset =&gt; ICmp ScaleReg, BaseOffset</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      <span class="comment">// Offs is the ICmp immediate.</span></div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;      <span class="keywordflow">if</span> (Scale == 0)</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <span class="comment">// The cast does the right thing with INT64_MIN.</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        BaseOffset = -(uint64_t)BaseOffset;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;      <span class="keywordflow">return</span> TTI.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a33e1d30087a69bde585406645b12b4f7">isLegalICmpImmediate</a>(BaseOffset);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    }</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <span class="comment">// ICmpZero BaseReg + -1*ScaleReg =&gt; ICmp BaseReg, ScaleReg</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;  <span class="keywordflow">case</span> LSRUse::Basic:</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <span class="comment">// Only handle single-register values.</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    <span class="keywordflow">return</span> !BaseGV &amp;&amp; Scale == 0 &amp;&amp; BaseOffset == 0;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  <span class="keywordflow">case</span> LSRUse::Special:</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="comment">// Special case Basic to handle -1 scales.</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    <span class="keywordflow">return</span> !BaseGV &amp;&amp; (Scale == 0 || Scale == -1) &amp;&amp; BaseOffset == 0;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  }</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;  <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Invalid LSRUse Kind!&quot;</span>);</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;}</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div><div class="line"><a name="l01372"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a96d8cfff3c7d6030b1d96062c39a9958"> 1372</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI, int64_t MinOffset,</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;                       int64_t MaxOffset, LSRUse::KindType <a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">Kind</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy,</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;                       <a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *BaseGV, int64_t BaseOffset, <span class="keywordtype">bool</span> HasBaseReg,</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;                       int64_t Scale) {</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  <span class="comment">// Check for overflow.</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  <span class="keywordflow">if</span> (((int64_t)((uint64_t)BaseOffset + MinOffset) &gt; BaseOffset) !=</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      (MinOffset &gt; 0))</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;  MinOffset = (uint64_t)BaseOffset + MinOffset;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <span class="keywordflow">if</span> (((int64_t)((uint64_t)BaseOffset + MaxOffset) &gt; BaseOffset) !=</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;      (MaxOffset &gt; 0))</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  MaxOffset = (uint64_t)BaseOffset + MaxOffset;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, Kind, AccessTy, BaseGV, MinOffset, HasBaseReg,</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;                    Scale) &amp;&amp;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;         <a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, Kind, AccessTy, BaseGV, MaxOffset, HasBaseReg, Scale);</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;}</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;</div><div class="line"><a name="l01391"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#aacef12b46ef4a858cf061317269d4353"> 1391</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI, int64_t MinOffset,</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;                       int64_t MaxOffset, LSRUse::KindType <a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">Kind</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy,</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;                       <span class="keyword">const</span> Formula &amp;F) {</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, MinOffset, MaxOffset, Kind, AccessTy, F.BaseGV,</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;                    F.BaseOffset, F.HasBaseReg, F.Scale);</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;}</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;</div><div class="line"><a name="l01398"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#ac7db1af29fc90ec685f6f0c2bc39d3ef"> 1398</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ac7db1af29fc90ec685f6f0c2bc39d3ef">isLegal2RegAMUse</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI, <span class="keyword">const</span> LSRUse &amp;LU,</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;                             <span class="keyword">const</span> Formula &amp;F) {</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;  <span class="comment">// If F is used as an Addressing Mode, it may fold one Base plus one</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <span class="comment">// scaled register. If the scaled register is nil, do as if another</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  <span class="comment">// element of the base regs is a 1-scaled register.</span></div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  <span class="comment">// This is possible if BaseRegs has at least 2 registers.</span></div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  <span class="comment">// If this is not an address calculation, this is not an addressing mode</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="comment">// use.</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  <span class="keywordflow">if</span> (LU.Kind !=  LSRUse::Address)</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  <span class="comment">// F is already scaled.</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  <span class="keywordflow">if</span> (F.Scale != 0)</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  <span class="comment">// We need to keep one register for the base and one to scale.</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  <span class="keywordflow">if</span> (F.BaseRegs.size() &lt; 2)</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, LU.MinOffset, LU.MaxOffset, LU.Kind, LU.AccessTy,</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                    F.BaseGV, F.BaseOffset, F.HasBaseReg, 1);</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160; }</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div><div class="line"><a name="l01422"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#ae4cc657febc6dbfa190deb899e1f0126"> 1422</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ae4cc657febc6dbfa190deb899e1f0126">getScalingFactorCost</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI,</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                                     <span class="keyword">const</span> LSRUse &amp;LU, <span class="keyword">const</span> Formula &amp;F) {</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  <span class="keywordflow">if</span> (!F.Scale)</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  assert(<a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, LU.MinOffset, LU.MaxOffset, LU.Kind,</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                    LU.AccessTy, F) &amp;&amp; <span class="stringliteral">&quot;Illegal formula in use.&quot;</span>);</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  <span class="keywordflow">switch</span> (LU.Kind) {</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  <span class="keywordflow">case</span> LSRUse::Address: {</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <span class="comment">// Check the scaling factor cost with both the min and max offsets.</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="keywordtype">int</span> ScaleCostMinOffset =</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      TTI.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a1e7940dd9d7d3814d19559ec2af502c9">getScalingFactorCost</a>(LU.AccessTy, F.BaseGV,</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;                               F.BaseOffset + LU.MinOffset,</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;                               F.HasBaseReg, F.Scale);</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    <span class="keywordtype">int</span> ScaleCostMaxOffset =</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      TTI.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a1e7940dd9d7d3814d19559ec2af502c9">getScalingFactorCost</a>(LU.AccessTy, F.BaseGV,</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;                               F.BaseOffset + LU.MaxOffset,</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;                               F.HasBaseReg, F.Scale);</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    assert(ScaleCostMinOffset &gt;= 0 &amp;&amp; ScaleCostMaxOffset &gt;= 0 &amp;&amp;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;           <span class="stringliteral">&quot;Legal addressing mode has an illegal cost!&quot;</span>);</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <span class="keywordflow">return</span> std::max(ScaleCostMinOffset, ScaleCostMaxOffset);</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  }</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  <span class="keywordflow">case</span> LSRUse::ICmpZero:</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="comment">// ICmpZero BaseReg + -1*ScaleReg =&gt; ICmp BaseReg, ScaleReg.</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <span class="comment">// Therefore, return 0 in case F.Scale == -1.</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    <span class="keywordflow">return</span> F.Scale != -1;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  <span class="keywordflow">case</span> LSRUse::Basic:</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <span class="keywordflow">case</span> LSRUse::Special:</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;  }</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Invalid LSRUse Kind!&quot;</span>);</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;}</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;</div><div class="line"><a name="l01458"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a6cfac60f7a8d39786699d498a07ad8f9"> 1458</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a6cfac60f7a8d39786699d498a07ad8f9">isAlwaysFoldable</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI,</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                             LSRUse::KindType <a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">Kind</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy,</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                             <a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *BaseGV, int64_t BaseOffset,</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;                             <span class="keywordtype">bool</span> HasBaseReg) {</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;  <span class="comment">// Fast-path: zero is always foldable.</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  <span class="keywordflow">if</span> (BaseOffset == 0 &amp;&amp; !BaseGV) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  <span class="comment">// Conservatively, create an address with an immediate and a</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  <span class="comment">// base and a scale.</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  int64_t Scale = Kind == LSRUse::ICmpZero ? -1 : 1;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;  <span class="comment">// Canonicalize a scale of 1 to a base register if the formula doesn&#39;t</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;  <span class="comment">// already have a base register.</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  <span class="keywordflow">if</span> (!HasBaseReg &amp;&amp; Scale == 1) {</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    Scale = 0;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    HasBaseReg = <span class="keyword">true</span>;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  }</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, Kind, AccessTy, BaseGV, BaseOffset, HasBaseReg, Scale);</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;}</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div><div class="line"><a name="l01479"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#acd9e66070eb11183680e120d512ae70d"> 1479</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a6cfac60f7a8d39786699d498a07ad8f9">isAlwaysFoldable</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI,</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;                             <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE, int64_t MinOffset,</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;                             int64_t MaxOffset, LSRUse::KindType <a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">Kind</a>,</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                             <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy, <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *S, <span class="keywordtype">bool</span> HasBaseReg) {</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;  <span class="comment">// Fast-path: zero is always foldable.</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  <span class="keywordflow">if</span> (S-&gt;<a class="code" href="classllvm_1_1SCEV.html#a3f76d2fd4788225548dc36ef9e417030">isZero</a>()) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;  <span class="comment">// Conservatively, create an address with an immediate and a</span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;  <span class="comment">// base and a scale.</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;  int64_t BaseOffset = <a class="code" href="LoopStrengthReduce_8cpp.html#ac2da0a3b05aba66c95b7f0b91b5c7c55">ExtractImmediate</a>(S, SE);</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;  <a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *BaseGV = <a class="code" href="LoopStrengthReduce_8cpp.html#a88366d91f44b9aa74c0408339b23b509">ExtractSymbol</a>(S, SE);</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;  <span class="comment">// If there&#39;s anything else involved, it&#39;s not foldable.</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  <span class="keywordflow">if</span> (!S-&gt;<a class="code" href="classllvm_1_1SCEV.html#a3f76d2fd4788225548dc36ef9e417030">isZero</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  <span class="comment">// Fast-path: zero is always foldable.</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;  <span class="keywordflow">if</span> (BaseOffset == 0 &amp;&amp; !BaseGV) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;  <span class="comment">// Conservatively, create an address with an immediate and a</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;  <span class="comment">// base and a scale.</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  int64_t Scale = Kind == LSRUse::ICmpZero ? -1 : 1;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, MinOffset, MaxOffset, Kind, AccessTy, BaseGV,</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                    BaseOffset, HasBaseReg, Scale);</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;}</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">/// UseMapDenseMapInfo - A DenseMapInfo implementation for holding</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">/// DenseMaps and DenseSets of pairs of const SCEV* and LSRUse::Kind.</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="comment"></span><span class="keyword">struct </span>UseMapDenseMapInfo {</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;  <span class="keyword">static</span> std::pair&lt;const SCEV *, LSRUse::KindType&gt; getEmptyKey() {</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    <span class="keywordflow">return</span> std::make_pair(reinterpret_cast&lt;const SCEV *&gt;(-1), LSRUse::Basic);</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  }</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="keyword">static</span> std::pair&lt;const SCEV *, LSRUse::KindType&gt; getTombstoneKey() {</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    <span class="keywordflow">return</span> std::make_pair(reinterpret_cast&lt;const SCEV *&gt;(-2), LSRUse::Basic);</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;  }</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">unsigned</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  getHashValue(<span class="keyword">const</span> std::pair&lt;const SCEV *, LSRUse::KindType&gt; &amp;V) {</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <span class="keywordtype">unsigned</span> Result = <a class="code" href="structllvm_1_1DenseMapInfo.html">DenseMapInfo&lt;const SCEV *&gt;::getHashValue</a>(V.first);</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    Result ^= <a class="code" href="structllvm_1_1DenseMapInfo.html">DenseMapInfo&lt;unsigned&gt;::getHashValue</a>(<span class="keywordtype">unsigned</span>(V.second));</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <span class="keywordflow">return</span> Result;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;  }</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">bool</span> isEqual(<span class="keyword">const</span> std::pair&lt;const SCEV *, LSRUse::KindType&gt; &amp;LHS,</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;                      <span class="keyword">const</span> std::pair&lt;const SCEV *, LSRUse::KindType&gt; &amp;RHS) {</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    <span class="keywordflow">return</span> LHS == RHS;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  }</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;};</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;<span class="comment">/// IVInc - An individual increment in a Chain of IV increments.</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="comment">/// Relate an IV user to an expression that computes the IV it uses from the IV</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="comment">/// used by the previous link in the Chain.</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="comment">/// For the head of a chain, IncExpr holds the absolute SCEV expression for the</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="comment">/// original IVOperand. The head of the chain&#39;s IVOperand is only valid during</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="comment">/// chain collection, before LSR replaces IV users. During chain generation,</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="comment">/// IncExpr can be used to find the new IVOperand that computes the same</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="comment">/// expression.</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="comment"></span><span class="keyword">struct </span>IVInc {</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserInst;</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a>* IVOperand;</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *IncExpr;</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  IVInc(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *U, <a class="code" href="classllvm_1_1Value.html">Value</a> *O, <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *E):</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    UserInst(U), IVOperand(O), IncExpr(E) {}</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;};</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="comment">// IVChain - The list of IV increments in program order.</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="comment">// We typically add the head of a chain without finding subsequent links.</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="keyword">struct </span>IVChain {</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;IVInc,1&gt;</a> Incs;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *ExprBase;</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  IVChain() : ExprBase(0) {}</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  IVChain(<span class="keyword">const</span> IVInc &amp;Head, <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Base)</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    : Incs(1, Head), ExprBase(Base) {}</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;IVInc&gt;::const_iterator</a> const_iterator;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  <span class="comment">// begin - return the first increment in the chain.</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  const_iterator <a class="code" href="namespacellvm_1_1sys_1_1path.html#a33706aab89e700b8f79e1fa6f4f0e3ee">begin</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    assert(!Incs.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>());</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(Incs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>());</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  }</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  const_iterator <a class="code" href="namespacellvm_1_1sys_1_1path.html#a214ec2f04ffd92636ed4bd2717607a1d">end</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="keywordflow">return</span> Incs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>();</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  }</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;  <span class="comment">// hasIncs - Returns true if this chain contains any increments.</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  <span class="keywordtype">bool</span> hasIncs()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Incs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() &gt;= 2; }</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  <span class="comment">// add - Add an IVInc to the end of this chain.</span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm_1_1ARM__AM.html#a5d0557608eaebed12bc00812724ba2cdae6bcee28992dab735eaa43f5dfa48a09">add</a>(<span class="keyword">const</span> IVInc &amp;<a class="code" href="namespacellvm.html#a6569d00d31a5d74e563e2f39f82271ab">X</a>) { Incs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(X); }</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  <span class="comment">// tailUserInst - Returns the last UserInst in the chain.</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *tailUserInst()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Incs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>().UserInst; }</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  <span class="comment">// isProfitableIncrement - Returns true if IncExpr can be profitably added to</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  <span class="comment">// this chain.</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  <span class="keywordtype">bool</span> isProfitableIncrement(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *OperExpr,</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                             <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *IncExpr,</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                             <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a>&amp;);</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;};</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="comment">/// ChainUsers - Helper for CollectChains to track multiple IV increment uses.</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="comment">/// Distinguish between FarUsers that definitely cross IV increments and</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="comment">/// NearUsers that may be used between IV increments.</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;<span class="comment"></span><span class="keyword">struct </span>ChainUsers {</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction*, 4&gt;</a> FarUsers;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction*, 4&gt;</a> NearUsers;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;};</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="comment">/// LSRInstance - This class holds state for the main loop strength reduction</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="comment">/// logic.</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment"></span><span class="keyword">class </span>LSRInstance {</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  <a class="code" href="classllvm_1_1IVUsers.html">IVUsers</a> &amp;IU;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;  <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;  <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a> &amp;LI;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  <a class="code" href="classllvm_1_1Loop.html">Loop</a> *<span class="keyword">const</span> L;</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;  <span class="keywordtype">bool</span> Changed;</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="comment">  /// IVIncInsertPos - This is the insert position that the current loop&#39;s</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="comment">  /// induction variable increment should be placed. In simple loops, this is</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="comment">  /// the latch block&#39;s terminator. But in more complicated cases, this is a</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="comment">  /// position which will dominate all the in-loop post-increment users.</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *IVIncInsertPos;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="comment">  /// Factors - Interesting factors between use strides.</span></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;int64_t, 8&gt;</a> Factors;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="comment">  /// Types - Interesting use types, to facilitate truncation reuse.</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;Type *, 4&gt;</a> Types;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="comment">  /// Fixups - The list of operands which are to be replaced.</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;LSRFixup, 16&gt;</a> <a class="code" href="namespacellvm_1_1AArch64.html#a5c816ea23ece51a78a235f57ffb177a9">Fixups</a>;</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="comment">  /// Uses - The list of interesting uses.</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;LSRUse, 16&gt;</a> Uses;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="comment">  /// RegUses - Track which uses use which register candidates.</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment"></span>  RegUseTracker RegUses;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;  <span class="comment">// Limit the number of chains to avoid quadratic behavior. We don&#39;t expect to</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  <span class="comment">// have more than a few IV increment chains in a loop. Missing a Chain falls</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;  <span class="comment">// back to normal LSR behavior for those uses.</span></div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> MaxChains = 8;</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="comment">  /// IVChainVec - IV users can form a chain of IV increments.</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;IVChain, MaxChains&gt;</a> IVChainVec;</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="comment">  /// IVIncSet - IV users that belong to profitable IVChains.</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Use*, MaxChains&gt;</a> IVIncSet;</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;  <span class="keywordtype">void</span> OptimizeShadowIV();</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;  <span class="keywordtype">bool</span> FindIVUserForCond(<a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *Cond, <a class="code" href="classllvm_1_1IVStrideUse.html">IVStrideUse</a> *&amp;CondUse);</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;  <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *OptimizeMax(<a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *Cond, <a class="code" href="classllvm_1_1IVStrideUse.html">IVStrideUse</a>* &amp;CondUse);</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;  <span class="keywordtype">void</span> OptimizeLoopTermCond();</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;  <span class="keywordtype">void</span> ChainInstruction(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserInst, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *IVOper,</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                        <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ChainUsers&gt;</a> &amp;ChainUsersVec);</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;  <span class="keywordtype">void</span> FinalizeChain(IVChain &amp;Chain);</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;  <span class="keywordtype">void</span> CollectChains();</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;  <span class="keywordtype">void</span> GenerateIVChain(<span class="keyword">const</span> IVChain &amp;Chain, <a class="code" href="classllvm_1_1SCEVExpander.html">SCEVExpander</a> &amp;<a class="code" href="VirtRegMap_8cpp.html#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>,</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;                       <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;WeakVH&gt;</a> &amp;DeadInsts);</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  <span class="keywordtype">void</span> CollectInterestingTypesAndFactors();</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;  <span class="keywordtype">void</span> CollectFixupsAndInitialFormulae();</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;  LSRFixup &amp;getNewFixup() {</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    Fixups.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(LSRFixup());</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    <span class="keywordflow">return</span> Fixups.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>();</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;  }</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;  <span class="comment">// Support for sharing of LSRUses between LSRFixups.</span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;std::pair&lt;const SCEV *, LSRUse::KindType&gt;</a>,</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;                   size_t,</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;                   UseMapDenseMapInfo&gt; UseMapTy;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;  UseMapTy UseMap;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;  <span class="keywordtype">bool</span> reconcileNewOffset(LSRUse &amp;LU, int64_t NewOffset, <span class="keywordtype">bool</span> HasBaseReg,</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;                          LSRUse::KindType <a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">Kind</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy);</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;  std::pair&lt;size_t, int64_t&gt; getUse(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *&amp;Expr,</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;                                    LSRUse::KindType Kind,</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;                                    <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy);</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  <span class="keywordtype">void</span> DeleteUse(LSRUse &amp;LU, <span class="keywordtype">size_t</span> LUIdx);</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;  LSRUse *FindUseWithSimilarFormula(<span class="keyword">const</span> Formula &amp;F, <span class="keyword">const</span> LSRUse &amp;OrigLU);</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;  <span class="keywordtype">void</span> InsertInitialFormula(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *S, LSRUse &amp;LU, <span class="keywordtype">size_t</span> LUIdx);</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;  <span class="keywordtype">void</span> InsertSupplementalFormula(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *S, LSRUse &amp;LU, <span class="keywordtype">size_t</span> LUIdx);</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  <span class="keywordtype">void</span> CountRegisters(<span class="keyword">const</span> Formula &amp;F, <span class="keywordtype">size_t</span> LUIdx);</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;  <span class="keywordtype">bool</span> InsertFormula(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx, <span class="keyword">const</span> Formula &amp;F);</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;  <span class="keywordtype">void</span> CollectLoopInvariantFixupsAndFormulae();</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;  <span class="keywordtype">void</span> GenerateReassociations(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx, Formula Base,</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;                              <span class="keywordtype">unsigned</span> Depth = 0);</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;  <span class="keywordtype">void</span> GenerateCombinations(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx, Formula Base);</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;  <span class="keywordtype">void</span> GenerateSymbolicOffsets(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx, Formula Base);</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  <span class="keywordtype">void</span> GenerateConstantOffsets(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx, Formula Base);</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;  <span class="keywordtype">void</span> GenerateICmpZeroScales(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx, Formula Base);</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;  <span class="keywordtype">void</span> GenerateScales(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx, Formula Base);</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;  <span class="keywordtype">void</span> GenerateTruncates(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx, Formula Base);</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  <span class="keywordtype">void</span> GenerateCrossUseConstantOffsets();</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;  <span class="keywordtype">void</span> GenerateAllReuseFormulae();</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <span class="keywordtype">void</span> FilterOutUndesirableDedicatedRegisters();</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <span class="keywordtype">size_t</span> EstimateSearchSpaceComplexity() <span class="keyword">const</span>;</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  <span class="keywordtype">void</span> NarrowSearchSpaceByDetectingSupersets();</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  <span class="keywordtype">void</span> NarrowSearchSpaceByCollapsingUnrolledCode();</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  <span class="keywordtype">void</span> NarrowSearchSpaceByRefilteringUndesirableDedicatedRegisters();</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;  <span class="keywordtype">void</span> NarrowSearchSpaceByPickingWinnerRegs();</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;  <span class="keywordtype">void</span> NarrowSearchSpaceUsingHeuristics();</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  <span class="keywordtype">void</span> SolveRecurse(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const Formula *&gt;</a> &amp;Solution,</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;                    Cost &amp;SolutionCost,</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const Formula *&gt;</a> &amp;Workspace,</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                    <span class="keyword">const</span> Cost &amp;CurCost,</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> &amp;CurRegs,</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                    <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;const SCEV *&gt;</a> &amp;VisitedRegs) <span class="keyword">const</span>;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;  <span class="keywordtype">void</span> Solve(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const Formula *&gt;</a> &amp;Solution) <span class="keyword">const</span>;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    HoistInsertPosition(<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> IP,</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                        <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;Inputs) <span class="keyword">const</span>;</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    AdjustInsertPositionForExpand(<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> IP,</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                                  <span class="keyword">const</span> LSRFixup &amp;LF,</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                                  <span class="keyword">const</span> LSRUse &amp;LU,</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;                                  <a class="code" href="classllvm_1_1SCEVExpander.html">SCEVExpander</a> &amp;Rewriter) <span class="keyword">const</span>;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Expand(<span class="keyword">const</span> LSRFixup &amp;LF,</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;                <span class="keyword">const</span> Formula &amp;F,</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;                <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> IP,</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;                <a class="code" href="classllvm_1_1SCEVExpander.html">SCEVExpander</a> &amp;Rewriter,</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;                <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;WeakVH&gt;</a> &amp;DeadInsts) <span class="keyword">const</span>;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;  <span class="keywordtype">void</span> RewriteForPHI(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN, <span class="keyword">const</span> LSRFixup &amp;LF,</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;                     <span class="keyword">const</span> Formula &amp;F,</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;                     <a class="code" href="classllvm_1_1SCEVExpander.html">SCEVExpander</a> &amp;Rewriter,</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                     <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;WeakVH&gt;</a> &amp;DeadInsts,</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;                     <a class="code" href="classllvm_1_1Pass.html">Pass</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>) <span class="keyword">const</span>;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;  <span class="keywordtype">void</span> Rewrite(<span class="keyword">const</span> LSRFixup &amp;LF,</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;               <span class="keyword">const</span> Formula &amp;F,</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;               <a class="code" href="classllvm_1_1SCEVExpander.html">SCEVExpander</a> &amp;Rewriter,</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;               <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;WeakVH&gt;</a> &amp;DeadInsts,</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;               <a class="code" href="classllvm_1_1Pass.html">Pass</a> *P) <span class="keyword">const</span>;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;  <span class="keywordtype">void</span> ImplementSolution(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const Formula *&gt;</a> &amp;Solution,</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                         <a class="code" href="classllvm_1_1Pass.html">Pass</a> *P);</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;  LSRInstance(<a class="code" href="classllvm_1_1Loop.html">Loop</a> *L, <a class="code" href="classllvm_1_1Pass.html">Pass</a> *P);</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  <span class="keywordtype">bool</span> getChanged()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Changed; }</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;  <span class="keywordtype">void</span> print_factors_and_types(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS) <span class="keyword">const</span>;</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;  <span class="keywordtype">void</span> print_fixups(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS) <span class="keyword">const</span>;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;  <span class="keywordtype">void</span> print_uses(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS) <span class="keyword">const</span>;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;  <span class="keywordtype">void</span> print(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS) <span class="keyword">const</span>;</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>() <span class="keyword">const</span>;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;};</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;}</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="comment">/// OptimizeShadowIV - If IV is used in a int-to-float cast</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;<span class="comment">/// inside the loop then try to eliminate the cast operation.</span></div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::OptimizeShadowIV() {</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *BackedgeTakenCount = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#aecd7aba4460358813feef37d71d5024e">getBackedgeTakenCount</a>(L);</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;  <span class="keywordflow">if</span> (isa&lt;SCEVCouldNotCompute&gt;(BackedgeTakenCount))</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">IVUsers::const_iterator</a> UI = IU.begin(), E = IU.end();</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;       UI != E; <span class="comment">/* empty */</span>) {</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <a class="code" href="classllvm_1_1ilist__iterator.html">IVUsers::const_iterator</a> CandidateUI = UI;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    ++UI;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *ShadowUse = CandidateUI-&gt;getUser();</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *DestTy = 0;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <span class="keywordtype">bool</span> IsSigned = <span class="keyword">false</span>;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <span class="comment">/* If shadow use is a int-&gt;float cast then insert a second IV</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="comment">       to eliminate this cast.</span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="comment">         for (unsigned i = 0; i &lt; n; ++i)</span></div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;<span class="comment">           foo((double)i);</span></div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="comment">       is transformed into</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment">         double d = 0.0;</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment">         for (unsigned i = 0; i &lt; n; ++i, ++d)</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment">           foo(d);</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1UIToFPInst.html">UIToFPInst</a> *UCast = dyn_cast&lt;UIToFPInst&gt;(CandidateUI-&gt;getUser())) {</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;      IsSigned = <span class="keyword">false</span>;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;      DestTy = UCast-&gt;getDestTy();</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    }</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SIToFPInst.html">SIToFPInst</a> *SCast = dyn_cast&lt;SIToFPInst&gt;(CandidateUI-&gt;getUser())) {</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;      IsSigned = <span class="keyword">true</span>;</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;      DestTy = SCast-&gt;getDestTy();</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    }</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    <span class="keywordflow">if</span> (!DestTy) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    <span class="comment">// If target does not support DestTy natively then do not apply</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    <span class="comment">// this transformation.</span></div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="keywordflow">if</span> (!TTI.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a83f052a0d908e956128c8951451bde39">isTypeLegal</a>(DestTy)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PH = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(ShadowUse-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0));</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    <span class="keywordflow">if</span> (!PH) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    <span class="keywordflow">if</span> (PH-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>() != 2) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *SrcTy = PH-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>();</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    <span class="keywordtype">int</span> Mantissa = DestTy-&gt;<a class="code" href="classllvm_1_1Type.html#afd69a04ba20c2085dec90d69fb9abe64">getFPMantissaWidth</a>();</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    <span class="keywordflow">if</span> (Mantissa == -1) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(SrcTy) &gt; Mantissa)</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <span class="keywordtype">unsigned</span> Entry, Latch;</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <span class="keywordflow">if</span> (PH-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(0) == L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a1bc74c76b876ad387293ecde0f21ed45">getLoopPreheader</a>()) {</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      Entry = 0;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;      Latch = 1;</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;      Entry = 1;</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;      Latch = 0;</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    }</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="classllvm_1_1Init.html">Init</a> = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(PH-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(Entry));</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    <span class="keywordflow">if</span> (!Init) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *NewInit = <a class="code" href="classllvm_1_1ConstantFP.html#a5eb8f7a5d3cfdd127ad9db2e425e14eb">ConstantFP::get</a>(DestTy, IsSigned ?</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;                                        (<span class="keywordtype">double</span>)Init-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a097c2d42e4deffabe6d54b007ad83367">getSExtValue</a>() :</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;                                        (<a class="code" href="README-SSE_8txt.html#a698e4bd87a8adc0c042ae6b6e10ee6e1">double</a>)Init-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>());</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *Incr =</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;      <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a>&gt;(PH-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(Latch));</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <span class="keywordflow">if</span> (!Incr) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    <span class="keywordflow">if</span> (Incr-&gt;getOpcode() != Instruction::Add</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;        &amp;&amp; Incr-&gt;getOpcode() != Instruction::Sub)</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    <span class="comment">/* Initialize new IV, double d = 0.0 in above example. */</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = 0;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    <span class="keywordflow">if</span> (Incr-&gt;getOperand(0) == PH)</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;      C = dyn_cast&lt;ConstantInt&gt;(Incr-&gt;getOperand(1));</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Incr-&gt;getOperand(1) == PH)</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;      C = dyn_cast&lt;ConstantInt&gt;(Incr-&gt;getOperand(0));</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    <span class="keywordflow">if</span> (!C) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    <span class="comment">// Ignore negative constants, as the code below doesn&#39;t handle them</span></div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    <span class="comment">// correctly. TODO: Remove this restriction.</span></div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;    <span class="keywordflow">if</span> (!C-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#aeebb29dd5a7aaf9b4546fec69c43653b">isStrictlyPositive</a>()) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    <span class="comment">/* Add new PHINode. */</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *NewPH = <a class="code" href="classllvm_1_1PHINode.html#afb5e83bf5123ff7c51058eb0ebebcdc6">PHINode::Create</a>(DestTy, 2, <span class="stringliteral">&quot;IV.S.&quot;</span>, PH);</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    <span class="comment">/* create new increment. &#39;++d&#39; in above example. */</span></div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *CFP = <a class="code" href="classllvm_1_1ConstantFP.html#a5eb8f7a5d3cfdd127ad9db2e425e14eb">ConstantFP::get</a>(DestTy, C-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>());</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *NewIncr =</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;      <a class="code" href="classllvm_1_1BinaryOperator.html#a4a4628e91a9c6a339fa61105614fac76">BinaryOperator::Create</a>(Incr-&gt;getOpcode() == Instruction::Add ?</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;                               Instruction::FAdd : Instruction::FSub,</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;                             NewPH, CFP, <span class="stringliteral">&quot;IV.S.next.&quot;</span>, Incr);</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    NewPH-&gt;addIncoming(NewInit, PH-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(Entry));</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    NewPH-&gt;addIncoming(NewIncr, PH-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(Latch));</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    <span class="comment">/* Remove cast operation */</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    ShadowUse-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewPH);</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;    ShadowUse-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;  }</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;}</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="comment">/// FindIVUserForCond - If Cond has an operand that is an expression of an IV,</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="comment">/// set the IV user and stride information and return true, otherwise return</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="comment">/// false.</span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> LSRInstance::FindIVUserForCond(<a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *Cond, <a class="code" href="classllvm_1_1IVStrideUse.html">IVStrideUse</a> *&amp;CondUse) {</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">IVUsers::iterator</a> UI = IU.begin(), E = IU.end(); UI != E; ++UI)</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="keywordflow">if</span> (UI-&gt;getUser() == Cond) {</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;      <span class="comment">// NOTE: we could handle setcc instructions with multiple uses here, but</span></div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;      <span class="comment">// InstCombine does it as well for simple uses, it&#39;s not clear that it</span></div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;      <span class="comment">// occurs enough in real life to handle.</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;      CondUse = UI;</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    }</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;}</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment">/// OptimizeMax - Rewrite the loop&#39;s terminating condition if it uses</span></div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;<span class="comment">/// a max computation.</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="comment">/// This is a narrow solution to a specific, but acute, problem. For loops</span></div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;<span class="comment">/// like this:</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="comment">///   i = 0;</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="comment">///   do {</span></div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;<span class="comment">///     p[i] = 0.0;</span></div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;<span class="comment">///   } while (++i &lt; n);</span></div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="comment">/// the trip count isn&#39;t just &#39;n&#39;, because &#39;n&#39; might not be positive. And</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="comment">/// unfortunately this can come up even for loops where the user didn&#39;t use</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="comment">/// a C do-while loop. For example, seemingly well-behaved top-test loops</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="comment">/// will commonly be lowered like this:</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment"></span><span class="comment">//</span><span class="comment"></span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="comment">///   if (n &gt; 0) {</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment">///     i = 0;</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment">///     do {</span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment">///       p[i] = 0.0;</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment">///     } while (++i &lt; n);</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="comment">///   }</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;<span class="comment">/// and then it&#39;s possible for subsequent optimization to obscure the if</span></div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="comment">/// test in such a way that indvars can&#39;t find it.</span></div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;<span class="comment">/// When indvars can&#39;t find the if test in loops like this, it creates a</span></div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="comment">/// max expression, which allows it to give the loop a canonical</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="comment">/// induction variable:</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;<span class="comment">///   i = 0;</span></div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="comment">///   max = n &lt; 1 ? 1 : n;</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;<span class="comment">///   do {</span></div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="comment">///     p[i] = 0.0;</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="comment">///   } while (++i != max);</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="comment">/// Canonical induction variables are necessary because the loop passes</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="comment">/// are designed around them. The most obvious example of this is the</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="comment">/// LoopInfo analysis, which doesn&#39;t remember trip count values. It</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="comment">/// expects to be able to rediscover the trip count each time it is</span></div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="comment">/// needed, and it does this using a simple analysis that only succeeds if</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="comment">/// the loop has a canonical induction variable.</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;<span class="comment">/// However, when it comes time to generate code, the maximum operation</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;<span class="comment">/// can be quite costly, especially if it&#39;s inside of an outer loop.</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;<span class="comment">/// This function solves this problem by detecting this type of loop and</span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="comment">/// rewriting their conditions from ICMP_NE back to ICMP_SLT, and deleting</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;<span class="comment">/// the instructions for the maximum computation.</span></div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *LSRInstance::OptimizeMax(<a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *Cond, <a class="code" href="classllvm_1_1IVStrideUse.html">IVStrideUse</a>* &amp;CondUse) {</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;  <span class="comment">// Check that the loop matches the pattern we&#39;re looking for.</span></div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;  <span class="keywordflow">if</span> (Cond-&gt;<a class="code" href="classllvm_1_1CmpInst.html#a8afd4995fae596b2c86eeed85b3d388b">getPredicate</a>() != <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05aa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP_EQ</a> &amp;&amp;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      Cond-&gt;<a class="code" href="classllvm_1_1CmpInst.html#a8afd4995fae596b2c86eeed85b3d388b">getPredicate</a>() != <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05ac17897ebf2f6a6986280fc3bdf28a30a">CmpInst::ICMP_NE</a>)</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;    <span class="keywordflow">return</span> Cond;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;  <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *Sel = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a>&gt;(Cond-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1));</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;  <span class="keywordflow">if</span> (!Sel || !Sel-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>()) <span class="keywordflow">return</span> Cond;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *BackedgeTakenCount = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#aecd7aba4460358813feef37d71d5024e">getBackedgeTakenCount</a>(L);</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;  <span class="keywordflow">if</span> (isa&lt;SCEVCouldNotCompute&gt;(BackedgeTakenCount))</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    <span class="keywordflow">return</span> Cond;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *One = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(BackedgeTakenCount-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>(), 1);</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;  <span class="comment">// Add one to the backedge-taken count to get the trip count.</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *IterationCount = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(One, BackedgeTakenCount);</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;  <span class="keywordflow">if</span> (IterationCount != SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Sel)) <span class="keywordflow">return</span> Cond;</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;  <span class="comment">// Check for a max calculation that matches the pattern. There&#39;s no check</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;  <span class="comment">// for ICMP_ULE here because the comparison would be with zero, which</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;  <span class="comment">// isn&#39;t interesting.</span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05">CmpInst::Predicate</a> Pred = <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a07aee43ffb66908a25c55c77ce4c0d05">ICmpInst::BAD_ICMP_PREDICATE</a>;</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVNAryExpr.html">SCEVNAryExpr</a> *Max = 0;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVSMaxExpr.html">SCEVSMaxExpr</a> *S = dyn_cast&lt;SCEVSMaxExpr&gt;(BackedgeTakenCount)) {</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    Pred = <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a2751d6136a2819749dcef65dc19a4246">ICmpInst::ICMP_SLE</a>;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;    Max = <a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVSMaxExpr.html">SCEVSMaxExpr</a> *S = dyn_cast&lt;SCEVSMaxExpr&gt;(IterationCount)) {</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;    Pred = <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a15ae464950ac676919c2f0c7aafc706c">ICmpInst::ICMP_SLT</a>;</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    Max = <a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVUMaxExpr.html">SCEVUMaxExpr</a> *U = dyn_cast&lt;SCEVUMaxExpr&gt;(IterationCount)) {</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    Pred = <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP_ULT</a>;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    Max = U;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    <span class="comment">// No match; bail.</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    <span class="keywordflow">return</span> Cond;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;  }</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;  <span class="comment">// To handle a max with more than two operands, this optimization would</span></div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;  <span class="comment">// require additional checking and setup.</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;  <span class="keywordflow">if</span> (Max-&gt;<a class="code" href="classllvm_1_1SCEVNAryExpr.html#a97221eb4fea7333f0b7b35b35e1169b2">getNumOperands</a>() != 2)</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    <span class="keywordflow">return</span> Cond;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *MaxLHS = Max-&gt;<a class="code" href="classllvm_1_1SCEVNAryExpr.html#a8d1a2d2a4d2f935841d226bbcbf54a48">getOperand</a>(0);</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *MaxRHS = Max-&gt;<a class="code" href="classllvm_1_1SCEVNAryExpr.html#a8d1a2d2a4d2f935841d226bbcbf54a48">getOperand</a>(1);</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  <span class="comment">// ScalarEvolution canonicalizes constants to the left. For &lt; and &gt;, look</span></div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;  <span class="comment">// for a comparison with 1. For &lt;= and &gt;=, a comparison with zero.</span></div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;  <span class="keywordflow">if</span> (!MaxLHS ||</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;      (<a class="code" href="classllvm_1_1CmpInst.html#ab0fdfb9cef4a80aac8ae338e1d304131">ICmpInst::isTrueWhenEqual</a>(Pred) ? !MaxLHS-&gt;<a class="code" href="classllvm_1_1SCEV.html#a3f76d2fd4788225548dc36ef9e417030">isZero</a>() : (MaxLHS != One)))</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    <span class="keywordflow">return</span> Cond;</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;  <span class="comment">// Check the relevant induction variable for conformance to</span></div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;  <span class="comment">// the pattern.</span></div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *IV = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Cond-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0));</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddRecExpr.html">SCEVAddRecExpr</a> *AR = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1SCEVAddRecExpr.html">SCEVAddRecExpr</a>&gt;(IV);</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;  <span class="keywordflow">if</span> (!AR || !AR-&gt;<a class="code" href="classllvm_1_1SCEVAddRecExpr.html#a88f514461ddb0af0fc59ac4639f644bc">isAffine</a>() ||</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;      AR-&gt;<a class="code" href="classllvm_1_1SCEVAddRecExpr.html#a0d53a749bd858b270d322b34b8d7e1e5">getStart</a>() != One ||</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      AR-&gt;<a class="code" href="classllvm_1_1SCEVAddRecExpr.html#a443e9130cd9f3e3baaa1b566e6aa5060">getStepRecurrence</a>(SE) != One)</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;    <span class="keywordflow">return</span> Cond;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;  assert(AR-&gt;<a class="code" href="classllvm_1_1SCEVAddRecExpr.html#a7fcbbc51eef313e675a2442bb2053ae9">getLoop</a>() == L &amp;&amp;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;         <span class="stringliteral">&quot;Loop condition operand is an addrec in a different loop!&quot;</span>);</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;  <span class="comment">// Check the right operand of the select, and remember it, as it will</span></div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;  <span class="comment">// be used in the new comparison instruction.</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NewRHS = 0;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CmpInst.html#ab0fdfb9cef4a80aac8ae338e1d304131">ICmpInst::isTrueWhenEqual</a>(Pred)) {</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    <span class="comment">// Look for n+1, and grab n.</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AddOperator.html">AddOperator</a> *BO = dyn_cast&lt;AddOperator&gt;(Sel-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1)))</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *BO1 = dyn_cast&lt;ConstantInt&gt;(BO-&gt;getOperand(1)))</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;         <span class="keywordflow">if</span> (BO1-&gt;isOne() &amp;&amp; SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(BO-&gt;getOperand(0)) == MaxRHS)</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;           NewRHS = BO-&gt;getOperand(0);</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AddOperator.html">AddOperator</a> *BO = dyn_cast&lt;AddOperator&gt;(Sel-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(2)))</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *BO1 = dyn_cast&lt;ConstantInt&gt;(BO-&gt;getOperand(1)))</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;        <span class="keywordflow">if</span> (BO1-&gt;isOne() &amp;&amp; SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(BO-&gt;getOperand(0)) == MaxRHS)</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;          NewRHS = BO-&gt;getOperand(0);</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;    <span class="keywordflow">if</span> (!NewRHS)</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;      <span class="keywordflow">return</span> Cond;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Sel-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1)) == MaxRHS)</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    NewRHS = Sel-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1);</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Sel-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(2)) == MaxRHS)</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    NewRHS = Sel-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(2);</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVUnknown.html">SCEVUnknown</a> *SU = dyn_cast&lt;SCEVUnknown&gt;(MaxRHS))</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    NewRHS = SU-&gt;getValue();</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    <span class="comment">// Max doesn&#39;t match expected pattern.</span></div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    <span class="keywordflow">return</span> Cond;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;  <span class="comment">// Determine the new comparison opcode. It may be signed or unsigned,</span></div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;  <span class="comment">// and the original comparison may be either equality or inequality.</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;  <span class="keywordflow">if</span> (Cond-&gt;<a class="code" href="classllvm_1_1CmpInst.html#a8afd4995fae596b2c86eeed85b3d388b">getPredicate</a>() == <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05aa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP_EQ</a>)</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    Pred = <a class="code" href="classllvm_1_1CmpInst.html#a3c76890714593c78e3b5d142c9030548">CmpInst::getInversePredicate</a>(Pred);</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;  <span class="comment">// Ok, everything looks ok to change the condition into an SLT or SGE and</span></div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;  <span class="comment">// delete the max calculation.</span></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;  <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *NewCond =</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    <span class="keyword">new</span> <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a>(Cond, Pred, Cond-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), NewRHS, <span class="stringliteral">&quot;scmp&quot;</span>);</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;  <span class="comment">// Delete the max calculation instructions.</span></div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;  Cond-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewCond);</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;  CondUse-&gt;<a class="code" href="classllvm_1_1IVStrideUse.html#acb8718e691dfd2e5d5a3e0d876e35cc9">setUser</a>(NewCond);</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Cmp = cast&lt;Instruction&gt;(Sel-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0));</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;  Cond-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;  Sel-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;  <span class="keywordflow">if</span> (Cmp-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>())</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    Cmp-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;  <span class="keywordflow">return</span> NewCond;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;}</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;<span class="comment">/// OptimizeLoopTermCond - Change loop terminating condition to use the</span></div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="comment">/// postinc iv when possible.</span></div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="comment"></span><span class="keywordtype">void</span></div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;LSRInstance::OptimizeLoopTermCond() {</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 4&gt;</a> PostIncs;</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *LatchBlock = L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a8917d359fc92f25eb0117386588c6f1c">getLoopLatch</a>();</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock*, 8&gt;</a> ExitingBlocks;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;  L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#aa6bdb226fb3dac1f051547ce01b76fd2">getExitingBlocks</a>(ExitingBlocks);</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0, e = ExitingBlocks.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ExitingBlock = ExitingBlocks[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <span class="comment">// Get the terminating condition for the loop if possible.  If we</span></div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;    <span class="comment">// can, we want to change it to use a post-incremented version of its</span></div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    <span class="comment">// induction variable, to allow coalescing the live ranges for the IV into</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;    <span class="comment">// one register value.</span></div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *TermBr = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a>&gt;(ExitingBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    <span class="keywordflow">if</span> (!TermBr)</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    <span class="comment">// FIXME: Overly conservative, termination condition could be an &#39;or&#39; etc..</span></div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    <span class="keywordflow">if</span> (TermBr-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a382131e712e55e8324fbd5068de17b78">isUnconditional</a>() || !isa&lt;ICmpInst&gt;(TermBr-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>()))</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <span class="comment">// Search IVUsesByStride to find Cond&#39;s IVUse if there is one.</span></div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    <a class="code" href="classllvm_1_1IVStrideUse.html">IVStrideUse</a> *CondUse = 0;</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;    <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *Cond = cast&lt;ICmpInst&gt;(TermBr-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>());</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;    <span class="keywordflow">if</span> (!FindIVUserForCond(Cond, CondUse))</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;    <span class="comment">// If the trip count is computed in terms of a max (due to ScalarEvolution</span></div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;    <span class="comment">// being unable to find a sufficient guard, for example), change the loop</span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;    <span class="comment">// comparison to use SLT or ULT instead of NE.</span></div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;    <span class="comment">// One consequence of doing this now is that it disrupts the count-down</span></div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;    <span class="comment">// optimization. That&#39;s not always a bad thing though, because in such</span></div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;    <span class="comment">// cases it may still be worthwhile to avoid a max.</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    Cond = OptimizeMax(Cond, CondUse);</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    <span class="comment">// If this exiting block dominates the latch block, it may also use</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    <span class="comment">// the post-inc value if it won&#39;t be shared with other uses.</span></div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;    <span class="comment">// Check for dominance.</span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;    <span class="keywordflow">if</span> (!DT.<a class="code" href="classllvm_1_1DominatorTree.html#a6fe9272dc67fe2ff4cafc33b895c4a6c">dominates</a>(ExitingBlock, LatchBlock))</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;    <span class="comment">// Conservatively avoid trying to use the post-inc value in non-latch</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;    <span class="comment">// exits if there may be pre-inc users in intervening blocks.</span></div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    <span class="keywordflow">if</span> (LatchBlock != ExitingBlock)</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">IVUsers::const_iterator</a> UI = IU.begin(), E = IU.end(); UI != E; ++UI)</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;        <span class="comment">// Test if the use is reachable from the exiting block. This dominator</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;        <span class="comment">// query is a conservative approximation of reachability.</span></div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;        <span class="keywordflow">if</span> (&amp;*UI != CondUse &amp;&amp;</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;            !DT.<a class="code" href="classllvm_1_1DominatorTree.html#aa094180f7ac0ef9d4b8e1c78f850edd8">properlyDominates</a>(UI-&gt;getUser()-&gt;getParent(), ExitingBlock)) {</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;          <span class="comment">// Conservatively assume there may be reuse if the quotient of their</span></div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;          <span class="comment">// strides could be a legal scale.</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;          <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a> = IU.getStride(*CondUse, L);</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;          <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a> = IU.getStride(*UI, L);</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;          <span class="keywordflow">if</span> (!A || !B) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;          <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(A-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>()) !=</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;              SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(B-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>())) {</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;            <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(A-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>()) &gt;</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;                SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(B-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>()))</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;              B = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a63d4f693eb205bb9d556e067464f943c">getSignExtendExpr</a>(B, A-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>());</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;              A = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a63d4f693eb205bb9d556e067464f943c">getSignExtendExpr</a>(A, B-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>());</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;          }</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a> *D =</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;                dyn_cast_or_null&lt;SCEVConstant&gt;(<a class="code" href="LoopStrengthReduce_8cpp.html#a1fc3b7fba8416494790a73f61248b553">getExactSDiv</a>(B, A, SE))) {</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;            <span class="keyword">const</span> <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = D-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>();</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;            <span class="comment">// Stride of one or negative one can have reuse with non-addresses.</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;            <span class="keywordflow">if</span> (C-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#aa96ca2cf0bb1e924523900fb911b0a45">isOne</a>() || C-&gt;<a class="code" href="classllvm_1_1Constant.html#ac8ddb745480a7e75a3862ddf0be3a298">isAllOnesValue</a>())</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;              <span class="keywordflow">goto</span> decline_post_inc;</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;            <span class="comment">// Avoid weird situations.</span></div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;            <span class="keywordflow">if</span> (C-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a5d15af723179356228265f1f12b9f4e2">getMinSignedBits</a>() &gt;= 64 ||</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;                C-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a953625d369b127cd29e19f9c73da567f">isMinSignedValue</a>())</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;              <span class="keywordflow">goto</span> decline_post_inc;</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;            <span class="comment">// Check for possible scaled-address reuse.</span></div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;            <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy = <a class="code" href="LoopStrengthReduce_8cpp.html#a4f07d245cf5f31e5b86ee80c06ab949a">getAccessType</a>(UI-&gt;getUser());</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;            int64_t Scale = C-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a097c2d42e4deffabe6d54b007ad83367">getSExtValue</a>();</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;            <span class="keywordflow">if</span> (TTI.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a6b125b01caa4a2ad5c9b621d6540f568">isLegalAddressingMode</a>(AccessTy, <span class="comment">/*BaseGV=*/</span> 0,</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                                          <span class="comment">/*BaseOffset=*/</span> 0,</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                                          <span class="comment">/*HasBaseReg=*/</span> <span class="keyword">false</span>, Scale))</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;              <span class="keywordflow">goto</span> decline_post_inc;</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;            Scale = -Scale;</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;            <span class="keywordflow">if</span> (TTI.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a6b125b01caa4a2ad5c9b621d6540f568">isLegalAddressingMode</a>(AccessTy, <span class="comment">/*BaseGV=*/</span> 0,</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;                                          <span class="comment">/*BaseOffset=*/</span> 0,</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;                                          <span class="comment">/*HasBaseReg=*/</span> <span class="keyword">false</span>, Scale))</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;              <span class="keywordflow">goto</span> decline_post_inc;</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;          }</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;        }</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Change loop exiting icmp to use postinc iv: &quot;</span></div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;                 &lt;&lt; *Cond &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;    <span class="comment">// It&#39;s possible for the setcc instruction to be anywhere in the loop, and</span></div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    <span class="comment">// possible for it to have multiple users.  If it is not immediately before</span></div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    <span class="comment">// the exiting block branch, move it.</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;    <span class="keywordflow">if</span> (&amp;*++<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a>(Cond) != TermBr) {</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;      <span class="keywordflow">if</span> (Cond-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>()) {</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;        Cond-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(TermBr);</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        <span class="comment">// Clone the terminating condition and insert into the loopend.</span></div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;        <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *OldCond = Cond;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;        Cond = cast&lt;ICmpInst&gt;(Cond-&gt;<a class="code" href="classllvm_1_1Instruction.html#af6aad0c9ba7b8720130235c9621b55b5">clone</a>());</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;        Cond-&gt;<a class="code" href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">setName</a>(L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() + <span class="stringliteral">&quot;.termcond&quot;</span>);</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;        ExitingBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#a35c71de7e8bbe3c0353d042beb58263f">insert</a>(TermBr, Cond);</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;        <span class="comment">// Clone the IVUse, as the old use still exists!</span></div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;        CondUse = &amp;IU.AddUser(Cond, CondUse-&gt;<a class="code" href="classllvm_1_1IVStrideUse.html#aa6188247cf9c5836de214f8bdddd8a9e">getOperandValToReplace</a>());</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;        TermBr-&gt;<a class="code" href="classllvm_1_1User.html#a1f0b9358936e3e00c42a460abbfb2868">replaceUsesOfWith</a>(OldCond, Cond);</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;      }</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;    }</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;    <span class="comment">// If we get to here, we know that we can transform the setcc instruction to</span></div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;    <span class="comment">// use the post-incremented version of the IV, allowing us to coalesce the</span></div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;    <span class="comment">// live ranges for the IV correctly.</span></div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    CondUse-&gt;<a class="code" href="classllvm_1_1IVStrideUse.html#a8433a09d9b66df4f5c8a4d1414dc8ec9">transformToPostInc</a>(L);</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;    PostIncs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(Cond);</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;  decline_post_inc:;</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;  }</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;  <span class="comment">// Determine an insertion point for the loop induction variable increment. It</span></div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;  <span class="comment">// must dominate all the post-inc comparisons we just set up, and it must</span></div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;  <span class="comment">// dominate the loop latch edge.</span></div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;  IVIncInsertPos = L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a8917d359fc92f25eb0117386588c6f1c">getLoopLatch</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>();</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 4&gt;::const_iterator</a> I = PostIncs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">begin</a>(),</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;       E = PostIncs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a7f055d0b03ebf1d6a5988b178e9b8f4f">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> =</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      DT.<a class="code" href="classllvm_1_1DominatorTree.html#a7b8f5876ec15b49abf76ae81cefac1f6">findNearestCommonDominator</a>(IVIncInsertPos-&gt;getParent(),</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;                                    (*I)-&gt;getParent());</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    <span class="keywordflow">if</span> (BB == (*I)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>())</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;      IVIncInsertPos = *I;</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (BB != IVIncInsertPos-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>())</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;      IVIncInsertPos = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>();</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;  }</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;}</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;<span class="comment">/// reconcileNewOffset - Determine if the given use can accommodate a fixup</span></div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;<span class="comment">/// at the given offset and other details. If so, update the use and</span></div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;<span class="comment">/// return true.</span></div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span></div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;LSRInstance::reconcileNewOffset(LSRUse &amp;LU, int64_t NewOffset, <span class="keywordtype">bool</span> HasBaseReg,</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;                                LSRUse::KindType <a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">Kind</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy) {</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;  int64_t NewMinOffset = LU.MinOffset;</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;  int64_t NewMaxOffset = LU.MaxOffset;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *NewAccessTy = AccessTy;</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;  <span class="comment">// Check for a mismatched kind. It&#39;s tempting to collapse mismatched kinds to</span></div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;  <span class="comment">// something conservative, however this can pessimize in the case that one of</span></div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;  <span class="comment">// the uses will have all its uses outside the loop, for example.</span></div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;  <span class="keywordflow">if</span> (LU.Kind != Kind)</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;  <span class="comment">// Conservatively assume HasBaseReg is true for now.</span></div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;  <span class="keywordflow">if</span> (NewOffset &lt; LU.MinOffset) {</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="LoopStrengthReduce_8cpp.html#a6cfac60f7a8d39786699d498a07ad8f9">isAlwaysFoldable</a>(TTI, Kind, AccessTy, <span class="comment">/*BaseGV=*/</span> 0,</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;                          LU.MaxOffset - NewOffset, HasBaseReg))</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;    NewMinOffset = NewOffset;</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NewOffset &gt; LU.MaxOffset) {</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="LoopStrengthReduce_8cpp.html#a6cfac60f7a8d39786699d498a07ad8f9">isAlwaysFoldable</a>(TTI, Kind, AccessTy, <span class="comment">/*BaseGV=*/</span> 0,</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;                          NewOffset - LU.MinOffset, HasBaseReg))</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    NewMaxOffset = NewOffset;</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;  }</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;  <span class="comment">// Check for a mismatched access type, and fall back conservatively as needed.</span></div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;  <span class="comment">// TODO: Be less conservative when the type is similar and can use the same</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;  <span class="comment">// addressing modes.</span></div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;  <span class="keywordflow">if</span> (Kind == LSRUse::Address &amp;&amp; AccessTy != LU.AccessTy)</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    NewAccessTy = <a class="code" href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(AccessTy-&gt;<a class="code" href="classllvm_1_1Type.html#af348d5ea83429d08ba891ca3dd0e92b2">getContext</a>());</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;  <span class="comment">// Update the use.</span></div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;  LU.MinOffset = NewMinOffset;</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;  LU.MaxOffset = NewMaxOffset;</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;  LU.AccessTy = NewAccessTy;</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;  <span class="keywordflow">if</span> (NewOffset != LU.Offsets.back())</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;    LU.Offsets.push_back(NewOffset);</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;}</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;<span class="comment">/// getUse - Return an LSRUse index and an offset value for a fixup which</span></div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;<span class="comment">/// needs the given expression, with the given kind and optional access type.</span></div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;<span class="comment">/// Either reuse an existing use or create a new one, as needed.</span></div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;<span class="comment"></span>std::pair&lt;size_t, int64_t&gt;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;LSRInstance::getUse(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *&amp;Expr,</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;                    LSRUse::KindType Kind, <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy) {</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Copy = Expr;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;  int64_t Offset = <a class="code" href="LoopStrengthReduce_8cpp.html#ac2da0a3b05aba66c95b7f0b91b5c7c55">ExtractImmediate</a>(Expr, SE);</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;  <span class="comment">// Basic uses can&#39;t accept any offset, for example.</span></div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="LoopStrengthReduce_8cpp.html#a6cfac60f7a8d39786699d498a07ad8f9">isAlwaysFoldable</a>(TTI, Kind, AccessTy, <span class="comment">/*BaseGV=*/</span> 0,</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;                        Offset, <span class="comment">/*HasBaseReg=*/</span> <span class="keyword">true</span>)) {</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;    Expr = Copy;</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    Offset = 0;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;  }</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;  std::pair&lt;UseMapTy::iterator, bool&gt; <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> =</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;    UseMap.insert(std::make_pair(std::make_pair(Expr, Kind), 0));</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;  <span class="keywordflow">if</span> (!P.second) {</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    <span class="comment">// A use already existed with this base.</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;    <span class="keywordtype">size_t</span> LUIdx = P.first-&gt;second;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    LSRUse &amp;LU = Uses[LUIdx];</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;    <span class="keywordflow">if</span> (reconcileNewOffset(LU, Offset, <span class="comment">/*HasBaseReg=*/</span><span class="keyword">true</span>, Kind, AccessTy))</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;      <span class="comment">// Reuse this use.</span></div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;      <span class="keywordflow">return</span> std::make_pair(LUIdx, Offset);</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;  }</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;  <span class="comment">// Create a new use.</span></div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;  <span class="keywordtype">size_t</span> LUIdx = Uses.size();</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;  P.first-&gt;second = LUIdx;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;  Uses.push_back(LSRUse(Kind, AccessTy));</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;  LSRUse &amp;LU = Uses[LUIdx];</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;  <span class="comment">// We don&#39;t need to track redundant offsets, but we don&#39;t need to go out</span></div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;  <span class="comment">// of our way here to avoid them.</span></div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;  <span class="keywordflow">if</span> (LU.Offsets.empty() || Offset != LU.Offsets.back())</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;    LU.Offsets.push_back(Offset);</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;  LU.MinOffset = Offset;</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;  LU.MaxOffset = Offset;</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;  <span class="keywordflow">return</span> std::make_pair(LUIdx, Offset);</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;}</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;<span class="comment">/// DeleteUse - Delete the given use from the Uses list.</span></div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::DeleteUse(LSRUse &amp;LU, <span class="keywordtype">size_t</span> LUIdx) {</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  <span class="keywordflow">if</span> (&amp;LU != &amp;Uses.back())</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(LU, Uses.back());</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;  Uses.pop_back();</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;  <span class="comment">// Update RegUses.</span></div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;  RegUses.SwapAndDropUse(LUIdx, Uses.size());</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;}</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;<span class="comment">/// FindUseWithFormula - Look for a use distinct from OrigLU which is has</span></div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;<span class="comment">/// a formula that has the same registers as the given formula.</span></div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;<span class="comment"></span>LSRUse *</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;LSRInstance::FindUseWithSimilarFormula(<span class="keyword">const</span> Formula &amp;OrigF,</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                                       <span class="keyword">const</span> LSRUse &amp;OrigLU) {</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;  <span class="comment">// Search all uses for the formula. This could be more clever.</span></div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> LUIdx = 0, NumUses = Uses.size(); LUIdx != NumUses; ++LUIdx) {</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;    LSRUse &amp;LU = Uses[LUIdx];</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;    <span class="comment">// Check whether this use is close enough to OrigLU, to see whether it&#39;s</span></div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    <span class="comment">// worthwhile looking through its formulae.</span></div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;    <span class="comment">// Ignore ICmpZero uses because they may contain formulae generated by</span></div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;    <span class="comment">// GenerateICmpZeroScales, in which case adding fixup offsets may</span></div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;    <span class="comment">// be invalid.</span></div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    <span class="keywordflow">if</span> (&amp;LU != &amp;OrigLU &amp;&amp;</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;        LU.Kind != LSRUse::ICmpZero &amp;&amp;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;        LU.Kind == OrigLU.Kind &amp;&amp; OrigLU.AccessTy == LU.AccessTy &amp;&amp;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;        LU.WidestFixupType == OrigLU.WidestFixupType &amp;&amp;</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;        LU.HasFormulaWithSameRegs(OrigF)) {</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;      <span class="comment">// Scan through this use&#39;s formulae.</span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Formula&gt;::const_iterator</a> I = LU.Formulae.begin(),</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;           E = LU.Formulae.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;        <span class="keyword">const</span> Formula &amp;F = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;        <span class="comment">// Check to see if this formula has the same registers and symbols</span></div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;        <span class="comment">// as OrigF.</span></div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;        <span class="keywordflow">if</span> (F.BaseRegs == OrigF.BaseRegs &amp;&amp;</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;            F.ScaledReg == OrigF.ScaledReg &amp;&amp;</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;            F.BaseGV == OrigF.BaseGV &amp;&amp;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;            F.Scale == OrigF.Scale &amp;&amp;</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;            F.UnfoldedOffset == OrigF.UnfoldedOffset) {</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;          <span class="keywordflow">if</span> (F.BaseOffset == 0)</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;            <span class="keywordflow">return</span> &amp;LU;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;          <span class="comment">// This is the formula where all the registers and symbols matched;</span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;          <span class="comment">// there aren&#39;t going to be any others. Since we declined it, we</span></div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;          <span class="comment">// can skip the rest of the formulae and proceed to the next LSRUse.</span></div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;        }</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;      }</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    }</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;  }</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;  <span class="comment">// Nothing looked good.</span></div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;}</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;<span class="keywordtype">void</span> LSRInstance::CollectInterestingTypesAndFactors() {</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;  <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;const SCEV *, 4&gt;</a> Strides;</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;  <span class="comment">// Collect interesting types and strides.</span></div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> Worklist;</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">IVUsers::const_iterator</a> UI = IU.begin(), E = IU.end(); UI != E; ++UI) {</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Expr = IU.getExpr(*UI);</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;    <span class="comment">// Collect interesting types.</span></div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;    Types.insert(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#abb976145b00ae108c1d6b98c4f099d27">getEffectiveSCEVType</a>(Expr-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>()));</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;    <span class="comment">// Add strides for mentioned loops.</span></div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Expr);</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;    <span class="keywordflow">do</span> {</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *S = Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddRecExpr.html">SCEVAddRecExpr</a> *AR = dyn_cast&lt;SCEVAddRecExpr&gt;(S)) {</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;        <span class="keywordflow">if</span> (AR-&gt;getLoop() == L)</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;          Strides.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(AR-&gt;getStepRecurrence(SE));</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;        Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(AR-&gt;getStart());</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddExpr.html">SCEVAddExpr</a> *Add = dyn_cast&lt;SCEVAddExpr&gt;(S)) {</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;        Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a669d55980a7d4b6307b94596deeb0b1f">append</a>(Add-&gt;op_begin(), Add-&gt;op_end());</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;      }</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;    } <span class="keywordflow">while</span> (!Worklist.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>());</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;  }</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;  <span class="comment">// Compute interesting factors from the set of interesting strides.</span></div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;const SCEV *, 4&gt;::const_iterator</a></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;       I = Strides.<a class="code" href="classllvm_1_1SetVector.html#adb13793b98ab59209a5309d26f831850">begin</a>(), E = Strides.<a class="code" href="classllvm_1_1SetVector.html#affac0dc3d407ef3dee29b8bc9a4836bc">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;const SCEV *, 4&gt;::const_iterator</a> NewStrideIter =</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;         <a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(I); NewStrideIter != E; ++NewStrideIter) {</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *OldStride = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *NewStride = *NewStrideIter;</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;      <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(OldStride-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>()) !=</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;          SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(NewStride-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>())) {</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;        <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(OldStride-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>()) &gt;</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;            SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(NewStride-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>()))</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;          NewStride = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a63d4f693eb205bb9d556e067464f943c">getSignExtendExpr</a>(NewStride, OldStride-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>());</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;          OldStride = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a63d4f693eb205bb9d556e067464f943c">getSignExtendExpr</a>(OldStride, NewStride-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>());</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;      }</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a> *Factor =</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;            dyn_cast_or_null&lt;SCEVConstant&gt;(<a class="code" href="LoopStrengthReduce_8cpp.html#a1fc3b7fba8416494790a73f61248b553">getExactSDiv</a>(NewStride, OldStride,</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;                                                        SE, <span class="keyword">true</span>))) {</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;        <span class="keywordflow">if</span> (Factor-&gt;getValue()-&gt;getValue().getMinSignedBits() &lt;= 64)</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;          Factors.insert(Factor-&gt;getValue()-&gt;getValue().getSExtValue());</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a> *Factor =</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;                   dyn_cast_or_null&lt;SCEVConstant&gt;(<a class="code" href="LoopStrengthReduce_8cpp.html#a1fc3b7fba8416494790a73f61248b553">getExactSDiv</a>(OldStride,</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;                                                               NewStride,</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;                                                               SE, <span class="keyword">true</span>))) {</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;        <span class="keywordflow">if</span> (Factor-&gt;getValue()-&gt;getValue().getMinSignedBits() &lt;= 64)</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;          Factors.insert(Factor-&gt;getValue()-&gt;getValue().getSExtValue());</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;      }</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;    }</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  <span class="comment">// If all uses use the same type, don&#39;t bother looking for truncation-based</span></div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;  <span class="comment">// reuse.</span></div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;  <span class="keywordflow">if</span> (Types.size() == 1)</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;    Types.clear();</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(print_factors_and_types(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;}</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;<span class="comment">/// findIVOperand - Helper for CollectChains that finds an IV operand (computed</span></div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;<span class="comment">/// by an AddRec in this loop) within [OI,OE) or returns OE. If IVUsers mapped</span></div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;<span class="comment">/// Instructions to IVStrideUses, we could partially skip this.</span></div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Use.html">User::op_iterator</a></div><div class="line"><a name="l02379"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a262aeb2eecfb752ae2eecb90bab7ec8a"> 2379</a></span>&#160;<a class="code" href="LoopStrengthReduce_8cpp.html#a262aeb2eecfb752ae2eecb90bab7ec8a">findIVOperand</a>(<a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> OI, <a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> OE,</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;              <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L, <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE) {</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;  <span class="keywordflow">for</span>(; OI != OE; ++OI) {</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Oper = dyn_cast&lt;Instruction&gt;(*OI)) {</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;      <span class="keywordflow">if</span> (!SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ae9623974341419bfd1d185cfdc65bedd">isSCEVable</a>(Oper-&gt;getType()))</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddRecExpr.html">SCEVAddRecExpr</a> *AR =</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;          dyn_cast&lt;SCEVAddRecExpr&gt;(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Oper))) {</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;        <span class="keywordflow">if</span> (AR-&gt;getLoop() == L)</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;      }</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;    }</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;  }</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;  <span class="keywordflow">return</span> OI;</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;}</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;<span class="comment">/// getWideOperand - IVChain logic must consistenctly peek base TruncInst</span></div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;<span class="comment">/// operands, so wrap it in a convenient helper.</span></div><div class="line"><a name="l02398"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#ab2b9d94a07d4810717ff828688f7f7aa"> 2398</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="LoopStrengthReduce_8cpp.html#ab2b9d94a07d4810717ff828688f7f7aa">getWideOperand</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *Oper) {</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1TruncInst.html">TruncInst</a> *Trunc = dyn_cast&lt;TruncInst&gt;(Oper))</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;    <span class="keywordflow">return</span> Trunc-&gt;getOperand(0);</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;  <span class="keywordflow">return</span> Oper;</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;}</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;<span class="comment">/// isCompatibleIVType - Return true if we allow an IV chain to include both</span></div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;<span class="comment">/// types.</span></div><div class="line"><a name="l02406"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#ae0967c7d7704831386dbfc70aa58cc02"> 2406</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ae0967c7d7704831386dbfc70aa58cc02">isCompatibleIVType</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *LVal, <a class="code" href="classllvm_1_1Value.html">Value</a> *RVal) {</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *LType = LVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>();</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *RType = RVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>();</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;  <span class="keywordflow">return</span> (LType == RType) || (LType-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>() &amp;&amp; RType-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>());</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;}</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;<span class="comment">/// getExprBase - Return an approximation of this SCEV expression&#39;s &quot;base&quot;, or</span></div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;<span class="comment">/// NULL for any constant. Returning the expression itself is</span></div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;<span class="comment">/// conservative. Returning a deeper subexpression is more precise and valid as</span></div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;<span class="comment">/// long as it isn&#39;t less complex than another subexpression. For expressions</span></div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;<span class="comment">/// involving multiple unscaled values, we need to return the pointer-type</span></div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="comment">/// SCEVUnknown. This avoids forming chains across objects, such as:</span></div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;<span class="comment">/// PrevOper==a[i], IVOper==b[i], IVInc==b-a.</span></div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;<span class="comment">/// Since SCEVUnknown is the rightmost type, and pointers are the rightmost</span></div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;<span class="comment">/// SCEVUnknown, we simply return the rightmost SCEV operand.</span></div><div class="line"><a name="l02422"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#ab383721217ad2417cded7ae55f3a46d8"> 2422</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="LoopStrengthReduce_8cpp.html#ab383721217ad2417cded7ae55f3a46d8">getExprBase</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *S) {</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;  <span class="keywordflow">switch</span> (S-&gt;<a class="code" href="classllvm_1_1SCEV.html#ac08c8d9d93b387dc10681b6f156095bf">getSCEVType</a>()) {</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;  <span class="keywordflow">default</span>: <span class="comment">// uncluding scUnknown.</span></div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>;</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5abcb1f797cb330e61a5879fc260aaec5b">scConstant</a>:</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5ad3656bcc84af213cc488acb56c60de22">scTruncate</a>:</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ab383721217ad2417cded7ae55f3a46d8">getExprBase</a>(cast&lt;SCEVTruncateExpr&gt;(S)-&gt;getOperand());</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5add4a8d5cb0d78c9be22d01e1546bafc6">scZeroExtend</a>:</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ab383721217ad2417cded7ae55f3a46d8">getExprBase</a>(cast&lt;SCEVZeroExtendExpr&gt;(S)-&gt;getOperand());</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5ad05711646a19cb20775cfbc8ef0a8c09">scSignExtend</a>:</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ab383721217ad2417cded7ae55f3a46d8">getExprBase</a>(cast&lt;SCEVSignExtendExpr&gt;(S)-&gt;getOperand());</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5a3a80b1a7dda48464be1849ee1fb85868">scAddExpr</a>: {</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;    <span class="comment">// Skip over scaled operands (scMulExpr) to follow add operands as long as</span></div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;    <span class="comment">// there&#39;s nothing more complex.</span></div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;    <span class="comment">// FIXME: not sure if we want to recognize negation.</span></div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddExpr.html">SCEVAddExpr</a> *Add = cast&lt;SCEVAddExpr&gt;(<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>);</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;    <span class="keywordflow">for</span> (std::reverse_iterator&lt;SCEVAddExpr::op_iterator&gt; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>(Add-&gt;<a class="code" href="classllvm_1_1SCEVNAryExpr.html#a5877c3a289aa71796140f54b73f654f7">op_end</a>()),</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;           E(Add-&gt;<a class="code" href="classllvm_1_1SCEVNAryExpr.html#a107163b3c781d2b0137bf2021e7dc984">op_begin</a>()); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *SubExpr = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;      <span class="keywordflow">if</span> (SubExpr-&gt;<a class="code" href="classllvm_1_1SCEV.html#ac08c8d9d93b387dc10681b6f156095bf">getSCEVType</a>() == <a class="code" href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5a3a80b1a7dda48464be1849ee1fb85868">scAddExpr</a>)</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ab383721217ad2417cded7ae55f3a46d8">getExprBase</a>(SubExpr);</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;      <span class="keywordflow">if</span> (SubExpr-&gt;<a class="code" href="classllvm_1_1SCEV.html#ac08c8d9d93b387dc10681b6f156095bf">getSCEVType</a>() != <a class="code" href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5afd56f054da3d1f9b827ae1003da3a38b">scMulExpr</a>)</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;        <span class="keywordflow">return</span> SubExpr;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;    }</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>; <span class="comment">// all operands are scaled, be conservative.</span></div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;  }</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5a222c9c7b5d5e742d5d1238a3256b1ea5">scAddRecExpr</a>:</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ab383721217ad2417cded7ae55f3a46d8">getExprBase</a>(cast&lt;SCEVAddRecExpr&gt;(S)-&gt;getStart());</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;  }</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;}</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;<span class="comment">/// Return true if the chain increment is profitable to expand into a loop</span></div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;<span class="comment">/// invariant value, which may require its own register. A profitable chain</span></div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;<span class="comment">/// increment will be an offset relative to the same base. We allow such offsets</span></div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;<span class="comment">/// to potentially be used as chain increment as long as it&#39;s not obviously</span></div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;<span class="comment">/// expensive to expand using real instructions.</span></div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> IVChain::isProfitableIncrement(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *OperExpr,</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *IncExpr,</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;                                    <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE) {</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;  <span class="comment">// Aggressively form chains when -stress-ivchain.</span></div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;  <span class="keywordflow">if</span> (StressIVChain)</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;  <span class="comment">// Do not replace a constant offset from IV head with a nonconstant IV</span></div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;  <span class="comment">// increment.</span></div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;SCEVConstant&gt;(IncExpr)) {</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *HeadExpr = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(<a class="code" href="LoopStrengthReduce_8cpp.html#ab2b9d94a07d4810717ff828688f7f7aa">getWideOperand</a>(Incs[0].IVOperand));</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;    <span class="keywordflow">if</span> (isa&lt;SCEVConstant&gt;(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#aa888e3661c809163273aca85ded4d846">getMinusSCEV</a>(OperExpr, HeadExpr)))</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;  }</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV*, 8&gt;</a> Processed;</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;  <span class="keywordflow">return</span> !<a class="code" href="LoopStrengthReduce_8cpp.html#ab64b1c61d33b56b06309856e9f9ccf9d">isHighCostExpansion</a>(IncExpr, Processed, SE);</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;}</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;<span class="comment">/// Return true if the number of registers needed for the chain is estimated to</span></div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;<span class="comment">/// be less than the number required for the individual IV users. First prohibit</span></div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;<span class="comment">/// any IV users that keep the IV live across increments (the Users set should</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;<span class="comment">/// be empty). Next count the number and type of increments in the chain.</span></div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;<span class="comment">/// Chaining IVs can lead to considerable code bloat if ISEL doesn&#39;t</span></div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;<span class="comment">/// effectively use postinc addressing modes. Only consider it profitable it the</span></div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;<span class="comment">/// increments can be computed in fewer registers when chained.</span></div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;<span class="comment">/// TODO: Consider IVInc free if it&#39;s already used in another chains.</span></div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span></div><div class="line"><a name="l02490"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a55480bacd3e194a605de7c5add4f3637"> 2490</a></span>&#160;<a class="code" href="LoopStrengthReduce_8cpp.html#a55480bacd3e194a605de7c5add4f3637">isProfitableChain</a>(IVChain &amp;Chain, <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction*, 4&gt;</a> &amp;<a class="code" href="IVUsers_8cpp.html#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>,</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;                  <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI) {</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;  <span class="keywordflow">if</span> (StressIVChain)</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;  <span class="keywordflow">if</span> (!Chain.hasIncs())</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;  <span class="keywordflow">if</span> (!Users.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a095445850ef2c64e96b4c05120cecf66">empty</a>()) {</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Chain: &quot;</span> &lt;&lt; *Chain.Incs[0].UserInst &lt;&lt; <span class="stringliteral">&quot; users:\n&quot;</span>;</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;          <a class="code" href="Target_2README_8txt.html#a7df6ed7588301267782c2bd4b7f6899d">for</a> (<a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction*, 4&gt;::const_iterator</a> I = Users.<a class="code" href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">begin</a>(),</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;                 E = Users.<a class="code" href="classllvm_1_1SmallPtrSet.html#a7f055d0b03ebf1d6a5988b178e9b8f4f">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;            <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; **I &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;          });</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;  }</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;  assert(!Chain.Incs.empty() &amp;&amp; <span class="stringliteral">&quot;empty IV chains are not allowed&quot;</span>);</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;  <span class="comment">// The chain itself may require a register, so intialize cost to 1.</span></div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="InlineCost_8cpp.html#ab6ddd0dbb46ded4c06ea4031e40c7fb8">cost</a> = 1;</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;  <span class="comment">// A complete chain likely eliminates the need for keeping the original IV in</span></div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;  <span class="comment">// a register. LSR does not currently know how to form a complete chain unless</span></div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;  <span class="comment">// the header phi already exists.</span></div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;  <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(Chain.tailUserInst())</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;      &amp;&amp; SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Chain.tailUserInst()) == Chain.Incs[0].IncExpr) {</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;    --<a class="code" href="InlineCost_8cpp.html#ab6ddd0dbb46ded4c06ea4031e40c7fb8">cost</a>;</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;  }</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *LastIncExpr = 0;</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;  <span class="keywordtype">unsigned</span> NumConstIncrements = 0;</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;  <span class="keywordtype">unsigned</span> NumVarIncrements = 0;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;  <span class="keywordtype">unsigned</span> NumReusedIncrements = 0;</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;  <span class="keywordflow">for</span> (IVChain::const_iterator I = Chain.begin(), E = Chain.end();</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;       I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    <span class="keywordflow">if</span> (I-&gt;IncExpr-&gt;isZero())</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;    <span class="comment">// Incrementing by zero or some constant is neutral. We assume constants can</span></div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    <span class="comment">// be folded into an addressing mode or an add&#39;s immediate operand.</span></div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="keywordflow">if</span> (isa&lt;SCEVConstant&gt;(I-&gt;IncExpr)) {</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;      ++NumConstIncrements;</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;    }</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;    <span class="keywordflow">if</span> (I-&gt;IncExpr == LastIncExpr)</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;      ++NumReusedIncrements;</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;      ++NumVarIncrements;</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;    LastIncExpr = I-&gt;IncExpr;</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;  }</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;  <span class="comment">// An IV chain with a single increment is handled by LSR&#39;s postinc</span></div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;  <span class="comment">// uses. However, a chain with multiple increments requires keeping the IV&#39;s</span></div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;  <span class="comment">// value live longer than it needs to be if chained.</span></div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;  <span class="keywordflow">if</span> (NumConstIncrements &gt; 1)</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;    --<a class="code" href="InlineCost_8cpp.html#ab6ddd0dbb46ded4c06ea4031e40c7fb8">cost</a>;</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;  <span class="comment">// Materializing increment expressions in the preheader that didn&#39;t exist in</span></div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;  <span class="comment">// the original code may cost a register. For example, sign-extended array</span></div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;  <span class="comment">// indices can produce ridiculous increments like this:</span></div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;  <span class="comment">// IV + ((sext i32 (2 * %s) to i64) + (-1 * (sext i32 %s to i64)))</span></div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;  cost += NumVarIncrements;</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;  <span class="comment">// Reusing variable increments likely saves a register to hold the multiple of</span></div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;  <span class="comment">// the stride.</span></div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;  cost -= NumReusedIncrements;</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Chain: &quot;</span> &lt;&lt; *Chain.Incs[0].UserInst &lt;&lt; <span class="stringliteral">&quot; Cost: &quot;</span> &lt;&lt; cost</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;  <span class="keywordflow">return</span> cost &lt; 0;</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;}</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;<span class="comment">/// ChainInstruction - Add this IV user to an existing chain or make it the head</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;<span class="comment">/// of a new chain.</span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::ChainInstruction(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserInst, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *IVOper,</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;                                   <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ChainUsers&gt;</a> &amp;ChainUsersVec) {</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;  <span class="comment">// When IVs are used as types of varying widths, they are generally converted</span></div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;  <span class="comment">// to a wider type with some uses remaining narrow under a (free) trunc.</span></div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<span class="keyword">const</span> NextIV = <a class="code" href="LoopStrengthReduce_8cpp.html#ab2b9d94a07d4810717ff828688f7f7aa">getWideOperand</a>(IVOper);</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<span class="keyword">const</span> OperExpr = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(NextIV);</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<span class="keyword">const</span> OperExprBase = <a class="code" href="LoopStrengthReduce_8cpp.html#ab383721217ad2417cded7ae55f3a46d8">getExprBase</a>(OperExpr);</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;  <span class="comment">// Visit all existing chains. Check if its IVOper can be computed as a</span></div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;  <span class="comment">// profitable loop invariant increment from the last link in the Chain.</span></div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;  <span class="keywordtype">unsigned</span> ChainIdx = 0, NChains = IVChainVec.size();</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *LastIncExpr = 0;</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;  <span class="keywordflow">for</span> (; ChainIdx &lt; NChains; ++ChainIdx) {</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;    IVChain &amp;Chain = IVChainVec[ChainIdx];</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;    <span class="comment">// Prune the solution space aggressively by checking that both IV operands</span></div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;    <span class="comment">// are expressions that operate on the same unscaled SCEVUnknown. This</span></div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;    <span class="comment">// &quot;base&quot; will be canceled by the subsequent getMinusSCEV call. Checking</span></div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;    <span class="comment">// first avoids creating extra SCEV expressions.</span></div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;    <span class="keywordflow">if</span> (!StressIVChain &amp;&amp; Chain.ExprBase != OperExprBase)</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *PrevIV = <a class="code" href="LoopStrengthReduce_8cpp.html#ab2b9d94a07d4810717ff828688f7f7aa">getWideOperand</a>(Chain.Incs.back().IVOperand);</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="LoopStrengthReduce_8cpp.html#ae0967c7d7704831386dbfc70aa58cc02">isCompatibleIVType</a>(PrevIV, NextIV))</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;    <span class="comment">// A phi node terminates a chain.</span></div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;    <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(UserInst) &amp;&amp; isa&lt;PHINode&gt;(Chain.tailUserInst()))</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;    <span class="comment">// The increment must be loop-invariant so it can be kept in a register.</span></div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *PrevExpr = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(PrevIV);</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *IncExpr = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#aa888e3661c809163273aca85ded4d846">getMinusSCEV</a>(OperExpr, PrevExpr);</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;    <span class="keywordflow">if</span> (!SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a5a19768af81df7e5fe571bc08dcd48b3">isLoopInvariant</a>(IncExpr, L))</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;    <span class="keywordflow">if</span> (Chain.isProfitableIncrement(OperExpr, IncExpr, SE)) {</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;      LastIncExpr = IncExpr;</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;    }</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;  }</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;  <span class="comment">// If we haven&#39;t found a chain, create a new one, unless we hit the max. Don&#39;t</span></div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;  <span class="comment">// bother for phi nodes, because they must be last in the chain.</span></div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;  <span class="keywordflow">if</span> (ChainIdx == NChains) {</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;    <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(UserInst))</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;    <span class="keywordflow">if</span> (NChains &gt;= MaxChains &amp;&amp; !StressIVChain) {</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;IV Chain Limit\n&quot;</span>);</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;    }</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;    LastIncExpr = OperExpr;</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;    <span class="comment">// IVUsers may have skipped over sign/zero extensions. We don&#39;t currently</span></div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;    <span class="comment">// attempt to form chains involving extensions unless they can be hoisted</span></div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;    <span class="comment">// into this loop&#39;s AddRec.</span></div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;SCEVAddRecExpr&gt;(LastIncExpr))</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;    ++NChains;</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;    IVChainVec.push_back(IVChain(IVInc(UserInst, IVOper, LastIncExpr),</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;                                 OperExprBase));</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;    ChainUsersVec.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a102d0ad36060677286c3aefb812e5512">resize</a>(NChains);</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;IV Chain#&quot;</span> &lt;&lt; ChainIdx &lt;&lt; <span class="stringliteral">&quot; Head: (&quot;</span> &lt;&lt; *UserInst</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;) IV=&quot;</span> &lt;&lt; *LastIncExpr &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;IV Chain#&quot;</span> &lt;&lt; ChainIdx &lt;&lt; <span class="stringliteral">&quot;  Inc: (&quot;</span> &lt;&lt; *UserInst</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;) IV+&quot;</span> &lt;&lt; *LastIncExpr &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;    <span class="comment">// Add this IV user to the end of the chain.</span></div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;    IVChainVec[ChainIdx].add(IVInc(UserInst, IVOper, LastIncExpr));</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;  }</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;  IVChain &amp;Chain = IVChainVec[ChainIdx];</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction*,4&gt;</a> &amp;NearUsers = ChainUsersVec[ChainIdx].NearUsers;</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;  <span class="comment">// This chain&#39;s NearUsers become FarUsers.</span></div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;  <span class="keywordflow">if</span> (!LastIncExpr-&gt;<a class="code" href="classllvm_1_1SCEV.html#a3f76d2fd4788225548dc36ef9e417030">isZero</a>()) {</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;    ChainUsersVec[ChainIdx].FarUsers.<a class="code" href="classllvm_1_1SmallVectorImpl.html#af622128e353515efebccad40eae495cb">insert</a>(NearUsers.<a class="code" href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">begin</a>(),</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;                                            NearUsers.<a class="code" href="classllvm_1_1SmallPtrSet.html#a7f055d0b03ebf1d6a5988b178e9b8f4f">end</a>());</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;    NearUsers.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#aa72472422d95c7052d62432ec279ff85">clear</a>();</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;  }</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;  <span class="comment">// All other uses of IVOperand become near uses of the chain.</span></div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;  <span class="comment">// We currently ignore intermediate values within SCEV expressions, assuming</span></div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;  <span class="comment">// they will eventually be used be the current chain, or can be computed</span></div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;  <span class="comment">// from one of the chain increments. To be more precise we could</span></div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;  <span class="comment">// transitively follow its user and only add leaf IV users to the set.</span></div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UseIter = IVOper-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(),</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;         UseEnd = IVOper-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UseIter != UseEnd; ++UseIter) {</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *OtherUse = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(*UseIter);</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;    <span class="keywordflow">if</span> (!OtherUse)</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;    <span class="comment">// Uses in the chain will no longer be uses if the chain is formed.</span></div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;    <span class="comment">// Include the head of the chain in this iteration (not Chain.begin()).</span></div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;    IVChain::const_iterator IncIter = Chain.Incs.begin();</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;    IVChain::const_iterator IncEnd = Chain.Incs.end();</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    <span class="keywordflow">for</span>( ; IncIter != IncEnd; ++IncIter) {</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;      <span class="keywordflow">if</span> (IncIter-&gt;UserInst == OtherUse)</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;    }</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;    <span class="keywordflow">if</span> (IncIter != IncEnd)</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;    <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ae9623974341419bfd1d185cfdc65bedd">isSCEVable</a>(OtherUse-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;        &amp;&amp; !isa&lt;SCEVUnknown&gt;(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(OtherUse))</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;        &amp;&amp; IU.isIVUserOrOperand(OtherUse)) {</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;    }</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;    NearUsers.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(OtherUse);</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;  }</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;  <span class="comment">// Since this user is part of the chain, it&#39;s no longer considered a use</span></div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;  <span class="comment">// of the chain.</span></div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;  ChainUsersVec[ChainIdx].FarUsers.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">erase</a>(UserInst);</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;}</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;<span class="comment">/// CollectChains - Populate the vector of Chains.</span></div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;<span class="comment">/// This decreases ILP at the architecture level. Targets with ample registers,</span></div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;<span class="comment">/// multiple memory ports, and no register renaming probably don&#39;t want</span></div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;<span class="comment">/// this. However, such targets should probably disable LSR altogether.</span></div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;<span class="comment">/// The job of LSR is to make a reasonable choice of induction variables across</span></div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;<span class="comment">/// the loop. Subsequent passes can easily &quot;unchain&quot; computation exposing more</span></div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;<span class="comment">/// ILP *within the loop* if the target wants it.</span></div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;<span class="comment">/// Finding the best IV chain is potentially a scheduling problem. Since LSR</span></div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;<span class="comment">/// will not reorder memory operations, it will recognize this as a chain, but</span></div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;<span class="comment">/// will generate redundant IV increments. Ideally this would be corrected later</span></div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;<span class="comment">/// by a smart scheduler:</span></div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;<span class="comment">///        = A[i]</span></div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;<span class="comment">///        = A[i+x]</span></div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;<span class="comment">/// A[i]   =</span></div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;<span class="comment">/// A[i+x] =</span></div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;<span class="comment">/// TODO: Walk the entire domtree within this loop, not just the path to the</span></div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;<span class="comment">/// loop latch. This will discover chains on side paths, but requires</span></div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;<span class="comment">/// maintaining multiple copies of the Chains state.</span></div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::CollectChains() {</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Collecting IV Chains.\n&quot;</span>);</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ChainUsers, 8&gt;</a> ChainUsersVec;</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *,8&gt;</a> LatchPath;</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *LoopHeader = L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>();</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNode</a> *Rung = DT.<a class="code" href="classllvm_1_1DominatorTree.html#a307665a69dff132a967d4f0d2acd3791">getNode</a>(L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a8917d359fc92f25eb0117386588c6f1c">getLoopLatch</a>());</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;       Rung-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a96fd2f0087c41942dd2618ff6e1b8640">getBlock</a>() != LoopHeader; Rung = Rung-&gt;getIDom()) {</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;    LatchPath.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Rung-&gt;getBlock());</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;  }</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;  LatchPath.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(LoopHeader);</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;  <span class="comment">// Walk the instruction stream from the loop header to the loop latch.</span></div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;BasicBlock *&gt;::reverse_iterator</a></div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;         BBIter = LatchPath.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a23aab542398091e1fcfd46b6006d64ac">rbegin</a>(), BBEnd = LatchPath.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#ad696953257cf1c4e5bd12d02146e7287">rend</a>();</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;       BBIter != BBEnd; ++BBIter) {</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> I = (*BBIter)-&gt;begin(), E = (*BBIter)-&gt;end();</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;         I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;      <span class="comment">// Skip instructions that weren&#39;t seen by IVUsers analysis.</span></div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;      <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(I) || !IU.isIVUserOrOperand(I))</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;      <span class="comment">// Ignore users that are part of a SCEV expression. This way we only</span></div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;      <span class="comment">// consider leaf IV Users. This effectively rediscovers a portion of</span></div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;      <span class="comment">// IVUsers analysis but in program order this time.</span></div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;      <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ae9623974341419bfd1d185cfdc65bedd">isSCEVable</a>(I-&gt;getType()) &amp;&amp; !isa&lt;SCEVUnknown&gt;(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(I)))</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;      <span class="comment">// Remove this instruction from any NearUsers set it may be in.</span></div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> ChainIdx = 0, NChains = IVChainVec.size();</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;           ChainIdx &lt; NChains; ++ChainIdx) {</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;        ChainUsersVec[ChainIdx].NearUsers.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">erase</a>(I);</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;      }</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;      <span class="comment">// Search for operands that can be chained.</span></div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;      <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction*, 4&gt;</a> UniqueOperands;</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;      <a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> IVOpEnd = I-&gt;op_end();</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;      <a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> IVOpIter = <a class="code" href="LoopStrengthReduce_8cpp.html#a262aeb2eecfb752ae2eecb90bab7ec8a">findIVOperand</a>(I-&gt;op_begin(), IVOpEnd, L, SE);</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;      <span class="keywordflow">while</span> (IVOpIter != IVOpEnd) {</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *IVOpInst = cast&lt;Instruction&gt;(*IVOpIter);</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;        <span class="keywordflow">if</span> (UniqueOperands.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(IVOpInst))</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;          ChainInstruction(I, IVOpInst, ChainUsersVec);</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;        IVOpIter = <a class="code" href="LoopStrengthReduce_8cpp.html#a262aeb2eecfb752ae2eecb90bab7ec8a">findIVOperand</a>(<a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(IVOpIter), IVOpEnd, L, SE);</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;      }</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;    } <span class="comment">// Continue walking down the instructions.</span></div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;  } <span class="comment">// Continue walking down the domtree.</span></div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;  <span class="comment">// Visit phi backedges to determine if the chain can generate the IV postinc.</span></div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> I = L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;       <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;    <span class="keywordflow">if</span> (!SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ae9623974341419bfd1d185cfdc65bedd">isSCEVable</a>(PN-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()))</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *IncV =</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;      <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a8917d359fc92f25eb0117386588c6f1c">getLoopLatch</a>()));</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;    <span class="keywordflow">if</span> (IncV)</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;      ChainInstruction(PN, IncV, ChainUsersVec);</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;  }</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;  <span class="comment">// Remove any unprofitable chains.</span></div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;  <span class="keywordtype">unsigned</span> ChainIdx = 0;</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> UsersIdx = 0, NChains = IVChainVec.size();</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;       UsersIdx &lt; NChains; ++UsersIdx) {</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="LoopStrengthReduce_8cpp.html#a55480bacd3e194a605de7c5add4f3637">isProfitableChain</a>(IVChainVec[UsersIdx],</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;                           ChainUsersVec[UsersIdx].FarUsers, SE, TTI))</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;    <span class="comment">// Preserve the chain at UsesIdx.</span></div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    <span class="keywordflow">if</span> (ChainIdx != UsersIdx)</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;      IVChainVec[ChainIdx] = IVChainVec[UsersIdx];</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;    FinalizeChain(IVChainVec[ChainIdx]);</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;    ++ChainIdx;</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;  }</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;  IVChainVec.resize(ChainIdx);</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;}</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;<span class="keywordtype">void</span> LSRInstance::FinalizeChain(IVChain &amp;Chain) {</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;  assert(!Chain.Incs.empty() &amp;&amp; <span class="stringliteral">&quot;empty IV chains are not allowed&quot;</span>);</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Final Chain: &quot;</span> &lt;&lt; *Chain.Incs[0].UserInst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;  <span class="keywordflow">for</span> (IVChain::const_iterator I = Chain.begin(), E = Chain.end();</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;       I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;        Inc: &quot;</span> &lt;&lt; *I-&gt;UserInst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;    <a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> UseI =</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;      std::find(I-&gt;UserInst-&gt;op_begin(), I-&gt;UserInst-&gt;op_end(), I-&gt;IVOperand);</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;    assert(UseI != I-&gt;UserInst-&gt;op_end() &amp;&amp; <span class="stringliteral">&quot;cannot find IV operand&quot;</span>);</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;    IVIncSet.insert(UseI);</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;  }</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;}</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;<span class="comment">/// Return true if the IVInc can be folded into an addressing mode.</span></div><div class="line"><a name="l02787"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#ad35b9a85ea52062375c0c870be5cd228"> 2787</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="LoopStrengthReduce_8cpp.html#ad35b9a85ea52062375c0c870be5cd228">canFoldIVIncExpr</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *IncExpr, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserInst,</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;                             <a class="code" href="classllvm_1_1Value.html">Value</a> *Operand, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI) {</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a> *IncConst = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a>&gt;(IncExpr);</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;  <span class="keywordflow">if</span> (!IncConst || !<a class="code" href="LoopStrengthReduce_8cpp.html#ad291a495c56b2c53e65dc8afe823b073">isAddressUse</a>(UserInst, Operand))</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;  <span class="keywordflow">if</span> (IncConst-&gt;<a class="code" href="classllvm_1_1SCEVConstant.html#a64f0133adf37f9513005465580a19a66">getValue</a>()-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a5d15af723179356228265f1f12b9f4e2">getMinSignedBits</a>() &gt; 64)</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;  int64_t IncOffset = IncConst-&gt;<a class="code" href="classllvm_1_1SCEVConstant.html#a64f0133adf37f9513005465580a19a66">getValue</a>()-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a097c2d42e4deffabe6d54b007ad83367">getSExtValue</a>();</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="LoopStrengthReduce_8cpp.html#a6cfac60f7a8d39786699d498a07ad8f9">isAlwaysFoldable</a>(TTI, LSRUse::Address,</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;                        <a class="code" href="LoopStrengthReduce_8cpp.html#a4f07d245cf5f31e5b86ee80c06ab949a">getAccessType</a>(UserInst), <span class="comment">/*BaseGV=*/</span> 0,</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;                        IncOffset, <span class="comment">/*HaseBaseReg=*/</span> <span class="keyword">false</span>))</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;}</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;<span class="comment">/// GenerateIVChains - Generate an add or subtract for each IVInc in a chain to</span></div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;<span class="comment">/// materialize the IV user&#39;s operand from the previous IV user&#39;s operand.</span></div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::GenerateIVChain(<span class="keyword">const</span> IVChain &amp;Chain, <a class="code" href="classllvm_1_1SCEVExpander.html">SCEVExpander</a> &amp;<a class="code" href="VirtRegMap_8cpp.html#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>,</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;                                  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;WeakVH&gt;</a> &amp;DeadInsts) {</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;  <span class="comment">// Find the new IVOperand for the head of the chain. It may have been replaced</span></div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;  <span class="comment">// by LSR.</span></div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;  <span class="keyword">const</span> IVInc &amp;Head = Chain.Incs[0];</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;  <a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> IVOpEnd = Head.UserInst-&gt;op_end();</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;  <span class="comment">// findIVOperand returns IVOpEnd if it can no longer find a valid IV user.</span></div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;  <a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> IVOpIter = <a class="code" href="LoopStrengthReduce_8cpp.html#a262aeb2eecfb752ae2eecb90bab7ec8a">findIVOperand</a>(Head.UserInst-&gt;op_begin(),</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;                                             IVOpEnd, L, SE);</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *IVSrc = 0;</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;  <span class="keywordflow">while</span> (IVOpIter != IVOpEnd) {</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;    IVSrc = <a class="code" href="LoopStrengthReduce_8cpp.html#ab2b9d94a07d4810717ff828688f7f7aa">getWideOperand</a>(*IVOpIter);</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;    <span class="comment">// If this operand computes the expression that the chain needs, we may use</span></div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;    <span class="comment">// it. (Check this after setting IVSrc which is used below.)</span></div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;    <span class="comment">// Note that if Head.IncExpr is wider than IVSrc, then this phi is too</span></div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;    <span class="comment">// narrow for the chain, so we can no longer use it. We do allow using a</span></div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;    <span class="comment">// wider phi, assuming the LSR checked for free truncation. In that case we</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;    <span class="comment">// should already have a truncate on this operand such that</span></div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;    <span class="comment">// getSCEV(IVSrc) == IncExpr.</span></div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;    <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(*IVOpIter) == Head.IncExpr</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;        || SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(IVSrc) == Head.IncExpr) {</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;    }</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;    IVOpIter = <a class="code" href="LoopStrengthReduce_8cpp.html#a262aeb2eecfb752ae2eecb90bab7ec8a">findIVOperand</a>(<a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(IVOpIter), IVOpEnd, L, SE);</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;  }</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;  <span class="keywordflow">if</span> (IVOpIter == IVOpEnd) {</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;    <span class="comment">// Gracefully give up on this chain.</span></div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Concealed chain head: &quot;</span> &lt;&lt; *Head.UserInst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;  }</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Generate chain at: &quot;</span> &lt;&lt; *IVSrc &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *IVTy = IVSrc-&gt;getType();</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *IntTy = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#abb976145b00ae108c1d6b98c4f099d27">getEffectiveSCEVType</a>(IVTy);</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *LeftOverExpr = 0;</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;  <span class="keywordflow">for</span> (IVChain::const_iterator IncI = Chain.begin(),</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;         IncE = Chain.end(); IncI != IncE; ++IncI) {</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertPt = IncI-&gt;UserInst;</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;    <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(InsertPt))</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;      InsertPt = L-&gt;getLoopLatch()-&gt;getTerminator();</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;    <span class="comment">// IVOper will replace the current IV User&#39;s operand. IVSrc is the IV</span></div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;    <span class="comment">// value currently held in a register.</span></div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *IVOper = IVSrc;</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;    <span class="keywordflow">if</span> (!IncI-&gt;IncExpr-&gt;isZero()) {</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;      <span class="comment">// IncExpr was the result of subtraction of two narrow values, so must</span></div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;      <span class="comment">// be signed.</span></div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *IncExpr = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a38c440751f1bf5f19bc12b95f8f0f2a6">getNoopOrSignExtend</a>(IncI-&gt;IncExpr, IntTy);</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;      LeftOverExpr = LeftOverExpr ?</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;        SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(LeftOverExpr, IncExpr) : IncExpr;</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;    }</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;    <span class="keywordflow">if</span> (LeftOverExpr &amp;&amp; !LeftOverExpr-&gt;<a class="code" href="classllvm_1_1SCEV.html#a3f76d2fd4788225548dc36ef9e417030">isZero</a>()) {</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;      <span class="comment">// Expand the IV increment.</span></div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;      Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#a767b257cc39ee9ea9e0edcee4220c00c">clearPostInc</a>();</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *IncV = Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#a583d3ca95f83216d632a4d1ae0330dd0">expandCodeFor</a>(LeftOverExpr, IntTy, InsertPt);</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *IVOperExpr = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad8e4f5b2ced08ad7d138b598aefdd338">getUnknown</a>(IVSrc),</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;                                             SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad8e4f5b2ced08ad7d138b598aefdd338">getUnknown</a>(IncV));</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;      IVOper = Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#a583d3ca95f83216d632a4d1ae0330dd0">expandCodeFor</a>(IVOperExpr, IVTy, InsertPt);</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;      <span class="comment">// If an IV increment can&#39;t be folded, use it as the next IV value.</span></div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="LoopStrengthReduce_8cpp.html#ad35b9a85ea52062375c0c870be5cd228">canFoldIVIncExpr</a>(LeftOverExpr, IncI-&gt;UserInst, IncI-&gt;IVOperand,</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;                            TTI)) {</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;        assert(IVTy == IVOper-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() &amp;&amp; <span class="stringliteral">&quot;inconsistent IV increment type&quot;</span>);</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;        IVSrc = IVOper;</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;        LeftOverExpr = 0;</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;      }</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;    }</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *OperTy = IncI-&gt;IVOperand-&gt;getType();</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;    <span class="keywordflow">if</span> (IVTy != OperTy) {</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;      assert(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(IVTy) &gt;= SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(OperTy) &amp;&amp;</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;             <span class="stringliteral">&quot;cannot extend a chained IV&quot;</span>);</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;      <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(InsertPt);</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;      IVOper = Builder.CreateTruncOrBitCast(IVOper, OperTy, <span class="stringliteral">&quot;lsr.chain&quot;</span>);</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;    }</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;    IncI-&gt;UserInst-&gt;replaceUsesOfWith(IncI-&gt;IVOperand, IVOper);</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;    DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(IncI-&gt;IVOperand);</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;  }</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;  <span class="comment">// If LSR created a new, wider phi, we may also replace its postinc. We only</span></div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;  <span class="comment">// do this if we also found a wide value for the head of the chain.</span></div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;  <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(Chain.tailUserInst())) {</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> I = L-&gt;getHeader()-&gt;begin();</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;         <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *Phi = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="LoopStrengthReduce_8cpp.html#ae0967c7d7704831386dbfc70aa58cc02">isCompatibleIVType</a>(Phi, IVSrc))</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *PostIncV = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;        Phi-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(L-&gt;getLoopLatch()));</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;      <span class="keywordflow">if</span> (!PostIncV || (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(PostIncV) != SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(IVSrc)))</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *IVOper = IVSrc;</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *PostIncTy = PostIncV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>();</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;      <span class="keywordflow">if</span> (IVTy != PostIncTy) {</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;        assert(PostIncTy-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>() &amp;&amp; <span class="stringliteral">&quot;mixing int/ptr IV types&quot;</span>);</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;        <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(L-&gt;getLoopLatch()-&gt;getTerminator());</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;        Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a571ae7ebae7038da7f6073efc65aaa50">SetCurrentDebugLocation</a>(PostIncV-&gt;<a class="code" href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">getDebugLoc</a>());</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;        IVOper = Builder.CreatePointerCast(IVSrc, PostIncTy, <span class="stringliteral">&quot;lsr.chain&quot;</span>);</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;      }</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;      Phi-&gt;<a class="code" href="classllvm_1_1User.html#a1f0b9358936e3e00c42a460abbfb2868">replaceUsesOfWith</a>(PostIncV, IVOper);</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;      DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(PostIncV);</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;    }</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;  }</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;}</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;<span class="keywordtype">void</span> LSRInstance::CollectFixupsAndInitialFormulae() {</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">IVUsers::const_iterator</a> UI = IU.begin(), E = IU.end(); UI != E; ++UI) {</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserInst = UI-&gt;getUser();</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;    <span class="comment">// Skip IV users that are part of profitable IV Chains.</span></div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;    <a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> UseI = std::find(UserInst-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>(), UserInst-&gt;<a class="code" href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">op_end</a>(),</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;                                       UI-&gt;getOperandValToReplace());</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;    assert(UseI != UserInst-&gt;<a class="code" href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">op_end</a>() &amp;&amp; <span class="stringliteral">&quot;cannot find IV operand&quot;</span>);</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;    <span class="keywordflow">if</span> (IVIncSet.count(UseI))</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;    <span class="comment">// Record the uses.</span></div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;    LSRFixup &amp;LF = getNewFixup();</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;    LF.UserInst = UserInst;</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;    LF.OperandValToReplace = UI-&gt;getOperandValToReplace();</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    LF.PostIncLoops = UI-&gt;getPostIncLoops();</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;    LSRUse::KindType Kind = LSRUse::Basic;</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *AccessTy = 0;</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="LoopStrengthReduce_8cpp.html#ad291a495c56b2c53e65dc8afe823b073">isAddressUse</a>(LF.UserInst, LF.OperandValToReplace)) {</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;      Kind = LSRUse::Address;</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;      AccessTy = <a class="code" href="LoopStrengthReduce_8cpp.html#a4f07d245cf5f31e5b86ee80c06ab949a">getAccessType</a>(LF.UserInst);</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;    }</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *S = IU.getExpr(*UI);</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;    <span class="comment">// Equality (== and !=) ICmps are special. We can rewrite (i == N) as</span></div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;    <span class="comment">// (N - i == 0), and this allows (N - i) to be the expression that we work</span></div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;    <span class="comment">// with rather than just N or i, so we can consider the register</span></div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;    <span class="comment">// requirements for both N and i at the same time. Limiting this code to</span></div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;    <span class="comment">// equality icmps is not a problem because all interesting loops use</span></div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;    <span class="comment">// equality icmps, thanks to IndVarSimplify.</span></div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *CI = dyn_cast&lt;ICmpInst&gt;(LF.UserInst))</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;      <span class="keywordflow">if</span> (CI-&gt;isEquality()) {</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;        <span class="comment">// Swap the operands if needed to put the OperandValToReplace on the</span></div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;        <span class="comment">// left, for consistency.</span></div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8">NV</a> = CI-&gt;getOperand(1);</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;        <span class="keywordflow">if</span> (NV == LF.OperandValToReplace) {</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;          CI-&gt;setOperand(1, CI-&gt;getOperand(0));</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;          CI-&gt;setOperand(0, NV);</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;          NV = CI-&gt;getOperand(1);</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;          Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;        }</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;        <span class="comment">// x == y  --&gt;  x - y == 0</span></div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;        <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(NV);</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;        <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a5a19768af81df7e5fe571bc08dcd48b3">isLoopInvariant</a>(N, L) &amp;&amp; <a class="code" href="namespacellvm.html#aed54a8c39c1f5f066957f1297bd6bd0b">isSafeToExpand</a>(N, SE)) {</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;          <span class="comment">// S is normalized, so normalize N before folding it into S</span></div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;          <span class="comment">// to keep the result normalized.</span></div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;          N = <a class="code" href="namespacellvm.html#adfac6898b7e6f186616ff5c337670296">TransformForPostIncUse</a>(<a class="code" href="namespacellvm.html#a72e1beba38b6627c9307ab8b5141ac64aeb131ce4dfb8eeef7197e6b0afd145d4">Normalize</a>, N, CI, 0,</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;                                     LF.PostIncLoops, SE, DT);</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;          Kind = LSRUse::ICmpZero;</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;          S = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#aa888e3661c809163273aca85ded4d846">getMinusSCEV</a>(N, S);</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;        }</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;        <span class="comment">// -1 and the negations of all interesting strides (except the negation</span></div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;        <span class="comment">// of -1) are now also interesting.</span></div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, e = Factors.size(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;          <span class="keywordflow">if</span> (Factors[i] != -1)</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;            Factors.insert(-(uint64_t)Factors[i]);</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;        Factors.insert(-1);</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;      }</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;    <span class="comment">// Set up the initial formula for this use.</span></div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;    std::pair&lt;size_t, int64_t&gt; <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = getUse(S, Kind, AccessTy);</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;    LF.LUIdx = P.first;</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;    LF.Offset = P.second;</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;    LSRUse &amp;LU = Uses[LF.LUIdx];</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;    LU.AllFixupsOutsideLoop &amp;= LF.isUseFullyOutsideLoop(L);</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;    <span class="keywordflow">if</span> (!LU.WidestFixupType ||</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;        SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(LU.WidestFixupType) &lt;</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;        SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(LF.OperandValToReplace-&gt;getType()))</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;      LU.WidestFixupType = LF.OperandValToReplace-&gt;getType();</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;    <span class="comment">// If this is the first use of this LSRUse, give it a formula.</span></div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;    <span class="keywordflow">if</span> (LU.Formulae.empty()) {</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;      InsertInitialFormula(S, LU, LF.LUIdx);</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;      CountRegisters(LU.Formulae.back(), LF.LUIdx);</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;    }</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;  }</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(print_fixups(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;}</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;<span class="comment">/// InsertInitialFormula - Insert a formula for the given expression into</span></div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;<span class="comment">/// the given use, separating out loop-variant portions from loop-invariant</span></div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;<span class="comment">/// and loop-computable portions.</span></div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;<span class="comment"></span><span class="keywordtype">void</span></div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;LSRInstance::InsertInitialFormula(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *S, LSRUse &amp;LU, <span class="keywordtype">size_t</span> LUIdx) {</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;  <span class="comment">// Mark uses whose expressions cannot be expanded.</span></div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#aed54a8c39c1f5f066957f1297bd6bd0b">isSafeToExpand</a>(S, SE))</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    LU.RigidFormula = <span class="keyword">true</span>;</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;  Formula <a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>;</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;  F.InitialMatch(S, L, SE);</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;  <span class="keywordtype">bool</span> Inserted = InsertFormula(LU, LUIdx, F);</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;  assert(Inserted &amp;&amp; <span class="stringliteral">&quot;Initial formula already exists!&quot;</span>); (void)Inserted;</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;}</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;<span class="comment">/// InsertSupplementalFormula - Insert a simple single-register formula for</span></div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;<span class="comment">/// the given expression into the given use.</span></div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;<span class="comment"></span><span class="keywordtype">void</span></div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;LSRInstance::InsertSupplementalFormula(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *S,</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;                                       LSRUse &amp;LU, <span class="keywordtype">size_t</span> LUIdx) {</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;  Formula <a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>;</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;  F.BaseRegs.push_back(S);</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;  F.HasBaseReg = <span class="keyword">true</span>;</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;  <span class="keywordtype">bool</span> Inserted = InsertFormula(LU, LUIdx, F);</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;  assert(Inserted &amp;&amp; <span class="stringliteral">&quot;Supplemental formula already exists!&quot;</span>); (void)Inserted;</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;}</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;<span class="comment">/// CountRegisters - Note which registers are used by the given formula,</span></div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;<span class="comment">/// updating RegUses.</span></div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::CountRegisters(<span class="keyword">const</span> Formula &amp;F, <span class="keywordtype">size_t</span> LUIdx) {</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;  <span class="keywordflow">if</span> (F.ScaledReg)</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;    RegUses.CountRegister(F.ScaledReg, LUIdx);</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a> I = F.BaseRegs.begin(),</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;       E = F.BaseRegs.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;    RegUses.CountRegister(*I, LUIdx);</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;}</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;<span class="comment">/// InsertFormula - If the given formula has not yet been inserted, add it to</span></div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;<span class="comment">/// the list, and return true. Return false otherwise.</span></div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> LSRInstance::InsertFormula(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx, <span class="keyword">const</span> Formula &amp;F) {</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;  <span class="keywordflow">if</span> (!LU.InsertFormula(F))</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;  CountRegisters(F, LUIdx);</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;}</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;<span class="comment">/// CollectLoopInvariantFixupsAndFormulae - Check for other uses of</span></div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;<span class="comment">/// loop-invariant values which we&#39;re tracking. These other uses will pin these</span></div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;<span class="comment">/// values in registers, making them less profitable for elimination.</span></div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;<span class="comment">/// TODO: This currently misses non-constant addrec step registers.</span></div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;<span class="comment">/// TODO: Should this give more weight to users inside the loop?</span></div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;<span class="comment"></span><span class="keywordtype">void</span></div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;LSRInstance::CollectLoopInvariantFixupsAndFormulae() {</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 8&gt;</a> Worklist(RegUses.begin(), RegUses.end());</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 8&gt;</a> Inserted;</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;  <span class="keywordflow">while</span> (!Worklist.empty()) {</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *S = Worklist.pop_back_val();</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVNAryExpr.html">SCEVNAryExpr</a> *<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = dyn_cast&lt;SCEVNAryExpr&gt;(S))</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;      Worklist.append(<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;op_begin(), <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;op_end());</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVCastExpr.html">SCEVCastExpr</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;SCEVCastExpr&gt;(S))</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;      Worklist.push_back(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getOperand());</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVUDivExpr.html">SCEVUDivExpr</a> *D = dyn_cast&lt;SCEVUDivExpr&gt;(S)) {</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;      Worklist.push_back(D-&gt;getLHS());</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;      Worklist.push_back(D-&gt;getRHS());</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVUnknown.html">SCEVUnknown</a> *U = dyn_cast&lt;SCEVUnknown&gt;(S)) {</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;      <span class="keywordflow">if</span> (!Inserted.<a class="code" href="classllvm_1_1SmallVectorImpl.html#af622128e353515efebccad40eae495cb">insert</a>(U)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *V = U-&gt;getValue();</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = dyn_cast&lt;Instruction&gt;(V)) {</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;        <span class="comment">// Look for instructions defined outside the loop.</span></div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;        <span class="keywordflow">if</span> (L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a92a38e2e3412bde7fd2b71db212b61aa">contains</a>(Inst)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(V))</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;        <span class="comment">// Undef doesn&#39;t have a live range, so it doesn&#39;t matter.</span></div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::const_use_iterator</a> UI = V-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), UE = V-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;           UI != UE; ++UI) {</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;        <span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserInst = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(*UI);</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;        <span class="comment">// Ignore non-instructions.</span></div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;        <span class="keywordflow">if</span> (!UserInst)</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;        <span class="comment">// Ignore instructions in other functions (as can happen with</span></div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;        <span class="comment">// Constants).</span></div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;        <span class="keywordflow">if</span> (UserInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>() != L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>())</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;        <span class="comment">// Ignore instructions not dominated by the loop.</span></div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;        <span class="keyword">const</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *UseBB = !isa&lt;PHINode&gt;(UserInst) ?</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;          UserInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>() :</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;          cast&lt;PHINode&gt;(UserInst)-&gt;getIncomingBlock(</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;            <a class="code" href="classllvm_1_1PHINode.html#aca414c43a6d42c13998208463637a20d">PHINode::getIncomingValueNumForOperand</a>(UI.getOperandNo()));</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;        <span class="keywordflow">if</span> (!DT.<a class="code" href="classllvm_1_1DominatorTree.html#a6fe9272dc67fe2ff4cafc33b895c4a6c">dominates</a>(L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>(), UseBB))</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;        <span class="comment">// Ignore uses which are part of other SCEV expressions, to avoid</span></div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;        <span class="comment">// analyzing them multiple times.</span></div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;        <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ae9623974341419bfd1d185cfdc65bedd">isSCEVable</a>(UserInst-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())) {</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;          <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *UserS = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(const_cast&lt;Instruction *&gt;(UserInst));</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;          <span class="comment">// If the user is a no-op, look through to its uses.</span></div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;          <span class="keywordflow">if</span> (!isa&lt;SCEVUnknown&gt;(UserS))</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;          <span class="keywordflow">if</span> (UserS == U) {</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;            Worklist.push_back(</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;              SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad8e4f5b2ced08ad7d138b598aefdd338">getUnknown</a>(const_cast&lt;Instruction *&gt;(UserInst)));</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;          }</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;        }</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;        <span class="comment">// Ignore icmp instructions which are already being analyzed.</span></div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI = dyn_cast&lt;ICmpInst&gt;(UserInst)) {</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;          <span class="keywordtype">unsigned</span> OtherIdx = !UI.getOperandNo();</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *OtherOp = <span class="keyword">const_cast&lt;</span><a class="code" href="classllvm_1_1Value.html">Value</a> *<span class="keyword">&gt;</span>(ICI-&gt;getOperand(OtherIdx));</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;          <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ac258f0361a1c35f5814a2b529139d15c">hasComputableLoopEvolution</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(OtherOp), L))</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;        }</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;        LSRFixup &amp;LF = getNewFixup();</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;        LF.UserInst = <span class="keyword">const_cast&lt;</span><a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<span class="keyword">&gt;</span>(UserInst);</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;        LF.OperandValToReplace = UI.getUse();</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;        std::pair&lt;size_t, int64_t&gt; <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = getUse(S, LSRUse::Basic, 0);</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;        LF.LUIdx = P.first;</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;        LF.Offset = P.second;</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;        LSRUse &amp;LU = Uses[LF.LUIdx];</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;        LU.AllFixupsOutsideLoop &amp;= LF.isUseFullyOutsideLoop(L);</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;        <span class="keywordflow">if</span> (!LU.WidestFixupType ||</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;            SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(LU.WidestFixupType) &lt;</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;            SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(LF.OperandValToReplace-&gt;getType()))</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;          LU.WidestFixupType = LF.OperandValToReplace-&gt;getType();</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;        InsertSupplementalFormula(U, LU, LF.LUIdx);</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;        CountRegisters(LU.Formulae.back(), Uses.size() - 1);</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;      }</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;    }</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;  }</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;}</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;<span class="comment">/// CollectSubexprs - Split S into subexpressions which can be pulled out into</span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;<span class="comment">/// separate registers. If C is non-null, multiply each subexpression by C.</span></div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;<span class="comment">/// Return remainder expression after factoring the subexpressions captured by</span></div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;<span class="comment">/// Ops. If Ops is complete, return NULL.</span></div><div class="line"><a name="l03134"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a838a90156743fcfe8bfce75f554aba21"> 3134</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="LoopStrengthReduce_8cpp.html#a838a90156743fcfe8bfce75f554aba21">CollectSubexprs</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *S, <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>,</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;                                   <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;</a> &amp;Ops,</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1Loop.html">Loop</a> *L,</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;                                   <a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a> &amp;SE,</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;                                   <span class="keywordtype">unsigned</span> Depth = 0) {</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;  <span class="comment">// Arbitrarily cap recursion to protect compile time.</span></div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;  <span class="keywordflow">if</span> (Depth &gt;= 3)</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>;</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddExpr.html">SCEVAddExpr</a> *Add = dyn_cast&lt;SCEVAddExpr&gt;(S)) {</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;    <span class="comment">// Break out add operands.</span></div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SCEVNAryExpr.html#a82ad83d40ce0e57efef84b421c7f805a">SCEVAddExpr::op_iterator</a> I = Add-&gt;op_begin(), E = Add-&gt;op_end();</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;         I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Remainder = <a class="code" href="LoopStrengthReduce_8cpp.html#a838a90156743fcfe8bfce75f554aba21">CollectSubexprs</a>(*I, C, Ops, L, SE, Depth+1);</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;      <span class="keywordflow">if</span> (Remainder)</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;        Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(C ? SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad5829d76e14852080c205f8b94d830f1">getMulExpr</a>(C, Remainder) : Remainder);</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;    }</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddRecExpr.html">SCEVAddRecExpr</a> *AR = dyn_cast&lt;SCEVAddRecExpr&gt;(S)) {</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;    <span class="comment">// Split a non-zero base out of an addrec.</span></div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;    <span class="keywordflow">if</span> (AR-&gt;getStart()-&gt;isZero())</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;      <span class="keywordflow">return</span> S;</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Remainder = <a class="code" href="LoopStrengthReduce_8cpp.html#a838a90156743fcfe8bfce75f554aba21">CollectSubexprs</a>(AR-&gt;getStart(),</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;                                            <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>, Ops, L, SE, Depth+1);</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    <span class="comment">// Split the non-zero AddRec unless it is part of a nested recurrence that</span></div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;    <span class="comment">// does not pertain to this loop.</span></div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;    <span class="keywordflow">if</span> (Remainder &amp;&amp; (AR-&gt;getLoop() == L || !isa&lt;SCEVAddRecExpr&gt;(Remainder))) {</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;      Ops.push_back(C ? SE.getMulExpr(C, Remainder) : Remainder);</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;      Remainder = 0;</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;    }</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;    <span class="keywordflow">if</span> (Remainder != AR-&gt;getStart()) {</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;      <span class="keywordflow">if</span> (!Remainder)</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;        Remainder = SE.getConstant(AR-&gt;getType(), 0);</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;      <span class="keywordflow">return</span> SE.getAddRecExpr(Remainder,</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;                              AR-&gt;getStepRecurrence(SE),</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;                              AR-&gt;getLoop(),</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;                              <span class="comment">//FIXME: AR-&gt;getNoWrapFlags(SCEV::FlagNW)</span></div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;                              <a class="code" href="classllvm_1_1SCEV.html#af43000d4dcb7d6d63cb6e36933ed3f6fa23e74052c4d79cfdaa23460a3c946656">SCEV::FlagAnyWrap</a>);</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;    }</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVMulExpr.html">SCEVMulExpr</a> *Mul = dyn_cast&lt;SCEVMulExpr&gt;(S)) {</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;    <span class="comment">// Break (C * (a + b + c)) into C*a + C*b + C*c.</span></div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;    <span class="keywordflow">if</span> (Mul-&gt;getNumOperands() != 2)</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;      <span class="keywordflow">return</span> S;</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a> *Op0 =</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;        dyn_cast&lt;SCEVConstant&gt;(Mul-&gt;getOperand(0))) {</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;      C = C ? cast&lt;SCEVConstant&gt;(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad5829d76e14852080c205f8b94d830f1">getMulExpr</a>(C, Op0)) : Op0;</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Remainder =</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;        <a class="code" href="LoopStrengthReduce_8cpp.html#a838a90156743fcfe8bfce75f554aba21">CollectSubexprs</a>(Mul-&gt;getOperand(1), <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>, Ops, L, SE, Depth+1);</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;      <span class="keywordflow">if</span> (Remainder)</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;        Ops.push_back(SE.getMulExpr(C, Remainder));</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;    }</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;  }</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>;</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;}</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;<span class="comment">/// GenerateReassociations - Split out subexpressions from adds and the bases of</span></div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;<span class="comment">/// addrecs.</span></div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::GenerateReassociations(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx,</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;                                         Formula Base,</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;                                         <span class="keywordtype">unsigned</span> Depth) {</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;  <span class="comment">// Arbitrarily cap recursion to protect compile time.</span></div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;  <span class="keywordflow">if</span> (Depth &gt;= 3) <span class="keywordflow">return</span>;</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, e = Base.BaseRegs.size(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *BaseReg = Base.BaseRegs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 8&gt;</a> AddOps;</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Remainder = <a class="code" href="LoopStrengthReduce_8cpp.html#a838a90156743fcfe8bfce75f554aba21">CollectSubexprs</a>(BaseReg, 0, AddOps, L, SE);</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;    <span class="keywordflow">if</span> (Remainder)</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;      AddOps.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Remainder);</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;    <span class="keywordflow">if</span> (AddOps.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 1) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a> J = AddOps.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;         JE = AddOps.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); J != JE; ++J) {</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;      <span class="comment">// Loop-variant &quot;unknown&quot; values are uninteresting; we won&#39;t be able to</span></div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;      <span class="comment">// do anything meaningful with them.</span></div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;      <span class="keywordflow">if</span> (isa&lt;SCEVUnknown&gt;(*J) &amp;&amp; !SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a5a19768af81df7e5fe571bc08dcd48b3">isLoopInvariant</a>(*J, L))</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;      <span class="comment">// Don&#39;t pull a constant into a register if the constant could be folded</span></div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;      <span class="comment">// into an immediate field.</span></div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="LoopStrengthReduce_8cpp.html#a6cfac60f7a8d39786699d498a07ad8f9">isAlwaysFoldable</a>(TTI, SE, LU.MinOffset, LU.MaxOffset, LU.Kind,</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;                           LU.AccessTy, *J, Base.getNumRegs() &gt; 1))</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;      <span class="comment">// Collect all operands except *J.</span></div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 8&gt;</a> InnerAddOps</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;        (((<span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 8&gt;</a> &amp;)AddOps).<a class="code" href="namespacellvm_1_1sys_1_1path.html#a33706aab89e700b8f79e1fa6f4f0e3ee">begin</a>(), J);</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;      InnerAddOps.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a669d55980a7d4b6307b94596deeb0b1f">append</a></div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;        (<a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(J), ((<span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 8&gt;</a> &amp;)AddOps).<a class="code" href="namespacellvm_1_1sys_1_1path.html#a214ec2f04ffd92636ed4bd2717607a1d">end</a>());</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;      <span class="comment">// Don&#39;t leave just a constant behind in a register if the constant could</span></div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;      <span class="comment">// be folded into an immediate field.</span></div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;      <span class="keywordflow">if</span> (InnerAddOps.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 1 &amp;&amp;</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;          <a class="code" href="LoopStrengthReduce_8cpp.html#a6cfac60f7a8d39786699d498a07ad8f9">isAlwaysFoldable</a>(TTI, SE, LU.MinOffset, LU.MaxOffset, LU.Kind,</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;                           LU.AccessTy, InnerAddOps[0], Base.getNumRegs() &gt; 1))</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *InnerSum = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(InnerAddOps);</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;      <span class="keywordflow">if</span> (InnerSum-&gt;<a class="code" href="classllvm_1_1SCEV.html#a3f76d2fd4788225548dc36ef9e417030">isZero</a>())</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;      Formula F = Base;</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;      <span class="comment">// Add the remaining pieces of the add back into the new formula.</span></div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a> *InnerSumSC = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a>&gt;(InnerSum);</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;      <span class="keywordflow">if</span> (InnerSumSC &amp;&amp;</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;          SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(InnerSumSC-&gt;<a class="code" href="classllvm_1_1SCEVConstant.html#a11dea30ae8b3c0ce2d398696b4af3373">getType</a>()) &lt;= 64 &amp;&amp;</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;          TTI.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a27c39fe900d03167d7e519f8d6cb94e2">isLegalAddImmediate</a>((uint64_t)F.UnfoldedOffset +</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;                                  InnerSumSC-&gt;<a class="code" href="classllvm_1_1SCEVConstant.html#a64f0133adf37f9513005465580a19a66">getValue</a>()-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>())) {</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;        F.UnfoldedOffset = (uint64_t)F.UnfoldedOffset +</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;                           InnerSumSC-&gt;<a class="code" href="classllvm_1_1SCEVConstant.html#a64f0133adf37f9513005465580a19a66">getValue</a>()-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>();</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;        F.BaseRegs.erase(F.BaseRegs.begin() + <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;      } <span class="keywordflow">else</span></div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;        F.BaseRegs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = InnerSum;</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;      <span class="comment">// Add J as its own register, or an unfolded immediate.</span></div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a> *<a class="code" href="namespacellvm_1_1PPCISD.html#a69ad64696d1df3be05f01dfb67f5bc66a2ae057e4de45c51c89b7e5dc5053df62">SC</a> = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a>&gt;(*J);</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;      <span class="keywordflow">if</span> (SC &amp;&amp; SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(SC-&gt;<a class="code" href="classllvm_1_1SCEVConstant.html#a11dea30ae8b3c0ce2d398696b4af3373">getType</a>()) &lt;= 64 &amp;&amp;</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;          TTI.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a27c39fe900d03167d7e519f8d6cb94e2">isLegalAddImmediate</a>((uint64_t)F.UnfoldedOffset +</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;                                  SC-&gt;<a class="code" href="classllvm_1_1SCEVConstant.html#a64f0133adf37f9513005465580a19a66">getValue</a>()-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>()))</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;        F.UnfoldedOffset = (uint64_t)F.UnfoldedOffset +</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;                           SC-&gt;<a class="code" href="classllvm_1_1SCEVConstant.html#a64f0133adf37f9513005465580a19a66">getValue</a>()-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>();</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;        F.BaseRegs.push_back(*J);</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;      <span class="keywordflow">if</span> (InsertFormula(LU, LUIdx, F))</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;        <span class="comment">// If that formula hadn&#39;t been seen before, recurse to find more like</span></div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;        <span class="comment">// it.</span></div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;        GenerateReassociations(LU, LUIdx, LU.Formulae.back(), Depth+1);</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;    }</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;  }</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;}</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;<span class="comment">/// GenerateCombinations - Generate a formula consisting of all of the</span></div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;<span class="comment">/// loop-dominating registers added into a single register.</span></div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::GenerateCombinations(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx,</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;                                       Formula Base) {</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;  <span class="comment">// This method is only interesting on a plurality of registers.</span></div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;  <span class="keywordflow">if</span> (Base.BaseRegs.size() &lt;= 1) <span class="keywordflow">return</span>;</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;  Formula F = Base;</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;  F.BaseRegs.clear();</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> Ops;</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a></div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;       I = Base.BaseRegs.begin(), E = Base.BaseRegs.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *BaseReg = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;    <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ae0d036af111b8aafe90db0771b8e9ce3">properlyDominates</a>(BaseReg, L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>()) &amp;&amp;</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;        !SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ac258f0361a1c35f5814a2b529139d15c">hasComputableLoopEvolution</a>(BaseReg, L))</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;      Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(BaseReg);</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;      F.BaseRegs.push_back(BaseReg);</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;  }</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;  <span class="keywordflow">if</span> (Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() &gt; 1) {</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="Target_2X86_2README_8txt.html#a0ed5c5d6ff68f354e354920a3680185c">Sum</a> = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(Ops);</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;    <span class="comment">// TODO: If Sum is zero, it probably means ScalarEvolution missed an</span></div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;    <span class="comment">// opportunity to fold something. For now, just ignore such cases</span></div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;    <span class="comment">// rather than proceed with zero in a register.</span></div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;    <span class="keywordflow">if</span> (!Sum-&gt;<a class="code" href="classllvm_1_1SCEV.html#a3f76d2fd4788225548dc36ef9e417030">isZero</a>()) {</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;      F.BaseRegs.push_back(Sum);</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;      (void)InsertFormula(LU, LUIdx, F);</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;    }</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;  }</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;}</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;<span class="comment">/// GenerateSymbolicOffsets - Generate reuse formulae using symbolic offsets.</span></div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::GenerateSymbolicOffsets(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx,</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;                                          Formula Base) {</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;  <span class="comment">// We can&#39;t add a symbolic offset if the address already contains one.</span></div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;  <span class="keywordflow">if</span> (Base.BaseGV) <span class="keywordflow">return</span>;</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, e = Base.BaseRegs.size(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="MD5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a> = Base.BaseRegs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;    <a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *GV = <a class="code" href="LoopStrengthReduce_8cpp.html#a88366d91f44b9aa74c0408339b23b509">ExtractSymbol</a>(G, SE);</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;    <span class="keywordflow">if</span> (G-&gt;<a class="code" href="classllvm_1_1SCEV.html#a3f76d2fd4788225548dc36ef9e417030">isZero</a>() || !GV)</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;    Formula F = Base;</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;    F.BaseGV = GV;</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, LU.MinOffset, LU.MaxOffset, LU.Kind, LU.AccessTy, F))</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;    F.BaseRegs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="MD5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>;</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;    (void)InsertFormula(LU, LUIdx, F);</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;  }</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;}</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;<span class="comment">/// GenerateConstantOffsets - Generate reuse formulae using symbolic offsets.</span></div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::GenerateConstantOffsets(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx,</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;                                          Formula Base) {</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;  <span class="comment">// TODO: For now, just add the min and max offset, because it usually isn&#39;t</span></div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;  <span class="comment">// worthwhile looking at everything inbetween.</span></div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;int64_t, 2&gt;</a> Worklist;</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;  Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(LU.MinOffset);</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;  <span class="keywordflow">if</span> (LU.MaxOffset != LU.MinOffset)</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;    Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(LU.MaxOffset);</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, e = Base.BaseRegs.size(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *<a class="code" href="MD5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a> = Base.BaseRegs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int64_t&gt;::const_iterator</a> I = Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;         E = Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;      Formula F = Base;</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;      F.BaseOffset = (uint64_t)Base.BaseOffset - *I;</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;      <a class="code" href="LLParser_8cpp.html#aae58e3df0180401e8f3ab75c18fbc07a">if</a> (<a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, LU.MinOffset - *I, LU.MaxOffset - *I, LU.Kind,</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;                     LU.AccessTy, F)) {</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;        <span class="comment">// Add the offset to the base register.</span></div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;        <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *NewG = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(G-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>(), *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>), G);</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;        <span class="comment">// If it cancelled out, drop the base register, otherwise update it.</span></div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;        <span class="keywordflow">if</span> (NewG-&gt;<a class="code" href="classllvm_1_1SCEV.html#a3f76d2fd4788225548dc36ef9e417030">isZero</a>()) {</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;          <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(F.BaseRegs[i], F.BaseRegs.back());</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;          F.BaseRegs.pop_back();</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;        } <span class="keywordflow">else</span></div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;          F.BaseRegs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = NewG;</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;        (void)InsertFormula(LU, LUIdx, F);</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;      }</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;    }</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;    int64_t Imm = <a class="code" href="LoopStrengthReduce_8cpp.html#ac2da0a3b05aba66c95b7f0b91b5c7c55">ExtractImmediate</a>(G, SE);</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;    <span class="keywordflow">if</span> (G-&gt;<a class="code" href="classllvm_1_1SCEV.html#a3f76d2fd4788225548dc36ef9e417030">isZero</a>() || Imm == 0)</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;    Formula F = Base;</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;    F.BaseOffset = (uint64_t)F.BaseOffset + Imm;</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;    <a class="code" href="LLParser_8cpp.html#aae58e3df0180401e8f3ab75c18fbc07a">if</a> (!<a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, LU.MinOffset, LU.MaxOffset, LU.Kind, LU.AccessTy, F))</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;    F.BaseRegs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="MD5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a>;</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;    (void)InsertFormula(LU, LUIdx, F);</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;  }</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;}</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;<span class="comment">/// GenerateICmpZeroScales - For ICmpZero, check to see if we can scale up</span></div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;<span class="comment">/// the comparison. For example, x == y -&gt; x*c == y*c.</span></div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::GenerateICmpZeroScales(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx,</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;                                         Formula Base) {</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;  <span class="keywordflow">if</span> (LU.Kind != LSRUse::ICmpZero) <span class="keywordflow">return</span>;</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;  <span class="comment">// Determine the integer type for the base formula.</span></div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *IntTy = Base.getType();</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;  <span class="keywordflow">if</span> (!IntTy) <span class="keywordflow">return</span>;</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;  <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(IntTy) &gt; 64) <span class="keywordflow">return</span>;</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;  <span class="comment">// Don&#39;t do this if there is more than one offset.</span></div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;  <span class="keywordflow">if</span> (LU.MinOffset != LU.MaxOffset) <span class="keywordflow">return</span>;</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;  assert(!Base.BaseGV &amp;&amp; <span class="stringliteral">&quot;ICmpZero use is not legal!&quot;</span>);</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;  <span class="comment">// Check each interesting stride.</span></div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;int64_t, 8&gt;::const_iterator</a></div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;       I = Factors.<a class="code" href="classllvm_1_1SetVector.html#adb13793b98ab59209a5309d26f831850">begin</a>(), E = Factors.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;    int64_t Factor = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;    <span class="comment">// Check that the multiplication doesn&#39;t overflow.</span></div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;    <span class="keywordflow">if</span> (Base.BaseOffset == INT64_MIN &amp;&amp; Factor == -1)</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;    int64_t NewBaseOffset = (uint64_t)Base.BaseOffset * Factor;</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;    <a class="code" href="LLParser_8cpp.html#aae58e3df0180401e8f3ab75c18fbc07a">if</a> (NewBaseOffset / Factor != Base.BaseOffset)</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;    <span class="comment">// Check that multiplying with the use offset doesn&#39;t overflow.</span></div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;    int64_t Offset = LU.MinOffset;</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;    <span class="keywordflow">if</span> (Offset == INT64_MIN &amp;&amp; Factor == -1)</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;    Offset = (uint64_t)Offset * Factor;</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;    <span class="keywordflow">if</span> (Offset / Factor != LU.MinOffset)</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;    Formula F = Base;</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;    F.BaseOffset = NewBaseOffset;</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;    <span class="comment">// Check that this scale is legal.</span></div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, Offset, Offset, LU.Kind, LU.AccessTy, F))</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;    <span class="comment">// Compensate for the use having MinOffset built into it.</span></div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;    F.BaseOffset = (uint64_t)F.BaseOffset + Offset - LU.MinOffset;</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *FactorS = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(IntTy, Factor);</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;    <span class="comment">// Check that multiplying with each base register doesn&#39;t overflow.</span></div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, e = F.BaseRegs.size(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;      F.BaseRegs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad5829d76e14852080c205f8b94d830f1">getMulExpr</a>(F.BaseRegs[i], FactorS);</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="LoopStrengthReduce_8cpp.html#a1fc3b7fba8416494790a73f61248b553">getExactSDiv</a>(F.BaseRegs[i], FactorS, SE) != Base.BaseRegs[i])</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;        <span class="keywordflow">goto</span> <a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">next</a>;</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;    }</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;    <span class="comment">// Check that multiplying with the scaled register doesn&#39;t overflow.</span></div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;    <span class="keywordflow">if</span> (F.ScaledReg) {</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;      F.ScaledReg = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad5829d76e14852080c205f8b94d830f1">getMulExpr</a>(F.ScaledReg, FactorS);</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="LoopStrengthReduce_8cpp.html#a1fc3b7fba8416494790a73f61248b553">getExactSDiv</a>(F.ScaledReg, FactorS, SE) != Base.ScaledReg)</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;    }</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;    <span class="comment">// Check that multiplying with the unfolded offset doesn&#39;t overflow.</span></div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;    <span class="keywordflow">if</span> (F.UnfoldedOffset != 0) {</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;      <span class="keywordflow">if</span> (F.UnfoldedOffset == INT64_MIN &amp;&amp; Factor == -1)</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;      F.UnfoldedOffset = (uint64_t)F.UnfoldedOffset * Factor;</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;      <a class="code" href="LLParser_8cpp.html#aae58e3df0180401e8f3ab75c18fbc07a">if</a> (F.UnfoldedOffset / Factor != Base.UnfoldedOffset)</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;    }</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;    <span class="comment">// If we make it here and it&#39;s legal, add it.</span></div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;    (void)InsertFormula(LU, LUIdx, F);</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;  <a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">next</a>:;</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;  }</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;}</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;<span class="comment">/// GenerateScales - Generate stride factor reuse formulae by making use of</span></div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;<span class="comment">/// scaled-offset address modes, for example.</span></div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::GenerateScales(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx, Formula Base) {</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;  <span class="comment">// Determine the integer type for the base formula.</span></div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *IntTy = Base.getType();</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;  <span class="keywordflow">if</span> (!IntTy) <span class="keywordflow">return</span>;</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;  <span class="comment">// If this Formula already has a scaled register, we can&#39;t add another one.</span></div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;  <span class="keywordflow">if</span> (Base.Scale != 0) <span class="keywordflow">return</span>;</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;  <span class="comment">// Check each interesting stride.</span></div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;int64_t, 8&gt;::const_iterator</a></div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;       I = Factors.<a class="code" href="classllvm_1_1SetVector.html#adb13793b98ab59209a5309d26f831850">begin</a>(), E = Factors.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;    int64_t Factor = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;    Base.Scale = Factor;</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;    Base.HasBaseReg = Base.BaseRegs.size() &gt; 1;</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;    <span class="comment">// Check whether this scale is going to be legal.</span></div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, LU.MinOffset, LU.MaxOffset, LU.Kind, LU.AccessTy,</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;                    Base)) {</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;      <span class="comment">// As a special-case, handle special out-of-loop Basic users specially.</span></div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;      <span class="comment">// TODO: Reconsider this special case.</span></div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;      <span class="keywordflow">if</span> (LU.Kind == LSRUse::Basic &amp;&amp;</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;          <a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, LU.MinOffset, LU.MaxOffset, LSRUse::Special,</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;                     LU.AccessTy, Base) &amp;&amp;</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;          LU.AllFixupsOutsideLoop)</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;        LU.Kind = LSRUse::Special;</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;    }</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;    <span class="comment">// For an ICmpZero, negating a solitary base register won&#39;t lead to</span></div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;    <span class="comment">// new solutions.</span></div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;    <span class="keywordflow">if</span> (LU.Kind == LSRUse::ICmpZero &amp;&amp;</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;        !Base.HasBaseReg &amp;&amp; Base.BaseOffset == 0 &amp;&amp; !Base.BaseGV)</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;    <span class="comment">// For each addrec base reg, apply the scale, if possible.</span></div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, e = Base.BaseRegs.size(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVAddRecExpr.html">SCEVAddRecExpr</a> *AR =</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;            dyn_cast&lt;SCEVAddRecExpr&gt;(Base.BaseRegs[i])) {</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;        <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *FactorS = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(IntTy, Factor);</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;        <span class="keywordflow">if</span> (FactorS-&gt;<a class="code" href="classllvm_1_1SCEV.html#a3f76d2fd4788225548dc36ef9e417030">isZero</a>())</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;        <span class="comment">// Divide out the factor, ignoring high bits, since we&#39;ll be</span></div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;        <span class="comment">// scaling the value back up in the end.</span></div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Quotient = <a class="code" href="LoopStrengthReduce_8cpp.html#a1fc3b7fba8416494790a73f61248b553">getExactSDiv</a>(AR, FactorS, SE, <span class="keyword">true</span>)) {</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;          <span class="comment">// TODO: This could be optimized to avoid all the copying.</span></div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;          Formula F = Base;</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;          F.ScaledReg = Quotient;</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;          F.DeleteBaseReg(F.BaseRegs[i]);</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;          (void)InsertFormula(LU, LUIdx, F);</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;        }</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;      }</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;  }</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;}</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;<span class="comment">/// GenerateTruncates - Generate reuse formulae from different IV types.</span></div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::GenerateTruncates(LSRUse &amp;LU, <span class="keywordtype">unsigned</span> LUIdx, Formula Base) {</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;  <span class="comment">// Don&#39;t bother truncating symbolic values.</span></div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;  <span class="keywordflow">if</span> (Base.BaseGV) <span class="keywordflow">return</span>;</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;  <span class="comment">// Determine the integer type for the base formula.</span></div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *DstTy = Base.getType();</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;  <span class="keywordflow">if</span> (!DstTy) <span class="keywordflow">return</span>;</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;  DstTy = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#abb976145b00ae108c1d6b98c4f099d27">getEffectiveSCEVType</a>(DstTy);</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;Type *, 4&gt;::const_iterator</a></div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;       I = Types.<a class="code" href="classllvm_1_1SetVector.html#adb13793b98ab59209a5309d26f831850">begin</a>(), E = Types.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *SrcTy = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;    <span class="keywordflow">if</span> (SrcTy != DstTy &amp;&amp; TTI.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a547c815fb7093e41196bc8dd0c4b9317">isTruncateFree</a>(SrcTy, DstTy)) {</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;      Formula F = Base;</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;      <span class="keywordflow">if</span> (F.ScaledReg) F.ScaledReg = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#aa35959e3f6bea8e35cffcfd8659e3156">getAnyExtendExpr</a>(F.ScaledReg, *I);</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classT.html">SmallVectorImpl&lt;const SCEV *&gt;::iterator</a> J = F.BaseRegs.begin(),</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;           JE = F.BaseRegs.end(); J != JE; ++J)</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;        *J = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#aa35959e3f6bea8e35cffcfd8659e3156">getAnyExtendExpr</a>(*J, SrcTy);</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;      <span class="comment">// TODO: This assumes we&#39;ve done basic processing on all uses and</span></div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;      <span class="comment">// have an idea what the register usage is.</span></div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;      <span class="keywordflow">if</span> (!F.hasRegsUsedByUsesOtherThan(LUIdx, RegUses))</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;      (void)InsertFormula(LU, LUIdx, F);</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;    }</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;  }</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;}</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;<span class="comment">/// WorkItem - Helper class for GenerateCrossUseConstantOffsets. It&#39;s used to</span></div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;<span class="comment">/// defer modifications so that the search phase doesn&#39;t have to worry about</span></div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;<span class="comment">/// the data structures moving underneath it.</span></div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;<span class="comment"></span><span class="keyword">struct </span>WorkItem {</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;  <span class="keywordtype">size_t</span> LUIdx;</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;  int64_t Imm;</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *OrigReg;</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;  WorkItem(<span class="keywordtype">size_t</span> LI, int64_t I, <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *R)</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;    : LUIdx(LI), Imm(I), OrigReg(R) {}</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;  <span class="keywordtype">void</span> print(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS) <span class="keyword">const</span>;</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>() <span class="keyword">const</span>;</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;};</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;}</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;<span class="keywordtype">void</span> WorkItem::print(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS)<span class="keyword"> const </span>{</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;  OS &lt;&lt; <span class="stringliteral">&quot;in formulae referencing &quot;</span> &lt;&lt; *OrigReg &lt;&lt; <span class="stringliteral">&quot; in use &quot;</span> &lt;&lt; LUIdx</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; , add offset &quot;</span> &lt;&lt; Imm;</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;}</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;<span class="preprocessor">#if !defined(NDEBUG) || defined(LLVM_ENABLE_DUMP)</span></div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">WorkItem::dump</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;  print(<a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>()); <a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;}</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;<span class="comment">/// GenerateCrossUseConstantOffsets - Look for registers which are a constant</span></div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;<span class="comment">/// distance apart and try to form reuse opportunities between them.</span></div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::GenerateCrossUseConstantOffsets() {</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;  <span class="comment">// Group the registers by their value without any added constant offset.</span></div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;  <span class="keyword">typedef</span> std::map&lt;int64_t, const SCEV *&gt; ImmMapTy;</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const SCEV *, ImmMapTy&gt;</a> RegMapTy;</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;  RegMapTy Map;</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const SCEV *, SmallBitVector&gt;</a> UsedByIndicesMap;</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 8&gt;</a> <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a>;</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;  <span class="keywordflow">for</span> (RegUseTracker::const_iterator I = RegUses.begin(), E = RegUses.end();</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;       I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Reg = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;    int64_t Imm = <a class="code" href="LoopStrengthReduce_8cpp.html#ac2da0a3b05aba66c95b7f0b91b5c7c55">ExtractImmediate</a>(Reg, SE);</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;    std::pair&lt;RegMapTy::iterator, bool&gt; Pair =</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;      Map.insert(std::make_pair(Reg, ImmMapTy()));</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;    <span class="keywordflow">if</span> (Pair.second)</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;      Sequence.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Reg);</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;    Pair.first-&gt;second.insert(std::make_pair(Imm, *I));</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;    UsedByIndicesMap[<a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a>] |= RegUses.getUsedByIndices(*I);</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;  }</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;  <span class="comment">// Now examine each set of registers with the same base value. Build up</span></div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;  <span class="comment">// a list of work to do and do the work in a separate step so that we&#39;re</span></div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;  <span class="comment">// not adding formulae and register counts while we&#39;re searching.</span></div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;WorkItem, 32&gt;</a> WorkItems;</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;  <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;std::pair&lt;size_t, int64_t&gt;</a>, 32&gt; UniqueItems;</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a> I = Sequence.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;       E = Sequence.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Reg = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;    <span class="keyword">const</span> ImmMapTy &amp;Imms = Map.find(Reg)-&gt;second;</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;    <span class="comment">// It&#39;s not worthwhile looking for reuse if there&#39;s only one offset.</span></div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;    <span class="keywordflow">if</span> (Imms.size() == 1)</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Generating cross-use offsets for &quot;</span> &lt;&lt; *Reg &lt;&lt; <span class="charliteral">&#39;:&#39;</span>;</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;          <span class="keywordflow">for</span> (ImmMapTy::const_iterator J = Imms.begin(), JE = Imms.end();</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;               J != JE; ++J)</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;            <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; J-&gt;first;</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;          <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;</div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;    <span class="comment">// Examine each offset.</span></div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;    <span class="keywordflow">for</span> (ImmMapTy::const_iterator J = Imms.begin(), JE = Imms.end();</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;         J != JE; ++J) {</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *OrigReg = J-&gt;second;</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;      int64_t JImm = J-&gt;first;</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallBitVector.html">SmallBitVector</a> &amp;UsedByIndices = RegUses.getUsedByIndices(OrigReg);</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;SCEVConstant&gt;(OrigReg) &amp;&amp;</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;          UsedByIndicesMap[Reg].count() == 1) {</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Skipping cross-use reuse for &quot;</span> &lt;&lt; *OrigReg &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;      }</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;</div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;      <span class="comment">// Conservatively examine offsets between this orig reg a few selected</span></div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;      <span class="comment">// other orig regs.</span></div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;      ImmMapTy::const_iterator OtherImms[] = {</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;        Imms.begin(), <a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">prior</a>(Imms.end()),</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;        Imms.lower_bound((Imms.begin()-&gt;first + <a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">prior</a>(Imms.end())-&gt;first) / 2)</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;      };</div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, e = <a class="code" href="namespacellvm.html#a370ed0e0f2bb66d17cd13f84be54e867">array_lengthof</a>(OtherImms); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;        ImmMapTy::const_iterator <a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> = OtherImms[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;        <span class="keywordflow">if</span> (M == J || M == JE) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;        <span class="comment">// Compute the difference between the two.</span></div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;        int64_t Imm = (uint64_t)JImm - M-&gt;first;</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;        <a class="code" href="Target_2README_8txt.html#a7df6ed7588301267782c2bd4b7f6899d">for</a> (<span class="keywordtype">int</span> LUIdx = UsedByIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#a486e5364d2ad0d281f7627750f5f829a">find_first</a>(); LUIdx != -1;</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;             LUIdx = UsedByIndices.<a class="code" href="classllvm_1_1SmallBitVector.html#aec7155f96e634c2d65d82c5be3285a5f">find_next</a>(LUIdx))</div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;          <span class="comment">// Make a memo of this use, offset, and register tuple.</span></div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;          <span class="keywordflow">if</span> (UniqueItems.<a class="code" href="classllvm_1_1SmallSet.html#a8d8348060ccdeeba13fb8bc651dfbf82">insert</a>(std::make_pair(LUIdx, Imm)))</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;            WorkItems.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(WorkItem(LUIdx, Imm, OrigReg));</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;      }</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;    }</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;  }</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;  Map.clear();</div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;  Sequence.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;  UsedByIndicesMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a6467bd6bb128c8b69a478548fc17351c">clear</a>();</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;  UniqueItems.<a class="code" href="classllvm_1_1SmallSet.html#a76b3fc7c102561fb5210d5151531e409">clear</a>();</div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;  <span class="comment">// Now iterate through the worklist and add new formulae.</span></div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;WorkItem&gt;::const_iterator</a> I = WorkItems.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;       E = WorkItems.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;    <span class="keyword">const</span> WorkItem &amp;WI = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;    <span class="keywordtype">size_t</span> LUIdx = WI.LUIdx;</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;    LSRUse &amp;LU = Uses[LUIdx];</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;    int64_t Imm = WI.Imm;</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *OrigReg = WI.OrigReg;</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *IntTy = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#abb976145b00ae108c1d6b98c4f099d27">getEffectiveSCEVType</a>(OrigReg-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>());</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *NegImmS = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(<a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(IntTy, -(uint64_t)Imm));</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;    <span class="keywordtype">unsigned</span> BitWidth = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">getTypeSizeInBits</a>(IntTy);</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;    <span class="comment">// TODO: Use a more targeted data structure.</span></div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> L = 0, <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588">LE</a> = LU.Formulae.size(); L != <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588">LE</a>; ++L) {</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;      <span class="keyword">const</span> Formula &amp;F = LU.Formulae[L];</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;      <span class="comment">// Use the immediate in the scaled register.</span></div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;      <span class="keywordflow">if</span> (F.ScaledReg == OrigReg) {</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;        int64_t Offset = (uint64_t)F.BaseOffset + Imm * (uint64_t)F.Scale;</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;        <span class="comment">// Don&#39;t create 50 + reg(-50).</span></div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;        <span class="keywordflow">if</span> (F.referencesReg(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;                   <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(IntTy, -(uint64_t)Offset))))</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;        Formula NewF = <a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>;</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;        NewF.BaseOffset = Offset;</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, LU.MinOffset, LU.MaxOffset, LU.Kind, LU.AccessTy,</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;                        NewF))</div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;        NewF.ScaledReg = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(NegImmS, NewF.ScaledReg);</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;        <span class="comment">// If the new scale is a constant in a register, and adding the constant</span></div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;        <span class="comment">// value to the immediate would produce a value closer to zero than the</span></div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;        <span class="comment">// immediate itself, then the formula isn&#39;t worthwhile.</span></div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;SCEVConstant&gt;(NewF.ScaledReg))</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue()-&gt;isNegative() !=</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;                (NewF.BaseOffset &lt; 0) &amp;&amp;</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;              (<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue()-&gt;getValue().abs() * <a class="code" href="classllvm_1_1APInt.html">APInt</a>(BitWidth, F.Scale))</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;                .ule(<a class="code" href="namespacellvm.html#a59575e3191e743149bbd95eacbb9081a">abs64</a>(NewF.BaseOffset)))</div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;        <span class="comment">// OK, looks good.</span></div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;        (void)InsertFormula(LU, LUIdx, NewF);</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;        <span class="comment">// Use the immediate in a base register.</span></div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 0, <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a0555f297eceee28e5fc20d282dfeb8f4">NE</a> = F.BaseRegs.size(); <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> != <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a0555f297eceee28e5fc20d282dfeb8f4">NE</a>; ++<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>) {</div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;          <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *BaseReg = F.BaseRegs[<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>];</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;          <span class="keywordflow">if</span> (BaseReg != OrigReg)</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;          Formula NewF = <a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>;</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;          NewF.BaseOffset = (uint64_t)NewF.BaseOffset + Imm;</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;          <a class="code" href="LLParser_8cpp.html#aae58e3df0180401e8f3ab75c18fbc07a">if</a> (!<a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, LU.MinOffset, LU.MaxOffset,</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;                          LU.Kind, LU.AccessTy, NewF)) {</div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;            <span class="keywordflow">if</span> (!TTI.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a27c39fe900d03167d7e519f8d6cb94e2">isLegalAddImmediate</a>((uint64_t)NewF.UnfoldedOffset + Imm))</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;              <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;            NewF = <a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>;</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;            NewF.UnfoldedOffset = (uint64_t)NewF.UnfoldedOffset + Imm;</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;          }</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;          NewF.BaseRegs[<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>] = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(NegImmS, BaseReg);</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;          <span class="comment">// If the new formula has a constant in a register, and adding the</span></div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;          <span class="comment">// constant value to the immediate would produce a value closer to</span></div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;          <span class="comment">// zero than the immediate itself, then the formula isn&#39;t worthwhile.</span></div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a></div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;               J = NewF.BaseRegs.begin(), JE = NewF.BaseRegs.end();</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;               J != JE; ++J)</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;            <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;SCEVConstant&gt;(*J))</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;              <span class="keywordflow">if</span> ((<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue()-&gt;getValue() + NewF.BaseOffset).<a class="code" href="namespacellvm_1_1LibFunc.html#abf8f6830387f338fed0bce2e65108c6fac7d965d1f23189a93f8a5a4aed5bf161">abs</a>().slt(</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;                   <a class="code" href="namespacellvm.html#a59575e3191e743149bbd95eacbb9081a">abs64</a>(NewF.BaseOffset)) &amp;&amp;</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;                  (<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue()-&gt;getValue() +</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;                   NewF.BaseOffset).<a class="code" href="namespacellvm.html#abdaf1eaf6120421977095bd97eee892e">countTrailingZeros</a>() &gt;=</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;                   countTrailingZeros&lt;uint64_t&gt;(NewF.BaseOffset))</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;                <span class="keywordflow">goto</span> skip_formula;</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;          <span class="comment">// Ok, looks good.</span></div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;          (void)InsertFormula(LU, LUIdx, NewF);</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;        skip_formula:;</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;        }</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;      }</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;    }</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;  }</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;}</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;<span class="comment">/// GenerateAllReuseFormulae - Generate formulae for each use.</span></div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;<span class="comment"></span><span class="keywordtype">void</span></div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;LSRInstance::GenerateAllReuseFormulae() {</div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;  <span class="comment">// This is split into multiple loops so that hasRegsUsedByUsesOtherThan</span></div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;  <span class="comment">// queries are more precise.</span></div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> LUIdx = 0, NumUses = Uses.size(); LUIdx != NumUses; ++LUIdx) {</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;    LSRUse &amp;LU = Uses[LUIdx];</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, <a class="code" href="README__ALTIVEC_8txt.html#afb354c8aea0150628f8aa06c7f4a4168">f</a> = LU.Formulae.size(); i != <a class="code" href="README__ALTIVEC_8txt.html#afb354c8aea0150628f8aa06c7f4a4168">f</a>; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;      GenerateReassociations(LU, LUIdx, LU.Formulae[i]);</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, <a class="code" href="README__ALTIVEC_8txt.html#afb354c8aea0150628f8aa06c7f4a4168">f</a> = LU.Formulae.size(); i != <a class="code" href="README__ALTIVEC_8txt.html#afb354c8aea0150628f8aa06c7f4a4168">f</a>; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;      GenerateCombinations(LU, LUIdx, LU.Formulae[i]);</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;  }</div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> LUIdx = 0, NumUses = Uses.size(); LUIdx != NumUses; ++LUIdx) {</div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;    LSRUse &amp;LU = Uses[LUIdx];</div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, <a class="code" href="README__ALTIVEC_8txt.html#afb354c8aea0150628f8aa06c7f4a4168">f</a> = LU.Formulae.size(); i != <a class="code" href="README__ALTIVEC_8txt.html#afb354c8aea0150628f8aa06c7f4a4168">f</a>; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;      GenerateSymbolicOffsets(LU, LUIdx, LU.Formulae[i]);</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, <a class="code" href="README__ALTIVEC_8txt.html#afb354c8aea0150628f8aa06c7f4a4168">f</a> = LU.Formulae.size(); i != <a class="code" href="README__ALTIVEC_8txt.html#afb354c8aea0150628f8aa06c7f4a4168">f</a>; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;      GenerateConstantOffsets(LU, LUIdx, LU.Formulae[i]);</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, <a class="code" href="README__ALTIVEC_8txt.html#afb354c8aea0150628f8aa06c7f4a4168">f</a> = LU.Formulae.size(); i != <a class="code" href="README__ALTIVEC_8txt.html#afb354c8aea0150628f8aa06c7f4a4168">f</a>; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;      GenerateICmpZeroScales(LU, LUIdx, LU.Formulae[i]);</div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, <a class="code" href="README__ALTIVEC_8txt.html#afb354c8aea0150628f8aa06c7f4a4168">f</a> = LU.Formulae.size(); i != <a class="code" href="README__ALTIVEC_8txt.html#afb354c8aea0150628f8aa06c7f4a4168">f</a>; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;      GenerateScales(LU, LUIdx, LU.Formulae[i]);</div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;  }</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> LUIdx = 0, NumUses = Uses.size(); LUIdx != NumUses; ++LUIdx) {</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;    LSRUse &amp;LU = Uses[LUIdx];</div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, <a class="code" href="README__ALTIVEC_8txt.html#afb354c8aea0150628f8aa06c7f4a4168">f</a> = LU.Formulae.size(); i != <a class="code" href="README__ALTIVEC_8txt.html#afb354c8aea0150628f8aa06c7f4a4168">f</a>; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;      GenerateTruncates(LU, LUIdx, LU.Formulae[i]);</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;  }</div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;</div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;  GenerateCrossUseConstantOffsets();</div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;</div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;                  <span class="stringliteral">&quot;After generating reuse formulae:\n&quot;</span>;</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;        print_uses(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;}</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;<span class="comment">/// If there are multiple formulae with the same set of registers used</span></div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;<span class="comment">/// by other uses, pick the best one and delete the others.</span></div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::FilterOutUndesirableDedicatedRegisters() {</div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;  <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;const SCEV *&gt;</a> VisitedRegs;</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> Regs;</div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> LoserRegs;</div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;  <span class="keywordtype">bool</span> ChangedFormulae = <span class="keyword">false</span>;</div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;</div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;  <span class="comment">// Collect the best formula for each unique set of shared registers. This</span></div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;  <span class="comment">// is reset for each use.</span></div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;SmallVector&lt;const SCEV *, 4&gt;</a>, size_t, UniquifierDenseMapInfo&gt;</div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;    BestFormulaeTy;</div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;  BestFormulaeTy BestFormulae;</div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;</div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> LUIdx = 0, NumUses = Uses.size(); LUIdx != NumUses; ++LUIdx) {</div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;    LSRUse &amp;LU = Uses[LUIdx];</div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Filtering for use &quot;</span>; LU.print(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()); <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="namespacellvm_1_1SystemZICMP.html#aced1d1c5b34e96c8c6b9e7a1b284c4a9a096ab3206a2e0dd5713b6a1b2ff76bef">Any</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> FIdx = 0, NumForms = LU.Formulae.size();</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;         FIdx != NumForms; ++FIdx) {</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;      Formula &amp;F = LU.Formulae[FIdx];</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;</div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;      <span class="comment">// Some formulas are instant losers. For example, they may depend on</span></div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;      <span class="comment">// nonexistent AddRecs from other loops. These need to be filtered</span></div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;      <span class="comment">// immediately, otherwise heuristics could choose them over others leading</span></div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;      <span class="comment">// to an unsatisfactory solution. Passing LoserRegs into RateFormula here</span></div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;      <span class="comment">// avoids the need to recompute this information across formulae using the</span></div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;      <span class="comment">// same bad AddRec. Passing LoserRegs is also essential unless we remove</span></div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;      <span class="comment">// the corresponding bad register from the Regs set.</span></div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;      Cost CostF;</div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;      Regs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#aa72472422d95c7052d62432ec279ff85">clear</a>();</div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;      CostF.RateFormula(TTI, F, Regs, VisitedRegs, L, LU.Offsets, SE, DT, LU,</div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;                        &amp;LoserRegs);</div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;      <span class="keywordflow">if</span> (CostF.isLoser()) {</div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;        <span class="comment">// During initial formula generation, undesirable formulae are generated</span></div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;        <span class="comment">// by uses within other loops that have some non-trivial address mode or</span></div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;        <span class="comment">// use the postinc form of the IV. LSR needs to provide these formulae</span></div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;        <span class="comment">// as the basis of rediscovering the desired formula that uses an AddRec</span></div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;        <span class="comment">// corresponding to the existing phi. Once all formulae have been</span></div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;        <span class="comment">// generated, these initial losers may be pruned.</span></div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Filtering loser &quot;</span>; F.print(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;              <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;      }</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 4&gt;</a> Key;</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a> J = F.BaseRegs.begin(),</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;               JE = F.BaseRegs.end(); J != JE; ++J) {</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;          <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Reg = *J;</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;          <span class="keywordflow">if</span> (RegUses.isRegUsedByUsesOtherThan(Reg, LUIdx))</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;            Key.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Reg);</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;        }</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;        <span class="keywordflow">if</span> (F.ScaledReg &amp;&amp;</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;            RegUses.isRegUsedByUsesOtherThan(F.ScaledReg, LUIdx))</div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;          Key.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(F.ScaledReg);</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;        <span class="comment">// Unstable sort by host order ok, because this is only used for</span></div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;        <span class="comment">// uniquifying.</span></div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;        std::sort(Key.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Key.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>());</div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;        std::pair&lt;BestFormulaeTy::const_iterator, bool&gt; <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> =</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;          BestFormulae.insert(std::make_pair(Key, FIdx));</div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;        <span class="keywordflow">if</span> (P.second)</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;        Formula &amp;Best = LU.Formulae[P.first-&gt;second];</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;        Cost CostBest;</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;        Regs.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#aa72472422d95c7052d62432ec279ff85">clear</a>();</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;        CostBest.RateFormula(TTI, Best, Regs, VisitedRegs, L, LU.Offsets, SE,</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;                             DT, LU);</div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;        <span class="keywordflow">if</span> (CostF &lt; CostBest)</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;          <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(F, Best);</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Filtering out formula &quot;</span>; F.print(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;              <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;                        <span class="stringliteral">&quot;    in favor of formula &quot;</span>; Best.print(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;              <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;      }</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;      ChangedFormulae = <span class="keyword">true</span>;</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;      LU.DeleteFormula(F);</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;      --FIdx;</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;      --NumForms;</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;      Any = <span class="keyword">true</span>;</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;    }</div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;    <span class="comment">// Now that we&#39;ve filtered out some formulae, recompute the Regs set.</span></div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;    <span class="keywordflow">if</span> (Any)</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;      LU.RecomputeRegs(LUIdx, RegUses);</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;    <span class="comment">// Reset this to prepare for the next use.</span></div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;    BestFormulae.clear();</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;  }</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<span class="keywordflow">if</span> (ChangedFormulae) {</div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;          <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;                    <span class="stringliteral">&quot;After filtering out undesirable candidates:\n&quot;</span>;</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;          print_uses(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;        });</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;}</div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;<span class="comment">// This is a rough guess that seems to work fairly well.</span></div><div class="line"><a name="l03863"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a9ca1a9aba5dedc82b4097ec967bcc712"> 3863</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code" href="LoopStrengthReduce_8cpp.html#a9ca1a9aba5dedc82b4097ec967bcc712">ComplexityLimit</a> = UINT16_MAX;</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;<span class="comment">/// EstimateSearchSpaceComplexity - Estimate the worst-case number of</span></div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;<span class="comment">/// solutions the solver might have to consider. It almost never considers</span></div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;<span class="comment">/// this many solutions because it prune the search space, but the pruning</span></div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;<span class="comment">/// isn&#39;t always sufficient.</span></div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;<span class="comment"></span><span class="keywordtype">size_t</span> LSRInstance::EstimateSearchSpaceComplexity()<span class="keyword"> const </span>{</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;  <span class="keywordtype">size_t</span> Power = 1;</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;LSRUse&gt;::const_iterator</a> I = Uses.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;       E = Uses.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;    <span class="keywordtype">size_t</span> FSize = I-&gt;Formulae.size();</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;    <span class="keywordflow">if</span> (FSize &gt;= ComplexityLimit) {</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;      Power = <a class="code" href="LoopStrengthReduce_8cpp.html#a9ca1a9aba5dedc82b4097ec967bcc712">ComplexityLimit</a>;</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;    }</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;    Power *= FSize;</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;    <span class="keywordflow">if</span> (Power &gt;= ComplexityLimit)</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;  }</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;  <span class="keywordflow">return</span> Power;</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;}</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;<span class="comment">/// NarrowSearchSpaceByDetectingSupersets - When one formula uses a superset</span></div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;<span class="comment">/// of the registers of another formula, it won&#39;t help reduce register</span></div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;<span class="comment">/// pressure (though it may not necessarily hurt register pressure); remove</span></div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;<span class="comment">/// it to simplify the system.</span></div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::NarrowSearchSpaceByDetectingSupersets() {</div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;  <span class="keywordflow">if</span> (EstimateSearchSpaceComplexity() &gt;= ComplexityLimit) {</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;The search space is too complex.\n&quot;</span>);</div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Narrowing the search space by eliminating formulae &quot;</span></div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;                    <span class="stringliteral">&quot;which use a superset of registers used by other &quot;</span></div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;                    <span class="stringliteral">&quot;formulae.\n&quot;</span>);</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> LUIdx = 0, NumUses = Uses.size(); LUIdx != NumUses; ++LUIdx) {</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;      LSRUse &amp;LU = Uses[LUIdx];</div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;      <span class="keywordtype">bool</span> <a class="code" href="namespacellvm_1_1SystemZICMP.html#aced1d1c5b34e96c8c6b9e7a1b284c4a9a096ab3206a2e0dd5713b6a1b2ff76bef">Any</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, e = LU.Formulae.size(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;        Formula &amp;F = LU.Formulae[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;        <span class="comment">// Look for a formula with a constant or GV in a register. If the use</span></div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;        <span class="comment">// also has a formula with that same value in an immediate field,</span></div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;        <span class="comment">// delete the one that uses a register.</span></div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a></div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;             I = F.BaseRegs.begin(), E = F.BaseRegs.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVConstant.html">SCEVConstant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;SCEVConstant&gt;(*I)) {</div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;            Formula NewF = <a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>;</div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;            NewF.BaseOffset += <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue()-&gt;getSExtValue();</div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;            NewF.BaseRegs.erase(NewF.BaseRegs.begin() +</div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;                                (I - F.BaseRegs.begin()));</div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;            <span class="keywordflow">if</span> (LU.HasFormulaWithSameRegs(NewF)) {</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;              <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Deleting &quot;</span>; F.print(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()); <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;              LU.DeleteFormula(F);</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;              --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;              --e;</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;              Any = <span class="keyword">true</span>;</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;              <span class="keywordflow">break</span>;</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;            }</div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEVUnknown.html">SCEVUnknown</a> *U = dyn_cast&lt;SCEVUnknown&gt;(*I)) {</div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *GV = dyn_cast&lt;GlobalValue&gt;(U-&gt;getValue()))</div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;              <span class="keywordflow">if</span> (!F.BaseGV) {</div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;                Formula NewF = <a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>;</div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;                NewF.BaseGV = GV;</div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;                NewF.BaseRegs.erase(NewF.BaseRegs.begin() +</div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;                                    (I - F.BaseRegs.begin()));</div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;                <span class="keywordflow">if</span> (LU.HasFormulaWithSameRegs(NewF)) {</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;                  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Deleting &quot;</span>; F.print(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;                        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;                  LU.DeleteFormula(F);</div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;                  --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;                  --e;</div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;                  Any = <span class="keyword">true</span>;</div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;                }</div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;              }</div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;          }</div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;        }</div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;      }</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;      <span class="keywordflow">if</span> (Any)</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;        LU.RecomputeRegs(LUIdx, RegUses);</div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;    }</div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;</div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;After pre-selection:\n&quot;</span>;</div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;          print_uses(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;  }</div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;}</div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;<span class="comment">/// NarrowSearchSpaceByCollapsingUnrolledCode - When there are many registers</span></div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;<span class="comment">/// for expressions like A, A+1, A+2, etc., allocate a single register for</span></div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;<span class="comment">/// them.</span></div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::NarrowSearchSpaceByCollapsingUnrolledCode() {</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;  <span class="keywordflow">if</span> (EstimateSearchSpaceComplexity() &lt; ComplexityLimit)</div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;</div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;The search space is too complex.\n&quot;</span></div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;                  <span class="stringliteral">&quot;Narrowing the search space by assuming that uses separated &quot;</span></div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;                  <span class="stringliteral">&quot;by a constant offset will use the same registers.\n&quot;</span>);</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;</div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;  <span class="comment">// This is especially useful for unrolled loops.</span></div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;</div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> LUIdx = 0, NumUses = Uses.size(); LUIdx != NumUses; ++LUIdx) {</div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;    LSRUse &amp;LU = Uses[LUIdx];</div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Formula&gt;::const_iterator</a> I = LU.Formulae.begin(),</div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;         E = LU.Formulae.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;      <span class="keyword">const</span> Formula &amp;F = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;      <span class="keywordflow">if</span> (F.BaseOffset == 0 || F.Scale != 0)</div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;</div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;      LSRUse *LUThatHas = FindUseWithSimilarFormula(F, LU);</div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;      <span class="keywordflow">if</span> (!LUThatHas)</div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;</div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;      <span class="keywordflow">if</span> (!reconcileNewOffset(*LUThatHas, F.BaseOffset, <span class="comment">/*HasBaseReg=*/</span> <span class="keyword">false</span>,</div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;                              LU.Kind, LU.AccessTy))</div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;</div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Deleting use &quot;</span>; LU.print(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()); <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;</div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;      LUThatHas-&gt;AllFixupsOutsideLoop &amp;= LU.AllFixupsOutsideLoop;</div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;</div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;      <span class="comment">// Update the relocs to reference the new use.</span></div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classT.html">SmallVectorImpl&lt;LSRFixup&gt;::iterator</a> I = <a class="code" href="namespacellvm_1_1AArch64.html#a5c816ea23ece51a78a235f57ffb177a9">Fixups</a>.begin(),</div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;           E = <a class="code" href="namespacellvm_1_1AArch64.html#a5c816ea23ece51a78a235f57ffb177a9">Fixups</a>.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;        LSRFixup &amp;Fixup = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;        <span class="keywordflow">if</span> (Fixup.LUIdx == LUIdx) {</div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;          Fixup.LUIdx = LUThatHas - &amp;Uses.front();</div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;          Fixup.Offset += F.BaseOffset;</div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;          <span class="comment">// Add the new offset to LUThatHas&#39; offset list.</span></div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;          <span class="keywordflow">if</span> (LUThatHas-&gt;Offsets.back() != Fixup.Offset) {</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;            LUThatHas-&gt;Offsets.push_back(Fixup.Offset);</div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;            <span class="keywordflow">if</span> (Fixup.Offset &gt; LUThatHas-&gt;MaxOffset)</div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;              LUThatHas-&gt;MaxOffset = Fixup.Offset;</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;            <span class="keywordflow">if</span> (Fixup.Offset &lt; LUThatHas-&gt;MinOffset)</div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;              LUThatHas-&gt;MinOffset = Fixup.Offset;</div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;          }</div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;New fixup has offset &quot;</span> &lt;&lt; Fixup.Offset &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;        }</div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;        <span class="keywordflow">if</span> (Fixup.LUIdx == NumUses-1)</div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;          Fixup.LUIdx = LUIdx;</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;      }</div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;      <span class="comment">// Delete formulae from the new use which are no longer legal.</span></div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;      <span class="keywordtype">bool</span> <a class="code" href="namespacellvm_1_1SystemZICMP.html#aced1d1c5b34e96c8c6b9e7a1b284c4a9a096ab3206a2e0dd5713b6a1b2ff76bef">Any</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, e = LUThatHas-&gt;Formulae.size(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;        Formula &amp;F = LUThatHas-&gt;Formulae[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, LUThatHas-&gt;MinOffset, LUThatHas-&gt;MaxOffset,</div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;                        LUThatHas-&gt;Kind, LUThatHas-&gt;AccessTy, F)) {</div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Deleting &quot;</span>; F.print(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;                <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;          LUThatHas-&gt;DeleteFormula(F);</div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;          --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;          --e;</div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;          Any = <span class="keyword">true</span>;</div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;        }</div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;      }</div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;</div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;      <span class="keywordflow">if</span> (Any)</div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;        LUThatHas-&gt;RecomputeRegs(LUThatHas - &amp;Uses.front(), RegUses);</div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;</div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;      <span class="comment">// Delete the old use.</span></div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;      DeleteUse(LU, LUIdx);</div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;      --LUIdx;</div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;      --NumUses;</div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;    }</div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;  }</div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;</div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;After pre-selection:\n&quot;</span>; print_uses(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;}</div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;<span class="comment">/// NarrowSearchSpaceByRefilteringUndesirableDedicatedRegisters - Call</span></div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;<span class="comment">/// FilterOutUndesirableDedicatedRegisters again, if necessary, now that</span></div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;<span class="comment">/// we&#39;ve done more filtering, as it may be able to find more formulae to</span></div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;<span class="comment">/// eliminate.</span></div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::NarrowSearchSpaceByRefilteringUndesirableDedicatedRegisters(){</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;  <span class="keywordflow">if</span> (EstimateSearchSpaceComplexity() &gt;= ComplexityLimit) {</div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;The search space is too complex.\n&quot;</span>);</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;</div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Narrowing the search space by re-filtering out &quot;</span></div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;                    <span class="stringliteral">&quot;undesirable dedicated registers.\n&quot;</span>);</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;</div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;    FilterOutUndesirableDedicatedRegisters();</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;</div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;After pre-selection:\n&quot;</span>;</div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;          print_uses(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;  }</div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;}</div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;<span class="comment">/// NarrowSearchSpaceByPickingWinnerRegs - Pick a register which seems likely</span></div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;<span class="comment">/// to be profitable, and then in any use which has any reference to that</span></div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;<span class="comment">/// register, delete all formulae which do not reference that register.</span></div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::NarrowSearchSpaceByPickingWinnerRegs() {</div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;  <span class="comment">// With all other options exhausted, loop until the system is simple</span></div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;  <span class="comment">// enough to handle.</span></div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 4&gt;</a> Taken;</div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;  <span class="keywordflow">while</span> (EstimateSearchSpaceComplexity() &gt;= ComplexityLimit) {</div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;    <span class="comment">// Ok, we have too many of formulae on our hands to conveniently handle.</span></div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;    <span class="comment">// Use a rough heuristic to thin out the list.</span></div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;The search space is too complex.\n&quot;</span>);</div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;</div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;    <span class="comment">// Pick the register which is used by the most LSRUses, which is likely</span></div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;    <span class="comment">// to be a good reuse register candidate.</span></div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Best = 0;</div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;    <span class="keywordtype">unsigned</span> BestNum = 0;</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;    <span class="keywordflow">for</span> (RegUseTracker::const_iterator I = RegUses.begin(), E = RegUses.end();</div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;         I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Reg = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;      <span class="keywordflow">if</span> (Taken.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(Reg))</div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;      <span class="keywordflow">if</span> (!Best)</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;        Best = <a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a>;</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;        <span class="keywordtype">unsigned</span> Count = RegUses.getUsedByIndices(Reg).count();</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;        <span class="keywordflow">if</span> (Count &gt; BestNum) {</div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;          Best = <a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a>;</div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;          BestNum = Count;</div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;        }</div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;      }</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;    }</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Narrowing the search space by assuming &quot;</span> &lt;&lt; *Best</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; will yield profitable reuse.\n&quot;</span>);</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;    Taken.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(Best);</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;</div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;    <span class="comment">// In any use with formulae which references this register, delete formulae</span></div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;    <span class="comment">// which don&#39;t reference it.</span></div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> LUIdx = 0, NumUses = Uses.size(); LUIdx != NumUses; ++LUIdx) {</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;      LSRUse &amp;LU = Uses[LUIdx];</div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;      <span class="keywordflow">if</span> (!LU.Regs.count(Best)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;      <span class="keywordtype">bool</span> <a class="code" href="namespacellvm_1_1SystemZICMP.html#aced1d1c5b34e96c8c6b9e7a1b284c4a9a096ab3206a2e0dd5713b6a1b2ff76bef">Any</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, e = LU.Formulae.size(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;        Formula &amp;F = LU.Formulae[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;        <span class="keywordflow">if</span> (!F.referencesReg(Best)) {</div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Deleting &quot;</span>; F.print(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()); <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;          LU.DeleteFormula(F);</div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;          --e;</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;          --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;          Any = <span class="keyword">true</span>;</div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;          assert(e != 0 &amp;&amp; <span class="stringliteral">&quot;Use has no formulae left! Is Regs inconsistent?&quot;</span>);</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;        }</div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;      }</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;</div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;      <span class="keywordflow">if</span> (Any)</div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;        LU.RecomputeRegs(LUIdx, RegUses);</div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;    }</div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;</div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;After pre-selection:\n&quot;</span>;</div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;          print_uses(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;  }</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;}</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;<span class="comment">/// NarrowSearchSpaceUsingHeuristics - If there are an extraordinary number of</span></div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;<span class="comment">/// formulae to choose from, use some rough heuristics to prune down the number</span></div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;<span class="comment">/// of formulae. This keeps the main solver from taking an extraordinary amount</span></div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;<span class="comment">/// of time in some worst-case scenarios.</span></div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::NarrowSearchSpaceUsingHeuristics() {</div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;  NarrowSearchSpaceByDetectingSupersets();</div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;  NarrowSearchSpaceByCollapsingUnrolledCode();</div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;  NarrowSearchSpaceByRefilteringUndesirableDedicatedRegisters();</div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;  NarrowSearchSpaceByPickingWinnerRegs();</div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;}</div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;<span class="comment">/// SolveRecurse - This is the recursive solver.</span></div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::SolveRecurse(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const Formula *&gt;</a> &amp;Solution,</div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;                               Cost &amp;SolutionCost,</div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;                               <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const Formula *&gt;</a> &amp;Workspace,</div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;                               <span class="keyword">const</span> Cost &amp;CurCost,</div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;                               <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> &amp;CurRegs,</div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;                               <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;const SCEV *&gt;</a> &amp;VisitedRegs)<span class="keyword"> const </span>{</div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;  <span class="comment">// Some ideas:</span></div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;  <span class="comment">//  - prune more:</span></div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;  <span class="comment">//    - use more aggressive filtering</span></div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;  <span class="comment">//    - sort the formula so that the most profitable solutions are found first</span></div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;  <span class="comment">//    - sort the uses too</span></div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;  <span class="comment">//  - search faster:</span></div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;  <span class="comment">//    - don&#39;t compute a cost, and then compare. compare while computing a cost</span></div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;  <span class="comment">//      and bail early.</span></div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;  <span class="comment">//    - track register sets with SmallBitVector</span></div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;</div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;  <span class="keyword">const</span> LSRUse &amp;LU = Uses[Workspace.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>()];</div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;</div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;  <span class="comment">// If this use references any register that&#39;s already a part of the</span></div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;  <span class="comment">// in-progress solution, consider it a requirement that a formula must</span></div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;  <span class="comment">// reference that register in order to be considered. This prunes out</span></div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;  <span class="comment">// unprofitable searching.</span></div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;  <a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;const SCEV *, 4&gt;</a> ReqRegs;</div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;const SCEV *, 16&gt;::const_iterator</a> I = CurRegs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">begin</a>(),</div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;       E = CurRegs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a7f055d0b03ebf1d6a5988b178e9b8f4f">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;    <span class="keywordflow">if</span> (LU.Regs.count(*I))</div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;      ReqRegs.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(*I);</div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;</div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> NewRegs;</div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;  Cost NewCost;</div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Formula&gt;::const_iterator</a> I = LU.Formulae.begin(),</div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;       E = LU.Formulae.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;    <span class="keyword">const</span> Formula &amp;F = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;</div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;    <span class="comment">// Ignore formulae which do not use any of the required registers.</span></div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;    <span class="keywordtype">bool</span> SatisfiedReqReg = <span class="keyword">true</span>;</div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;const SCEV *, 4&gt;::const_iterator</a> J = ReqRegs.<a class="code" href="classllvm_1_1SetVector.html#adb13793b98ab59209a5309d26f831850">begin</a>(),</div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;         JE = ReqRegs.<a class="code" href="classllvm_1_1SetVector.html#affac0dc3d407ef3dee29b8bc9a4836bc">end</a>(); J != JE; ++J) {</div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Reg = *J;</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;      <span class="keywordflow">if</span> ((!F.ScaledReg || F.ScaledReg != Reg) &amp;&amp;</div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;          std::find(F.BaseRegs.begin(), F.BaseRegs.end(), <a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a>) ==</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;          F.BaseRegs.end()) {</div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;        SatisfiedReqReg = <span class="keyword">false</span>;</div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;      }</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;    }</div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;    <span class="keywordflow">if</span> (!SatisfiedReqReg) {</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;      <span class="comment">// If none of the formulae satisfied the required registers, then we could</span></div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;      <span class="comment">// clear ReqRegs and try again. Currently, we simply give up in this case.</span></div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;    }</div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;</div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;    <span class="comment">// Evaluate the cost of the current formula. If it&#39;s already worse than</span></div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;    <span class="comment">// the current best, prune the search at that point.</span></div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;    NewCost = CurCost;</div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;    NewRegs = CurRegs;</div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;    NewCost.RateFormula(TTI, F, NewRegs, VisitedRegs, L, LU.Offsets, SE, DT,</div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;                        LU);</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;    <span class="keywordflow">if</span> (NewCost &lt; SolutionCost) {</div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;      Workspace.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(&amp;F);</div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;      <span class="keywordflow">if</span> (Workspace.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() != Uses.size()) {</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;        SolveRecurse(Solution, SolutionCost, Workspace, NewCost,</div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;                     NewRegs, VisitedRegs);</div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;        <span class="keywordflow">if</span> (F.getNumRegs() == 1 &amp;&amp; Workspace.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 1)</div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;          VisitedRegs.<a class="code" href="classllvm_1_1DenseSet.html#ab658e5485796a5ff90bd2dc3fca7d6d2">insert</a>(F.ScaledReg ? F.ScaledReg : F.BaseRegs[0]);</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;New best at &quot;</span>; NewCost.print(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;              <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;.\n Regs:&quot;</span>;</div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;              <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;const SCEV *, 16&gt;::const_iterator</a></div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;                   I = NewRegs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">begin</a>(), E = NewRegs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a7f055d0b03ebf1d6a5988b178e9b8f4f">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;                <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; **<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;              <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;        SolutionCost = NewCost;</div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;        Solution = Workspace;</div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;      }</div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;      Workspace.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#a1f2303df9bbee2233c11d61c2f6f7930">pop_back</a>();</div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;    }</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;  }</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;}</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;<span class="comment">/// Solve - Choose one formula from each use. Return the results in the given</span></div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;<span class="comment">/// Solution vector.</span></div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::Solve(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const Formula *&gt;</a> &amp;Solution)<span class="keyword"> const </span>{</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const Formula *, 8&gt;</a> Workspace;</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;  Cost SolutionCost;</div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;  SolutionCost.Loose();</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;  Cost CurCost;</div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const SCEV *, 16&gt;</a> CurRegs;</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;  <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;const SCEV *&gt;</a> VisitedRegs;</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;  Workspace.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a4786e64977a3af38f29adee46b70a863">reserve</a>(Uses.size());</div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;  <span class="comment">// SolveRecurse does all the work.</span></div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;  SolveRecurse(Solution, SolutionCost, Workspace, CurCost,</div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;               CurRegs, VisitedRegs);</div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;  <span class="keywordflow">if</span> (Solution.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\nNo Satisfactory Solution\n&quot;</span>);</div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;  }</div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;</div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;  <span class="comment">// Ok, we&#39;ve now made all our decisions.</span></div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;                  <span class="stringliteral">&quot;The chosen solution requires &quot;</span>; SolutionCost.print(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;:\n&quot;</span>;</div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, e = Uses.size(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;          <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  &quot;</span>;</div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;          Uses[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].print(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;          <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;                    <span class="stringliteral">&quot;    &quot;</span>;</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;          Solution[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;print(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;          <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;        });</div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;</div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;  assert(Solution.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == Uses.size() &amp;&amp; <span class="stringliteral">&quot;Malformed solution!&quot;</span>);</div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;}</div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;<span class="comment">/// HoistInsertPosition - Helper for AdjustInsertPositionForExpand. Climb up</span></div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;<span class="comment">/// the dominator tree far as we can go while still being dominated by the</span></div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;<span class="comment">/// input positions. This helps canonicalize the insert position, which</span></div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;<span class="comment">/// encourages sharing.</span></div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a></div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;LSRInstance::HoistInsertPosition(<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> IP,</div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;                                 <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;Inputs)<span class="keyword"></span></div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;<span class="keyword">                                                                         const </span>{</div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;  <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1Loop.html">Loop</a> *IPLoop = LI.getLoopFor(IP-&gt;getParent());</div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;    <span class="keywordtype">unsigned</span> IPLoopDepth = IPLoop ? IPLoop-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a433660a96d8e96997856d16c5930b096">getLoopDepth</a>() : 0;</div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;</div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *IDom;</div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNode</a> *Rung = DT.<a class="code" href="classllvm_1_1DominatorTree.html#a307665a69dff132a967d4f0d2acd3791">getNode</a>(IP-&gt;getParent()); ; ) {</div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;      <span class="keywordflow">if</span> (!Rung) <span class="keywordflow">return</span> IP;</div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;      Rung = Rung-&gt;getIDom();</div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;      <span class="keywordflow">if</span> (!Rung) <span class="keywordflow">return</span> IP;</div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;      IDom = Rung-&gt;getBlock();</div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;</div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;      <span class="comment">// Don&#39;t climb into a loop though.</span></div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1Loop.html">Loop</a> *IDomLoop = LI.getLoopFor(IDom);</div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;      <span class="keywordtype">unsigned</span> IDomDepth = IDomLoop ? IDomLoop-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a433660a96d8e96997856d16c5930b096">getLoopDepth</a>() : 0;</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;      <span class="keywordflow">if</span> (IDomDepth &lt;= IPLoopDepth &amp;&amp;</div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;          (IDomDepth != IPLoopDepth || IDomLoop == IPLoop))</div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;    }</div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;</div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;    <span class="keywordtype">bool</span> AllDominate = <span class="keyword">true</span>;</div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *BetterPos = 0;</div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Tentative = IDom-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>();</div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;::const_iterator</a> I = Inputs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;         E = Inputs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;      <span class="keywordflow">if</span> (Inst == Tentative || !DT.<a class="code" href="classllvm_1_1DominatorTree.html#a6fe9272dc67fe2ff4cafc33b895c4a6c">dominates</a>(Inst, Tentative)) {</div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;        AllDominate = <span class="keyword">false</span>;</div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;      }</div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;      <span class="comment">// Attempt to find an insert position in the middle of the block,</span></div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;      <span class="comment">// instead of at the end, so that it can be used for other expansions.</span></div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;      <span class="keywordflow">if</span> (IDom == Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>() &amp;&amp;</div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;          (!BetterPos || !DT.<a class="code" href="classllvm_1_1DominatorTree.html#a6fe9272dc67fe2ff4cafc33b895c4a6c">dominates</a>(Inst, BetterPos)))</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;        BetterPos = <a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a>(Inst));</div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;    }</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;    <span class="keywordflow">if</span> (!AllDominate)</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;    <span class="keywordflow">if</span> (BetterPos)</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;      IP = BetterPos;</div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;      IP = Tentative;</div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;  }</div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;</div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;  <span class="keywordflow">return</span> IP;</div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;}</div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;<span class="comment">/// AdjustInsertPositionForExpand - Determine an input position which will be</span></div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;<span class="comment">/// dominated by the operands and which will dominate the result.</span></div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a></div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;LSRInstance::AdjustInsertPositionForExpand(<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> LowestIP,</div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;                                           <span class="keyword">const</span> LSRFixup &amp;LF,</div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;                                           <span class="keyword">const</span> LSRUse &amp;LU,</div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;                                           <a class="code" href="classllvm_1_1SCEVExpander.html">SCEVExpander</a> &amp;Rewriter)<span class="keyword"> const </span>{</div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;  <span class="comment">// Collect some instructions which must be dominated by the</span></div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;  <span class="comment">// expanding replacement. These must be dominated by any operands that</span></div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;  <span class="comment">// will be required in the expansion.</span></div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 4&gt;</a> Inputs;</div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I = dyn_cast&lt;Instruction&gt;(LF.OperandValToReplace))</div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;    Inputs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(I);</div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;  <span class="keywordflow">if</span> (LU.Kind == LSRUse::ICmpZero)</div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I =</div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;          dyn_cast&lt;Instruction&gt;(cast&lt;ICmpInst&gt;(LF.UserInst)-&gt;getOperand(1)))</div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;      Inputs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(I);</div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;  <span class="keywordflow">if</span> (LF.PostIncLoops.count(L)) {</div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;    <span class="keywordflow">if</span> (LF.isUseFullyOutsideLoop(L))</div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;      Inputs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a8917d359fc92f25eb0117386588c6f1c">getLoopLatch</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;      Inputs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(IVIncInsertPos);</div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;  }</div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;  <span class="comment">// The expansion must also be dominated by the increment positions of any</span></div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;  <span class="comment">// loops it for which it is using post-inc mode.</span></div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">PostIncLoopSet::const_iterator</a> I = LF.PostIncLoops.begin(),</div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;       E = LF.PostIncLoops.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1Loop.html">Loop</a> *PIL = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;    <span class="keywordflow">if</span> (PIL == L) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;</div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;    <span class="comment">// Be dominated by the loop exit.</span></div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 4&gt;</a> ExitingBlocks;</div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;    PIL-&gt;<a class="code" href="classllvm_1_1LoopBase.html#aa6bdb226fb3dac1f051547ce01b76fd2">getExitingBlocks</a>(ExitingBlocks);</div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;    <span class="keywordflow">if</span> (!ExitingBlocks.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = ExitingBlocks[0];</div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 1, e = ExitingBlocks.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;        BB = DT.<a class="code" href="classllvm_1_1DominatorTree.html#a7b8f5876ec15b49abf76ae81cefac1f6">findNearestCommonDominator</a>(BB, ExitingBlocks[i]);</div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;      Inputs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;    }</div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;  }</div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;</div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;  assert(!isa&lt;PHINode&gt;(LowestIP) &amp;&amp; !isa&lt;LandingPadInst&gt;(LowestIP)</div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;         &amp;&amp; !isa&lt;DbgInfoIntrinsic&gt;(LowestIP) &amp;&amp;</div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;         <span class="stringliteral">&quot;Insertion point must be a normal instruction&quot;</span>);</div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;</div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;  <span class="comment">// Then, climb up the immediate dominator tree as far as we can go while</span></div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;  <span class="comment">// still being dominated by the input positions.</span></div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> IP = HoistInsertPosition(LowestIP, Inputs);</div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;</div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;  <span class="comment">// Don&#39;t insert instructions before PHI nodes.</span></div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;  <span class="keywordflow">while</span> (isa&lt;PHINode&gt;(IP)) ++IP;</div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;</div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;  <span class="comment">// Ignore landingpad instructions.</span></div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;  <span class="keywordflow">while</span> (isa&lt;LandingPadInst&gt;(IP)) ++IP;</div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;  <span class="comment">// Ignore debug intrinsics.</span></div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;  <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(IP)) ++IP;</div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;  <span class="comment">// Set IP below instructions recently inserted by SCEVExpander. This keeps the</span></div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;  <span class="comment">// IP consistent across expansions and allows the previously inserted</span></div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;  <span class="comment">// instructions to be reused by subsequent expansion.</span></div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;  <span class="keywordflow">while</span> (Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#a6b023424193e702b745da77d6ead62e8">isInsertedInstruction</a>(IP) &amp;&amp; IP != LowestIP) ++IP;</div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;</div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;  <span class="keywordflow">return</span> IP;</div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;}</div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;<span class="comment">/// Expand - Emit instructions for the leading candidate expression for this</span></div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;<span class="comment">/// LSRUse (this is called &quot;expanding&quot;).</span></div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1Value.html">Value</a> *LSRInstance::Expand(<span class="keyword">const</span> LSRFixup &amp;LF,</div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;                           <span class="keyword">const</span> Formula &amp;F,</div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;                           <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> IP,</div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;                           <a class="code" href="classllvm_1_1SCEVExpander.html">SCEVExpander</a> &amp;Rewriter,</div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;                           <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;WeakVH&gt;</a> &amp;DeadInsts)<span class="keyword"> const </span>{</div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;  <span class="keyword">const</span> LSRUse &amp;LU = Uses[LF.LUIdx];</div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;  <span class="keywordflow">if</span> (LU.RigidFormula)</div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;    <span class="keywordflow">return</span> LF.OperandValToReplace;</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;</div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;  <span class="comment">// Determine an input position which will be dominated by the operands and</span></div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;  <span class="comment">// which will dominate the result.</span></div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;  IP = AdjustInsertPositionForExpand(IP, LF, LU, Rewriter);</div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;</div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;  <span class="comment">// Inform the Rewriter if we have a post-increment use, so that it can</span></div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;  <span class="comment">// perform an advantageous expansion.</span></div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;  Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#aaca0b4b6c0a7f9a36f043b993177e03e">setPostInc</a>(LF.PostIncLoops);</div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;</div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;  <span class="comment">// This is the type that the user actually needs.</span></div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *OpTy = LF.OperandValToReplace-&gt;getType();</div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;  <span class="comment">// This will be the type that we&#39;ll initially expand to.</span></div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = F.getType();</div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;  <span class="keywordflow">if</span> (!Ty)</div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;    <span class="comment">// No type known; just expand directly to the ultimate type.</span></div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;    Ty = OpTy;</div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#abb976145b00ae108c1d6b98c4f099d27">getEffectiveSCEVType</a>(Ty) == SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#abb976145b00ae108c1d6b98c4f099d27">getEffectiveSCEVType</a>(OpTy))</div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;    <span class="comment">// Expand directly to the ultimate type if it&#39;s the right size.</span></div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;    Ty = OpTy;</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;  <span class="comment">// This is the type to do integer arithmetic in.</span></div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *IntTy = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#abb976145b00ae108c1d6b98c4f099d27">getEffectiveSCEVType</a>(Ty);</div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;</div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;  <span class="comment">// Build up a list of operands to add together to form the full base.</span></div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const SCEV *, 8&gt;</a> Ops;</div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;</div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;  <span class="comment">// Expand the BaseRegs portion.</span></div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const SCEV *&gt;::const_iterator</a> I = F.BaseRegs.begin(),</div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;       E = F.BaseRegs.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *Reg = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;    assert(!Reg-&gt;<a class="code" href="classllvm_1_1SCEV.html#a3f76d2fd4788225548dc36ef9e417030">isZero</a>() &amp;&amp; <span class="stringliteral">&quot;Zero allocated in a base register!&quot;</span>);</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;    <span class="comment">// If we&#39;re expanding for a post-inc user, make the post-inc adjustment.</span></div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">PostIncLoopSet</a> &amp;<a class="code" href="HexagonHardwareLoops_8cpp.html#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a> = <span class="keyword">const_cast&lt;</span><a class="code" href="classllvm_1_1SmallPtrSet.html">PostIncLoopSet</a> &amp;<span class="keyword">&gt;</span>(LF.PostIncLoops);</div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;    Reg = <a class="code" href="namespacellvm.html#adfac6898b7e6f186616ff5c337670296">TransformForPostIncUse</a>(<a class="code" href="namespacellvm.html#a72e1beba38b6627c9307ab8b5141ac64a4e61e68aee514bee49f2930447338b31">Denormalize</a>, Reg,</div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;                                 LF.UserInst, LF.OperandValToReplace,</div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;                                 Loops, SE, DT);</div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;</div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;    Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad8e4f5b2ced08ad7d138b598aefdd338">getUnknown</a>(Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#a583d3ca95f83216d632a4d1ae0330dd0">expandCodeFor</a>(Reg, 0, IP)));</div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;  }</div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;</div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;  <span class="comment">// Expand the ScaledReg portion.</span></div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ICmpScaledV = 0;</div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;  <span class="keywordflow">if</span> (F.Scale != 0) {</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *ScaledS = F.ScaledReg;</div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;</div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;    <span class="comment">// If we&#39;re expanding for a post-inc user, make the post-inc adjustment.</span></div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">PostIncLoopSet</a> &amp;<a class="code" href="HexagonHardwareLoops_8cpp.html#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a> = <span class="keyword">const_cast&lt;</span><a class="code" href="classllvm_1_1SmallPtrSet.html">PostIncLoopSet</a> &amp;<span class="keyword">&gt;</span>(LF.PostIncLoops);</div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;    ScaledS = <a class="code" href="namespacellvm.html#adfac6898b7e6f186616ff5c337670296">TransformForPostIncUse</a>(<a class="code" href="namespacellvm.html#a72e1beba38b6627c9307ab8b5141ac64a4e61e68aee514bee49f2930447338b31">Denormalize</a>, ScaledS,</div><div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;                                     LF.UserInst, LF.OperandValToReplace,</div><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;                                     Loops, SE, DT);</div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;</div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;    <span class="keywordflow">if</span> (LU.Kind == LSRUse::ICmpZero) {</div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;      <span class="comment">// An interesting way of &quot;folding&quot; with an icmp is to use a negated</span></div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;      <span class="comment">// scale, which we&#39;ll implement by inserting it into the other operand</span></div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;      <span class="comment">// of the icmp.</span></div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;      assert(F.Scale == -1 &amp;&amp;</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;             <span class="stringliteral">&quot;The only scale supported by ICmpZero uses is -1!&quot;</span>);</div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;      ICmpScaledV = Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#a583d3ca95f83216d632a4d1ae0330dd0">expandCodeFor</a>(ScaledS, 0, IP);</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;      <span class="comment">// Otherwise just expand the scaled register and an explicit scale,</span></div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;      <span class="comment">// which is expected to be matched as part of the address.</span></div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;</div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;      <span class="comment">// Flush the operand list to suppress SCEVExpander hoisting address modes.</span></div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;      <span class="keywordflow">if</span> (!Ops.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>() &amp;&amp; LU.Kind == LSRUse::Address) {</div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *FullV = Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#a583d3ca95f83216d632a4d1ae0330dd0">expandCodeFor</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(Ops), Ty, IP);</div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;        Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;        Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad8e4f5b2ced08ad7d138b598aefdd338">getUnknown</a>(FullV));</div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;      }</div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;      ScaledS = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad8e4f5b2ced08ad7d138b598aefdd338">getUnknown</a>(Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#a583d3ca95f83216d632a4d1ae0330dd0">expandCodeFor</a>(ScaledS, 0, IP));</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;      ScaledS = SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad5829d76e14852080c205f8b94d830f1">getMulExpr</a>(ScaledS,</div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;                              SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(ScaledS-&gt;<a class="code" href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">getType</a>(), F.Scale));</div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;      Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(ScaledS);</div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;    }</div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;  }</div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;</div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;  <span class="comment">// Expand the GV portion.</span></div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;  <span class="keywordflow">if</span> (F.BaseGV) {</div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;    <span class="comment">// Flush the operand list to suppress SCEVExpander hoisting.</span></div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;    <span class="keywordflow">if</span> (!Ops.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *FullV = Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#a583d3ca95f83216d632a4d1ae0330dd0">expandCodeFor</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(Ops), Ty, IP);</div><div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;      Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;      Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad8e4f5b2ced08ad7d138b598aefdd338">getUnknown</a>(FullV));</div><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;    }</div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;    Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad8e4f5b2ced08ad7d138b598aefdd338">getUnknown</a>(F.BaseGV));</div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;  }</div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;</div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;  <span class="comment">// Flush the operand list to suppress SCEVExpander hoisting of both folded and</span></div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;  <span class="comment">// unfolded offsets. LSR assumes they both live next to their uses.</span></div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;  <span class="keywordflow">if</span> (!Ops.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *FullV = Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#a583d3ca95f83216d632a4d1ae0330dd0">expandCodeFor</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(Ops), Ty, IP);</div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;    Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;    Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad8e4f5b2ced08ad7d138b598aefdd338">getUnknown</a>(FullV));</div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;  }</div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;</div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;  <span class="comment">// Expand the immediate portion.</span></div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;  int64_t Offset = (uint64_t)F.BaseOffset + LF.Offset;</div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;  <a class="code" href="LLParser_8cpp.html#aae58e3df0180401e8f3ab75c18fbc07a">if</a> (Offset != 0) {</div><div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;    <span class="keywordflow">if</span> (LU.Kind == LSRUse::ICmpZero) {</div><div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;      <span class="comment">// The other interesting way of &quot;folding&quot; with an ICmpZero is to use a</span></div><div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;      <span class="comment">// negated immediate.</span></div><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;      <span class="keywordflow">if</span> (!ICmpScaledV)</div><div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;        ICmpScaledV = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(IntTy, -(uint64_t)Offset);</div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;        Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad8e4f5b2ced08ad7d138b598aefdd338">getUnknown</a>(ICmpScaledV));</div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;        ICmpScaledV = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(IntTy, Offset);</div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;      }</div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;      <span class="comment">// Just add the immediate values. These again are expected to be matched</span></div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;      <span class="comment">// as part of the address.</span></div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;      Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad8e4f5b2ced08ad7d138b598aefdd338">getUnknown</a>(<a class="code" href="classllvm_1_1ConstantInt.html#ad736fb9b585509388546c12617def38f">ConstantInt::getSigned</a>(IntTy, Offset)));</div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;    }</div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;  }</div><div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;</div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;  <span class="comment">// Expand the unfolded offset portion.</span></div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;  int64_t UnfoldedOffset = F.UnfoldedOffset;</div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;  <span class="keywordflow">if</span> (UnfoldedOffset != 0) {</div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;    <span class="comment">// Just add the immediate values.</span></div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;    Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#ad8e4f5b2ced08ad7d138b598aefdd338">getUnknown</a>(<a class="code" href="classllvm_1_1ConstantInt.html#ad736fb9b585509388546c12617def38f">ConstantInt::getSigned</a>(IntTy,</div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;                                                       UnfoldedOffset)));</div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;  }</div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;</div><div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;  <span class="comment">// Emit instructions summing all the operands.</span></div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SCEV.html">SCEV</a> *FullS = Ops.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>() ?</div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;                      SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(IntTy, 0) :</div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;                      SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">getAddExpr</a>(Ops);</div><div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *FullV = Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#a583d3ca95f83216d632a4d1ae0330dd0">expandCodeFor</a>(FullS, Ty, IP);</div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;</div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;  <span class="comment">// We&#39;re done expanding now, so reset the rewriter.</span></div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;  Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#a767b257cc39ee9ea9e0edcee4220c00c">clearPostInc</a>();</div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;</div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;  <span class="comment">// An ICmpZero Formula represents an ICmp which we&#39;re handling as a</span></div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;  <span class="comment">// comparison against zero. Now that we&#39;ve expanded an expression for that</span></div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;  <span class="comment">// form, update the ICmp&#39;s other operand.</span></div><div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;  <span class="keywordflow">if</span> (LU.Kind == LSRUse::ICmpZero) {</div><div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;    <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *CI = cast&lt;ICmpInst&gt;(LF.UserInst);</div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;    DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(CI-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1));</div><div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;    assert(!F.BaseGV &amp;&amp; <span class="stringliteral">&quot;ICmp does not support folding a global value and &quot;</span></div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;                           <span class="stringliteral">&quot;a scale at the same time!&quot;</span>);</div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;    <span class="keywordflow">if</span> (F.Scale == -1) {</div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;      <span class="keywordflow">if</span> (ICmpScaledV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() != OpTy) {</div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Cast =</div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;          <a class="code" href="classllvm_1_1CastInst.html#a0f7dea9550778374905e12da6d6ba8a8">CastInst::Create</a>(<a class="code" href="classllvm_1_1CastInst.html#a06dc25da1f16f389f5244304e8d33127">CastInst::getCastOpcode</a>(ICmpScaledV, <span class="keyword">false</span>,</div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;                                                   OpTy, <span class="keyword">false</span>),</div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;                           ICmpScaledV, OpTy, <span class="stringliteral">&quot;tmp&quot;</span>, CI);</div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;        ICmpScaledV = Cast;</div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;      }</div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;      CI-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, ICmpScaledV);</div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;      assert(F.Scale == 0 &amp;&amp;</div><div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;             <span class="stringliteral">&quot;ICmp does not support folding a global value and &quot;</span></div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;             <span class="stringliteral">&quot;a scale at the same time!&quot;</span>);</div><div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = <a class="code" href="classllvm_1_1ConstantInt.html#ad736fb9b585509388546c12617def38f">ConstantInt::getSigned</a>(SE.<a class="code" href="classllvm_1_1ScalarEvolution.html#abb976145b00ae108c1d6b98c4f099d27">getEffectiveSCEVType</a>(OpTy),</div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;                                           -(uint64_t)Offset);</div><div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;      <span class="keywordflow">if</span> (C-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() != OpTy)</div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;        C = <a class="code" href="classllvm_1_1ConstantExpr.html#a1e1ce75d651c76b6869b4218e34618c8">ConstantExpr::getCast</a>(<a class="code" href="classllvm_1_1CastInst.html#a06dc25da1f16f389f5244304e8d33127">CastInst::getCastOpcode</a>(C, <span class="keyword">false</span>,</div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;                                                          OpTy, <span class="keyword">false</span>),</div><div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;                                  <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>, OpTy);</div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;</div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;      CI-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, C);</div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;    }</div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;  }</div><div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;</div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;  <span class="keywordflow">return</span> FullV;</div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;}</div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;<span class="comment">/// RewriteForPHI - Helper for Rewrite. PHI nodes are special because the use</span></div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;<span class="comment">/// of their operands effectively happens in their predecessor blocks, so the</span></div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;<span class="comment">/// expression may need to be expanded in multiple places.</span></div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::RewriteForPHI(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN,</div><div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;                                <span class="keyword">const</span> LSRFixup &amp;LF,</div><div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;                                <span class="keyword">const</span> Formula &amp;F,</div><div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;                                <a class="code" href="classllvm_1_1SCEVExpander.html">SCEVExpander</a> &amp;Rewriter,</div><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;                                <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;WeakVH&gt;</a> &amp;DeadInsts,</div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;                                <a class="code" href="classllvm_1_1Pass.html">Pass</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>)<span class="keyword"> const </span>{</div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;BasicBlock *, Value *&gt;</a> Inserted;</div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0, e = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;    <span class="keywordflow">if</span> (PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(i) == LF.OperandValToReplace) {</div><div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(i);</div><div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;</div><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;      <span class="comment">// If this is a critical edge, split the edge so that we do not insert</span></div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;      <span class="comment">// the code on all predecessor/successor paths.  We do this unless this</span></div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;      <span class="comment">// is the canonical backedge for this loop, which complicates post-inc</span></div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;      <span class="comment">// users.</span></div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;      <span class="keywordflow">if</span> (e != 1 &amp;&amp; BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>()-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a4c26d3b92af99a6c8defd89a2d39ca32">getNumSuccessors</a>() &gt; 1 &amp;&amp;</div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;          !isa&lt;IndirectBrInst&gt;(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>())) {</div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;        <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Parent = PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;        <a class="code" href="classllvm_1_1Loop.html">Loop</a> *PNLoop = LI.getLoopFor(Parent);</div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;        <span class="keywordflow">if</span> (!PNLoop || Parent != PNLoop-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>()) {</div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;          <span class="comment">// Split the critical edge.</span></div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;          <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NewBB = 0;</div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;          <span class="keywordflow">if</span> (!Parent-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a3075a9eef753018bed561df31f38dc23">isLandingPad</a>()) {</div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;            NewBB = <a class="code" href="namespacellvm.html#afa6abaa0eea3b2083902cf651a9653b1">SplitCriticalEdge</a>(BB, Parent, P,</div><div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;                                      <span class="comment">/*MergeIdenticalEdges=*/</span><span class="keyword">true</span>,</div><div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;                                      <span class="comment">/*DontDeleteUselessPhis=*/</span><span class="keyword">true</span>);</div><div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;            <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock*, 2&gt;</a> NewBBs;</div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;            <a class="code" href="namespacellvm.html#a02c38c380d809959819ff729cc158cee">SplitLandingPadPredecessors</a>(Parent, BB, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, P, NewBBs);</div><div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;            NewBB = NewBBs[0];</div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;          }</div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;          <span class="comment">// If NewBB==NULL, then SplitCriticalEdge refused to split because all</span></div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;          <span class="comment">// phi predecessors are identical. The simple thing to do is skip</span></div><div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;          <span class="comment">// splitting in this case rather than complicate the API.</span></div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;          <span class="keywordflow">if</span> (NewBB) {</div><div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;            <span class="comment">// If PN is outside of the loop and BB is in the loop, we want to</span></div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;            <span class="comment">// move the block to be immediately before the PHI block, not</span></div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;            <span class="comment">// immediately after BB.</span></div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;            <span class="keywordflow">if</span> (L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a92a38e2e3412bde7fd2b71db212b61aa">contains</a>(BB) &amp;&amp; !L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a92a38e2e3412bde7fd2b71db212b61aa">contains</a>(PN))</div><div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;              NewBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a41da369a9d31d911c8af724d5630f724">moveBefore</a>(PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;</div><div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;            <span class="comment">// Splitting the edge can reduce the number of PHI entries we have.</span></div><div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;            e = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>();</div><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;            BB = NewBB;</div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;            i = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a5c2b7d7f19aac93b27b845858a7eb73e">getBasicBlockIndex</a>(BB);</div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;          }</div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;        }</div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;      }</div><div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;</div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;      std::pair&lt;DenseMap&lt;BasicBlock *, Value *&gt;::iterator, <span class="keywordtype">bool</span>&gt; Pair =</div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;        Inserted.<a class="code" href="classllvm_1_1DenseMapBase.html#a699a66e504b48fdeff124e82f6c61917">insert</a>(std::make_pair(BB, static_cast&lt;Value *&gt;(0)));</div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;      <span class="keywordflow">if</span> (!Pair.second)</div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;        PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(i, Pair.first-&gt;second);</div><div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *FullV = Expand(LF, F, BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>(), <a class="code" href="VirtRegMap_8cpp.html#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>, DeadInsts);</div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;</div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;        <span class="comment">// If this is reuse-by-noop-cast, insert the noop cast.</span></div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *OpTy = LF.OperandValToReplace-&gt;getType();</div><div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;        <span class="keywordflow">if</span> (FullV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() != OpTy)</div><div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;          FullV =</div><div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;            <a class="code" href="classllvm_1_1CastInst.html#a0f7dea9550778374905e12da6d6ba8a8">CastInst::Create</a>(<a class="code" href="classllvm_1_1CastInst.html#a06dc25da1f16f389f5244304e8d33127">CastInst::getCastOpcode</a>(FullV, <span class="keyword">false</span>,</div><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;                                                     OpTy, <span class="keyword">false</span>),</div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;                             FullV, LF.OperandValToReplace-&gt;getType(),</div><div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;                             <span class="stringliteral">&quot;tmp&quot;</span>, BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;</div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;        PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(i, FullV);</div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;        Pair.first-&gt;second = FullV;</div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;      }</div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;    }</div><div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;}</div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;<span class="comment">/// Rewrite - Emit instructions for the leading candidate expression for this</span></div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;<span class="comment">/// LSRUse (this is called &quot;expanding&quot;), and update the UserInst to reference</span></div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;<span class="comment">/// the newly expanded value.</span></div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> LSRInstance::Rewrite(<span class="keyword">const</span> LSRFixup &amp;LF,</div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;                          <span class="keyword">const</span> Formula &amp;F,</div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;                          <a class="code" href="classllvm_1_1SCEVExpander.html">SCEVExpander</a> &amp;Rewriter,</div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;                          <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;WeakVH&gt;</a> &amp;DeadInsts,</div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;                          <a class="code" href="classllvm_1_1Pass.html">Pass</a> *P)<span class="keyword"> const </span>{</div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;  <span class="comment">// First, find an insertion point that dominates UserInst. For PHI nodes,</span></div><div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;  <span class="comment">// find the nearest block which dominates all the relevant uses.</span></div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(LF.UserInst)) {</div><div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;    RewriteForPHI(PN, LF, F, Rewriter, DeadInsts, P);</div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *FullV = Expand(LF, F, LF.UserInst, Rewriter, DeadInsts);</div><div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;</div><div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;    <span class="comment">// If this is reuse-by-noop-cast, insert the noop cast.</span></div><div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *OpTy = LF.OperandValToReplace-&gt;getType();</div><div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;    <span class="keywordflow">if</span> (FullV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() != OpTy) {</div><div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Cast =</div><div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;        <a class="code" href="classllvm_1_1CastInst.html#a0f7dea9550778374905e12da6d6ba8a8">CastInst::Create</a>(<a class="code" href="classllvm_1_1CastInst.html#a06dc25da1f16f389f5244304e8d33127">CastInst::getCastOpcode</a>(FullV, <span class="keyword">false</span>, OpTy, <span class="keyword">false</span>),</div><div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;                         FullV, OpTy, <span class="stringliteral">&quot;tmp&quot;</span>, LF.UserInst);</div><div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;      FullV = Cast;</div><div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;    }</div><div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;</div><div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;    <span class="comment">// Update the user. ICmpZero is handled specially here (for now) because</span></div><div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;    <span class="comment">// Expand may have updated one of the operands of the icmp already, and</span></div><div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;    <span class="comment">// its new value may happen to be equal to LF.OperandValToReplace, in</span></div><div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;    <span class="comment">// which case doing replaceUsesOfWith leads to replacing both operands</span></div><div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;    <span class="comment">// with the same value. TODO: Reorganize this.</span></div><div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;    <span class="keywordflow">if</span> (Uses[LF.LUIdx].Kind == LSRUse::ICmpZero)</div><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;      LF.UserInst-&gt;setOperand(0, FullV);</div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;      LF.UserInst-&gt;replaceUsesOfWith(LF.OperandValToReplace, FullV);</div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;  }</div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;</div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;  DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(LF.OperandValToReplace);</div><div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;}</div><div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;<span class="comment">/// ImplementSolution - Rewrite all the fixup locations with new values,</span></div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;<span class="comment">/// following the chosen solution.</span></div><div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;<span class="comment"></span><span class="keywordtype">void</span></div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;LSRInstance::ImplementSolution(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;const Formula *&gt;</a> &amp;Solution,</div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;                               <a class="code" href="classllvm_1_1Pass.html">Pass</a> *P) {</div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;  <span class="comment">// Keep track of instructions we may have made dead, so that</span></div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;  <span class="comment">// we can remove them after we are done working.</span></div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;WeakVH, 16&gt;</a> DeadInsts;</div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;</div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;  <a class="code" href="classllvm_1_1SCEVExpander.html">SCEVExpander</a> <a class="code" href="VirtRegMap_8cpp.html#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>(SE, <span class="stringliteral">&quot;lsr&quot;</span>);</div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;  Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#ac3ae3288532d1f9b8b5f4a1445b58697">setDebugType</a>(<a class="code" href="LoopStrengthReduce_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>);</div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;  Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#acfd53cb9ef34b9c9d9428fdaf08e0f0b">disableCanonicalMode</a>();</div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;  Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#a546c51290ce25125f40293fb4ebc1919">enableLSRMode</a>();</div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;  Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#abb16499dadbe473c428b55f72850ef97">setIVIncInsertPos</a>(L, IVIncInsertPos);</div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;</div><div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;  <span class="comment">// Mark phi nodes that terminate chains so the expander tries to reuse them.</span></div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;IVChain&gt;::const_iterator</a> ChainI = IVChainVec.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;         ChainE = IVChainVec.end(); ChainI != ChainE; ++ChainI) {</div><div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(ChainI-&gt;tailUserInst()))</div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;      Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#a346ef44d7050fbf42b5d871ba5006b80">setChainedPhi</a>(PN);</div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;  }</div><div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;</div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;  <span class="comment">// Expand the new value definitions and update the users.</span></div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;LSRFixup&gt;::const_iterator</a> I = <a class="code" href="namespacellvm_1_1AArch64.html#a5c816ea23ece51a78a235f57ffb177a9">Fixups</a>.begin(),</div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;       E = <a class="code" href="namespacellvm_1_1AArch64.html#a5c816ea23ece51a78a235f57ffb177a9">Fixups</a>.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;    <span class="keyword">const</span> LSRFixup &amp;Fixup = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;</div><div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;    Rewrite(Fixup, *Solution[Fixup.LUIdx], Rewriter, DeadInsts, P);</div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;</div><div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;  }</div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;</div><div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;IVChain&gt;::const_iterator</a> ChainI = IVChainVec.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;         ChainE = IVChainVec.end(); ChainI != ChainE; ++ChainI) {</div><div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;    GenerateIVChain(*ChainI, Rewriter, DeadInsts);</div><div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;  }</div><div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;  <span class="comment">// Clean up after ourselves. This must be done before deleting any</span></div><div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;  <span class="comment">// instructions.</span></div><div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;  Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#aa9bcc84c7b023d3b1321851509110dae">clear</a>();</div><div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;</div><div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;  Changed |= <a class="code" href="LoopStrengthReduce_8cpp.html#afc5995e3a119d2cf2da1c4707890d1f3">DeleteTriviallyDeadInstructions</a>(DeadInsts);</div><div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;}</div><div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;</div><div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;LSRInstance::LSRInstance(<a class="code" href="classllvm_1_1Loop.html">Loop</a> *L, <a class="code" href="classllvm_1_1Pass.html">Pass</a> *P)</div><div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;    : IU(P-&gt;<a class="code" href="classllvm_1_1Pass.html#ab78af013d3a11515403da8517f8f3d4a">getAnalysis</a>&lt;<a class="code" href="classllvm_1_1IVUsers.html">IVUsers</a>&gt;()), SE(P-&gt;<a class="code" href="classllvm_1_1Pass.html#ab78af013d3a11515403da8517f8f3d4a">getAnalysis</a>&lt;<a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a>&gt;()),</div><div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;      DT(P-&gt;<a class="code" href="classllvm_1_1Pass.html#ab78af013d3a11515403da8517f8f3d4a">getAnalysis</a>&lt;<a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a>&gt;()), LI(P-&gt;<a class="code" href="classllvm_1_1Pass.html#ab78af013d3a11515403da8517f8f3d4a">getAnalysis</a>&lt;<a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a>&gt;()),</div><div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;      TTI(P-&gt;<a class="code" href="classllvm_1_1Pass.html#ab78af013d3a11515403da8517f8f3d4a">getAnalysis</a>&lt;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a>&gt;()), L(L), Changed(<span class="keyword">false</span>),</div><div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;      IVIncInsertPos(0) {</div><div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;  <span class="comment">// If LoopSimplify form is not available, stay out of trouble.</span></div><div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;  <span class="keywordflow">if</span> (!L-&gt;<a class="code" href="classllvm_1_1Loop.html#a1d4445ebce66137e57fbaa967a19d7e9">isLoopSimplifyForm</a>())</div><div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;</div><div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;  <span class="comment">// If there&#39;s no interesting work to be done, bail early.</span></div><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;  <span class="keywordflow">if</span> (IU.empty()) <span class="keywordflow">return</span>;</div><div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;</div><div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;  <span class="comment">// If there&#39;s too much analysis to be done, bail early. We won&#39;t be able to</span></div><div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;  <span class="comment">// model the problem anyway.</span></div><div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;  <span class="keywordtype">unsigned</span> NumUsers = 0;</div><div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">IVUsers::const_iterator</a> UI = IU.begin(), E = IU.end(); UI != E; ++UI) {</div><div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;    <span class="keywordflow">if</span> (++NumUsers &gt; <a class="code" href="LoopStrengthReduce_8cpp.html#a73b3c5e7c72bf97886e2ed1f12e28d54">MaxIVUsers</a>) {</div><div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;LSR skipping loop, too many IV Users in &quot;</span> &lt;&lt; *L</div><div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;    }</div><div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;  }</div><div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;</div><div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;  <span class="comment">// All dominating loops must have preheaders, or SCEVExpander may not be able</span></div><div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;  <span class="comment">// to materialize an AddRecExpr whose Start is an outer AddRecExpr.</span></div><div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;  <span class="comment">// IVUsers analysis should only create users that are dominated by simple loop</span></div><div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;  <span class="comment">// headers. Since this loop should dominate all of its users, its user list</span></div><div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;  <span class="comment">// should be empty if this loop itself is not within a simple loop nest.</span></div><div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNode</a> *Rung = DT.<a class="code" href="classllvm_1_1DominatorTree.html#a307665a69dff132a967d4f0d2acd3791">getNode</a>(L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a1bc74c76b876ad387293ecde0f21ed45">getLoopPreheader</a>());</div><div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;       Rung; Rung = Rung-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a7519f9ffdda3ef1147e2563200587193">getIDom</a>()) {</div><div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = Rung-&gt;getBlock();</div><div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1Loop.html">Loop</a> *DomLoop = LI.getLoopFor(BB);</div><div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;    <span class="keywordflow">if</span> (DomLoop &amp;&amp; DomLoop-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>() == <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;      assert(DomLoop-&gt;<a class="code" href="classllvm_1_1LoopBase.html#a1bc74c76b876ad387293ecde0f21ed45">getLoopPreheader</a>() &amp;&amp; <span class="stringliteral">&quot;LSR needs a simplified loop nest&quot;</span>);</div><div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;    }</div><div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;  }</div><div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;<span class="preprocessor">#endif // DEBUG</span></div><div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;</div><div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\nLSR on loop &quot;</span>;</div><div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;        <a class="code" href="namespacellvm.html#ae712552495c21ee77ad82ced255ad6df">WriteAsOperand</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>(), <span class="comment">/*PrintType=*/</span><span class="keyword">false</span>);</div><div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;        <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;:\n&quot;</span>);</div><div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;</div><div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;  <span class="comment">// First, perform some low-level loop optimizations.</span></div><div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;  OptimizeShadowIV();</div><div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;  OptimizeLoopTermCond();</div><div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;</div><div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;  <span class="comment">// If loop preparation eliminates all interesting IV users, bail.</span></div><div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;  <span class="keywordflow">if</span> (IU.empty()) <span class="keywordflow">return</span>;</div><div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;</div><div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;  <span class="comment">// Skip nested loops until we can model them better with formulae.</span></div><div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;  <span class="keywordflow">if</span> (!L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ab191396dd1d8556d8e0a057f7fd2aaab">empty</a>()) {</div><div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;LSR skipping outer loop &quot;</span> &lt;&lt; *L &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;  }</div><div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;</div><div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;  <span class="comment">// Start collecting data and preparing for the solver.</span></div><div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;  CollectChains();</div><div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;  CollectInterestingTypesAndFactors();</div><div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;  CollectFixupsAndInitialFormulae();</div><div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;  CollectLoopInvariantFixupsAndFormulae();</div><div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;</div><div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;  assert(!Uses.empty() &amp;&amp; <span class="stringliteral">&quot;IVUsers reported at least one use&quot;</span>);</div><div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;LSR found &quot;</span> &lt;&lt; Uses.size() &lt;&lt; <span class="stringliteral">&quot; uses:\n&quot;</span>;</div><div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;        print_uses(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</div><div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;</div><div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;  <span class="comment">// Now use the reuse data to generate a bunch of interesting ways</span></div><div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;  <span class="comment">// to formulate the values needed for the uses.</span></div><div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;  GenerateAllReuseFormulae();</div><div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;</div><div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;  FilterOutUndesirableDedicatedRegisters();</div><div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;  NarrowSearchSpaceUsingHeuristics();</div><div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;</div><div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const Formula *, 8&gt;</a> Solution;</div><div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;  Solve(Solution);</div><div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;</div><div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;  <span class="comment">// Release memory that is no longer needed.</span></div><div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;  Factors.clear();</div><div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;  Types.clear();</div><div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;  RegUses.clear();</div><div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;</div><div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;  <span class="keywordflow">if</span> (Solution.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>())</div><div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;</div><div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;  <span class="comment">// Formulae should be legal.</span></div><div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;LSRUse&gt;::const_iterator</a> I = Uses.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), E = Uses.end();</div><div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;       I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;    <span class="keyword">const</span> LSRUse &amp;LU = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Formula&gt;::const_iterator</a> J = LU.Formulae.begin(),</div><div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;                                                  JE = LU.Formulae.end();</div><div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;         J != JE; ++J)</div><div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;      assert(<a class="code" href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a>(TTI, LU.MinOffset, LU.MaxOffset, LU.Kind, LU.AccessTy,</div><div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;                        *J) &amp;&amp; <span class="stringliteral">&quot;Illegal formula generated!&quot;</span>);</div><div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;  };</div><div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;</div><div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;  <span class="comment">// Now that we&#39;ve decided what we want, make it so.</span></div><div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;  ImplementSolution(Solution, P);</div><div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;}</div><div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;</div><div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;<span class="keywordtype">void</span> LSRInstance::print_factors_and_types(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS)<span class="keyword"> const </span>{</div><div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;  <span class="keywordflow">if</span> (Factors.empty() &amp;&amp; Types.empty()) <span class="keywordflow">return</span>;</div><div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;</div><div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;  OS &lt;&lt; <span class="stringliteral">&quot;LSR has identified the following interesting factors and types: &quot;</span>;</div><div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="Target_2README_8txt.html#ab24db72f7bd10b13351812874015861b">First</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;</div><div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;int64_t, 8&gt;::const_iterator</a></div><div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;       I = Factors.<a class="code" href="classllvm_1_1SetVector.html#adb13793b98ab59209a5309d26f831850">begin</a>(), E = Factors.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;    <span class="keywordflow">if</span> (!First) OS &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;    First = <span class="keyword">false</span>;</div><div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;    OS &lt;&lt; <span class="charliteral">&#39;*&#39;</span> &lt;&lt; *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;  }</div><div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;</div><div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallSetVector.html">SmallSetVector&lt;Type *, 4&gt;::const_iterator</a></div><div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;       I = Types.<a class="code" href="classllvm_1_1SetVector.html#adb13793b98ab59209a5309d26f831850">begin</a>(), E = Types.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;    <span class="keywordflow">if</span> (!First) OS &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;</div><div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;    First = <span class="keyword">false</span>;</div><div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;    OS &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; **I &lt;&lt; <span class="charliteral">&#39;)&#39;</span>;</div><div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;  }</div><div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;  OS &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;}</div><div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;</div><div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;<span class="keywordtype">void</span> LSRInstance::print_fixups(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS)<span class="keyword"> const </span>{</div><div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;  OS &lt;&lt; <span class="stringliteral">&quot;LSR is examining the following fixup sites:\n&quot;</span>;</div><div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;LSRFixup&gt;::const_iterator</a> I = <a class="code" href="namespacellvm_1_1AArch64.html#a5c816ea23ece51a78a235f57ffb177a9">Fixups</a>.begin(),</div><div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;       E = <a class="code" href="namespacellvm_1_1AArch64.html#a5c816ea23ece51a78a235f57ffb177a9">Fixups</a>.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  &quot;</span>;</div><div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;    I-&gt;print(OS);</div><div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;    OS &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;  }</div><div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;}</div><div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;</div><div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;<span class="keywordtype">void</span> LSRInstance::print_uses(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS)<span class="keyword"> const </span>{</div><div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;  OS &lt;&lt; <span class="stringliteral">&quot;LSR is examining the following uses:\n&quot;</span>;</div><div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;LSRUse&gt;::const_iterator</a> I = Uses.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;       E = Uses.end(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;    <span class="keyword">const</span> LSRUse &amp;LU = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  &quot;</span>;</div><div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;    LU.print(OS);</div><div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;    OS &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Formula&gt;::const_iterator</a> J = LU.Formulae.begin(),</div><div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;         JE = LU.Formulae.end(); J != JE; ++J) {</div><div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;      OS &lt;&lt; <span class="stringliteral">&quot;    &quot;</span>;</div><div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;      J-&gt;print(OS);</div><div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;      OS &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;    }</div><div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;  }</div><div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;}</div><div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;</div><div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;<span class="keywordtype">void</span> LSRInstance::print(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS)<span class="keyword"> const </span>{</div><div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;  print_factors_and_types(OS);</div><div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;  print_fixups(OS);</div><div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;  print_uses(OS);</div><div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;}</div><div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;</div><div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;<span class="preprocessor">#if !defined(NDEBUG) || defined(LLVM_ENABLE_DUMP)</span></div><div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">LSRInstance::dump</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;  print(<a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>()); <a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;}</div><div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;</div><div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;</div><div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;<span class="keyword">class </span>LoopStrengthReduce : <span class="keyword">public</span> <a class="code" href="classllvm_1_1LoopPass.html">LoopPass</a> {</div><div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a>; <span class="comment">// Pass ID, replacement for typeid</span></div><div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;  LoopStrengthReduce();</div><div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;</div><div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;  <span class="keywordtype">bool</span> runOnLoop(<a class="code" href="classllvm_1_1Loop.html">Loop</a> *L, <a class="code" href="classllvm_1_1LPPassManager.html">LPPassManager</a> &amp;LPM);</div><div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;  <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU) <span class="keyword">const</span>;</div><div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;};</div><div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;</div><div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;}</div><div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;</div><div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">LoopStrengthReduce::ID</a> = 0;</div><div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;<a class="code" href="LoopStrengthReduce_8cpp.html#aa226dcb218003bb80a72a75e27aa0ff3">INITIALIZE_PASS_BEGIN</a>(LoopStrengthReduce, <span class="stringliteral">&quot;loop-reduce&quot;</span>,</div><div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;                <span class="stringliteral">&quot;Loop Strength Reduction&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div><div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;<a class="code" href="PassSupport_8h.html#af0564bcdde2dd4400c670ca278c6035f">INITIALIZE_AG_DEPENDENCY</a>(<a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a>)</div><div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;<a class="code" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a>)</div><div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;<a class="code" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a>)</div><div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;<a class="code" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1IVUsers.html">IVUsers</a>)</div><div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;<a class="code" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a>)</div><div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;<a class="code" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(LoopSimplify)</div><div class="line"><a name="l04882"></a><span class="lineno"><a class="line" href="LoopStrengthReduce_8cpp.html#a175f1f53cc9c3619505ffbd13aca087f"> 4882</a></span>&#160;<a class="code" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(LoopStrengthReduce, &quot;<a class="code" href="Analysis_2README_8txt.html#a01d2af4eee7c40485a0ce3683a2e907a">loop</a>-<a class="code" href="LoopStrengthReduce_8cpp.html#a6d827fc34f1b4371a0b7183d3ca5bcac">reduce</a>&quot;,</div><div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;                &quot;<a class="code" href="classllvm_1_1Loop.html">Loop</a> Strength <a class="code" href="LoopStrengthReduce_8cpp.html#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>&quot;, <a class="code" href="namespacefalse.html">false</a>, false)</div><div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;</div><div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;</div><div class="line"><a name="l04886"></a><span class="lineno"><a class="line" href="namespacellvm.html#ab5e38bfb20e37867b8f1c51c75a38a0a"> 4886</a></span>&#160;<a class="code" href="classllvm_1_1Pass.html">Pass</a> *<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="namespacellvm.html#ab5e38bfb20e37867b8f1c51c75a38a0a">createLoopStrengthReducePass</a>() {</div><div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> LoopStrengthReduce();</div><div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;}</div><div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;</div><div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;LoopStrengthReduce::LoopStrengthReduce() : <a class="code" href="classllvm_1_1LoopPass.html">LoopPass</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a>) {</div><div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;  <a class="code" href="namespacellvm.html#ac36ebb7d8a9874254ba36df4f0cde8b3">initializeLoopStrengthReducePass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div><div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;}</div><div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;</div><div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;<span class="keywordtype">void</span> LoopStrengthReduce::getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const </span>{</div><div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;  <span class="comment">// We split critical edges, so we change the CFG.  However, we do update</span></div><div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;  <span class="comment">// many analyses if they are around.</span></div><div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#a40970e5d42646fb2d9aa5f7a2c879516">addPreservedID</a>(<a class="code" href="namespacellvm.html#a472515fc67a5fb572afeb00aa2609cca">LoopSimplifyID</a>);</div><div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;</div><div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a>&gt;();</div><div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#a884f90190bca4bd354f2d5c91c264028">addPreserved</a>&lt;<a class="code" href="classllvm_1_1LoopInfo.html">LoopInfo</a>&gt;();</div><div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#a053677ebc731b47a534f841b11b5cf0c">addRequiredID</a>(<a class="code" href="namespacellvm.html#a472515fc67a5fb572afeb00aa2609cca">LoopSimplifyID</a>);</div><div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a>&gt;();</div><div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#a884f90190bca4bd354f2d5c91c264028">addPreserved</a>&lt;<a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a>&gt;();</div><div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a>&gt;();</div><div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#a884f90190bca4bd354f2d5c91c264028">addPreserved</a>&lt;<a class="code" href="classllvm_1_1ScalarEvolution.html">ScalarEvolution</a>&gt;();</div><div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;  <span class="comment">// Requiring LoopSimplify a second time here prevents IVUsers from running</span></div><div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;  <span class="comment">// twice, since LoopSimplify was invalidated by running ScalarEvolution.</span></div><div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#a053677ebc731b47a534f841b11b5cf0c">addRequiredID</a>(<a class="code" href="namespacellvm.html#a472515fc67a5fb572afeb00aa2609cca">LoopSimplifyID</a>);</div><div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1IVUsers.html">IVUsers</a>&gt;();</div><div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#a884f90190bca4bd354f2d5c91c264028">addPreserved</a>&lt;<a class="code" href="classllvm_1_1IVUsers.html">IVUsers</a>&gt;();</div><div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a>&gt;();</div><div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;}</div><div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;</div><div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;<span class="keywordtype">bool</span> LoopStrengthReduce::runOnLoop(<a class="code" href="classllvm_1_1Loop.html">Loop</a> *L, <a class="code" href="classllvm_1_1LPPassManager.html">LPPassManager</a> &amp; <span class="comment">/*LPM*/</span>) {</div><div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;</div><div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;  <span class="comment">// Run the main LSR transformation.</span></div><div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;  Changed |= LSRInstance(L, <span class="keyword">this</span>).getChanged();</div><div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;</div><div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;  <span class="comment">// Remove any extra phis created by processing inner loops.</span></div><div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;  Changed |= <a class="code" href="namespacellvm.html#af44ceebb0726227cf82bd54a0bc286fa">DeleteDeadPHIs</a>(L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>());</div><div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="LoopStrengthReduce_8cpp.html#add283613989eaa5682d8f97d6b9a8fd4">EnablePhiElim</a> &amp;&amp; L-&gt;<a class="code" href="classllvm_1_1Loop.html#a1d4445ebce66137e57fbaa967a19d7e9">isLoopSimplifyForm</a>()) {</div><div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;WeakVH, 16&gt;</a> DeadInsts;</div><div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;    <a class="code" href="classllvm_1_1SCEVExpander.html">SCEVExpander</a> <a class="code" href="VirtRegMap_8cpp.html#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>(getAnalysis&lt;ScalarEvolution&gt;(), <span class="stringliteral">&quot;lsr&quot;</span>);</div><div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;    Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#ac3ae3288532d1f9b8b5f4a1445b58697">setDebugType</a>(<a class="code" href="LoopStrengthReduce_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>);</div><div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;    <span class="keywordtype">unsigned</span> numFolded =</div><div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;        Rewriter.<a class="code" href="classllvm_1_1SCEVExpander.html#ab35b69a7c369aadf7ac052ab21ad2ec6">replaceCongruentIVs</a>(L, &amp;getAnalysis&lt;DominatorTree&gt;(),</div><div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;                                     DeadInsts,</div><div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;                                     &amp;getAnalysis&lt;TargetTransformInfo&gt;());</div><div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;    <span class="keywordflow">if</span> (numFolded) {</div><div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;      <a class="code" href="LoopStrengthReduce_8cpp.html#afc5995e3a119d2cf2da1c4707890d1f3">DeleteTriviallyDeadInstructions</a>(DeadInsts);</div><div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;      <a class="code" href="namespacellvm.html#af44ceebb0726227cf82bd54a0bc286fa">DeleteDeadPHIs</a>(L-&gt;<a class="code" href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">getHeader</a>());</div><div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;    }</div><div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;  }</div><div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;}</div><div class="ttc" id="classllvm_1_1Pass_html"><div class="ttname"><a href="classllvm_1_1Pass.html">llvm::Pass</a></div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00082">Pass.h:82</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a075e34e98605d0e7c289763a104869ac"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">llvm::SmallVectorTemplateCommon&lt; T &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00114">SmallVector.h:114</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a22a311dfe4c28a897de8a9365a4f0a84"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">llvm::SmallVectorTemplateCommon&lt; T &gt;::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00127">SmallVector.h:127</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_ae1a10b90f22c0478960fb5798ff73916"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">llvm::SmallVectorTemplateBase&lt; T, isPodLike&lt; T &gt;::value &gt;::push_back</a></div><div class="ttdeci">void push_back(const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00236">SmallVector.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad86469939d2a8bdd4169be9403b89f5a"><div class="ttname"><a href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">llvm::Value::use_end</a></div><div class="ttdeci">use_iterator use_end()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00152">Value.h:152</a></div></div>
<div class="ttc" id="classllvm_1_1DominatorTree_html_a307665a69dff132a967d4f0d2acd3791"><div class="ttname"><a href="classllvm_1_1DominatorTree.html#a307665a69dff132a967d4f0d2acd3791">llvm::DominatorTree::getNode</a></div><div class="ttdeci">DomTreeNode * getNode(BasicBlock *BB) const </div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00844">Dominators.h:844</a></div></div>
<div class="ttc" id="namespacellvm_1_1sys_1_1path_html_a214ec2f04ffd92636ed4bd2717607a1d"><div class="ttname"><a href="namespacellvm_1_1sys_1_1path.html#a214ec2f04ffd92636ed4bd2717607a1d">llvm::sys::path::end</a></div><div class="ttdeci">const_iterator end(StringRef path)</div><div class="ttdoc">Get end iterator over path. </div><div class="ttdef"><b>Definition:</b> <a href="Path_8cpp_source.html#l00181">Path.cpp:181</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARM__PROC_html_aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5"><div class="ttname"><a href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">llvm::ARM_PROC::A</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInfo_8h_source.html#l00098">ARMBaseInfo.h:98</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html_a884f90190bca4bd354f2d5c91c264028"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#a884f90190bca4bd354f2d5c91c264028">llvm::AnalysisUsage::addPreserved</a></div><div class="ttdeci">AnalysisUsage &amp; addPreserved()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00081">PassAnalysisSupport.h:81</a></div></div>
<div class="ttc" id="namespacellvm_html_ab8e34eca3b0817ef7a127913fbf6d9e4"><div class="ttname"><a href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">llvm::errs</a></div><div class="ttdeci">raw_ostream &amp; errs()</div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8cpp_source.html#l00664">raw_ostream.cpp:664</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588">llvm::A64CC::LE</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00044">AArch64BaseInfo.h:44</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a4786e64977a3af38f29adee46b70a863"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a4786e64977a3af38f29adee46b70a863">llvm::SmallVectorImpl::reserve</a></div><div class="ttdeci">void reserve(unsigned N)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00425">SmallVector.h:425</a></div></div>
<div class="ttc" id="classllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00035">PassRegistry.cpp:35</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a6fe2f06b8a4b2c3d6308afb223a0238a"><div class="ttname"><a href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">llvm::Instruction::eraseFromParent</a></div><div class="ttdeci">void eraseFromParent()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00072">Instruction.cpp:72</a></div></div>
<div class="ttc" id="namespacellvm_html_adfac6898b7e6f186616ff5c337670296"><div class="ttname"><a href="namespacellvm.html#adfac6898b7e6f186616ff5c337670296">llvm::TransformForPostIncUse</a></div><div class="ttdeci">const SCEV * TransformForPostIncUse(TransformKind Kind, const SCEV *S, Instruction *User, Value *OperandValToReplace, PostIncLoopSet &amp;Loops, ScalarEvolution &amp;SE, DominatorTree &amp;DT)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionNormalization_8cpp_source.html#l00222">ScalarEvolutionNormalization.cpp:222</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilderBase_html_a571ae7ebae7038da7f6073efc65aaa50"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a571ae7ebae7038da7f6073efc65aaa50">llvm::IRBuilderBase::SetCurrentDebugLocation</a></div><div class="ttdeci">void SetCurrentDebugLocation(const DebugLoc &amp;L)</div><div class="ttdoc">Set location information used by debugging information. </div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00118">IRBuilder.h:118</a></div></div>
<div class="ttc" id="Instructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a3c81223cabf643af27adba3b3ceb680c"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a3c81223cabf643af27adba3b3ceb680c">isExistingPhi</a></div><div class="ttdeci">static bool isExistingPhi(const SCEVAddRecExpr *AR, ScalarEvolution &amp;SE)</div><div class="ttdoc">isExistingPhi - Return true if this AddRec is already a phi in its loop. </div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l00664">LoopStrengthReduce.cpp:664</a></div></div>
<div class="ttc" id="namespacellvm_html_ab5e38bfb20e37867b8f1c51c75a38a0a"><div class="ttname"><a href="namespacellvm.html#ab5e38bfb20e37867b8f1c51c75a38a0a">llvm::createLoopStrengthReducePass</a></div><div class="ttdeci">Pass * createLoopStrengthReducePass()</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l04886">LoopStrengthReduce.cpp:4886</a></div></div>
<div class="ttc" id="classllvm_1_1SmallBitVector_html"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html">llvm::SmallBitVector</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00031">SmallBitVector.h:31</a></div></div>
<div class="ttc" id="namespacellvm_1_1AArch64_html_a5c816ea23ece51a78a235f57ffb177a9"><div class="ttname"><a href="namespacellvm_1_1AArch64.html#a5c816ea23ece51a78a235f57ffb177a9">llvm::AArch64::Fixups</a></div><div class="ttdeci">Fixups</div><div class="ttdef"><b>Definition:</b> <a href="AArch64FixupKinds_8h_source.html#l00022">AArch64FixupKinds.h:22</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_a2eb94d079d8416118f4aaed865ab05d7"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#a2eb94d079d8416118f4aaed865ab05d7">llvm::ScalarEvolution::getConstant</a></div><div class="ttdeci">const SCEV * getConstant(ConstantInt *V)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l00314">ScalarEvolution.cpp:314</a></div></div>
<div class="ttc" id="namespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">List of target independent CodeGen pass IDs. </div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l00022">APFloat.h:22</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a0555f297eceee28e5fc20d282dfeb8f4"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a0555f297eceee28e5fc20d282dfeb8f4">llvm::A64CC::NE</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00032">AArch64BaseInfo.h:32</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a8b0b263234c6ada5f5fb0d2ccfeaff9d"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a8b0b263234c6ada5f5fb0d2ccfeaff9d">isLegalUse</a></div><div class="ttdeci">static bool isLegalUse(const TargetTransformInfo &amp;TTI, LSRUse::KindType Kind, Type *AccessTy, GlobalValue *BaseGV, int64_t BaseOffset, bool HasBaseReg, int64_t Scale)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l01319">LoopStrengthReduce.cpp:1319</a></div></div>
<div class="ttc" id="namespacellvm_html_a7ef747666d6938cb47b3c5544011a4e5ad05711646a19cb20775cfbc8ef0a8c09"><div class="ttname"><a href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5ad05711646a19cb20775cfbc8ef0a8c09">llvm::scSignExtend</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00029">ScalarEvolutionExpressions.h:29</a></div></div>
<div class="ttc" id="DerivedTypes_8h_html"><div class="ttname"><a href="DerivedTypes_8h.html">DerivedTypes.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1LibFunc_html_abf8f6830387f338fed0bce2e65108c6fac7d965d1f23189a93f8a5a4aed5bf161"><div class="ttname"><a href="namespacellvm_1_1LibFunc.html#abf8f6830387f338fed0bce2e65108c6fac7d965d1f23189a93f8a5a4aed5bf161">llvm::LibFunc::abs</a></div><div class="ttdoc">int abs(int j); </div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8h_source.html#l00089">TargetLibraryInfo.h:89</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_aa89f44fd7549e81b02f2be1be894f098"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#aa89f44fd7549e81b02f2be1be894f098">llvm::ScalarEvolution::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8h_source.html#l00551">ScalarEvolution.h:551</a></div></div>
<div class="ttc" id="classllvm_1_1SCEV_html_a3f76d2fd4788225548dc36ef9e417030"><div class="ttname"><a href="classllvm_1_1SCEV.html#a3f76d2fd4788225548dc36ef9e417030">llvm::SCEV::isZero</a></div><div class="ttdeci">bool isZero() const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l00275">ScalarEvolution.cpp:275</a></div></div>
<div class="ttc" id="namespacellvm_html_afa6abaa0eea3b2083902cf651a9653b1"><div class="ttname"><a href="namespacellvm.html#afa6abaa0eea3b2083902cf651a9653b1">llvm::SplitCriticalEdge</a></div><div class="ttdeci">BasicBlock * SplitCriticalEdge(TerminatorInst *TI, unsigned SuccNum, Pass *P=0, bool MergeIdenticalEdges=false, bool DontDeleteUselessPHIs=false, bool SplitLandingPads=false)</div><div class="ttdef"><b>Definition:</b> <a href="BreakCriticalEdges_8cpp_source.html#l00140">BreakCriticalEdges.cpp:140</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a9ca1a9aba5dedc82b4097ec967bcc712"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a9ca1a9aba5dedc82b4097ec967bcc712">ComplexityLimit</a></div><div class="ttdeci">static const size_t ComplexityLimit</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l03863">LoopStrengthReduce.cpp:3863</a></div></div>
<div class="ttc" id="IntrinsicInst_8h_html"><div class="ttname"><a href="IntrinsicInst_8h.html">IntrinsicInst.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a3f2f98c2a67c9e79f58aad9150a62e42"><div class="ttname"><a href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">llvm::dyn_cast</a></div><div class="ttdeci">enable_if_c&lt;!is_simple_type&lt; Y &gt;::value, typename cast_retty&lt; X, const Y &gt;::ret_type &gt;::type dyn_cast(const Y &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="Casting_8h_source.html#l00266">Casting.h:266</a></div></div>
<div class="ttc" id="classllvm_1_1DenseSet_html"><div class="ttname"><a href="classllvm_1_1DenseSet.html">llvm::DenseSet</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00026">DenseSet.h:26</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html">llvm::ScalarEvolution</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8h_source.html#l00172">ScalarEvolution.h:172</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00534">DenseMap.h:534</a></div></div>
<div class="ttc" id="namespacellvm_html_a7ef747666d6938cb47b3c5544011a4e5abcb1f797cb330e61a5879fc260aaec5b"><div class="ttname"><a href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5abcb1f797cb330e61a5879fc260aaec5b">llvm::scConstant</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00029">ScalarEvolutionExpressions.h:29</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARM__AM_html_a5d0557608eaebed12bc00812724ba2cdae6bcee28992dab735eaa43f5dfa48a09"><div class="ttname"><a href="namespacellvm_1_1ARM__AM.html#a5d0557608eaebed12bc00812724ba2cdae6bcee28992dab735eaa43f5dfa48a09">llvm::ARM_AM::add</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMAddressingModes_8h_source.html#l00038">ARMAddressingModes.h:38</a></div></div>
<div class="ttc" id="namespacellvm_html_a7ef747666d6938cb47b3c5544011a4e5afd56f054da3d1f9b827ae1003da3a38b"><div class="ttname"><a href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5afd56f054da3d1f9b827ae1003da3a38b">llvm::scMulExpr</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00029">ScalarEvolutionExpressions.h:29</a></div></div>
<div class="ttc" id="README-SSE_8txt_html_a63d206a063eefcdf8c318ded97b65020"><div class="ttname"><a href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a></div><div class="ttdeci">This currently compiles esp xmm0 movsd esp eax eax esp ret We should use not the dag combiner This is because dagcombine2 needs to be able to see through the X86ISD::Wrapper which DAGCombine can t really do The code for turning x load into a single vector load is target independent and should be moved to the dag combiner The code for turning x load into a vector load can only handle a direct load from a global or a direct load from the stack It should be generalized to handle any load from P</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00427">README-SSE.txt:427</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html"><div class="ttname"><a href="classllvm_1_1PHINode.html">llvm::PHINode</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01978">Instructions.h:1978</a></div></div>
<div class="ttc" id="namespacellvm_html_a72e1beba38b6627c9307ab8b5141ac64a4e61e68aee514bee49f2930447338b31"><div class="ttname"><a href="namespacellvm.html#a72e1beba38b6627c9307ab8b5141ac64a4e61e68aee514bee49f2930447338b31">llvm::Denormalize</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionNormalization_8h_source.html#l00060">ScalarEvolutionNormalization.h:60</a></div></div>
<div class="ttc" id="Debug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="structllvm_1_1DenseMapInfo_html"><div class="ttname"><a href="structllvm_1_1DenseMapInfo.html">llvm::DenseMapInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMapInfo_8h_source.html#l00023">DenseMapInfo.h:23</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a3c76890714593c78e3b5d142c9030548"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a3c76890714593c78e3b5d142c9030548">llvm::CmpInst::getInversePredicate</a></div><div class="ttdeci">Predicate getInversePredicate() const </div><div class="ttdoc">Return the inverse of the instruction&amp;#39;s predicate. </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00737">InstrTypes.h:737</a></div></div>
<div class="ttc" id="classllvm_1_1PointerType_html_a050a395d1656e546679d8b144d951bb2"><div class="ttname"><a href="classllvm_1_1PointerType.html#a050a395d1656e546679d8b144d951bb2">llvm::PointerType::get</a></div><div class="ttdeci">static PointerType * get(Type *ElementType, unsigned AddressSpace)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00730">Type.cpp:730</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05a91d86a4753c8bd7624e01bf565d87f8e"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a91d86a4753c8bd7624e01bf565d87f8e">llvm::CmpInst::ICMP_ULT</a></div><div class="ttdoc">unsigned less than </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00676">InstrTypes.h:676</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a9b6dd0fc7a648a939e571246045b673e"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">llvm::SmallPtrSet::insert</a></div><div class="ttdeci">bool insert(PtrType Ptr)</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00253">SmallPtrSet.h:253</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a73b3c5e7c72bf97886e2ed1f12e28d54"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a73b3c5e7c72bf97886e2ed1f12e28d54">MaxIVUsers</a></div><div class="ttdeci">static const unsigned MaxIVUsers</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l00085">LoopStrengthReduce.cpp:85</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_ae0d036af111b8aafe90db0771b8e9ce3"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#ae0d036af111b8aafe90db0771b8e9ce3">llvm::ScalarEvolution::properlyDominates</a></div><div class="ttdeci">bool properlyDominates(const SCEV *S, const BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l07592">ScalarEvolution.cpp:7592</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVAddExpr_html_adaa7ea82a902c95919c4bb6f7f6bf904"><div class="ttname"><a href="classllvm_1_1SCEVAddExpr.html#adaa7ea82a902c95919c4bb6f7f6bf904">llvm::SCEVAddExpr::getType</a></div><div class="ttdeci">Type * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00211">ScalarEvolutionExpressions.h:211</a></div></div>
<div class="ttc" id="classllvm_1_1DominatorTree_html_aa094180f7ac0ef9d4b8e1c78f850edd8"><div class="ttname"><a href="classllvm_1_1DominatorTree.html#aa094180f7ac0ef9d4b8e1c78f850edd8">llvm::DominatorTree::properlyDominates</a></div><div class="ttdeci">bool properlyDominates(const DomTreeNode *A, const DomTreeNode *B) const </div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00818">Dominators.h:818</a></div></div>
<div class="ttc" id="namespacellvm_html_a7c469a194119a14e5a018ebb9b847cf0"><div class="ttname"><a href="namespacellvm.html#a7c469a194119a14e5a018ebb9b847cf0">llvm::operator&lt;</a></div><div class="ttdeci">void operator&lt;(const Optional&lt; T &gt; &amp;X, const Optional&lt; U &gt; &amp;Y)</div><div class="ttdoc">Poison comparison between two Optional objects. Clients needs to explicitly compare the underlying va...</div></div>
<div class="ttc" id="classllvm_1_1SCEVAddRecExpr_html_a443e9130cd9f3e3baaa1b566e6aa5060"><div class="ttname"><a href="classllvm_1_1SCEVAddRecExpr.html#a443e9130cd9f3e3baaa1b566e6aa5060">llvm::SCEVAddRecExpr::getStepRecurrence</a></div><div class="ttdeci">const SCEV * getStepRecurrence(ScalarEvolution &amp;SE) const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00300">ScalarEvolutionExpressions.h:300</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_af622128e353515efebccad40eae495cb"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#af622128e353515efebccad40eae495cb">llvm::SmallVectorImpl::insert</a></div><div class="ttdeci">iterator insert(iterator I, const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00537">SmallVector.h:537</a></div></div>
<div class="ttc" id="namespacellvm_html_ac36ebb7d8a9874254ba36df4f0cde8b3"><div class="ttname"><a href="namespacellvm.html#ac36ebb7d8a9874254ba36df4f0cde8b3">llvm::initializeLoopStrengthReducePass</a></div><div class="ttdeci">void initializeLoopStrengthReducePass(PassRegistry &amp;)</div></div>
<div class="ttc" id="IVUsers_8h_html"><div class="ttname"><a href="IVUsers_8h.html">IVUsers.h</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVExpander_html_ac3ae3288532d1f9b8b5f4a1445b58697"><div class="ttname"><a href="classllvm_1_1SCEVExpander.html#ac3ae3288532d1f9b8b5f4a1445b58697">llvm::SCEVExpander::setDebugType</a></div><div class="ttdeci">void setDebugType(const char *s)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpander_8h_source.html#l00104">ScalarEvolutionExpander.h:104</a></div></div>
<div class="ttc" id="namespacellvm_1_1sys_1_1path_html_a33706aab89e700b8f79e1fa6f4f0e3ee"><div class="ttname"><a href="namespacellvm_1_1sys_1_1path.html#a33706aab89e700b8f79e1fa6f4f0e3ee">llvm::sys::path::begin</a></div><div class="ttdeci">const_iterator begin(StringRef path)</div><div class="ttdoc">Get begin iterator over path. </div><div class="ttdef"><b>Definition:</b> <a href="Path_8cpp_source.html#l00173">Path.cpp:173</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_afd69a04ba20c2085dec90d69fb9abe64"><div class="ttname"><a href="classllvm_1_1Type.html#afd69a04ba20c2085dec90d69fb9abe64">llvm::Type::getFPMantissaWidth</a></div><div class="ttdeci">int getFPMantissaWidth() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00142">Type.cpp:142</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_a5a19768af81df7e5fe571bc08dcd48b3"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#a5a19768af81df7e5fe571bc08dcd48b3">llvm::ScalarEvolution::isLoopInvariant</a></div><div class="ttdeci">bool isLoopInvariant(const SCEV *S, const Loop *L)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l07497">ScalarEvolution.cpp:7497</a></div></div>
<div class="ttc" id="classllvm_1_1SmallBitVector_html_aa79d9a55d612eb330a0e25dc4170470d"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html#aa79d9a55d612eb330a0e25dc4170470d">llvm::SmallBitVector::resize</a></div><div class="ttdeci">void resize(unsigned N, bool t=false)</div><div class="ttdoc">resize - Grow or shrink the bitvector. </div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00253">SmallBitVector.h:253</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_aca229503e4f5c83a187a6a921c625fa8"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">llvm::BasicBlock::getParent</a></div><div class="ttdeci">const Function * getParent() const </div><div class="ttdoc">Return the enclosing method, or null if none. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00116">BasicBlock.h:116</a></div></div>
<div class="ttc" id="namespacellvm_html_a7ef747666d6938cb47b3c5544011a4e5a80488550b42b6548ec4d5c7118c7ff1d"><div class="ttname"><a href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5a80488550b42b6548ec4d5c7118c7ff1d">llvm::scUnknown</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00031">ScalarEvolutionExpressions.h:31</a></div></div>
<div class="ttc" id="LLParser_8cpp_html_a33ece1ef8074506a15d7f86eb76dbae6"><div class="ttname"><a href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a></div><div class="ttdeci">F(f)</div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_ac015f68d60ea67a2e31bc10bc720d3e8"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#ac015f68d60ea67a2e31bc10bc720d3e8">llvm::Intrinsic::getType</a></div><div class="ttdeci">FunctionType * getType(LLVMContext &amp;Context, ID id, ArrayRef&lt; Type * &gt; Tys=None)</div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00657">Function.cpp:657</a></div></div>
<div class="ttc" id="classllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00033">User.h:33</a></div></div>
<div class="ttc" id="IVUsers_8cpp_html_a4e5b9edb51eec9dbca592075eb64dfcb"><div class="ttname"><a href="IVUsers_8cpp.html#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a></div><div class="ttdeci">iv Induction Variable Users</div><div class="ttdef"><b>Definition:</b> <a href="IVUsers_8cpp_source.html#l00039">IVUsers.cpp:39</a></div></div>
<div class="ttc" id="classllvm_1_1TargetTransformInfo_html_a27c39fe900d03167d7e519f8d6cb94e2"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a27c39fe900d03167d7e519f8d6cb94e2">llvm::TargetTransformInfo::isLegalAddImmediate</a></div><div class="ttdeci">virtual bool isLegalAddImmediate(int64_t Imm) const </div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00104">TargetTransformInfo.cpp:104</a></div></div>
<div class="ttc" id="classllvm_1_1SetVector_html_affac0dc3d407ef3dee29b8bc9a4836bc"><div class="ttname"><a href="classllvm_1_1SetVector.html#affac0dc3d407ef3dee29b8bc9a4836bc">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallSet&lt; T, N &gt; &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdoc">Get an iterator to the end of the SetVector. </div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00079">SetVector.h:79</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_a7df6ed7588301267782c2bd4b7f6899d"><div class="ttname"><a href="Target_2README_8txt.html#a7df6ed7588301267782c2bd4b7f6899d">for</a></div><div class="ttdeci">this could be done in SelectionDAGISel along with other special for</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00141">Target/README.txt:141</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a2eeb1c7ed1cfe403f2ae0470e36c07e2"><div class="ttname"><a href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">llvm::User::op_begin</a></div><div class="ttdeci">op_iterator op_begin()</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00116">User.h:116</a></div></div>
<div class="ttc" id="namespacellvm_1_1cl_html_a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6"><div class="ttname"><a href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">llvm::cl::Hidden</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00109">CommandLine.h:109</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVCastExpr_html"><div class="ttname"><a href="classllvm_1_1SCEVCastExpr.html">llvm::SCEVCastExpr</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00057">ScalarEvolutionExpressions.h:57</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVAddRecExpr_html_a0d53a749bd858b270d322b34b8d7e1e5"><div class="ttname"><a href="classllvm_1_1SCEVAddRecExpr.html#a0d53a749bd858b270d322b34b8d7e1e5">llvm::SCEVAddRecExpr::getStart</a></div><div class="ttdeci">const SCEV * getStart() const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00293">ScalarEvolutionExpressions.h:293</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad452febc1ac0b394876e640ec03ffa38"><div class="ttname"><a href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00167">Value.cpp:167</a></div></div>
<div class="ttc" id="classllvm_1_1LoopBase_html_a8917d359fc92f25eb0117386588c6f1c"><div class="ttname"><a href="classllvm_1_1LoopBase.html#a8917d359fc92f25eb0117386588c6f1c">llvm::LoopBase::getLoopLatch</a></div><div class="ttdeci">BlockT * getLoopLatch() const </div><div class="ttdef"><b>Definition:</b> <a href="LoopInfoImpl_8h_source.html#l00154">LoopInfoImpl.h:154</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0ed5f3ab3c2e4196ee0cffffa080c062"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">llvm::BasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00193">BasicBlock.h:193</a></div></div>
<div class="ttc" id="classllvm_1_1IVUsers_html"><div class="ttname"><a href="classllvm_1_1IVUsers.html">llvm::IVUsers</a></div><div class="ttdef"><b>Definition:</b> <a href="IVUsers_8h_source.html#l00119">IVUsers.h:119</a></div></div>
<div class="ttc" id="ScalarEvolutionExpander_8h_html"><div class="ttname"><a href="ScalarEvolutionExpander_8h.html">ScalarEvolutionExpander.h</a></div></div>
<div class="ttc" id="X86DisassemblerDecoder_8h_html_a546839a5c4bcf9f9450967155f48de41"><div class="ttname"><a href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a></div><div class="ttdeci">Reg</div><div class="ttdef"><b>Definition:</b> <a href="X86DisassemblerDecoder_8h_source.html#l00428">X86DisassemblerDecoder.h:428</a></div></div>
<div class="ttc" id="classllvm_1_1DomTreeNodeBase_html_a7519f9ffdda3ef1147e2563200587193"><div class="ttname"><a href="classllvm_1_1DomTreeNodeBase.html#a7519f9ffdda3ef1147e2563200587193">llvm::DomTreeNodeBase::getIDom</a></div><div class="ttdeci">DomTreeNodeBase&lt; NodeT &gt; * getIDom() const </div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00083">Dominators.h:83</a></div></div>
<div class="ttc" id="namespacellvm_html_ae712552495c21ee77ad82ced255ad6df"><div class="ttname"><a href="namespacellvm.html#ae712552495c21ee77ad82ced255ad6df">llvm::WriteAsOperand</a></div><div class="ttdeci">void WriteAsOperand(raw_ostream &amp;, const Value *, bool PrintTy=true, const Module *Context=0)</div><div class="ttdef"><b>Definition:</b> <a href="AsmWriter_8cpp_source.html#l01179">AsmWriter.cpp:1179</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVExpander_html_a546c51290ce25125f40293fb4ebc1919"><div class="ttname"><a href="classllvm_1_1SCEVExpander.html#a546c51290ce25125f40293fb4ebc1919">llvm::SCEVExpander::enableLSRMode</a></div><div class="ttdeci">void enableLSRMode()</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpander_8h_source.html#l00172">ScalarEvolutionExpander.h:172</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_ad78e062f62e0d6e453941fb4ca843e4d"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a></div><div class="ttdeci">#define DEBUG_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l00056">LoopStrengthReduce.cpp:56</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html_ae5c60fd282ee894c87ea02c3f0fcb6d0"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">llvm::AnalysisUsage::addRequired</a></div><div class="ttdeci">AnalysisUsage &amp; addRequired()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00055">PassAnalysisSupport.h:55</a></div></div>
<div class="ttc" id="PassSupport_8h_html_a14724f1ccf528e73bb29bc9230737967"><div class="ttname"><a href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a></div><div class="ttdeci">#define INITIALIZE_PASS_DEPENDENCY(depName)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00167">PassSupport.h:167</a></div></div>
<div class="ttc" id="HexagonHardwareLoops_8cpp_html_ada7c1594a393ede3ce32602d64d7ddb2"><div class="ttname"><a href="HexagonHardwareLoops_8cpp.html#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a></div><div class="ttdeci">Hexagon Hardware Loops</div><div class="ttdef"><b>Definition:</b> <a href="HexagonHardwareLoops_8cpp_source.html#l00281">HexagonHardwareLoops.cpp:281</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html_a382131e712e55e8324fbd5068de17b78"><div class="ttname"><a href="classllvm_1_1BranchInst.html#a382131e712e55e8324fbd5068de17b78">llvm::BranchInst::isUnconditional</a></div><div class="ttdeci">bool isUnconditional() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02391">Instructions.h:2391</a></div></div>
<div class="ttc" id="classllvm_1_1value__use__iterator_html"><div class="ttname"><a href="classllvm_1_1value__use__iterator.html">llvm::value_use_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00168">Use.h:168</a></div></div>
<div class="ttc" id="classllvm_1_1SelectInst_html"><div class="ttname"><a href="classllvm_1_1SelectInst.html">llvm::SelectInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01430">Instructions.h:1430</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_af8dde13a97efce293a7b04daf1e208fb"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">llvm::ConstantInt::getValue</a></div><div class="ttdeci">const APInt &amp; getValue() const </div><div class="ttdoc">Return the constant&amp;#39;s value. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00105">Constants.h:105</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVExpander_html_a767b257cc39ee9ea9e0edcee4220c00c"><div class="ttname"><a href="classllvm_1_1SCEVExpander.html#a767b257cc39ee9ea9e0edcee4220c00c">llvm::SCEVExpander::clearPostInc</a></div><div class="ttdeci">void clearPostInc()</div><div class="ttdoc">clearPostInc - Disable all post-inc expansion. </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpander_8h_source.html#l00159">ScalarEvolutionExpander.h:159</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05ac17897ebf2f6a6986280fc3bdf28a30a"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05ac17897ebf2f6a6986280fc3bdf28a30a">llvm::CmpInst::ICMP_NE</a></div><div class="ttdoc">not equal </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00673">InstrTypes.h:673</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a400eaca9881c8dcab97e9f42b1ab1815"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">llvm::SmallVectorImpl::pop_back_val</a></div><div class="ttdeci">T LLVM_ATTRIBUTE_UNUSED_RESULT pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00430">SmallVector.h:430</a></div></div>
<div class="ttc" id="ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdef"><b>Definition:</b> <a href="ErrorHandling_8h_source.html#l00103">ErrorHandling.h:103</a></div></div>
<div class="ttc" id="classllvm_1_1Use_html"><div class="ttname"><a href="classllvm_1_1Use.html">llvm::Use</a></div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00060">Use.h:60</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a262aeb2eecfb752ae2eecb90bab7ec8a"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a262aeb2eecfb752ae2eecb90bab7ec8a">findIVOperand</a></div><div class="ttdeci">static User::op_iterator findIVOperand(User::op_iterator OI, User::op_iterator OE, Loop *L, ScalarEvolution &amp;SE)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l02379">LoopStrengthReduce.cpp:2379</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVNAryExpr_html_a82ad83d40ce0e57efef84b421c7f805a"><div class="ttname"><a href="classllvm_1_1SCEVNAryExpr.html#a82ad83d40ce0e57efef84b421c7f805a">llvm::SCEVNAryExpr::op_iterator</a></div><div class="ttdeci">const SCEV *const * op_iterator</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00153">ScalarEvolutionExpressions.h:153</a></div></div>
<div class="ttc" id="PassSupport_8h_html_a74ce8276b89067e806f67c45a6d92575"><div class="ttname"><a href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a></div><div class="ttdeci">#define INITIALIZE_PASS_END(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00172">PassSupport.h:172</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00035">APInt.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html"><div class="ttname"><a href="classllvm_1_1IRBuilder.html">llvm::IRBuilder</a></div><div class="ttdoc">This provides a uniform API for creating instructions and inserting them into a basic block: either a...</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00421">IRBuilder.h:421</a></div></div>
<div class="ttc" id="STLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="classllvm_1_1LoopBase_html_aa6bdb226fb3dac1f051547ce01b76fd2"><div class="ttname"><a href="classllvm_1_1LoopBase.html#aa6bdb226fb3dac1f051547ce01b76fd2">llvm::LoopBase::getExitingBlocks</a></div><div class="ttdeci">void getExitingBlocks(SmallVectorImpl&lt; BlockT * &gt; &amp;ExitingBlocks) const </div><div class="ttdef"><b>Definition:</b> <a href="LoopInfoImpl_8h_source.html#l00033">LoopInfoImpl.h:33</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_a983dbdce6af7840357ed33a20c8f30bb"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#a983dbdce6af7840357ed33a20c8f30bb">llvm::ScalarEvolution::getTypeSizeInBits</a></div><div class="ttdeci">uint64_t getTypeSizeInBits(Type *Ty) const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l02666">ScalarEvolution.cpp:2666</a></div></div>
<div class="ttc" id="classllvm_1_1SmallBitVector_html_a486e5364d2ad0d281f7627750f5f829a"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html#a486e5364d2ad0d281f7627750f5f829a">llvm::SmallBitVector::find_first</a></div><div class="ttdeci">int find_first() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00213">SmallBitVector.h:213</a></div></div>
<div class="ttc" id="namespacellvm_html_a59575e3191e743149bbd95eacbb9081a"><div class="ttname"><a href="namespacellvm.html#a59575e3191e743149bbd95eacbb9081a">llvm::abs64</a></div><div class="ttdeci">int64_t abs64(int64_t x)</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00579">MathExtras.h:579</a></div></div>
<div class="ttc" id="namespacellvm_html_a7ef747666d6938cb47b3c5544011a4e5ad3656bcc84af213cc488acb56c60de22"><div class="ttname"><a href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5ad3656bcc84af213cc488acb56c60de22">llvm::scTruncate</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00029">ScalarEvolutionExpressions.h:29</a></div></div>
<div class="ttc" id="namespacefalse_html"><div class="ttname"><a href="namespacefalse.html">false</a></div><div class="ttdef"><b>Definition:</b> <a href="StackSlotColoring_8cpp_source.html#l00126">StackSlotColoring.cpp:126</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a35ee267850af7c235474a8c46c7ac5af"><div class="ttname"><a href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">llvm::Value::setName</a></div><div class="ttdeci">void setName(const Twine &amp;Name)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00175">Value.cpp:175</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_ae4cc657febc6dbfa190deb899e1f0126"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#ae4cc657febc6dbfa190deb899e1f0126">getScalingFactorCost</a></div><div class="ttdeci">static unsigned getScalingFactorCost(const TargetTransformInfo &amp;TTI, const LSRUse &amp;LU, const Formula &amp;F)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l01422">LoopStrengthReduce.cpp:1422</a></div></div>
<div class="ttc" id="namespacellvm_1_1CallingConv_html_a4f861731fc6dbfdccc05af5968d98974"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">llvm::CallingConv::ID</a></div><div class="ttdeci">ID</div><div class="ttdoc">LLVM Calling Convention Representation. </div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00026">CallingConv.h:26</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_af6aad0c9ba7b8720130235c9621b55b5"><div class="ttname"><a href="classllvm_1_1Instruction.html#af6aad0c9ba7b8720130235c9621b55b5">llvm::Instruction::clone</a></div><div class="ttdeci">Instruction * clone() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00541">Instruction.cpp:541</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVNAryExpr_html_a107163b3c781d2b0137bf2021e7dc984"><div class="ttname"><a href="classllvm_1_1SCEVNAryExpr.html#a107163b3c781d2b0137bf2021e7dc984">llvm::SCEVNAryExpr::op_begin</a></div><div class="ttdeci">op_iterator op_begin() const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00154">ScalarEvolutionExpressions.h:154</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVMulExpr_html"><div class="ttname"><a href="classllvm_1_1SCEVMulExpr.html">llvm::SCEVMulExpr</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00227">ScalarEvolutionExpressions.h:227</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00031">Instruction.h:31</a></div></div>
<div class="ttc" id="MD5_8cpp_html_ad96b7cf3182ce2ba85e5a7a93b12c441"><div class="ttname"><a href="MD5_8cpp.html#ad96b7cf3182ce2ba85e5a7a93b12c441">G</a></div><div class="ttdeci">#define G(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00052">MD5.cpp:52</a></div></div>
<div class="ttc" id="classllvm_1_1Loop_html_a1d4445ebce66137e57fbaa967a19d7e9"><div class="ttname"><a href="classllvm_1_1Loop.html#a1d4445ebce66137e57fbaa967a19d7e9">llvm::Loop::isLoopSimplifyForm</a></div><div class="ttdeci">bool isLoopSimplifyForm() const </div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8cpp_source.html#l00207">LoopInfo.cpp:207</a></div></div>
<div class="ttc" id="Dominators_8h_html"><div class="ttname"><a href="Dominators_8h.html">Dominators.h</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a6edd823ba5e4e1effc8280ca8a1194ef"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">llvm::ConstantInt::getZExtValue</a></div><div class="ttdeci">uint64_t getZExtValue() const </div><div class="ttdoc">Return the zero extended value. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00116">Constants.h:116</a></div></div>
<div class="ttc" id="classllvm_1_1SetVector_html_a72d928b7fc2c5f2d56c6ac0265fd9c6e"><div class="ttname"><a href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallSet&lt; T, N &gt; &gt;::insert</a></div><div class="ttdeci">bool insert(const value_type &amp;X)</div><div class="ttdoc">Insert a new element into the SetVector. </div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00102">SetVector.h:102</a></div></div>
<div class="ttc" id="classllvm_1_1SmallSet_html_a76b3fc7c102561fb5210d5151531e409"><div class="ttname"><a href="classllvm_1_1SmallSet.html#a76b3fc7c102561fb5210d5151531e409">llvm::SmallSet::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00097">SmallSet.h:97</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_af348d5ea83429d08ba891ca3dd0e92b2"><div class="ttname"><a href="classllvm_1_1Type.html#af348d5ea83429d08ba891ca3dd0e92b2">llvm::Type::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdoc">getContext - Return the LLVMContext in which this type was uniqued. </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00128">Type.h:128</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a2ced6343b8ad006a757059554bbf9f37"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">llvm::SmallPtrSet::count</a></div><div class="ttdeci">bool count(PtrType Ptr) const </div><div class="ttdoc">count - Return true if the specified pointer is in the set. </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00264">SmallPtrSet.h:264</a></div></div>
<div class="ttc" id="namespacellvm_html_a370ed0e0f2bb66d17cd13f84be54e867"><div class="ttname"><a href="namespacellvm.html#a370ed0e0f2bb66d17cd13f84be54e867">llvm::array_lengthof</a></div><div class="ttdeci">size_t array_lengthof(T(&amp;)[N])</div><div class="ttdoc">Find the length of an array. </div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00250">STLExtras.h:250</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVAddRecExpr_html"><div class="ttname"><a href="classllvm_1_1SCEVAddRecExpr.html">llvm::SCEVAddRecExpr</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00283">ScalarEvolutionExpressions.h:283</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorBase_html_a8a8df4d85555c7954a95f86080cd3b64"><div class="ttname"><a href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">llvm::SmallVectorBase::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00056">SmallVector.h:56</a></div></div>
<div class="ttc" id="classllvm_1_1TargetTransformInfo_html_a83f052a0d908e956128c8951451bde39"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a83f052a0d908e956128c8951451bde39">llvm::TargetTransformInfo::isTypeLegal</a></div><div class="ttdeci">virtual bool isTypeLegal(Type *Ty) const </div><div class="ttdoc">Is this type legal. </div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00132">TargetTransformInfo.cpp:132</a></div></div>
<div class="ttc" id="namespacellvm_html_abdaf1eaf6120421977095bd97eee892e"><div class="ttname"><a href="namespacellvm.html#abdaf1eaf6120421977095bd97eee892e">llvm::countTrailingZeros</a></div><div class="ttdeci">enable_if_c&lt; std::numeric_limits&lt; T &gt;::is_integer &amp;&amp;!std::numeric_limits&lt; T &gt;::is_signed, std::size_t &gt;::type countTrailingZeros(T Val, ZeroBehavior ZB=ZB_Width)</div><div class="ttdoc">Count number of 0&amp;#39;s from the least significant bit to the most stopping at the first 1...</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00049">MathExtras.h:49</a></div></div>
<div class="ttc" id="README-SSE_8txt_html_a698e4bd87a8adc0c042ae6b6e10ee6e1"><div class="ttname"><a href="README-SSE_8txt.html#a698e4bd87a8adc0c042ae6b6e10ee6e1">double</a></div><div class="ttdeci">into xmm2 addss xmm2 xmm1 xmm3 addss xmm3 movaps xmm0 unpcklps xmm0 ret seems silly when it could just be one addps Expand libm rounding functions main should enable SSE DAZ mode and other fast SSE modes Think about doing i64 math in SSE regs on x86 This testcase should have no SSE instructions in and only one load from a constant double</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00053">README-SSE.txt:53</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVNAryExpr_html_aed1b1d3b764c76210c67dd1b4a6be2f2"><div class="ttname"><a href="classllvm_1_1SCEVNAryExpr.html#aed1b1d3b764c76210c67dd1b4a6be2f2">llvm::SCEVNAryExpr::getType</a></div><div class="ttdeci">Type * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00157">ScalarEvolutionExpressions.h:157</a></div></div>
<div class="ttc" id="Analysis_2README_8txt_html_a01d2af4eee7c40485a0ce3683a2e907a"><div class="ttname"><a href="Analysis_2README_8txt.html#a01d2af4eee7c40485a0ce3683a2e907a">loop</a></div><div class="ttdeci">Analysis the ScalarEvolution expression for r is&lt; loop &gt; Outside the loop</div><div class="ttdef"><b>Definition:</b> <a href="Analysis_2README_8txt_source.html#l00005">Analysis/README.txt:5</a></div></div>
<div class="ttc" id="classllvm_1_1SetVector_html_adb13793b98ab59209a5309d26f831850"><div class="ttname"><a href="classllvm_1_1SetVector.html#adb13793b98ab59209a5309d26f831850">llvm::SetVector&lt; T, SmallVector&lt; T, N &gt;, SmallSet&lt; T, N &gt; &gt;::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdoc">Get an iterator to the beginning of the SetVector. </div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00069">SetVector.h:69</a></div></div>
<div class="ttc" id="classllvm_1_1DomTreeNodeBase_html"><div class="ttname"><a href="classllvm_1_1DomTreeNodeBase.html">llvm::DomTreeNodeBase</a></div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00064">Dominators.h:64</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html_a40970e5d42646fb2d9aa5f7a2c879516"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#a40970e5d42646fb2d9aa5f7a2c879516">llvm::AnalysisUsage::addPreservedID</a></div><div class="ttdeci">AnalysisUsage &amp; addPreservedID(const void *ID)</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00068">PassAnalysisSupport.h:68</a></div></div>
<div class="ttc" id="classllvm_1_1SmallSet_html_a8d8348060ccdeeba13fb8bc651dfbf82"><div class="ttname"><a href="classllvm_1_1SmallSet.html#a8d8348060ccdeeba13fb8bc651dfbf82">llvm::SmallSet::insert</a></div><div class="ttdeci">bool insert(const T &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00059">SmallSet.h:59</a></div></div>
<div class="ttc" id="classllvm_1_1StoreInst_html"><div class="ttname"><a href="classllvm_1_1StoreInst.html">llvm::StoreInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00255">Instructions.h:255</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00303">Value.cpp:303</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_ac7db1af29fc90ec685f6f0c2bc39d3ef"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#ac7db1af29fc90ec685f6f0c2bc39d3ef">isLegal2RegAMUse</a></div><div class="ttdeci">static bool isLegal2RegAMUse(const TargetTransformInfo &amp;TTI, const LSRUse &amp;LU, const Formula &amp;F)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l01398">LoopStrengthReduce.cpp:1398</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_abb976145b00ae108c1d6b98c4f099d27"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#abb976145b00ae108c1d6b98c4f099d27">llvm::ScalarEvolution::getEffectiveSCEVType</a></div><div class="ttdeci">Type * getEffectiveSCEVType(Type *Ty) const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l02687">ScalarEvolution.cpp:2687</a></div></div>
<div class="ttc" id="ObjCARCOpts_8cpp_html_a7c6cee88be47642de240c7ed39a34ed3"><div class="ttname"><a href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a></div><div class="ttdeci">Sequence</div><div class="ttdoc">A sequence of states that a pointer may go through in which an objc_retain and objc_release are actua...</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l00279">ObjCARCOpts.cpp:279</a></div></div>
<div class="ttc" id="classllvm_1_1DominatorTree_html"><div class="ttname"><a href="classllvm_1_1DominatorTree.html">llvm::DominatorTree</a></div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00740">Dominators.h:740</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a5d15af723179356228265f1f12b9f4e2"><div class="ttname"><a href="classllvm_1_1APInt.html#a5d15af723179356228265f1f12b9f4e2">llvm::APInt::getMinSignedBits</a></div><div class="ttdeci">unsigned getMinSignedBits() const </div><div class="ttdoc">Get the minimum bit size for this signed APInt. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01295">APInt.h:1295</a></div></div>
<div class="ttc" id="classllvm_1_1TruncInst_html"><div class="ttname"><a href="classllvm_1_1TruncInst.html">llvm::TruncInst</a></div><div class="ttdoc">This class represents a truncation of integer types. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03175">Instructions.h:3175</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_a659b27f6737fcb7eaf333b0279da1154"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#a659b27f6737fcb7eaf333b0279da1154">llvm::ScalarEvolution::getAddRecExpr</a></div><div class="ttdeci">const SCEV * getAddRecExpr(const SCEV *Start, const SCEV *Step, const Loop *L, SCEV::NoWrapFlags Flags)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l02246">ScalarEvolution.cpp:2246</a></div></div>
<div class="ttc" id="classllvm_1_1DomTreeNodeBase_html_a96fd2f0087c41942dd2618ff6e1b8640"><div class="ttname"><a href="classllvm_1_1DomTreeNodeBase.html#a96fd2f0087c41942dd2618ff6e1b8640">llvm::DomTreeNodeBase::getBlock</a></div><div class="ttdeci">NodeT * getBlock() const </div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00082">Dominators.h:82</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVNAryExpr_html_a97221eb4fea7333f0b7b35b35e1169b2"><div class="ttname"><a href="classllvm_1_1SCEVNAryExpr.html#a97221eb4fea7333f0b7b35b35e1169b2">llvm::SCEVNAryExpr::getNumOperands</a></div><div class="ttdeci">size_t getNumOperands() const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00147">ScalarEvolutionExpressions.h:147</a></div></div>
<div class="ttc" id="classllvm_1_1SCEV_html_af43000d4dcb7d6d63cb6e36933ed3f6fa23e74052c4d79cfdaa23460a3c946656"><div class="ttname"><a href="classllvm_1_1SCEV.html#af43000d4dcb7d6d63cb6e36933ed3f6fa23e74052c4d79cfdaa23460a3c946656">llvm::SCEV::FlagAnyWrap</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8h_source.html#l00094">ScalarEvolution.h:94</a></div></div>
<div class="ttc" id="classllvm_1_1PointerType_html"><div class="ttname"><a href="classllvm_1_1PointerType.html">llvm::PointerType</a></div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00425">DerivedTypes.h:425</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_aa45f6c0433576e3858a6209a43750ad4"><div class="ttname"><a href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">llvm::PHINode::getNumIncomingValues</a></div><div class="ttdeci">unsigned getNumIncomingValues() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02055">Instructions.h:2055</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a1f0b9358936e3e00c42a460abbfb2868"><div class="ttname"><a href="classllvm_1_1User.html#a1f0b9358936e3e00c42a460abbfb2868">llvm::User::replaceUsesOfWith</a></div><div class="ttdeci">void replaceUsesOfWith(Value *From, Value *To)</div><div class="ttdef"><b>Definition:</b> <a href="User_8cpp_source.html#l00026">User.cpp:26</a></div></div>
<div class="ttc" id="classllvm_1_1CastInst_html_a0f7dea9550778374905e12da6d6ba8a8"><div class="ttname"><a href="classllvm_1_1CastInst.html#a0f7dea9550778374905e12da6d6ba8a8">llvm::CastInst::Create</a></div><div class="ttdeci">static CastInst * Create(Instruction::CastOps, Value *S, Type *Ty, const Twine &amp;Name=&quot;&quot;, Instruction *InsertBefore=0)</div><div class="ttdoc">Construct any of the CastInst subclasses. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02350">Instructions.cpp:2350</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVExpander_html_aa9bcc84c7b023d3b1321851509110dae"><div class="ttname"><a href="classllvm_1_1SCEVExpander.html#aa9bcc84c7b023d3b1321851509110dae">llvm::SCEVExpander::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpander_8h_source.html#l00110">ScalarEvolutionExpander.h:110</a></div></div>
<div class="ttc" id="classllvm_1_1TerminatorInst_html_a4c26d3b92af99a6c8defd89a2d39ca32"><div class="ttname"><a href="classllvm_1_1TerminatorInst.html#a4c26d3b92af99a6c8defd89a2d39ca32">llvm::TerminatorInst::getNumSuccessors</a></div><div class="ttdeci">unsigned getNumSuccessors() const </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00059">InstrTypes.h:59</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_ae0967c7d7704831386dbfc70aa58cc02"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#ae0967c7d7704831386dbfc70aa58cc02">isCompatibleIVType</a></div><div class="ttdeci">static bool isCompatibleIVType(Value *LVal, Value *RVal)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l02406">LoopStrengthReduce.cpp:2406</a></div></div>
<div class="ttc" id="namespacellvm_html_a7ef747666d6938cb47b3c5544011a4e5a222c9c7b5d5e742d5d1238a3256b1ea5"><div class="ttname"><a href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5a222c9c7b5d5e742d5d1238a3256b1ea5">llvm::scAddRecExpr</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00030">ScalarEvolutionExpressions.h:30</a></div></div>
<div class="ttc" id="README__ALTIVEC_8txt_html_a9aacd9146afe44bf656cd664e2a88c8c"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div><div class="ttdeci">(vector float) vec_cmpeq(*A,*B) C</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00091">README_ALTIVEC.txt:91</a></div></div>
<div class="ttc" id="CommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVUnknown_html"><div class="ttname"><a href="classllvm_1_1SCEVUnknown.html">llvm::SCEVUnknown</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00409">ScalarEvolutionExpressions.h:409</a></div></div>
<div class="ttc" id="namespacellvm_1_1cl_html_a10a041239ae1870cfcc064bfaa79fb65"><div class="ttname"><a href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00314">CommandLine.h:314</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVAddRecExpr_html_a88f514461ddb0af0fc59ac4639f644bc"><div class="ttname"><a href="classllvm_1_1SCEVAddRecExpr.html#a88f514461ddb0af0fc59ac4639f644bc">llvm::SCEVAddRecExpr::isAffine</a></div><div class="ttdeci">bool isAffine() const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00309">ScalarEvolutionExpressions.h:309</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_ae9623974341419bfd1d185cfdc65bedd"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#ae9623974341419bfd1d185cfdc65bedd">llvm::ScalarEvolution::isSCEVable</a></div><div class="ttdeci">bool isSCEVable(Type *Ty) const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l02659">ScalarEvolution.cpp:2659</a></div></div>
<div class="ttc" id="LoopPass_8h_html"><div class="ttname"><a href="LoopPass_8h.html">LoopPass.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a03503773241005f01b090b9862aad304"><div class="ttname"><a href="namespacellvm.html#a03503773241005f01b090b9862aad304">llvm::dump</a></div><div class="ttdeci">void dump(const SparseBitVector&lt; ElementSize &gt; &amp;LHS, raw_ostream &amp;out)</div><div class="ttdef"><b>Definition:</b> <a href="SparseBitVector_8h_source.html#l00882">SparseBitVector.h:882</a></div></div>
<div class="ttc" id="classllvm_1_1IVStrideUse_html_acb8718e691dfd2e5d5a3e0d876e35cc9"><div class="ttname"><a href="classllvm_1_1IVStrideUse.html#acb8718e691dfd2e5d5a3e0d876e35cc9">llvm::IVStrideUse::setUser</a></div><div class="ttdeci">void setUser(Instruction *NewUser)</div><div class="ttdoc">setUser - Assign a new user instruction for this use. </div><div class="ttdef"><b>Definition:</b> <a href="IVUsers_8h_source.html#l00049">IVUsers.h:49</a></div></div>
<div class="ttc" id="LLParser_8cpp_html_aae58e3df0180401e8f3ab75c18fbc07a"><div class="ttname"><a href="LLParser_8cpp.html#aae58e3df0180401e8f3ab75c18fbc07a">if</a></div><div class="ttdeci">* if(!EatIfPresent(lltok::kw_thread_local)) return false</div></div>
<div class="ttc" id="classllvm_1_1LoopBase_html_a1bc74c76b876ad387293ecde0f21ed45"><div class="ttname"><a href="classllvm_1_1LoopBase.html#a1bc74c76b876ad387293ecde0f21ed45">llvm::LoopBase::getLoopPreheader</a></div><div class="ttdeci">BlockT * getLoopPreheader() const </div><div class="ttdef"><b>Definition:</b> <a href="LoopInfoImpl_8h_source.html#l00106">LoopInfoImpl.h:106</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a6cfac60f7a8d39786699d498a07ad8f9"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a6cfac60f7a8d39786699d498a07ad8f9">isAlwaysFoldable</a></div><div class="ttdeci">static bool isAlwaysFoldable(const TargetTransformInfo &amp;TTI, LSRUse::KindType Kind, Type *AccessTy, GlobalValue *BaseGV, int64_t BaseOffset, bool HasBaseReg)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l01458">LoopStrengthReduce.cpp:1458</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a32cdb4a97c185f1acbe11f45fcc70d12"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a32cdb4a97c185f1acbe11f45fcc70d12">isMulSExtable</a></div><div class="ttdeci">static bool isMulSExtable(const SCEVMulExpr *M, ScalarEvolution &amp;SE)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l00454">LoopStrengthReduce.cpp:454</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_acd9e771a3296c6b24146955754620557"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">llvm::SmallVectorTemplateCommon&lt; T &gt;::back</a></div><div class="ttdeci">reference back()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00157">SmallVector.h:157</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_aac0ea55010b7b1a301e65a0baea057aa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">llvm::SmallVectorImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00396">SmallVector.h:396</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00072">BasicBlock.h:72</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a73349916f7e54a6b988a3646c7a02e90ac3a45308c2814e385046198c11f79bfe"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ac3a45308c2814e385046198c11f79bfe">llvm::Intrinsic::x86_sse_storeu_ps</a></div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l03173">Intrinsics.h:3173</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVUDivExpr_html"><div class="ttname"><a href="classllvm_1_1SCEVUDivExpr.html">llvm::SCEVUDivExpr</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00246">ScalarEvolutionExpressions.h:246</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html"><div class="ttname"><a href="classllvm_1_1Type.html">llvm::Type</a></div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00044">Type.h:44</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_aa59a46776e15b1f1bd597c4e1e769f59"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#aa59a46776e15b1f1bd597c4e1e769f59">DoInitialMatch</a></div><div class="ttdeci">static void DoInitialMatch(const SCEV *S, Loop *L, SmallVectorImpl&lt; const SCEV * &gt; &amp;Good, SmallVectorImpl&lt; const SCEV * &gt; &amp;Bad, ScalarEvolution &amp;SE)</div><div class="ttdoc">DoInitialMatch - Recursion helper for InitialMatch. </div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l00274">LoopStrengthReduce.cpp:274</a></div></div>
<div class="ttc" id="classllvm_1_1SCEV_html_a9a16f1241255a605fc8debc1e26eaa4c"><div class="ttname"><a href="classllvm_1_1SCEV.html#a9a16f1241255a605fc8debc1e26eaa4c">llvm::SCEV::getType</a></div><div class="ttdeci">Type * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l00249">ScalarEvolution.cpp:249</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html"><div class="ttname"><a href="classllvm_1_1BranchInst.html">llvm::BranchInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02350">Instructions.h:2350</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_ab24db72f7bd10b13351812874015861b"><div class="ttname"><a href="Target_2README_8txt.html#ab24db72f7bd10b13351812874015861b">First</a></div><div class="ttdeci">into llvm powi allowing the code generator to produce balanced multiplication trees First</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00051">Target/README.txt:51</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html"><div class="ttname"><a href="classllvm_1_1Constant.html">llvm::Constant</a></div><div class="ttdoc">LLVM Constant Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Constant_8h_source.html#l00041">Constant.h:41</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVNAryExpr_html_a8d1a2d2a4d2f935841d226bbcbf54a48"><div class="ttname"><a href="classllvm_1_1SCEVNAryExpr.html#a8d1a2d2a4d2f935841d226bbcbf54a48">llvm::SCEVNAryExpr::getOperand</a></div><div class="ttdeci">const SCEV * getOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00148">ScalarEvolutionExpressions.h:148</a></div></div>
<div class="ttc" id="classllvm_1_1SmallSet_html"><div class="ttname"><a href="classllvm_1_1SmallSet.html">llvm::SmallSet</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00031">SmallSet.h:31</a></div></div>
<div class="ttc" id="Constants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a72e1beba38b6627c9307ab8b5141ac64aeb131ce4dfb8eeef7197e6b0afd145d4"><div class="ttname"><a href="namespacellvm.html#a72e1beba38b6627c9307ab8b5141ac64aeb131ce4dfb8eeef7197e6b0afd145d4">llvm::Normalize</a></div><div class="ttdoc">Normalize - Normalize according to the given loops. </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionNormalization_8h_source.html#l00054">ScalarEvolutionNormalization.h:54</a></div></div>
<div class="ttc" id="namespacellvm_html_abe283966f269761ee387642061c4451e"><div class="ttname"><a href="namespacellvm.html#abe283966f269761ee387642061c4451e">llvm::isInstructionTriviallyDead</a></div><div class="ttdeci">bool isInstructionTriviallyDead(Instruction *I, const TargetLibraryInfo *TLI=0)</div><div class="ttdef"><b>Definition:</b> <a href="Local_8cpp_source.html#l00266">Local.cpp:266</a></div></div>
<div class="ttc" id="structllvm_1_1cl_1_1desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1desc.html">llvm::cl::desc</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00286">CommandLine.h:286</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_add283613989eaa5682d8f97d6b9a8fd4"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#add283613989eaa5682d8f97d6b9a8fd4">EnablePhiElim</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; EnablePhiElim(&quot;enable-lsr-phielim&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Enable LSR phi elimination&quot;))</div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_aab8e16a35183ce39aad394714087bcff"><div class="ttname"><a href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">llvm::Instruction::getDebugLoc</a></div><div class="ttdeci">const DebugLoc &amp; getDebugLoc() const </div><div class="ttdoc">getDebugLoc - Return the debug location for this node as a DebugLoc. </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00178">Instruction.h:178</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00037">PassAnalysisSupport.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_afb5e83bf5123ff7c51058eb0ebebcdc6"><div class="ttname"><a href="classllvm_1_1PHINode.html#afb5e83bf5123ff7c51058eb0ebebcdc6">llvm::PHINode::Create</a></div><div class="ttdeci">static PHINode * Create(Type *Ty, unsigned NumReservedValues, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02013">Instructions.h:2013</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_af41f58e730804d10b91fcff39b035f74"><div class="ttname"><a href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">llvm::User::op_end</a></div><div class="ttdeci">op_iterator op_end()</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00118">User.h:118</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a6e20e76960d952de088354cbcd14c3ab"><div class="ttname"><a href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">llvm::Type::getVoidTy</a></div><div class="ttdeci">static Type * getVoidTy(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00227">Type.cpp:227</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a4c25b6c00c4867281779c81ab64d2081"><div class="ttname"><a href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">llvm::PHINode::getIncomingBlock</a></div><div class="ttdeci">BasicBlock * getIncomingBlock(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02074">Instructions.h:2074</a></div></div>
<div class="ttc" id="classllvm_1_1LoopBase_html_ac4f141a355e5898255f2cbc57c5b54c3"><div class="ttname"><a href="classllvm_1_1LoopBase.html#ac4f141a355e5898255f2cbc57c5b54c3">llvm::LoopBase::getHeader</a></div><div class="ttdeci">BlockT * getHeader() const </div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00095">LoopInfo.h:95</a></div></div>
<div class="ttc" id="namespacellvm_html_aa1704159f75e6eacd595962ea6d93ffe"><div class="ttname"><a href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a></div><div class="ttdeci">ItTy next(ItTy it, Dist n)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00154">STLExtras.h:154</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a531d11ba36ed48d86057d507cc8d5567"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">llvm::BasicBlock::getInstList</a></div><div class="ttdeci">const InstListType &amp; getInstList() const </div><div class="ttdoc">Return the underlying instruction list container. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00214">BasicBlock.h:214</a></div></div>
<div class="ttc" id="DenseSet_8h_html"><div class="ttname"><a href="DenseSet_8h.html">DenseSet.h</a></div></div>
<div class="ttc" id="classllvm_1_1ICmpInst_html"><div class="ttname"><a href="classllvm_1_1ICmpInst.html">llvm::ICmpInst</a></div><div class="ttdoc">Represent an integer comparison operator. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00911">Instructions.h:911</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_aa888e3661c809163273aca85ded4d846"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#aa888e3661c809163273aca85ded4d846">llvm::ScalarEvolution::getMinusSCEV</a></div><div class="ttdeci">const SCEV * getMinusSCEV(const SCEV *LHS, const SCEV *RHS, SCEV::NoWrapFlags Flags=SCEV::FlagAnyWrap)</div><div class="ttdoc">getMinusSCEV - Return LHS-RHS. Minus is represented in SCEV as A+B*-1. </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l02790">ScalarEvolution.cpp:2790</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05">llvm::CmpInst::Predicate</a></div><div class="ttdeci">Predicate</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00651">InstrTypes.h:651</a></div></div>
<div class="ttc" id="classllvm_1_1iplist_html_a35c71de7e8bbe3c0353d042beb58263f"><div class="ttname"><a href="classllvm_1_1iplist.html#a35c71de7e8bbe3c0353d042beb58263f">llvm::iplist::insert</a></div><div class="ttdeci">iterator insert(iterator where, NodeTy *New)</div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00412">ilist.h:412</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVExpander_html_a583d3ca95f83216d632a4d1ae0330dd0"><div class="ttname"><a href="classllvm_1_1SCEVExpander.html#a583d3ca95f83216d632a4d1ae0330dd0">llvm::SCEVExpander::expandCodeFor</a></div><div class="ttdeci">Value * expandCodeFor(const SCEV *SH, Type *Ty, Instruction *I)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpander_8cpp_source.html#l01468">ScalarEvolutionExpander.cpp:1468</a></div></div>
<div class="ttc" id="classllvm_1_1SmallBitVector_html_aec7155f96e634c2d65d82c5be3285a5f"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html#aec7155f96e634c2d65d82c5be3285a5f">llvm::SmallBitVector::find_next</a></div><div class="ttdeci">int find_next(unsigned Prev) const </div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00229">SmallBitVector.h:229</a></div></div>
<div class="ttc" id="Target_2X86_2README_8txt_html_a0ed5c5d6ff68f354e354920a3680185c"><div class="ttname"><a href="Target_2X86_2README_8txt.html#a0ed5c5d6ff68f354e354920a3680185c">Sum</a></div><div class="ttdeci">return Sum</div><div class="ttdef"><b>Definition:</b> <a href="Target_2X86_2README_8txt_source.html#l00112">Target/X86/README.txt:112</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_ac2da0a3b05aba66c95b7f0b91b5c7c55"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#ac2da0a3b05aba66c95b7f0b91b5c7c55">ExtractImmediate</a></div><div class="ttdeci">static int64_t ExtractImmediate(const SCEV *&amp;S, ScalarEvolution &amp;SE)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l00559">LoopStrengthReduce.cpp:559</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a482ad0f63ec145fdba2497e2298a5aa1"><div class="ttname"><a href="classllvm_1_1APInt.html#a482ad0f63ec145fdba2497e2298a5aa1">llvm::APInt::sdiv</a></div><div class="ttdeci">APInt LLVM_ATTRIBUTE_UNUSED_RESULT sdiv(const APInt &amp;RHS) const </div><div class="ttdoc">Signed division function for APInt. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8cpp_source.html#l01879">APInt.cpp:1879</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a997ff6a1758bf732b9b263fc61011644"><div class="ttname"><a href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">llvm::User::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00088">User.h:88</a></div></div>
<div class="ttc" id="classllvm_1_1LoopBase_html_a92a38e2e3412bde7fd2b71db212b61aa"><div class="ttname"><a href="classllvm_1_1LoopBase.html#a92a38e2e3412bde7fd2b71db212b61aa">llvm::LoopBase::contains</a></div><div class="ttdeci">bool contains(const LoopT *L) const </div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00104">LoopInfo.h:104</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a4f07d245cf5f31e5b86ee80c06ab949a"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a4f07d245cf5f31e5b86ee80c06ab949a">getAccessType</a></div><div class="ttdeci">static Type * getAccessType(const Instruction *Inst)</div><div class="ttdoc">getAccessType - Return the type of the memory being accessed. </div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l00636">LoopStrengthReduce.cpp:636</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a8afd4995fae596b2c86eeed85b3d388b"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a8afd4995fae596b2c86eeed85b3d388b">llvm::CmpInst::getPredicate</a></div><div class="ttdeci">Predicate getPredicate() const </div><div class="ttdoc">Return the predicate for this instruction. </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00714">InstrTypes.h:714</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSetImpl_html_a095445850ef2c64e96b4c05120cecf66"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a095445850ef2c64e96b4c05120cecf66">llvm::SmallPtrSetImpl::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00074">SmallPtrSet.h:74</a></div></div>
<div class="ttc" id="Writer_8h_html"><div class="ttname"><a href="Writer_8h.html">Writer.h</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html_a4d51384de6e1798bb6aa875aebeea9f0"><div class="ttname"><a href="classllvm_1_1Constant.html#a4d51384de6e1798bb6aa875aebeea9f0">llvm::Constant::getAllOnesValue</a></div><div class="ttdeci">static Constant * getAllOnesValue(Type *Ty)</div><div class="ttdoc">Get the all ones value. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00163">Constants.cpp:163</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_ad696953257cf1c4e5bd12d02146e7287"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#ad696953257cf1c4e5bd12d02146e7287">llvm::SmallVectorTemplateCommon&lt; T &gt;::rend</a></div><div class="ttdeci">reverse_iterator rend()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00124">SmallVector.h:124</a></div></div>
<div class="ttc" id="README__ALTIVEC_8txt_html_afb354c8aea0150628f8aa06c7f4a4168"><div class="ttname"><a href="README__ALTIVEC_8txt.html#afb354c8aea0150628f8aa06c7f4a4168">f</a></div><div class="ttdeci">vector float f(vector float a, vector float b)</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00205">README_ALTIVEC.txt:205</a></div></div>
<div class="ttc" id="classllvm_1_1DominatorTree_html_a6fe9272dc67fe2ff4cafc33b895c4a6c"><div class="ttname"><a href="classllvm_1_1DominatorTree.html#a6fe9272dc67fe2ff4cafc33b895c4a6c">llvm::DominatorTree::dominates</a></div><div class="ttdeci">bool dominates(const DomTreeNode *A, const DomTreeNode *B) const </div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00801">Dominators.h:801</a></div></div>
<div class="ttc" id="PassSupport_8h_html_af0564bcdde2dd4400c670ca278c6035f"><div class="ttname"><a href="PassSupport_8h.html#af0564bcdde2dd4400c670ca278c6035f">INITIALIZE_AG_DEPENDENCY</a></div><div class="ttdeci">#define INITIALIZE_AG_DEPENDENCY(depName)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00169">PassSupport.h:169</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a669d55980a7d4b6307b94596deeb0b1f"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a669d55980a7d4b6307b94596deeb0b1f">llvm::SmallVectorImpl::append</a></div><div class="ttdeci">void append(in_iter in_start, in_iter in_end)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00445">SmallVector.h:445</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a2eba483f5cc876e824aa6c085736086b"><div class="ttname"><a href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">llvm::Type::isPointerTy</a></div><div class="ttdeci">bool isPointerTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00220">Type.h:220</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a18c110c35e9133222a37b28d30f8a90f"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">llvm::SmallVectorImpl::erase</a></div><div class="ttdeci">iterator erase(iterator I)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00478">SmallVector.h:478</a></div></div>
<div class="ttc" id="classT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_aca414c43a6d42c13998208463637a20d"><div class="ttname"><a href="classllvm_1_1PHINode.html#aca414c43a6d42c13998208463637a20d">llvm::PHINode::getIncomingValueNumForOperand</a></div><div class="ttdeci">static unsigned getIncomingValueNumForOperand(unsigned i)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02068">Instructions.h:2068</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a1509f8a0c11e955037b00ce7542e24a7"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a1509f8a0c11e955037b00ce7542e24a7">isAddSExtable</a></div><div class="ttdeci">static bool isAddSExtable(const SCEVAddExpr *A, ScalarEvolution &amp;SE)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l00446">LoopStrengthReduce.cpp:446</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVExpander_html_ab35b69a7c369aadf7ac052ab21ad2ec6"><div class="ttname"><a href="classllvm_1_1SCEVExpander.html#ab35b69a7c369aadf7ac052ab21ad2ec6">llvm::SCEVExpander::replaceCongruentIVs</a></div><div class="ttdeci">unsigned replaceCongruentIVs(Loop *L, const DominatorTree *DT, SmallVectorImpl&lt; WeakVH &gt; &amp;DeadInsts, const TargetTransformInfo *TTI=NULL)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpander_8cpp_source.html#l01580">ScalarEvolutionExpander.cpp:1580</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_aab38583da48d509785e3571edec58183"><div class="ttname"><a href="classllvm_1_1APInt.html#aab38583da48d509785e3571edec58183">llvm::APInt::srem</a></div><div class="ttdeci">APInt LLVM_ATTRIBUTE_UNUSED_RESULT srem(const APInt &amp;RHS) const </div><div class="ttdoc">Function for signed remainder operation. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8cpp_source.html#l01927">APInt.cpp:1927</a></div></div>
<div class="ttc" id="namespacellvm_html_a472515fc67a5fb572afeb00aa2609cca"><div class="ttname"><a href="namespacellvm.html#a472515fc67a5fb572afeb00aa2609cca">llvm::LoopSimplifyID</a></div><div class="ttdeci">char &amp; LoopSimplifyID</div><div class="ttdef"><b>Definition:</b> <a href="LoopSimplify_8cpp_source.html#l00123">LoopSimplify.cpp:123</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVExpander_html_a346ef44d7050fbf42b5d871ba5006b80"><div class="ttname"><a href="classllvm_1_1SCEVExpander.html#a346ef44d7050fbf42b5d871ba5006b80">llvm::SCEVExpander::setChainedPhi</a></div><div class="ttdeci">void setChainedPhi(PHINode *PN)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpander_8h_source.html#l00188">ScalarEvolutionExpander.h:188</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSetIterator_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSetIterator.html">llvm::SmallPtrSetIterator</a></div><div class="ttdoc">SmallPtrSetIterator - This implements a const_iterator for SmallPtrSet. </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00174">SmallPtrSet.h:174</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSetImpl_html_aa72472422d95c7052d62432ec279ff85"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#aa72472422d95c7052d62432ec279ff85">llvm::SmallPtrSetImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00077">SmallPtrSet.h:77</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a1fc3b7fba8416494790a73f61248b553"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a1fc3b7fba8416494790a73f61248b553">getExactSDiv</a></div><div class="ttdeci">static const SCEV * getExactSDiv(const SCEV *LHS, const SCEV *RHS, ScalarEvolution &amp;SE, bool IgnoreSignificantBits=false)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l00467">LoopStrengthReduce.cpp:467</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a699a66e504b48fdeff124e82f6c61917"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a699a66e504b48fdeff124e82f6c61917">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, KeyInfoT &gt;, KeyT, ValueT, KeyInfoT &gt;::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const std::pair&lt; KeyT, ValueT &gt; &amp;KV)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00153">DenseMap.h:153</a></div></div>
<div class="ttc" id="classllvm_1_1Pass_html_ab78af013d3a11515403da8517f8f3d4a"><div class="ttname"><a href="classllvm_1_1Pass.html#ab78af013d3a11515403da8517f8f3d4a">llvm::Pass::getAnalysis</a></div><div class="ttdeci">AnalysisType &amp; getAnalysis() const </div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00199">PassAnalysisSupport.h:199</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html"><div class="ttname"><a href="classllvm_1_1GlobalValue.html">llvm::GlobalValue</a></div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00029">GlobalValue.h:29</a></div></div>
<div class="ttc" id="classllvm_1_1IntegerType_html_a14f7b4f1aed38192fb6b7772eb506bdb"><div class="ttname"><a href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">llvm::IntegerType::get</a></div><div class="ttdeci">static IntegerType * get(LLVMContext &amp;C, unsigned NumBits)</div><div class="ttdoc">Get or create an IntegerType instance. </div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00305">Type.cpp:305</a></div></div>
<div class="ttc" id="classllvm_1_1AddOperator_html"><div class="ttname"><a href="classllvm_1_1AddOperator.html">llvm::AddOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="Operator_8h_source.html#l00328">Operator.h:328</a></div></div>
<div class="ttc" id="classllvm_1_1DenseSet_html_abbac11d593e7d40675ac3dfe1dd324bd"><div class="ttname"><a href="classllvm_1_1DenseSet.html#abbac11d593e7d40675ac3dfe1dd324bd">llvm::DenseSet::count</a></div><div class="ttdeci">bool count(const ValueT &amp;V) const </div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00045">DenseSet.h:45</a></div></div>
<div class="ttc" id="namespacellvm_1_1PPCISD_html_a69ad64696d1df3be05f01dfb67f5bc66a2ae057e4de45c51c89b7e5dc5053df62"><div class="ttname"><a href="namespacellvm_1_1PPCISD.html#a69ad64696d1df3be05f01dfb67f5bc66a2ae057e4de45c51c89b7e5dc5053df62">llvm::PPCISD::SC</a></div><div class="ttdef"><b>Definition:</b> <a href="PPCISelLowering_8h_source.html#l00247">PPCISelLowering.h:247</a></div></div>
<div class="ttc" id="classllvm_1_1SmallSetVector_html"><div class="ttname"><a href="classllvm_1_1SmallSetVector.html">llvm::SmallSetVector</a></div><div class="ttdoc">A SetVector that performs no allocations if smaller than a certain size. </div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00218">SetVector.h:218</a></div></div>
<div class="ttc" id="classllvm_1_1SmallBitVector_html_a7d809e29a928b187955f2858a9d98583"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html#a7d809e29a928b187955f2858a9d98583">llvm::SmallBitVector::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdoc">clear - Clear all bits. </div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00246">SmallBitVector.h:246</a></div></div>
<div class="ttc" id="classllvm_1_1DenseSet_html_ab658e5485796a5ff90bd2dc3fca7d6d2"><div class="ttname"><a href="classllvm_1_1DenseSet.html#ab658e5485796a5ff90bd2dc3fca7d6d2">llvm::DenseSet::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const ValueT &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00117">DenseSet.h:117</a></div></div>
<div class="ttc" id="classllvm_1_1ilist__iterator_html"><div class="ttname"><a href="classllvm_1_1ilist__iterator.html">llvm::ilist_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00050">ilist.h:50</a></div></div>
<div class="ttc" id="Target_2ARM_2README_8txt_html_a1b45f45820a60c09244a87eb59824aec"><div class="ttname"><a href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a></div><div class="ttdeci">add sub stmia L5 ldr r0 bl L_printf $stub Instead of a and a wouldn t it be better to do three moves *Return an aggregate type is even return S</div><div class="ttdef"><b>Definition:</b> <a href="Target_2ARM_2README_8txt_source.html#l00197">Target/ARM/README.txt:197</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html">llvm::SmallPtrSet</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00236">SmallPtrSet.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html"><div class="ttname"><a href="classllvm_1_1ConstantInt.html">llvm::ConstantInt</a></div><div class="ttdoc">Class for constant integers. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00051">Constants.h:51</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a73349916f7e54a6b988a3646c7a02e90ab2f7e70ed06cb0e8b85773f9d858e9c3"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ab2f7e70ed06cb0e8b85773f9d858e9c3">llvm::Intrinsic::prefetch</a></div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l02376">Intrinsics.h:2376</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_ab64b1c61d33b56b06309856e9f9ccf9d"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#ab64b1c61d33b56b06309856e9f9ccf9d">isHighCostExpansion</a></div><div class="ttdeci">static bool isHighCostExpansion(const SCEV *S, SmallPtrSet&lt; const SCEV *, 8 &gt; &amp;Processed, ScalarEvolution &amp;SE)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l00685">LoopStrengthReduce.cpp:685</a></div></div>
<div class="ttc" id="classllvm_1_1TargetTransformInfo_html"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html">llvm::TargetTransformInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00039">TargetTransformInfo.h:39</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_aba6a4cc4ed6d6fef3664b8d65ef04820"><div class="ttname"><a href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">llvm::PHINode::getIncomingValue</a></div><div class="ttdeci">Value * getIncomingValue(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02059">Instructions.h:2059</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a215e6a56a2614297e0d0fd643464ba11"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a215e6a56a2614297e0d0fd643464ba11">StressIVChain</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; StressIVChain(&quot;stress-ivchain&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Stress test LSR IV chains&quot;))</div></div>
<div class="ttc" id="Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00029">Target/README.txt:29</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html_a053677ebc731b47a534f841b11b5cf0c"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#a053677ebc731b47a534f841b11b5cf0c">llvm::AnalysisUsage::addRequiredID</a></div><div class="ttdeci">AnalysisUsage &amp; addRequiredID(const void *ID)</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8cpp_source.html#l00262">Pass.cpp:262</a></div></div>
<div class="ttc" id="namespacellvm_1_1EngineKind_html_a9df47239a42cd9621ac26d9ecbd57441"><div class="ttname"><a href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">llvm::EngineKind::Kind</a></div><div class="ttdeci">Kind</div><div class="ttdef"><b>Definition:</b> <a href="ExecutionEngine_2ExecutionEngine_8h_source.html#l00499">ExecutionEngine/ExecutionEngine.h:499</a></div></div>
<div class="ttc" id="classllvm_1_1IVStrideUse_html_aa6188247cf9c5836de214f8bdddd8a9e"><div class="ttname"><a href="classllvm_1_1IVStrideUse.html#aa6188247cf9c5836de214f8bdddd8a9e">llvm::IVStrideUse::getOperandValToReplace</a></div><div class="ttdeci">Value * getOperandValToReplace() const </div><div class="ttdef"><b>Definition:</b> <a href="IVUsers_8h_source.html#l00055">IVUsers.h:55</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00880">SmallVector.h:880</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a0cf3748dba54f931bb1241ae4adc76bc"><div class="ttname"><a href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00111">Value.h:111</a></div></div>
<div class="ttc" id="classllvm_1_1LoopInfo_html"><div class="ttname"><a href="classllvm_1_1LoopInfo.html">llvm::LoopInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00589">LoopInfo.h:589</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html">llvm::BinaryOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00138">InstrTypes.h:138</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_a38c440751f1bf5f19bc12b95f8f0f2a6"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#a38c440751f1bf5f19bc12b95f8f0f2a6">llvm::ScalarEvolution::getNoopOrSignExtend</a></div><div class="ttdeci">const SCEV * getNoopOrSignExtend(const SCEV *V, Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l02855">ScalarEvolution.cpp:2855</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05a15ae464950ac676919c2f0c7aafc706c"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a15ae464950ac676919c2f0c7aafc706c">llvm::CmpInst::ICMP_SLT</a></div><div class="ttdoc">signed less than </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00680">InstrTypes.h:680</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVExpander_html_abb16499dadbe473c428b55f72850ef97"><div class="ttname"><a href="classllvm_1_1SCEVExpander.html#abb16499dadbe473c428b55f72850ef97">llvm::SCEVExpander::setIVIncInsertPos</a></div><div class="ttdeci">void setIVIncInsertPos(const Loop *L, Instruction *Pos)</div><div class="ttdoc">setIVIncInsertPos - Set the current IV increment loop and position. </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpander_8h_source.html#l00142">ScalarEvolutionExpander.h:142</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_ab2b9d94a07d4810717ff828688f7f7aa"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#ab2b9d94a07d4810717ff828688f7f7aa">getWideOperand</a></div><div class="ttdeci">static Value * getWideOperand(Value *Oper)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l02398">LoopStrengthReduce.cpp:2398</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_ab0fdfb9cef4a80aac8ae338e1d304131"><div class="ttname"><a href="classllvm_1_1CmpInst.html#ab0fdfb9cef4a80aac8ae338e1d304131">llvm::CmpInst::isTrueWhenEqual</a></div><div class="ttdeci">bool isTrueWhenEqual() const </div><div class="ttdoc">Determine if this is true when both operands are the same. </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00792">InstrTypes.h:792</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_aeebb29dd5a7aaf9b4546fec69c43653b"><div class="ttname"><a href="classllvm_1_1APInt.html#aeebb29dd5a7aaf9b4546fec69c43653b">llvm::APInt::isStrictlyPositive</a></div><div class="ttdeci">bool isStrictlyPositive() const </div><div class="ttdoc">Determine if this APInt Value is positive. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00335">APInt.h:335</a></div></div>
<div class="ttc" id="classllvm_1_1LoopPass_html"><div class="ttname"><a href="classllvm_1_1LoopPass.html">llvm::LoopPass</a></div><div class="ttdef"><b>Definition:</b> <a href="LoopPass_8h_source.html#l00029">LoopPass.h:29</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a9105541412dab869e18b3cceebfff07d"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">llvm::ConstantInt::get</a></div><div class="ttdeci">static Constant * get(Type *Ty, uint64_t V, bool isSigned=false)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00492">Constants.cpp:492</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_ad736fb9b585509388546c12617def38f"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#ad736fb9b585509388546c12617def38f">llvm::ConstantInt::getSigned</a></div><div class="ttdeci">static ConstantInt * getSigned(IntegerType *Ty, int64_t V)</div><div class="ttdoc">Get a ConstantInt for a specific signed value. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00507">Constants.cpp:507</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVConstant_html_a64f0133adf37f9513005465580a19a66"><div class="ttname"><a href="classllvm_1_1SCEVConstant.html#a64f0133adf37f9513005465580a19a66">llvm::SCEVConstant::getValue</a></div><div class="ttdeci">ConstantInt * getValue() const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00044">ScalarEvolutionExpressions.h:44</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantFP_html_a5eb8f7a5d3cfdd127ad9db2e425e14eb"><div class="ttname"><a href="classllvm_1_1ConstantFP.html#a5eb8f7a5d3cfdd127ad9db2e425e14eb">llvm::ConstantFP::get</a></div><div class="ttdeci">static Constant * get(Type *Ty, double V)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00557">Constants.cpp:557</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a5fa9b8e1842b354f64c1ba6be0a4a17f"><div class="ttname"><a href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">llvm::User::setOperand</a></div><div class="ttdeci">void setOperand(unsigned i, Value *Val)</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00092">User.h:92</a></div></div>
<div class="ttc" id="namespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs - Return a circular-buffered debug stream. </div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00101">Debug.cpp:101</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html_ac8ddb745480a7e75a3862ddf0be3a298"><div class="ttname"><a href="classllvm_1_1Constant.html#ac8ddb745480a7e75a3862ddf0be3a298">llvm::Constant::isAllOnesValue</a></div><div class="ttdeci">bool isAllOnesValue() const </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00088">Constants.cpp:88</a></div></div>
<div class="ttc" id="namespacestd_html_ab8424022895aee3e366fb9a32f2883cb"><div class="ttname"><a href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a></div><div class="ttdeci">void swap(llvm::BitVector &amp;LHS, llvm::BitVector &amp;RHS)</div><div class="ttdoc">Implement std::swap in terms of BitVector swap. </div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00591">BitVector.h:591</a></div></div>
<div class="ttc" id="classllvm_1_1SmallBitVector_html_a4858616488fffbdebc85aad588b175c4"><div class="ttname"><a href="classllvm_1_1SmallBitVector.html#a4858616488fffbdebc85aad588b175c4">llvm::SmallBitVector::size</a></div><div class="ttdeci">size_t size() const </div><div class="ttdoc">size - Returns the number of bits in this bitvector. </div><div class="ttdef"><b>Definition:</b> <a href="SmallBitVector_8h_source.html#l00173">SmallBitVector.h:173</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05a2751d6136a2819749dcef65dc19a4246"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a2751d6136a2819749dcef65dc19a4246">llvm::CmpInst::ICMP_SLE</a></div><div class="ttdoc">signed less or equal </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00681">InstrTypes.h:681</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html"><div class="ttname"><a href="classllvm_1_1APInt.html">llvm::APInt</a></div><div class="ttdoc">Class for arbitrary precision integers. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00075">APInt.h:75</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVAddExpr_html"><div class="ttname"><a href="classllvm_1_1SCEVAddExpr.html">llvm::SCEVAddExpr</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00202">ScalarEvolutionExpressions.h:202</a></div></div>
<div class="ttc" id="CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="CodeGen_2README_8txt_source.html#l00036">CodeGen/README.txt:36</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_a63d4f693eb205bb9d556e067464f943c"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#a63d4f693eb205bb9d556e067464f943c">llvm::ScalarEvolution::getSignExtendExpr</a></div><div class="ttdeci">const SCEV * getSignExtendExpr(const SCEV *Op, Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l01159">ScalarEvolution.cpp:1159</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a21960167f529265a1cb02ac1e8ad10f6"><div class="ttname"><a href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">llvm::PHINode::getIncomingValueForBlock</a></div><div class="ttdeci">Value * getIncomingValueForBlock(const BasicBlock *BB) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02139">Instructions.h:2139</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVSMaxExpr_html"><div class="ttname"><a href="classllvm_1_1SCEVSMaxExpr.html">llvm::SCEVSMaxExpr</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00366">ScalarEvolutionExpressions.h:366</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_ad291a495c56b2c53e65dc8afe823b073"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#ad291a495c56b2c53e65dc8afe823b073">isAddressUse</a></div><div class="ttdeci">static bool isAddressUse(Instruction *Inst, Value *OperandVal)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l00612">LoopStrengthReduce.cpp:612</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a73349916f7e54a6b988a3646c7a02e90a75f892c9958157f8cc32c269e880a8b7"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90a75f892c9958157f8cc32c269e880a8b7">llvm::Intrinsic::x86_sse2_storeu_pd</a></div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l03049">Intrinsics.h:3049</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVExpander_html"><div class="ttname"><a href="classllvm_1_1SCEVExpander.html">llvm::SCEVExpander</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpander_8h_source.html#l00037">ScalarEvolutionExpander.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_a23541ecba66207184eaf2279a70c5b12"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#a23541ecba66207184eaf2279a70c5b12">llvm::ScalarEvolution::getAddExpr</a></div><div class="ttdeci">const SCEV * getAddExpr(SmallVectorImpl&lt; const SCEV * &gt; &amp;Ops, SCEV::NoWrapFlags Flags=SCEV::FlagAnyWrap)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l01461">ScalarEvolution.cpp:1461</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a175f1f53cc9c3619505ffbd13aca087f"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a></div><div class="ttdeci">loop Loop Strength Reduction</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l04882">LoopStrengthReduce.cpp:4882</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVConstant_html_a11dea30ae8b3c0ce2d398696b4af3373"><div class="ttname"><a href="classllvm_1_1SCEVConstant.html#a11dea30ae8b3c0ce2d398696b4af3373">llvm::SCEVConstant::getType</a></div><div class="ttdeci">Type * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00046">ScalarEvolutionExpressions.h:46</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a8a045d250952c0867382a9840ee18fdf"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">llvm::SmallVectorTemplateCommon&lt; T &gt;::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00112">SmallVector.h:112</a></div></div>
<div class="ttc" id="ValueHandle_8h_html"><div class="ttname"><a href="ValueHandle_8h.html">ValueHandle.h</a></div></div>
<div class="ttc" id="VirtRegMap_8cpp_html_a1ad52109a2ff430460c8776286b97b2e"><div class="ttname"><a href="VirtRegMap_8cpp.html#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a></div><div class="ttdeci">Virtual Register Rewriter</div><div class="ttdef"><b>Definition:</b> <a href="VirtRegMap_8cpp_source.html#l00185">VirtRegMap.cpp:185</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a413abcab8dbc3900fc2fde96a5d8fca6"><div class="ttname"><a href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">llvm::Value::use_begin</a></div><div class="ttdeci">use_iterator use_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00150">Value.h:150</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a21260f8037e665d235ace5718cf68bc4"><div class="ttname"><a href="classllvm_1_1APInt.html#a21260f8037e665d235ace5718cf68bc4">llvm::APInt::isAllOnesValue</a></div><div class="ttdeci">bool isAllOnesValue() const </div><div class="ttdoc">Determine if all bits are set. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00340">APInt.h:340</a></div></div>
<div class="ttc" id="classllvm_1_1TargetTransformInfo_html_a33e1d30087a69bde585406645b12b4f7"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a33e1d30087a69bde585406645b12b4f7">llvm::TargetTransformInfo::isLegalICmpImmediate</a></div><div class="ttdeci">virtual bool isLegalICmpImmediate(int64_t Imm) const </div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00108">TargetTransformInfo.cpp:108</a></div></div>
<div class="ttc" id="Transforms_2Scalar_8h_html"><div class="ttname"><a href="Transforms_2Scalar_8h.html">Scalar.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a7ef747666d6938cb47b3c5544011a4e5add4a8d5cb0d78c9be22d01e1546bafc6"><div class="ttname"><a href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5add4a8d5cb0d78c9be22d01e1546bafc6">llvm::scZeroExtend</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00029">ScalarEvolutionExpressions.h:29</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html_a84309bb8c34c8bc5694ec5d48dd8668f"><div class="ttname"><a href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">llvm::BranchInst::getCondition</a></div><div class="ttdeci">Value * getCondition() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02394">Instructions.h:2394</a></div></div>
<div class="ttc" id="classllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l01149">CommandLine.h:1149</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a953625d369b127cd29e19f9c73da567f"><div class="ttname"><a href="classllvm_1_1APInt.html#a953625d369b127cd29e19f9c73da567f">llvm::APInt::isMinSignedValue</a></div><div class="ttdeci">bool isMinSignedValue() const </div><div class="ttdoc">Determine if this is the smallest signed value. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00371">APInt.h:371</a></div></div>
<div class="ttc" id="classllvm_1_1SCEV_html"><div class="ttname"><a href="classllvm_1_1SCEV.html">llvm::SCEV</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8h_source.html#l00057">ScalarEvolution.h:57</a></div></div>
<div class="ttc" id="namespacellvm_html_a7ef747666d6938cb47b3c5544011a4e5a3a80b1a7dda48464be1849ee1fb85868"><div class="ttname"><a href="namespacellvm.html#a7ef747666d6938cb47b3c5544011a4e5a3a80b1a7dda48464be1849ee1fb85868">llvm::scAddExpr</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00029">ScalarEvolutionExpressions.h:29</a></div></div>
<div class="ttc" id="classllvm_1_1Loop_html"><div class="ttname"><a href="classllvm_1_1Loop.html">llvm::Loop</a></div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00338">LoopInfo.h:338</a></div></div>
<div class="ttc" id="classllvm_1_1TargetTransformInfo_html_a6b125b01caa4a2ad5c9b621d6540f568"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a6b125b01caa4a2ad5c9b621d6540f568">llvm::TargetTransformInfo::isLegalAddressingMode</a></div><div class="ttdeci">virtual bool isLegalAddressingMode(Type *Ty, GlobalValue *BaseGV, int64_t BaseOffset, bool HasBaseReg, int64_t Scale) const </div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00112">TargetTransformInfo.cpp:112</a></div></div>
<div class="ttc" id="classllvm_1_1CastInst_html_a06dc25da1f16f389f5244304e8d33127"><div class="ttname"><a href="classllvm_1_1CastInst.html#a06dc25da1f16f389f5244304e8d33127">llvm::CastInst::getCastOpcode</a></div><div class="ttdeci">static Instruction::CastOps getCastOpcode(const Value *Val, bool SrcIsSigned, Type *Ty, bool DstIsSigned)</div><div class="ttdoc">Infer the opcode for cast operand and type. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02650">Instructions.cpp:2650</a></div></div>
<div class="ttc" id="MD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00054">MD5.cpp:54</a></div></div>
<div class="ttc" id="regcomp_8c_html_a0240ac851181b84ac374872dc5434ee4"><div class="ttname"><a href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a></div><div class="ttdeci">#define N</div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a5cb76a65b6524dba1493dd2b9dc3abbe"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">llvm::BasicBlock::getTerminator</a></div><div class="ttdeci">TerminatorInst * getTerminator()</div><div class="ttdoc">Returns the terminator instruction if the block is well formed or null if the block is not well forme...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00120">BasicBlock.cpp:120</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a3075a9eef753018bed561df31f38dc23"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a3075a9eef753018bed561df31f38dc23">llvm::BasicBlock::isLandingPad</a></div><div class="ttdeci">bool isLandingPad() const </div><div class="ttdoc">Return true if this basic block is a landing pad. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00360">BasicBlock.cpp:360</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a085b82f074c28030fb8e194377ed2d0c"><div class="ttname"><a href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">llvm::Value::hasOneUse</a></div><div class="ttdeci">bool hasOneUse() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00161">Value.h:161</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_ab383721217ad2417cded7ae55f3a46d8"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#ab383721217ad2417cded7ae55f3a46d8">getExprBase</a></div><div class="ttdeci">static const SCEV * getExprBase(const SCEV *S)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l02422">LoopStrengthReduce.cpp:2422</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_aa226dcb218003bb80a72a75e27aa0ff3"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#aa226dcb218003bb80a72a75e27aa0ff3">INITIALIZE_PASS_BEGIN</a></div><div class="ttdeci">INITIALIZE_PASS_BEGIN(LoopStrengthReduce,&quot;loop-reduce&quot;,&quot;Loop Strength Reduction&quot;, false, false) INITIALIZE_PASS_END(LoopStrengthReduce</div></div>
<div class="ttc" id="classllvm_1_1UIToFPInst_html"><div class="ttname"><a href="classllvm_1_1UIToFPInst.html">llvm::UIToFPInst</a></div><div class="ttdoc">This class represents a cast unsigned integer to floating point. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03355">Instructions.h:3355</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a7f055d0b03ebf1d6a5988b178e9b8f4f"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a7f055d0b03ebf1d6a5988b178e9b8f4f">llvm::SmallPtrSet::end</a></div><div class="ttdeci">iterator end() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00279">SmallPtrSet.h:279</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a102d0ad36060677286c3aefb812e5512"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a102d0ad36060677286c3aefb812e5512">llvm::SmallVectorImpl::resize</a></div><div class="ttdeci">void resize(unsigned N)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00401">SmallVector.h:401</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVUMaxExpr_html"><div class="ttname"><a href="classllvm_1_1SCEVUMaxExpr.html">llvm::SCEVUMaxExpr</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00387">ScalarEvolutionExpressions.h:387</a></div></div>
<div class="ttc" id="BasicBlockUtils_8h_html"><div class="ttname"><a href="BasicBlockUtils_8h.html">BasicBlockUtils.h</a></div></div>
<div class="ttc" id="classllvm_1_1DominatorTree_html_a7b8f5876ec15b49abf76ae81cefac1f6"><div class="ttname"><a href="classllvm_1_1DominatorTree.html#a7b8f5876ec15b49abf76ae81cefac1f6">llvm::DominatorTree::findNearestCommonDominator</a></div><div class="ttdeci">BasicBlock * findNearestCommonDominator(BasicBlock *A, BasicBlock *B)</div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00828">Dominators.h:828</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_a1f2303df9bbee2233c11d61c2f6f7930"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#a1f2303df9bbee2233c11d61c2f6f7930">llvm::SmallVectorTemplateBase&lt; T, isPodLike&lt; T &gt;::value &gt;::pop_back</a></div><div class="ttdeci">void pop_back()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00260">SmallVector.h:260</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_a4a4628e91a9c6a339fa61105614fac76"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a4a4628e91a9c6a339fa61105614fac76">llvm::BinaryOperator::Create</a></div><div class="ttdeci">static BinaryOperator * Create(BinaryOps Op, Value *S1, Value *S2, const Twine &amp;Name=Twine(), Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01834">Instructions.cpp:1834</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8">llvm::A64CC::NV</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00046">AArch64BaseInfo.h:46</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVAddRecExpr_html_a7fcbbc51eef313e675a2442bb2053ae9"><div class="ttname"><a href="classllvm_1_1SCEVAddRecExpr.html#a7fcbbc51eef313e675a2442bb2053ae9">llvm::SCEVAddRecExpr::getLoop</a></div><div class="ttdeci">const Loop * getLoop() const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00294">ScalarEvolutionExpressions.h:294</a></div></div>
<div class="ttc" id="classllvm_1_1LoopBase_html_a433660a96d8e96997856d16c5930b096"><div class="ttname"><a href="classllvm_1_1LoopBase.html#a433660a96d8e96997856d16c5930b096">llvm::LoopBase::getLoopDepth</a></div><div class="ttdeci">unsigned getLoopDepth() const </div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00088">LoopInfo.h:88</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a55480bacd3e194a605de7c5add4f3637"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a55480bacd3e194a605de7c5add4f3637">isProfitableChain</a></div><div class="ttdeci">static bool isProfitableChain(IVChain &amp;Chain, SmallPtrSet&lt; Instruction *, 4 &gt; &amp;Users, ScalarEvolution &amp;SE, const TargetTransformInfo &amp;TTI)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l02490">LoopStrengthReduce.cpp:2490</a></div></div>
<div class="ttc" id="classllvm_1_1IVStrideUse_html_a8433a09d9b66df4f5c8a4d1414dc8ec9"><div class="ttname"><a href="classllvm_1_1IVStrideUse.html#a8433a09d9b66df4f5c8a4d1414dc8ec9">llvm::IVStrideUse::transformToPostInc</a></div><div class="ttdeci">void transformToPostInc(const Loop *L)</div><div class="ttdef"><b>Definition:</b> <a href="IVUsers_8cpp_source.html#l00326">IVUsers.cpp:326</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a6d827fc34f1b4371a0b7183d3ca5bcac"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a6d827fc34f1b4371a0b7183d3ca5bcac">reduce</a></div><div class="ttdeci">loop reduce</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l04882">LoopStrengthReduce.cpp:4882</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_ad35b9a85ea52062375c0c870be5cd228"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#ad35b9a85ea52062375c0c870be5cd228">canFoldIVIncExpr</a></div><div class="ttdeci">static bool canFoldIVIncExpr(const SCEV *IncExpr, Instruction *UserInst, Value *Operand, const TargetTransformInfo &amp;TTI)</div><div class="ttdoc">Return true if the IVInc can be folded into an addressing mode. </div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l02787">LoopStrengthReduce.cpp:2787</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05aa719225e2de4059f93fd3209e1f48218"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05aa719225e2de4059f93fd3209e1f48218">llvm::CmpInst::ICMP_EQ</a></div><div class="ttdoc">equal </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00672">InstrTypes.h:672</a></div></div>
<div class="ttc" id="SetVector_8h_html"><div class="ttname"><a href="SetVector_8h.html">SetVector.h</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_aecd7aba4460358813feef37d71d5024e"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#aecd7aba4460358813feef37d71d5024e">llvm::ScalarEvolution::getBackedgeTakenCount</a></div><div class="ttdeci">const SCEV * getBackedgeTakenCount(const Loop *L)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l04062">ScalarEvolution.cpp:4062</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ac38c53f76ef532f91f1666c8a87370e9"><div class="ttname"><a href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">llvm::Value::use_empty</a></div><div class="ttdeci">bool use_empty() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00149">Value.h:149</a></div></div>
<div class="ttc" id="classllvm_1_1SIToFPInst_html"><div class="ttname"><a href="classllvm_1_1SIToFPInst.html">llvm::SIToFPInst</a></div><div class="ttdoc">This class represents a cast from signed integer to floating point. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03391">Instructions.h:3391</a></div></div>
<div class="ttc" id="classllvm_1_1Init_html"><div class="ttname"><a href="classllvm_1_1Init.html">llvm::Init</a></div><div class="ttdef"><b>Definition:</b> <a href="Record_8h_source.html#l00415">Record.h:415</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_afc5995e3a119d2cf2da1c4707890d1f3"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#afc5995e3a119d2cf2da1c4707890d1f3">DeleteTriviallyDeadInstructions</a></div><div class="ttdeci">static bool DeleteTriviallyDeadInstructions(SmallVectorImpl&lt; WeakVH &gt; &amp;DeadInsts)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l00752">LoopStrengthReduce.cpp:752</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a73349916f7e54a6b988a3646c7a02e90a3512192e06440d9892109eda52ea7244"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90a3512192e06440d9892109eda52ea7244">llvm::Intrinsic::x86_sse2_storeu_dq</a></div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l03048">Intrinsics.h:3048</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a23aab542398091e1fcfd46b6006d64ac"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a23aab542398091e1fcfd46b6006d64ac">llvm::SmallVectorTemplateCommon&lt; T &gt;::rbegin</a></div><div class="ttdeci">reverse_iterator rbegin()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00122">SmallVector.h:122</a></div></div>
<div class="ttc" id="Local_8h_html"><div class="ttname"><a href="Local_8h.html">Local.h</a></div></div>
<div class="ttc" id="classllvm_1_1SCEV_html_ac08c8d9d93b387dc10681b6f156095bf"><div class="ttname"><a href="classllvm_1_1SCEV.html#ac08c8d9d93b387dc10681b6f156095bf">llvm::SCEV::getSCEVType</a></div><div class="ttdeci">unsigned getSCEVType() const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8h_source.html#l00103">ScalarEvolution.h:103</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00066">Value.h:66</a></div></div>
<div class="ttc" id="namespacellvm_1_1SystemZICMP_html_aced1d1c5b34e96c8c6b9e7a1b284c4a9a096ab3206a2e0dd5713b6a1b2ff76bef"><div class="ttname"><a href="namespacellvm_1_1SystemZICMP.html#aced1d1c5b34e96c8c6b9e7a1b284c4a9a096ab3206a2e0dd5713b6a1b2ff76bef">llvm::SystemZICMP::Any</a></div><div class="ttdef"><b>Definition:</b> <a href="SystemZISelLowering_8h_source.html#l00184">SystemZISelLowering.h:184</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a73349916f7e54a6b988a3646c7a02e90a48512bbd76143cefbda53ba3c7137b94"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90a48512bbd76143cefbda53ba3c7137b94">llvm::Intrinsic::x86_sse2_storel_dq</a></div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l03047">Intrinsics.h:3047</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_a30bd18ac905eacf3601bc6a553a9ff49"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#a30bd18ac905eacf3601bc6a553a9ff49">llvm::ScalarEvolution::getSCEV</a></div><div class="ttdeci">const SCEV * getSCEV(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l02742">ScalarEvolution.cpp:2742</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a021bb7c9aad6003fe8089f6327356c6c"><div class="ttname"><a href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">llvm::Instruction::getOpcode</a></div><div class="ttdeci">unsigned getOpcode() const </div><div class="ttdoc">getOpcode() returns a member of one of the enums like Instruction::Add. </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00083">Instruction.h:83</a></div></div>
<div class="ttc" id="Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="Target_2X86_2README_8txt_source.html#l00297">Target/X86/README.txt:297</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a88366d91f44b9aa74c0408339b23b509"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a88366d91f44b9aa74c0408339b23b509">ExtractSymbol</a></div><div class="ttdeci">static GlobalValue * ExtractSymbol(const SCEV *&amp;S, ScalarEvolution &amp;SE)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l00586">LoopStrengthReduce.cpp:586</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a669d599eeacffd29a09050e2af83bf67"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">llvm::SmallPtrSet::begin</a></div><div class="ttdeci">iterator begin() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00276">SmallPtrSet.h:276</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_af67d1f3a518964d80a109bb3d9d5cf1e"><div class="ttname"><a href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">llvm::Instruction::moveBefore</a></div><div class="ttdeci">void moveBefore(Instruction *MovePos)</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00091">Instruction.cpp:91</a></div></div>
<div class="ttc" id="classllvm_1_1IVStrideUse_html"><div class="ttname"><a href="classllvm_1_1IVStrideUse.html">llvm::IVStrideUse</a></div><div class="ttdef"><b>Definition:</b> <a href="IVUsers_8h_source.html#l00036">IVUsers.h:36</a></div></div>
<div class="ttc" id="classllvm_1_1TargetTransformInfo_html_a547c815fb7093e41196bc8dd0c4b9317"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a547c815fb7093e41196bc8dd0c4b9317">llvm::TargetTransformInfo::isTruncateFree</a></div><div class="ttdeci">virtual bool isTruncateFree(Type *Ty1, Type *Ty2) const </div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00128">TargetTransformInfo.cpp:128</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a838a90156743fcfe8bfce75f554aba21"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a838a90156743fcfe8bfce75f554aba21">CollectSubexprs</a></div><div class="ttdeci">static const SCEV * CollectSubexprs(const SCEV *S, const SCEVConstant *C, SmallVectorImpl&lt; const SCEV * &gt; &amp;Ops, const Loop *L, ScalarEvolution &amp;SE, unsigned Depth=0)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l03134">LoopStrengthReduce.cpp:3134</a></div></div>
<div class="ttc" id="namespacellvm_html_af44ceebb0726227cf82bd54a0bc286fa"><div class="ttname"><a href="namespacellvm.html#af44ceebb0726227cf82bd54a0bc286fa">llvm::DeleteDeadPHIs</a></div><div class="ttdeci">bool DeleteDeadPHIs(BasicBlock *BB, const TargetLibraryInfo *TLI=0)</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00098">BasicBlockUtils.cpp:98</a></div></div>
<div class="ttc" id="namespacellvm_html_a7923e3e207de8bc1d0d6a5091316ddde"><div class="ttname"><a href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a></div><div class="ttdeci">ItTy prior(ItTy it, Dist n)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00167">STLExtras.h:167</a></div></div>
<div class="ttc" id="classllvm_1_1raw__ostream_html"><div class="ttname"><a href="classllvm_1_1raw__ostream.html">llvm::raw_ostream</a></div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8h_source.html#l00031">raw_ostream.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVExpander_html_a6b023424193e702b745da77d6ead62e8"><div class="ttname"><a href="classllvm_1_1SCEVExpander.html#a6b023424193e702b745da77d6ead62e8">llvm::SCEVExpander::isInsertedInstruction</a></div><div class="ttdeci">bool isInsertedInstruction(Instruction *I) const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpander_8h_source.html#l00184">ScalarEvolutionExpander.h:184</a></div></div>
<div class="ttc" id="Debug_8h_html_aef41e8aaf4c60819b30faf396cdf4978"><div class="ttname"><a href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a></div><div class="ttdeci">#define DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00097">Debug.h:97</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVExpander_html_acfd53cb9ef34b9c9d9428fdaf08e0f0b"><div class="ttname"><a href="classllvm_1_1SCEVExpander.html#acfd53cb9ef34b9c9d9428fdaf08e0f0b">llvm::SCEVExpander::disableCanonicalMode</a></div><div class="ttdeci">void disableCanonicalMode()</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpander_8h_source.html#l00170">ScalarEvolutionExpander.h:170</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_ad8e4f5b2ced08ad7d138b598aefdd338"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#ad8e4f5b2ced08ad7d138b598aefdd338">llvm::ScalarEvolution::getUnknown</a></div><div class="ttdeci">const SCEV * getUnknown(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l02629">ScalarEvolution.cpp:2629</a></div></div>
<div class="ttc" id="InlineCost_8cpp_html_ab6ddd0dbb46ded4c06ea4031e40c7fb8"><div class="ttname"><a href="InlineCost_8cpp.html#ab6ddd0dbb46ded4c06ea4031e40c7fb8">cost</a></div><div class="ttdeci">inline cost</div><div class="ttdef"><b>Definition:</b> <a href="InlineCost_8cpp_source.html#l01188">InlineCost.cpp:1188</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVNAryExpr_html_a5877c3a289aa71796140f54b73f654f7"><div class="ttname"><a href="classllvm_1_1SCEVNAryExpr.html#a5877c3a289aa71796140f54b73f654f7">llvm::SCEVNAryExpr::op_end</a></div><div class="ttdeci">op_iterator op_end() const </div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00155">ScalarEvolutionExpressions.h:155</a></div></div>
<div class="ttc" id="SmallBitVector_8h_html"><div class="ttname"><a href="SmallBitVector_8h.html">SmallBitVector.h</a></div></div>
<div class="ttc" id="classllvm_1_1TargetTransformInfo_html_a1e7940dd9d7d3814d19559ec2af502c9"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a1e7940dd9d7d3814d19559ec2af502c9">llvm::TargetTransformInfo::getScalingFactorCost</a></div><div class="ttdeci">virtual int getScalingFactorCost(Type *Ty, GlobalValue *BaseGV, int64_t BaseOffset, bool HasBaseReg, int64_t Scale) const </div><div class="ttdoc">Return the cost of the scaling factor used in the addressing mode represented by AM for this target...</div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00120">TargetTransformInfo.cpp:120</a></div></div>
<div class="ttc" id="raw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="TargetTransformInfo_8h_html"><div class="ttname"><a href="TargetTransformInfo_8h.html">TargetTransformInfo.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1SPII_html_a11e9b8fca4a074643a6a21f444e51406a36b3dd3b84fde3f8494a9b18af131856"><div class="ttname"><a href="namespacellvm_1_1SPII.html#a11e9b8fca4a074643a6a21f444e51406a36b3dd3b84fde3f8494a9b18af131856">llvm::SPII::Store</a></div><div class="ttdef"><b>Definition:</b> <a href="SparcInstrInfo_8h_source.html#l00032">SparcInstrInfo.h:32</a></div></div>
<div class="ttc" id="namespacellvm_html_a02c38c380d809959819ff729cc158cee"><div class="ttname"><a href="namespacellvm.html#a02c38c380d809959819ff729cc158cee">llvm::SplitLandingPadPredecessors</a></div><div class="ttdeci">void SplitLandingPadPredecessors(BasicBlock *OrigBB, ArrayRef&lt; BasicBlock * &gt; Preds, const char *Suffix, const char *Suffix2, Pass *P, SmallVectorImpl&lt; BasicBlock * &gt; &amp;NewBBs)</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00495">BasicBlockUtils.cpp:495</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_ac258f0361a1c35f5814a2b529139d15c"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#ac258f0361a1c35f5814a2b529139d15c">llvm::ScalarEvolution::hasComputableLoopEvolution</a></div><div class="ttdeci">bool hasComputableLoopEvolution(const SCEV *S, const Loop *L)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l07501">ScalarEvolution.cpp:7501</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVNAryExpr_html"><div class="ttname"><a href="classllvm_1_1SCEVNAryExpr.html">llvm::SCEVNAryExpr</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00133">ScalarEvolutionExpressions.h:133</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a88cdefb709309eddc6e5daca0be6a7b4"><div class="ttname"><a href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">llvm::PHINode::setIncomingValue</a></div><div class="ttdeci">void setIncomingValue(unsigned i, Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02062">Instructions.h:2062</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVExpander_html_aaca0b4b6c0a7f9a36f043b993177e03e"><div class="ttname"><a href="classllvm_1_1SCEVExpander.html#aaca0b4b6c0a7f9a36f043b993177e03e">llvm::SCEVExpander::setPostInc</a></div><div class="ttdeci">void setPostInc(const PostIncLoopSet &amp;L)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpander_8h_source.html#l00152">ScalarEvolutionExpander.h:152</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a097c2d42e4deffabe6d54b007ad83367"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a097c2d42e4deffabe6d54b007ad83367">llvm::ConstantInt::getSExtValue</a></div><div class="ttdeci">int64_t getSExtValue() const </div><div class="ttdoc">Return the sign extended value. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00124">Constants.h:124</a></div></div>
<div class="ttc" id="namespacellvm_html_aed54a8c39c1f5f066957f1297bd6bd0b"><div class="ttname"><a href="namespacellvm.html#aed54a8c39c1f5f066957f1297bd6bd0b">llvm::isSafeToExpand</a></div><div class="ttdeci">bool isSafeToExpand(const SCEV *S, ScalarEvolution &amp;SE)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpander_8cpp_source.html#l01743">ScalarEvolutionExpander.cpp:1743</a></div></div>
<div class="ttc" id="Target_2ARM_2README_8txt_html_a90cca76dd78688687e0d697679dbc799"><div class="ttname"><a href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional ldr LCPI1_0 ldr ldr tst movne lsr ldr LCPI1_1 and r0 bx lr it saves an instruction and a register It might be profitable to cse MOVi16 if there are lots of bit immediates with the same bottom half Robert Muth started working on an alternate jump table implementation that does not put the tables in line in the text This is more like the llvm default jump table implementation This might be useful sometime Several revisions of patches are on the mailing beginning while CMP sets them like a subtract Therefore to be able to use CMN for comparisons other than the Z we ll need additional logic to reverse the conditionals associated with the comparison Perhaps a pseudo instruction for the with a post codegen pass to clean up and handle the condition codes See PR5694 for testcase Given the following on int B</div><div class="ttdef"><b>Definition:</b> <a href="Target_2ARM_2README_8txt_source.html#l00592">Target/ARM/README.txt:592</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_a1e1ce75d651c76b6869b4218e34618c8"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#a1e1ce75d651c76b6869b4218e34618c8">llvm::ConstantExpr::getCast</a></div><div class="ttdeci">static Constant * getCast(unsigned ops, Constant *C, Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01444">Constants.cpp:1444</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a6467bd6bb128c8b69a478548fc17351c"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a6467bd6bb128c8b69a478548fc17351c">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, KeyInfoT &gt;, KeyT, ValueT, KeyInfoT &gt;::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00078">DenseMap.h:78</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05a07aee43ffb66908a25c55c77ce4c0d05"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a07aee43ffb66908a25c55c77ce4c0d05">llvm::CmpInst::BAD_ICMP_PREDICATE</a></div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00684">InstrTypes.h:684</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_ad5829d76e14852080c205f8b94d830f1"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#ad5829d76e14852080c205f8b94d830f1">llvm::ScalarEvolution::getMulExpr</a></div><div class="ttdeci">const SCEV * getMulExpr(SmallVectorImpl&lt; const SCEV * &gt; &amp;Ops, SCEV::NoWrapFlags Flags=SCEV::FlagAnyWrap)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l01864">ScalarEvolution.cpp:1864</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a5c2b7d7f19aac93b27b845858a7eb73e"><div class="ttname"><a href="classllvm_1_1PHINode.html#a5c2b7d7f19aac93b27b845858a7eb73e">llvm::PHINode::getBasicBlockIndex</a></div><div class="ttdeci">int getBasicBlockIndex(const BasicBlock *BB) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02132">Instructions.h:2132</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a41da369a9d31d911c8af724d5630f724"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a41da369a9d31d911c8af724d5630f724">llvm::BasicBlock::moveBefore</a></div><div class="ttdeci">void moveBefore(BasicBlock *MovePos)</div><div class="ttdoc">Unlink this basic block from its current function and insert it into the function that MovePos lives ...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00106">BasicBlock.cpp:106</a></div></div>
<div class="ttc" id="namespacellvm_html_a6569d00d31a5d74e563e2f39f82271ab"><div class="ttname"><a href="namespacellvm.html#a6569d00d31a5d74e563e2f39f82271ab">llvm::X</a></div><div class="ttdeci">static RegisterPass&lt; NVPTXAllocaHoisting &gt; X(&quot;alloca-hoisting&quot;,&quot;Hoisting alloca instructions in non-entry &quot;&quot;blocks to the entry block&quot;)</div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a9cd49851904f15060edb782ef4dd1b2d"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00052">Instruction.h:52</a></div></div>
<div class="ttc" id="classllvm_1_1LoopBase_html_ab191396dd1d8556d8e0a057f7fd2aaab"><div class="ttname"><a href="classllvm_1_1LoopBase.html#ab191396dd1d8556d8e0a057f7fd2aaab">llvm::LoopBase::empty</a></div><div class="ttdeci">bool empty() const </div><div class="ttdef"><b>Definition:</b> <a href="LoopInfo_8h_source.html#l00134">LoopInfo.h:134</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_aa96ca2cf0bb1e924523900fb911b0a45"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#aa96ca2cf0bb1e924523900fb911b0a45">llvm::ConstantInt::isOne</a></div><div class="ttdeci">bool isOne() const </div><div class="ttdoc">Determine if the value is one. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00168">Constants.h:168</a></div></div>
<div class="ttc" id="classllvm_1_1LPPassManager_html"><div class="ttname"><a href="classllvm_1_1LPPassManager.html">llvm::LPPassManager</a></div><div class="ttdef"><b>Definition:</b> <a href="LoopPass_8h_source.html#l00086">LoopPass.h:86</a></div></div>
<div class="ttc" id="LoopStrengthReduce_8cpp_html_a9b6b892760677b9b11c517eb5a46557f"><div class="ttname"><a href="LoopStrengthReduce_8cpp.html#a9b6b892760677b9b11c517eb5a46557f">isAddRecSExtable</a></div><div class="ttdeci">static bool isAddRecSExtable(const SCEVAddRecExpr *AR, ScalarEvolution &amp;SE)</div><div class="ttdef"><b>Definition:</b> <a href="LoopStrengthReduce_8cpp_source.html#l00438">LoopStrengthReduce.cpp:438</a></div></div>
<div class="ttc" id="classllvm_1_1IntrinsicInst_html"><div class="ttname"><a href="classllvm_1_1IntrinsicInst.html">llvm::IntrinsicInst</a></div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00036">IntrinsicInst.h:36</a></div></div>
<div class="ttc" id="classllvm_1_1SCEVConstant_html"><div class="ttname"><a href="classllvm_1_1SCEVConstant.html">llvm::SCEVConstant</a></div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolutionExpressions_8h_source.html#l00037">ScalarEvolutionExpressions.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1ScalarEvolution_html_aa35959e3f6bea8e35cffcfd8659e3156"><div class="ttname"><a href="classllvm_1_1ScalarEvolution.html#aa35959e3f6bea8e35cffcfd8659e3156">llvm::ScalarEvolution::getAnyExtendExpr</a></div><div class="ttdeci">const SCEV * getAnyExtendExpr(const SCEV *Op, Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarEvolution_8cpp_source.html#l01311">ScalarEvolution.cpp:1311</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<p class="footer">
Generated on Sat Nov 10 2018 22:59:39 for <a href="http://llvm.org/">LLVM</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.8.11</a><br>
Copyright &copy; 2003-2013 University of Illinois at Urbana-Champaign.
All Rights Reserved.</p>
<hr>
<!--#include virtual="/attrib.incl" -->
</body>
</html>
