<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="LLVM,Low Level Virtual Machine,C++,doxygen,API,documentation"/>
<meta name="description" content="C++ source code API documentation for LLVM."/>
<title>LLVM: ARMConstantIslandPass.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">LLVM API Documentation</p>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ARMConstantIslandPass_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ARMConstantIslandPass.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ARMConstantIslandPass_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===-- ARMConstantIslandPass.cpp - ARM constant islands ------------------===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                     The LLVM Compiler Infrastructure</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is distributed under the University of Illinois Open Source</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License. See LICENSE.TXT for details.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// This file contains a pass that splits the constant pool up into &#39;islands&#39;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// which are scattered through-out the function.  This is required due to the</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// limited pc-relative displacements that ARM has.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="ARMConstantIslandPass_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   16</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;arm-cp-islands&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ARM_8h.html">ARM.h</a>&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ARMMachineFunctionInfo_8h.html">ARMMachineFunctionInfo.h</a>&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ARMAddressingModes_8h.html">MCTargetDesc/ARMAddressingModes.h</a>&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Thumb2InstrInfo_8h.html">Thumb2InstrInfo.h</a>&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallSet_8h.html">llvm/ADT/SmallSet.h</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallVector_8h.html">llvm/ADT/SmallVector.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineConstantPool_8h.html">llvm/CodeGen/MachineConstantPool.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineFunctionPass_8h.html">llvm/CodeGen/MachineFunctionPass.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineJumpTableInfo_8h.html">llvm/CodeGen/MachineJumpTableInfo.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineRegisterInfo_8h.html">llvm/CodeGen/MachineRegisterInfo.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DataLayout_8h.html">llvm/IR/DataLayout.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ErrorHandling_8h.html">llvm/Support/ErrorHandling.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Format_8h.html">llvm/Support/Format.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Target_2TargetMachine_8h.html">llvm/Target/TargetMachine.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<a class="code" href="ARMConstantIslandPass_8cpp.html#a60a2842d1f0fa734eb1f802393ad1cb3">STATISTIC</a>(NumCPEs,       <span class="stringliteral">&quot;Number of constpool entries&quot;</span>);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<a class="code" href="ARMConstantIslandPass_8cpp.html#a60a2842d1f0fa734eb1f802393ad1cb3">STATISTIC</a>(NumSplit,      <span class="stringliteral">&quot;Number of uncond branches inserted&quot;</span>);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<a class="code" href="ARMConstantIslandPass_8cpp.html#a60a2842d1f0fa734eb1f802393ad1cb3">STATISTIC</a>(NumCBrFixed,   <span class="stringliteral">&quot;Number of cond branches fixed&quot;</span>);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<a class="code" href="ARMConstantIslandPass_8cpp.html#a60a2842d1f0fa734eb1f802393ad1cb3">STATISTIC</a>(NumUBrFixed,   <span class="stringliteral">&quot;Number of uncond branches fixed&quot;</span>);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<a class="code" href="ARMConstantIslandPass_8cpp.html#a60a2842d1f0fa734eb1f802393ad1cb3">STATISTIC</a>(NumTBs,        <span class="stringliteral">&quot;Number of table branches generated&quot;</span>);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<a class="code" href="ARMConstantIslandPass_8cpp.html#a60a2842d1f0fa734eb1f802393ad1cb3">STATISTIC</a>(NumT2CPShrunk, <span class="stringliteral">&quot;Number of Thumb2 constantpool instructions shrunk&quot;</span>);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<a class="code" href="ARMConstantIslandPass_8cpp.html#a60a2842d1f0fa734eb1f802393ad1cb3">STATISTIC</a>(NumT2BrShrunk, <span class="stringliteral">&quot;Number of Thumb2 immediate branches shrunk&quot;</span>);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<a class="code" href="ARMConstantIslandPass_8cpp.html#a60a2842d1f0fa734eb1f802393ad1cb3">STATISTIC</a>(NumCBZ,        <span class="stringliteral">&quot;Number of CBZ / CBNZ formed&quot;</span>);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<a class="code" href="ARMConstantIslandPass_8cpp.html#a60a2842d1f0fa734eb1f802393ad1cb3">STATISTIC</a>(NumJTMoved,    <span class="stringliteral">&quot;Number of jump table destination blocks moved&quot;</span>);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<a class="code" href="ARMConstantIslandPass_8cpp.html#a60a2842d1f0fa734eb1f802393ad1cb3">STATISTIC</a>(NumJTInserted, <span class="stringliteral">&quot;Number of jump table intermediate blocks inserted&quot;</span>);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<a class="code" href="ARMConstantIslandPass_8cpp.html#a2bf7ff457d9d0d8b2c6679c50c656b01">AdjustJumpTableBlocks</a>(<span class="stringliteral">&quot;arm-adjust-jump-tables&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;          <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Adjust basic block layout to better use TB[BH]&quot;</span>));</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">// FIXME: This option should be removed once it has received sufficient testing.</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<a class="code" href="ARMConstantIslandPass_8cpp.html#a3a46a1b65277dd4e3a55d99df759418c">AlignConstantIslands</a>(<span class="stringliteral">&quot;arm-align-constant-islands&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;          <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Align constant islands in code&quot;</span>));</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">/// UnknownPadding - Return the worst case padding that could result from</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">/// unknown offset bits.  This does not include alignment padding caused by</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">/// known offset bits.</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">/// @param LogAlign log2(alignment)</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">/// @param KnownBits Number of known low offset bits.</span></div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="ARMConstantIslandPass_8cpp.html#ac25b4192ac5ebe2a7d22b9621d36e203">   66</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <a class="code" href="ARMConstantIslandPass_8cpp.html#ac25b4192ac5ebe2a7d22b9621d36e203">UnknownPadding</a>(<span class="keywordtype">unsigned</span> LogAlign, <span class="keywordtype">unsigned</span> KnownBits) {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordflow">if</span> (KnownBits &lt; LogAlign)</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">return</span> (1u &lt;&lt; LogAlign) - (1u &lt;&lt; KnownBits);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;}</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">  /// ARMConstantIslands - Due to limited PC-relative displacements, ARM</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">  /// requires constant pool entries to be scattered among the instructions</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">  /// inside a function.  To do this, it completely ignores the normal LLVM</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">  /// constant pool; instead, it places constants wherever it feels like with</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">  /// special instructions.</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">  /// The terminology used in this pass includes:</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">  ///   Islands - Clumps of constants placed in the function.</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">  ///   Water   - Potential places where an island could be formed.</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">  ///   CPE     - A constant pool entry that has been placed somewhere, which</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">  ///             tracks a list of users.</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>ARMConstantIslands : <span class="keyword">public</span> <a class="code" href="classllvm_1_1MachineFunctionPass.html">MachineFunctionPass</a> {<span class="comment"></span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">    /// BasicBlockInfo - Information about the offset and size of a single</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">    /// basic block.</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment"></span>    <span class="keyword">struct </span>BasicBlockInfo {<span class="comment"></span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">      /// Offset - Distance from the beginning of the function to the beginning</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">      /// of this basic block.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">      ///</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">      /// Offsets are computed assuming worst case padding before an aligned</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">      /// block. This means that subtracting basic block offsets always gives a</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">      /// conservative estimate of the real distance which may be smaller.</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">      ///</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">      /// Because worst case padding is used, the computed offset of an aligned</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">      /// block may not actually be aligned.</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment"></span>      <span class="keywordtype">unsigned</span> Offset;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">      /// Size - Size of the basic block in bytes.  If the block contains</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">      /// inline assembly, this is a worst case estimate.</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">      ///</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">      /// The size does not include any alignment padding whether from the</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">      /// beginning of the block, or from an aligned jump table at the end.</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"></span>      <span class="keywordtype">unsigned</span> Size;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">      /// KnownBits - The number of low bits in Offset that are known to be</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">      /// exact.  The remaining bits of Offset are an upper bound.</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"></span>      uint8_t KnownBits;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">      /// Unalign - When non-zero, the block contains instructions (inline asm)</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">      /// of unknown size.  The real size may be smaller than Size bytes by a</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">      /// multiple of 1 &lt;&lt; Unalign.</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment"></span>      uint8_t Unalign;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">      /// PostAlign - When non-zero, the block terminator contains a .align</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">      /// directive, so the end of the block is aligned to 1 &lt;&lt; PostAlign</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">      /// bytes.</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment"></span>      uint8_t PostAlign;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      BasicBlockInfo() : Offset(0), Size(0), KnownBits(0), Unalign(0),</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        PostAlign(0) {}</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">      /// Compute the number of known offset bits internally to this block.</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">      /// This number should be used to predict worst case padding when</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">      /// splitting the block.</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"></span>      <span class="keywordtype">unsigned</span> internalKnownBits()<span class="keyword"> const </span>{</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> = Unalign ? Unalign : KnownBits;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="comment">// If the block size isn&#39;t a multiple of the known bits, assume the</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="comment">// worst case padding.</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">if</span> (Size &amp; ((1u &lt;&lt; Bits) - 1))</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;          Bits = <a class="code" href="namespacellvm.html#abdaf1eaf6120421977095bd97eee892e">countTrailingZeros</a>(Size);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">      /// Compute the offset immediately following this block.  If LogAlign is</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">      /// specified, return the offset the successor block will get if it has</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">      /// this alignment.</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"></span>      <span class="keywordtype">unsigned</span> postOffset(<span class="keywordtype">unsigned</span> LogAlign = 0)<span class="keyword"> const </span>{</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordtype">unsigned</span> PO = Offset + Size;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordtype">unsigned</span> LA = std::max(<span class="keywordtype">unsigned</span>(PostAlign), LogAlign);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordflow">if</span> (!LA)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;          <span class="keywordflow">return</span> PO;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="comment">// Add alignment padding from the terminator.</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">return</span> PO + <a class="code" href="ARMConstantIslandPass_8cpp.html#ac25b4192ac5ebe2a7d22b9621d36e203">UnknownPadding</a>(LA, internalKnownBits());</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">      /// Compute the number of known low bits of postOffset.  If this block</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">      /// contains inline asm, the number of known bits drops to the</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">      /// instruction alignment.  An aligned terminator may increase the number</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">      /// of know bits.</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">      /// If LogAlign is given, also consider the alignment of the next block.</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment"></span>      <span class="keywordtype">unsigned</span> postKnownBits(<span class="keywordtype">unsigned</span> LogAlign = 0)<span class="keyword"> const </span>{</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">return</span> std::max(std::max(<span class="keywordtype">unsigned</span>(PostAlign), LogAlign),</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                        internalKnownBits());</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      }</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    };</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    std::vector&lt;BasicBlockInfo&gt; BBInfo;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">    /// WaterList - A sorted list of basic blocks where islands could be placed</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">    /// (i.e. blocks that don&#39;t fall through to the following block, due</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">    /// to a return, unreachable, or unconditional branch).</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment"></span>    std::vector&lt;MachineBasicBlock*&gt; WaterList;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">    /// NewWaterList - The subset of WaterList that was created since the</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">    /// previous iteration by inserting unconditional branches.</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallSet.html">SmallSet&lt;MachineBasicBlock*, 4&gt;</a> NewWaterList;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keyword">typedef</span> std::vector&lt;MachineBasicBlock*&gt;::iterator water_iterator;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">    /// CPUser - One user of a constant pool, keeping the machine instruction</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">    /// pointer, the constant pool being referenced, and the max displacement</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">    /// allowed from the instruction to the CP.  The HighWaterMark records the</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">    /// highest basic block where a new CPEntry can be placed.  To ensure this</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">    /// pass terminates, the CP entries are initially placed at the end of the</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">    /// function and then move monotonically to lower addresses.  The</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">    /// exception to this rule is when the current CP entry for a particular</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">    /// CPUser is out of range, but there is another CP entry for the same</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">    /// constant value in range.  We want to use the existing in-range CP</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">    /// entry, but if it later moves out of range, the search for new water</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">    /// should resume where it left off.  The HighWaterMark is used to record</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">    /// that point.</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment"></span>    <span class="keyword">struct </span>CPUser {</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *HighWaterMark;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keyword">private</span>:</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="keywordtype">unsigned</span> MaxDisp;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="keywordtype">bool</span> NegOk;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordtype">bool</span> IsSoImm;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="keywordtype">bool</span> KnownAlignment;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      CPUser(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *mi, <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *cpemi, <span class="keywordtype">unsigned</span> maxdisp,</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;             <span class="keywordtype">bool</span> neg, <span class="keywordtype">bool</span> soimm)</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        : <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>(mi), CPEMI(cpemi), MaxDisp(maxdisp), NegOk(neg), IsSoImm(soimm),</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;          KnownAlignment(<span class="keyword">false</span>) {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        HighWaterMark = CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#aabad9b72f6d20d3462efc34020d39f73">getParent</a>();</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      }<span class="comment"></span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">      /// getMaxDisp - Returns the maximum displacement supported by MI.</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">      /// Correct for unknown alignment.</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">      /// Conservatively subtract 2 bytes to handle weird alignment effects.</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment"></span>      <span class="keywordtype">unsigned</span> getMaxDisp()<span class="keyword"> const </span>{</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordflow">return</span> (KnownAlignment ? MaxDisp : MaxDisp - 2) - 2;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    };</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">    /// CPUsers - Keep track of all of the machine instructions that use various</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">    /// constant pools and their max displacement.</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment"></span>    std::vector&lt;CPUser&gt; CPUsers;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">    /// CPEntry - One per constant pool entry, keeping the machine instruction</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">    /// pointer, the constpool index, and the number of CPUser&#39;s which</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">    /// reference this entry.</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment"></span>    <span class="keyword">struct </span>CPEntry {</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="keywordtype">unsigned</span> CPI;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordtype">unsigned</span> RefCount;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      CPEntry(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *cpemi, <span class="keywordtype">unsigned</span> cpi, <span class="keywordtype">unsigned</span> rc = 0)</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        : CPEMI(cpemi), CPI(cpi), RefCount(rc) {}</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    };</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">    /// CPEntries - Keep track of all of the constant pool entry machine</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">    /// instructions. For each original constpool index (i.e. those that</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">    /// existed upon entry to this pass), it keeps a vector of entries.</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">    /// Original elements are cloned as we go along; the clones are</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">    /// put in the vector of the original element, but have distinct CPIs.</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment"></span>    std::vector&lt;std::vector&lt;CPEntry&gt; &gt; CPEntries;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">    /// ImmBranch - One per immediate branch, keeping the machine instruction</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">    /// pointer, conditional or unconditional, the max displacement,</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">    /// and (if isCond is true) the corresponding unconditional branch</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">    /// opcode.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment"></span>    <span class="keyword">struct </span>ImmBranch {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <span class="keywordtype">unsigned</span> MaxDisp : 31;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="keywordtype">bool</span> isCond : 1;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keywordtype">int</span> UncondBr;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      ImmBranch(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *mi, <span class="keywordtype">unsigned</span> maxdisp, <span class="keywordtype">bool</span> cond, <span class="keywordtype">int</span> ubr)</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        : <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>(mi), MaxDisp(maxdisp), isCond(cond), UncondBr(ubr) {}</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    };</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">    /// ImmBranches - Keep track of all the immediate branch instructions.</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">    ///</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment"></span>    std::vector&lt;ImmBranch&gt; ImmBranches;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">    /// PushPopMIs - Keep track of all the Thumb push / pop instructions.</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">    ///</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MachineInstr*, 4&gt;</a> PushPopMIs;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">    /// T2JumpTables - Keep track of all the Thumb2 jumptable instructions.</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MachineInstr*, 4&gt;</a> T2JumpTables;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">    /// HasFarJump - True if any far jump instruction has been emitted during</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">    /// the branch fix up pass.</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> HasFarJump;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> *MF;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <a class="code" href="classllvm_1_1MachineConstantPool.html">MachineConstantPool</a> *MCP;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1ARMBaseInstrInfo.html">ARMBaseInstrInfo</a> *<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1ARMSubtarget.html">ARMSubtarget</a> *STI;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <a class="code" href="classllvm_1_1ARMFunctionInfo.html">ARMFunctionInfo</a> *AFI;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordtype">bool</span> isThumb;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordtype">bool</span> isThumb1;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordtype">bool</span> isThumb2;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a>;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    ARMConstantIslands() : <a class="code" href="classllvm_1_1MachineFunctionPass.html">MachineFunctionPass</a>(ID) {}</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> runOnMachineFunction(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;MF);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *getPassName()<span class="keyword"> const </span>{</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;ARM constant island placement and branch shortening pass&quot;</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="keyword">private</span>:</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordtype">void</span> doInitialPlacement(std::vector&lt;MachineInstr*&gt; &amp;CPEMIs);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    CPEntry *findConstPoolEntry(<span class="keywordtype">unsigned</span> CPI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordtype">unsigned</span> getCPELogAlign(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordtype">void</span> scanFunctionJumpTables();</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordtype">void</span> initializeFunctionInfo(<span class="keyword">const</span> std::vector&lt;MachineInstr*&gt; &amp;CPEMIs);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *splitBlockBeforeInstr(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordtype">void</span> updateForInsertedWaterBlock(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NewBB);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordtype">void</span> adjustBBOffsetsAfter(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordtype">bool</span> decrementCPEReferenceCount(<span class="keywordtype">unsigned</span> CPI, <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a>* CPEMI);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordtype">int</span> findInRangeCPEntry(CPUser&amp; U, <span class="keywordtype">unsigned</span> UserOffset);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordtype">bool</span> findAvailableWater(CPUser&amp;U, <span class="keywordtype">unsigned</span> UserOffset,</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                            water_iterator &amp;WaterIter);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordtype">void</span> createNewWater(<span class="keywordtype">unsigned</span> CPUserIndex, <span class="keywordtype">unsigned</span> UserOffset,</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                        <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *&amp;NewMBB);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordtype">bool</span> handleConstantPoolUser(<span class="keywordtype">unsigned</span> CPUserIndex);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordtype">void</span> removeDeadCPEMI(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordtype">bool</span> removeUnusedCPEntries();</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordtype">bool</span> isCPEntryInRange(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI, <span class="keywordtype">unsigned</span> UserOffset,</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                          <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI, <span class="keywordtype">unsigned</span> Disp, <span class="keywordtype">bool</span> NegOk,</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                          <span class="keywordtype">bool</span> DoDump = <span class="keyword">false</span>);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordtype">bool</span> isWaterInRange(<span class="keywordtype">unsigned</span> UserOffset, <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *Water,</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                        CPUser &amp;U, <span class="keywordtype">unsigned</span> &amp;Growth);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordtype">bool</span> isBBInRange(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI, <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BB, <span class="keywordtype">unsigned</span> Disp);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordtype">bool</span> fixupImmediateBr(ImmBranch &amp;Br);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordtype">bool</span> fixupConditionalBr(ImmBranch &amp;Br);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordtype">bool</span> fixupUnconditionalBr(ImmBranch &amp;Br);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordtype">bool</span> undoLRSpillRestore();</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordtype">bool</span> mayOptimizeThumb2Instruction(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI) <span class="keyword">const</span>;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordtype">bool</span> optimizeThumb2Instructions();</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordtype">bool</span> optimizeThumb2Branches();</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordtype">bool</span> reorderThumb2JumpTables();</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordtype">bool</span> optimizeThumb2JumpTables();</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *adjustJTTargetBlockForward(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BB,</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                                                  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *JTBB);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordtype">void</span> computeBlockSize(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordtype">unsigned</span> getOffsetOf(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI) <span class="keyword">const</span>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordtype">unsigned</span> getUserOffset(CPUser&amp;) <span class="keyword">const</span>;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordtype">void</span> dumpBBs();</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="PPCCTRLoops_8cpp.html#a593cc2f204f7b2edc16ee222c37c3196">verify</a>();</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordtype">bool</span> isOffsetInRange(<span class="keywordtype">unsigned</span> UserOffset, <span class="keywordtype">unsigned</span> TrialOffset,</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                         <span class="keywordtype">unsigned</span> Disp, <span class="keywordtype">bool</span> NegativeOK, <span class="keywordtype">bool</span> IsSoImm = <span class="keyword">false</span>);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordtype">bool</span> isOffsetInRange(<span class="keywordtype">unsigned</span> UserOffset, <span class="keywordtype">unsigned</span> TrialOffset,</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                         <span class="keyword">const</span> CPUser &amp;U) {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="keywordflow">return</span> isOffsetInRange(UserOffset, TrialOffset,</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                             U.getMaxDisp(), U.NegOk, U.IsSoImm);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    }</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  };</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ARMConstantIslands::ID</a> = 0;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">/// verify - check BBOffsets, BBSizes, alignment of islands</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="PPCCTRLoops_8cpp.html#a593cc2f204f7b2edc16ee222c37c3196">ARMConstantIslands::verify</a>() {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> MBBI = MF-&gt;begin(), E = MF-&gt;end();</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;       MBBI != E; ++MBBI) {</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB = MBBI;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordtype">unsigned</span> MBBId = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>();</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    assert(!MBBId || BBInfo[MBBId - 1].postOffset() &lt;= BBInfo[MBBId].Offset);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Verifying &quot;</span> &lt;&lt; CPUsers.size() &lt;&lt; <span class="stringliteral">&quot; CP users.\n&quot;</span>);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = CPUsers.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    CPUser &amp;U = CPUsers[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordtype">unsigned</span> UserOffset = getUserOffset(U);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">// Verify offset using the real max displacement without the safety</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="comment">// adjustment.</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">if</span> (isCPEntryInRange(U.MI, UserOffset, U.CPEMI, U.getMaxDisp()+2, U.NegOk,</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                         <span class="comment">/* DoDump = */</span> <span class="keyword">true</span>)) {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;OK\n&quot;</span>);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Out of range.\n&quot;</span>);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    dumpBBs();</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(MF-&gt;dump());</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Constant pool entry out of range!&quot;</span>);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;}</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">/// print block size and offset information - debugging</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ARMConstantIslands::dumpBBs() {</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>({</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> J = 0, E = BBInfo.size(); J !=E; ++J) {</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keyword">const</span> BasicBlockInfo &amp;BBI = BBInfo[J];</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a class="code" href="namespacellvm.html#a69dc1b119f8cb95b7e36f586c5aeb372">format</a>(<span class="stringliteral">&quot;%08x BB#%u\t&quot;</span>, BBI.Offset, J)</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;             &lt;&lt; <span class="stringliteral">&quot; kb=&quot;</span> &lt;&lt; unsigned(BBI.KnownBits)</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;             &lt;&lt; <span class="stringliteral">&quot; ua=&quot;</span> &lt;&lt; unsigned(BBI.Unalign)</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;             &lt;&lt; <span class="stringliteral">&quot; pa=&quot;</span> &lt;&lt; unsigned(BBI.PostAlign)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;             &lt;&lt; <a class="code" href="namespacellvm.html#a69dc1b119f8cb95b7e36f586c5aeb372">format</a>(<span class="stringliteral">&quot; size=%#x\n&quot;</span>, BBInfo[J].Size);</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    }</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  });</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;}</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">/// createARMConstantIslandPass - returns an instance of the constpool</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">/// island pass.</span></div><div class="line"><a name="l00372"></a><span class="lineno"><a class="line" href="namespacellvm.html#ab26ecc37dfb0700afd44f8648a34ab82">  372</a></span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> *<a class="code" href="namespacellvm.html#ab26ecc37dfb0700afd44f8648a34ab82">llvm::createARMConstantIslandPass</a>() {</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> ARMConstantIslands();</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;}</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="keywordtype">bool</span> ARMConstantIslands::runOnMachineFunction(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;mf) {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  MF = &amp;mf;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  MCP = mf.<a class="code" href="classllvm_1_1MachineFunction.html#aa460158a4019a4043faf6ea76344cbd5">getConstantPool</a>();</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;***** ARMConstantIslands: &quot;</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;               &lt;&lt; MCP-&gt;getConstants().size() &lt;&lt; <span class="stringliteral">&quot; CP entries, aligned to &quot;</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;               &lt;&lt; MCP-&gt;getConstantPoolAlignment() &lt;&lt; <span class="stringliteral">&quot; bytes *****\n&quot;</span>);</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a> = (<span class="keyword">const</span> <a class="code" href="classllvm_1_1ARMBaseInstrInfo.html">ARMBaseInstrInfo</a>*)MF-&gt;getTarget().getInstrInfo();</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  AFI = MF-&gt;getInfo&lt;<a class="code" href="classllvm_1_1ARMFunctionInfo.html">ARMFunctionInfo</a>&gt;();</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  STI = &amp;MF-&gt;getTarget().getSubtarget&lt;<a class="code" href="classllvm_1_1ARMSubtarget.html">ARMSubtarget</a>&gt;();</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  isThumb = AFI-&gt;isThumbFunction();</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  isThumb1 = AFI-&gt;isThumb1OnlyFunction();</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  isThumb2 = AFI-&gt;isThumb2Function();</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  HasFarJump = <span class="keyword">false</span>;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="comment">// This pass invalidates liveness information when it splits basic blocks.</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  MF-&gt;getRegInfo().invalidateLiveness();</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="comment">// Renumber all of the machine basic blocks in the function, guaranteeing that</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="comment">// the numbers agree with the position of the block in the function.</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  MF-&gt;RenumberBlocks();</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="comment">// Try to reorder and otherwise adjust the block layout to make good use</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="comment">// of the TB[BH] instructions.</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="keywordflow">if</span> (isThumb2 &amp;&amp; <a class="code" href="ARMConstantIslandPass_8cpp.html#a2bf7ff457d9d0d8b2c6679c50c656b01">AdjustJumpTableBlocks</a>) {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    scanFunctionJumpTables();</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    MadeChange |= reorderThumb2JumpTables();</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="comment">// Data is out of date, so clear it. It&#39;ll be re-computed later.</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    T2JumpTables.clear();</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="comment">// Blocks may have shifted around. Keep the numbering up to date.</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    MF-&gt;RenumberBlocks();</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="comment">// Thumb1 functions containing constant pools get 4-byte alignment.</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="comment">// This is so we can keep exact track of where the alignment padding goes.</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="comment">// ARM and Thumb2 functions need to be 4-byte aligned.</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordflow">if</span> (!isThumb1)</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    MF-&gt;ensureAlignment(2);  <span class="comment">// 2 = log2(4)</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="comment">// Perform the initial placement of the constant pool entries.  To start with,</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="comment">// we put them all at the end of the function.</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  std::vector&lt;MachineInstr*&gt; CPEMIs;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keywordflow">if</span> (!MCP-&gt;isEmpty())</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    doInitialPlacement(CPEMIs);</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">  /// The next UID to take is the first unused one.</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment"></span>  AFI-&gt;initPICLabelUId(CPEMIs.size());</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="comment">// Do the initial scan of the function, building up information about the</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="comment">// sizes of each block, the location of all the water, and finding all of the</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="comment">// constant pool users.</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  initializeFunctionInfo(CPEMIs);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  CPEMIs.clear();</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(dumpBBs());</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">  /// Remove dead constant pool entries.</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment"></span>  MadeChange |= removeUnusedCPEntries();</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="comment">// Iteratively place constant pool entries and fix up branches until there</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="comment">// is no change.</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keywordtype">unsigned</span> NoCPIters = 0, NoBRIters = 0;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Beginning CP iteration #&quot;</span> &lt;&lt; NoCPIters &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordtype">bool</span> CPChange = <span class="keyword">false</span>;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = CPUsers.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      CPChange |= handleConstantPoolUser(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">if</span> (CPChange &amp;&amp; ++NoCPIters &gt; 30)</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <a class="code" href="namespacellvm.html#a1f6978055dbb761b380de39070e34bd3">report_fatal_error</a>(<span class="stringliteral">&quot;Constant Island pass failed to converge!&quot;</span>);</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(dumpBBs());</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="comment">// Clear NewWaterList now.  If we split a block for branches, it should</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="comment">// appear as &quot;new water&quot; for the next iteration of constant pool placement.</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    NewWaterList.clear();</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Beginning BR iteration #&quot;</span> &lt;&lt; NoBRIters &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordtype">bool</span> BRChange = <span class="keyword">false</span>;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = ImmBranches.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      BRChange |= fixupImmediateBr(ImmBranches[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">if</span> (BRChange &amp;&amp; ++NoBRIters &gt; 30)</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <a class="code" href="namespacellvm.html#a1f6978055dbb761b380de39070e34bd3">report_fatal_error</a>(<span class="stringliteral">&quot;Branch Fix Up pass failed to converge!&quot;</span>);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(dumpBBs());</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">if</span> (!CPChange &amp;&amp; !BRChange)</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  }</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="comment">// Shrink 32-bit Thumb2 branch, load, and store instructions.</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keywordflow">if</span> (isThumb2 &amp;&amp; !STI-&gt;prefers32BitThumb())</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    MadeChange |= optimizeThumb2Instructions();</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="comment">// After a while, this might be made debug-only, but it is not expensive.</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <a class="code" href="PPCCTRLoops_8cpp.html#a593cc2f204f7b2edc16ee222c37c3196">verify</a>();</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="comment">// If LR has been forced spilled and no far jump (i.e. BL) has been issued,</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="comment">// undo the spill / restore of LR if possible.</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="keywordflow">if</span> (isThumb &amp;&amp; !HasFarJump &amp;&amp; AFI-&gt;isLRSpilledForFarJump())</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    MadeChange |= undoLRSpillRestore();</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="comment">// Save the mapping between original and cloned constpool entries.</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = CPEntries.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> = 0, je = CPEntries[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="Target_2README_8txt.html#a02def7c594e9f19ff247ed0bf33d1c30">size</a>(); <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> != je; ++<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>) {</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="keyword">const</span> CPEntry &amp; CPE = CPEntries[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>];</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      AFI-&gt;recordCPEClone(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, CPE.CPI);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    }</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  }</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>; dumpBBs());</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  BBInfo.clear();</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  WaterList.clear();</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  CPUsers.clear();</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  CPEntries.clear();</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  ImmBranches.clear();</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  PushPopMIs.clear();</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  T2JumpTables.clear();</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;}</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">/// doInitialPlacement - Perform the initial placement of the constant pool</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">/// entries.  To start with, we put them all at the end of the function.</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment"></span><span class="keywordtype">void</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;ARMConstantIslands::doInitialPlacement(std::vector&lt;MachineInstr*&gt; &amp;CPEMIs) {</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="comment">// Create the basic block to hold the CPE&#39;s.</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = MF-&gt;CreateMachineBasicBlock();</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  MF-&gt;push_back(BB);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="comment">// MachineConstantPool measures alignment in bytes. We measure in log2(bytes).</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <span class="keywordtype">unsigned</span> MaxAlign = <a class="code" href="namespacellvm.html#a646986783f35e0fef8988f0f28d2589f">Log2_32</a>(MCP-&gt;getConstantPoolAlignment());</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="comment">// Mark the basic block as required by the const-pool.</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="comment">// If AlignConstantIslands isn&#39;t set, use 4-byte alignment for everything.</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  BB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#aeb1fd8bba75c8cb83e6183bfa1352d3c">setAlignment</a>(<a class="code" href="ARMConstantIslandPass_8cpp.html#a3a46a1b65277dd4e3a55d99df759418c">AlignConstantIslands</a> ? MaxAlign : 2);</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="comment">// The function needs to be as aligned as the basic blocks. The linker may</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="comment">// move functions around based on their alignment.</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  MF-&gt;ensureAlignment(BB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a87a4c8e9738e103f9ada8379941b6825">getAlignment</a>());</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="comment">// Order the entries in BB by descending alignment.  That ensures correct</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="comment">// alignment of all entries as long as BB is sufficiently aligned.  Keep</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="comment">// track of the insertion point for each alignment.  We are going to bucket</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="comment">// sort the entries as they are created.</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MachineBasicBlock::iterator, 8&gt;</a> InsPoint(MaxAlign + 1, BB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>());</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="comment">// Add all of the constants from the constant pool to the end block, use an</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="comment">// identity mapping of CPI&#39;s to CPE&#39;s.</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="keyword">const</span> std::vector&lt;MachineConstantPoolEntry&gt; &amp;CPs = MCP-&gt;getConstants();</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;TD = *MF-&gt;getTarget().getDataLayout();</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = CPs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordtype">unsigned</span> Size = TD.<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(CPs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="namespacellvm_1_1Intrinsic.html#ac015f68d60ea67a2e31bc10bc720d3e8">getType</a>());</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    assert(Size &gt;= 4 &amp;&amp; <span class="stringliteral">&quot;Too small constant pool entry&quot;</span>);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="ARMSubtarget_8cpp.html#a4bd80d4e433d9f72af26b364036900dc">Align</a> = CPs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].getAlignment();</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    assert(<a class="code" href="namespacellvm.html#af4d1a918800291e75b01ce1447be0e83">isPowerOf2_32</a>(Align) &amp;&amp; <span class="stringliteral">&quot;Invalid alignment&quot;</span>);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="comment">// Verify that all constant pool entries are a multiple of their alignment.</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="comment">// If not, we would have to pad them out so that instructions stay aligned.</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    assert((Size % Align) == 0 &amp;&amp; <span class="stringliteral">&quot;CP Entry not multiple of 4 bytes!&quot;</span>);</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="comment">// Insert CONSTPOOL_ENTRY before entries with a smaller alignment.</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordtype">unsigned</span> LogAlign = <a class="code" href="namespacellvm.html#a646986783f35e0fef8988f0f28d2589f">Log2_32</a>(Align);</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html#ac51be7ff80fe8d6ae5e8c0acb194908a">MachineBasicBlock::iterator</a> InsAt = InsPoint[LogAlign];</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI =</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <a class="code" href="namespacellvm.html#a980570dc1410d4ef53806f82028ca381">BuildMI</a>(*BB, InsAt, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(ARM::CONSTPOOL_ENTRY))</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        .addImm(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>).<a class="code" href="classllvm_1_1MachineInstrBuilder.html#ad59a931df03c79a2ea17009ee2a2f96b">addConstantPoolIndex</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>).<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a9f1fae6a5dbb6e378ca85df1fded8515">addImm</a>(Size);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    CPEMIs.push_back(CPEMI);</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="comment">// Ensure that future entries with higher alignment get inserted before</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="comment">// CPEMI. This is bucket sort with iterators.</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2X86_2README_8txt.html#a668d6902e1f37328dfbbb1f75aa82fc9">a</a> = LogAlign + 1; <a class="code" href="Target_2X86_2README_8txt.html#a668d6902e1f37328dfbbb1f75aa82fc9">a</a> &lt;= MaxAlign; ++<a class="code" href="Target_2X86_2README_8txt.html#a668d6902e1f37328dfbbb1f75aa82fc9">a</a>)</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <span class="keywordflow">if</span> (InsPoint[<a class="code" href="Target_2X86_2README_8txt.html#a668d6902e1f37328dfbbb1f75aa82fc9">a</a>] == InsAt)</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        InsPoint[<a class="code" href="Target_2X86_2README_8txt.html#a668d6902e1f37328dfbbb1f75aa82fc9">a</a>] = CPEMI;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="comment">// Add a new CPEntry, but no corresponding CPUser yet.</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    std::vector&lt;CPEntry&gt; CPEs;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    CPEs.push_back(CPEntry(CPEMI, <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    CPEntries.push_back(CPEs);</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    ++NumCPEs;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Moved CPI#&quot;</span> &lt;&lt; <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot; to end of function, size = &quot;</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                 &lt;&lt; Size &lt;&lt; <span class="stringliteral">&quot;, align = &quot;</span> &lt;&lt; Align &lt;&lt;<span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  }</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(BB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a034eb3171c0fc312556559ac96d11c2b">dump</a>());</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;}</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">/// BBHasFallthrough - Return true if the specified basic block can fallthrough</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">/// into the block immediately after it.</span></div><div class="line"><a name="l00568"></a><span class="lineno"><a class="line" href="ARMConstantIslandPass_8cpp.html#a2591f82337ce78f51703e6b3382eec3c">  568</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="ARMConstantIslandPass_8cpp.html#a2591f82337ce78f51703e6b3382eec3c">BBHasFallthrough</a>(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB) {</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="comment">// Get the next machine basic block in the function.</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> MBBI = MBB;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="comment">// Can&#39;t fall off end of function.</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(MBBI) == MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#af2e482ff2a9253ec6bc2285491496bd6">getParent</a>()-&gt;<a class="code" href="classllvm_1_1MachineFunction.html#a9d017af749f76484cb9aec9ff6e4330c">end</a>())</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NextBB = <a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(MBBI);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#aefba5f2af370add1bc8aaceedf7878ef">MachineBasicBlock::succ_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6321b189ea8fd5058663f8a87d6c23e9">succ_begin</a>(),</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;       E = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3ddd708642d60c1661992ff8ba1b215d">succ_end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">if</span> (*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> == NextBB)</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;}</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">/// findConstPoolEntry - Given the constpool index and CONSTPOOL_ENTRY MI,</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">/// look up the corresponding CPEntry.</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment"></span>ARMConstantIslands::CPEntry</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;*ARMConstantIslands::findConstPoolEntry(<span class="keywordtype">unsigned</span> CPI,</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                                        <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI) {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  std::vector&lt;CPEntry&gt; &amp;CPEs = CPEntries[CPI];</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="comment">// Number of entries per constpool index should be small, just do a</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="comment">// linear search.</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = CPEs.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordflow">if</span> (CPEs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].CPEMI == CPEMI)</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <span class="keywordflow">return</span> &amp;CPEs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  }</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;}</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">/// getCPELogAlign - Returns the required alignment of the constant pool entry</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">/// represented by CPEMI.  Alignment is measured in log2(bytes) units.</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment"></span><span class="keywordtype">unsigned</span> ARMConstantIslands::getCPELogAlign(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI) {</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  assert(CPEMI &amp;&amp; CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a242314c0ae0147d1a7ef54c9bc312616">getOpcode</a>() == ARM::CONSTPOOL_ENTRY);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="comment">// Everything is 4-byte aligned unless AlignConstantIslands is set.</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="ARMConstantIslandPass_8cpp.html#a3a46a1b65277dd4e3a55d99df759418c">AlignConstantIslands</a>)</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">return</span> 2;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="keywordtype">unsigned</span> CPI = CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(1).<a class="code" href="classllvm_1_1MachineOperand.html#ac9485ae7d6fedd71ad4460f72c799c98">getIndex</a>();</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  assert(CPI &lt; MCP-&gt;getConstants().<a class="code" href="Target_2README_8txt.html#a02def7c594e9f19ff247ed0bf33d1c30">size</a>() &amp;&amp; <span class="stringliteral">&quot;Invalid constant pool index.&quot;</span>);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="ARMSubtarget_8cpp.html#a4bd80d4e433d9f72af26b364036900dc">Align</a> = MCP-&gt;getConstants()[CPI].getAlignment();</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  assert(<a class="code" href="namespacellvm.html#af4d1a918800291e75b01ce1447be0e83">isPowerOf2_32</a>(Align) &amp;&amp; <span class="stringliteral">&quot;Invalid CPE alignment&quot;</span>);</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a646986783f35e0fef8988f0f28d2589f">Log2_32</a>(Align);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;}</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">/// scanFunctionJumpTables - Do a scan of the function, building up</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment">/// information about the sizes of each block and the locations of all</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">/// the jump tables.</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ARMConstantIslands::scanFunctionJumpTables() {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> MBBI = MF-&gt;begin(), E = MF-&gt;end();</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;       MBBI != E; ++MBBI) {</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> &amp;MBB = *MBBI;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#ac51be7ff80fe8d6ae5e8c0acb194908a">MachineBasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MBB.<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">begin</a>(), E = MBB.<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>();</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;         <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isBranch() &amp;&amp; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == ARM::t2BR_JT)</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        T2JumpTables.<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3b1dce1f3354a357fb9061bb7568a84e">push_back</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  }</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;}</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment">/// initializeFunctionInfo - Do the initial scan of the function, building up</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">/// information about the sizes of each block, the location of all the water,</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">/// and finding all of the constant pool users.</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ARMConstantIslands::</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;initializeFunctionInfo(<span class="keyword">const</span> std::vector&lt;MachineInstr*&gt; &amp;CPEMIs) {</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  BBInfo.clear();</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  BBInfo.resize(MF-&gt;getNumBlockIDs());</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="comment">// First thing, compute the size of all basic blocks, and see if the function</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="comment">// has any inline assembly in it. If so, we have to be conservative about</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="comment">// alignment assumptions, as we don&#39;t know for sure the size of any</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <span class="comment">// instructions in the inline assembly.</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MF-&gt;begin(), E = MF-&gt;end(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    computeBlockSize(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="comment">// The known bits of the entry block offset are determined by the function</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="comment">// alignment.</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  BBInfo.front().KnownBits = MF-&gt;getAlignment();</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <span class="comment">// Compute block offsets and known bits.</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  adjustBBOffsetsAfter(MF-&gt;begin());</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <span class="comment">// Now go back through the instructions and build up our data structures.</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> MBBI = MF-&gt;begin(), E = MF-&gt;end();</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;       MBBI != E; ++MBBI) {</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> &amp;MBB = *MBBI;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="comment">// If this block doesn&#39;t fall through into the next MBB, then this is</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="comment">// &#39;water&#39; that a constant pool island could be placed.</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="ARMConstantIslandPass_8cpp.html#a2591f82337ce78f51703e6b3382eec3c">BBHasFallthrough</a>(&amp;MBB))</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      WaterList.<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3b1dce1f3354a357fb9061bb7568a84e">push_back</a>(&amp;MBB);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#ac51be7ff80fe8d6ae5e8c0acb194908a">MachineBasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MBB.<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">begin</a>(), E = MBB.<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>();</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;         <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isDebugValue())</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="keywordtype">int</span> Opc = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode();</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isBranch()) {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="keywordtype">bool</span> isCond = <span class="keyword">false</span>;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> = 0;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordtype">unsigned</span> Scale = 1;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="keywordtype">int</span> UOpc = Opc;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">switch</span> (Opc) {</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;          <span class="keywordflow">continue</span>;  <span class="comment">// Ignore other JT branches</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="keywordflow">case</span> ARM::t2BR_JT:</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;          T2JumpTables.push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;          <span class="keywordflow">continue</span>;   <span class="comment">// Does not get an entry in ImmBranches</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">case</span> ARM::Bcc:</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;          isCond = <span class="keyword">true</span>;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;          UOpc = <a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">ARM::B</a>;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;          <span class="comment">// Fallthrough</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">ARM::B</a>:</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;          Bits = 24;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;          Scale = 4;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="keywordflow">case</span> ARM::tBcc:</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;          isCond = <span class="keyword">true</span>;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;          UOpc = ARM::tB;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;          Bits = 8;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;          Scale = 2;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="keywordflow">case</span> ARM::tB:</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;          Bits = 11;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;          Scale = 2;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keywordflow">case</span> ARM::t2Bcc:</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;          isCond = <span class="keyword">true</span>;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;          UOpc = ARM::t2B;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;          Bits = 20;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;          Scale = 2;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="keywordflow">case</span> ARM::t2B:</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;          Bits = 24;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;          Scale = 2;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <span class="comment">// Record this immediate branch.</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <span class="keywordtype">unsigned</span> MaxOffs = ((1 &lt;&lt; (Bits-1))-1) * Scale;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        ImmBranches.push_back(ImmBranch(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, MaxOffs, isCond, UOpc));</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      }</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      <span class="keywordflow">if</span> (Opc == ARM::tPUSH || Opc == ARM::tPOP_RET)</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        PushPopMIs.push_back(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      <span class="keywordflow">if</span> (Opc == ARM::CONSTPOOL_ENTRY)</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <span class="comment">// Scan the instructions for constant pool operands.</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> op = 0, e = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNumOperands(); op != e; ++op)</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(op).isCPI()) {</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;          <span class="comment">// We found one.  The addressing mode tells us the max displacement</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;          <span class="comment">// from the PC that this instruction permits.</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;          <span class="comment">// Basic size info comes from the TSFlags field.</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;          <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> = 0;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;          <span class="keywordtype">unsigned</span> Scale = 1;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;          <span class="keywordtype">bool</span> NegOk = <span class="keyword">false</span>;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;          <span class="keywordtype">bool</span> IsSoImm = <span class="keyword">false</span>;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;          <span class="keywordflow">switch</span> (Opc) {</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;          <span class="keywordflow">default</span>:</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unknown addressing mode for CP reference!&quot;</span>);</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;          <span class="comment">// Taking the address of a CP entry.</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;          <span class="keywordflow">case</span> ARM::LEApcrel:</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            <span class="comment">// This takes a SoImm, which is 8 bit immediate rotated. We&#39;ll</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            <span class="comment">// pretend the maximum offset is 255 * 4. Since each instruction</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            <span class="comment">// 4 byte wide, this is always correct. We&#39;ll check for other</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            <span class="comment">// displacements that fits in a SoImm as well.</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            Bits = 8;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            Scale = 4;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            NegOk = <span class="keyword">true</span>;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            IsSoImm = <span class="keyword">true</span>;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;          <span class="keywordflow">case</span> ARM::t2LEApcrel:</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            Bits = 12;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            NegOk = <span class="keyword">true</span>;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;          <span class="keywordflow">case</span> ARM::tLEApcrel:</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            Bits = 8;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            Scale = 4;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;          <span class="keywordflow">case</span> ARM::LDRBi12:</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;          <span class="keywordflow">case</span> ARM::LDRi12:</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;          <span class="keywordflow">case</span> ARM::LDRcp:</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;          <span class="keywordflow">case</span> ARM::t2LDRpci:</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            Bits = 12;  <span class="comment">// +-offset_12</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            NegOk = <span class="keyword">true</span>;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;          <span class="keywordflow">case</span> ARM::tLDRpci:</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            Bits = 8;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            Scale = 4;  <span class="comment">// +(offset_8*4)</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;          <span class="keywordflow">case</span> ARM::VLDRD:</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;          <span class="keywordflow">case</span> ARM::VLDRS:</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            Bits = 8;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            Scale = 4;  <span class="comment">// +-(offset_8*4)</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            NegOk = <span class="keyword">true</span>;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;          }</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;          <span class="comment">// Remember that this is a user of a CP entry.</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;          <span class="keywordtype">unsigned</span> CPI = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(op).getIndex();</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;          <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI = CPEMIs[CPI];</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;          <span class="keywordtype">unsigned</span> MaxOffs = ((1 &lt;&lt; <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a>)-1) * Scale;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;          CPUsers.push_back(CPUser(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, CPEMI, MaxOffs, NegOk, IsSoImm));</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;          <span class="comment">// Increment corresponding CPEntry reference count.</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;          CPEntry *CPE = findConstPoolEntry(CPI, CPEMI);</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;          assert(CPE &amp;&amp; <span class="stringliteral">&quot;Cannot find a corresponding CPEntry!&quot;</span>);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;          CPE-&gt;RefCount++;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;          <span class="comment">// Instructions can only use one CP entry, don&#39;t bother scanning the</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;          <span class="comment">// rest of the operands.</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        }</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    }</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  }</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;}</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment">/// computeBlockSize - Compute the size and some alignment information for MBB.</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment">/// This function updates BBInfo directly.</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ARMConstantIslands::computeBlockSize(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB) {</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  BasicBlockInfo &amp;BBI = BBInfo[MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()];</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  BBI.Size = 0;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  BBI.Unalign = 0;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  BBI.PostAlign = 0;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#ac51be7ff80fe8d6ae5e8c0acb194908a">MachineBasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">begin</a>(), E = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;       ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    BBI.Size += <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;GetInstSizeInBytes(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="comment">// For inline asm, GetInstSizeInBytes returns a conservative estimate.</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="comment">// The actual size may be smaller, but still a multiple of the instr size.</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isInlineAsm())</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      BBI.Unalign = isThumb ? 1 : 2;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="comment">// Also consider instructions that may be shrunk later.</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">else</span> <a class="code" href="LLParser_8cpp.html#aae58e3df0180401e8f3ab75c18fbc07a">if</a> (isThumb &amp;&amp; mayOptimizeThumb2Instruction(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      BBI.Unalign = 1;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  }</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="comment">// tBR_JTr contains a .align 2 directive.</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="keywordflow">if</span> (!MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#aa37d95a1d7bc824da0c596d8334c4ceb">empty</a>() &amp;&amp; MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>().<a class="code" href="classllvm_1_1MachineInstr.html#a242314c0ae0147d1a7ef54c9bc312616">getOpcode</a>() == ARM::tBR_JTr) {</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    BBI.PostAlign = 2;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#af2e482ff2a9253ec6bc2285491496bd6">getParent</a>()-&gt;<a class="code" href="classllvm_1_1MachineFunction.html#a520b3ba31f64d45634ad724b0e778073">ensureAlignment</a>(2);</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  }</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;}</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment">/// getOffsetOf - Return the current offset of the specified machine instruction</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="comment">/// from the start of the function.  This offset changes as stuff is moved</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="comment">/// around inside the function.</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment"></span><span class="keywordtype">unsigned</span> ARMConstantIslands::getOffsetOf(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>)<span class="keyword"> const </span>{</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#aabad9b72f6d20d3462efc34020d39f73">getParent</a>();</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="comment">// The offset is composed of two things: the sum of the sizes of all MBB&#39;s</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="comment">// before this instruction&#39;s block, and the offset from the start of the block</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="comment">// it is in.</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <span class="keywordtype">unsigned</span> Offset = BBInfo[MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Offset;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="comment">// Sum instructions before MI in MBB.</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineBasicBlock.html#ac51be7ff80fe8d6ae5e8c0acb194908a">MachineBasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">begin</a>(); &amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    assert(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>() &amp;&amp; <span class="stringliteral">&quot;Didn&#39;t find MI in its own basic block?&quot;</span>);</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    Offset += <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;GetInstSizeInBytes(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  }</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <span class="keywordflow">return</span> Offset;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;}</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment">/// CompareMBBNumbers - Little predicate function to sort the WaterList by MBB</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment">/// ID.</span></div><div class="line"><a name="l00844"></a><span class="lineno"><a class="line" href="ARMConstantIslandPass_8cpp.html#a29885c784cdf6c08d6952699d790c8c4">  844</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="ARMConstantIslandPass_8cpp.html#a29885c784cdf6c08d6952699d790c8c4">CompareMBBNumbers</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *LHS,</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                              <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *RHS) {</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <span class="keywordflow">return</span> LHS-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>() &lt; RHS-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>();</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;}</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">/// updateForInsertedWaterBlock - When a block is newly inserted into the</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment">/// machine function, it upsets all of the block numbers.  Renumber the blocks</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment">/// and update the arrays that parallel this numbering.</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ARMConstantIslands::updateForInsertedWaterBlock(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NewBB) {</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="comment">// Renumber the MBB&#39;s to keep them consecutive.</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  NewBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#af2e482ff2a9253ec6bc2285491496bd6">getParent</a>()-&gt;<a class="code" href="classllvm_1_1MachineFunction.html#a73ef91cc71d405f55dd5a77ff8ba56ba">RenumberBlocks</a>(NewBB);</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="comment">// Insert an entry into BBInfo to align it properly with the (newly</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="comment">// renumbered) block numbers.</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  BBInfo.insert(BBInfo.begin() + NewBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>(), BasicBlockInfo());</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="comment">// Next, update WaterList.  Specifically, we need to add NewMBB as having</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="comment">// available water after it.</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  water_iterator IP =</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    std::lower_bound(WaterList.begin(), WaterList.end(), NewBB,</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                     <a class="code" href="ARMConstantIslandPass_8cpp.html#a29885c784cdf6c08d6952699d790c8c4">CompareMBBNumbers</a>);</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  WaterList.insert(IP, NewBB);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;}</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="comment">/// Split the basic block containing MI into two blocks, which are joined by</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="comment">/// an unconditional branch.  Update data structures and renumber blocks to</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment">/// account for this change and returns the newly created block.</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *ARMConstantIslands::splitBlockBeforeInstr(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI) {</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *OrigBB = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#aabad9b72f6d20d3462efc34020d39f73">getParent</a>();</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="comment">// Create a new MBB for the code after the OrigBB.</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NewBB =</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    MF-&gt;CreateMachineBasicBlock(OrigBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a2961c31b29db17a4f2964899c8569a64">getBasicBlock</a>());</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> MBBI = OrigBB; ++MBBI;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  MF-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a8d02c1e6ef20f42c10d6f4e7234efd61">insert</a>(MBBI, NewBB);</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="comment">// Splice the instructions starting with MI over to NewBB.</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  NewBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#adf0023bdc4f05a7849c35b1c859580d8">splice</a>(NewBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>(), OrigBB, <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>, OrigBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>());</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="comment">// Add an unconditional branch from OrigBB to NewBB.</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="comment">// Note the new unconditional branch is not being recorded.</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="comment">// There doesn&#39;t seem to be meaningful DebugInfo available; this doesn&#39;t</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="comment">// correspond to anything in the source.</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordtype">unsigned</span> Opc = isThumb ? (isThumb2 ? ARM::t2B : ARM::tB) : <a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">ARM::B</a>;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="keywordflow">if</span> (!isThumb)</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <a class="code" href="namespacellvm.html#a980570dc1410d4ef53806f82028ca381">BuildMI</a>(OrigBB, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Opc)).addMBB(NewBB);</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <a class="code" href="namespacellvm.html#a980570dc1410d4ef53806f82028ca381">BuildMI</a>(OrigBB, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Opc)).addMBB(NewBB)</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a9f1fae6a5dbb6e378ca85df1fded8515">addImm</a>(<a class="code" href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6a8b2ef77967dee1220cc6ee5aee595e11">ARMCC::AL</a>).<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a5125cce72b214df09ca8f93dcbbf4c3a">addReg</a>(0);</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  ++NumSplit;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="comment">// Update the CFG.  All succs of OrigBB are now succs of NewBB.</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  NewBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3c5c3bd0c015f3134dc19fe194f635dd">transferSuccessors</a>(OrigBB);</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="comment">// OrigBB branches to NewBB.</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  OrigBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3fcc360e6de146a370e8b0deecfa877f">addSuccessor</a>(NewBB);</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="comment">// Update internal data structures to account for the newly inserted MBB.</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="comment">// This is almost the same as updateForInsertedWaterBlock, except that</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="comment">// the Water goes after OrigBB, not NewBB.</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  MF-&gt;RenumberBlocks(NewBB);</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="comment">// Insert an entry into BBInfo to align it properly with the (newly</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <span class="comment">// renumbered) block numbers.</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  BBInfo.insert(BBInfo.begin() + NewBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>(), BasicBlockInfo());</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <span class="comment">// Next, update WaterList.  Specifically, we need to add OrigMBB as having</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="comment">// available water after it (but not if it&#39;s already there, which happens</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="comment">// when splitting before a conditional branch that is followed by an</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="comment">// unconditional branch - in that case we want to insert NewBB).</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  water_iterator IP =</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    std::lower_bound(WaterList.begin(), WaterList.end(), OrigBB,</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                     <a class="code" href="ARMConstantIslandPass_8cpp.html#a29885c784cdf6c08d6952699d790c8c4">CompareMBBNumbers</a>);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a>* WaterBB = *IP;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="keywordflow">if</span> (WaterBB == OrigBB)</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    WaterList.<a class="code" href="classllvm_1_1MachineBasicBlock.html#a8d02c1e6ef20f42c10d6f4e7234efd61">insert</a>(<a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(IP), NewBB);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    WaterList.insert(IP, OrigBB);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  NewWaterList.insert(OrigBB);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="comment">// Figure out how large the OrigBB is.  As the first half of the original</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="comment">// block, it cannot contain a tablejump.  The size includes</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="comment">// the new jump we added.  (It should be possible to do this without</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <span class="comment">// recounting everything, but it&#39;s very confusing, and this is rarely</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="comment">// executed.)</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  computeBlockSize(OrigBB);</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="comment">// Figure out how large the NewMBB is.  As the second half of the original</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <span class="comment">// block, it may contain a tablejump.</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  computeBlockSize(NewBB);</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="comment">// All BBOffsets following these blocks must be modified.</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  adjustBBOffsetsAfter(OrigBB);</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="keywordflow">return</span> NewBB;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;}</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment">/// getUserOffset - Compute the offset of U.MI as seen by the hardware</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">/// displacement computation.  Update U.KnownAlignment to match its current</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">/// basic block location.</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment"></span><span class="keywordtype">unsigned</span> ARMConstantIslands::getUserOffset(CPUser &amp;U)<span class="keyword"> const </span>{</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="keywordtype">unsigned</span> UserOffset = getOffsetOf(U.MI);</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="keyword">const</span> BasicBlockInfo &amp;BBI = BBInfo[U.MI-&gt;getParent()-&gt;getNumber()];</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keywordtype">unsigned</span> KnownBits = BBI.internalKnownBits();</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="comment">// The value read from PC is offset from the actual instruction address.</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  UserOffset += (isThumb ? 4 : 8);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <span class="comment">// Because of inline assembly, we may not know the alignment (mod 4) of U.MI.</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="comment">// Make sure U.getMaxDisp() returns a constrained range.</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  U.KnownAlignment = (KnownBits &gt;= 2);</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="comment">// On Thumb, offsets==2 mod 4 are rounded down by the hardware for</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <span class="comment">// purposes of the displacement computation; compensate for that here.</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <span class="comment">// For unknown alignments, getMaxDisp() constrains the range instead.</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  <span class="keywordflow">if</span> (isThumb &amp;&amp; U.KnownAlignment)</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    UserOffset &amp;= ~3u;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="keywordflow">return</span> UserOffset;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;}</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment">/// isOffsetInRange - Checks whether UserOffset (the location of a constant pool</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment">/// reference) is within MaxDisp of TrialOffset (a proposed location of a</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">/// constant pool entry).</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">/// UserOffset is computed by getUserOffset above to include PC adjustments. If</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="comment">/// the mod 4 alignment of UserOffset is not known, the uncertainty must be</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment">/// subtracted from MaxDisp instead. CPUser::getMaxDisp() does that.</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ARMConstantIslands::isOffsetInRange(<span class="keywordtype">unsigned</span> UserOffset,</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                                         <span class="keywordtype">unsigned</span> TrialOffset, <span class="keywordtype">unsigned</span> MaxDisp,</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                                         <span class="keywordtype">bool</span> NegativeOK, <span class="keywordtype">bool</span> IsSoImm) {</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keywordflow">if</span> (UserOffset &lt;= TrialOffset) {</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="comment">// User before the Trial.</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordflow">if</span> (TrialOffset - UserOffset &lt;= MaxDisp)</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="comment">// FIXME: Make use full range of soimm values.</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NegativeOK) {</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="keywordflow">if</span> (UserOffset - TrialOffset &lt;= MaxDisp)</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="comment">// FIXME: Make use full range of soimm values.</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  }</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;}</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">/// isWaterInRange - Returns true if a CPE placed after the specified</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment">/// Water (a basic block) will be in range for the specific MI.</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment">/// Compute how much the function will grow by inserting a CPE after Water.</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ARMConstantIslands::isWaterInRange(<span class="keywordtype">unsigned</span> UserOffset,</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                                        <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a>* Water, CPUser &amp;U,</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                                        <span class="keywordtype">unsigned</span> &amp;Growth) {</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="keywordtype">unsigned</span> CPELogAlign = getCPELogAlign(U.CPEMI);</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="keywordtype">unsigned</span> CPEOffset = BBInfo[Water-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].postOffset(CPELogAlign);</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="keywordtype">unsigned</span> NextBlockOffset, NextBlockAlignment;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">MachineFunction::const_iterator</a> NextBlock = Water;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="keywordflow">if</span> (++NextBlock == MF-&gt;end()) {</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    NextBlockOffset = BBInfo[Water-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].postOffset();</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    NextBlockAlignment = 0;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    NextBlockOffset = BBInfo[NextBlock-&gt;getNumber()].Offset;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    NextBlockAlignment = NextBlock-&gt;getAlignment();</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  }</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="keywordtype">unsigned</span> Size = U.CPEMI-&gt;getOperand(2).getImm();</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="keywordtype">unsigned</span> CPEEnd = CPEOffset + Size;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="comment">// The CPE may be able to hide in the alignment padding before the next</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <span class="comment">// block. It may also cause more padding to be required if it is more aligned</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="comment">// that the next block.</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="keywordflow">if</span> (CPEEnd &gt; NextBlockOffset) {</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    Growth = CPEEnd - NextBlockOffset;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="comment">// Compute the padding that would go at the end of the CPE to align the next</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="comment">// block.</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    Growth += <a class="code" href="namespacellvm.html#af257c0e3adacb6cef58529b996408447">OffsetToAlignment</a>(CPEEnd, 1u &lt;&lt; NextBlockAlignment);</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="comment">// If the CPE is to be inserted before the instruction, that will raise</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="comment">// the offset of the instruction. Also account for unknown alignment padding</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="comment">// in blocks between CPE and the user.</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">if</span> (CPEOffset &lt; UserOffset)</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      UserOffset += Growth + <a class="code" href="ARMConstantIslandPass_8cpp.html#ac25b4192ac5ebe2a7d22b9621d36e203">UnknownPadding</a>(MF-&gt;getAlignment(), CPELogAlign);</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="comment">// CPE fits in existing padding.</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    Growth = 0;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="keywordflow">return</span> isOffsetInRange(UserOffset, CPEOffset, U);</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;}</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment">/// isCPEntryInRange - Returns true if the distance between specific MI and</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment">/// specific ConstPool entry instruction can fit in MI&#39;s displacement field.</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ARMConstantIslands::isCPEntryInRange(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI, <span class="keywordtype">unsigned</span> UserOffset,</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                                      <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI, <span class="keywordtype">unsigned</span> MaxDisp,</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                                      <span class="keywordtype">bool</span> NegOk, <span class="keywordtype">bool</span> DoDump) {</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  <span class="keywordtype">unsigned</span> CPEOffset  = getOffsetOf(CPEMI);</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="keywordflow">if</span> (DoDump) {</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>({</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="keywordtype">unsigned</span> Block = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#aabad9b72f6d20d3462efc34020d39f73">getParent</a>()-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>();</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      <span class="keyword">const</span> BasicBlockInfo &amp;BBI = BBInfo[Block];</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;User of CPE#&quot;</span> &lt;&lt; CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(0).<a class="code" href="classllvm_1_1MachineOperand.html#a7059d68a29d5ecfb37623ab45cdb4e8d">getImm</a>()</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;             &lt;&lt; <span class="stringliteral">&quot; max delta=&quot;</span> &lt;&lt; MaxDisp</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;             &lt;&lt; <a class="code" href="namespacellvm.html#a69dc1b119f8cb95b7e36f586c5aeb372">format</a>(<span class="stringliteral">&quot; insn address=%#x&quot;</span>, UserOffset)</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;             &lt;&lt; <span class="stringliteral">&quot; in BB#&quot;</span> &lt;&lt; Block &lt;&lt; <span class="stringliteral">&quot;: &quot;</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;             &lt;&lt; <a class="code" href="namespacellvm.html#a69dc1b119f8cb95b7e36f586c5aeb372">format</a>(<span class="stringliteral">&quot;%#x-%x\t&quot;</span>, BBI.Offset, BBI.postOffset()) &lt;&lt; *MI</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;             &lt;&lt; <a class="code" href="namespacellvm.html#a69dc1b119f8cb95b7e36f586c5aeb372">format</a>(<span class="stringliteral">&quot;CPE address=%#x offset=%+d: &quot;</span>, CPEOffset,</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                       <span class="keywordtype">int</span>(CPEOffset-UserOffset));</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    });</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  }</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="keywordflow">return</span> isOffsetInRange(UserOffset, CPEOffset, MaxDisp, NegOk);</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;}</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">/// BBIsJumpedOver - Return true of the specified basic block&#39;s only predecessor</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment"></span><span class="comment">/// unconditionally branches to its only successor.</span></div><div class="line"><a name="l01057"></a><span class="lineno"><a class="line" href="ARMConstantIslandPass_8cpp.html#af6522321d1fc294742102bbee0779b62"> 1057</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="ARMConstantIslandPass_8cpp.html#af6522321d1fc294742102bbee0779b62">BBIsJumpedOver</a>(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB) {</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  <span class="keywordflow">if</span> (MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ac9786455bc217ebd35377bb5d5ec8f20">pred_size</a>() != 1 || MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a9ac05913a143322136efcad10ed7548c">succ_size</a>() != 1)</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *Succ = *MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6321b189ea8fd5058663f8a87d6c23e9">succ_begin</a>();</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *Pred = *MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab644fcf07a4c2708333cf66276282357">pred_begin</a>();</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *PredMI = &amp;Pred-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>();</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="keywordflow">if</span> (PredMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a242314c0ae0147d1a7ef54c9bc312616">getOpcode</a>() == <a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">ARM::B</a> || PredMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a242314c0ae0147d1a7ef54c9bc312616">getOpcode</a>() == ARM::tB</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      || PredMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a242314c0ae0147d1a7ef54c9bc312616">getOpcode</a>() == ARM::t2B)</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="keywordflow">return</span> PredMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(0).<a class="code" href="classllvm_1_1MachineOperand.html#a3350f7760c4eec67ea7d8f3063c3d748">getMBB</a>() == Succ;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;}</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="preprocessor">#endif // NDEBUG</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="keywordtype">void</span> ARMConstantIslands::adjustBBOffsetsAfter(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  <span class="keywordtype">unsigned</span> BBNum = BB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>();</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = BBNum + 1, e = MF-&gt;getNumBlockIDs(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="comment">// Get the offset and known bits at the end of the layout predecessor.</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="comment">// Include the alignment of the current block.</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="keywordtype">unsigned</span> LogAlign = MF-&gt;getBlockNumbered(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;getAlignment();</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="keywordtype">unsigned</span> Offset = BBInfo[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1].postOffset(LogAlign);</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="keywordtype">unsigned</span> KnownBits = BBInfo[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1].postKnownBits(LogAlign);</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="comment">// This is where block i begins.  Stop if the offset is already correct,</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="comment">// and we have updated 2 blocks.  This is the maximum number of blocks</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="comment">// changed before calling this function.</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; BBNum + 2 &amp;&amp;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        BBInfo[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Offset == Offset &amp;&amp;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;        BBInfo[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].KnownBits == KnownBits)</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    BBInfo[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Offset = Offset;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    BBInfo[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].KnownBits = KnownBits;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  }</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;}</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment">/// decrementCPEReferenceCount - find the constant pool entry with index CPI</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment">/// and instruction CPEMI, and decrement its refcount.  If the refcount</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment">/// becomes 0 remove the entry and instruction.  Returns true if we removed</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment">/// the entry, false if we didn&#39;t.</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="keywordtype">bool</span> ARMConstantIslands::decrementCPEReferenceCount(<span class="keywordtype">unsigned</span> CPI,</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                                                    <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI) {</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="comment">// Find the old entry. Eliminate it if it is no longer used.</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  CPEntry *CPE = findConstPoolEntry(CPI, CPEMI);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  assert(CPE &amp;&amp; <span class="stringliteral">&quot;Unexpected!&quot;</span>);</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  <span class="keywordflow">if</span> (--CPE-&gt;RefCount == 0) {</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    removeDeadCPEMI(CPEMI);</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    CPE-&gt;CPEMI = NULL;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    --NumCPEs;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  }</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;}</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="comment">/// LookForCPEntryInRange - see if the currently referenced CPE is in range;</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment">/// if not, see if an in-range clone of the CPE is in range, and if so,</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment">/// change the data structures so the user references the clone.  Returns:</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment">/// 0 = no existing entry found</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment">/// 1 = entry found, and there were no code insertions or deletions</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="comment">/// 2 = entry found, and there were code insertions or deletions</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="comment"></span><span class="keywordtype">int</span> ARMConstantIslands::findInRangeCPEntry(CPUser&amp; U, <span class="keywordtype">unsigned</span> UserOffset)</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;{</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *UserMI = U.MI;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI  = U.CPEMI;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  <span class="comment">// Check to see if the CPE is already in-range.</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  <span class="keywordflow">if</span> (isCPEntryInRange(UserMI, UserOffset, CPEMI, U.getMaxDisp(), U.NegOk,</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                       <span class="keyword">true</span>)) {</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;In range\n&quot;</span>);</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  }</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  <span class="comment">// No.  Look for previously created clones of the CPE that are in range.</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  <span class="keywordtype">unsigned</span> CPI = CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(1).<a class="code" href="classllvm_1_1MachineOperand.html#ac9485ae7d6fedd71ad4460f72c799c98">getIndex</a>();</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  std::vector&lt;CPEntry&gt; &amp;CPEs = CPEntries[CPI];</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = CPEs.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <span class="comment">// We already tried this one</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="keywordflow">if</span> (CPEs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].CPEMI == CPEMI)</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="comment">// Removing CPEs can leave empty entries, skip</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <span class="keywordflow">if</span> (CPEs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].CPEMI == NULL)</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="keywordflow">if</span> (isCPEntryInRange(UserMI, UserOffset, CPEs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].CPEMI, U.getMaxDisp(),</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                     U.NegOk)) {</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Replacing CPE#&quot;</span> &lt;&lt; CPI &lt;&lt; <span class="stringliteral">&quot; with CPE#&quot;</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                   &lt;&lt; CPEs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].CPI &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      <span class="comment">// Point the CPUser node to the replacement</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      U.CPEMI = CPEs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].CPEMI;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      <span class="comment">// Change the CPI in the instruction operand to refer to the clone.</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> = 0, e = UserMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a7b5fe96d88954efc855e6c466207e535">getNumOperands</a>(); <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> != e; ++<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>)</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        <span class="keywordflow">if</span> (UserMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>).<a class="code" href="classllvm_1_1MachineOperand.html#a2a6233524fe8cf33f83fe27d3673412c">isCPI</a>()) {</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;          UserMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>).<a class="code" href="classllvm_1_1MachineOperand.html#aebc99c3c37896879abad49e7254a2fb8">setIndex</a>(CPEs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].CPI);</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        }</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      <span class="comment">// Adjust the refcount of the clone...</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      CPEs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].RefCount++;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      <span class="comment">// ...and the original.  If we didn&#39;t remove the old entry, none of the</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      <span class="comment">// addresses changed, so we don&#39;t need another pass.</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      <span class="keywordflow">return</span> decrementCPEReferenceCount(CPI, CPEMI) ? 2 : 1;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    }</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  }</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;}</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="comment">/// getUnconditionalBrDisp - Returns the maximum displacement that can fit in</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">/// the specific unconditional branch instruction.</span></div><div class="line"><a name="l01164"></a><span class="lineno"><a class="line" href="ARMConstantIslandPass_8cpp.html#a2e62a3c07e3b7d0f0591b2d80bd20967"> 1164</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <a class="code" href="ARMConstantIslandPass_8cpp.html#a2e62a3c07e3b7d0f0591b2d80bd20967">getUnconditionalBrDisp</a>(<span class="keywordtype">int</span> Opc) {</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="keywordflow">switch</span> (Opc) {</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  <span class="keywordflow">case</span> ARM::tB:</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">return</span> ((1&lt;&lt;10)-1)*2;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  <span class="keywordflow">case</span> ARM::t2B:</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keywordflow">return</span> ((1&lt;&lt;23)-1)*2;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  }</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  <span class="keywordflow">return</span> ((1&lt;&lt;23)-1)*4;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;}</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="comment">/// findAvailableWater - Look for an existing entry in the WaterList in which</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="comment">/// we can place the CPE referenced from U so it&#39;s within range of U&#39;s MI.</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="comment">/// Returns true if found, false if not.  If it returns true, WaterIter</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="comment">/// is set to the WaterList entry.  For Thumb, prefer water that will not</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment">/// introduce padding to water that will.  To ensure that this pass</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment">/// terminates, the CPE location for a particular CPUser is only allowed to</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment">/// move to a lower address, so search backward from the end of the list and</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment">/// prefer the first water that is in range.</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ARMConstantIslands::findAvailableWater(CPUser &amp;U, <span class="keywordtype">unsigned</span> UserOffset,</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                                      water_iterator &amp;WaterIter) {</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  <span class="keywordflow">if</span> (WaterList.empty())</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  <span class="keywordtype">unsigned</span> BestGrowth = ~0u;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  <span class="keywordflow">for</span> (water_iterator IP = <a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">prior</a>(WaterList.end()), <a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a> = WaterList.begin();;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;       --IP) {</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a>* WaterBB = *IP;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="comment">// Check if water is in range and is either at a lower address than the</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <span class="comment">// current &quot;high water mark&quot; or a new water block that was created since</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="comment">// the previous iteration by inserting an unconditional branch.  In the</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <span class="comment">// latter case, we want to allow resetting the high water mark back to</span></div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="comment">// this new water since we haven&#39;t seen it before.  Inserting branches</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="comment">// should be relatively uncommon and when it does happen, we want to be</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="comment">// sure to take advantage of it for all the CPEs near that block, so that</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="comment">// we don&#39;t insert more branches than necessary.</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="keywordtype">unsigned</span> Growth;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="keywordflow">if</span> (isWaterInRange(UserOffset, WaterBB, U, Growth) &amp;&amp;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        (WaterBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>() &lt; U.HighWaterMark-&gt;getNumber() ||</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;         NewWaterList.count(WaterBB)) &amp;&amp; Growth &lt; BestGrowth) {</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;      <span class="comment">// This is the least amount of required padding seen so far.</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;      BestGrowth = Growth;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      WaterIter = IP;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found water after BB#&quot;</span> &lt;&lt; WaterBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot; Growth=&quot;</span> &lt;&lt; Growth &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      <span class="comment">// Keep looking unless it is perfect.</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      <span class="keywordflow">if</span> (BestGrowth == 0)</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    }</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="keywordflow">if</span> (IP == <a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a>)</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;  }</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;  <span class="keywordflow">return</span> BestGrowth != ~0u;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;}</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="comment">/// createNewWater - No existing WaterList entry will work for</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment">/// CPUsers[CPUserIndex], so create a place to put the CPE.  The end of the</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment">/// block is used if in range, and the conditional branch munged so control</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment">/// flow is correct.  Otherwise the block is split to create a hole with an</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment">/// unconditional branch around it.  In either case NewMBB is set to a</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment">/// block following which the new island can be inserted (the WaterList</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="comment">/// is not adjusted).</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ARMConstantIslands::createNewWater(<span class="keywordtype">unsigned</span> CPUserIndex,</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;                                        <span class="keywordtype">unsigned</span> UserOffset,</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                                        <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *&amp;NewMBB) {</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  CPUser &amp;U = CPUsers[CPUserIndex];</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *UserMI = U.MI;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI  = U.CPEMI;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  <span class="keywordtype">unsigned</span> CPELogAlign = getCPELogAlign(CPEMI);</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *UserMBB = UserMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#aabad9b72f6d20d3462efc34020d39f73">getParent</a>();</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  <span class="keyword">const</span> BasicBlockInfo &amp;UserBBI = BBInfo[UserMBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()];</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="comment">// If the block does not end in an unconditional branch already, and if the</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="comment">// end of the block is within range, make new water there.  (The addition</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  <span class="comment">// below is for the unconditional branch we will be adding: 4 bytes on ARM +</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  <span class="comment">// Thumb2, 2 on Thumb1.</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ARMConstantIslandPass_8cpp.html#a2591f82337ce78f51703e6b3382eec3c">BBHasFallthrough</a>(UserMBB)) {</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    <span class="comment">// Size of branch to insert.</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <span class="keywordtype">unsigned</span> Delta = isThumb1 ? 2 : 4;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <span class="comment">// Compute the offset where the CPE will begin.</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="keywordtype">unsigned</span> CPEOffset = UserBBI.postOffset(CPELogAlign) + Delta;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="keywordflow">if</span> (isOffsetInRange(UserOffset, CPEOffset, U)) {</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Split at end of BB#&quot;</span> &lt;&lt; UserMBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;            &lt;&lt; <a class="code" href="namespacellvm.html#a69dc1b119f8cb95b7e36f586c5aeb372">format</a>(<span class="stringliteral">&quot;, expected CPE offset %#x\n&quot;</span>, CPEOffset));</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      NewMBB = <a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a>(UserMBB));</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      <span class="comment">// Add an unconditional branch from UserMBB to fallthrough block.  Record</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      <span class="comment">// it for branch lengthening; this new branch will not get out of range,</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      <span class="comment">// but if the preceding conditional branch is out of range, the targets</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      <span class="comment">// will be exchanged, and the altered branch may be out of range, so the</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      <span class="comment">// machinery has to know about it.</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      <span class="keywordtype">int</span> UncondBr = isThumb ? ((isThumb2) ? ARM::t2B : ARM::tB) : <a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">ARM::B</a>;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      <span class="keywordflow">if</span> (!isThumb)</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;        <a class="code" href="namespacellvm.html#a980570dc1410d4ef53806f82028ca381">BuildMI</a>(UserMBB, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(UncondBr)).addMBB(NewMBB);</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;        <a class="code" href="namespacellvm.html#a980570dc1410d4ef53806f82028ca381">BuildMI</a>(UserMBB, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(UncondBr)).addMBB(NewMBB)</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;          .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a9f1fae6a5dbb6e378ca85df1fded8515">addImm</a>(<a class="code" href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6a8b2ef77967dee1220cc6ee5aee595e11">ARMCC::AL</a>).<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a5125cce72b214df09ca8f93dcbbf4c3a">addReg</a>(0);</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;      <span class="keywordtype">unsigned</span> MaxDisp = <a class="code" href="ARMConstantIslandPass_8cpp.html#a2e62a3c07e3b7d0f0591b2d80bd20967">getUnconditionalBrDisp</a>(UncondBr);</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;      ImmBranches.push_back(ImmBranch(&amp;UserMBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>(),</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                                      MaxDisp, <span class="keyword">false</span>, UncondBr));</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;      BBInfo[UserMBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Size += Delta;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      adjustBBOffsetsAfter(UserMBB);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    }</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  }</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  <span class="comment">// What a big block.  Find a place within the block to split it.  This is a</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="comment">// little tricky on Thumb1 since instructions are 2 bytes and constant pool</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  <span class="comment">// entries are 4 bytes: if instruction I references island CPE, and</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  <span class="comment">// instruction I+1 references CPE&#39;, it will not work well to put CPE as far</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  <span class="comment">// forward as possible, since then CPE&#39; cannot immediately follow it (that</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <span class="comment">// location is 2 bytes farther away from I+1 than CPE was from I) and we&#39;d</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;  <span class="comment">// need to create a new island.  So, we make a first guess, then walk through</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  <span class="comment">// the instructions between the one currently being looked at and the</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  <span class="comment">// possible insertion point, and make sure any other instructions that</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <span class="comment">// reference CPEs will be able to use the same island area; if not, we back</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <span class="comment">// up the insertion point.</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <span class="comment">// Try to split the block so it&#39;s fully aligned.  Compute the latest split</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  <span class="comment">// point where we can add a 4-byte branch instruction, and then align to</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="comment">// LogAlign which is the largest possible alignment in the function.</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  <span class="keywordtype">unsigned</span> LogAlign = MF-&gt;getAlignment();</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  assert(LogAlign &gt;= CPELogAlign &amp;&amp; <span class="stringliteral">&quot;Over-aligned constant pool entry&quot;</span>);</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  <span class="keywordtype">unsigned</span> KnownBits = UserBBI.internalKnownBits();</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  <span class="keywordtype">unsigned</span> UPad = <a class="code" href="ARMConstantIslandPass_8cpp.html#ac25b4192ac5ebe2a7d22b9621d36e203">UnknownPadding</a>(LogAlign, KnownBits);</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  <span class="keywordtype">unsigned</span> BaseInsertOffset = UserOffset + U.getMaxDisp() - UPad;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a class="code" href="namespacellvm.html#a69dc1b119f8cb95b7e36f586c5aeb372">format</a>(<span class="stringliteral">&quot;Split in middle of big block before %#x&quot;</span>,</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                         BaseInsertOffset));</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;  <span class="comment">// The 4 in the following is for the unconditional branch we&#39;ll be inserting</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <span class="comment">// (allows for long branch on Thumb1).  Alignment of the island is handled</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  <span class="comment">// inside isOffsetInRange.</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  BaseInsertOffset -= 4;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a class="code" href="namespacellvm.html#a69dc1b119f8cb95b7e36f586c5aeb372">format</a>(<span class="stringliteral">&quot;, adjusted to %#x&quot;</span>, BaseInsertOffset)</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; la=&quot;</span> &lt;&lt; LogAlign</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; kb=&quot;</span> &lt;&lt; KnownBits</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; up=&quot;</span> &lt;&lt; UPad &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  <span class="comment">// This could point off the end of the block if we&#39;ve already got constant</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  <span class="comment">// pool entries following this block; only the last one is in the water list.</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <span class="comment">// Back past any possible branches (allow for a conditional and a maximally</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  <span class="comment">// long unconditional).</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  <span class="keywordflow">if</span> (BaseInsertOffset + 8 &gt;= UserBBI.postOffset()) {</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    BaseInsertOffset = UserBBI.postOffset() - UPad - 8;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a class="code" href="namespacellvm.html#a69dc1b119f8cb95b7e36f586c5aeb372">format</a>(<span class="stringliteral">&quot;Move inside block: %#x\n&quot;</span>, BaseInsertOffset));</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  }</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  <span class="keywordtype">unsigned</span> EndInsertOffset = BaseInsertOffset + 4 + UPad +</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(2).<a class="code" href="classllvm_1_1MachineOperand.html#a7059d68a29d5ecfb37623ab45cdb4e8d">getImm</a>();</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html#ac51be7ff80fe8d6ae5e8c0acb194908a">MachineBasicBlock::iterator</a> MI = UserMI;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  ++<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  <span class="keywordtype">unsigned</span> CPUIndex = CPUserIndex+1;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  <span class="keywordtype">unsigned</span> NumCPUsers = CPUsers.size();</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *LastIT = 0;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Offset = UserOffset+<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;GetInstSizeInBytes(UserMI);</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;       Offset &lt; BaseInsertOffset;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;       Offset += <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;GetInstSizeInBytes(MI),</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;       MI = <a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(MI)) {</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    assert(MI != UserMBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>() &amp;&amp; <span class="stringliteral">&quot;Fell off end of block&quot;</span>);</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="keywordflow">if</span> (CPUIndex &lt; NumCPUsers &amp;&amp; CPUsers[CPUIndex].MI == MI) {</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;      CPUser &amp;U = CPUsers[CPUIndex];</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;      <span class="keywordflow">if</span> (!isOffsetInRange(Offset, EndInsertOffset, U)) {</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <span class="comment">// Shift intertion point by one unit of alignment so it is within reach.</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        BaseInsertOffset -= 1u &lt;&lt; LogAlign;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        EndInsertOffset  -= 1u &lt;&lt; LogAlign;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;      }</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;      <span class="comment">// This is overly conservative, as we don&#39;t account for CPEMIs being</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;      <span class="comment">// reused within the block, but it doesn&#39;t matter much.  Also assume CPEs</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;      <span class="comment">// are added in order with alignment padding.  We may eventually be able</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;      <span class="comment">// to pack the aligned CPEs better.</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;      EndInsertOffset += U.CPEMI-&gt;getOperand(2).getImm();</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;      CPUIndex++;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    }</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="comment">// Remember the last IT instruction.</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="keywordflow">if</span> (MI-&gt;getOpcode() == ARM::t2IT)</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;      LastIT = MI;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  }</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  --<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  <span class="comment">// Avoid splitting an IT block.</span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  <span class="keywordflow">if</span> (LastIT) {</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <span class="keywordtype">unsigned</span> PredReg = 0;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <a class="code" href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6">ARMCC::CondCodes</a> <a class="code" href="Target_2PowerPC_2README_8txt.html#afc7ca55ad1da67847ecd4b99ef64dc84">CC</a> = <a class="code" href="namespacellvm.html#a614cd1261ff9b62a08e078da82833912">getITInstrPredicate</a>(MI, PredReg);</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <span class="keywordflow">if</span> (CC != <a class="code" href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6a8b2ef77967dee1220cc6ee5aee595e11">ARMCC::AL</a>)</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      MI = LastIT;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  }</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  NewMBB = splitBlockBeforeInstr(MI);</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;}</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">/// handleConstantPoolUser - Analyze the specified user, checking to see if it</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment">/// is out-of-range.  If so, pick up the constant pool value and move it some</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment">/// place in-range.  Return true if we changed any addresses (thus must run</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment">/// another pass of branch lengthening), false otherwise.</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ARMConstantIslands::handleConstantPoolUser(<span class="keywordtype">unsigned</span> CPUserIndex) {</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  CPUser &amp;U = CPUsers[CPUserIndex];</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *UserMI = U.MI;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI  = U.CPEMI;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  <span class="keywordtype">unsigned</span> CPI = CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(1).<a class="code" href="classllvm_1_1MachineOperand.html#ac9485ae7d6fedd71ad4460f72c799c98">getIndex</a>();</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  <span class="keywordtype">unsigned</span> Size = CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(2).<a class="code" href="classllvm_1_1MachineOperand.html#a7059d68a29d5ecfb37623ab45cdb4e8d">getImm</a>();</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  <span class="comment">// Compute this only once, it&#39;s expensive.</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;  <span class="keywordtype">unsigned</span> UserOffset = getUserOffset(U);</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <span class="comment">// See if the current entry is within range, or there is a clone of it</span></div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  <span class="comment">// in range.</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="Target_2README_8txt.html#aae67c508d4f0716516f5c412c5592556">result</a> = findInRangeCPEntry(U, UserOffset);</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <span class="keywordflow">if</span> (result==1) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (result==2) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  <span class="comment">// No existing clone of this CPE is within range.</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  <span class="comment">// We will be generating a new clone.  Get a UID for it.</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a> = AFI-&gt;createPICLabelUId();</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <span class="comment">// Look for water where we can place this CPE.</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NewIsland = MF-&gt;CreateMachineBasicBlock();</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NewMBB;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  water_iterator IP;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;  <span class="keywordflow">if</span> (findAvailableWater(U, UserOffset, IP)) {</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found water in range\n&quot;</span>);</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *WaterBB = *IP;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    <span class="comment">// If the original WaterList entry was &quot;new water&quot; on this iteration,</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    <span class="comment">// propagate that to the new island.  This is just keeping NewWaterList</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <span class="comment">// updated to match the WaterList, which will be updated below.</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    <span class="keywordflow">if</span> (NewWaterList.erase(WaterBB))</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;      NewWaterList.<a class="code" href="classllvm_1_1MachineBasicBlock.html#a8d02c1e6ef20f42c10d6f4e7234efd61">insert</a>(NewIsland);</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <span class="comment">// The new CPE goes before the following block (NewMBB).</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    NewMBB = <a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a>(WaterBB));</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    <span class="comment">// No water found.</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;No water found\n&quot;</span>);</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    createNewWater(CPUserIndex, UserOffset, NewMBB);</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="comment">// splitBlockBeforeInstr adds to WaterList, which is important when it is</span></div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="comment">// called while handling branches so that the water will be seen on the</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    <span class="comment">// next iteration for constant pools, but in this context, we don&#39;t want</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <span class="comment">// it.  Check for this so it will be removed from the WaterList.</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    <span class="comment">// Also remove any entry from NewWaterList.</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *WaterBB = <a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">prior</a>(<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a>(NewMBB));</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    IP = std::find(WaterList.begin(), WaterList.end(), WaterBB);</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    <span class="keywordflow">if</span> (IP != WaterList.end())</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;      NewWaterList.erase(WaterBB);</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <span class="comment">// We are adding new water.  Update NewWaterList.</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    NewWaterList.insert(NewIsland);</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  }</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  <span class="comment">// Remove the original WaterList entry; we want subsequent insertions in</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  <span class="comment">// this vicinity to go after the one we&#39;re about to insert.  This</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  <span class="comment">// considerably reduces the number of times we have to move the same CPE</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  <span class="comment">// more than once and is also important to ensure the algorithm terminates.</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="keywordflow">if</span> (IP != WaterList.end())</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    WaterList.erase(IP);</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  <span class="comment">// Okay, we know we can put an island before NewMBB now, do it!</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  MF-&gt;insert(NewMBB, NewIsland);</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  <span class="comment">// Update internal data structures to account for the newly inserted MBB.</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  updateForInsertedWaterBlock(NewIsland);</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  <span class="comment">// Decrement the old entry, and remove it if refcount becomes 0.</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  decrementCPEReferenceCount(CPI, CPEMI);</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  <span class="comment">// Now that we have an island to add the CPE to, clone the original CPE and</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;  <span class="comment">// add it to the island.</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  U.HighWaterMark = NewIsland;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  U.CPEMI = <a class="code" href="namespacellvm.html#a980570dc1410d4ef53806f82028ca381">BuildMI</a>(NewIsland, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(ARM::CONSTPOOL_ENTRY))</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;                .addImm(ID).<a class="code" href="classllvm_1_1MachineInstrBuilder.html#ad59a931df03c79a2ea17009ee2a2f96b">addConstantPoolIndex</a>(CPI).<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a9f1fae6a5dbb6e378ca85df1fded8515">addImm</a>(Size);</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  CPEntries[CPI].push_back(CPEntry(U.CPEMI, ID, 1));</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  ++NumCPEs;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  <span class="comment">// Mark the basic block as aligned as required by the const-pool entry.</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  NewIsland-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#aeb1fd8bba75c8cb83e6183bfa1352d3c">setAlignment</a>(getCPELogAlign(U.CPEMI));</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <span class="comment">// Increase the size of the island block to account for the new entry.</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  BBInfo[NewIsland-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Size += Size;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  adjustBBOffsetsAfter(<a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a>(NewIsland)));</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  <span class="comment">// Finally, change the CPI in the instruction operand to be ID.</span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = UserMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a7b5fe96d88954efc855e6c466207e535">getNumOperands</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="keywordflow">if</span> (UserMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>).<a class="code" href="classllvm_1_1MachineOperand.html#a2a6233524fe8cf33f83fe27d3673412c">isCPI</a>()) {</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;      UserMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>).<a class="code" href="classllvm_1_1MachineOperand.html#aebc99c3c37896879abad49e7254a2fb8">setIndex</a>(ID);</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    }</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Moved CPE to #&quot;</span> &lt;&lt; ID &lt;&lt; <span class="stringliteral">&quot; CPI=&quot;</span> &lt;&lt; CPI</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        &lt;&lt; <a class="code" href="namespacellvm.html#a69dc1b119f8cb95b7e36f586c5aeb372">format</a>(<span class="stringliteral">&quot; offset=%#x\n&quot;</span>, BBInfo[NewIsland-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Offset));</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;}</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="comment">/// removeDeadCPEMI - Remove a dead constant pool entry instruction. Update</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="comment">/// sizes and offsets of impacted basic blocks.</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ARMConstantIslands::removeDeadCPEMI(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *CPEMI) {</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *CPEBB = CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#aabad9b72f6d20d3462efc34020d39f73">getParent</a>();</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  <span class="keywordtype">unsigned</span> Size = CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(2).<a class="code" href="classllvm_1_1MachineOperand.html#a7059d68a29d5ecfb37623ab45cdb4e8d">getImm</a>();</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  CPEMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">eraseFromParent</a>();</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  BBInfo[CPEBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Size -= Size;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;  <span class="comment">// All succeeding offsets have the current size value added in, fix this.</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;  <span class="keywordflow">if</span> (CPEBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#aa37d95a1d7bc824da0c596d8334c4ceb">empty</a>()) {</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    BBInfo[CPEBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Size = 0;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <span class="comment">// This block no longer needs to be aligned.</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    CPEBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#aeb1fd8bba75c8cb83e6183bfa1352d3c">setAlignment</a>(0);</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="comment">// Entries are sorted by descending alignment, so realign from the front.</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    CPEBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#aeb1fd8bba75c8cb83e6183bfa1352d3c">setAlignment</a>(getCPELogAlign(CPEBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">begin</a>()));</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  adjustBBOffsetsAfter(CPEBB);</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <span class="comment">// An island has only one predecessor BB and one successor BB. Check if</span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  <span class="comment">// this BB&#39;s predecessor jumps directly to this BB&#39;s successor. This</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  <span class="comment">// shouldn&#39;t happen currently.</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;  assert(!<a class="code" href="ARMConstantIslandPass_8cpp.html#af6522321d1fc294742102bbee0779b62">BBIsJumpedOver</a>(CPEBB) &amp;&amp; <span class="stringliteral">&quot;How did this happen?&quot;</span>);</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;  <span class="comment">// FIXME: remove the empty blocks after all the work is done?</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;}</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="comment">/// removeUnusedCPEntries - Remove constant pool entries whose refcounts</span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="comment">/// are zero.</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ARMConstantIslands::removeUnusedCPEntries() {</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;  <span class="keywordtype">unsigned</span> MadeChange = <span class="keyword">false</span>;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = CPEntries.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;      std::vector&lt;CPEntry&gt; &amp;CPEs = CPEntries[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> = 0, ee = CPEs.size(); <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> != ee; ++<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>) {</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        <span class="keywordflow">if</span> (CPEs[<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>].RefCount == 0 &amp;&amp; CPEs[<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>].CPEMI) {</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;          removeDeadCPEMI(CPEs[<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>].CPEMI);</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;          CPEs[<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>].CPEMI = NULL;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;          MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        }</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      }</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  }</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;}</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="comment">/// isBBInRange - Returns true if the distance between specific MI and</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment">/// specific BB can fit in MI&#39;s displacement field.</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ARMConstantIslands::isBBInRange(<a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI,<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *DestBB,</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                                     <span class="keywordtype">unsigned</span> MaxDisp) {</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  <span class="keywordtype">unsigned</span> PCAdj      = isThumb ? 4 : 8;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;  <span class="keywordtype">unsigned</span> BrOffset   = getOffsetOf(MI) + PCAdj;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;  <span class="keywordtype">unsigned</span> DestOffset = BBInfo[DestBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Offset;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Branch of destination BB#&quot;</span> &lt;&lt; DestBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; from BB#&quot;</span> &lt;&lt; MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#aabad9b72f6d20d3462efc34020d39f73">getParent</a>()-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; max delta=&quot;</span> &lt;&lt; MaxDisp</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; from &quot;</span> &lt;&lt; getOffsetOf(MI) &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; DestOffset</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; offset &quot;</span> &lt;&lt; <a class="code" href="Target_2README_8txt.html#a3217063f680fa8e35dea3c59b6e52b18">int</a>(DestOffset-BrOffset) &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>);</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  <span class="keywordflow">if</span> (BrOffset &lt;= DestOffset) {</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    <span class="comment">// Branch before the Dest.</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    <span class="keywordflow">if</span> (DestOffset-BrOffset &lt;= MaxDisp)</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <span class="keywordflow">if</span> (BrOffset-DestOffset &lt;= MaxDisp)</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;  }</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;}</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="comment">/// fixupImmediateBr - Fix up an immediate branch whose destination is too far</span></div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="comment">/// away to fit in its displacement field.</span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ARMConstantIslands::fixupImmediateBr(ImmBranch &amp;Br) {</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI = Br.MI;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *DestBB = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(0).<a class="code" href="classllvm_1_1MachineOperand.html#a3350f7760c4eec67ea7d8f3063c3d748">getMBB</a>();</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  <span class="comment">// Check to see if the DestBB is already in-range.</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;  <span class="keywordflow">if</span> (isBBInRange(MI, DestBB, Br.MaxDisp))</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  <span class="keywordflow">if</span> (!Br.isCond)</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    <span class="keywordflow">return</span> fixupUnconditionalBr(Br);</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  <span class="keywordflow">return</span> fixupConditionalBr(Br);</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;}</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment">/// fixupUnconditionalBr - Fix up an unconditional branch whose destination is</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="comment">/// too far away to fit in its displacement field. If the LR register has been</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="comment">/// spilled in the epilogue, then we can use BL to implement a far jump.</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="comment">/// Otherwise, add an intermediate branch instruction to a branch.</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;ARMConstantIslands::fixupUnconditionalBr(ImmBranch &amp;Br) {</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI = Br.MI;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#aabad9b72f6d20d3462efc34020d39f73">getParent</a>();</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  <span class="keywordflow">if</span> (!isThumb1)</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;fixupUnconditionalBr is Thumb1 only!&quot;</span>);</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;  <span class="comment">// Use BL to implement far jump.</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  Br.MaxDisp = (1 &lt;&lt; 21) * 2;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a1ecb35298bc4d1fe03997959e1210c87">setDesc</a>(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(ARM::tBfar));</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  BBInfo[MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Size += 2;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  adjustBBOffsetsAfter(MBB);</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  HasFarJump = <span class="keyword">true</span>;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  ++NumUBrFixed;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Changed B to long jump &quot;</span> &lt;&lt; *MI);</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;}</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;<span class="comment">/// fixupConditionalBr - Fix up a conditional branch whose destination is too</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="comment">/// far away to fit in its displacement field. It is converted to an inverse</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;<span class="comment">/// conditional branch + an unconditional branch to the destination.</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;ARMConstantIslands::fixupConditionalBr(ImmBranch &amp;Br) {</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI = Br.MI;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *DestBB = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(0).<a class="code" href="classllvm_1_1MachineOperand.html#a3350f7760c4eec67ea7d8f3063c3d748">getMBB</a>();</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  <span class="comment">// Add an unconditional branch to the destination and invert the branch</span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;  <span class="comment">// condition to jump over it:</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  <span class="comment">// blt L1</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  <span class="comment">// =&gt;</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  <span class="comment">// bge L2</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  <span class="comment">// b   L1</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  <span class="comment">// L2:</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  <a class="code" href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6">ARMCC::CondCodes</a> <a class="code" href="Target_2PowerPC_2README_8txt.html#afc7ca55ad1da67847ecd4b99ef64dc84">CC</a> = (<a class="code" href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6">ARMCC::CondCodes</a>)MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(1).<a class="code" href="classllvm_1_1MachineOperand.html#a7059d68a29d5ecfb37623ab45cdb4e8d">getImm</a>();</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  CC = <a class="code" href="namespacellvm_1_1ARMCC.html#a4bd63de978510703f28cd98ea7c0ffa5">ARMCC::getOppositeCondition</a>(CC);</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;  <span class="keywordtype">unsigned</span> CCReg = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(2).<a class="code" href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">getReg</a>();</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;  <span class="comment">// If the branch is at the end of its MBB and that has a fall-through block,</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;  <span class="comment">// direct the updated conditional branch to the fall-through block. Otherwise,</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  <span class="comment">// split the MBB before the next instruction.</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#aabad9b72f6d20d3462efc34020d39f73">getParent</a>();</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *BMI = &amp;MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>();</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;  <span class="keywordtype">bool</span> NeedSplit = (BMI != <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>) || !<a class="code" href="ARMConstantIslandPass_8cpp.html#a2591f82337ce78f51703e6b3382eec3c">BBHasFallthrough</a>(MBB);</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  ++NumCBrFixed;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;  <span class="keywordflow">if</span> (BMI != MI) {</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(<a class="code" href="classllvm_1_1MachineBasicBlock.html#ac51be7ff80fe8d6ae5e8c0acb194908a">MachineBasicBlock::iterator</a>(MI)) == <a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">prior</a>(MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">end</a>()) &amp;&amp;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;        BMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a242314c0ae0147d1a7ef54c9bc312616">getOpcode</a>() == Br.UncondBr) {</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;      <span class="comment">// Last MI in the BB is an unconditional branch. Can we simply invert the</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;      <span class="comment">// condition and swap destinations:</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;      <span class="comment">// beq L1</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;      <span class="comment">// b   L2</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;      <span class="comment">// =&gt;</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      <span class="comment">// bne L2</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;      <span class="comment">// b   L1</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NewDest = BMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(0).<a class="code" href="classllvm_1_1MachineOperand.html#a3350f7760c4eec67ea7d8f3063c3d748">getMBB</a>();</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      <span class="keywordflow">if</span> (isBBInRange(MI, NewDest, Br.MaxDisp)) {</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Invert Bcc condition and swap its destination with &quot;</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;                     &lt;&lt; *BMI);</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;        BMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(0).<a class="code" href="classllvm_1_1MachineOperand.html#a98e9c9e8ef7cbb6c4aa89a38f21decfa">setMBB</a>(DestBB);</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;        MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(0).<a class="code" href="classllvm_1_1MachineOperand.html#a98e9c9e8ef7cbb6c4aa89a38f21decfa">setMBB</a>(NewDest);</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(1).<a class="code" href="classllvm_1_1MachineOperand.html#a2feaa1c69335c6b9028076cd68c7a5f5">setImm</a>(CC);</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;      }</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    }</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;  }</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  <span class="keywordflow">if</span> (NeedSplit) {</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    splitBlockBeforeInstr(MI);</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    <span class="comment">// No need for the branch to the next block. We&#39;re adding an unconditional</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    <span class="comment">// branch to the destination.</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <span class="keywordtype">int</span> delta = <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;GetInstSizeInBytes(&amp;MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>());</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    BBInfo[MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Size -= delta;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>().<a class="code" href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">eraseFromParent</a>();</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    <span class="comment">// BBInfo[SplitBB].Offset is wrong temporarily, fixed below</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;  }</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NextBB = <a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a>(MBB));</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Insert B to BB#&quot;</span> &lt;&lt; DestBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; also invert condition and change dest. to BB#&quot;</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;               &lt;&lt; NextBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;  <span class="comment">// Insert a new conditional branch and a new unconditional branch.</span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;  <span class="comment">// Also update the ImmBranch as well as adding a new entry for the new branch.</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;  <a class="code" href="namespacellvm.html#a980570dc1410d4ef53806f82028ca381">BuildMI</a>(MBB, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a242314c0ae0147d1a7ef54c9bc312616">getOpcode</a>()))</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#aa1ec82398ade62414be35d8431c0a33b">addMBB</a>(NextBB).<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a9f1fae6a5dbb6e378ca85df1fded8515">addImm</a>(CC).<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a5125cce72b214df09ca8f93dcbbf4c3a">addReg</a>(CCReg);</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;  Br.MI = &amp;MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>();</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;  BBInfo[MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Size += <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;GetInstSizeInBytes(&amp;MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>());</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;  <span class="keywordflow">if</span> (isThumb)</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <a class="code" href="namespacellvm.html#a980570dc1410d4ef53806f82028ca381">BuildMI</a>(MBB, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Br.UncondBr)).addMBB(DestBB)</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;            .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a9f1fae6a5dbb6e378ca85df1fded8515">addImm</a>(<a class="code" href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6a8b2ef77967dee1220cc6ee5aee595e11">ARMCC::AL</a>).<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a5125cce72b214df09ca8f93dcbbf4c3a">addReg</a>(0);</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    <a class="code" href="namespacellvm.html#a980570dc1410d4ef53806f82028ca381">BuildMI</a>(MBB, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Br.UncondBr)).addMBB(DestBB);</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;  BBInfo[MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Size += <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;GetInstSizeInBytes(&amp;MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>());</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;  <span class="keywordtype">unsigned</span> MaxDisp = <a class="code" href="ARMConstantIslandPass_8cpp.html#a2e62a3c07e3b7d0f0591b2d80bd20967">getUnconditionalBrDisp</a>(Br.UncondBr);</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;  ImmBranches.push_back(ImmBranch(&amp;MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">back</a>(), MaxDisp, <span class="keyword">false</span>, Br.UncondBr));</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;  <span class="comment">// Remove the old conditional branch.  It may or may not still be in MBB.</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;  BBInfo[MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#aabad9b72f6d20d3462efc34020d39f73">getParent</a>()-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Size -= <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;GetInstSizeInBytes(MI);</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;  MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">eraseFromParent</a>();</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;  adjustBBOffsetsAfter(MBB);</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;}</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="comment">/// undoLRSpillRestore - Remove Thumb push / pop instructions that only spills</span></div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="comment">/// LR / restores LR to pc. FIXME: This is done here because it&#39;s only possible</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;<span class="comment">/// to do this if tBfar is not used.</span></div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ARMConstantIslands::undoLRSpillRestore() {</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PushPopMIs.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI = PushPopMIs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <span class="comment">// First two operands are predicates.</span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;    <span class="keywordflow">if</span> (MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a242314c0ae0147d1a7ef54c9bc312616">getOpcode</a>() == ARM::tPOP_RET &amp;&amp;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(2).<a class="code" href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">getReg</a>() == ARM::PC &amp;&amp;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a5b3f8688fcfb641f3e6cab129bcc0275">getNumExplicitOperands</a>() == 3) {</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;      <span class="comment">// Create the new insn and copy the predicate from the old.</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;      <a class="code" href="namespacellvm.html#a980570dc1410d4ef53806f82028ca381">BuildMI</a>(MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#aabad9b72f6d20d3462efc34020d39f73">getParent</a>(), MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a5ca4af2a257043145ad650eafb4402f9">getDebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(ARM::tBX_RET))</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;        .addOperand(MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(0))</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        .addOperand(MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(1));</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">eraseFromParent</a>();</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    }</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;  }</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;}</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="comment">// mayOptimizeThumb2Instruction - Returns true if optimizeThumb2Instructions</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="comment">// below may shrink MI.</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;ARMConstantIslands::mayOptimizeThumb2Instruction(<span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI)<span class="keyword"> const </span>{</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  <span class="keywordflow">switch</span>(MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a242314c0ae0147d1a7ef54c9bc312616">getOpcode</a>()) {</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    <span class="comment">// optimizeThumb2Instructions.</span></div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;    <span class="keywordflow">case</span> ARM::t2LEApcrel:</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    <span class="keywordflow">case</span> ARM::t2LDRpci:</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    <span class="comment">// optimizeThumb2Branches.</span></div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <span class="keywordflow">case</span> ARM::t2B:</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    <span class="keywordflow">case</span> ARM::t2Bcc:</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    <span class="keywordflow">case</span> ARM::tBcc:</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <span class="comment">// optimizeThumb2JumpTables.</span></div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    <span class="keywordflow">case</span> ARM::t2BR_JT:</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;  }</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;}</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="keywordtype">bool</span> ARMConstantIslands::optimizeThumb2Instructions() {</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  <span class="comment">// Shrink ADR and LDR from constantpool.</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = CPUsers.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    CPUser &amp;U = CPUsers[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    <span class="keywordtype">unsigned</span> Opcode = U.MI-&gt;getOpcode();</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <span class="keywordtype">unsigned</span> NewOpc = 0;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    <span class="keywordtype">unsigned</span> Scale = 1;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> = 0;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    <span class="keywordflow">switch</span> (Opcode) {</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <span class="keywordflow">case</span> ARM::t2LEApcrel:</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a69b805d50f05b869ab969f6853b8531c">isARMLowRegister</a>(U.MI-&gt;getOperand(0).getReg())) {</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;        NewOpc = ARM::tLEApcrel;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;        Bits = 8;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;        Scale = 4;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      }</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="keywordflow">case</span> ARM::t2LDRpci:</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a69b805d50f05b869ab969f6853b8531c">isARMLowRegister</a>(U.MI-&gt;getOperand(0).getReg())) {</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;        NewOpc = ARM::tLDRpci;</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        Bits = 8;</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;        Scale = 4;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;      }</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    }</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="keywordflow">if</span> (!NewOpc)</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    <span class="keywordtype">unsigned</span> UserOffset = getUserOffset(U);</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    <span class="keywordtype">unsigned</span> MaxOffs = ((1 &lt;&lt; <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a>) - 1) * Scale;</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    <span class="comment">// Be conservative with inline asm.</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    <span class="keywordflow">if</span> (!U.KnownAlignment)</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      MaxOffs -= 2;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    <span class="comment">// FIXME: Check if offset is multiple of scale if scale is not 4.</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    <span class="keywordflow">if</span> (isCPEntryInRange(U.MI, UserOffset, U.CPEMI, MaxOffs, <span class="keyword">false</span>, <span class="keyword">true</span>)) {</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Shrink: &quot;</span> &lt;&lt; *U.MI);</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;      U.MI-&gt;setDesc(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(NewOpc));</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;      <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB = U.MI-&gt;getParent();</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;      BBInfo[MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Size -= 2;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;      adjustBBOffsetsAfter(MBB);</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;      ++NumT2CPShrunk;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;      MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    }</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;  }</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;  MadeChange |= optimizeThumb2Branches();</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;  MadeChange |= optimizeThumb2JumpTables();</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;}</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="keywordtype">bool</span> ARMConstantIslands::optimizeThumb2Branches() {</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = ImmBranches.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    ImmBranch &amp;Br = ImmBranches[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="keywordtype">unsigned</span> Opcode = Br.MI-&gt;getOpcode();</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <span class="keywordtype">unsigned</span> NewOpc = 0;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    <span class="keywordtype">unsigned</span> Scale = 1;</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> = 0;</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <span class="keywordflow">switch</span> (Opcode) {</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="keywordflow">case</span> ARM::t2B:</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      NewOpc = ARM::tB;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;      Bits = 11;</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;      Scale = 2;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="keywordflow">case</span> ARM::t2Bcc: {</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      NewOpc = ARM::tBcc;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;      Bits = 8;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;      Scale = 2;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    }</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    }</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    <span class="keywordflow">if</span> (NewOpc) {</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;      <span class="keywordtype">unsigned</span> MaxOffs = ((1 &lt;&lt; (Bits-1))-1) * Scale;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;      <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *DestBB = Br.MI-&gt;getOperand(0).getMBB();</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;      <span class="keywordflow">if</span> (isBBInRange(Br.MI, DestBB, MaxOffs)) {</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Shrink branch: &quot;</span> &lt;&lt; *Br.MI);</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        Br.MI-&gt;setDesc(<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(NewOpc));</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB = Br.MI-&gt;getParent();</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        BBInfo[MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Size -= 2;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        adjustBBOffsetsAfter(MBB);</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;        ++NumT2BrShrunk;</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;      }</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    }</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    Opcode = Br.MI-&gt;getOpcode();</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    <span class="keywordflow">if</span> (Opcode != ARM::tBcc)</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="comment">// If the conditional branch doesn&#39;t kill CPSR, then CPSR can be liveout</span></div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    <span class="comment">// so this transformation is not safe.</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <span class="keywordflow">if</span> (!Br.MI-&gt;killsRegister(ARM::CPSR))</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    NewOpc = 0;</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <span class="keywordtype">unsigned</span> PredReg = 0;</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    <a class="code" href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6">ARMCC::CondCodes</a> Pred = <a class="code" href="namespacellvm.html#aee7a1f8a965c68c02b5628e9b261197e">getInstrPredicate</a>(Br.MI, PredReg);</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    <span class="keywordflow">if</span> (Pred == <a class="code" href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6a4f1d9a9a0660bc80837984980c7ba402">ARMCC::EQ</a>)</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;      NewOpc = ARM::tCBZ;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Pred == <a class="code" href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6ae08639a6e0f682daf9d9b4809ee0cf7c">ARMCC::NE</a>)</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      NewOpc = ARM::tCBNZ;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <span class="keywordflow">if</span> (!NewOpc)</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *DestBB = Br.MI-&gt;getOperand(0).getMBB();</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    <span class="comment">// Check if the distance is within 126. Subtract starting offset by 2</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    <span class="comment">// because the cmp will be eliminated.</span></div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    <span class="keywordtype">unsigned</span> BrOffset = getOffsetOf(Br.MI) + 4 - 2;</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    <span class="keywordtype">unsigned</span> DestOffset = BBInfo[DestBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Offset;</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    <span class="keywordflow">if</span> (BrOffset &lt; DestOffset &amp;&amp; (DestOffset - BrOffset) &lt;= 126) {</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;      <a class="code" href="classllvm_1_1MachineBasicBlock.html#ac51be7ff80fe8d6ae5e8c0acb194908a">MachineBasicBlock::iterator</a> CmpMI = Br.MI;</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;      <span class="keywordflow">if</span> (CmpMI != Br.MI-&gt;getParent()-&gt;begin()) {</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;        --CmpMI;</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;        <span class="keywordflow">if</span> (CmpMI-&gt;getOpcode() == ARM::tCMPi8) {</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;          <span class="keywordtype">unsigned</span> <a class="code" href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a> = CmpMI-&gt;getOperand(0).getReg();</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;          Pred = <a class="code" href="namespacellvm.html#aee7a1f8a965c68c02b5628e9b261197e">getInstrPredicate</a>(CmpMI, PredReg);</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;          <span class="keywordflow">if</span> (Pred == <a class="code" href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6a8b2ef77967dee1220cc6ee5aee595e11">ARMCC::AL</a> &amp;&amp;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;              CmpMI-&gt;getOperand(1).getImm() == 0 &amp;&amp;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;              <a class="code" href="namespacellvm.html#a69b805d50f05b869ab969f6853b8531c">isARMLowRegister</a>(Reg)) {</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;            <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB = Br.MI-&gt;getParent();</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;            <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Fold: &quot;</span> &lt;&lt; *CmpMI &lt;&lt; <span class="stringliteral">&quot; and: &quot;</span> &lt;&lt; *Br.MI);</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;            <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *NewBR =</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;              <a class="code" href="namespacellvm.html#a980570dc1410d4ef53806f82028ca381">BuildMI</a>(*MBB, CmpMI, Br.MI-&gt;getDebugLoc(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(NewOpc))</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;              .addReg(Reg).<a class="code" href="classllvm_1_1MachineInstrBuilder.html#aa1ec82398ade62414be35d8431c0a33b">addMBB</a>(DestBB,Br.MI-&gt;getOperand(0).getTargetFlags());</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;            CmpMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">eraseFromParent</a>();</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;            Br.MI-&gt;eraseFromParent();</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;            Br.MI = NewBR;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;            BBInfo[MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Size -= 2;</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;            adjustBBOffsetsAfter(MBB);</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;            ++NumCBZ;</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;            MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;          }</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;        }</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;      }</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    }</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;  }</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;}</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="comment">/// optimizeThumb2JumpTables - Use tbb / tbh instructions to generate smaller</span></div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment">/// jumptables when it&#39;s possible.</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ARMConstantIslands::optimizeThumb2JumpTables() {</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;  <span class="comment">// FIXME: After the tables are shrunk, can we get rid some of the</span></div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  <span class="comment">// constantpool tables?</span></div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;  <a class="code" href="classllvm_1_1MachineJumpTableInfo.html">MachineJumpTableInfo</a> *MJTI = MF-&gt;getJumpTableInfo();</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;  <span class="keywordflow">if</span> (MJTI == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  <span class="keyword">const</span> std::vector&lt;MachineJumpTableEntry&gt; &amp;JT = MJTI-&gt;<a class="code" href="classllvm_1_1MachineJumpTableInfo.html#adebd965803507068e86d6d3d454338e9">getJumpTables</a>();</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = T2JumpTables.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI = T2JumpTables[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1MCInstrDesc.html">MCInstrDesc</a> &amp;MCID = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a803a7424877fd049679b9aa2f07597b5">getDesc</a>();</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;    <span class="keywordtype">unsigned</span> NumOps = MCID.<a class="code" href="classllvm_1_1MCInstrDesc.html#a55194ec3a1e49d04eab64e993e614246">getNumOperands</a>();</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    <span class="keywordtype">unsigned</span> JTOpIdx = NumOps - (MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a65917695d9792adaf44d85541df98de2">isPredicable</a>() ? 3 : 2);</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> JTOP = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(JTOpIdx);</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    <span class="keywordtype">unsigned</span> JTI = JTOP.<a class="code" href="classllvm_1_1MachineOperand.html#ac9485ae7d6fedd71ad4460f72c799c98">getIndex</a>();</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    assert(JTI &lt; JT.size());</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    <span class="keywordtype">bool</span> ByteOk = <span class="keyword">true</span>;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    <span class="keywordtype">bool</span> HalfWordOk = <span class="keyword">true</span>;</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    <span class="keywordtype">unsigned</span> JTOffset = getOffsetOf(MI) + 4;</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    <span class="keyword">const</span> std::vector&lt;MachineBasicBlock*&gt; &amp;JTBBs = JT[JTI].MBBs;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> = 0, ee = JTBBs.size(); <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> != ee; ++<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>) {</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;      <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB = JTBBs[<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>];</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;      <span class="keywordtype">unsigned</span> DstOffset = BBInfo[MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Offset;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;      <span class="comment">// Negative offset is not ok. FIXME: We should change BB layout to make</span></div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;      <span class="comment">// sure all the branches are forward.</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;      <span class="keywordflow">if</span> (ByteOk &amp;&amp; (DstOffset - JTOffset) &gt; ((1&lt;&lt;8)-1)*2)</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        ByteOk = <span class="keyword">false</span>;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;      <span class="keywordtype">unsigned</span> TBHLimit = ((1&lt;&lt;16)-1)*2;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;      <span class="keywordflow">if</span> (HalfWordOk &amp;&amp; (DstOffset - JTOffset) &gt; TBHLimit)</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;        HalfWordOk = <span class="keyword">false</span>;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;      <span class="keywordflow">if</span> (!ByteOk &amp;&amp; !HalfWordOk)</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    }</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <span class="keywordflow">if</span> (ByteOk || HalfWordOk) {</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#aabad9b72f6d20d3462efc34020d39f73">getParent</a>();</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;      <span class="keywordtype">unsigned</span> BaseReg = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(0).<a class="code" href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">getReg</a>();</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;      <span class="keywordtype">bool</span> BaseRegKill = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(0).<a class="code" href="classllvm_1_1MachineOperand.html#aa21b508be8c212bdb0b28d734ab0ddb8">isKill</a>();</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;      <span class="keywordflow">if</span> (!BaseRegKill)</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;      <span class="keywordtype">unsigned</span> IdxReg = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(1).<a class="code" href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">getReg</a>();</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;      <span class="keywordtype">bool</span> IdxRegKill = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(1).<a class="code" href="classllvm_1_1MachineOperand.html#aa21b508be8c212bdb0b28d734ab0ddb8">isKill</a>();</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;      <span class="comment">// Scan backwards to find the instruction that defines the base</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;      <span class="comment">// register. Due to post-RA scheduling, we can&#39;t count on it</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;      <span class="comment">// immediately preceding the branch instruction.</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;      <a class="code" href="classllvm_1_1MachineBasicBlock.html#ac51be7ff80fe8d6ae5e8c0acb194908a">MachineBasicBlock::iterator</a> PrevI = <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>;</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;      <a class="code" href="classllvm_1_1MachineBasicBlock.html#ac51be7ff80fe8d6ae5e8c0acb194908a">MachineBasicBlock::iterator</a> <a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a> = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;      <span class="keywordflow">while</span> (PrevI != B &amp;&amp; !PrevI-&gt;definesRegister(BaseReg))</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;        --PrevI;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;      <span class="comment">// If for some reason we didn&#39;t find it, we can&#39;t do anything, so</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;      <span class="comment">// just skip this one.</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;      <span class="keywordflow">if</span> (!PrevI-&gt;definesRegister(BaseReg))</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;      <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *AddrMI = PrevI;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;      <span class="keywordtype">bool</span> OptOk = <span class="keyword">true</span>;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;      <span class="comment">// Examine the instruction that calculates the jumptable entry address.</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;      <span class="comment">// Make sure it only defines the base register and kills any uses</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      <span class="comment">// other than the index register.</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> k = 0, eee = AddrMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a7b5fe96d88954efc855e6c466207e535">getNumOperands</a>(); k != eee; ++k) {</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <span class="keyword">const</span> <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> &amp;MO = AddrMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(k);</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        <span class="keywordflow">if</span> (!MO.<a class="code" href="classllvm_1_1MachineOperand.html#ad8198d6d83af9410d867136e33fbf4b2">isReg</a>() || !MO.<a class="code" href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">getReg</a>())</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        <span class="keywordflow">if</span> (MO.<a class="code" href="classllvm_1_1MachineOperand.html#a8de7d5cf38939044471c6ee60a01a3df">isDef</a>() &amp;&amp; MO.<a class="code" href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">getReg</a>() != BaseReg) {</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;          OptOk = <span class="keyword">false</span>;</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;        }</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;        <span class="keywordflow">if</span> (MO.<a class="code" href="classllvm_1_1MachineOperand.html#a57bf9ee7219097ff0f98da23a3b3b782">isUse</a>() &amp;&amp; !MO.<a class="code" href="classllvm_1_1MachineOperand.html#aa21b508be8c212bdb0b28d734ab0ddb8">isKill</a>() &amp;&amp; MO.<a class="code" href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">getReg</a>() != IdxReg) {</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;          OptOk = <span class="keyword">false</span>;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;        }</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;      }</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;      <span class="keywordflow">if</span> (!OptOk)</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;      <span class="comment">// Now scan back again to find the tLEApcrel or t2LEApcrelJT instruction</span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <span class="comment">// that gave us the initial base register definition.</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;      <span class="keywordflow">for</span> (--PrevI; PrevI != B &amp;&amp; !PrevI-&gt;definesRegister(BaseReg); --PrevI)</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;        ;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;      <span class="comment">// The instruction should be a tLEApcrel or t2LEApcrelJT; we want</span></div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      <span class="comment">// to delete it as well.</span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *LeaMI = PrevI;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;      <span class="keywordflow">if</span> ((LeaMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a242314c0ae0147d1a7ef54c9bc312616">getOpcode</a>() != ARM::tLEApcrelJT &amp;&amp;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;           LeaMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a242314c0ae0147d1a7ef54c9bc312616">getOpcode</a>() != ARM::t2LEApcrelJT) ||</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;          LeaMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(0).<a class="code" href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">getReg</a>() != BaseReg)</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;        OptOk = <span class="keyword">false</span>;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;      <span class="keywordflow">if</span> (!OptOk)</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Shrink JT: &quot;</span> &lt;&lt; *MI &lt;&lt; <span class="stringliteral">&quot;     addr: &quot;</span> &lt;&lt; *AddrMI</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot;      lea: &quot;</span> &lt;&lt; *LeaMI);</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      <span class="keywordtype">unsigned</span> Opc = ByteOk ? ARM::t2TBB_JT : ARM::t2TBH_JT;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;      <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *NewJTMI = <a class="code" href="namespacellvm.html#a980570dc1410d4ef53806f82028ca381">BuildMI</a>(MBB, MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a5ca4af2a257043145ad650eafb4402f9">getDebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Opc))</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;        .addReg(IdxReg, <a class="code" href="namespacellvm.html#aac57d4100e9a9d02522fbd724568397d">getKillRegState</a>(IdxRegKill))</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;        .addJumpTableIndex(JTI, JTOP.getTargetFlags())</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        .addImm(MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(JTOpIdx+1).<a class="code" href="classllvm_1_1MachineOperand.html#a7059d68a29d5ecfb37623ab45cdb4e8d">getImm</a>());</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;BB#&quot;</span> &lt;&lt; MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; *NewJTMI);</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      <span class="comment">// FIXME: Insert an &quot;ALIGN&quot; instruction to ensure the next instruction</span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;      <span class="comment">// is 2-byte aligned. For now, asm printer will fix it up.</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;      <span class="keywordtype">unsigned</span> NewSize = <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;GetInstSizeInBytes(NewJTMI);</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      <span class="keywordtype">unsigned</span> OrigSize = <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;GetInstSizeInBytes(AddrMI);</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      OrigSize += <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;GetInstSizeInBytes(LeaMI);</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;      OrigSize += <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;GetInstSizeInBytes(MI);</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;      AddrMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">eraseFromParent</a>();</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;      LeaMI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">eraseFromParent</a>();</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;      MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">eraseFromParent</a>();</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;      <span class="keywordtype">int</span> delta = OrigSize - NewSize;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;      BBInfo[MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>()].Size -= delta;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;      adjustBBOffsetsAfter(MBB);</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;      ++NumTBs;</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;      MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    }</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;  }</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;}</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;<span class="comment">/// reorderThumb2JumpTables - Adjust the function&#39;s block layout to ensure that</span></div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;<span class="comment">/// jump tables always branch forwards, since that&#39;s what tbb and tbh need.</span></div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ARMConstantIslands::reorderThumb2JumpTables() {</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;  <a class="code" href="classllvm_1_1MachineJumpTableInfo.html">MachineJumpTableInfo</a> *MJTI = MF-&gt;getJumpTableInfo();</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;  <span class="keywordflow">if</span> (MJTI == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;  <span class="keyword">const</span> std::vector&lt;MachineJumpTableEntry&gt; &amp;JT = MJTI-&gt;<a class="code" href="classllvm_1_1MachineJumpTableInfo.html#adebd965803507068e86d6d3d454338e9">getJumpTables</a>();</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = T2JumpTables.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;    <a class="code" href="classllvm_1_1MachineInstr.html">MachineInstr</a> *MI = T2JumpTables[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1MCInstrDesc.html">MCInstrDesc</a> &amp;MCID = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a803a7424877fd049679b9aa2f07597b5">getDesc</a>();</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    <span class="keywordtype">unsigned</span> NumOps = MCID.<a class="code" href="classllvm_1_1MCInstrDesc.html#a55194ec3a1e49d04eab64e993e614246">getNumOperands</a>();</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    <span class="keywordtype">unsigned</span> JTOpIdx = NumOps - (MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a65917695d9792adaf44d85541df98de2">isPredicable</a>() ? 3 : 2);</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    <a class="code" href="classllvm_1_1MachineOperand.html">MachineOperand</a> JTOP = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">getOperand</a>(JTOpIdx);</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;    <span class="keywordtype">unsigned</span> JTI = JTOP.<a class="code" href="classllvm_1_1MachineOperand.html#ac9485ae7d6fedd71ad4460f72c799c98">getIndex</a>();</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    assert(JTI &lt; JT.size());</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;    <span class="comment">// We prefer if target blocks for the jump table come after the jump</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    <span class="comment">// instruction so we can use TB[BH]. Loop through the target blocks</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;    <span class="comment">// and try to adjust them such that that&#39;s true.</span></div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    <span class="keywordtype">int</span> JTNumber = MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#aabad9b72f6d20d3462efc34020d39f73">getParent</a>()-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>();</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <span class="keyword">const</span> std::vector&lt;MachineBasicBlock*&gt; &amp;JTBBs = JT[JTI].MBBs;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> = 0, ee = JTBBs.size(); <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> != ee; ++<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>) {</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;      <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *MBB = JTBBs[<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>];</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;      <span class="keywordtype">int</span> DTNumber = MBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">getNumber</a>();</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;      <span class="keywordflow">if</span> (DTNumber &lt; JTNumber) {</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;        <span class="comment">// The destination precedes the switch. Try to move the block forward</span></div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;        <span class="comment">// so we have a positive offset.</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;        <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NewBB =</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;          adjustJTTargetBlockForward(MBB, MI-&gt;<a class="code" href="classllvm_1_1MachineInstr.html#aabad9b72f6d20d3462efc34020d39f73">getParent</a>());</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;        <span class="keywordflow">if</span> (NewBB)</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;          MJTI-&gt;<a class="code" href="classllvm_1_1MachineJumpTableInfo.html#a729a069c6d2880c2c75148c61998c129">ReplaceMBBInJumpTable</a>(JTI, JTBBs[<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>], NewBB);</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;        MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;      }</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    }</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;  }</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;}</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *ARMConstantIslands::</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;adjustJTTargetBlockForward(<a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *BB, <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *JTBB) {</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  <span class="comment">// If the destination block is terminated by an unconditional branch,</span></div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;  <span class="comment">// try to move it; otherwise, create a new block following the jump</span></div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;  <span class="comment">// table that branches back to the actual target. This is a very simple</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;  <span class="comment">// heuristic. FIXME: We can definitely improve it.</span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *TBB = 0, *FBB = 0;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MachineOperand, 4&gt;</a> Cond;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;MachineOperand, 4&gt;</a> CondPrior;</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;  <a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> BBi = <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;  <a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> OldPrior = <a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">prior</a>(BBi);</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;  <span class="comment">// If the block terminator isn&#39;t analyzable, don&#39;t try to move the block</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a> = <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;<a class="code" href="classllvm_1_1HexagonInstrInfo.html#a6f9cdb0ade88e5375e97bb0905925c5d">AnalyzeBranch</a>(*BB, TBB, FBB, Cond);</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;  <span class="comment">// If the block ends in an unconditional branch, move it. The prior block</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;  <span class="comment">// has to have an analyzable terminator for us to move this one. Be paranoid</span></div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;  <span class="comment">// and make sure we&#39;re not trying to move the entry block of the function.</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;  <span class="keywordflow">if</span> (!B &amp;&amp; Cond.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>() &amp;&amp; BB != MF-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">begin</a>() &amp;&amp;</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;      !<a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;<a class="code" href="classllvm_1_1HexagonInstrInfo.html#a6f9cdb0ade88e5375e97bb0905925c5d">AnalyzeBranch</a>(*OldPrior, TBB, FBB, CondPrior)) {</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    BB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#af3c2dc75190645b72eee3c416cd14885">moveAfter</a>(JTBB);</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    OldPrior-&gt;updateTerminator();</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    BB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#adae3eecba34e135c8ad4e05e29ea8be1">updateTerminator</a>();</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    <span class="comment">// Update numbering to account for the block being moved.</span></div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;    MF-&gt;RenumberBlocks();</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    ++NumJTMoved;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;  }</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;  <span class="comment">// Create a new MBB for the code after the jump BB.</span></div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;  <a class="code" href="classllvm_1_1MachineBasicBlock.html">MachineBasicBlock</a> *NewBB =</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    MF-&gt;CreateMachineBasicBlock(JTBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a2961c31b29db17a4f2964899c8569a64">getBasicBlock</a>());</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;  <a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> MBBI = JTBB; ++MBBI;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;  MF-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a8d02c1e6ef20f42c10d6f4e7234efd61">insert</a>(MBBI, NewBB);</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;  <span class="comment">// Add an unconditional branch from NewBB to BB.</span></div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;  <span class="comment">// There doesn&#39;t seem to be meaningful DebugInfo available; this doesn&#39;t</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;  <span class="comment">// correspond directly to anything in the source.</span></div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;  assert (isThumb2 &amp;&amp; <span class="stringliteral">&quot;Adjusting for TB[BH] but not in Thumb2?&quot;</span>);</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;  <a class="code" href="namespacellvm.html#a980570dc1410d4ef53806f82028ca381">BuildMI</a>(NewBB, <a class="code" href="classllvm_1_1DebugLoc.html">DebugLoc</a>(), <a class="code" href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(ARM::t2B)).addMBB(BB)</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;          .<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a9f1fae6a5dbb6e378ca85df1fded8515">addImm</a>(<a class="code" href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6a8b2ef77967dee1220cc6ee5aee595e11">ARMCC::AL</a>).<a class="code" href="classllvm_1_1MachineInstrBuilder.html#a5125cce72b214df09ca8f93dcbbf4c3a">addReg</a>(0);</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;  <span class="comment">// Update internal data structures to account for the newly inserted MBB.</span></div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;  MF-&gt;RenumberBlocks(NewBB);</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;  <span class="comment">// Update the CFG.</span></div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;  NewBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3fcc360e6de146a370e8b0deecfa877f">addSuccessor</a>(BB);</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;  JTBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#aabc149950316b323f9cdac2122ff0131">removeSuccessor</a>(BB);</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;  JTBB-&gt;<a class="code" href="classllvm_1_1MachineBasicBlock.html#a3fcc360e6de146a370e8b0deecfa877f">addSuccessor</a>(NewBB);</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;  ++NumJTInserted;</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;  <span class="keywordflow">return</span> NewBB;</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;}</div><div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a22a311dfe4c28a897de8a9365a4f0a84"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">llvm::SmallVectorTemplateCommon&lt; T &gt;::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00127">SmallVector.h:127</a></div></div>
<div class="ttc" id="SmallSet_8h_html"><div class="ttname"><a href="SmallSet_8h.html">SmallSet.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a9ac05913a143322136efcad10ed7548c"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a9ac05913a143322136efcad10ed7548c">llvm::MachineBasicBlock::succ_size</a></div><div class="ttdeci">unsigned succ_size() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00288">MachineBasicBlock.h:288</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_af2e482ff2a9253ec6bc2285491496bd6"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#af2e482ff2a9253ec6bc2285491496bd6">llvm::MachineBasicBlock::getParent</a></div><div class="ttdeci">const MachineFunction * getParent() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00137">MachineBasicBlock.h:137</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html"><div class="ttname"><a href="classllvm_1_1DataLayout.html">llvm::DataLayout</a></div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00098">DataLayout.h:98</a></div></div>
<div class="ttc" id="classllvm_1_1MachineConstantPool_html"><div class="ttname"><a href="classllvm_1_1MachineConstantPool.html">llvm::MachineConstantPool</a></div><div class="ttdoc">The machine constant pool. </div><div class="ttdef"><b>Definition:</b> <a href="MachineConstantPool_8h_source.html#l00134">MachineConstantPool.h:134</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a034eb3171c0fc312556559ac96d11c2b"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a034eb3171c0fc312556559ac96d11c2b">llvm::MachineBasicBlock::dump</a></div><div class="ttdeci">void dump() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l00240">MachineBasicBlock.cpp:240</a></div></div>
<div class="ttc" id="classllvm_1_1HexagonInstrInfo_html_a6f9cdb0ade88e5375e97bb0905925c5d"><div class="ttname"><a href="classllvm_1_1HexagonInstrInfo.html#a6f9cdb0ade88e5375e97bb0905925c5d">llvm::HexagonInstrInfo::AnalyzeBranch</a></div><div class="ttdeci">virtual bool AnalyzeBranch(MachineBasicBlock &amp;MBB, MachineBasicBlock *&amp;TBB, MachineBasicBlock *&amp;FBB, SmallVectorImpl&lt; MachineOperand &gt; &amp;Cond, bool AllowModify) const </div><div class="ttdef"><b>Definition:</b> <a href="HexagonInstrInfo_8cpp_source.html#l00172">HexagonInstrInfo.cpp:172</a></div></div>
<div class="ttc" id="namespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">List of target independent CodeGen pass IDs. </div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l00022">APFloat.h:22</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_a02def7c594e9f19ff247ed0bf33d1c30"><div class="ttname"><a href="Target_2README_8txt.html#a02def7c594e9f19ff247ed0bf33d1c30">size</a></div><div class="ttdeci">i&lt; reg-&gt; size</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00204">Target/README.txt:204</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_a3350f7760c4eec67ea7d8f3063c3d748"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a3350f7760c4eec67ea7d8f3063c3d748">llvm::MachineOperand::getMBB</a></div><div class="ttdeci">MachineBasicBlock * getMBB() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00417">MachineOperand.h:417</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_a9d017af749f76484cb9aec9ff6e4330c"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#a9d017af749f76484cb9aec9ff6e4330c">llvm::MachineFunction::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00317">MachineFunction.h:317</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html"><div class="ttname"><a href="classllvm_1_1MachineFunction.html">llvm::MachineFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00075">MachineFunction.h:75</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a6acda287e5c19ffb173b0bf8f1dd9c5e"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a6acda287e5c19ffb173b0bf8f1dd9c5e">llvm::MachineBasicBlock::getNumber</a></div><div class="ttdeci">int getNumber() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00615">MachineBasicBlock.h:615</a></div></div>
<div class="ttc" id="ARMMachineFunctionInfo_8h_html"><div class="ttname"><a href="ARMMachineFunctionInfo_8h.html">ARMMachineFunctionInfo.h</a></div></div>
<div class="ttc" id="DataLayout_8h_html"><div class="ttname"><a href="DataLayout_8h.html">DataLayout.h</a></div></div>
<div class="ttc" id="classllvm_1_1MCInstrDesc_html"><div class="ttname"><a href="classllvm_1_1MCInstrDesc.html">llvm::MCInstrDesc</a></div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00137">MCInstrDesc.h:137</a></div></div>
<div class="ttc" id="Debug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_a3a76669632041022e6976766a22bd2b0"><div class="ttname"><a href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a></div><div class="ttdeci">return j(j&lt;&lt; 16)</div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_a65917695d9792adaf44d85541df98de2"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a65917695d9792adaf44d85541df98de2">llvm::MachineInstr::isPredicable</a></div><div class="ttdeci">bool isPredicable(QueryType Type=AllInBundle) const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00404">MachineInstr.h:404</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a3ddd708642d60c1661992ff8ba1b215d"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a3ddd708642d60c1661992ff8ba1b215d">llvm::MachineBasicBlock::succ_end</a></div><div class="ttdeci">succ_iterator succ_end()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00278">MachineBasicBlock.h:278</a></div></div>
<div class="ttc" id="Target_2TargetMachine_8h_html"><div class="ttname"><a href="Target_2TargetMachine_8h.html">TargetMachine.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARMCC_html_ac8391dd6b8083baa870dee5142ff22b6a4f1d9a9a0660bc80837984980c7ba402"><div class="ttname"><a href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6a4f1d9a9a0660bc80837984980c7ba402">llvm::ARMCC::EQ</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInfo_8h_source.html#l00030">ARMBaseInfo.h:30</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_a803a7424877fd049679b9aa2f07597b5"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a803a7424877fd049679b9aa2f07597b5">llvm::MachineInstr::getDesc</a></div><div class="ttdeci">const MCInstrDesc &amp; getDesc() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00257">MachineInstr.h:257</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_af3c2dc75190645b72eee3c416cd14885"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#af3c2dc75190645b72eee3c416cd14885">llvm::MachineBasicBlock::moveAfter</a></div><div class="ttdeci">void moveAfter(MachineBasicBlock *NewBefore)</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l00381">MachineBasicBlock.cpp:381</a></div></div>
<div class="ttc" id="classllvm_1_1DebugLoc_html"><div class="ttname"><a href="classllvm_1_1DebugLoc.html">llvm::DebugLoc</a></div><div class="ttdef"><b>Definition:</b> <a href="DebugLoc_8h_source.html#l00028">DebugLoc.h:28</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_ac015f68d60ea67a2e31bc10bc720d3e8"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#ac015f68d60ea67a2e31bc10bc720d3e8">llvm::Intrinsic::getType</a></div><div class="ttdeci">FunctionType * getType(LLVMContext &amp;Context, ID id, ArrayRef&lt; Type * &gt; Tys=None)</div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00657">Function.cpp:657</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_acbc921830578e2741be6549db716c0ce"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#acbc921830578e2741be6549db716c0ce">llvm::MachineBasicBlock::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00238">MachineBasicBlock.h:238</a></div></div>
<div class="ttc" id="Statistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_ace3ed0412f841777b7de55d47883890e"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ace3ed0412f841777b7de55d47883890e">llvm::MachineBasicBlock::back</a></div><div class="ttdeci">MachineInstr &amp; back()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00223">MachineBasicBlock.h:223</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_aeb1fd8bba75c8cb83e6183bfa1352d3c"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#aeb1fd8bba75c8cb83e6183bfa1352d3c">llvm::MachineBasicBlock::setAlignment</a></div><div class="ttdeci">void setAlignment(unsigned Align)</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00327">MachineBasicBlock.h:327</a></div></div>
<div class="ttc" id="namespacellvm_1_1cl_html_a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6"><div class="ttname"><a href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">llvm::cl::Hidden</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00109">CommandLine.h:109</a></div></div>
<div class="ttc" id="classllvm_1_1MachineJumpTableInfo_html_a729a069c6d2880c2c75148c61998c129"><div class="ttname"><a href="classllvm_1_1MachineJumpTableInfo.html#a729a069c6d2880c2c75148c61998c129">llvm::MachineJumpTableInfo::ReplaceMBBInJumpTable</a></div><div class="ttdeci">bool ReplaceMBBInJumpTable(unsigned Idx, MachineBasicBlock *Old, MachineBasicBlock *New)</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8cpp_source.html#l00751">MachineFunction.cpp:751</a></div></div>
<div class="ttc" id="namespacellvm_html_a614cd1261ff9b62a08e078da82833912"><div class="ttname"><a href="namespacellvm.html#a614cd1261ff9b62a08e078da82833912">llvm::getITInstrPredicate</a></div><div class="ttdeci">ARMCC::CondCodes getITInstrPredicate(const MachineInstr *MI, unsigned &amp;PredReg)</div><div class="ttdef"><b>Definition:</b> <a href="Thumb2InstrInfo_8cpp_source.html#l00626">Thumb2InstrInfo.cpp:626</a></div></div>
<div class="ttc" id="namespacellvm_html_a1f6978055dbb761b380de39070e34bd3"><div class="ttname"><a href="namespacellvm.html#a1f6978055dbb761b380de39070e34bd3">llvm::report_fatal_error</a></div><div class="ttdeci">LLVM_ATTRIBUTE_NORETURN void report_fatal_error(const char *reason, bool gen_crash_diag=true)</div><div class="ttdef"><b>Definition:</b> <a href="ErrorHandling_8cpp_source.html#l00053">ErrorHandling.cpp:53</a></div></div>
<div class="ttc" id="ARMConstantIslandPass_8cpp_html_a29885c784cdf6c08d6952699d790c8c4"><div class="ttname"><a href="ARMConstantIslandPass_8cpp.html#a29885c784cdf6c08d6952699d790c8c4">CompareMBBNumbers</a></div><div class="ttdeci">static bool CompareMBBNumbers(const MachineBasicBlock *LHS, const MachineBasicBlock *RHS)</div><div class="ttdef"><b>Definition:</b> <a href="ARMConstantIslandPass_8cpp_source.html#l00844">ARMConstantIslandPass.cpp:844</a></div></div>
<div class="ttc" id="X86DisassemblerDecoder_8h_html_a546839a5c4bcf9f9450967155f48de41"><div class="ttname"><a href="X86DisassemblerDecoder_8h.html#a546839a5c4bcf9f9450967155f48de41">Reg</a></div><div class="ttdeci">Reg</div><div class="ttdef"><b>Definition:</b> <a href="X86DisassemblerDecoder_8h_source.html#l00428">X86DisassemblerDecoder.h:428</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_aae67c508d4f0716516f5c412c5592556"><div class="ttname"><a href="Target_2README_8txt.html#aae67c508d4f0716516f5c412c5592556">result</a></div><div class="ttdeci">then result</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00393">Target/README.txt:393</a></div></div>
<div class="ttc" id="classllvm_1_1MachineJumpTableInfo_html_adebd965803507068e86d6d3d454338e9"><div class="ttname"><a href="classllvm_1_1MachineJumpTableInfo.html#adebd965803507068e86d6d3d454338e9">llvm::MachineJumpTableInfo::getJumpTables</a></div><div class="ttdeci">const std::vector&lt; MachineJumpTableEntry &gt; &amp; getJumpTables() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineJumpTableInfo_8h_source.html#l00099">MachineJumpTableInfo.h:99</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_a3217063f680fa8e35dea3c59b6e52b18"><div class="ttname"><a href="Target_2README_8txt.html#a3217063f680fa8e35dea3c59b6e52b18">int</a></div><div class="ttdeci">Clang compiles this i1 i64 store i64 i64 store i64 i64 store i64 i64 store i64 align Which gets codegen d xmm0 movaps rbp movaps rbp movaps rbp movaps rbp rbp rbp rbp rbp It would be better to have movq s of instead of the movaps s LLVM produces ret int</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00549">Target/README.txt:549</a></div></div>
<div class="ttc" id="MachineConstantPool_8h_html"><div class="ttname"><a href="MachineConstantPool_8h.html">MachineConstantPool.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunctionPass_html"><div class="ttname"><a href="classllvm_1_1MachineFunctionPass.html">llvm::MachineFunctionPass</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineFunctionPass_8h_source.html#l00032">MachineFunctionPass.h:32</a></div></div>
<div class="ttc" id="HexagonCopyToCombine_8cpp_html_a1d40004718218dbdf06b496766299101"><div class="ttname"><a href="HexagonCopyToCombine_8cpp.html#a1d40004718218dbdf06b496766299101">TII</a></div><div class="ttdeci">const HexagonInstrInfo * TII</div><div class="ttdef"><b>Definition:</b> <a href="HexagonCopyToCombine_8cpp_source.html#l00115">HexagonCopyToCombine.cpp:115</a></div></div>
<div class="ttc" id="ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdef"><b>Definition:</b> <a href="ErrorHandling_8h_source.html#l00103">ErrorHandling.h:103</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_ad8198d6d83af9410d867136e33fbf4b2"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#ad8198d6d83af9410d867136e33fbf4b2">llvm::MachineOperand::isReg</a></div><div class="ttdeci">bool isReg() const </div><div class="ttdoc">isReg - Tests if this is a MO_Register operand. </div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00224">MachineOperand.h:224</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_ac2421adbb9996e1b15f03a8abb6c70a8"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#ac2421adbb9996e1b15f03a8abb6c70a8">llvm::MachineInstr::eraseFromParent</a></div><div class="ttdeci">void eraseFromParent()</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8cpp_source.html#l00846">MachineInstr.cpp:846</a></div></div>
<div class="ttc" id="STLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_aefba5f2af370add1bc8aaceedf7878ef"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#aefba5f2af370add1bc8aaceedf7878ef">llvm::MachineBasicBlock::succ_iterator</a></div><div class="ttdeci">std::vector&lt; MachineBasicBlock * &gt;::iterator succ_iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00249">MachineBasicBlock.h:249</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_aebc99c3c37896879abad49e7254a2fb8"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#aebc99c3c37896879abad49e7254a2fb8">llvm::MachineOperand::setIndex</a></div><div class="ttdeci">void setIndex(int Idx)</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00500">MachineOperand.h:500</a></div></div>
<div class="ttc" id="ErrorHandling_8h_html"><div class="ttname"><a href="ErrorHandling_8h.html">ErrorHandling.h</a></div></div>
<div class="ttc" id="Thumb2InstrInfo_8h_html"><div class="ttname"><a href="Thumb2InstrInfo_8h.html">Thumb2InstrInfo.h</a></div></div>
<div class="ttc" id="classllvm_1_1ARMBaseInstrInfo_html"><div class="ttname"><a href="classllvm_1_1ARMBaseInstrInfo.html">llvm::ARMBaseInstrInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInstrInfo_8h_source.html#l00030">ARMBaseInstrInfo.h:30</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_aa37d95a1d7bc824da0c596d8334c4ceb"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#aa37d95a1d7bc824da0c596d8334c4ceb">llvm::MachineBasicBlock::empty</a></div><div class="ttdeci">bool empty() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00220">MachineBasicBlock.h:220</a></div></div>
<div class="ttc" id="namespacellvm_1_1CallingConv_html_a4f861731fc6dbfdccc05af5968d98974"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">llvm::CallingConv::ID</a></div><div class="ttdeci">ID</div><div class="ttdoc">LLVM Calling Convention Representation. </div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00026">CallingConv.h:26</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstrBuilder_html_a9f1fae6a5dbb6e378ca85df1fded8515"><div class="ttname"><a href="classllvm_1_1MachineInstrBuilder.html#a9f1fae6a5dbb6e378ca85df1fded8515">llvm::MachineInstrBuilder::addImm</a></div><div class="ttdeci">const MachineInstrBuilder &amp; addImm(int64_t Val) const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00083">MachineInstrBuilder.h:83</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_a7b5fe96d88954efc855e6c466207e535"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a7b5fe96d88954efc855e6c466207e535">llvm::MachineInstr::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00265">MachineInstr.h:265</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_a2a6233524fe8cf33f83fe27d3673412c"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a2a6233524fe8cf33f83fe27d3673412c">llvm::MachineOperand::isCPI</a></div><div class="ttdeci">bool isCPI() const </div><div class="ttdoc">isCPI - Tests if this is a MO_ConstantPoolIndex operand. </div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00236">MachineOperand.h:236</a></div></div>
<div class="ttc" id="namespacellvm_html_a69dc1b119f8cb95b7e36f586c5aeb372"><div class="ttname"><a href="namespacellvm.html#a69dc1b119f8cb95b7e36f586c5aeb372">llvm::format</a></div><div class="ttdeci">format_object1&lt; T &gt; format(const char *Fmt, const T &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="Format_8h_source.html#l00180">Format.h:180</a></div></div>
<div class="ttc" id="namespacellvm_html_ab26ecc37dfb0700afd44f8648a34ab82"><div class="ttname"><a href="namespacellvm.html#ab26ecc37dfb0700afd44f8648a34ab82">llvm::createARMConstantIslandPass</a></div><div class="ttdeci">FunctionPass * createARMConstantIslandPass()</div><div class="ttdef"><b>Definition:</b> <a href="ARMConstantIslandPass_8cpp_source.html#l00372">ARMConstantIslandPass.cpp:372</a></div></div>
<div class="ttc" id="ARMConstantIslandPass_8cpp_html_a2591f82337ce78f51703e6b3382eec3c"><div class="ttname"><a href="ARMConstantIslandPass_8cpp.html#a2591f82337ce78f51703e6b3382eec3c">BBHasFallthrough</a></div><div class="ttdeci">static bool BBHasFallthrough(MachineBasicBlock *MBB)</div><div class="ttdef"><b>Definition:</b> <a href="ARMConstantIslandPass_8cpp_source.html#l00568">ARMConstantIslandPass.cpp:568</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_aa21b508be8c212bdb0b28d734ab0ddb8"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#aa21b508be8c212bdb0b28d734ab0ddb8">llvm::MachineOperand::isKill</a></div><div class="ttdeci">bool isKill() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00289">MachineOperand.h:289</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a3c5c3bd0c015f3134dc19fe194f635dd"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a3c5c3bd0c015f3134dc19fe194f635dd">llvm::MachineBasicBlock::transferSuccessors</a></div><div class="ttdeci">void transferSuccessors(MachineBasicBlock *fromMBB)</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l00574">MachineBasicBlock.cpp:574</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorBase_html_a8a8df4d85555c7954a95f86080cd3b64"><div class="ttname"><a href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">llvm::SmallVectorBase::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00056">SmallVector.h:56</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_a242314c0ae0147d1a7ef54c9bc312616"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a242314c0ae0147d1a7ef54c9bc312616">llvm::MachineInstr::getOpcode</a></div><div class="ttdeci">int getOpcode() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00261">MachineInstr.h:261</a></div></div>
<div class="ttc" id="namespacellvm_html_abdaf1eaf6120421977095bd97eee892e"><div class="ttname"><a href="namespacellvm.html#abdaf1eaf6120421977095bd97eee892e">llvm::countTrailingZeros</a></div><div class="ttdeci">enable_if_c&lt; std::numeric_limits&lt; T &gt;::is_integer &amp;&amp;!std::numeric_limits&lt; T &gt;::is_signed, std::size_t &gt;::type countTrailingZeros(T Val, ZeroBehavior ZB=ZB_Width)</div><div class="ttdoc">Count number of 0&amp;#39;s from the least significant bit to the most stopping at the first 1...</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00049">MathExtras.h:49</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_a73ef91cc71d405f55dd5a77ff8ba56ba"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#a73ef91cc71d405f55dd5a77ff8ba56ba">llvm::MachineFunction::RenumberBlocks</a></div><div class="ttdeci">void RenumberBlocks(MachineBasicBlock *MBBFrom=0)</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8cpp_source.html#l00132">MachineFunction.cpp:132</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_a7059d68a29d5ecfb37623ab45cdb4e8d"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a7059d68a29d5ecfb37623ab45cdb4e8d">llvm::MachineOperand::getImm</a></div><div class="ttdeci">int64_t getImm() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00402">MachineOperand.h:402</a></div></div>
<div class="ttc" id="ARMConstantIslandPass_8cpp_html_a60a2842d1f0fa734eb1f802393ad1cb3"><div class="ttname"><a href="ARMConstantIslandPass_8cpp.html#a60a2842d1f0fa734eb1f802393ad1cb3">STATISTIC</a></div><div class="ttdeci">STATISTIC(NumCPEs,&quot;Number of constpool entries&quot;)</div></div>
<div class="ttc" id="namespacellvm_html_aac57d4100e9a9d02522fbd724568397d"><div class="ttname"><a href="namespacellvm.html#aac57d4100e9a9d02522fbd724568397d">llvm::getKillRegState</a></div><div class="ttdeci">unsigned getKillRegState(bool B)</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00389">MachineInstrBuilder.h:389</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a2961c31b29db17a4f2964899c8569a64"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a2961c31b29db17a4f2964899c8569a64">llvm::MachineBasicBlock::getBasicBlock</a></div><div class="ttdeci">const BasicBlock * getBasicBlock() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00117">MachineBasicBlock.h:117</a></div></div>
<div class="ttc" id="classllvm_1_1MachineJumpTableInfo_html"><div class="ttname"><a href="classllvm_1_1MachineJumpTableInfo.html">llvm::MachineJumpTableInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineJumpTableInfo_8h_source.html#l00042">MachineJumpTableInfo.h:42</a></div></div>
<div class="ttc" id="classllvm_1_1ARMSubtarget_html"><div class="ttname"><a href="classllvm_1_1ARMSubtarget.html">llvm::ARMSubtarget</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMSubtarget_8h_source.html#l00031">ARMSubtarget.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_aabad9b72f6d20d3462efc34020d39f73"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#aabad9b72f6d20d3462efc34020d39f73">llvm::MachineInstr::getParent</a></div><div class="ttdeci">const MachineBasicBlock * getParent() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00119">MachineInstr.h:119</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_ac51be7ff80fe8d6ae5e8c0acb194908a"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ac51be7ff80fe8d6ae5e8c0acb194908a">llvm::MachineBasicBlock::iterator</a></div><div class="ttdeci">bundle_iterator&lt; MachineInstr, instr_iterator &gt; iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00212">MachineBasicBlock.h:212</a></div></div>
<div class="ttc" id="CommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1cl_html_a10a041239ae1870cfcc064bfaa79fb65"><div class="ttname"><a href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00314">CommandLine.h:314</a></div></div>
<div class="ttc" id="LLParser_8cpp_html_aae58e3df0180401e8f3ab75c18fbc07a"><div class="ttname"><a href="LLParser_8cpp.html#aae58e3df0180401e8f3ab75c18fbc07a">if</a></div><div class="ttdeci">* if(!EatIfPresent(lltok::kw_thread_local)) return false</div></div>
<div class="ttc" id="MachineJumpTableInfo_8h_html"><div class="ttname"><a href="MachineJumpTableInfo_8h.html">MachineJumpTableInfo.h</a></div></div>
<div class="ttc" id="namespacellvm_html_aee7a1f8a965c68c02b5628e9b261197e"><div class="ttname"><a href="namespacellvm.html#aee7a1f8a965c68c02b5628e9b261197e">llvm::getInstrPredicate</a></div><div class="ttdeci">ARMCC::CondCodes getInstrPredicate(const MachineInstr *MI, unsigned &amp;PredReg)</div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInstrInfo_8cpp_source.html#l01619">ARMBaseInstrInfo.cpp:1619</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARMCC_html_ac8391dd6b8083baa870dee5142ff22b6ae08639a6e0f682daf9d9b4809ee0cf7c"><div class="ttname"><a href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6ae08639a6e0f682daf9d9b4809ee0cf7c">llvm::ARMCC::NE</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInfo_8h_source.html#l00031">ARMBaseInfo.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1SmallSet_html"><div class="ttname"><a href="classllvm_1_1SmallSet.html">llvm::SmallSet</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallSet_8h_source.html#l00031">SmallSet.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_a302e45878c6dc1714334c7ce96d56846"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a302e45878c6dc1714334c7ce96d56846">llvm::MachineInstr::getOperand</a></div><div class="ttdeci">const MachineOperand &amp; getOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00267">MachineInstr.h:267</a></div></div>
<div class="ttc" id="structllvm_1_1cl_1_1desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1desc.html">llvm::cl::desc</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00286">CommandLine.h:286</a></div></div>
<div class="ttc" id="ARMConstantIslandPass_8cpp_html_a3a46a1b65277dd4e3a55d99df759418c"><div class="ttname"><a href="ARMConstantIslandPass_8cpp.html#a3a46a1b65277dd4e3a55d99df759418c">AlignConstantIslands</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; AlignConstantIslands(&quot;arm-align-constant-islands&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Align constant islands in code&quot;))</div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_a520b3ba31f64d45634ad724b0e778073"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#a520b3ba31f64d45634ad724b0e778073">llvm::MachineFunction::ensureAlignment</a></div><div class="ttdeci">void ensureAlignment(unsigned A)</div><div class="ttdoc">ensureAlignment - Make sure the function is at least 1 &lt;&lt; A bytes aligned. </div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00204">MachineFunction.h:204</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_a98e9c9e8ef7cbb6c4aa89a38f21decfa"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a98e9c9e8ef7cbb6c4aa89a38f21decfa">llvm::MachineOperand::setMBB</a></div><div class="ttdeci">void setMBB(MachineBasicBlock *MBB)</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00506">MachineOperand.h:506</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html">llvm::MachineBasicBlock</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00062">MachineBasicBlock.h:62</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_a5b3f8688fcfb641f3e6cab129bcc0275"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a5b3f8688fcfb641f3e6cab129bcc0275">llvm::MachineInstr::getNumExplicitOperands</a></div><div class="ttdeci">unsigned getNumExplicitOperands() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8cpp_source.html#l00858">MachineInstr.cpp:858</a></div></div>
<div class="ttc" id="namespacellvm_html_aa1704159f75e6eacd595962ea6d93ffe"><div class="ttname"><a href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a></div><div class="ttdeci">ItTy next(ItTy it, Dist n)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00154">STLExtras.h:154</a></div></div>
<div class="ttc" id="ARMConstantIslandPass_8cpp_html_af6522321d1fc294742102bbee0779b62"><div class="ttname"><a href="ARMConstantIslandPass_8cpp.html#af6522321d1fc294742102bbee0779b62">BBIsJumpedOver</a></div><div class="ttdeci">static bool BBIsJumpedOver(MachineBasicBlock *MBB)</div><div class="ttdef"><b>Definition:</b> <a href="ARMConstantIslandPass_8cpp_source.html#l01057">ARMConstantIslandPass.cpp:1057</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_a2feaa1c69335c6b9028076cd68c7a5f5"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a2feaa1c69335c6b9028076cd68c7a5f5">llvm::MachineOperand::setImm</a></div><div class="ttdeci">void setImm(int64_t immVal)</div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00488">MachineOperand.h:488</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionPass_html"><div class="ttname"><a href="classllvm_1_1FunctionPass.html">llvm::FunctionPass</a></div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00293">Pass.h:293</a></div></div>
<div class="ttc" id="ARMConstantIslandPass_8cpp_html_ac25b4192ac5ebe2a7d22b9621d36e203"><div class="ttname"><a href="ARMConstantIslandPass_8cpp.html#ac25b4192ac5ebe2a7d22b9621d36e203">UnknownPadding</a></div><div class="ttdeci">static unsigned UnknownPadding(unsigned LogAlign, unsigned KnownBits)</div><div class="ttdef"><b>Definition:</b> <a href="ARMConstantIslandPass_8cpp_source.html#l00066">ARMConstantIslandPass.cpp:66</a></div></div>
<div class="ttc" id="Target_2PowerPC_2README_8txt_html_afc7ca55ad1da67847ecd4b99ef64dc84"><div class="ttname"><a href="Target_2PowerPC_2README_8txt.html#afc7ca55ad1da67847ecd4b99ef64dc84">CC</a></div><div class="ttdeci">which only computes the address of bar double int Z void if you have a function since the bit double ate up the argument bytes for r4 and r5 The trick then would be to shuffle the argument order for functions we can internalize so that the maximum number of integers pointers get passed in regs before you see any of the fp arguments Instead of implementing it would actually probably be easier to just implement a PPC where we could do whatever we wanted to the CC</div><div class="ttdef"><b>Definition:</b> <a href="Target_2PowerPC_2README_8txt_source.html#l00247">Target/PowerPC/README.txt:247</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_aa460158a4019a4043faf6ea76344cbd5"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#aa460158a4019a4043faf6ea76344cbd5">llvm::MachineFunction::getConstantPool</a></div><div class="ttdeci">MachineConstantPool * getConstantPool()</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00192">MachineFunction.h:192</a></div></div>
<div class="ttc" id="namespacellvm_html_a980570dc1410d4ef53806f82028ca381"><div class="ttname"><a href="namespacellvm.html#a980570dc1410d4ef53806f82028ca381">llvm::BuildMI</a></div><div class="ttdeci">MachineInstrBuilder BuildMI(MachineFunction &amp;MF, DebugLoc DL, const MCInstrDesc &amp;MCID)</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00223">MachineInstrBuilder.h:223</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a6321b189ea8fd5058663f8a87d6c23e9"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a6321b189ea8fd5058663f8a87d6c23e9">llvm::MachineBasicBlock::succ_begin</a></div><div class="ttdeci">succ_iterator succ_begin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00276">MachineBasicBlock.h:276</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_aabc149950316b323f9cdac2122ff0131"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#aabc149950316b323f9cdac2122ff0131">llvm::MachineBasicBlock::removeSuccessor</a></div><div class="ttdeci">void removeSuccessor(MachineBasicBlock *succ)</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l00496">MachineBasicBlock.cpp:496</a></div></div>
<div class="ttc" id="namespacellvm_1_1tgtok_html_abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95"><div class="ttname"><a href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">llvm::tgtok::Bits</a></div><div class="ttdef"><b>Definition:</b> <a href="TGLexer_8h_source.html#l00046">TGLexer.h:46</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_ab644fcf07a4c2708333cf66276282357"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ab644fcf07a4c2708333cf66276282357">llvm::MachineBasicBlock::pred_begin</a></div><div class="ttdeci">pred_iterator pred_begin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00260">MachineBasicBlock.h:260</a></div></div>
<div class="ttc" id="Format_8h_html"><div class="ttname"><a href="Format_8h.html">Format.h</a></div></div>
<div class="ttc" id="classllvm_1_1ilist__iterator_html"><div class="ttname"><a href="classllvm_1_1ilist__iterator.html">llvm::ilist_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00050">ilist.h:50</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_a1ecb35298bc4d1fe03997959e1210c87"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a1ecb35298bc4d1fe03997959e1210c87">llvm::MachineInstr::setDesc</a></div><div class="ttdeci">void setDesc(const MCInstrDesc &amp;tid)</div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00984">MachineInstr.h:984</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_a1d6fcc02e91ba24510aba42660c90e29"><div class="ttname"><a href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">llvm::DataLayout::getTypeAllocSize</a></div><div class="ttdeci">uint64_t getTypeAllocSize(Type *Ty) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00326">DataLayout.h:326</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00029">Target/README.txt:29</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARMCC_html_ac8391dd6b8083baa870dee5142ff22b6"><div class="ttname"><a href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6">llvm::ARMCC::CondCodes</a></div><div class="ttdeci">CondCodes</div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInfo_8h_source.html#l00029">ARMBaseInfo.h:29</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html"><div class="ttname"><a href="classllvm_1_1MachineOperand.html">llvm::MachineOperand</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00043">MachineOperand.h:43</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00880">SmallVector.h:880</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_adae3eecba34e135c8ad4e05e29ea8be1"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#adae3eecba34e135c8ad4e05e29ea8be1">llvm::MachineBasicBlock::updateTerminator</a></div><div class="ttdeci">void updateTerminator()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l00386">MachineBasicBlock.cpp:386</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_a8de7d5cf38939044471c6ee60a01a3df"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a8de7d5cf38939044471c6ee60a01a3df">llvm::MachineOperand::isDef</a></div><div class="ttdeci">bool isDef() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00274">MachineOperand.h:274</a></div></div>
<div class="ttc" id="ARMConstantIslandPass_8cpp_html_a2bf7ff457d9d0d8b2c6679c50c656b01"><div class="ttname"><a href="ARMConstantIslandPass_8cpp.html#a2bf7ff457d9d0d8b2c6679c50c656b01">AdjustJumpTableBlocks</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; AdjustJumpTableBlocks(&quot;arm-adjust-jump-tables&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Adjust basic block layout to better use TB[BH]&quot;))</div></div>
<div class="ttc" id="ARM_8h_html"><div class="ttname"><a href="ARM_8h.html">ARM.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs - Return a circular-buffered debug stream. </div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00101">Debug.cpp:101</a></div></div>
<div class="ttc" id="namespacellvm_html_a646986783f35e0fef8988f0f28d2589f"><div class="ttname"><a href="namespacellvm.html#a646986783f35e0fef8988f0f28d2589f">llvm::Log2_32</a></div><div class="ttdeci">unsigned Log2_32(uint32_t Value)</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00443">MathExtras.h:443</a></div></div>
<div class="ttc" id="CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="CodeGen_2README_8txt_source.html#l00036">CodeGen/README.txt:36</a></div></div>
<div class="ttc" id="MachineRegisterInfo_8h_html"><div class="ttname"><a href="MachineRegisterInfo_8h.html">MachineRegisterInfo.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a69b805d50f05b869ab969f6853b8531c"><div class="ttname"><a href="namespacellvm.html#a69b805d50f05b869ab969f6853b8531c">llvm::isARMLowRegister</a></div><div class="ttdeci">static bool isARMLowRegister(unsigned Reg)</div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInfo_8h_source.html#l00209">ARMBaseInfo.h:209</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html"><div class="ttname"><a href="classllvm_1_1MachineInstr.html">llvm::MachineInstr</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00050">MachineInstr.h:50</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARMCC_html_a4bd63de978510703f28cd98ea7c0ffa5"><div class="ttname"><a href="namespacellvm_1_1ARMCC.html#a4bd63de978510703f28cd98ea7c0ffa5">llvm::ARMCC::getOppositeCondition</a></div><div class="ttdeci">static CondCodes getOppositeCondition(CondCodes CC)</div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInfo_8h_source.html#l00047">ARMBaseInfo.h:47</a></div></div>
<div class="ttc" id="classllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l01149">CommandLine.h:1149</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_ac9485ae7d6fedd71ad4460f72c799c98"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#ac9485ae7d6fedd71ad4460f72c799c98">llvm::MachineOperand::getIndex</a></div><div class="ttdeci">int getIndex() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00422">MachineOperand.h:422</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_adf0023bdc4f05a7849c35b1c859580d8"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#adf0023bdc4f05a7849c35b1c859580d8">llvm::MachineBasicBlock::splice</a></div><div class="ttdeci">void splice(iterator Where, MachineBasicBlock *Other, iterator From)</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00539">MachineBasicBlock.h:539</a></div></div>
<div class="ttc" id="classllvm_1_1ARMFunctionInfo_html"><div class="ttname"><a href="classllvm_1_1ARMFunctionInfo.html">llvm::ARMFunctionInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMMachineFunctionInfo_8h_source.html#l00027">ARMMachineFunctionInfo.h:27</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_a57bf9ee7219097ff0f98da23a3b3b782"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#a57bf9ee7219097ff0f98da23a3b3b782">llvm::MachineOperand::isUse</a></div><div class="ttdeci">bool isUse() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00269">MachineOperand.h:269</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstrBuilder_html_ad59a931df03c79a2ea17009ee2a2f96b"><div class="ttname"><a href="classllvm_1_1MachineInstrBuilder.html#ad59a931df03c79a2ea17009ee2a2f96b">llvm::MachineInstrBuilder::addConstantPoolIndex</a></div><div class="ttdeci">const MachineInstrBuilder &amp; addConstantPoolIndex(unsigned Idx, int Offset=0, unsigned char TargetFlags=0) const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00109">MachineInstrBuilder.h:109</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a3b1dce1f3354a357fb9061bb7568a84e"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a3b1dce1f3354a357fb9061bb7568a84e">llvm::MachineBasicBlock::push_back</a></div><div class="ttdeci">void push_back(MachineInstr *MI)</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00450">MachineBasicBlock.h:450</a></div></div>
<div class="ttc" id="MD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00054">MD5.cpp:54</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARMCC_html_ac8391dd6b8083baa870dee5142ff22b6a8b2ef77967dee1220cc6ee5aee595e11"><div class="ttname"><a href="namespacellvm_1_1ARMCC.html#ac8391dd6b8083baa870dee5142ff22b6a8b2ef77967dee1220cc6ee5aee595e11">llvm::ARMCC::AL</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInfo_8h_source.html#l00044">ARMBaseInfo.h:44</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_ab2d91e7bec944efcbc39d8e30644f111"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ab2d91e7bec944efcbc39d8e30644f111">llvm::MachineBasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00236">MachineBasicBlock.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a8d02c1e6ef20f42c10d6f4e7234efd61"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a8d02c1e6ef20f42c10d6f4e7234efd61">llvm::MachineBasicBlock::insert</a></div><div class="ttdeci">instr_iterator insert(instr_iterator I, MachineInstr *M)</div></div>
<div class="ttc" id="ARMConstantIslandPass_8cpp_html_a2e62a3c07e3b7d0f0591b2d80bd20967"><div class="ttname"><a href="ARMConstantIslandPass_8cpp.html#a2e62a3c07e3b7d0f0591b2d80bd20967">getUnconditionalBrDisp</a></div><div class="ttdeci">static unsigned getUnconditionalBrDisp(int Opc)</div><div class="ttdef"><b>Definition:</b> <a href="ARMConstantIslandPass_8cpp_source.html#l01164">ARMConstantIslandPass.cpp:1164</a></div></div>
<div class="ttc" id="classllvm_1_1MachineOperand_html_ab75f703d251cc0ce0206fe00a999db86"><div class="ttname"><a href="classllvm_1_1MachineOperand.html#ab75f703d251cc0ce0206fe00a999db86">llvm::MachineOperand::getReg</a></div><div class="ttdeci">unsigned getReg() const </div><div class="ttdoc">getReg - Returns the register number. </div><div class="ttdef"><b>Definition:</b> <a href="MachineOperand_8h_source.html#l00259">MachineOperand.h:259</a></div></div>
<div class="ttc" id="ARMSubtarget_8cpp_html_a4bd80d4e433d9f72af26b364036900dc"><div class="ttname"><a href="ARMSubtarget_8cpp.html#a4bd80d4e433d9f72af26b364036900dc">Align</a></div><div class="ttdeci">static cl::opt&lt; AlignMode &gt; Align(cl::desc(&quot;Load/store alignment support&quot;), cl::Hidden, cl::init(DefaultAlign), cl::values(clEnumValN(DefaultAlign,&quot;arm-default-align&quot;,&quot;Generate unaligned accesses only on hardware/OS &quot;&quot;combinations that are known to support them&quot;), clEnumValN(StrictAlign,&quot;arm-strict-align&quot;,&quot;Disallow all unaligned memory accesses&quot;), clEnumValN(NoStrictAlign,&quot;arm-no-strict-align&quot;,&quot;Allow unaligned memory accesses&quot;), clEnumValEnd))</div></div>
<div class="ttc" id="Target_2X86_2README_8txt_html_a668d6902e1f37328dfbbb1f75aa82fc9"><div class="ttname"><a href="Target_2X86_2README_8txt.html#a668d6902e1f37328dfbbb1f75aa82fc9">a</a></div><div class="ttdeci">=0.0?0.0:(a &gt; 0.0?1.0:-1.0) a</div><div class="ttdef"><b>Definition:</b> <a href="Target_2X86_2README_8txt_source.html#l00652">Target/X86/README.txt:652</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstrBuilder_html_aa1ec82398ade62414be35d8431c0a33b"><div class="ttname"><a href="classllvm_1_1MachineInstrBuilder.html#aa1ec82398ade62414be35d8431c0a33b">llvm::MachineInstrBuilder::addMBB</a></div><div class="ttdeci">const MachineInstrBuilder &amp; addMBB(MachineBasicBlock *MBB, unsigned char TargetFlags=0) const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00098">MachineInstrBuilder.h:98</a></div></div>
<div class="ttc" id="SmallVector_8h_html"><div class="ttname"><a href="SmallVector_8h.html">SmallVector.h</a></div></div>
<div class="ttc" id="classllvm_1_1MCInstrDesc_html_a55194ec3a1e49d04eab64e993e614246"><div class="ttname"><a href="classllvm_1_1MCInstrDesc.html#a55194ec3a1e49d04eab64e993e614246">llvm::MCInstrDesc::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const </div><div class="ttdoc">Return the number of declared MachineOperands for this MachineInstruction. Note that variadic (isVari...</div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00190">MCInstrDesc.h:190</a></div></div>
<div class="ttc" id="MachineFunctionPass_8h_html"><div class="ttname"><a href="MachineFunctionPass_8h.html">MachineFunctionPass.h</a></div></div>
<div class="ttc" id="namespacellvm_html_af257c0e3adacb6cef58529b996408447"><div class="ttname"><a href="namespacellvm.html#af257c0e3adacb6cef58529b996408447">llvm::OffsetToAlignment</a></div><div class="ttdeci">uint64_t OffsetToAlignment(uint64_t Value, uint64_t Align)</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00572">MathExtras.h:572</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">llvm::A64CC::MI</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00035">AArch64BaseInfo.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_a340712de3e78fec11c338735cab17df7"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">llvm::MachineFunction::iterator</a></div><div class="ttdeci">BasicBlockListType::iterator iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00303">MachineFunction.h:303</a></div></div>
<div class="ttc" id="namespacellvm_html_a7923e3e207de8bc1d0d6a5091316ddde"><div class="ttname"><a href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a></div><div class="ttdeci">ItTy prior(ItTy it, Dist n)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00167">STLExtras.h:167</a></div></div>
<div class="ttc" id="Debug_8h_html_aef41e8aaf4c60819b30faf396cdf4978"><div class="ttname"><a href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a></div><div class="ttdeci">#define DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00097">Debug.h:97</a></div></div>
<div class="ttc" id="namespacellvm_html_af4d1a918800291e75b01ce1447be0e83"><div class="ttname"><a href="namespacellvm.html#af4d1a918800291e75b01ce1447be0e83">llvm::isPowerOf2_32</a></div><div class="ttdeci">bool isPowerOf2_32(uint32_t Value)</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00354">MathExtras.h:354</a></div></div>
<div class="ttc" id="raw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="PPCCTRLoops_8cpp_html_a593cc2f204f7b2edc16ee222c37c3196"><div class="ttname"><a href="PPCCTRLoops_8cpp.html#a593cc2f204f7b2edc16ee222c37c3196">verify</a></div><div class="ttdeci">ppc ctr loops verify</div><div class="ttdef"><b>Definition:</b> <a href="PPCCTRLoops_8cpp_source.html#l00162">PPCCTRLoops.cpp:162</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstrBuilder_html_a5125cce72b214df09ca8f93dcbbf4c3a"><div class="ttname"><a href="classllvm_1_1MachineInstrBuilder.html#a5125cce72b214df09ca8f93dcbbf4c3a">llvm::MachineInstrBuilder::addReg</a></div><div class="ttdeci">const MachineInstrBuilder &amp; addReg(unsigned RegNo, unsigned flags=0, unsigned SubReg=0) const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00064">MachineInstrBuilder.h:64</a></div></div>
<div class="ttc" id="Target_2ARM_2README_8txt_html_a90cca76dd78688687e0d697679dbc799"><div class="ttname"><a href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional ldr LCPI1_0 ldr ldr tst movne lsr ldr LCPI1_1 and r0 bx lr it saves an instruction and a register It might be profitable to cse MOVi16 if there are lots of bit immediates with the same bottom half Robert Muth started working on an alternate jump table implementation that does not put the tables in line in the text This is more like the llvm default jump table implementation This might be useful sometime Several revisions of patches are on the mailing beginning while CMP sets them like a subtract Therefore to be able to use CMN for comparisons other than the Z we ll need additional logic to reverse the conditionals associated with the comparison Perhaps a pseudo instruction for the with a post codegen pass to clean up and handle the condition codes See PR5694 for testcase Given the following on int B</div><div class="ttdef"><b>Definition:</b> <a href="Target_2ARM_2README_8txt_source.html#l00592">Target/ARM/README.txt:592</a></div></div>
<div class="ttc" id="ARMAddressingModes_8h_html"><div class="ttname"><a href="ARMAddressingModes_8h.html">ARMAddressingModes.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a3fcc360e6de146a370e8b0deecfa877f"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a3fcc360e6de146a370e8b0deecfa877f">llvm::MachineBasicBlock::addSuccessor</a></div><div class="ttdeci">void addSuccessor(MachineBasicBlock *succ, uint32_t weight=0)</div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8cpp_source.html#l00482">MachineBasicBlock.cpp:482</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_ac9786455bc217ebd35377bb5d5ec8f20"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#ac9786455bc217ebd35377bb5d5ec8f20">llvm::MachineBasicBlock::pred_size</a></div><div class="ttdeci">unsigned pred_size() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00272">MachineBasicBlock.h:272</a></div></div>
<div class="ttc" id="classllvm_1_1MachineInstr_html_a5ca4af2a257043145ad650eafb4402f9"><div class="ttname"><a href="classllvm_1_1MachineInstr.html#a5ca4af2a257043145ad650eafb4402f9">llvm::MachineInstr::getDebugLoc</a></div><div class="ttdeci">DebugLoc getDebugLoc() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineInstr_8h_source.html#l00244">MachineInstr.h:244</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBasicBlock_html_a87a4c8e9738e103f9ada8379941b6825"><div class="ttname"><a href="classllvm_1_1MachineBasicBlock.html#a87a4c8e9738e103f9ada8379941b6825">llvm::MachineBasicBlock::getAlignment</a></div><div class="ttdeci">unsigned getAlignment() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBasicBlock_8h_source.html#l00322">MachineBasicBlock.h:322</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<p class="footer">
Generated on Sat Nov 10 2018 22:58:05 for <a href="http://llvm.org/">LLVM</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.8.11</a><br>
Copyright &copy; 2003-2013 University of Illinois at Urbana-Champaign.
All Rights Reserved.</p>
<hr>
<!--#include virtual="/attrib.incl" -->
</body>
</html>
