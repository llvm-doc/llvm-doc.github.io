<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="LLVM,Low Level Virtual Machine,C++,doxygen,API,documentation"/>
<meta name="description" content="C++ source code API documentation for LLVM."/>
<title>LLVM: InstCombineShifts.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">LLVM API Documentation</p>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('InstCombineShifts_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">InstCombineShifts.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="InstCombineShifts_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- InstCombineShifts.cpp ----------------------------------------------===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                     The LLVM Compiler Infrastructure</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is distributed under the University of Illinois Open Source</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License. See LICENSE.TXT for details.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// This file implements the visitShl, visitLShr, and visitAShr functions.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstCombine_8h.html">InstCombine.h</a>&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ConstantFolding_8h.html">llvm/Analysis/ConstantFolding.h</a>&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstructionSimplify_8h.html">llvm/Analysis/InstructionSimplify.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IntrinsicInst_8h.html">llvm/IR/IntrinsicInst.h</a>&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PatternMatch_8h.html">llvm/Support/PatternMatch.h</a>&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">using namespace </span>PatternMatch;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="classllvm_1_1InstCombiner.html#ac675260ee94a66a9d8977af984f5f784">   22</a></span>&#160;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1InstCombiner.html#ac675260ee94a66a9d8977af984f5f784">InstCombiner::commonShiftTransforms</a>(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  assert(I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1)-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() == I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Op0 = I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), *Op1 = I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1);</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="comment">// See if we can fold away this shift.</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="keywordflow">if</span> (SimplifyDemandedInstructionBits(I))</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keywordflow">return</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="comment">// Try to fold constant and into select arguments.</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordflow">if</span> (isa&lt;Constant&gt;(Op0))</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *SI = dyn_cast&lt;SelectInst&gt;(Op1))</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *R = FoldOpIntoSelect(I, SI))</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="keywordflow">return</span> R;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CUI = dyn_cast&lt;ConstantInt&gt;(Op1))</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Res = FoldShiftByConstant(Op0, CUI, I))</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      <span class="keywordflow">return</span> Res;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="comment">// X shift (A srem B) -&gt; X shift (A and B-1) iff B is a power of 2.</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="comment">// Because shifts by negative values (which could occur if A were negative)</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="comment">// are undefined.</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>; <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> *<a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a>;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordflow">if</span> (Op1-&gt;hasOneUse() &amp;&amp; <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op1, <a class="code" href="namespacellvm_1_1PatternMatch.html#a42df6a41563b50a3fd1872230ed0b5ec">m_SRem</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(A), <a class="code" href="namespacellvm_1_1PatternMatch.html#ad5e60756e331a97669d11b5c9d8691a2">m_Power2</a>(B)))) {</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// FIXME: Should this get moved into SimplifyDemandedBits by saying we don&#39;t</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// demand the sign bit (and many others) here??</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Rem = Builder-&gt;CreateAnd(A, <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(I.<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), *B-1),</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                                    Op1-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>());</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    I.<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, Rem);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">return</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  }</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;}</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">/// CanEvaluateShifted - See if we can compute the specified value, but shifted</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">/// logically to the left or right by some number of bits.  This should return</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">/// true if the expression can be computed for the same cost as the current</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">/// expression tree.  This is used to eliminate extraneous shifting from things</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">/// like:</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">///      %C = shl i128 %A, 64</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">///      %D = shl i128 %B, 96</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">///      %E = or i128 %C, %D</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">///      %F = lshr i128 %E, 64</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">/// where the client will ask if E can be computed shifted right by 64-bits.  If</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">/// this succeeds, the GetShiftedValue function will be called to produce the</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">/// value.</span></div><div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="InstCombineShifts_8cpp.html#ad92bdfedd6ef2d2778081f6c43d027cb">   68</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="InstCombineShifts_8cpp.html#ad92bdfedd6ef2d2778081f6c43d027cb">CanEvaluateShifted</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keywordtype">unsigned</span> NumBits, <span class="keywordtype">bool</span> isLeftShift,</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                               <a class="code" href="classllvm_1_1InstCombiner.html">InstCombiner</a> &amp;IC) {</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="comment">// We can always evaluate constants shifted.</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">if</span> (isa&lt;Constant&gt;(V))</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(V);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordflow">if</span> (!I) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="comment">// If this is the opposite shift, we can directly reuse the input of the shift</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="comment">// if the needed bits are already zero in the input.  This allows us to reuse</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="comment">// the value which means that we don&#39;t care if the shift has multiple uses.</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="comment">//  TODO:  Handle opposite shift by exact value.</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = 0;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordflow">if</span> ((isLeftShift &amp;&amp; <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(I, <a class="code" href="namespacellvm_1_1PatternMatch.html#aa08fee11e8a5ec10c0cc2a7abbbd799a">m_LShr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a34a92072122412c6020d4afb43725bf4">m_ConstantInt</a>(CI)))) ||</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      (!isLeftShift &amp;&amp; <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(I, <a class="code" href="namespacellvm_1_1PatternMatch.html#a37668d9884c78ac77254cf9fb8a4276a">m_Shl</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(), <a class="code" href="namespacellvm_1_1PatternMatch.html#a34a92072122412c6020d4afb43725bf4">m_ConstantInt</a>(CI))))) {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>() == NumBits) {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <span class="comment">// TODO: Check that the input bits are already zero with MaskedValueIsZero</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <span class="comment">// If this is a truncate of a logical shr, we can truncate it to a smaller</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      <span class="comment">// lshr iff we know that the bits we would otherwise be shifting in are</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="comment">// already zeros.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      uint32_t OrigBitWidth = OrigTy-&gt;getScalarSizeInBits();</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      uint32_t BitWidth = Ty-&gt;getScalarSizeInBits();</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a8bc4c3e77e6f3d6c54b8b4504393dfa7">MaskedValueIsZero</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0),</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <a class="code" href="classllvm_1_1APInt.html#adcb96bd09d7c75c7669fa5f9d1190899">APInt::getHighBitsSet</a>(OrigBitWidth, OrigBitWidth-BitWidth)) &amp;&amp;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;          CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a024bb83a7f01e7661ea72ff7dcc460f5">getLimitedValue</a>(BitWidth) &lt; BitWidth) {</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="InstCombineCasts_8cpp.html#a6fd17099ed520f179e5b481db961e0e1">CanEvaluateTruncated</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), Ty);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      }</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    }</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  }</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">// We can&#39;t mutate something that has multiple uses: doing so would</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="comment">// require duplicating the instruction in general, which isn&#39;t profitable.</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordflow">if</span> (!I-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordflow">switch</span> (I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>()) {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordflow">default</span>: <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">Instruction::And</a>:</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a>:</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#afc7c4d88d09cba0c5e920f8a3a3ace55">Instruction::Xor</a>:</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// Bitwise operators can all arbitrarily be arbitrarily evaluated shifted.</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="InstCombineShifts_8cpp.html#ad92bdfedd6ef2d2778081f6c43d027cb">CanEvaluateShifted</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), NumBits, isLeftShift, IC) &amp;&amp;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;           <a class="code" href="InstCombineShifts_8cpp.html#ad92bdfedd6ef2d2778081f6c43d027cb">CanEvaluateShifted</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1), NumBits, isLeftShift, IC);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordflow">case</span> Instruction::Shl: {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// We can often fold the shift into shifts-by-a-constant.</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    CI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1));</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">if</span> (CI == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">// We can always fold shl(c1)+shl(c2) -&gt; shl(c1+c2).</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">if</span> (isLeftShift) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">// We can always turn shl(c)+shr(c) -&gt; and(c2).</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>() == NumBits) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordtype">unsigned</span> TypeWidth = I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ad979b3c1bc975ee23810e3018ffe951b">getScalarSizeInBits</a>();</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">// We can turn shl(c1)+shr(c2) -&gt; shl(c3)+and(c4), but it isn&#39;t</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">// profitable unless we know the and&#39;d out bits are already zero.</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>() &gt; NumBits) {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="keywordtype">unsigned</span> LowBits = TypeWidth - CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>();</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a8bc4c3e77e6f3d6c54b8b4504393dfa7">MaskedValueIsZero</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0),</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                       <a class="code" href="classllvm_1_1APInt.html#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(TypeWidth, NumBits) &lt;&lt; LowBits))</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  }</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordflow">case</span> Instruction::LShr: {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// We can often fold the shift into shifts-by-a-constant.</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    CI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1));</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">if</span> (CI == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">// We can always fold lshr(c1)+lshr(c2) -&gt; lshr(c1+c2).</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">if</span> (!isLeftShift) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">// We can always turn lshr(c)+shl(c) -&gt; and(c2).</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>() == NumBits) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordtype">unsigned</span> TypeWidth = I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ad979b3c1bc975ee23810e3018ffe951b">getScalarSizeInBits</a>();</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// We can always turn lshr(c1)+shl(c2) -&gt; lshr(c3)+and(c4), but it isn&#39;t</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">// profitable unless we know the and&#39;d out bits are already zero.</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a1dc5339334162e650ff87e89629bf66c">ult</a>(TypeWidth) &amp;&amp; CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>() &gt; NumBits) {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="keywordtype">unsigned</span> LowBits = CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>() - NumBits;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a8bc4c3e77e6f3d6c54b8b4504393dfa7">MaskedValueIsZero</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0),</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                          <a class="code" href="classllvm_1_1APInt.html#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(TypeWidth, NumBits) &lt;&lt; LowBits))</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba32dbd2c72a98eaee90e3ad5ef7b5af16">Instruction::Select</a>: {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *SI = cast&lt;SelectInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="InstCombineShifts_8cpp.html#ad92bdfedd6ef2d2778081f6c43d027cb">CanEvaluateShifted</a>(SI-&gt;<a class="code" href="classllvm_1_1SelectInst.html#a67bf091383cd61e1225445e78b61d9f9">getTrueValue</a>(), NumBits, isLeftShift, IC) &amp;&amp;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;           <a class="code" href="InstCombineShifts_8cpp.html#ad92bdfedd6ef2d2778081f6c43d027cb">CanEvaluateShifted</a>(SI-&gt;<a class="code" href="classllvm_1_1SelectInst.html#a29a16f32075ee4f23cd769701463952c">getFalseValue</a>(), NumBits, isLeftShift, IC);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">Instruction::PHI</a>: {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">// We can change a phi if we can change all operands.  Note that we never</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">// get into trouble with cyclic PHIs here because we only consider</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">// instructions with a single use.</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = cast&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="InstCombineShifts_8cpp.html#ad92bdfedd6ef2d2778081f6c43d027cb">CanEvaluateShifted</a>(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>), NumBits, isLeftShift,IC))</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;}</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">/// GetShiftedValue - When CanEvaluateShifted returned true for an expression,</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">/// this value inserts the new computation that produces the shifted value.</span></div><div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="InstCombineShifts_8cpp.html#a57c1400fce72467412a175ace02dda0c">  183</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="InstCombineShifts_8cpp.html#a57c1400fce72467412a175ace02dda0c">GetShiftedValue</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keywordtype">unsigned</span> NumBits, <span class="keywordtype">bool</span> isLeftShift,</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                              <a class="code" href="classllvm_1_1InstCombiner.html">InstCombiner</a> &amp;IC) {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="comment">// We can always evaluate constants shifted.</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;Constant&gt;(V)) {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordflow">if</span> (isLeftShift)</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      V = IC.<a class="code" href="classllvm_1_1InstCombiner.html#a6e33228c0d5bb3b72f357677fa105185">Builder</a>-&gt;<a class="code" href="classllvm_1_1IRBuilder.html#a4d49fd9a4cc4f2a74d4555bd08b13910">CreateShl</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>, NumBits);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      V = IC.<a class="code" href="classllvm_1_1InstCombiner.html#a6e33228c0d5bb3b72f357677fa105185">Builder</a>-&gt;<a class="code" href="classllvm_1_1IRBuilder.html#a3f8c45ea10c393433221a508b750dcd5">CreateLShr</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>, NumBits);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// If we got a constantexpr back, try to simplify it with TD info.</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(V))</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      V = <a class="code" href="namespacellvm.html#a8891be7c27326c20a6dba7d98e9030b5">ConstantFoldConstantExpression</a>(CE, IC.<a class="code" href="classllvm_1_1InstCombiner.html#a5acf2a841db50684c87133f36bdd00a1">getDataLayout</a>(),</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                                         IC.<a class="code" href="classllvm_1_1InstCombiner.html#af85cbc14ad0720c50edafb0072acef9b">getTargetLibraryInfo</a>());</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">return</span> V;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  }</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = cast&lt;Instruction&gt;(V);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  IC.<a class="code" href="classllvm_1_1InstCombiner.html#aaca490f77b8a0ca6b013db8c0de18972">Worklist</a>.<a class="code" href="classllvm_1_1InstCombineWorklist.html#a371049452a97755a1b39dea46017439a">Add</a>(I);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <span class="keywordflow">switch</span> (I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>()) {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keywordflow">default</span>: <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Inconsistency with CanEvaluateShifted&quot;</span>);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">Instruction::And</a>:</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a>:</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#afc7c4d88d09cba0c5e920f8a3a3ace55">Instruction::Xor</a>:</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">// Bitwise operators can all arbitrarily be arbitrarily evaluated shifted.</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    I-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, <a class="code" href="InstCombineShifts_8cpp.html#a57c1400fce72467412a175ace02dda0c">GetShiftedValue</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), NumBits,isLeftShift,IC));</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    I-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, <a class="code" href="InstCombineShifts_8cpp.html#a57c1400fce72467412a175ace02dda0c">GetShiftedValue</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1), NumBits,isLeftShift,IC));</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keywordflow">case</span> Instruction::Shl: {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO = cast&lt;BinaryOperator&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordtype">unsigned</span> TypeWidth = BO-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ad979b3c1bc975ee23810e3018ffe951b">getScalarSizeInBits</a>();</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">// We only accept shifts-by-a-constant in CanEvaluateShifted.</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = cast&lt;ConstantInt&gt;(BO-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1));</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// We can always fold shl(c1)+shl(c2) -&gt; shl(c1+c2).</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">if</span> (isLeftShift) {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="comment">// If this is oversized composite shift, then unsigned shifts get 0.</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <span class="keywordtype">unsigned</span> NewShAmt = NumBits+CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>();</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <span class="keywordflow">if</span> (NewShAmt &gt;= TypeWidth)</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      BO-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(BO-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), NewShAmt));</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      BO-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#aaa9083a85e23c9c5ee366920d90ae51e">setHasNoUnsignedWrap</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      BO-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a21ce697328893029ae2c63974061a294">setHasNoSignedWrap</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// We turn shl(c)+lshr(c) -&gt; and(c2) if the input doesn&#39;t already have</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// zeros.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>() == NumBits) {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <a class="code" href="classllvm_1_1APInt.html">APInt</a> Mask(<a class="code" href="classllvm_1_1APInt.html#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(TypeWidth, TypeWidth - NumBits));</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      V = IC.<a class="code" href="classllvm_1_1InstCombiner.html#a6e33228c0d5bb3b72f357677fa105185">Builder</a>-&gt;<a class="code" href="classllvm_1_1IRBuilder.html#a197d5dd77cad4560a082900962a830aa">CreateAnd</a>(BO-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0),</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                                <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(BO-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), Mask));</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *VI = dyn_cast&lt;Instruction&gt;(V)) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        VI-&gt;moveBefore(BO);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        VI-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(BO);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <span class="keywordflow">return</span> V;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">// We turn shl(c1)+shr(c2) -&gt; shl(c3)+and(c4), but only when we know that</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">// the and won&#39;t be needed.</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    assert(CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>() &gt; NumBits);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    BO-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(BO-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(),</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                                       CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>() - NumBits));</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    BO-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#aaa9083a85e23c9c5ee366920d90ae51e">setHasNoUnsignedWrap</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    BO-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a21ce697328893029ae2c63974061a294">setHasNoSignedWrap</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">return</span> BO;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  }</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordflow">case</span> Instruction::LShr: {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO = cast&lt;BinaryOperator&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordtype">unsigned</span> TypeWidth = BO-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ad979b3c1bc975ee23810e3018ffe951b">getScalarSizeInBits</a>();</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment">// We only accept shifts-by-a-constant in CanEvaluateShifted.</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = cast&lt;ConstantInt&gt;(BO-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1));</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">// We can always fold lshr(c1)+lshr(c2) -&gt; lshr(c1+c2).</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">if</span> (!isLeftShift) {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="comment">// If this is oversized composite shift, then unsigned shifts get 0.</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keywordtype">unsigned</span> NewShAmt = NumBits+CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>();</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keywordflow">if</span> (NewShAmt &gt;= TypeWidth)</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(BO-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      BO-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(BO-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), NewShAmt));</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      BO-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#aac502d7d65e2996cf6b819b14e17499c">setIsExact</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// We turn lshr(c)+shl(c) -&gt; and(c2) if the input doesn&#39;t already have</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">// zeros.</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>() == NumBits) {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <a class="code" href="classllvm_1_1APInt.html">APInt</a> Mask(<a class="code" href="classllvm_1_1APInt.html#adcb96bd09d7c75c7669fa5f9d1190899">APInt::getHighBitsSet</a>(TypeWidth, TypeWidth - NumBits));</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      V = IC.<a class="code" href="classllvm_1_1InstCombiner.html#a6e33228c0d5bb3b72f357677fa105185">Builder</a>-&gt;<a class="code" href="classllvm_1_1IRBuilder.html#a197d5dd77cad4560a082900962a830aa">CreateAnd</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0),</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                                <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(BO-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), Mask));</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *VI = dyn_cast&lt;Instruction&gt;(V)) {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        VI-&gt;moveBefore(I);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        VI-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(I);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      }</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordflow">return</span> V;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    }</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// We turn lshr(c1)+shl(c2) -&gt; lshr(c3)+and(c4), but only when we know that</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="comment">// the and won&#39;t be needed.</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    assert(CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>() &gt; NumBits);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    BO-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(BO-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(),</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                                       CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>() - NumBits));</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    BO-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#aac502d7d65e2996cf6b819b14e17499c">setIsExact</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">return</span> BO;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba32dbd2c72a98eaee90e3ad5ef7b5af16">Instruction::Select</a>:</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    I-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, <a class="code" href="InstCombineShifts_8cpp.html#a57c1400fce72467412a175ace02dda0c">GetShiftedValue</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1), NumBits,isLeftShift,IC));</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    I-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(2, <a class="code" href="InstCombineShifts_8cpp.html#a57c1400fce72467412a175ace02dda0c">GetShiftedValue</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(2), NumBits,isLeftShift,IC));</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">Instruction::PHI</a>: {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">// We can change a phi if we can change all operands.  Note that we never</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// get into trouble with cyclic PHIs here because we only consider</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">// instructions with a single use.</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = cast&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="InstCombineShifts_8cpp.html#a57c1400fce72467412a175ace02dda0c">GetShiftedValue</a>(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>),</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                                              NumBits, isLeftShift, IC));</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">return</span> PN;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  }</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  }</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;}</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno"><a class="line" href="classllvm_1_1InstCombiner.html#a464c7ef1f4e5a7e2c612d2f9362a16b5">  312</a></span>&#160;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1InstCombiner.html#a464c7ef1f4e5a7e2c612d2f9362a16b5">InstCombiner::FoldShiftByConstant</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *Op0, <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Op1,</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                                               <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordtype">bool</span> isLeftShift = I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() == Instruction::Shl;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="comment">// See if we can propagate this shift into the input, this covers the trivial</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="comment">// cast of lshr(shl(x,c1),c2) as well as other more complex cases.</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordflow">if</span> (I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() != Instruction::AShr &amp;&amp;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <a class="code" href="InstCombineShifts_8cpp.html#ad92bdfedd6ef2d2778081f6c43d027cb">CanEvaluateShifted</a>(Op0, Op1-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>(), isLeftShift, *<span class="keyword">this</span>)) {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;ICE: GetShiftedValue propagating shift through expression&quot;</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;              <span class="stringliteral">&quot; to eliminate shift:\n  IN: &quot;</span> &lt;&lt; *Op0 &lt;&lt; <span class="stringliteral">&quot;\n  SH: &quot;</span> &lt;&lt; I &lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordflow">return</span> ReplaceInstUsesWith(I,</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                 <a class="code" href="InstCombineShifts_8cpp.html#a57c1400fce72467412a175ace02dda0c">GetShiftedValue</a>(Op0, Op1-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>(), isLeftShift, *<span class="keyword">this</span>));</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  }</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="comment">// See if we can simplify any instructions used by the instruction whose sole</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="comment">// purpose is to compute bits we don&#39;t care about.</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  uint32_t TypeBits = Op0-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ad979b3c1bc975ee23810e3018ffe951b">getScalarSizeInBits</a>();</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="comment">// shl i32 X, 32 = 0 and srl i8 Y, 9 = 0, ... just don&#39;t eliminate</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="comment">// a signed shift.</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordflow">if</span> (Op1-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a90982bca61da940a80629040c075e33e">uge</a>(TypeBits)) {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">if</span> (I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() != Instruction::AShr)</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="keywordflow">return</span> ReplaceInstUsesWith(I, <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Op0-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()));</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="comment">// ashr i32 X, 32 --&gt; ashr i32 X, 31</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    I.<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(I.<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), TypeBits-1));</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">return</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="comment">// ((X*C1) &lt;&lt; C2) == (X * (C1 &lt;&lt; C2))</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO = dyn_cast&lt;BinaryOperator&gt;(Op0))</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">if</span> (BO-&gt;getOpcode() == Instruction::Mul &amp;&amp; isLeftShift)</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *BOOp = dyn_cast&lt;Constant&gt;(BO-&gt;getOperand(1)))</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="keywordflow">return</span> BinaryOperator::CreateMul(BO-&gt;getOperand(0),</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                                        <a class="code" href="classllvm_1_1ConstantExpr.html#aa5ad9e9e7cc67e1675d8d1631a73e625">ConstantExpr::getShl</a>(BOOp, Op1));</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="comment">// Try to fold constant and into select arguments.</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *SI = dyn_cast&lt;SelectInst&gt;(Op0))</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *R = FoldOpIntoSelect(I, SI))</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="keywordflow">return</span> R;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(Op0))</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8">NV</a> = FoldOpIntoPhi(I))</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8">NV</a>;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="comment">// Fold shift2(trunc(shift1(x,c1)), c2) -&gt; trunc(shift2(shift1(x,c1),c2))</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1TruncInst.html">TruncInst</a> *TI = dyn_cast&lt;TruncInst&gt;(Op0)) {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TrOp = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(TI-&gt;getOperand(0));</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="comment">// If &#39;shift2&#39; is an ashr, we would have to get the sign bit into a funny</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">// place.  Don&#39;t try to do this transformation in this case.  Also, we</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">// require that the input operand is a shift-by-constant so that we have</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">// confidence that the shifts will get folded together.  We could do this</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="comment">// xform in more cases, but it is unlikely to be profitable.</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">if</span> (TrOp &amp;&amp; I.<a class="code" href="classllvm_1_1Instruction.html#ad933e66b8bbd406e84d1dbbf094d4cde">isLogicalShift</a>() &amp;&amp; TrOp-&gt;<a class="code" href="classllvm_1_1Instruction.html#a407ab30fb284068600e0cba2677640c2">isShift</a>() &amp;&amp;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        isa&lt;ConstantInt&gt;(TrOp-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1))) {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="comment">// Okay, we&#39;ll do this xform.  Make the shift of shift.</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *ShAmt = <a class="code" href="classllvm_1_1ConstantExpr.html#a80e82791d4d7f4d1d23d68ca0a2b1f64">ConstantExpr::getZExt</a>(Op1, TrOp-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="comment">// (shift2 (shift1 &amp; 0x00FF), c2)</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *NSh = Builder-&gt;CreateBinOp(I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>(), TrOp, ShAmt,I.<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>());</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="comment">// For logical shifts, the truncation has the effect of making the high</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="comment">// part of the register be zeros.  Emulate this by inserting an AND to</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="comment">// clear the top bits as needed.  This &#39;and&#39; will usually be zapped by</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="comment">// other xforms later if dead.</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="keywordtype">unsigned</span> SrcSize = TrOp-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ad979b3c1bc975ee23810e3018ffe951b">getScalarSizeInBits</a>();</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="keywordtype">unsigned</span> DstSize = TI-&gt;getType()-&gt;getScalarSizeInBits();</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <a class="code" href="classllvm_1_1APInt.html">APInt</a> MaskV(<a class="code" href="classllvm_1_1APInt.html#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(SrcSize, DstSize));</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="comment">// The mask we constructed says what the trunc would do if occurring</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <span class="comment">// between the shifts.  We want to know the effect *after* the second</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <span class="comment">// shift.  We know that it is a logical shift by a constant, so adjust the</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="comment">// mask as appropriate.</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="keywordflow">if</span> (I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() == Instruction::Shl)</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        MaskV &lt;&lt;= Op1-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>();</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        assert(I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() == Instruction::LShr &amp;&amp; <span class="stringliteral">&quot;Unknown logical shift&quot;</span>);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        MaskV = MaskV.<a class="code" href="classllvm_1_1APInt.html#aa1953b3ad7ef6aa87dc0205db0c2ea45">lshr</a>(Op1-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>());</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <span class="comment">// shift1 &amp; 0x00FF</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">And</a> = Builder-&gt;CreateAnd(NSh,</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                                      <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(I.<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), MaskV),</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                                      TI-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>());</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="comment">// Return the value truncated to the interesting size.</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1TruncInst.html">TruncInst</a>(And, I.<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    }</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  }</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordflow">if</span> (Op0-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>()) {</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *Op0BO = dyn_cast&lt;BinaryOperator&gt;(Op0)) {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="comment">// Turn ((X &gt;&gt; C) + Y) &lt;&lt; C  -&gt;  (X + (Y &lt;&lt; C)) &amp; (~0 &lt;&lt; C)</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V1, *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a>;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="Target_2PowerPC_2README_8txt.html#afc7ca55ad1da67847ecd4b99ef64dc84">CC</a>;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <span class="keywordflow">switch</span> (Op0BO-&gt;getOpcode()) {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <span class="keywordflow">case</span> Instruction::Add:</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">Instruction::And</a>:</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a>:</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#afc7c4d88d09cba0c5e920f8a3a3ace55">Instruction::Xor</a>: {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="comment">// These operators commute.</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="comment">// Turn (Y + (X &gt;&gt; C)) &lt;&lt; C  -&gt;  (X + (Y &lt;&lt; C)) &amp; (~0 &lt;&lt; C)</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="keywordflow">if</span> (isLeftShift &amp;&amp; Op0BO-&gt;getOperand(1)-&gt;hasOneUse() &amp;&amp;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0BO-&gt;getOperand(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#a8429e9826885bbef0cfb350bbc49f5db">m_Shr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V1),</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                  <a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(Op1)))) {</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *YS =         <span class="comment">// (Y &lt;&lt; C)</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            Builder-&gt;CreateShl(Op0BO-&gt;getOperand(0), Op1, Op0BO-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>());</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;          <span class="comment">// (X + (Y &lt;&lt; C))</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm.html#a6569d00d31a5d74e563e2f39f82271ab">X</a> = Builder-&gt;CreateBinOp(Op0BO-&gt;getOpcode(), YS, V1,</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                                          Op0BO-&gt;getOperand(1)-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>());</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;          uint32_t Op1Val = Op1-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a024bb83a7f01e7661ea72ff7dcc460f5">getLimitedValue</a>(TypeBits);</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;          <span class="keywordflow">return</span> BinaryOperator::CreateAnd(X, <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(I.<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(),</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                     <a class="code" href="classllvm_1_1APInt.html#adcb96bd09d7c75c7669fa5f9d1190899">APInt::getHighBitsSet</a>(TypeBits, TypeBits-Op1Val)));</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        }</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="comment">// Turn (Y + ((X &gt;&gt; C) &amp; CC)) &lt;&lt; C  -&gt;  ((X &amp; (CC &lt;&lt; C)) + (Y &lt;&lt; C))</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Op0BOOp1 = Op0BO-&gt;getOperand(1);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="keywordflow">if</span> (isLeftShift &amp;&amp; Op0BOOp1-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>() &amp;&amp;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0BOOp1,</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                  <a class="code" href="namespacellvm_1_1PatternMatch.html#a427435d4da769ae680a8e77ef89520aa">m_And</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a8429e9826885bbef0cfb350bbc49f5db">m_Shr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V1), <a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(Op1))),</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                        <a class="code" href="namespacellvm_1_1PatternMatch.html#a34a92072122412c6020d4afb43725bf4">m_ConstantInt</a>(CC)))) {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *YS =   <span class="comment">// (Y &lt;&lt; C)</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            Builder-&gt;CreateShl(Op0BO-&gt;getOperand(0), Op1,</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                                         Op0BO-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>());</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;          <span class="comment">// X &amp; (CC &lt;&lt; C)</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *XM = Builder-&gt;CreateAnd(V1, <a class="code" href="classllvm_1_1ConstantExpr.html#aa5ad9e9e7cc67e1675d8d1631a73e625">ConstantExpr::getShl</a>(CC, Op1),</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                                         V1-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.mask&quot;</span>);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1BinaryOperator.html#a4a4628e91a9c6a339fa61105614fac76">BinaryOperator::Create</a>(Op0BO-&gt;getOpcode(), YS, XM);</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        }</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      }</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <span class="comment">// FALL THROUGH.</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <span class="keywordflow">case</span> Instruction::Sub: {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="comment">// Turn ((X &gt;&gt; C) + Y) &lt;&lt; C  -&gt;  (X + (Y &lt;&lt; C)) &amp; (~0 &lt;&lt; C)</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordflow">if</span> (isLeftShift &amp;&amp; Op0BO-&gt;getOperand(0)-&gt;hasOneUse() &amp;&amp;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0BO-&gt;getOperand(0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a8429e9826885bbef0cfb350bbc49f5db">m_Shr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V1),</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                  <a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(Op1)))) {</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *YS =  <span class="comment">// (Y &lt;&lt; C)</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            Builder-&gt;CreateShl(Op0BO-&gt;getOperand(1), Op1, Op0BO-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>());</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;          <span class="comment">// (X + (Y &lt;&lt; C))</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm.html#a6569d00d31a5d74e563e2f39f82271ab">X</a> = Builder-&gt;CreateBinOp(Op0BO-&gt;getOpcode(), V1, YS,</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                                          Op0BO-&gt;getOperand(0)-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>());</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;          uint32_t Op1Val = Op1-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a024bb83a7f01e7661ea72ff7dcc460f5">getLimitedValue</a>(TypeBits);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;          <span class="keywordflow">return</span> BinaryOperator::CreateAnd(X, <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(I.<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(),</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                     <a class="code" href="classllvm_1_1APInt.html#adcb96bd09d7c75c7669fa5f9d1190899">APInt::getHighBitsSet</a>(TypeBits, TypeBits-Op1Val)));</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        }</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="comment">// Turn (((X &gt;&gt; C)&amp;CC) + Y) &lt;&lt; C  -&gt;  (X + (Y &lt;&lt; C)) &amp; (CC &lt;&lt; C)</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordflow">if</span> (isLeftShift &amp;&amp; Op0BO-&gt;getOperand(0)-&gt;hasOneUse() &amp;&amp;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0BO-&gt;getOperand(0),</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                  <a class="code" href="namespacellvm_1_1PatternMatch.html#a427435d4da769ae680a8e77ef89520aa">m_And</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a8429e9826885bbef0cfb350bbc49f5db">m_Shr</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V1), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(V2))),</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                        <a class="code" href="namespacellvm_1_1PatternMatch.html#a34a92072122412c6020d4afb43725bf4">m_ConstantInt</a>(CC))) &amp;&amp; V2 == Op1) {</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *YS = <span class="comment">// (Y &lt;&lt; C)</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            Builder-&gt;CreateShl(Op0BO-&gt;getOperand(1), Op1, Op0BO-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>());</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;          <span class="comment">// X &amp; (CC &lt;&lt; C)</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *XM = Builder-&gt;CreateAnd(V1, <a class="code" href="classllvm_1_1ConstantExpr.html#aa5ad9e9e7cc67e1675d8d1631a73e625">ConstantExpr::getShl</a>(CC, Op1),</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                                         V1-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.mask&quot;</span>);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1BinaryOperator.html#a4a4628e91a9c6a339fa61105614fac76">BinaryOperator::Create</a>(Op0BO-&gt;getOpcode(), XM, YS);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      }</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      }</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="comment">// If the operand is an bitwise operator with a constant RHS, and the</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <span class="comment">// shift is the only use, we can pull it out of the shift.</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Op0C = dyn_cast&lt;ConstantInt&gt;(Op0BO-&gt;getOperand(1))) {</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordtype">bool</span> isValid = <span class="keyword">true</span>;     <span class="comment">// Valid only for And, Or, Xor</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="keywordtype">bool</span> highBitSet = <span class="keyword">false</span>; <span class="comment">// Transform if high bit of constant set?</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <span class="keywordflow">switch</span> (Op0BO-&gt;getOpcode()) {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="keywordflow">default</span>: isValid = <span class="keyword">false</span>; <span class="keywordflow">break</span>;   <span class="comment">// Do not perform transform!</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <span class="keywordflow">case</span> Instruction::Add:</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;          isValid = isLeftShift;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a>:</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#afc7c4d88d09cba0c5e920f8a3a3ace55">Instruction::Xor</a>:</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;          highBitSet = <span class="keyword">false</span>;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">Instruction::And</a>:</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;          highBitSet = <span class="keyword">true</span>;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        }</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="comment">// If this is a signed shift right, and the high bit is modified</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="comment">// by the logical operation, do not perform the transformation.</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="comment">// The highBitSet boolean indicates the value of the high bit of</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="comment">// the constant which would cause it to be modified for this</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="comment">// operation.</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="keywordflow">if</span> (isValid &amp;&amp; I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() == Instruction::AShr)</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;          isValid = Op0C-&gt;getValue()[TypeBits-1] == highBitSet;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordflow">if</span> (isValid) {</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;          <a class="code" href="classllvm_1_1Constant.html">Constant</a> *NewRHS = <a class="code" href="classllvm_1_1ConstantExpr.html#afd44535c4ae204571d5721fa4a7042f2">ConstantExpr::get</a>(I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>(), Op0C, Op1);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *NewShift =</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            Builder-&gt;CreateBinOp(I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>(), Op0BO-&gt;getOperand(0), Op1);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;          NewShift-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(Op0BO);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1BinaryOperator.html#a4a4628e91a9c6a339fa61105614fac76">BinaryOperator::Create</a>(Op0BO-&gt;getOpcode(), NewShift,</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                                        NewRHS);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    }</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  }</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="comment">// Find out if this is a shift of a shift by a constant.</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *ShiftOp = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a>&gt;(Op0);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordflow">if</span> (ShiftOp &amp;&amp; !ShiftOp-&gt;isShift())</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    ShiftOp = 0;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keywordflow">if</span> (ShiftOp &amp;&amp; isa&lt;ConstantInt&gt;(ShiftOp-&gt;getOperand(1))) {</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="comment">// This is a constant shift of a constant shift. Be careful about hiding</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="comment">// shl instructions behind bit masks. They are used to represent multiplies</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="comment">// by a constant, and it is important that simple arithmetic expressions</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="comment">// are still recognizable by scalar evolution.</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="comment">// The transforms applied to shl are very similar to the transforms applied</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="comment">// to mul by constant. We can be more aggressive about optimizing right</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="comment">// shifts.</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="comment">// Combinations of right and left shifts will still be optimized in</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="comment">// DAGCombine where scalar evolution no longer applies.</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *ShiftAmt1C = cast&lt;ConstantInt&gt;(ShiftOp-&gt;getOperand(1));</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    uint32_t ShiftAmt1 = ShiftAmt1C-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a024bb83a7f01e7661ea72ff7dcc460f5">getLimitedValue</a>(TypeBits);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    uint32_t ShiftAmt2 = Op1-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a024bb83a7f01e7661ea72ff7dcc460f5">getLimitedValue</a>(TypeBits);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    assert(ShiftAmt2 != 0 &amp;&amp; <span class="stringliteral">&quot;Should have been simplified earlier&quot;</span>);</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordflow">if</span> (ShiftAmt1 == 0) <span class="keywordflow">return</span> 0;  <span class="comment">// Will be simplified in the future.</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm.html#a6569d00d31a5d74e563e2f39f82271ab">X</a> = ShiftOp-&gt;getOperand(0);</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *Ty = cast&lt;IntegerType&gt;(I.<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="comment">// Check for (X &lt;&lt; c1) &lt;&lt; c2  and  (X &gt;&gt; c1) &gt;&gt; c2</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">if</span> (I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() == ShiftOp-&gt;getOpcode()) {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      uint32_t AmtSum = ShiftAmt1+ShiftAmt2;   <span class="comment">// Fold into one big shift.</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="comment">// If this is oversized composite shift, then unsigned shifts get 0, ashr</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="comment">// saturates.</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="keywordflow">if</span> (AmtSum &gt;= TypeBits) {</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keywordflow">if</span> (I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() != Instruction::AShr)</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;          <span class="keywordflow">return</span> ReplaceInstUsesWith(I, <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(I.<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()));</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        AmtSum = TypeBits-1;  <span class="comment">// Saturate to 31 for i32 ashr.</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      }</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1BinaryOperator.html#a4a4628e91a9c6a339fa61105614fac76">BinaryOperator::Create</a>(I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>(), <a class="code" href="namespacellvm.html#a6569d00d31a5d74e563e2f39f82271ab">X</a>,</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                                    <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(Ty, AmtSum));</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    }</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">if</span> (ShiftAmt1 == ShiftAmt2) {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="comment">// If we have ((X &lt;&lt; C) &gt;&gt;u C), turn this into X &amp; (-1 &gt;&gt;u C).</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="keywordflow">if</span> (I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() == Instruction::LShr &amp;&amp;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;          ShiftOp-&gt;getOpcode() == Instruction::Shl) {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <a class="code" href="classllvm_1_1APInt.html">APInt</a> Mask(<a class="code" href="classllvm_1_1APInt.html#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(TypeBits, TypeBits - ShiftAmt1));</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="keywordflow">return</span> BinaryOperator::CreateAnd(X,</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                                        <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(I.<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), Mask));</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      }</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ShiftAmt1 &lt; ShiftAmt2) {</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      uint32_t ShiftDiff = ShiftAmt2-ShiftAmt1;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <span class="comment">// (X &gt;&gt;?,exact C1) &lt;&lt; C2 --&gt; X &lt;&lt; (C2-C1)</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <span class="comment">// The inexact version is deferred to DAGCombine so we don&#39;t hide shl</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="comment">// behind a bit mask.</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordflow">if</span> (I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() == Instruction::Shl &amp;&amp;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;          ShiftOp-&gt;getOpcode() != Instruction::Shl &amp;&amp;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;          ShiftOp-&gt;isExact()) {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        assert(ShiftOp-&gt;getOpcode() == Instruction::LShr ||</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;               ShiftOp-&gt;getOpcode() == Instruction::AShr);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *ShiftDiffCst = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(Ty, ShiftDiff);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *NewShl = <a class="code" href="classllvm_1_1BinaryOperator.html#a4a4628e91a9c6a339fa61105614fac76">BinaryOperator::Create</a>(Instruction::Shl,</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                                                        X, ShiftDiffCst);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        NewShl-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#aaa9083a85e23c9c5ee366920d90ae51e">setHasNoUnsignedWrap</a>(I.<a class="code" href="classllvm_1_1BinaryOperator.html#a5b6cd6c043f54b40899aff62e6e40488">hasNoUnsignedWrap</a>());</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        NewShl-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a21ce697328893029ae2c63974061a294">setHasNoSignedWrap</a>(I.<a class="code" href="classllvm_1_1BinaryOperator.html#a07783e6f39803037259a1ebe376c2b1e">hasNoSignedWrap</a>());</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <span class="keywordflow">return</span> NewShl;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      }</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="comment">// (X &lt;&lt; C1) &gt;&gt;u C2  --&gt; X &gt;&gt;u (C2-C1) &amp; (-1 &gt;&gt; C2)</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <span class="keywordflow">if</span> (I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() == Instruction::LShr &amp;&amp;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;          ShiftOp-&gt;getOpcode() == Instruction::Shl) {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *ShiftDiffCst = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(Ty, ShiftDiff);</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="comment">// (X &lt;&lt;nuw C1) &gt;&gt;u C2 --&gt; X &gt;&gt;u (C2-C1)</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordflow">if</span> (ShiftOp-&gt;hasNoUnsignedWrap()) {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;          <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *NewLShr = <a class="code" href="classllvm_1_1BinaryOperator.html#a4a4628e91a9c6a339fa61105614fac76">BinaryOperator::Create</a>(Instruction::LShr,</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                                                           X, ShiftDiffCst);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;          NewLShr-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#aac502d7d65e2996cf6b819b14e17499c">setIsExact</a>(I.<a class="code" href="classllvm_1_1BinaryOperator.html#a0f67e7208255f5088f0d515185109174">isExact</a>());</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;          <span class="keywordflow">return</span> NewLShr;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        }</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a> = Builder-&gt;CreateLShr(X, ShiftDiffCst);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <a class="code" href="classllvm_1_1APInt.html">APInt</a> Mask(<a class="code" href="classllvm_1_1APInt.html#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(TypeBits, TypeBits - ShiftAmt2));</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <span class="keywordflow">return</span> BinaryOperator::CreateAnd(Shift,</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                                         <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(I.<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(),Mask));</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      }</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="comment">// We can&#39;t handle (X &lt;&lt; C1) &gt;&gt;s C2, it shifts arbitrary bits in. However,</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="comment">// we can handle (X &lt;&lt;nsw C1) &gt;&gt;s C2 since it only shifts in sign bits.</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="keywordflow">if</span> (I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() == Instruction::AShr &amp;&amp;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;          ShiftOp-&gt;getOpcode() == Instruction::Shl) {</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">if</span> (ShiftOp-&gt;hasNoSignedWrap()) {</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;          <span class="comment">// (X &lt;&lt;nsw C1) &gt;&gt;s C2 --&gt; X &gt;&gt;s (C2-C1)</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;          <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *ShiftDiffCst = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(Ty, ShiftDiff);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;          <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *NewAShr = <a class="code" href="classllvm_1_1BinaryOperator.html#a4a4628e91a9c6a339fa61105614fac76">BinaryOperator::Create</a>(Instruction::AShr,</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                                                           X, ShiftDiffCst);</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;          NewAShr-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#aac502d7d65e2996cf6b819b14e17499c">setIsExact</a>(I.<a class="code" href="classllvm_1_1BinaryOperator.html#a0f67e7208255f5088f0d515185109174">isExact</a>());</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;          <span class="keywordflow">return</span> NewAShr;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        }</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      }</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      assert(ShiftAmt2 &lt; ShiftAmt1);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      uint32_t ShiftDiff = ShiftAmt1-ShiftAmt2;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      <span class="comment">// (X &gt;&gt;?exact C1) &lt;&lt; C2 --&gt; X &gt;&gt;?exact (C1-C2)</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <span class="comment">// The inexact version is deferred to DAGCombine so we don&#39;t hide shl</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="comment">// behind a bit mask.</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      <span class="keywordflow">if</span> (I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() == Instruction::Shl &amp;&amp;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;          ShiftOp-&gt;getOpcode() != Instruction::Shl &amp;&amp;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;          ShiftOp-&gt;isExact()) {</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *ShiftDiffCst = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(Ty, ShiftDiff);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *NewShr = <a class="code" href="classllvm_1_1BinaryOperator.html#a4a4628e91a9c6a339fa61105614fac76">BinaryOperator::Create</a>(ShiftOp-&gt;getOpcode(),</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                                                        <a class="code" href="namespacellvm.html#a6569d00d31a5d74e563e2f39f82271ab">X</a>, ShiftDiffCst);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        NewShr-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#aac502d7d65e2996cf6b819b14e17499c">setIsExact</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="keywordflow">return</span> NewShr;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="comment">// (X &lt;&lt; C1) &gt;&gt;u C2  --&gt; X &lt;&lt; (C1-C2) &amp; (-1 &gt;&gt; C2)</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="keywordflow">if</span> (I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() == Instruction::LShr &amp;&amp;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;          ShiftOp-&gt;getOpcode() == Instruction::Shl) {</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *ShiftDiffCst = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(Ty, ShiftDiff);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="keywordflow">if</span> (ShiftOp-&gt;hasNoUnsignedWrap()) {</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;          <span class="comment">// (X &lt;&lt;nuw C1) &gt;&gt;u C2 --&gt; X &lt;&lt;nuw (C1-C2)</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;          <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *NewShl = <a class="code" href="classllvm_1_1BinaryOperator.html#a4a4628e91a9c6a339fa61105614fac76">BinaryOperator::Create</a>(Instruction::Shl,</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                                                          X, ShiftDiffCst);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;          NewShl-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#aaa9083a85e23c9c5ee366920d90ae51e">setHasNoUnsignedWrap</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;          <span class="keywordflow">return</span> NewShl;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        }</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a> = Builder-&gt;CreateShl(X, ShiftDiffCst);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <a class="code" href="classllvm_1_1APInt.html">APInt</a> Mask(<a class="code" href="classllvm_1_1APInt.html#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(TypeBits, TypeBits - ShiftAmt2));</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="keywordflow">return</span> BinaryOperator::CreateAnd(Shift,</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                                         <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(I.<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(),Mask));</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      }</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="comment">// We can&#39;t handle (X &lt;&lt; C1) &gt;&gt;s C2, it shifts arbitrary bits in. However,</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      <span class="comment">// we can handle (X &lt;&lt;nsw C1) &gt;&gt;s C2 since it only shifts in sign bits.</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="keywordflow">if</span> (I.<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() == Instruction::AShr &amp;&amp;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;          ShiftOp-&gt;getOpcode() == Instruction::Shl) {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordflow">if</span> (ShiftOp-&gt;hasNoSignedWrap()) {</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;          <span class="comment">// (X &lt;&lt;nsw C1) &gt;&gt;s C2 --&gt; X &lt;&lt;nsw (C1-C2)</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;          <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *ShiftDiffCst = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(Ty, ShiftDiff);</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;          <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *NewShl = <a class="code" href="classllvm_1_1BinaryOperator.html#a4a4628e91a9c6a339fa61105614fac76">BinaryOperator::Create</a>(Instruction::Shl,</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                                                          X, ShiftDiffCst);</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;          NewShl-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a21ce697328893029ae2c63974061a294">setHasNoSignedWrap</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;          <span class="keywordflow">return</span> NewShl;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      }</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    }</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  }</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;}</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno"><a class="line" href="classllvm_1_1InstCombiner.html#a6610d4e76df291a24c3408877da848a7">  677</a></span>&#160;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1InstCombiner.html#a6610d4e76df291a24c3408877da848a7">InstCombiner::visitShl</a>(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#a2ec75001a2ff23312dba513b2f2bd044">SimplifyShlInst</a>(I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1),</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                                 I.<a class="code" href="classllvm_1_1BinaryOperator.html#a07783e6f39803037259a1ebe376c2b1e">hasNoSignedWrap</a>(), I.<a class="code" href="classllvm_1_1BinaryOperator.html#a5b6cd6c043f54b40899aff62e6e40488">hasNoUnsignedWrap</a>(),</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                                 TD))</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="keywordflow">return</span> ReplaceInstUsesWith(I, V);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *V = commonShiftTransforms(I))</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">return</span> V;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Op1C = dyn_cast&lt;ConstantInt&gt;(I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1))) {</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordtype">unsigned</span> ShAmt = Op1C-&gt;getZExtValue();</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">// If the shifted-out value is known-zero, then this is a NUW shift.</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keywordflow">if</span> (!I.<a class="code" href="classllvm_1_1BinaryOperator.html#a5b6cd6c043f54b40899aff62e6e40488">hasNoUnsignedWrap</a>() &amp;&amp;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <a class="code" href="namespacellvm.html#a8bc4c3e77e6f3d6c54b8b4504393dfa7">MaskedValueIsZero</a>(I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0),</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                          <a class="code" href="classllvm_1_1APInt.html#adcb96bd09d7c75c7669fa5f9d1190899">APInt::getHighBitsSet</a>(Op1C-&gt;getBitWidth(), ShAmt))) {</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;          I.<a class="code" href="classllvm_1_1BinaryOperator.html#aaa9083a85e23c9c5ee366920d90ae51e">setHasNoUnsignedWrap</a>();</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;          <span class="keywordflow">return</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        }</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="comment">// If the shifted out value is all signbits, this is a NSW shift.</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordflow">if</span> (!I.<a class="code" href="classllvm_1_1BinaryOperator.html#a07783e6f39803037259a1ebe376c2b1e">hasNoSignedWrap</a>() &amp;&amp;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <a class="code" href="namespacellvm.html#a26072ee56129fc3220771cda9f053ecb">ComputeNumSignBits</a>(I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0)) &gt; ShAmt) {</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      I.<a class="code" href="classllvm_1_1BinaryOperator.html#a21ce697328893029ae2c63974061a294">setHasNoSignedWrap</a>();</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <span class="keywordflow">return</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    }</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  }</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="comment">// (C1 &lt;&lt; A) &lt;&lt; C2 -&gt; (C1 &lt;&lt; C2) &lt;&lt; A</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a>, *C2;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), <a class="code" href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">m_OneUse</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a37668d9884c78ac77254cf9fb8a4276a">m_Shl</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(C1), <a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(A)))) &amp;&amp;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1), <a class="code" href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">m_Constant</a>(C2)))</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keywordflow">return</span> BinaryOperator::CreateShl(<a class="code" href="classllvm_1_1ConstantExpr.html#aa5ad9e9e7cc67e1675d8d1631a73e625">ConstantExpr::getShl</a>(C1, C2), A);</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;}</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno"><a class="line" href="classllvm_1_1InstCombiner.html#a5d8bb3df93781e5cfc244a5c1abe0f99">  715</a></span>&#160;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1InstCombiner.html#a5d8bb3df93781e5cfc244a5c1abe0f99">InstCombiner::visitLShr</a>(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#a5f77cf32ac3d55776431dade50fc2b46">SimplifyLShrInst</a>(I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1),</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                                  I.<a class="code" href="classllvm_1_1BinaryOperator.html#a0f67e7208255f5088f0d515185109174">isExact</a>(), TD))</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">return</span> ReplaceInstUsesWith(I, V);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *R = commonShiftTransforms(I))</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">return</span> R;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Op0 = I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), *Op1 = I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Op1C = dyn_cast&lt;ConstantInt&gt;(Op1)) {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="keywordtype">unsigned</span> ShAmt = Op1C-&gt;getZExtValue();</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II = dyn_cast&lt;IntrinsicInst&gt;(Op0)) {</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="keywordtype">unsigned</span> BitWidth = Op0-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ad979b3c1bc975ee23810e3018ffe951b">getScalarSizeInBits</a>();</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <span class="comment">// ctlz.i32(x)&gt;&gt;5  --&gt; zext(x == 0)</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="comment">// cttz.i32(x)&gt;&gt;5  --&gt; zext(x == 0)</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <span class="comment">// ctpop.i32(x)&gt;&gt;5 --&gt; zext(x == -1)</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="keywordflow">if</span> ((II-&gt;getIntrinsicID() == <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90aec4d763aa35e2d7933293967ebf71d89">Intrinsic::ctlz</a> ||</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;           II-&gt;getIntrinsicID() == <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90acf42e24475fdea623c2a8cb7b3f412c4">Intrinsic::cttz</a> ||</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;           II-&gt;getIntrinsicID() == <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90a71901b588a9f2b63c6a878ad6c20dc32">Intrinsic::ctpop</a>) &amp;&amp;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;          <a class="code" href="namespacellvm.html#af4d1a918800291e75b01ce1447be0e83">isPowerOf2_32</a>(BitWidth) &amp;&amp; <a class="code" href="namespacellvm.html#a646986783f35e0fef8988f0f28d2589f">Log2_32</a>(BitWidth) == ShAmt) {</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <span class="keywordtype">bool</span> isCtPop = II-&gt;getIntrinsicID() == <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90a71901b588a9f2b63c6a878ad6c20dc32">Intrinsic::ctpop</a>;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        <a class="code" href="classllvm_1_1Constant.html">Constant</a> *RHS = <a class="code" href="classllvm_1_1ConstantInt.html#ad736fb9b585509388546c12617def38f">ConstantInt::getSigned</a>(Op0-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), isCtPop ? -1:0);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Cmp = Builder-&gt;CreateICmpEQ(II-&gt;getArgOperand(0), RHS);</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1ZExtInst.html">ZExtInst</a>(Cmp, II-&gt;getType());</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      }</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    }</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="comment">// If the shifted-out value is known-zero, then this is an exact shift.</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordflow">if</span> (!I.<a class="code" href="classllvm_1_1BinaryOperator.html#a0f67e7208255f5088f0d515185109174">isExact</a>() &amp;&amp;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <a class="code" href="namespacellvm.html#a8bc4c3e77e6f3d6c54b8b4504393dfa7">MaskedValueIsZero</a>(Op0,<a class="code" href="classllvm_1_1APInt.html#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(Op1C-&gt;getBitWidth(),ShAmt))){</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      I.<a class="code" href="classllvm_1_1BinaryOperator.html#aac502d7d65e2996cf6b819b14e17499c">setIsExact</a>();</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <span class="keywordflow">return</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    }</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  }</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;}</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div><div class="line"><a name="l00755"></a><span class="lineno"><a class="line" href="classllvm_1_1InstCombiner.html#aacd492b1e50c8aab58d3570a04dde30a">  755</a></span>&#160;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1InstCombiner.html#aacd492b1e50c8aab58d3570a04dde30a">InstCombiner::visitAShr</a>(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#a0547bdf9e4fb916625839c190ef09266">SimplifyAShrInst</a>(I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1),</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                                  I.<a class="code" href="classllvm_1_1BinaryOperator.html#a0f67e7208255f5088f0d515185109174">isExact</a>(), TD))</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordflow">return</span> ReplaceInstUsesWith(I, V);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *R = commonShiftTransforms(I))</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">return</span> R;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Op0 = I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), *Op1 = I.<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1);</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Op1C = dyn_cast&lt;ConstantInt&gt;(Op1)) {</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordtype">unsigned</span> ShAmt = Op1C-&gt;getZExtValue();</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="comment">// If the input is a SHL by the same constant (ashr (shl X, C), C), then we</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="comment">// have a sign-extend idiom.</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm.html#a6569d00d31a5d74e563e2f39f82271ab">X</a>;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a class="code" href="namespacellvm_1_1PatternMatch.html#a37668d9884c78ac77254cf9fb8a4276a">m_Shl</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(X), <a class="code" href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">m_Specific</a>(Op1)))) {</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      <span class="comment">// If the left shift is just shifting out partial signbits, delete the</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      <span class="comment">// extension.</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <span class="keywordflow">if</span> (cast&lt;OverflowingBinaryOperator&gt;(Op0)-&gt;hasNoSignedWrap())</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <span class="keywordflow">return</span> ReplaceInstUsesWith(I, X);</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      <span class="comment">// If the input is an extension from the shifted amount value, e.g.</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      <span class="comment">//   %x = zext i8 %A to i32</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <span class="comment">//   %y = shl i32 %x, 24</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="comment">//   %z = ashr %y, 24</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="comment">// then turn this into &quot;z = sext i8 A to i32&quot;.</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ZExtInst.html">ZExtInst</a> *ZI = dyn_cast&lt;ZExtInst&gt;(X)) {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        uint32_t SrcBits = ZI-&gt;getOperand(0)-&gt;getType()-&gt;getScalarSizeInBits();</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        uint32_t DestBits = ZI-&gt;getType()-&gt;getScalarSizeInBits();</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <span class="keywordflow">if</span> (Op1C-&gt;getZExtValue() == DestBits-SrcBits)</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classllvm_1_1SExtInst.html">SExtInst</a>(ZI-&gt;getOperand(0), ZI-&gt;getType());</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      }</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    }</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="comment">// If the shifted-out value is known-zero, then this is an exact shift.</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">if</span> (!I.<a class="code" href="classllvm_1_1BinaryOperator.html#a0f67e7208255f5088f0d515185109174">isExact</a>() &amp;&amp;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <a class="code" href="namespacellvm.html#a8bc4c3e77e6f3d6c54b8b4504393dfa7">MaskedValueIsZero</a>(Op0,<a class="code" href="classllvm_1_1APInt.html#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(Op1C-&gt;getBitWidth(),ShAmt))){</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      I.<a class="code" href="classllvm_1_1BinaryOperator.html#aac502d7d65e2996cf6b819b14e17499c">setIsExact</a>();</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      <span class="keywordflow">return</span> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    }</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  }</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="comment">// See if we can turn a signed shr into an unsigned shr.</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a8bc4c3e77e6f3d6c54b8b4504393dfa7">MaskedValueIsZero</a>(Op0,</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                        <a class="code" href="classllvm_1_1APInt.html#a2e5e9f65d911e80a46d3098933794056">APInt::getSignBit</a>(I.<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ad979b3c1bc975ee23810e3018ffe951b">getScalarSizeInBits</a>())))</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <span class="keywordflow">return</span> BinaryOperator::CreateLShr(Op0, Op1);</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="comment">// Arithmetic shifting an all-sign-bit value is a no-op.</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordtype">unsigned</span> NumSignBits = <a class="code" href="namespacellvm.html#a26072ee56129fc3220771cda9f053ecb">ComputeNumSignBits</a>(Op0);</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="keywordflow">if</span> (NumSignBits == Op0-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ad979b3c1bc975ee23810e3018ffe951b">getScalarSizeInBits</a>())</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordflow">return</span> ReplaceInstUsesWith(I, Op0);</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;}</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="ttc" id="classllvm_1_1IRBuilder_html_a3f8c45ea10c393433221a508b750dcd5"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a3f8c45ea10c393433221a508b750dcd5">llvm::IRBuilder::CreateLShr</a></div><div class="ttdeci">Value * CreateLShr(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;, bool isExact=false)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00753">IRBuilder.h:753</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_a427435d4da769ae680a8e77ef89520aa"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a427435d4da769ae680a8e77ef89520aa">llvm::PatternMatch::m_And</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::And &gt; m_And(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00467">PatternMatch.h:467</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_a24bca8838396aa81b87de8e7ac774b19"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">llvm::PatternMatch::m_Value</a></div><div class="ttdeci">class_match&lt; Value &gt; m_Value()</div><div class="ttdoc">m_Value() - Match an arbitrary value and ignore it. </div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00070">PatternMatch.h:70</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_a21ce697328893029ae2c63974061a294"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a21ce697328893029ae2c63974061a294">llvm::BinaryOperator::setHasNoSignedWrap</a></div><div class="ttdeci">void setHasNoSignedWrap(bool b=true)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02001">Instructions.cpp:2001</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARM__PROC_html_aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5"><div class="ttname"><a href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">llvm::ARM_PROC::A</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInfo_8h_source.html#l00098">ARMBaseInfo.h:98</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a2e5e9f65d911e80a46d3098933794056"><div class="ttname"><a href="classllvm_1_1APInt.html#a2e5e9f65d911e80a46d3098933794056">llvm::APInt::getSignBit</a></div><div class="ttdeci">static APInt getSignBit(unsigned BitWidth)</div><div class="ttdoc">Get the SignBit for a specific bit width. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00443">APInt.h:443</a></div></div>
<div class="ttc" id="namespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">List of target independent CodeGen pass IDs. </div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l00022">APFloat.h:22</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_ad979b3c1bc975ee23810e3018ffe951b"><div class="ttname"><a href="classllvm_1_1Type.html#ad979b3c1bc975ee23810e3018ffe951b">llvm::Type::getScalarSizeInBits</a></div><div class="ttdeci">unsigned getScalarSizeInBits()</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00135">Type.cpp:135</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_a42df6a41563b50a3fd1872230ed0b5ec"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a42df6a41563b50a3fd1872230ed0b5ec">llvm::PatternMatch::m_SRem</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::SRem &gt; m_SRem(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00455">PatternMatch.h:455</a></div></div>
<div class="ttc" id="InstCombine_8h_html"><div class="ttname"><a href="InstCombine_8h.html">InstCombine.h</a></div></div>
<div class="ttc" id="IntrinsicInst_8h_html"><div class="ttname"><a href="IntrinsicInst_8h.html">IntrinsicInst.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a3f2f98c2a67c9e79f58aad9150a62e42"><div class="ttname"><a href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">llvm::dyn_cast</a></div><div class="ttdeci">enable_if_c&lt;!is_simple_type&lt; Y &gt;::value, typename cast_retty&lt; X, const Y &gt;::ret_type &gt;::type dyn_cast(const Y &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="Casting_8h_source.html#l00266">Casting.h:266</a></div></div>
<div class="ttc" id="classllvm_1_1ZExtInst_html"><div class="ttname"><a href="classllvm_1_1ZExtInst.html">llvm::ZExtInst</a></div><div class="ttdoc">This class represents zero extension of integer types. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03211">Instructions.h:3211</a></div></div>
<div class="ttc" id="namespacellvm_html_a8bc4c3e77e6f3d6c54b8b4504393dfa7"><div class="ttname"><a href="namespacellvm.html#a8bc4c3e77e6f3d6c54b8b4504393dfa7">llvm::MaskedValueIsZero</a></div><div class="ttdeci">bool MaskedValueIsZero(Value *V, const APInt &amp;Mask, const DataLayout *TD=0, unsigned Depth=0)</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l01115">ValueTracking.cpp:1115</a></div></div>
<div class="ttc" id="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode_html_a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4"><div class="ttname"><a href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">llvm::NVPTX::PTXLdStInstCode::V2</a></div><div class="ttdef"><b>Definition:</b> <a href="NVPTX_8h_source.html#l00127">NVPTX.h:127</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html"><div class="ttname"><a href="classllvm_1_1PHINode.html">llvm::PHINode</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01978">Instructions.h:1978</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_ad960e1ff48d25c382b6d28e7961f074e"><div class="ttname"><a href="classllvm_1_1APInt.html#ad960e1ff48d25c382b6d28e7961f074e">llvm::APInt::getLowBitsSet</a></div><div class="ttdeci">static APInt getLowBitsSet(unsigned numBits, unsigned loBitsSet)</div><div class="ttdoc">Get a value with low bits set. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00528">APInt.h:528</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a73349916f7e54a6b988a3646c7a02e90a71901b588a9f2b63c6a878ad6c20dc32"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90a71901b588a9f2b63c6a878ad6c20dc32">llvm::Intrinsic::ctpop</a></div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l00366">Intrinsics.h:366</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_aadd209ba7e1bfa8113a609e09a7fe62f"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aadd209ba7e1bfa8113a609e09a7fe62f">llvm::PatternMatch::m_Constant</a></div><div class="ttdeci">class_match&lt; Constant &gt; m_Constant()</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00078">PatternMatch.h:78</a></div></div>
<div class="ttc" id="InstCombineShifts_8cpp_html_ad92bdfedd6ef2d2778081f6c43d027cb"><div class="ttname"><a href="InstCombineShifts_8cpp.html#ad92bdfedd6ef2d2778081f6c43d027cb">CanEvaluateShifted</a></div><div class="ttdeci">static bool CanEvaluateShifted(Value *V, unsigned NumBits, bool isLeftShift, InstCombiner &amp;IC)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineShifts_8cpp_source.html#l00068">InstCombineShifts.cpp:68</a></div></div>
<div class="ttc" id="classllvm_1_1InstCombineWorklist_html_a371049452a97755a1b39dea46017439a"><div class="ttname"><a href="classllvm_1_1InstCombineWorklist.html#a371049452a97755a1b39dea46017439a">llvm::InstCombineWorklist::Add</a></div><div class="ttdeci">void Add(Instruction *I)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineWorklist_8h_source.html#l00038">InstCombineWorklist.h:38</a></div></div>
<div class="ttc" id="classllvm_1_1SExtInst_html"><div class="ttname"><a href="classllvm_1_1SExtInst.html">llvm::SExtInst</a></div><div class="ttdoc">This class represents a sign extension of integer types. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03247">Instructions.h:3247</a></div></div>
<div class="ttc" id="InstructionSimplify_8h_html"><div class="ttname"><a href="InstructionSimplify_8h.html">InstructionSimplify.h</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html_aa6574d526b3e38a28f688a7bb4325c2c"><div class="ttname"><a href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">llvm::Constant::getNullValue</a></div><div class="ttdeci">static Constant * getNullValue(Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00111">Constants.cpp:111</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad452febc1ac0b394876e640ec03ffa38"><div class="ttname"><a href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00167">Value.cpp:167</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a90982bca61da940a80629040c075e33e"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a90982bca61da940a80629040c075e33e">llvm::ConstantInt::uge</a></div><div class="ttdeci">bool uge(uint64_t Num) const </div><div class="ttdoc">Determine if the value is greater or equal to the given number. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00209">Constants.h:209</a></div></div>
<div class="ttc" id="namespacellvm_1_1MCID_html_a8035044d40d3758eb45b65dce69dc90ba32dbd2c72a98eaee90e3ad5ef7b5af16"><div class="ttname"><a href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba32dbd2c72a98eaee90e3ad5ef7b5af16">llvm::MCID::Select</a></div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00113">MCInstrDesc.h:113</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_a25d956d9e0beadd47ce4bc255dfa811d"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">llvm::PatternMatch::match</a></div><div class="ttdeci">bool match(Val *V, const Pattern &amp;P)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00042">PatternMatch.h:42</a></div></div>
<div class="ttc" id="classllvm_1_1InstCombiner_html_a5acf2a841db50684c87133f36bdd00a1"><div class="ttname"><a href="classllvm_1_1InstCombiner.html#a5acf2a841db50684c87133f36bdd00a1">llvm::InstCombiner::getDataLayout</a></div><div class="ttdeci">DataLayout * getDataLayout() const </div><div class="ttdef"><b>Definition:</b> <a href="InstCombine_8h_source.html#l00102">InstCombine.h:102</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a73349916f7e54a6b988a3646c7a02e90aec4d763aa35e2d7933293967ebf71d89"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90aec4d763aa35e2d7933293967ebf71d89">llvm::Intrinsic::ctlz</a></div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l00365">Intrinsics.h:365</a></div></div>
<div class="ttc" id="classllvm_1_1SelectInst_html"><div class="ttname"><a href="classllvm_1_1SelectInst.html">llvm::SelectInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01430">Instructions.h:1430</a></div></div>
<div class="ttc" id="classllvm_1_1InstCombiner_html_ac675260ee94a66a9d8977af984f5f784"><div class="ttname"><a href="classllvm_1_1InstCombiner.html#ac675260ee94a66a9d8977af984f5f784">llvm::InstCombiner::commonShiftTransforms</a></div><div class="ttdeci">Instruction * commonShiftTransforms(BinaryOperator &amp;I)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineShifts_8cpp_source.html#l00022">InstCombineShifts.cpp:22</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_afd44535c4ae204571d5721fa4a7042f2"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#afd44535c4ae204571d5721fa4a7042f2">llvm::ConstantExpr::get</a></div><div class="ttdeci">static Constant * get(unsigned Opcode, Constant *C1, Constant *C2, unsigned Flags=0)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01690">Constants.cpp:1690</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_af8dde13a97efce293a7b04daf1e208fb"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">llvm::ConstantInt::getValue</a></div><div class="ttdeci">const APInt &amp; getValue() const </div><div class="ttdoc">Return the constant&amp;#39;s value. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00105">Constants.h:105</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_a8429e9826885bbef0cfb350bbc49f5db"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a8429e9826885bbef0cfb350bbc49f5db">llvm::PatternMatch::m_Shr</a></div><div class="ttdeci">BinOp2_match&lt; LHS, RHS, Instruction::LShr, Instruction::AShr &gt; m_Shr(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdoc">m_Shr - Matches LShr or AShr. </div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00528">PatternMatch.h:528</a></div></div>
<div class="ttc" id="ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdef"><b>Definition:</b> <a href="ErrorHandling_8h_source.html#l00103">ErrorHandling.h:103</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_aaa9083a85e23c9c5ee366920d90ae51e"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#aaa9083a85e23c9c5ee366920d90ae51e">llvm::BinaryOperator::setHasNoUnsignedWrap</a></div><div class="ttdeci">void setHasNoUnsignedWrap(bool b=true)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01997">Instructions.cpp:1997</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_aa1953b3ad7ef6aa87dc0205db0c2ea45"><div class="ttname"><a href="classllvm_1_1APInt.html#aa1953b3ad7ef6aa87dc0205db0c2ea45">llvm::APInt::lshr</a></div><div class="ttdeci">APInt LLVM_ATTRIBUTE_UNUSED_RESULT lshr(unsigned shiftAmt) const </div><div class="ttdoc">Logical right-shift function. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8cpp_source.html#l01127">APInt.cpp:1127</a></div></div>
<div class="ttc" id="classllvm_1_1InstCombiner_html"><div class="ttname"><a href="classllvm_1_1InstCombiner.html">llvm::InstCombiner</a></div><div class="ttdoc">InstCombiner - The -instcombine pass. </div><div class="ttdef"><b>Definition:</b> <a href="InstCombine_8h_source.html#l00072">InstCombine.h:72</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00031">Instruction.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a6edd823ba5e4e1effc8280ca8a1194ef"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">llvm::ConstantInt::getZExtValue</a></div><div class="ttdeci">uint64_t getZExtValue() const </div><div class="ttdoc">Return the zero extended value. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00116">Constants.h:116</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html">llvm::ConstantExpr</a></div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00790">Constants.h:790</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a197d5dd77cad4560a082900962a830aa"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a197d5dd77cad4560a082900962a830aa">llvm::IRBuilder::CreateAnd</a></div><div class="ttdeci">Value * CreateAnd(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00789">IRBuilder.h:789</a></div></div>
<div class="ttc" id="InstCombineCasts_8cpp_html_a6fd17099ed520f179e5b481db961e0e1"><div class="ttname"><a href="InstCombineCasts_8cpp.html#a6fd17099ed520f179e5b481db961e0e1">CanEvaluateTruncated</a></div><div class="ttdeci">static bool CanEvaluateTruncated(Value *V, Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineCasts_8cpp_source.html#l00335">InstCombineCasts.cpp:335</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_a8db36c82f32d6f6a4d35a00e55be03a8"><div class="ttname"><a href="Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a></div><div class="ttdeci">bool Shift</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00506">Target/README.txt:506</a></div></div>
<div class="ttc" id="namespacellvm_html_a8891be7c27326c20a6dba7d98e9030b5"><div class="ttname"><a href="namespacellvm.html#a8891be7c27326c20a6dba7d98e9030b5">llvm::ConstantFoldConstantExpression</a></div><div class="ttdeci">Constant * ConstantFoldConstantExpression(const ConstantExpr *CE, const DataLayout *TD=0, const TargetLibraryInfo *TLI=0)</div><div class="ttdef"><b>Definition:</b> <a href="ConstantFolding_8cpp_source.html#l00937">ConstantFolding.cpp:937</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a024bb83a7f01e7661ea72ff7dcc460f5"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a024bb83a7f01e7661ea72ff7dcc460f5">llvm::ConstantInt::getLimitedValue</a></div><div class="ttdeci">uint64_t getLimitedValue(uint64_t Limit=~0ULL) const </div><div class="ttdoc">Get the constant&amp;#39;s value with a saturation limit. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00218">Constants.h:218</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_ad933e66b8bbd406e84d1dbbf094d4cde"><div class="ttname"><a href="classllvm_1_1Instruction.html#ad933e66b8bbd406e84d1dbbf094d4cde">llvm::Instruction::isLogicalShift</a></div><div class="ttdeci">bool isLogicalShift() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00108">Instruction.h:108</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_a34a92072122412c6020d4afb43725bf4"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a34a92072122412c6020d4afb43725bf4">llvm::PatternMatch::m_ConstantInt</a></div><div class="ttdeci">class_match&lt; ConstantInt &gt; m_ConstantInt()</div><div class="ttdoc">m_ConstantInt() - Match an arbitrary ConstantInt and ignore it. </div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00072">PatternMatch.h:72</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_ad5e60756e331a97669d11b5c9d8691a2"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#ad5e60756e331a97669d11b5c9d8691a2">llvm::PatternMatch::m_Power2</a></div><div class="ttdeci">cst_pred_ty&lt; is_power2 &gt; m_Power2()</div><div class="ttdoc">m_Power2() - Match an integer or vector power of 2. </div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00281">PatternMatch.h:281</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ae855357b6c5e6e7ed1869272708a3a84"><div class="ttname"><a href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">llvm::Value::takeName</a></div><div class="ttdeci">void takeName(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00239">Value.cpp:239</a></div></div>
<div class="ttc" id="classllvm_1_1TruncInst_html"><div class="ttname"><a href="classllvm_1_1TruncInst.html">llvm::TruncInst</a></div><div class="ttdoc">This class represents a truncation of integer types. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03175">Instructions.h:3175</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a407ab30fb284068600e0cba2677640c2"><div class="ttname"><a href="classllvm_1_1Instruction.html#a407ab30fb284068600e0cba2677640c2">llvm::Instruction::isShift</a></div><div class="ttdeci">bool isShift()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00088">Instruction.h:88</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a1dc5339334162e650ff87e89629bf66c"><div class="ttname"><a href="classllvm_1_1APInt.html#a1dc5339334162e650ff87e89629bf66c">llvm::APInt::ult</a></div><div class="ttdeci">bool ult(const APInt &amp;RHS) const </div><div class="ttdoc">Unsigned less than comparison. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8cpp_source.html#l00515">APInt.cpp:515</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_aa45f6c0433576e3858a6209a43750ad4"><div class="ttname"><a href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">llvm::PHINode::getNumIncomingValues</a></div><div class="ttdeci">unsigned getNumIncomingValues() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02055">Instructions.h:2055</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_adcb96bd09d7c75c7669fa5f9d1190899"><div class="ttname"><a href="classllvm_1_1APInt.html#adcb96bd09d7c75c7669fa5f9d1190899">llvm::APInt::getHighBitsSet</a></div><div class="ttdeci">static APInt getHighBitsSet(unsigned numBits, unsigned hiBitsSet)</div><div class="ttdoc">Get a value with high bits set. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00510">APInt.h:510</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_aca6428e7fec51ba0b55594f469eb9691"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aca6428e7fec51ba0b55594f469eb9691">llvm::PatternMatch::m_OneUse</a></div><div class="ttdeci">OneUse_match&lt; T &gt; m_OneUse(const T &amp;SubPattern)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00060">PatternMatch.h:60</a></div></div>
<div class="ttc" id="README__ALTIVEC_8txt_html_a9aacd9146afe44bf656cd664e2a88c8c"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div><div class="ttdeci">(vector float) vec_cmpeq(*A,*B) C</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00091">README_ALTIVEC.txt:91</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_aa08fee11e8a5ec10c0cc2a7abbbd799a"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#aa08fee11e8a5ec10c0cc2a7abbbd799a">llvm::PatternMatch::m_LShr</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::LShr &gt; m_LShr(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00491">PatternMatch.h:491</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html"><div class="ttname"><a href="classllvm_1_1Constant.html">llvm::Constant</a></div><div class="ttdoc">LLVM Constant Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Constant_8h_source.html#l00041">Constant.h:41</a></div></div>
<div class="ttc" id="namespacellvm_1_1APIntOps_html_a22f056804d2b9882f74adc905872bc39"><div class="ttname"><a href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">llvm::APIntOps::Or</a></div><div class="ttdeci">APInt Or(const APInt &amp;LHS, const APInt &amp;RHS)</div><div class="ttdoc">Bitwise OR function for APInt. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01845">APInt.h:1845</a></div></div>
<div class="ttc" id="namespacellvm_1_1APIntOps_html_afc7c4d88d09cba0c5e920f8a3a3ace55"><div class="ttname"><a href="namespacellvm_1_1APIntOps.html#afc7c4d88d09cba0c5e920f8a3a3ace55">llvm::APIntOps::Xor</a></div><div class="ttdeci">APInt Xor(const APInt &amp;LHS, const APInt &amp;RHS)</div><div class="ttdoc">Bitwise XOR function for APInt. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01850">APInt.h:1850</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_a2d9861feadd3a09792967a012559e7b2"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a2d9861feadd3a09792967a012559e7b2">llvm::PatternMatch::m_Specific</a></div><div class="ttdeci">specificval_ty m_Specific(const Value *V)</div><div class="ttdoc">m_Specific - Match if we have a specific specified value. </div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00323">PatternMatch.h:323</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_a37668d9884c78ac77254cf9fb8a4276a"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a37668d9884c78ac77254cf9fb8a4276a">llvm::PatternMatch::m_Shl</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::Shl &gt; m_Shl(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00485">PatternMatch.h:485</a></div></div>
<div class="ttc" id="namespacellvm_html_a2ec75001a2ff23312dba513b2f2bd044"><div class="ttname"><a href="namespacellvm.html#a2ec75001a2ff23312dba513b2f2bd044">llvm::SimplifyShlInst</a></div><div class="ttdeci">Value * SimplifyShlInst(Value *Op0, Value *Op1, bool isNSW, bool isNUW, const DataLayout *TD=0, const TargetLibraryInfo *TLI=0, const DominatorTree *DT=0)</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8cpp_source.html#l01353">InstructionSimplify.cpp:1353</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a997ff6a1758bf732b9b263fc61011644"><div class="ttname"><a href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">llvm::User::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00088">User.h:88</a></div></div>
<div class="ttc" id="classllvm_1_1IntegerType_html"><div class="ttname"><a href="classllvm_1_1IntegerType.html">llvm::IntegerType</a></div><div class="ttdoc">Integer representation type. </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00037">DerivedTypes.h:37</a></div></div>
<div class="ttc" id="Target_2PowerPC_2README_8txt_html_afc7ca55ad1da67847ecd4b99ef64dc84"><div class="ttname"><a href="Target_2PowerPC_2README_8txt.html#afc7ca55ad1da67847ecd4b99ef64dc84">CC</a></div><div class="ttdeci">which only computes the address of bar double int Z void if you have a function since the bit double ate up the argument bytes for r4 and r5 The trick then would be to shuffle the argument order for functions we can internalize so that the maximum number of integers pointers get passed in regs before you see any of the fp arguments Instead of implementing it would actually probably be easier to just implement a PPC where we could do whatever we wanted to the CC</div><div class="ttdef"><b>Definition:</b> <a href="Target_2PowerPC_2README_8txt_source.html#l00247">Target/PowerPC/README.txt:247</a></div></div>
<div class="ttc" id="classllvm_1_1InstCombiner_html_aaca490f77b8a0ca6b013db8c0de18972"><div class="ttname"><a href="classllvm_1_1InstCombiner.html#aaca490f77b8a0ca6b013db8c0de18972">llvm::InstCombiner::Worklist</a></div><div class="ttdeci">InstCombineWorklist Worklist</div><div class="ttdoc">Worklist - All of the instructions that need to be simplified. </div><div class="ttdef"><b>Definition:</b> <a href="InstCombine_8h_source.html#l00082">InstCombine.h:82</a></div></div>
<div class="ttc" id="classllvm_1_1InstCombiner_html_a5d8bb3df93781e5cfc244a5c1abe0f99"><div class="ttname"><a href="classllvm_1_1InstCombiner.html#a5d8bb3df93781e5cfc244a5c1abe0f99">llvm::InstCombiner::visitLShr</a></div><div class="ttdeci">Instruction * visitLShr(BinaryOperator &amp;I)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineShifts_8cpp_source.html#l00715">InstCombineShifts.cpp:715</a></div></div>
<div class="ttc" id="classllvm_1_1InstCombiner_html_a6e33228c0d5bb3b72f357677fa105185"><div class="ttname"><a href="classllvm_1_1InstCombiner.html#a6e33228c0d5bb3b72f357677fa105185">llvm::InstCombiner::Builder</a></div><div class="ttdeci">BuilderTy * Builder</div><div class="ttdef"><b>Definition:</b> <a href="InstCombine_8h_source.html#l00087">InstCombine.h:87</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_af85a4828b6b5a8de7fc0a55cc0e5b52f"><div class="ttname"><a href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">llvm::Value::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdoc">All values hold a context through their type. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00517">Value.cpp:517</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_a07783e6f39803037259a1ebe376c2b1e"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a07783e6f39803037259a1ebe376c2b1e">llvm::BinaryOperator::hasNoSignedWrap</a></div><div class="ttdeci">bool hasNoSignedWrap() const </div><div class="ttdoc">hasNoSignedWrap - Determine whether the no signed wrap flag is set. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02013">Instructions.cpp:2013</a></div></div>
<div class="ttc" id="classllvm_1_1SelectInst_html_a67bf091383cd61e1225445e78b61d9f9"><div class="ttname"><a href="classllvm_1_1SelectInst.html#a67bf091383cd61e1225445e78b61d9f9">llvm::SelectInst::getTrueValue</a></div><div class="ttdeci">const Value * getTrueValue() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01467">Instructions.h:1467</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_aac502d7d65e2996cf6b819b14e17499c"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#aac502d7d65e2996cf6b819b14e17499c">llvm::BinaryOperator::setIsExact</a></div><div class="ttdeci">void setIsExact(bool b=true)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02005">Instructions.cpp:2005</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_a88505baf41407782678a5df1702d2d31"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">llvm::BinaryOperator::getOpcode</a></div><div class="ttdeci">BinaryOps getOpcode() const </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00326">InstrTypes.h:326</a></div></div>
<div class="ttc" id="namespacellvm_1_1TargetOpcode_html_a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72"><div class="ttname"><a href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">llvm::TargetOpcode::PHI</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetOpcodes_8h_source.html#l00026">TargetOpcodes.h:26</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html"><div class="ttname"><a href="classllvm_1_1ConstantInt.html">llvm::ConstantInt</a></div><div class="ttdoc">Class for constant integers. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00051">Constants.h:51</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_aba6a4cc4ed6d6fef3664b8d65ef04820"><div class="ttname"><a href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">llvm::PHINode::getIncomingValue</a></div><div class="ttdeci">Value * getIncomingValue(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02059">Instructions.h:2059</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00029">Target/README.txt:29</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_a2a2df5a25b9c703e74e82b48a75d0c3d"><div class="ttname"><a href="Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a></div><div class="ttdeci">instcombine should handle this C2 when C1</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00300">Target/README.txt:300</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a0cf3748dba54f931bb1241ae4adc76bc"><div class="ttname"><a href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00111">Value.h:111</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html">llvm::BinaryOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00138">InstrTypes.h:138</a></div></div>
<div class="ttc" id="InstCombineShifts_8cpp_html_a57c1400fce72467412a175ace02dda0c"><div class="ttname"><a href="InstCombineShifts_8cpp.html#a57c1400fce72467412a175ace02dda0c">GetShiftedValue</a></div><div class="ttdeci">static Value * GetShiftedValue(Value *V, unsigned NumBits, bool isLeftShift, InstCombiner &amp;IC)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineShifts_8cpp_source.html#l00183">InstCombineShifts.cpp:183</a></div></div>
<div class="ttc" id="classllvm_1_1InstCombiner_html_a464c7ef1f4e5a7e2c612d2f9362a16b5"><div class="ttname"><a href="classllvm_1_1InstCombiner.html#a464c7ef1f4e5a7e2c612d2f9362a16b5">llvm::InstCombiner::FoldShiftByConstant</a></div><div class="ttdeci">Instruction * FoldShiftByConstant(Value *Op0, ConstantInt *Op1, BinaryOperator &amp;I)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineShifts_8cpp_source.html#l00312">InstCombineShifts.cpp:312</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a9105541412dab869e18b3cceebfff07d"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">llvm::ConstantInt::get</a></div><div class="ttdeci">static Constant * get(Type *Ty, uint64_t V, bool isSigned=false)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00492">Constants.cpp:492</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_ad736fb9b585509388546c12617def38f"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#ad736fb9b585509388546c12617def38f">llvm::ConstantInt::getSigned</a></div><div class="ttdeci">static ConstantInt * getSigned(IntegerType *Ty, int64_t V)</div><div class="ttdoc">Get a ConstantInt for a specific signed value. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00507">Constants.cpp:507</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_a0f67e7208255f5088f0d515185109174"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a0f67e7208255f5088f0d515185109174">llvm::BinaryOperator::isExact</a></div><div class="ttdeci">bool isExact() const </div><div class="ttdoc">isExact - Determine whether the exact flag is set. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02017">Instructions.cpp:2017</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a5fa9b8e1842b354f64c1ba6be0a4a17f"><div class="ttname"><a href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">llvm::User::setOperand</a></div><div class="ttdeci">void setOperand(unsigned i, Value *Val)</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00092">User.h:92</a></div></div>
<div class="ttc" id="namespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs - Return a circular-buffered debug stream. </div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00101">Debug.cpp:101</a></div></div>
<div class="ttc" id="namespacellvm_html_a646986783f35e0fef8988f0f28d2589f"><div class="ttname"><a href="namespacellvm.html#a646986783f35e0fef8988f0f28d2589f">llvm::Log2_32</a></div><div class="ttdeci">unsigned Log2_32(uint32_t Value)</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00443">MathExtras.h:443</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html"><div class="ttname"><a href="classllvm_1_1APInt.html">llvm::APInt</a></div><div class="ttdoc">Class for arbitrary precision integers. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00075">APInt.h:75</a></div></div>
<div class="ttc" id="classllvm_1_1InstCombiner_html_af85cbc14ad0720c50edafb0072acef9b"><div class="ttname"><a href="classllvm_1_1InstCombiner.html#af85cbc14ad0720c50edafb0072acef9b">llvm::InstCombiner::getTargetLibraryInfo</a></div><div class="ttdeci">TargetLibraryInfo * getTargetLibraryInfo() const </div><div class="ttdef"><b>Definition:</b> <a href="InstCombine_8h_source.html#l00104">InstCombine.h:104</a></div></div>
<div class="ttc" id="PatternMatch_8h_html"><div class="ttname"><a href="PatternMatch_8h.html">PatternMatch.h</a></div></div>
<div class="ttc" id="ConstantFolding_8h_html"><div class="ttname"><a href="ConstantFolding_8h.html">ConstantFolding.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1APIntOps_html_a684cfe02c582e8d75cd6d457e63e6c25"><div class="ttname"><a href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">llvm::APIntOps::And</a></div><div class="ttdeci">APInt And(const APInt &amp;LHS, const APInt &amp;RHS)</div><div class="ttdoc">Bitwise AND function for APInt. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01840">APInt.h:1840</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a4d49fd9a4cc4f2a74d4555bd08b13910"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a4d49fd9a4cc4f2a74d4555bd08b13910">llvm::IRBuilder::CreateShl</a></div><div class="ttdeci">Value * CreateShl(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;, bool HasNUW=false, bool HasNSW=false)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00734">IRBuilder.h:734</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_a80e82791d4d7f4d1d23d68ca0a2b1f64"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#a80e82791d4d7f4d1d23d68ca0a2b1f64">llvm::ConstantExpr::getZExt</a></div><div class="ttdeci">static Constant * getZExt(Constant *C, Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01566">Constants.cpp:1566</a></div></div>
<div class="ttc" id="MD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00054">MD5.cpp:54</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a085b82f074c28030fb8e194377ed2d0c"><div class="ttname"><a href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">llvm::Value::hasOneUse</a></div><div class="ttdeci">bool hasOneUse() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00161">Value.h:161</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_aa5ad9e9e7cc67e1675d8d1631a73e625"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#aa5ad9e9e7cc67e1675d8d1631a73e625">llvm::ConstantExpr::getShl</a></div><div class="ttdeci">static Constant * getShl(Constant *C1, Constant *C2, bool HasNUW=false, bool HasNSW=false)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l02111">Constants.cpp:2111</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_a4a4628e91a9c6a339fa61105614fac76"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a4a4628e91a9c6a339fa61105614fac76">llvm::BinaryOperator::Create</a></div><div class="ttdeci">static BinaryOperator * Create(BinaryOps Op, Value *S1, Value *S2, const Twine &amp;Name=Twine(), Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01834">Instructions.cpp:1834</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8">llvm::A64CC::NV</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00046">AArch64BaseInfo.h:46</a></div></div>
<div class="ttc" id="namespacellvm_html_a26072ee56129fc3220771cda9f053ecb"><div class="ttname"><a href="namespacellvm.html#a26072ee56129fc3220771cda9f053ecb">llvm::ComputeNumSignBits</a></div><div class="ttdeci">unsigned ComputeNumSignBits(Value *Op, const DataLayout *TD=0, unsigned Depth=0)</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l01133">ValueTracking.cpp:1133</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a73349916f7e54a6b988a3646c7a02e90acf42e24475fdea623c2a8cb7b3f412c4"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90acf42e24475fdea623c2a8cb7b3f412c4">llvm::Intrinsic::cttz</a></div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l00367">Intrinsics.h:367</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00066">Value.h:66</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_a5b6cd6c043f54b40899aff62e6e40488"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a5b6cd6c043f54b40899aff62e6e40488">llvm::BinaryOperator::hasNoUnsignedWrap</a></div><div class="ttdeci">bool hasNoUnsignedWrap() const </div><div class="ttdoc">hasNoUnsignedWrap - Determine whether the no unsigned wrap flag is set. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l02009">Instructions.cpp:2009</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a021bb7c9aad6003fe8089f6327356c6c"><div class="ttname"><a href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">llvm::Instruction::getOpcode</a></div><div class="ttdeci">unsigned getOpcode() const </div><div class="ttdoc">getOpcode() returns a member of one of the enums like Instruction::Add. </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00083">Instruction.h:83</a></div></div>
<div class="ttc" id="namespacellvm_html_a5f77cf32ac3d55776431dade50fc2b46"><div class="ttname"><a href="namespacellvm.html#a5f77cf32ac3d55776431dade50fc2b46">llvm::SimplifyLShrInst</a></div><div class="ttdeci">Value * SimplifyLShrInst(Value *Op0, Value *Op1, bool isExact, const DataLayout *TD=0, const TargetLibraryInfo *TLI=0, const DominatorTree *DT=0)</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8cpp_source.html#l01384">InstructionSimplify.cpp:1384</a></div></div>
<div class="ttc" id="Debug_8h_html_aef41e8aaf4c60819b30faf396cdf4978"><div class="ttname"><a href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a></div><div class="ttdeci">#define DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00097">Debug.h:97</a></div></div>
<div class="ttc" id="namespacellvm_html_af4d1a918800291e75b01ce1447be0e83"><div class="ttname"><a href="namespacellvm.html#af4d1a918800291e75b01ce1447be0e83">llvm::isPowerOf2_32</a></div><div class="ttdeci">bool isPowerOf2_32(uint32_t Value)</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00354">MathExtras.h:354</a></div></div>
<div class="ttc" id="classllvm_1_1SelectInst_html_a29a16f32075ee4f23cd769701463952c"><div class="ttname"><a href="classllvm_1_1SelectInst.html#a29a16f32075ee4f23cd769701463952c">llvm::SelectInst::getFalseValue</a></div><div class="ttdeci">const Value * getFalseValue() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01468">Instructions.h:1468</a></div></div>
<div class="ttc" id="classllvm_1_1InstCombiner_html_aacd492b1e50c8aab58d3570a04dde30a"><div class="ttname"><a href="classllvm_1_1InstCombiner.html#aacd492b1e50c8aab58d3570a04dde30a">llvm::InstCombiner::visitAShr</a></div><div class="ttdeci">Instruction * visitAShr(BinaryOperator &amp;I)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineShifts_8cpp_source.html#l00755">InstCombineShifts.cpp:755</a></div></div>
<div class="ttc" id="namespacellvm_html_a0547bdf9e4fb916625839c190ef09266"><div class="ttname"><a href="namespacellvm.html#a0547bdf9e4fb916625839c190ef09266">llvm::SimplifyAShrInst</a></div><div class="ttdeci">Value * SimplifyAShrInst(Value *Op0, Value *Op1, bool isExact, const DataLayout *TD=0, const TargetLibraryInfo *TLI=0, const DominatorTree *DT=0)</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8cpp_source.html#l01420">InstructionSimplify.cpp:1420</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a88cdefb709309eddc6e5daca0be6a7b4"><div class="ttname"><a href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">llvm::PHINode::setIncomingValue</a></div><div class="ttdeci">void setIncomingValue(unsigned i, Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02062">Instructions.h:2062</a></div></div>
<div class="ttc" id="classllvm_1_1InstCombiner_html_a6610d4e76df291a24c3408877da848a7"><div class="ttname"><a href="classllvm_1_1InstCombiner.html#a6610d4e76df291a24c3408877da848a7">llvm::InstCombiner::visitShl</a></div><div class="ttdeci">Instruction * visitShl(BinaryOperator &amp;I)</div><div class="ttdef"><b>Definition:</b> <a href="InstCombineShifts_8cpp_source.html#l00677">InstCombineShifts.cpp:677</a></div></div>
<div class="ttc" id="Target_2ARM_2README_8txt_html_a90cca76dd78688687e0d697679dbc799"><div class="ttname"><a href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional ldr LCPI1_0 ldr ldr tst movne lsr ldr LCPI1_1 and r0 bx lr it saves an instruction and a register It might be profitable to cse MOVi16 if there are lots of bit immediates with the same bottom half Robert Muth started working on an alternate jump table implementation that does not put the tables in line in the text This is more like the llvm default jump table implementation This might be useful sometime Several revisions of patches are on the mailing beginning while CMP sets them like a subtract Therefore to be able to use CMN for comparisons other than the Z we ll need additional logic to reverse the conditionals associated with the comparison Perhaps a pseudo instruction for the with a post codegen pass to clean up and handle the condition codes See PR5694 for testcase Given the following on int B</div><div class="ttdef"><b>Definition:</b> <a href="Target_2ARM_2README_8txt_source.html#l00592">Target/ARM/README.txt:592</a></div></div>
<div class="ttc" id="namespacellvm_html_a6569d00d31a5d74e563e2f39f82271ab"><div class="ttname"><a href="namespacellvm.html#a6569d00d31a5d74e563e2f39f82271ab">llvm::X</a></div><div class="ttdeci">static RegisterPass&lt; NVPTXAllocaHoisting &gt; X(&quot;alloca-hoisting&quot;,&quot;Hoisting alloca instructions in non-entry &quot;&quot;blocks to the entry block&quot;)</div></div>
<div class="ttc" id="classllvm_1_1IntrinsicInst_html"><div class="ttname"><a href="classllvm_1_1IntrinsicInst.html">llvm::IntrinsicInst</a></div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00036">IntrinsicInst.h:36</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<p class="footer">
Generated on Sat Nov 10 2018 22:59:02 for <a href="http://llvm.org/">LLVM</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.8.11</a><br>
Copyright &copy; 2003-2013 University of Illinois at Urbana-Champaign.
All Rights Reserved.</p>
<hr>
<!--#include virtual="/attrib.incl" -->
</body>
</html>
