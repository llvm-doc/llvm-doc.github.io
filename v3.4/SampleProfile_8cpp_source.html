<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="LLVM,Low Level Virtual Machine,C++,doxygen,API,documentation"/>
<meta name="description" content="C++ source code API documentation for LLVM."/>
<title>LLVM: SampleProfile.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">LLVM API Documentation</p>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('SampleProfile_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SampleProfile.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="SampleProfile_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- SampleProfile.cpp - Incorporate sample profiles into the IR --------===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                      The LLVM Compiler Infrastructure</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is distributed under the University of Illinois Open Source</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License. See LICENSE.TXT for details.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// This file implements the SampleProfileLoader transformation. This pass</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// reads a profile file generated by a sampling profiler (e.g. Linux Perf -</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// http://perf.wiki.kernel.org/) and generates IR metadata to reflect the</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// profile information in the given profile.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// This pass generates branch weight annotations on the IR:</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// - prof: Represents branch weights. This annotation is added to branches</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//      to indicate the weights of each edge coming out of the branch.</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//      The weight of each edge is the weight of the target block for</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//      that edge. The weight of a block B is computed as the maximum</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//      number of samples found in B.</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   25</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;sample-profile&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseMap_8h.html">llvm/ADT/DenseMap.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="OwningPtr_8h.html">llvm/ADT/OwningPtr.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="StringMap_8h.html">llvm/ADT/StringMap.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="StringRef_8h.html">llvm/ADT/StringRef.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DIContext_8h.html">llvm/DebugInfo/DIContext.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Function_8h.html">llvm/IR/Function.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LLVMContext_8h.html">llvm/IR/LLVMContext.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Metadata_8h.html">llvm/IR/Metadata.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MDBuilder_8h.html">llvm/IR/MDBuilder.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Module_8h.html">llvm/IR/Module.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Pass_8h.html">llvm/Pass.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstIterator_8h.html">llvm/Support/InstIterator.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MemoryBuffer_8h.html">llvm/Support/MemoryBuffer.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Regex_8h.html">llvm/Support/Regex.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Transforms_2Scalar_8h.html">llvm/Transforms/Scalar.h</a>&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">// Command line option to specify the file to read samples from. This is</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">// mainly used for debugging.</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;std::string&gt;</a> <a class="code" href="SampleProfile_8cpp.html#a81a818f8443ab817926fe1ef54fb8a4b">SampleProfileFile</a>(</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="stringliteral">&quot;sample-profile-file&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="stringliteral">&quot;&quot;</span>), <a class="code" href="structllvm_1_1cl_1_1value__desc.html">cl::value_desc</a>(<span class="stringliteral">&quot;filename&quot;</span>),</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Profile file loaded by -sample-profile&quot;</span>), <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">/// \brief Sample-based profile reader.</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">/// Each profile contains sample counts for all the functions</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">/// executed. Inside each function, statements are annotated with the</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">/// collected samples on all the instructions associated with that</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">/// statement.</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">/// For this to produce meaningful data, the program needs to be</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">/// compiled with some debug information (at minimum, line numbers:</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">/// -gline-tables-only). Otherwise, it will be impossible to match IR</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">/// instructions to the line numbers collected by the profiler.</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">/// From the profile file, we are interested in collecting the</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">/// following information:</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">/// * A list of functions included in the profile (mangled names).</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">/// * For each function F:</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">///   1. The total number of samples collected in F.</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">///   2. The samples collected at each line in F. To provide some</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">///      protection against source code shuffling, line numbers should</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">///      be relative to the start of the function.</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"></span><span class="keyword">class </span>SampleProfile {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  SampleProfile(<a class="code" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>) : Profiles(0), Filename(F) {}</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>();</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordtype">void</span> loadText();</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordtype">void</span> loadNative() { <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;not implemented&quot;</span>); }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordtype">bool</span> emitAnnotations(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordtype">void</span> printFunctionProfile(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS, <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> FName);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordtype">void</span> dumpFunctionProfile(<a class="code" href="classllvm_1_1StringRef.html">StringRef</a> FName);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="keyword">protected</span>:</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;uint32_t, uint32_t&gt;</a> BodySampleMap;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;BasicBlock *, uint32_t&gt;</a> BlockWeightMap;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">  /// \brief Representation of the runtime profile for a function.</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">  /// This data structure contains the runtime profile for a given</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">  /// function. It contains the total number of samples collected</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">  /// in the function and a map of samples collected in every statement.</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span>FunctionProfile {<span class="comment"></span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">    /// \brief Total number of samples collected inside this function.</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">    ///</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">    /// Samples are cumulative, they include all the samples collected</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">    /// inside this function and all its inlined callees.</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> TotalSamples;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">// \brief Total number of samples collected at the head of the function.</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordtype">unsigned</span> TotalHeadSamples;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">    /// \brief Map line offsets to collected samples.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">    ///</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">    /// Each entry in this map contains the number of samples</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">    /// collected at the corresponding line offset. All line locations</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">    /// are an offset from the start of the function.</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"></span>    BodySampleMap BodySamples;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">    /// \brief Map basic blocks to their computed weights.</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">    ///</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">    /// The weight of a basic block is defined to be the maximum</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">    /// of all the instruction weights in that block.</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment"></span>    BlockWeightMap BlockWeights;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  };</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  uint32_t getInstWeight(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="keywordtype">unsigned</span> FirstLineno,</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                         BodySampleMap &amp;BodySamples);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  uint32_t computeBlockWeight(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a>, <span class="keywordtype">unsigned</span> FirstLineno,</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                              BodySampleMap &amp;BodySamples);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">  /// \brief Map every function to its associated profile.</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">  /// The profile of every function executed at runtime is collected</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">  /// in the structure FunctionProfile. This maps function objects</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">  /// to their corresponding profiles.</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1StringMap.html">StringMap&lt;FunctionProfile&gt;</a> Profiles;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">  /// \brief Path name to the file holding the profile data.</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">  /// The format of this file is defined by each profiler</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">  /// independently. If possible, the profiler should have a text</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">  /// version of the profile format to be used in constructing test</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">  /// cases and debugging.</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> Filename;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;};</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">/// \brief Loader class for text-based profiles.</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">/// This class defines a simple interface to read text files containing</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">/// profiles. It keeps track of line number information and location of</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">/// the file pointer. Users of this class are responsible for actually</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">/// parsing the lines returned by the readLine function.</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">/// TODO - This does not really belong here. It is a generic text file</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">/// reader. It should be moved to the Support library and made more general.</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment"></span><span class="keyword">class </span>ExternalProfileTextLoader {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  ExternalProfileTextLoader(<a class="code" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>) : Filename(F) {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <a class="code" href="classllvm_1_1error__code.html">error_code</a> EC;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    EC = <a class="code" href="classllvm_1_1MemoryBuffer.html#ae49a1bd18dafda3afdeffd226572fb5a">MemoryBuffer::getFile</a>(Filename, Buffer);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span> (EC)</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <a class="code" href="namespacellvm.html#a1f6978055dbb761b380de39070e34bd3">report_fatal_error</a>(<span class="stringliteral">&quot;Could not open profile file &quot;</span> + Filename + <span class="stringliteral">&quot;: &quot;</span> +</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                         EC.<a class="code" href="classllvm_1_1error__code.html#ace3c84d83642b8e2c421f45e59187c64">message</a>());</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    FP = Buffer-&gt;getBufferStart();</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    Lineno = 0;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  }</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">  /// \brief Read a line from the mapped file.</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> readLine() {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordtype">size_t</span> Length = 0;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *start = FP;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">while</span> (FP != Buffer-&gt;getBufferEnd() &amp;&amp; *FP != <span class="charliteral">&#39;\n&#39;</span>) {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      Length++;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      FP++;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">if</span> (FP != Buffer-&gt;getBufferEnd())</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      FP++;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    Lineno++;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1StringRef.html">StringRef</a>(start, Length);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">  /// \brief Return true, if we&#39;ve reached EOF.</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> atEOF()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> FP == Buffer-&gt;getBufferEnd(); }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">  /// \brief Report a parse error message and stop compilation.</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> reportParseError(<a class="code" href="classllvm_1_1Twine.html">Twine</a> Msg)<span class="keyword"> const </span>{</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <a class="code" href="namespacellvm.html#a1f6978055dbb761b380de39070e34bd3">report_fatal_error</a>(Filename + <span class="stringliteral">&quot;:&quot;</span> + <a class="code" href="classllvm_1_1Twine.html">Twine</a>(Lineno) + <span class="stringliteral">&quot;: &quot;</span> + Msg + <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="keyword">private</span>:<span class="comment"></span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">  /// \brief Memory buffer holding the text file.</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1OwningPtr.html">OwningPtr&lt;MemoryBuffer&gt;</a> Buffer;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">  /// \brief Current position into the memory buffer.</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment"></span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *FP;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">  /// \brief Current line number.</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment"></span>  int64_t Lineno;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">  /// \brief Path name where to the profile file.</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> Filename;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;};</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">/// \brief Sample profile pass.</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">/// This pass reads profile data from the file specified by</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">/// -sample-profile-file and annotates every affected function with the</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">/// profile information found in that file.</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment"></span><span class="keyword">class </span>SampleProfileLoader : <span class="keyword">public</span> <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="comment">// Class identification, replacement for typeinfo</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a>;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  SampleProfileLoader(<a class="code" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code" href="namespacellvm_1_1GraphProgram.html#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a> = <a class="code" href="SampleProfile_8cpp.html#a81a818f8443ab817926fe1ef54fb8a4b">SampleProfileFile</a>)</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      : <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a>(ID), Profiler(0), Filename(<a class="code" href="namespacellvm_1_1GraphProgram.html#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a>) {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="namespacellvm.html#a8a9705c2e0951237b35c25b53069c4e3">initializeSampleProfileLoaderPass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> doInitialization(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">dump</a>() { Profiler-&gt;dump(); }</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keyword">virtual</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *getPassName()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;Sample profile pass&quot;</span>; }</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> runOnFunction(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const </span>{</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#af11a6ebf7ab3c388234cb6d5378439a3">setPreservesCFG</a>();</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="keyword">protected</span>:<span class="comment"></span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">  /// \brief Profile reader object.</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1OwningPtr.html">OwningPtr&lt;SampleProfile&gt;</a> Profiler;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">  /// \brief Name of the profile file to load.</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> Filename;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;};</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;}</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">/// \brief Print the function profile for \p FName on stream \p OS.</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">/// \param OS Stream to emit the output to.</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">/// \param FName Name of the function to print.</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> SampleProfile::printFunctionProfile(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS, <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> FName) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  FunctionProfile FProfile = Profiles[FName];</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  OS &lt;&lt; <span class="stringliteral">&quot;Function: &quot;</span> &lt;&lt; FName &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; FProfile.TotalSamples &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;     &lt;&lt; FProfile.TotalHeadSamples &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; FProfile.BodySamples.size()</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; sampled lines\n&quot;</span>;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordflow">for</span> (BodySampleMap::const_iterator SI = FProfile.BodySamples.begin(),</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                                     SE = FProfile.BodySamples.end();</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;       SI != SE; ++SI)</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    OS &lt;&lt; <span class="stringliteral">&quot;\tline offset: &quot;</span> &lt;&lt; SI-&gt;first</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;, number of samples: &quot;</span> &lt;&lt; SI-&gt;second &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  OS &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;}</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">/// \brief Dump the function profile for \p FName.</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">/// \param FName Name of the function to print.</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> SampleProfile::dumpFunctionProfile(<a class="code" href="classllvm_1_1StringRef.html">StringRef</a> FName) {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  printFunctionProfile(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), FName);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;}</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">/// \brief Dump all the function profiles found.</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a03503773241005f01b090b9862aad304">SampleProfile::dump</a>() {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1StringMapConstIterator.html">StringMap&lt;FunctionProfile&gt;::const_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Profiles.begin(),</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                                                  E = Profiles.end();</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    dumpFunctionProfile(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getKey());</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;}</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">/// \brief Load samples from a text file.</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">/// The file is divided in two segments:</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">/// Symbol table (represented with the string &quot;symbol table&quot;)</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">///    Number of symbols in the table</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">///    symbol 1</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">///    symbol 2</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">///    ...</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">///    symbol N</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">/// Function body profiles</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">///    function1:total_samples:total_head_samples:number_of_locations</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">///    location_offset_1: number_of_samples</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">///    location_offset_2: number_of_samples</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">///    ...</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">///    location_offset_N: number_of_samples</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">/// Function names must be mangled in order for the profile loader to</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">/// match them in the current translation unit.</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">/// Since this is a flat profile, a function that shows up more than</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">/// once gets all its samples aggregated across all its instances.</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">/// TODO - flat profiles are too imprecise to provide good optimization</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">/// opportunities. Convert them to context-sensitive profile.</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">/// This textual representation is useful to generate unit tests and</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">/// for debugging purposes, but it should not be used to generate</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">/// profiles for large programs, as the representation is extremely</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">/// inefficient.</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> SampleProfile::loadText() {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  ExternalProfileTextLoader Loader(Filename);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="comment">// Read the symbol table.</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> Line = Loader.readLine();</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">if</span> (Line != <span class="stringliteral">&quot;symbol table&quot;</span>)</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    Loader.reportParseError(<span class="stringliteral">&quot;Expected &#39;symbol table&#39;, found &quot;</span> + Line);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordtype">int</span> NumSymbols;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  Line = Loader.readLine();</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keywordflow">if</span> (Line.<a class="code" href="classllvm_1_1StringRef.html#adabdc95b17da88a726555e8718151ac8">getAsInteger</a>(10, NumSymbols))</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    Loader.reportParseError(<span class="stringliteral">&quot;Expected a number, found &quot;</span> + Line);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumSymbols; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> FName = Loader.readLine();</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    FunctionProfile &amp;FProfile = Profiles[FName];</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    FProfile.BodySamples.clear();</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    FProfile.TotalSamples = 0;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    FProfile.TotalHeadSamples = 0;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="comment">// Read the profile of each function. Since each function may be</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="comment">// mentioned more than once, and we are collecting flat profiles,</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="comment">// accumulate samples as we parse them.</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <a class="code" href="classllvm_1_1Regex.html">Regex</a> HeadRE(<span class="stringliteral">&quot;^([^:]+):([0-9]+):([0-9]+):([0-9]+)$&quot;</span>);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <a class="code" href="classllvm_1_1Regex.html">Regex</a> LineSample(<span class="stringliteral">&quot;^([0-9]+): ([0-9]+)$&quot;</span>);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keywordflow">while</span> (!Loader.atEOF()) {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;StringRef, 4&gt;</a> Matches;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    Line = Loader.readLine();</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">if</span> (!HeadRE.match(Line, &amp;Matches))</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      Loader.reportParseError(<span class="stringliteral">&quot;Expected &#39;mangled_name:NUM:NUM:NUM&#39;, found &quot;</span> +</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                              Line);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    assert(Matches.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 5);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> FName = Matches[1];</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordtype">unsigned</span> NumSamples, NumHeadSamples, NumSampledLines;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    Matches[2].getAsInteger(10, NumSamples);</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    Matches[3].getAsInteger(10, NumHeadSamples);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    Matches[4].getAsInteger(10, NumSampledLines);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    FunctionProfile &amp;FProfile = Profiles[FName];</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    FProfile.TotalSamples += NumSamples;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    FProfile.TotalHeadSamples += NumHeadSamples;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    BodySampleMap &amp;SampleMap = FProfile.BodySamples;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">for</span> (I = 0; I &lt; NumSampledLines &amp;&amp; !Loader.atEOF(); I++) {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      Line = Loader.readLine();</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="keywordflow">if</span> (!LineSample.match(Line, &amp;Matches))</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        Loader.reportParseError(<span class="stringliteral">&quot;Expected &#39;NUM: NUM&#39;, found &quot;</span> + Line);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      assert(Matches.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 3);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keywordtype">unsigned</span> LineOffset, NumSamples;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      Matches[1].getAsInteger(10, LineOffset);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      Matches[2].getAsInteger(10, NumSamples);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      SampleMap[LineOffset] += NumSamples;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    }</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">if</span> (I &lt; NumSampledLines)</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      Loader.reportParseError(<span class="stringliteral">&quot;Unexpected end of file&quot;</span>);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  }</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;}</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">/// \brief Get the weight for an instruction.</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">/// The &quot;weight&quot; of an instruction \p Inst is the number of samples</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">/// collected on that instruction at runtime. To retrieve it, we</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">/// need to compute the line number of \p Inst relative to the start of its</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">/// function. We use \p FirstLineno to compute the offset. We then</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">/// look up the samples collected for \p Inst using \p BodySamples.</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">/// \param Inst Instruction to query.</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">/// \param FirstLineno Line number of the first instruction in the function.</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">/// \param BodySamples Map of relative source line locations to samples.</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">/// \returns The profiled weight of I.</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment"></span>uint32_t SampleProfile::getInstWeight(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;Inst, <span class="keywordtype">unsigned</span> FirstLineno,</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                                      BodySampleMap &amp;BodySamples) {</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordtype">unsigned</span> LOffset = Inst.<a class="code" href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">getDebugLoc</a>().<a class="code" href="classllvm_1_1DebugLoc.html#ace5b91e09e7b0aa7d88a500993a7502c">getLine</a>() - FirstLineno + 1;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">return</span> BodySamples.lookup(LOffset);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;}</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">/// \brief Compute the weight of a basic block.</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">/// The weight of basic block \p B is the maximum weight of all the</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">/// instructions in B.</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">/// \param B The basic block to query.</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">/// \param FirstLineno The line number for the first line in the</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">///     function holding B.</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">/// \param BodySamples The map containing all the samples collected in that</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">///     function.</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">/// \returns The computed weight of B.</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment"></span>uint32_t SampleProfile::computeBlockWeight(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a>, <span class="keywordtype">unsigned</span> FirstLineno,</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                                           BodySampleMap &amp;BodySamples) {</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="comment">// If we&#39;ve computed B&#39;s weight before, return it.</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *F = B-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>();</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  FunctionProfile &amp;FProfile = Profiles[F-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()];</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  std::pair&lt;BlockWeightMap::iterator, bool&gt; Entry =</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      FProfile.BlockWeights.insert(std::make_pair(B, 0));</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordflow">if</span> (!Entry.second)</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">return</span> Entry.first-&gt;second;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="comment">// Otherwise, compute and cache B&#39;s weight.</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  uint32_t Weight = 0;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> I = B-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), E = B-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    uint32_t InstWeight = getInstWeight(*I, FirstLineno, BodySamples);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">if</span> (InstWeight &gt; Weight)</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      Weight = InstWeight;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  }</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  Entry.first-&gt;second = Weight;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="keywordflow">return</span> Weight;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;}</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">/// \brief Generate branch weight metadata for all branches in \p F.</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">/// For every branch instruction B in \p F, we compute the weight of the</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">/// target block for each of the edges out of B. This is the weight</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">/// that we associate with that branch.</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">/// TODO - This weight assignment will most likely be wrong if the</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">/// target branch has more than two predecessors. This needs to be done</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">/// using some form of flow propagation.</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">/// Once all the branch weights are computed, we emit the MD_prof</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">/// metadata on B using the computed values.</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">/// \param F The function to query.</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> SampleProfile::emitAnnotations(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F) {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  FunctionProfile &amp;FProfile = Profiles[F.<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()];</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="keywordtype">unsigned</span> FirstLineno = <a class="code" href="namespacellvm.html#a49a219f3fe3d7a6cc07c49a1ea766d6d">inst_begin</a>(F)-&gt;getDebugLoc().getLine();</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a> MDB(F.<a class="code" href="classllvm_1_1Function.html#a2da53ac53516a3f16191f4c8a8eaa3e5">getContext</a>());</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="comment">// Clear the block weights cache.</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  FProfile.BlockWeights.clear();</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="comment">// When we find a branch instruction: For each edge E out of the branch,</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="comment">// the weight of E is the weight of the target block.</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Function::iterator</a> I = F.<a class="code" href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">begin</a>(), E = F.<a class="code" href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *B = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *TI = B-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>();</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">if</span> (TI-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a4c26d3b92af99a6c8defd89a2d39ca32">getNumSuccessors</a>() == 1)</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;BranchInst&gt;(TI) &amp;&amp; !isa&lt;SwitchInst&gt;(TI))</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint32_t, 4&gt;</a> Weights;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordtype">unsigned</span> NSuccs = TI-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a4c26d3b92af99a6c8defd89a2d39ca32">getNumSuccessors</a>();</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> I = 0; I &lt; NSuccs; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ = TI-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a3aac3b6c36415a2b08f65ead9e3e51e7">getSuccessor</a>(I);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      uint32_t Weight =</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;          computeBlockWeight(Succ, FirstLineno, FProfile.BodySamples);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Weight);</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    }</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">llvm::LLVMContext::MD_prof</a>,</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                    MDB.createBranchWeights(Weights));</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  }</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;}</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">SampleProfileLoader::ID</a> = 0;</div><div class="line"><a name="l00460"></a><span class="lineno"><a class="line" href="SampleProfile_8cpp.html#aef52f1a30a8bd8b4c9dc35d2ddf9acbc">  460</a></span>&#160;<a class="code" href="SampleProfile_8cpp.html#aef52f1a30a8bd8b4c9dc35d2ddf9acbc">INITIALIZE_PASS</a>(SampleProfileLoader, <span class="stringliteral">&quot;sample-profile&quot;</span>, <span class="stringliteral">&quot;Sample Profile loader&quot;</span>,</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                <span class="keyword">false</span>, <span class="keyword">false</span>)</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;bool SampleProfileLoader::runOnFunction(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keywordflow">return</span> Profiler-&gt;emitAnnotations(F);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;}</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="keywordtype">bool</span> SampleProfileLoader::doInitialization(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>) {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  Profiler.reset(<span class="keyword">new</span> SampleProfile(Filename));</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  Profiler-&gt;loadText();</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;}</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno"><a class="line" href="namespacellvm.html#a604371f61ac8e5043eef727f49ba6a28">  473</a></span>&#160;<a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> *<a class="code" href="namespacellvm.html#a604371f61ac8e5043eef727f49ba6a28">llvm::createSampleProfileLoaderPass</a>() {</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> SampleProfileLoader(<a class="code" href="SampleProfile_8cpp.html#a81a818f8443ab817926fe1ef54fb8a4b">SampleProfileFile</a>);</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;}</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno"><a class="line" href="namespacellvm.html#a9f27c12ea3bc9b8121c06900ecb5bcc3">  477</a></span>&#160;<a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> *<a class="code" href="namespacellvm.html#a604371f61ac8e5043eef727f49ba6a28">llvm::createSampleProfileLoaderPass</a>(<a class="code" href="classllvm_1_1StringRef.html">StringRef</a> <a class="code" href="namespacellvm_1_1GraphProgram.html#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a>) {</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> SampleProfileLoader(Name);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;}</div><div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a22a311dfe4c28a897de8a9365a4f0a84"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">llvm::SmallVectorTemplateCommon&lt; T &gt;::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00127">SmallVector.h:127</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_ae1a10b90f22c0478960fb5798ff73916"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">llvm::SmallVectorTemplateBase&lt; T, isPodLike&lt; T &gt;::value &gt;::push_back</a></div><div class="ttdeci">void push_back(const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00236">SmallVector.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00035">PassRegistry.cpp:35</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a2da53ac53516a3f16191f4c8a8eaa3e5"><div class="ttname"><a href="classllvm_1_1Function.html#a2da53ac53516a3f16191f4c8a8eaa3e5">llvm::Function::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00167">Function.cpp:167</a></div></div>
<div class="ttc" id="SampleProfile_8cpp_html_aef52f1a30a8bd8b4c9dc35d2ddf9acbc"><div class="ttname"><a href="SampleProfile_8cpp.html#aef52f1a30a8bd8b4c9dc35d2ddf9acbc">INITIALIZE_PASS</a></div><div class="ttdeci">INITIALIZE_PASS(SampleProfileLoader,&quot;sample-profile&quot;,&quot;Sample Profile loader&quot;, false, false) bool SampleProfileLoader</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfile_8cpp_source.html#l00460">SampleProfile.cpp:460</a></div></div>
<div class="ttc" id="Instructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="namespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">List of target independent CodeGen pass IDs. </div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l00022">APFloat.h:22</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html"><div class="ttname"><a href="classllvm_1_1Module.html">llvm::Module</a></div><div class="ttdoc">The main container class for the LLVM Intermediate Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00112">Module.h:112</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_ae4ca2261b8b901e415fda7feac5051ea"><div class="ttname"><a href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">llvm::Function::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00397">Function.h:397</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00534">DenseMap.h:534</a></div></div>
<div class="ttc" id="Debug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="Metadata_8h_html"><div class="ttname"><a href="Metadata_8h.html">Metadata.h</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_aca229503e4f5c83a187a6a921c625fa8"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">llvm::BasicBlock::getParent</a></div><div class="ttdeci">const Function * getParent() const </div><div class="ttdoc">Return the enclosing method, or null if none. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00116">BasicBlock.h:116</a></div></div>
<div class="ttc" id="LLParser_8cpp_html_a33ece1ef8074506a15d7f86eb76dbae6"><div class="ttname"><a href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a></div><div class="ttdeci">F(f)</div></div>
<div class="ttc" id="classllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00070">Function.h:70</a></div></div>
<div class="ttc" id="namespacellvm_1_1cl_html_a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6"><div class="ttname"><a href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">llvm::cl::Hidden</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00109">CommandLine.h:109</a></div></div>
<div class="ttc" id="namespacellvm_html_a1f6978055dbb761b380de39070e34bd3"><div class="ttname"><a href="namespacellvm.html#a1f6978055dbb761b380de39070e34bd3">llvm::report_fatal_error</a></div><div class="ttdeci">LLVM_ATTRIBUTE_NORETURN void report_fatal_error(const char *reason, bool gen_crash_diag=true)</div><div class="ttdef"><b>Definition:</b> <a href="ErrorHandling_8cpp_source.html#l00053">ErrorHandling.cpp:53</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad452febc1ac0b394876e640ec03ffa38"><div class="ttname"><a href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00167">Value.cpp:167</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0ed5f3ab3c2e4196ee0cffffa080c062"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">llvm::BasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00193">BasicBlock.h:193</a></div></div>
<div class="ttc" id="classllvm_1_1Regex_html"><div class="ttname"><a href="classllvm_1_1Regex.html">llvm::Regex</a></div><div class="ttdef"><b>Definition:</b> <a href="Regex_8h_source.html#l00028">Regex.h:28</a></div></div>
<div class="ttc" id="namespacellvm_1_1GraphProgram_html_a0ad4685976f8c4d4a697a53fbe05d10b"><div class="ttname"><a href="namespacellvm_1_1GraphProgram.html#a0ad4685976f8c4d4a697a53fbe05d10b">llvm::GraphProgram::Name</a></div><div class="ttdeci">Name</div><div class="ttdef"><b>Definition:</b> <a href="GraphWriter_8h_source.html#l00044">GraphWriter.h:44</a></div></div>
<div class="ttc" id="namespacellvm_html_a49a219f3fe3d7a6cc07c49a1ea766d6d"><div class="ttname"><a href="namespacellvm.html#a49a219f3fe3d7a6cc07c49a1ea766d6d">llvm::inst_begin</a></div><div class="ttdeci">inst_iterator inst_begin(Function *F)</div><div class="ttdef"><b>Definition:</b> <a href="InstIterator_8h_source.html#l00128">InstIterator.h:128</a></div></div>
<div class="ttc" id="classllvm_1_1Twine_html"><div class="ttname"><a href="classllvm_1_1Twine.html">llvm::Twine</a></div><div class="ttdef"><b>Definition:</b> <a href="Twine_8h_source.html#l00081">Twine.h:81</a></div></div>
<div class="ttc" id="ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdef"><b>Definition:</b> <a href="ErrorHandling_8h_source.html#l00103">ErrorHandling.h:103</a></div></div>
<div class="ttc" id="structllvm_1_1cl_1_1value__desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1value__desc.html">llvm::cl::value_desc</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00294">CommandLine.h:294</a></div></div>
<div class="ttc" id="classllvm_1_1DebugLoc_html_ace5b91e09e7b0aa7d88a500993a7502c"><div class="ttname"><a href="classllvm_1_1DebugLoc.html#ace5b91e09e7b0aa7d88a500993a7502c">llvm::DebugLoc::getLine</a></div><div class="ttdeci">unsigned getLine() const </div><div class="ttdef"><b>Definition:</b> <a href="DebugLoc_8h_source.html#l00072">DebugLoc.h:72</a></div></div>
<div class="ttc" id="namespacellvm_1_1CallingConv_html_a4f861731fc6dbfdccc05af5968d98974"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">llvm::CallingConv::ID</a></div><div class="ttdeci">ID</div><div class="ttdoc">LLVM Calling Convention Representation. </div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00026">CallingConv.h:26</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00031">Instruction.h:31</a></div></div>
<div class="ttc" id="SampleProfile_8cpp_html_a81a818f8443ab817926fe1ef54fb8a4b"><div class="ttname"><a href="SampleProfile_8cpp.html#a81a818f8443ab817926fe1ef54fb8a4b">SampleProfileFile</a></div><div class="ttdeci">static cl::opt&lt; std::string &gt; SampleProfileFile(&quot;sample-profile-file&quot;, cl::init(&quot;&quot;), cl::value_desc(&quot;filename&quot;), cl::desc(&quot;Profile file loaded by -sample-profile&quot;), cl::Hidden)</div></div>
<div class="ttc" id="classllvm_1_1LLVMContext_html_a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8"><div class="ttname"><a href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">llvm::LLVMContext::MD_prof</a></div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00048">LLVMContext.h:48</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a88a5e60837674780a9d812d661897ac5"><div class="ttname"><a href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">llvm::Function::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00395">Function.h:395</a></div></div>
<div class="ttc" id="classllvm_1_1TerminatorInst_html_a4c26d3b92af99a6c8defd89a2d39ca32"><div class="ttname"><a href="classllvm_1_1TerminatorInst.html#a4c26d3b92af99a6c8defd89a2d39ca32">llvm::TerminatorInst::getNumSuccessors</a></div><div class="ttdeci">unsigned getNumSuccessors() const </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00059">InstrTypes.h:59</a></div></div>
<div class="ttc" id="DIContext_8h_html"><div class="ttname"><a href="DIContext_8h.html">DIContext.h</a></div></div>
<div class="ttc" id="CommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1cl_html_a10a041239ae1870cfcc064bfaa79fb65"><div class="ttname"><a href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00314">CommandLine.h:314</a></div></div>
<div class="ttc" id="namespacellvm_html_a03503773241005f01b090b9862aad304"><div class="ttname"><a href="namespacellvm.html#a03503773241005f01b090b9862aad304">llvm::dump</a></div><div class="ttdeci">void dump(const SparseBitVector&lt; ElementSize &gt; &amp;LHS, raw_ostream &amp;out)</div><div class="ttdef"><b>Definition:</b> <a href="SparseBitVector_8h_source.html#l00882">SparseBitVector.h:882</a></div></div>
<div class="ttc" id="classllvm_1_1TerminatorInst_html"><div class="ttname"><a href="classllvm_1_1TerminatorInst.html">llvm::TerminatorInst</a></div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00035">InstrTypes.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00072">BasicBlock.h:72</a></div></div>
<div class="ttc" id="classllvm_1_1TerminatorInst_html_a3aac3b6c36415a2b08f65ead9e3e51e7"><div class="ttname"><a href="classllvm_1_1TerminatorInst.html#a3aac3b6c36415a2b08f65ead9e3e51e7">llvm::TerminatorInst::getSuccessor</a></div><div class="ttdeci">BasicBlock * getSuccessor(unsigned idx) const </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00065">InstrTypes.h:65</a></div></div>
<div class="ttc" id="Constants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="structllvm_1_1cl_1_1desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1desc.html">llvm::cl::desc</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00286">CommandLine.h:286</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_aab8e16a35183ce39aad394714087bcff"><div class="ttname"><a href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">llvm::Instruction::getDebugLoc</a></div><div class="ttdeci">const DebugLoc &amp; getDebugLoc() const </div><div class="ttdoc">getDebugLoc - Return the debug location for this node as a DebugLoc. </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00178">Instruction.h:178</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00037">PassAnalysisSupport.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1error__code_html"><div class="ttname"><a href="classllvm_1_1error__code.html">llvm::error_code</a></div><div class="ttdef"><b>Definition:</b> <a href="system__error_8h_source.html#l00726">system_error.h:726</a></div></div>
<div class="ttc" id="classllvm_1_1OwningPtr_html"><div class="ttname"><a href="classllvm_1_1OwningPtr.html">llvm::OwningPtr</a></div><div class="ttdef"><b>Definition:</b> <a href="OwningPtr_8h_source.html#l00028">OwningPtr.h:28</a></div></div>
<div class="ttc" id="Regex_8h_html"><div class="ttname"><a href="Regex_8h.html">Regex.h</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionPass_html"><div class="ttname"><a href="classllvm_1_1FunctionPass.html">llvm::FunctionPass</a></div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00293">Pass.h:293</a></div></div>
<div class="ttc" id="StringMap_8h_html"><div class="ttname"><a href="StringMap_8h.html">StringMap.h</a></div></div>
<div class="ttc" id="classllvm_1_1StringMapConstIterator_html"><div class="ttname"><a href="classllvm_1_1StringMapConstIterator.html">llvm::StringMapConstIterator</a></div><div class="ttdef"><b>Definition:</b> <a href="StringMap_8h_source.html#l00023">StringMap.h:23</a></div></div>
<div class="ttc" id="InstIterator_8h_html"><div class="ttname"><a href="InstIterator_8h.html">InstIterator.h</a></div></div>
<div class="ttc" id="DenseMap_8h_html"><div class="ttname"><a href="DenseMap_8h.html">DenseMap.h</a></div></div>
<div class="ttc" id="classllvm_1_1StringRef_html_adabdc95b17da88a726555e8718151ac8"><div class="ttname"><a href="classllvm_1_1StringRef.html#adabdc95b17da88a726555e8718151ac8">llvm::StringRef::getAsInteger</a></div><div class="ttdeci">enable_if_c&lt; std::numeric_limits&lt; T &gt;::is_signed, bool &gt;::type getAsInteger(unsigned Radix, T &amp;Result) const </div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00337">StringRef.h:337</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a9247a212ea89acc9573fa7e7f557eaba"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">llvm::Instruction::setMetadata</a></div><div class="ttdeci">void setMetadata(unsigned KindID, MDNode *Node)</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l00589">Metadata.cpp:589</a></div></div>
<div class="ttc" id="classllvm_1_1MemoryBuffer_html_ae49a1bd18dafda3afdeffd226572fb5a"><div class="ttname"><a href="classllvm_1_1MemoryBuffer.html#ae49a1bd18dafda3afdeffd226572fb5a">llvm::MemoryBuffer::getFile</a></div><div class="ttdeci">static error_code getFile(Twine Filename, OwningPtr&lt; MemoryBuffer &gt; &amp;result, int64_t FileSize=-1, bool RequiresNullTerminator=true)</div><div class="ttdef"><b>Definition:</b> <a href="MemoryBuffer_8cpp_source.html#l00245">MemoryBuffer.cpp:245</a></div></div>
<div class="ttc" id="classllvm_1_1ilist__iterator_html"><div class="ttname"><a href="classllvm_1_1ilist__iterator.html">llvm::ilist_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00050">ilist.h:50</a></div></div>
<div class="ttc" id="StringRef_8h_html"><div class="ttname"><a href="StringRef_8h.html">StringRef.h</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0b4e7bee9b8575cc7db73329f1a561bd"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">llvm::BasicBlock::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00195">BasicBlock.h:195</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00880">SmallVector.h:880</a></div></div>
<div class="ttc" id="Module_8h_html"><div class="ttname"><a href="Module_8h.html">Module.h</a></div></div>
<div class="ttc" id="MDBuilder_8h_html"><div class="ttname"><a href="MDBuilder_8h.html">MDBuilder.h</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html_af11a6ebf7ab3c388234cb6d5378439a3"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#af11a6ebf7ab3c388234cb6d5378439a3">llvm::AnalysisUsage::setPreservesCFG</a></div><div class="ttdeci">void setPreservesCFG()</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8cpp_source.html#l00249">Pass.cpp:249</a></div></div>
<div class="ttc" id="namespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs - Return a circular-buffered debug stream. </div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00101">Debug.cpp:101</a></div></div>
<div class="ttc" id="classllvm_1_1StringMap_html"><div class="ttname"><a href="classllvm_1_1StringMap.html">llvm::StringMap</a></div><div class="ttdef"><b>Definition:</b> <a href="StringMap_8h_source.html#l00236">StringMap.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1error__code_html_ace3c84d83642b8e2c421f45e59187c64"><div class="ttname"><a href="classllvm_1_1error__code.html#ace3c84d83642b8e2c421f45e59187c64">llvm::error_code::message</a></div><div class="ttdeci">std::string message() const </div><div class="ttdef"><b>Definition:</b> <a href="system__error_8cpp_source.html#l00118">system_error.cpp:118</a></div></div>
<div class="ttc" id="Pass_8h_html"><div class="ttname"><a href="Pass_8h.html">Pass.h</a></div></div>
<div class="ttc" id="Function_8h_html"><div class="ttname"><a href="Function_8h.html">Function.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a604371f61ac8e5043eef727f49ba6a28"><div class="ttname"><a href="namespacellvm.html#a604371f61ac8e5043eef727f49ba6a28">llvm::createSampleProfileLoaderPass</a></div><div class="ttdeci">FunctionPass * createSampleProfileLoaderPass()</div><div class="ttdef"><b>Definition:</b> <a href="SampleProfile_8cpp_source.html#l00473">SampleProfile.cpp:473</a></div></div>
<div class="ttc" id="Transforms_2Scalar_8h_html"><div class="ttname"><a href="Transforms_2Scalar_8h.html">Scalar.h</a></div></div>
<div class="ttc" id="classllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l01149">CommandLine.h:1149</a></div></div>
<div class="ttc" id="MD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00054">MD5.cpp:54</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a5cb76a65b6524dba1493dd2b9dc3abbe"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">llvm::BasicBlock::getTerminator</a></div><div class="ttdeci">TerminatorInst * getTerminator()</div><div class="ttdoc">Returns the terminator instruction if the block is well formed or null if the block is not well forme...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00120">BasicBlock.cpp:120</a></div></div>
<div class="ttc" id="MemoryBuffer_8h_html"><div class="ttname"><a href="MemoryBuffer_8h.html">MemoryBuffer.h</a></div></div>
<div class="ttc" id="LLVMContext_8h_html"><div class="ttname"><a href="LLVMContext_8h.html">LLVMContext.h</a></div></div>
<div class="ttc" id="Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="Target_2X86_2README_8txt_source.html#l00297">Target/X86/README.txt:297</a></div></div>
<div class="ttc" id="classllvm_1_1raw__ostream_html"><div class="ttname"><a href="classllvm_1_1raw__ostream.html">llvm::raw_ostream</a></div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8h_source.html#l00031">raw_ostream.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1StringRef_html"><div class="ttname"><a href="classllvm_1_1StringRef.html">llvm::StringRef</a></div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00041">StringRef.h:41</a></div></div>
<div class="ttc" id="raw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="OwningPtr_8h_html"><div class="ttname"><a href="OwningPtr_8h.html">OwningPtr.h</a></div></div>
<div class="ttc" id="Target_2ARM_2README_8txt_html_a90cca76dd78688687e0d697679dbc799"><div class="ttname"><a href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional ldr LCPI1_0 ldr ldr tst movne lsr ldr LCPI1_1 and r0 bx lr it saves an instruction and a register It might be profitable to cse MOVi16 if there are lots of bit immediates with the same bottom half Robert Muth started working on an alternate jump table implementation that does not put the tables in line in the text This is more like the llvm default jump table implementation This might be useful sometime Several revisions of patches are on the mailing beginning while CMP sets them like a subtract Therefore to be able to use CMN for comparisons other than the Z we ll need additional logic to reverse the conditionals associated with the comparison Perhaps a pseudo instruction for the with a post codegen pass to clean up and handle the condition codes See PR5694 for testcase Given the following on int B</div><div class="ttdef"><b>Definition:</b> <a href="Target_2ARM_2README_8txt_source.html#l00592">Target/ARM/README.txt:592</a></div></div>
<div class="ttc" id="classllvm_1_1MDBuilder_html"><div class="ttname"><a href="classllvm_1_1MDBuilder.html">llvm::MDBuilder</a></div><div class="ttdef"><b>Definition:</b> <a href="MDBuilder_8h_source.html#l00027">MDBuilder.h:27</a></div></div>
<div class="ttc" id="namespacellvm_html_a8a9705c2e0951237b35c25b53069c4e3"><div class="ttname"><a href="namespacellvm.html#a8a9705c2e0951237b35c25b53069c4e3">llvm::initializeSampleProfileLoaderPass</a></div><div class="ttdeci">void initializeSampleProfileLoaderPass(PassRegistry &amp;)</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<p class="footer">
Generated on Sat Nov 10 2018 23:01:12 for <a href="http://llvm.org/">LLVM</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.8.11</a><br>
Copyright &copy; 2003-2013 University of Illinois at Urbana-Champaign.
All Rights Reserved.</p>
<hr>
<!--#include virtual="/attrib.incl" -->
</body>
</html>
