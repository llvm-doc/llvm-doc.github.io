<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="LLVM,Low Level Virtual Machine,C++,doxygen,API,documentation"/>
<meta name="description" content="C++ source code API documentation for LLVM."/>
<title>LLVM: SimplifyCFG.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">LLVM API Documentation</p>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('SimplifyCFG_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SimplifyCFG.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="SimplifyCFG_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- SimplifyCFG.cpp - Code to perform CFG simplification ---------------===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                     The LLVM Compiler Infrastructure</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is distributed under the University of Illinois Open Source</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License. See LICENSE.TXT for details.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// Peephole optimize the CFG.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   14</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;simplifycfg&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Local_8h.html">llvm/Transforms/Utils/Local.h</a>&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseMap_8h.html">llvm/ADT/DenseMap.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SetVector_8h.html">llvm/ADT/SetVector.h</a>&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallPtrSet_8h.html">llvm/ADT/SmallPtrSet.h</a>&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallVector_8h.html">llvm/ADT/SmallVector.h</a>&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ConstantFolding_8h.html">llvm/Analysis/ConstantFolding.h</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstructionSimplify_8h.html">llvm/Analysis/InstructionSimplify.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetTransformInfo_8h.html">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueTracking_8h.html">llvm/Analysis/ValueTracking.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DataLayout_8h.html">llvm/IR/DataLayout.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DerivedTypes_8h.html">llvm/IR/DerivedTypes.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GlobalVariable_8h.html">llvm/IR/GlobalVariable.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IRBuilder_8h.html">llvm/IR/IRBuilder.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IntrinsicInst_8h.html">llvm/IR/IntrinsicInst.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LLVMContext_8h.html">llvm/IR/LLVMContext.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MDBuilder_8h.html">llvm/IR/MDBuilder.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Metadata_8h.html">llvm/IR/Metadata.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Module_8h.html">llvm/IR/Module.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Operator_8h.html">llvm/IR/Operator.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Type_8h.html">llvm/IR/Type.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Support_2CFG_8h.html">llvm/Support/CFG.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ConstantRange_8h.html">llvm/Support/ConstantRange.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="NoFolder_8h.html">llvm/Support/NoFolder.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PatternMatch_8h.html">llvm/Support/PatternMatch.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BasicBlockUtils_8h.html">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &lt;set&gt;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">using namespace </span>PatternMatch;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;unsigned&gt;</a></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#a830a17648b2e5112beef220cc707c977">PHINodeFoldingThreshold</a>(<span class="stringliteral">&quot;phi-node-folding-threshold&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(1),</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;   <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Control the amount of phi node folding to perform (default = 1)&quot;</span>));</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#a0b13773c26dad640e24611c48c657463">DupRet</a>(<span class="stringliteral">&quot;simplifycfg-dup-ret&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;       <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Duplicate return instructions into unconditional branches&quot;</span>));</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#ac7707bcaec113d0d136467c7b97a62f1">SinkCommon</a>(<span class="stringliteral">&quot;simplifycfg-sink-common&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;       <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Sink common instructions down to the end block&quot;</span>));</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#a5d26d13ee0f270c3ad3cd25e7f798c89">HoistCondStores</a>(<span class="stringliteral">&quot;simplifycfg-hoist-cond-stores&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">true</span>),</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;       <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Hoist conditional stores if an unconditional store preceeds&quot;</span>));</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#a094edb4846824b6513167facc6a7afe1">STATISTIC</a>(NumBitMaps, <span class="stringliteral">&quot;Number of switch instructions turned into bitmaps&quot;</span>);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#a094edb4846824b6513167facc6a7afe1">STATISTIC</a>(NumLookupTables, <span class="stringliteral">&quot;Number of switch instructions turned into lookup tables&quot;</span>);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#a094edb4846824b6513167facc6a7afe1">STATISTIC</a>(NumSinkCommons, <span class="stringliteral">&quot;Number of common instructions sunk down to the end block&quot;</span>);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#a094edb4846824b6513167facc6a7afe1">STATISTIC</a>(NumSpeculations, <span class="stringliteral">&quot;Number of speculative executed instructions&quot;</span>);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">  /// ValueEqualityComparisonCase - Represents a case of a switch.</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span>ValueEqualityComparisonCase {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="classllvm_1_1Value.html">Value</a>;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Dest;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    ValueEqualityComparisonCase(<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Value, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Dest)</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      : Value(Value), Dest(Dest) {}</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a7c469a194119a14e5a018ebb9b847cf0">operator&lt;</a>(ValueEqualityComparisonCase RHS)<span class="keyword"> const </span>{</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      <span class="comment">// Comparing pointers is ok as we only rely on the order for uniquing.</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <span class="keywordflow">return</span> Value &lt; RHS.Value;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a162c90bc179a6359438d060722bee35f">operator==</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *RHSDest)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Dest == RHSDest; }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  };</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="keyword">class </span>SimplifyCFGOpt {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *<span class="keyword">const</span> TD;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *isValueEqualityComparison(<a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *TI);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *GetValueEqualityComparisonCases(<a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *TI,</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                               std::vector&lt;ValueEqualityComparisonCase&gt; &amp;Cases);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordtype">bool</span> SimplifyEqualityComparisonWithOnlyPredecessor(<a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *TI,</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                                                     <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred,</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                                                     <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder);</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordtype">bool</span> FoldValueComparisonIntoPredecessors(<a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *TI,</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                                           <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordtype">bool</span> SimplifyReturn(<a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *RI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordtype">bool</span> SimplifyResume(<a class="code" href="classllvm_1_1ResumeInst.html">ResumeInst</a> *RI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordtype">bool</span> SimplifyUnreachable(<a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a> *UI);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordtype">bool</span> SimplifySwitch(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordtype">bool</span> SimplifyIndirectBr(<a class="code" href="classllvm_1_1IndirectBrInst.html">IndirectBrInst</a> *IBI);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="keywordtype">bool</span> SimplifyUncondBranch(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder &lt;&gt;</a> &amp;Builder);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keywordtype">bool</span> SimplifyCondBranch(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder &lt;&gt;</a>&amp;Builder);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  SimplifyCFGOpt(<span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD)</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      : TTI(TTI), TD(TD) {}</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keywordtype">bool</span> run(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;};</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">/// SafeToMergeTerminators - Return true if it is safe to merge these two</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">/// terminator instructions together.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a02215e210f29948498aeb844022afe53">  121</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a02215e210f29948498aeb844022afe53">SafeToMergeTerminators</a>(<a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *SI1, <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *SI2) {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordflow">if</span> (SI1 == SI2) <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Can&#39;t merge with self!</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="comment">// It is not safe to merge these two switch instructions if they have a common</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">// successor, and if that successor has a PHI node, and if *that* PHI node has</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">// conflicting incoming values from the two switch blocks.</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SI1BB = SI1-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SI2BB = SI2-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock*, 16&gt;</a> SI1Succs(<a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(SI1BB), <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(SI1BB));</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SuccIterator.html">succ_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(SI2BB), E = <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(SI2BB); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">if</span> (SI1Succs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = (*I)-&gt;begin();</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;           isa&lt;PHINode&gt;(BBI); ++BBI) {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = cast&lt;PHINode&gt;(BBI);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="keywordflow">if</span> (PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(SI1BB) !=</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(SI2BB))</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;}</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">/// isProfitableToFoldUnconditional - Return true if it is safe and profitable</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">/// to merge these two terminator instructions together, where SI1 is an</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">/// unconditional branch. PhiNodes will store all PHI nodes in common</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">/// successors.</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a69987e50a47c1566fa22b3cfd696e7ea">  149</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a69987e50a47c1566fa22b3cfd696e7ea">isProfitableToFoldUnconditional</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *SI1,</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                                          <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *SI2,</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                                          <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Cond,</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                                          <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;PHINode*&gt;</a> &amp;PhiNodes) {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordflow">if</span> (SI1 == SI2) <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Can&#39;t merge with self!</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  assert(SI1-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a382131e712e55e8324fbd5068de17b78">isUnconditional</a>() &amp;&amp; SI2-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a03cc0dff22b31447f43af97acb76b1a2">isConditional</a>());</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="comment">// We fold the unconditional branch if we can easily update all PHI nodes in</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="comment">// common successors:</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="comment">// 1&gt; We have a constant incoming value for the conditional branch;</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="comment">// 2&gt; We have &quot;Cond&quot; as the incoming value for the unconditional branch;</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="comment">// 3&gt; SI2-&gt;getCondition() and Cond have same operands.</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *Ci2 = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a>&gt;(SI2-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>());</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">if</span> (!Ci2) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">if</span> (!(Cond-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0) == Ci2-&gt;getOperand(0) &amp;&amp;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        Cond-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1) == Ci2-&gt;getOperand(1)) &amp;&amp;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      !(Cond-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0) == Ci2-&gt;getOperand(1) &amp;&amp;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        Cond-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1) == Ci2-&gt;getOperand(0)))</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SI1BB = SI1-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SI2BB = SI2-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock*, 16&gt;</a> SI1Succs(<a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(SI1BB), <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(SI1BB));</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SuccIterator.html">succ_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(SI2BB), E = <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(SI2BB); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">if</span> (SI1Succs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = (*I)-&gt;begin();</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;           isa&lt;PHINode&gt;(BBI); ++BBI) {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = cast&lt;PHINode&gt;(BBI);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordflow">if</span> (PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(SI1BB) != Cond ||</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            !isa&lt;ConstantInt&gt;(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(SI2BB)))</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        PhiNodes.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(PN);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;}</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">/// AddPredecessorToBlock - Update PHI nodes in Succ to indicate that there will</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">/// now be entries in it from the &#39;NewPred&#39; block.  The values that will be</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">/// flowing into the PHI nodes will be the same as those coming in from</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">/// ExistPred, an existing predecessor of Succ.</span></div><div class="line"><a name="l00189"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#adfeed3997bba12e75a8e51d740f1969d">  189</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#adfeed3997bba12e75a8e51d740f1969d">AddPredecessorToBlock</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NewPred,</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ExistPred) {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;PHINode&gt;(Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>())) <span class="keywordflow">return</span>; <span class="comment">// Quick exit if nothing to do</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;       (PN = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(ExistPred), NewPred);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;}</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">/// ComputeSpeculationCost - Compute an abstract &quot;cost&quot; of speculating the</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">/// given instruction, which is assumed to be safe to speculate. 1 means</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">/// cheap, 2 means less cheap, and UINT_MAX means prohibitively expensive.</span></div><div class="line"><a name="l00202"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#aaaae27d25fe7431c2ad47c4fb12273e8">  202</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="SimplifyCFG_8cpp.html#aaaae27d25fe7431c2ad47c4fb12273e8">ComputeSpeculationCost</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1User.html">User</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  assert(<a class="code" href="namespacellvm.html#acb7a7f0df849c2c44503352493524895">isSafeToSpeculativelyExecute</a>(I) &amp;&amp;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;         <span class="stringliteral">&quot;Instruction is not safe to speculatively execute!&quot;</span>);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="classllvm_1_1Operator.html#a2f14b03fb8025d2bfa20a34da2b20ccf">Operator::getOpcode</a>(I)) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">// In doubt, be conservative.</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">return</span> UINT_MAX;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordflow">case</span> Instruction::GetElementPtr:</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// GEPs are cheap if all indices are constant.</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">if</span> (!cast&lt;GEPOperator&gt;(I)-&gt;hasAllConstantIndices())</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">return</span> UINT_MAX;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SPII.html#a11e9b8fca4a074643a6a21f444e51406a5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a>:</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordflow">case</span> Instruction::Add:</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="keywordflow">case</span> Instruction::Sub:</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">Instruction::And</a>:</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a>:</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#afc7c4d88d09cba0c5e920f8a3a3ace55">Instruction::Xor</a>:</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keywordflow">case</span> Instruction::Shl:</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordflow">case</span> Instruction::LShr:</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">case</span> Instruction::AShr:</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordflow">case</span> Instruction::ICmp:</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keywordflow">case</span> Instruction::Trunc:</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">case</span> Instruction::ZExt:</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="keywordflow">case</span> Instruction::SExt:</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">return</span> 1; <span class="comment">// These are all cheap.</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Instruction::Call</a>:</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba32dbd2c72a98eaee90e3ad5ef7b5af16">Instruction::Select</a>:</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">return</span> 2;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  }</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;}</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">/// DominatesMergePoint - If we have a merge point of an &quot;if condition&quot; as</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">/// accepted above, return true if the specified value dominates the block.  We</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">/// don&#39;t handle the true generality of domination here, just a special case</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">/// which works well enough for us.</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">/// If AggressiveInsts is non-null, and if V does not dominate BB, we check to</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">/// see if V (which must be an instruction) and its recursive operands</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">/// that do not dominate BB have a combined cost lower than CostRemaining and</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">/// are non-trapping.  If both are true, the instruction is inserted into the</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">/// set and true is returned.</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">/// The cost for most non-trapping instructions is defined as 1 except for</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">/// Select whose cost is 2.</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">/// After this function returns, CostRemaining is decreased by the cost of</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">/// V plus its non-dominating operands.  If that cost is greater than</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">/// CostRemaining, false is returned and CostRemaining is undefined.</span></div><div class="line"><a name="l00252"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ad3acb8f156ef3691661eae4471cb4887">  252</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#ad3acb8f156ef3691661eae4471cb4887">DominatesMergePoint</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                                <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction*, 4&gt;</a> *AggressiveInsts,</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                                <span class="keywordtype">unsigned</span> &amp;CostRemaining) {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(V);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordflow">if</span> (!I) {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="comment">// Non-instructions all dominate instructions, but not all constantexprs</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="comment">// can be executed unconditionally.</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;ConstantExpr&gt;(V))</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;canTrap())</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PBB = I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="comment">// We don&#39;t want to allow weird loops that might have the &quot;if condition&quot; in</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">// the bottom of this block.</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordflow">if</span> (PBB == BB) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="comment">// If this instruction is defined in a block that contains an unconditional</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="comment">// branch to BB, then it must be in the &#39;conditional&#39; part of the &quot;if</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="comment">// statement&quot;.  If not, it definitely dominates the region.</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a>&gt;(PBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keywordflow">if</span> (BI == 0 || BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a03cc0dff22b31447f43af97acb76b1a2">isConditional</a>() || BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0) != <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="comment">// If we aren&#39;t allowing aggressive promotion anymore, then don&#39;t consider</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="comment">// instructions in the &#39;if region&#39;.</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordflow">if</span> (AggressiveInsts == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">// If we have seen this instruction before, don&#39;t count it again.</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keywordflow">if</span> (AggressiveInsts-&gt;<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(I)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="comment">// Okay, it looks like the instruction IS in the &quot;condition&quot;.  Check to</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">// see if it&#39;s a cheap instruction to unconditionally compute, and if it</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="comment">// only uses stuff defined outside of the condition.  If so, hoist it out.</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#acb7a7f0df849c2c44503352493524895">isSafeToSpeculativelyExecute</a>(I))</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordtype">unsigned</span> Cost = <a class="code" href="SimplifyCFG_8cpp.html#aaaae27d25fe7431c2ad47c4fb12273e8">ComputeSpeculationCost</a>(I);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keywordflow">if</span> (Cost &gt; CostRemaining)</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  CostRemaining -= Cost;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="comment">// Okay, we can only really hoist these out if their operands do</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="comment">// not take us over the cost threshold.</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = I-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>(), e = I-&gt;<a class="code" href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">op_end</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#ad3acb8f156ef3691661eae4471cb4887">DominatesMergePoint</a>(*<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, BB, AggressiveInsts, CostRemaining))</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="comment">// Okay, it&#39;s safe to do this!  Remember this instruction.</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  AggressiveInsts-&gt;<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(I);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;}</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">/// GetConstantInt - Extract ConstantInt from value, looking through IntToPtr</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">/// and PointerNullValue. Return NULL if value is not a constant int.</span></div><div class="line"><a name="l00309"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a0b050aae0f188426acd4124d39e50ae6">  309</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="SimplifyCFG_8cpp.html#a0b050aae0f188426acd4124d39e50ae6">GetConstantInt</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="comment">// Normal constant int.</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(V);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordflow">if</span> (CI || !TD || !isa&lt;Constant&gt;(V) || !V-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>())</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">return</span> CI;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="comment">// This is some kind of pointer constant. Turn it into a pointer-sized</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="comment">// ConstantInt if possible.</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *PtrTy = cast&lt;IntegerType&gt;(TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#ae84bb2408dfffa4e8b5fe2ce0714a3bd">getIntPtrType</a>(V-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()));</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="comment">// Null pointer means 0, see SelectionDAGBuilder::getValue(const Value*).</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ConstantPointerNull&gt;(V))</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(PtrTy, 0);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="comment">// IntToPtr const int.</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(V))</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">if</span> (CE-&gt;getOpcode() == Instruction::IntToPtr)</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = dyn_cast&lt;ConstantInt&gt;(CE-&gt;getOperand(0))) {</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="comment">// The constant is very likely to have the right type already.</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a240475f85dea79ec272c578fdf89acf1">getType</a>() == PtrTy)</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;          <span class="keywordflow">return</span> CI;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;          <span class="keywordflow">return</span> cast&lt;ConstantInt&gt;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            (<a class="code" href="classllvm_1_1ConstantExpr.html#a81ad2fffd14e2df92cad4f631ae76480">ConstantExpr::getIntegerCast</a>(CI, PtrTy, <span class="comment">/*isSigned=*/</span><span class="keyword">false</span>));</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      }</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;}</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">/// GatherConstantCompares - Given a potentially &#39;or&#39;d or &#39;and&#39;d together</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">/// collection of icmp eq/ne instructions that compare a value against a</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">/// constant, return the value being compared, and stick the constant into the</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">/// Values vector.</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *</div><div class="line"><a name="l00342"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#aa62a063a23f704f9544485e57858b670">  342</a></span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#aa62a063a23f704f9544485e57858b670">GatherConstantCompares</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, std::vector&lt;ConstantInt*&gt; &amp;Vals, <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;Extra,</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD, <span class="keywordtype">bool</span> isEQ, <span class="keywordtype">unsigned</span> &amp;UsedICmps) {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(V);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">if</span> (I == 0) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="comment">// If this is an icmp against a constant, handle this as one of the cases.</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI = dyn_cast&lt;ICmpInst&gt;(I)) {</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = <a class="code" href="SimplifyCFG_8cpp.html#a0b050aae0f188426acd4124d39e50ae6">GetConstantInt</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1), TD)) {</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *RHSVal;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *RHSC;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      <span class="keywordflow">if</span> (ICI-&gt;getPredicate() == (isEQ ? <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05aa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP_EQ</a>:<a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05ac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP_NE</a>)) {</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="comment">// (x &amp; ~2^x) == y --&gt; x == y || x == y|2^x</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="comment">// This undoes a transformation done by instcombine to fuse 2 compares.</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ICI-&gt;getOperand(0),</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                  <a class="code" href="namespacellvm_1_1PatternMatch.html#a427435d4da769ae680a8e77ef89520aa">m_And</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(RHSVal), <a class="code" href="namespacellvm_1_1PatternMatch.html#a34a92072122412c6020d4afb43725bf4">m_ConstantInt</a>(RHSC)))) {</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;          <a class="code" href="classllvm_1_1APInt.html">APInt</a> <a class="code" href="namespacellvm_1_1APIntOps.html#a05e6b3a73a1d4fa4979f13a69d6f931a">Not</a> = ~RHSC-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>();</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;          <span class="keywordflow">if</span> (Not.<a class="code" href="classllvm_1_1APInt.html#af3deb6522c4fe2043fe07af2ec90190c">isPowerOf2</a>()) {</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            Vals.push_back(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            Vals.push_back(</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getContext(), <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue() | <a class="code" href="namespacellvm_1_1APIntOps.html#a05e6b3a73a1d4fa4979f13a69d6f931a">Not</a>));</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            UsedICmps++;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            <span class="keywordflow">return</span> RHSVal;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;          }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        }</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        UsedICmps++;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        Vals.push_back(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">return</span> I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="comment">// If we have &quot;x ult 3&quot; comparison, for example, then we can add 0,1,2 to</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="comment">// the set.</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <a class="code" href="classllvm_1_1ConstantRange.html">ConstantRange</a> Span =</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <a class="code" href="classllvm_1_1ConstantRange.html#a1e2111f6405de8f2b3bd8fff249e2bb1">ConstantRange::makeICmpRegion</a>(ICI-&gt;getPredicate(), <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue());</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="comment">// Shift the range if the compare is fed by an add. This is the range</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="comment">// compare idiom as emitted by instcombine.</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="keywordtype">bool</span> hasAdd =</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;          <a class="code" href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), <a class="code" href="namespacellvm_1_1PatternMatch.html#a944c25ac9b73b02a17a20a08a25b9b21">m_Add</a>(<a class="code" href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">m_Value</a>(RHSVal), <a class="code" href="namespacellvm_1_1PatternMatch.html#a34a92072122412c6020d4afb43725bf4">m_ConstantInt</a>(RHSC)));</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="keywordflow">if</span> (hasAdd)</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        Span = Span.<a class="code" href="classllvm_1_1ConstantRange.html#acb48ab169ff254ba03e74f72f6f8e678">subtract</a>(RHSC-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>());</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="comment">// If this is an and/!= check then we want to optimize &quot;x ugt 2&quot; into</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="comment">// x != 0 &amp;&amp; x != 1.</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">if</span> (!isEQ)</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        Span = Span.<a class="code" href="classllvm_1_1ConstantRange.html#a3b6b85760d6f19980ca3f98b7dc6fad4">inverse</a>();</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <span class="comment">// If there are a ton of values, we don&#39;t want to make a ginormous switch.</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keywordflow">if</span> (Span.<a class="code" href="classllvm_1_1ConstantRange.html#a56327dc7ef2656bedacbe669d51abf61">getSetSize</a>().<a class="code" href="classllvm_1_1APInt.html#ad3d358e03c6228af2d19b2e67028886e">ugt</a>(8) || Span.<a class="code" href="classllvm_1_1ConstantRange.html#ae02fb0a19012613dcf2f9f24a1a3cf99">isEmptySet</a>())</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1APInt.html">APInt</a> Tmp = Span.<a class="code" href="classllvm_1_1ConstantRange.html#a35303bcc6354c08b4ed0cc75b1ec1084">getLower</a>(); Tmp != Span.<a class="code" href="classllvm_1_1ConstantRange.html#af88b7acdd025620663e38ca68ff746f5">getUpper</a>(); ++Tmp)</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        Vals.push_back(<a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(V-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), Tmp));</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      UsedICmps++;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="keywordflow">return</span> hasAdd ? RHSVal : I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  }</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="comment">// Otherwise, we can only handle an | or &amp;, depending on isEQ.</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="keywordflow">if</span> (I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>() != (isEQ ? <a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a> : <a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">Instruction::And</a>))</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="keywordtype">unsigned</span> NumValsBeforeLHS = Vals.size();</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keywordtype">unsigned</span> UsedICmpsBeforeLHS = UsedICmps;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *LHS = <a class="code" href="SimplifyCFG_8cpp.html#aa62a063a23f704f9544485e57858b670">GatherConstantCompares</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), Vals, Extra, TD,</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                                          isEQ, UsedICmps)) {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordtype">unsigned</span> NumVals = Vals.size();</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordtype">unsigned</span> UsedICmpsBeforeRHS = UsedICmps;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *RHS = <a class="code" href="SimplifyCFG_8cpp.html#aa62a063a23f704f9544485e57858b670">GatherConstantCompares</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1), Vals, Extra, TD,</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                                            isEQ, UsedICmps)) {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      <span class="keywordflow">if</span> (LHS == RHS)</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">return</span> LHS;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      Vals.resize(NumVals);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      UsedICmps = UsedICmpsBeforeRHS;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="comment">// The RHS of the or/and can&#39;t be folded in and we haven&#39;t used &quot;Extra&quot; yet,</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="comment">// set it and return success.</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordflow">if</span> (Extra == 0 || Extra == I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1)) {</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      Extra = I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="keywordflow">return</span> LHS;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    Vals.resize(NumValsBeforeLHS);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    UsedICmps = UsedICmpsBeforeLHS;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  }</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="comment">// If the LHS can&#39;t be folded in, but Extra is available and RHS can, try to</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="comment">// use LHS as Extra.</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="keywordflow">if</span> (Extra == 0 || Extra == I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0)) {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OldExtra = Extra;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    Extra = I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *RHS = <a class="code" href="SimplifyCFG_8cpp.html#aa62a063a23f704f9544485e57858b670">GatherConstantCompares</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1), Vals, Extra, TD,</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                                            isEQ, UsedICmps))</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="keywordflow">return</span> RHS;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    assert(Vals.size() == NumValsBeforeLHS);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    Extra = OldExtra;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  }</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;}</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">  447</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">EraseTerminatorInstAndDCECond</a>(<a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *TI) {</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Cond = 0;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI = dyn_cast&lt;SwitchInst&gt;(TI)) {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    Cond = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(SI-&gt;getCondition());</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(TI)) {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">if</span> (BI-&gt;isConditional())</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      Cond = dyn_cast&lt;Instruction&gt;(BI-&gt;getCondition());</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1IndirectBrInst.html">IndirectBrInst</a> *IBI = dyn_cast&lt;IndirectBrInst&gt;(TI)) {</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    Cond = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(IBI-&gt;getAddress());</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  }</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keywordflow">if</span> (Cond) <a class="code" href="namespacellvm.html#a23b3753cc662a87b599913814ccf2444">RecursivelyDeleteTriviallyDeadInstructions</a>(Cond);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;}</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">/// isValueEqualityComparison - Return true if the specified terminator checks</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">/// to see if a value is equal to constant integer value.</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1Value.html">Value</a> *SimplifyCFGOpt::isValueEqualityComparison(<a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *TI) {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *CV = 0;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI = dyn_cast&lt;SwitchInst&gt;(TI)) {</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="comment">// Do not permit merging of large switch instructions into their</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">// predecessors unless there is only one predecessor.</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">if</span> (SI-&gt;getNumSuccessors()*std::distance(<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(SI-&gt;getParent()),</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                                             <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(SI-&gt;getParent())) &lt;= 128)</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      CV = SI-&gt;getCondition();</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(TI))</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordflow">if</span> (BI-&gt;isConditional() &amp;&amp; BI-&gt;getCondition()-&gt;hasOneUse())</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI = dyn_cast&lt;ICmpInst&gt;(BI-&gt;getCondition()))</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordflow">if</span> (ICI-&gt;isEquality() &amp;&amp; <a class="code" href="SimplifyCFG_8cpp.html#a0b050aae0f188426acd4124d39e50ae6">GetConstantInt</a>(ICI-&gt;getOperand(1), TD))</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;          CV = ICI-&gt;getOperand(0);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="comment">// Unwrap any lossless ptrtoint cast.</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keywordflow">if</span> (TD &amp;&amp; CV) {</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PtrToIntInst.html">PtrToIntInst</a> *PTII = dyn_cast&lt;PtrToIntInst&gt;(CV)) {</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr = PTII-&gt;getPointerOperand();</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="keywordflow">if</span> (PTII-&gt;getType() == TD-&gt;getIntPtrType(Ptr-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()))</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        CV = Ptr;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  }</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordflow">return</span> CV;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;}</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">/// GetValueEqualityComparisonCases - Given a value comparison instruction,</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">/// decode all of the &#39;cases&#39; that it represents and return the &#39;default&#39; block.</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SimplifyCFGOpt::</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;GetValueEqualityComparisonCases(<a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *TI,</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                                std::vector&lt;ValueEqualityComparisonCase&gt;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                                                                       &amp;Cases) {</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI = dyn_cast&lt;SwitchInst&gt;(TI)) {</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    Cases.reserve(SI-&gt;getNumCases());</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIt.html">SwitchInst::CaseIt</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = SI-&gt;case_begin(), e = SI-&gt;case_end(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      Cases.push_back(ValueEqualityComparisonCase(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>.getCaseValue(),</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                                                  <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>.getCaseSuccessor()));</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">return</span> SI-&gt;getDefaultDest();</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  }</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = cast&lt;BranchInst&gt;(TI);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI = cast&lt;ICmpInst&gt;(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>());</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(ICI-&gt;getPredicate() == <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05ac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP_NE</a>);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  Cases.push_back(ValueEqualityComparisonCase(<a class="code" href="SimplifyCFG_8cpp.html#a0b050aae0f188426acd4124d39e50ae6">GetConstantInt</a>(ICI-&gt;getOperand(1),</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                                                             TD),</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                                              Succ));</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="keywordflow">return</span> BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(ICI-&gt;getPredicate() == <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05aa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP_EQ</a>);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;}</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">/// EliminateBlockCases - Given a vector of bb/value pairs, remove any entries</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">/// in the list that match the specified block.</span></div><div class="line"><a name="l00515"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a38517d96538b847c6c3dbe58965c8053">  515</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#a38517d96538b847c6c3dbe58965c8053">EliminateBlockCases</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                              std::vector&lt;ValueEqualityComparisonCase&gt; &amp;Cases) {</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  Cases.erase(<a class="code" href="namespacellvm_1_1LibFunc.html#abf8f6830387f338fed0bce2e65108c6fae3540eb995a7957962c47300280f2e73">std::remove</a>(Cases.begin(), Cases.end(), <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>), Cases.end());</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;}</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">/// ValuesOverlap - Return true if there are any keys in C1 that exist in C2 as</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">/// well.</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span></div><div class="line"><a name="l00523"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#aaba6ba9e89bea12994fa7a7a6ade4d38">  523</a></span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#aaba6ba9e89bea12994fa7a7a6ade4d38">ValuesOverlap</a>(std::vector&lt;ValueEqualityComparisonCase&gt; &amp;<a class="code" href="Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a>,</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;              std::vector&lt;ValueEqualityComparisonCase &gt; &amp;C2) {</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  std::vector&lt;ValueEqualityComparisonCase&gt; *V1 = &amp;<a class="code" href="Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a>, *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a> = &amp;C2;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="comment">// Make V1 be smaller than V2.</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keywordflow">if</span> (V1-&gt;size() &gt; V2-&gt;size())</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(V1, V2);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="keywordflow">if</span> (V1-&gt;size() == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordflow">if</span> (V1-&gt;size() == 1) {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="comment">// Just scan V2.</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *TheVal = (*V1)[0].<a class="code" href="classllvm_1_1Value.html#a18dbfcb332af7515599ee795cf462843">Value</a>;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = V2-&gt;size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordflow">if</span> (TheVal == (*V2)[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="classllvm_1_1Value.html#a18dbfcb332af7515599ee795cf462843">Value</a>)</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="comment">// Otherwise, just sort both lists and compare element by element.</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <a class="code" href="namespacellvm.html#add1eb5637dd671428b6f138ed3db6428">array_pod_sort</a>(V1-&gt;begin(), V1-&gt;end());</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <a class="code" href="namespacellvm.html#add1eb5637dd671428b6f138ed3db6428">array_pod_sort</a>(V2-&gt;begin(), V2-&gt;end());</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="keywordtype">unsigned</span> i1 = 0, i2 = 0, e1 = V1-&gt;size(), e2 = V2-&gt;size();</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keywordflow">while</span> (i1 != e1 &amp;&amp; i2 != e2) {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">if</span> ((*V1)[i1].<a class="code" href="classllvm_1_1Value.html">Value</a> == (*V2)[i2].<a class="code" href="classllvm_1_1Value.html">Value</a>)</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordflow">if</span> ((*V1)[i1].Value &lt; (*V2)[i2].Value)</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      ++i1;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      ++i2;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  }</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;}</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">/// SimplifyEqualityComparisonWithOnlyPredecessor - If TI is known to be a</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">/// terminator instruction and its block is known to only have a single</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">/// predecessor block, check to see if that predecessor is also a value</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">/// comparison with the same value, and if that comparison determines the</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">/// outcome of this comparison.  If so, simplify TI.  This does a very limited</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">/// form of jump threading.</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> SimplifyCFGOpt::</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;SimplifyEqualityComparisonWithOnlyPredecessor(<a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *TI,</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                                              <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred,</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                                              <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder) {</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *PredVal = isValueEqualityComparison(Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="keywordflow">if</span> (!PredVal) <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Not a value comparison in predecessor.</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ThisVal = isValueEqualityComparison(TI);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  assert(ThisVal &amp;&amp; <span class="stringliteral">&quot;This isn&#39;t a value comparison!!&quot;</span>);</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keywordflow">if</span> (ThisVal != PredVal) <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Different predicates.</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="comment">// TODO: Preserve branch weight metadata, similarly to how</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="comment">// FoldValueComparisonIntoPredecessors preserves it.</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="comment">// Find out information about when control will move from Pred to TI&#39;s block.</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  std::vector&lt;ValueEqualityComparisonCase&gt; PredCases;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredDef = GetValueEqualityComparisonCases(Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>(),</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                                                        PredCases);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#a38517d96538b847c6c3dbe58965c8053">EliminateBlockCases</a>(PredDef, PredCases);  <span class="comment">// Remove default from cases.</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="comment">// Find information about how control leaves this block.</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  std::vector&lt;ValueEqualityComparisonCase&gt; ThisCases;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ThisDef = GetValueEqualityComparisonCases(TI, ThisCases);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#a38517d96538b847c6c3dbe58965c8053">EliminateBlockCases</a>(ThisDef, ThisCases);  <span class="comment">// Remove default from cases.</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="comment">// If TI&#39;s block is the default block from Pred&#39;s comparison, potentially</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <span class="comment">// simplify TI based on this knowledge.</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="keywordflow">if</span> (PredDef == TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()) {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="comment">// If we are here, we know that the value is none of those cases listed in</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="comment">// PredCases.  If there are any cases in ThisCases that are in PredCases, we</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="comment">// can simplify TI.</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#aaba6ba9e89bea12994fa7a7a6ade4d38">ValuesOverlap</a>(PredCases, ThisCases))</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordflow">if</span> (isa&lt;BranchInst&gt;(TI)) {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <span class="comment">// Okay, one of the successors of this condbr is dead.  Convert it to a</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="comment">// uncond br.</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      assert(ThisCases.size() == 1 &amp;&amp; <span class="stringliteral">&quot;Branch can only have one case!&quot;</span>);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <span class="comment">// Insert the new branch.</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NI = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a0c00110a06b1eb96c92f87e4ca28129a">CreateBr</a>(ThisDef);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      (void) NI;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="comment">// Remove PHI node entries for the dead edge.</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      ThisCases[0].Dest-&gt;removePredecessor(TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Threading pred instr: &quot;</span> &lt;&lt; *Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>()</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;           &lt;&lt; <span class="stringliteral">&quot;Through successor TI: &quot;</span> &lt;&lt; *TI &lt;&lt; <span class="stringliteral">&quot;Leaving: &quot;</span> &lt;&lt; *NI &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <a class="code" href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">EraseTerminatorInstAndDCECond</a>(TI);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    }</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI = cast&lt;SwitchInst&gt;(TI);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="comment">// Okay, TI has cases that are statically dead, prune them away.</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Constant*, 16&gt;</a> DeadCases;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PredCases.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      DeadCases.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(PredCases[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Value);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Threading pred instr: &quot;</span> &lt;&lt; *Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>()</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;Through successor TI: &quot;</span> &lt;&lt; *TI);</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="comment">// Collect branch weights into a vector.</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint32_t, 8&gt;</a> Weights;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <a class="code" href="classllvm_1_1MDNode.html">MDNode</a>* MD = SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#aafa29112cbe02e4adc9b36752c771991">getMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">LLVMContext::MD_prof</a>);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordtype">bool</span> HasWeight = MD &amp;&amp; (MD-&gt;<a class="code" href="classllvm_1_1MDNode.html#ade17b50e4f0b835cd9eb58dffe12a90d">getNumOperands</a>() == 2 + SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a4901d4ad48420014059e9393f75442ae">getNumCases</a>());</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordflow">if</span> (HasWeight)</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> MD_i = 1, MD_e = MD-&gt;<a class="code" href="classllvm_1_1MDNode.html#ade17b50e4f0b835cd9eb58dffe12a90d">getNumOperands</a>(); MD_i &lt; MD_e;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;           ++MD_i) {</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>* CI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(MD-&gt;<a class="code" href="classllvm_1_1MDNode.html#adb91929f939ff02dbee552d32afaf4e6">getOperand</a>(MD_i));</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        assert(CI);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        Weights.push_back(CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a7dc983ebf0eb2d255fa90a67063c72e2">getZExtValue</a>());</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      }</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIt.html">SwitchInst::CaseIt</a> i = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a219f2a3514d904d05dc8003a4ee5d291">case_end</a>(), e = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#ae69c15ce940c41719cb96209e113a26e">case_begin</a>(); i != e;) {</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <span class="keywordflow">if</span> (DeadCases.count(i.getCaseValue())) {</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordflow">if</span> (HasWeight) {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;          <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Weights[i.getCaseIndex()+1], Weights.back());</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;          Weights.pop_back();</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        i.getCaseSuccessor()-&gt;removePredecessor(TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a428c1dd0acc084fb894ceb71ca5b707a">removeCase</a>(i);</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      }</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    }</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">if</span> (HasWeight &amp;&amp; Weights.size() &gt;= 2)</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">LLVMContext::MD_prof</a>,</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                      <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a>(SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ad652423d9d91271ba153eb86482b2f55">getContext</a>()).</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                      createBranchWeights(Weights));</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Leaving: &quot;</span> &lt;&lt; *TI &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  }</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="comment">// Otherwise, TI&#39;s block must correspond to some matched value.  Find out</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="comment">// which value (or set of values) this is.</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *TIV = 0;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TIBB = TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PredCases.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">if</span> (PredCases[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Dest == TIBB) {</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keywordflow">if</span> (TIV != 0)</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Cannot handle multiple values coming to this block.</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      TIV = PredCases[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="classllvm_1_1Value.html#a18dbfcb332af7515599ee795cf462843">Value</a>;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    }</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  assert(TIV &amp;&amp; <span class="stringliteral">&quot;No edge from pred to succ?&quot;</span>);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="comment">// Okay, we found the one constant that our value can be if we get into TI&#39;s</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="comment">// BB.  Find out which successor will unconditionally be branched to.</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TheRealDest = 0;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = ThisCases.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">if</span> (ThisCases[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="classllvm_1_1Value.html">Value</a> == TIV) {</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      TheRealDest = ThisCases[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Dest;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    }</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="comment">// If not handled by any explicit cases, it is handled by the default case.</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keywordflow">if</span> (TheRealDest == 0) TheRealDest = ThisDef;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="comment">// Remove PHI node entries for dead edges.</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CheckEdge = TheRealDest;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SuccIterator.html">succ_iterator</a> SI = <a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(TIBB), e = <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(TIBB); SI != e; ++SI)</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordflow">if</span> (*SI != CheckEdge)</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      (*SI)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6f6763e343549d530a1424f1b24053bb">removePredecessor</a>(TIBB);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      CheckEdge = 0;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="comment">// Insert the new branch.</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NI = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a0c00110a06b1eb96c92f87e4ca28129a">CreateBr</a>(TheRealDest);</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  (void) NI;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Threading pred instr: &quot;</span> &lt;&lt; *Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>()</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Through successor TI: &quot;</span> &lt;&lt; *TI &lt;&lt; <span class="stringliteral">&quot;Leaving: &quot;</span> &lt;&lt; *NI &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">EraseTerminatorInstAndDCECond</a>(TI);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;}</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="comment">  /// ConstantIntOrdering - This class implements a stable ordering of constant</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">  /// integers that does not depend on their address.  This is important for</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">  /// applications that sort ConstantInt&#39;s to ensure uniqueness.</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span>ConstantIntOrdering {</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *LHS, <span class="keyword">const</span> <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *RHS)<span class="keyword"> const </span>{</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="keywordflow">return</span> LHS-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a1dc5339334162e650ff87e89629bf66c">ult</a>(RHS-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>());</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    }</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  };</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;}</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a8a7f7d7aa56a6449ae814f48b6a8ce6f">  707</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="SimplifyCFG_8cpp.html#a8a7f7d7aa56a6449ae814f48b6a8ce6f">ConstantIntSortPredicate</a>(<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<span class="keyword">const</span> *P1,</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                                    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<span class="keyword">const</span> *<a class="code" href="README-SSE_8txt.html#ae7fc2fb0e2d536219c1193f1a178e7db">P2</a>) {</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *LHS = *P1;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *RHS = *<a class="code" href="README-SSE_8txt.html#ae7fc2fb0e2d536219c1193f1a178e7db">P2</a>;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <span class="keywordflow">if</span> (LHS-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a1dc5339334162e650ff87e89629bf66c">ult</a>(RHS-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>()))</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="keywordflow">if</span> (LHS-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>() == RHS-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>())</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;}</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ada99fd4fd27356d1518273d8248940a5">  718</a></span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#ada99fd4fd27356d1518273d8248940a5">HasBranchWeights</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a>* <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <a class="code" href="classllvm_1_1MDNode.html">MDNode</a>* ProfMD = I-&gt;<a class="code" href="classllvm_1_1Instruction.html#aafa29112cbe02e4adc9b36752c771991">getMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">LLVMContext::MD_prof</a>);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="keywordflow">if</span> (ProfMD &amp;&amp; ProfMD-&gt;<a class="code" href="classllvm_1_1MDNode.html#adb91929f939ff02dbee552d32afaf4e6">getOperand</a>(0))</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MDString.html">MDString</a>* MDS = dyn_cast&lt;MDString&gt;(ProfMD-&gt;<a class="code" href="classllvm_1_1MDNode.html#adb91929f939ff02dbee552d32afaf4e6">getOperand</a>(0)))</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      <span class="keywordflow">return</span> MDS-&gt;getString().equals(<span class="stringliteral">&quot;branch_weights&quot;</span>);</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;}</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment">/// Get Weights of a given TerminatorInst, the default weight is at the front</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">/// of the vector. If TI is a conditional eq, we need to swap the branch-weight</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">/// metadata.</span></div><div class="line"><a name="l00730"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a165512f38f31f01e7f18bf3838f3a12e">  730</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#a165512f38f31f01e7f18bf3838f3a12e">GetBranchWeights</a>(<a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *TI,</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                             <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;uint64_t&gt;</a> &amp;Weights) {</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <a class="code" href="classllvm_1_1MDNode.html">MDNode</a>* MD = TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#aafa29112cbe02e4adc9b36752c771991">getMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">LLVMContext::MD_prof</a>);</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  assert(MD);</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1, e = MD-&gt;<a class="code" href="classllvm_1_1MDNode.html#ade17b50e4f0b835cd9eb58dffe12a90d">getNumOperands</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>* CI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(MD-&gt;<a class="code" href="classllvm_1_1MDNode.html#adb91929f939ff02dbee552d32afaf4e6">getOperand</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    assert(CI);</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a7dc983ebf0eb2d255fa90a67063c72e2">getZExtValue</a>());</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  }</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="comment">// If TI is a conditional eq, the default case is the false case,</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <span class="comment">// and the corresponding branch-weight data is at index 2. We swap the</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="comment">// default weight to be the first entry.</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a>* BI = dyn_cast&lt;BranchInst&gt;(TI)) {</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    assert(Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 2);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI = cast&lt;ICmpInst&gt;(BI-&gt;getCondition());</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="keywordflow">if</span> (ICI-&gt;getPredicate() == <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05aa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP_EQ</a>)</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a58dc840fc84420b7f0b773794b8101c1">front</a>(), Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>());</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  }</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;}</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">/// Sees if any of the weights are too big for a uint32_t, and halves all the</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="comment">/// weights if any are.</span></div><div class="line"><a name="l00753"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a95ec32778f2bb913dc4cc45ac7a66e42">  753</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="SimplifyCFG_8cpp.html#a95ec32778f2bb913dc4cc45ac7a66e42">FitWeights</a>(<a class="code" href="classllvm_1_1MutableArrayRef.html">MutableArrayRef&lt;uint64_t&gt;</a> Weights) {</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="keywordtype">bool</span> Halve = <span class="keyword">false</span>;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Weights.<a class="code" href="classllvm_1_1ArrayRef.html#a76878250107ee24ef7339870bdda4bcf">size</a>(); ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordflow">if</span> (Weights[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] &gt; UINT_MAX) {</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      Halve = <span class="keyword">true</span>;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    }</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <span class="keywordflow">if</span> (! Halve)</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Weights.<a class="code" href="classllvm_1_1ArrayRef.html#a76878250107ee24ef7339870bdda4bcf">size</a>(); ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    Weights[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] /= 2;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;}</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="comment">/// FoldValueComparisonIntoPredecessors - The specified terminator is a value</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment">/// equality comparison instruction (either a switch or a branch on &quot;X == c&quot;).</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment">/// See if any of the predecessors of the terminator block are value comparisons</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment">/// on the same value.  If so, and if safe to do so, fold them together.</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> SimplifyCFGOpt::FoldValueComparisonIntoPredecessors(<a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *TI,</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                                                         <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder) {</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *CV = isValueEqualityComparison(TI);  <span class="comment">// CondVal</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  assert(CV &amp;&amp; <span class="stringliteral">&quot;Not a comparison?&quot;</span>);</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock*, 16&gt;</a> Preds(<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(BB), <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(BB));</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="keywordflow">while</span> (!Preds.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = Preds.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="comment">// See if the predecessor is a comparison with the same value.</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *PTI = Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>();</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *PCV = isValueEqualityComparison(PTI);  <span class="comment">// PredCondVal</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keywordflow">if</span> (PCV == CV &amp;&amp; <a class="code" href="SimplifyCFG_8cpp.html#a02215e210f29948498aeb844022afe53">SafeToMergeTerminators</a>(TI, PTI)) {</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <span class="comment">// Figure out which &#39;cases&#39; to copy from SI to PSI.</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      std::vector&lt;ValueEqualityComparisonCase&gt; BBCases;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BBDefault = GetValueEqualityComparisonCases(TI, BBCases);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      std::vector&lt;ValueEqualityComparisonCase&gt; PredCases;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredDefault = GetValueEqualityComparisonCases(PTI, PredCases);</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      <span class="comment">// Based on whether the default edge from PTI goes to BB or not, fill in</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      <span class="comment">// PredCases and PredDefault with the new switch cases we would like to</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <span class="comment">// build.</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock*, 8&gt;</a> NewSuccessors;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      <span class="comment">// Update the branch weight metadata along the way</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint64_t, 8&gt;</a> Weights;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      <span class="keywordtype">bool</span> PredHasWeights = <a class="code" href="SimplifyCFG_8cpp.html#ada99fd4fd27356d1518273d8248940a5">HasBranchWeights</a>(PTI);</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      <span class="keywordtype">bool</span> SuccHasWeights = <a class="code" href="SimplifyCFG_8cpp.html#ada99fd4fd27356d1518273d8248940a5">HasBranchWeights</a>(TI);</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      <span class="keywordflow">if</span> (PredHasWeights) {</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#a165512f38f31f01e7f18bf3838f3a12e">GetBranchWeights</a>(PTI, Weights);</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="comment">// branch-weight metadata is inconsistent here.</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keywordflow">if</span> (Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() != 1 + PredCases.size())</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;          PredHasWeights = SuccHasWeights = <span class="keyword">false</span>;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SuccHasWeights)</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <span class="comment">// If there are no predecessor weights but there are successor weights,</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <span class="comment">// populate Weights with 1, which will later be scaled to the sum of</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="comment">// successor&#39;s weights</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        Weights.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a465f75c78f1dc551152248c9f203b88d">assign</a>(1 + PredCases.size(), 1);</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint64_t, 8&gt;</a> SuccWeights;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      <span class="keywordflow">if</span> (SuccHasWeights) {</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#a165512f38f31f01e7f18bf3838f3a12e">GetBranchWeights</a>(TI, SuccWeights);</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <span class="comment">// branch-weight metadata is inconsistent here.</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        <span class="keywordflow">if</span> (SuccWeights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() != 1 + BBCases.size())</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;          PredHasWeights = SuccHasWeights = <span class="keyword">false</span>;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PredHasWeights)</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        SuccWeights.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a465f75c78f1dc551152248c9f203b88d">assign</a>(1 + BBCases.size(), 1);</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <span class="keywordflow">if</span> (PredDefault == BB) {</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="comment">// If this is the default destination from PTI, only the edges in TI</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        <span class="comment">// that don&#39;t occur in PTI, or that branch to BB will be activated.</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        std::set&lt;ConstantInt*, ConstantIntOrdering&gt; PTIHandled;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PredCases.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;          <span class="keywordflow">if</span> (PredCases[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Dest != BB)</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            PTIHandled.insert(PredCases[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="classllvm_1_1Value.html">Value</a>);</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;          <span class="keywordflow">else</span> {</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;            <span class="comment">// The default destination is BB, we don&#39;t need explicit targets.</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(PredCases[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], PredCases.back());</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            <span class="keywordflow">if</span> (PredHasWeights || SuccHasWeights) {</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;              <span class="comment">// Increase weight for the default case.</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;              Weights[0] += Weights[i+1];</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;              <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Weights[i+1], Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>());</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;              Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#a1f2303df9bbee2233c11d61c2f6f7930">pop_back</a>();</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            }</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            PredCases.pop_back();</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>; --e;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;          }</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        <span class="comment">// Reconstruct the new switch statement we will be building.</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <span class="keywordflow">if</span> (PredDefault != BBDefault) {</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;          PredDefault-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6f6763e343549d530a1424f1b24053bb">removePredecessor</a>(Pred);</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;          PredDefault = BBDefault;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;          NewSuccessors.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(BBDefault);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        }</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="keywordtype">unsigned</span> CasesFromPred = Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>();</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        uint64_t ValidTotalSuccWeight = 0;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = BBCases.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;          <span class="keywordflow">if</span> (!PTIHandled.count(BBCases[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Value) &amp;&amp;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;              BBCases[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Dest != BBDefault) {</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            PredCases.push_back(BBCases[i]);</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            NewSuccessors.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(BBCases[i].Dest);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;            <span class="keywordflow">if</span> (SuccHasWeights || PredHasWeights) {</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;              <span class="comment">// The default weight is at index 0, so weight for the ith case</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;              <span class="comment">// should be at index i+1. Scale the cases from successor by</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;              <span class="comment">// PredDefaultWeight (Weights[0]).</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;              Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Weights[0] * SuccWeights[i+1]);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;              ValidTotalSuccWeight += SuccWeights[i+1];</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            }</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;          }</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="keywordflow">if</span> (SuccHasWeights || PredHasWeights) {</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;          ValidTotalSuccWeight += SuccWeights[0];</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;          <span class="comment">// Scale the cases from predecessor by ValidTotalSuccWeight.</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 1; i &lt; CasesFromPred; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            Weights[i] *= ValidTotalSuccWeight;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;          <span class="comment">// Scale the default weight by SuccDefaultWeight (SuccWeights[0]).</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;          Weights[0] *= SuccWeights[0];</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        }</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <span class="comment">// If this is not the default destination from PSI, only the edges</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        <span class="comment">// in SI that occur in PSI with a destination of BB will be</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <span class="comment">// activated.</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        std::set&lt;ConstantInt*, ConstantIntOrdering&gt; PTIHandled;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        std::map&lt;ConstantInt*, uint64_t&gt; WeightsForHandled;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PredCases.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;          <span class="keywordflow">if</span> (PredCases[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Dest == BB) {</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            PTIHandled.<a class="code" href="classllvm_1_1SmallVectorImpl.html#af622128e353515efebccad40eae495cb">insert</a>(PredCases[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="classllvm_1_1Value.html">Value</a>);</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            <span class="keywordflow">if</span> (PredHasWeights || SuccHasWeights) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;              WeightsForHandled[PredCases[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Value] = Weights[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>+1];</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;              <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Weights[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>+1], Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>());</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;              Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#a1f2303df9bbee2233c11d61c2f6f7930">pop_back</a>();</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            }</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(PredCases[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], PredCases.back());</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            PredCases.pop_back();</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>; --e;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;          }</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        <span class="comment">// Okay, now we know which constants were sent to BB from the</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        <span class="comment">// predecessor.  Figure out where they will all go now.</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = BBCases.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;          <span class="keywordflow">if</span> (PTIHandled.count(BBCases[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Value)) {</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            <span class="comment">// If this is one we are capable of getting...</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            <span class="keywordflow">if</span> (PredHasWeights || SuccHasWeights)</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;              Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(WeightsForHandled[BBCases[i].<a class="code" href="classllvm_1_1Value.html">Value</a>]);</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            PredCases.push_back(BBCases[i]);</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            NewSuccessors.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(BBCases[i].Dest);</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            PTIHandled.erase(BBCases[i].Value);<span class="comment">// This constant is taken care of</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;          }</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <span class="comment">// If there are any constants vectored to BB that TI doesn&#39;t handle,</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <span class="comment">// they must go to the default destination of TI.</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <span class="keywordflow">for</span> (std::set&lt;ConstantInt*, ConstantIntOrdering&gt;::iterator <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> =</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                                    PTIHandled.begin(),</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;               E = PTIHandled.end(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;          <span class="keywordflow">if</span> (PredHasWeights || SuccHasWeights)</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;            Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(WeightsForHandled[*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;          PredCases.push_back(ValueEqualityComparisonCase(*I, BBDefault));</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;          NewSuccessors.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(BBDefault);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        }</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      }</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      <span class="comment">// Okay, at this point, we know which new successor Pred will get.  Make</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <span class="comment">// sure we update the number of entries in the PHI nodes for these</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <span class="comment">// successors.</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = NewSuccessors.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#adfeed3997bba12e75a8e51d740f1969d">AddPredecessorToBlock</a>(NewSuccessors[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], Pred, BB);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(PTI);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      <span class="comment">// Convert pointer to int before we switch.</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      <span class="keywordflow">if</span> (CV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>()) {</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        assert(TD &amp;&amp; <span class="stringliteral">&quot;Cannot switch on pointer without DataLayout&quot;</span>);</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        CV = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a9299aed1efa0ef459a0f1c7fa11fbe61">CreatePtrToInt</a>(CV, TD-&gt;getIntPtrType(CV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()),</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                                    <span class="stringliteral">&quot;magicptr&quot;</span>);</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      }</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      <span class="comment">// Now that the successors are updated, create the new Switch instruction.</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      <a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *NewSI = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#ae3e9c98ce18a49f8eabe285032612a12">CreateSwitch</a>(CV, PredDefault,</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                                               PredCases.<a class="code" href="classllvm_1_1BasicBlock.html#aed28607f3ab19dda7ec1cf1a0319276f">size</a>());</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      NewSI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a7bd545769621a0a9d2cfb074f86f4295">setDebugLoc</a>(PTI-&gt;<a class="code" href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">getDebugLoc</a>());</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0, e = PredCases.size(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        NewSI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a62abc2475d09c01d583ba24a487898fd">addCase</a>(PredCases[i].Value, PredCases[i].Dest);</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      <span class="keywordflow">if</span> (PredHasWeights || SuccHasWeights) {</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        <span class="comment">// Halve the weights if any of them cannot fit in an uint32_t</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#a95ec32778f2bb913dc4cc45ac7a66e42">FitWeights</a>(Weights);</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint32_t, 8&gt;</a> MDWeights(Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>());</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        NewSI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">LLVMContext::MD_prof</a>,</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                           <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a>(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ad652423d9d91271ba153eb86482b2f55">getContext</a>()).</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                           createBranchWeights(MDWeights));</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      }</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      <a class="code" href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">EraseTerminatorInstAndDCECond</a>(PTI);</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      <span class="comment">// Okay, last check.  If BB is still a successor of PSI, then we must</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      <span class="comment">// have an infinite loop case.  If so, add an infinitely looping block</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;      <span class="comment">// to handle the case to preserve the behavior of the code.</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *InfLoopBlock = 0;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0, e = NewSI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a1911781fed54dee847a46bf4fa4c5c34">getNumSuccessors</a>(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        <span class="keywordflow">if</span> (NewSI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#aef88cf6f3b68009b7901343e934368a8">getSuccessor</a>(i) == <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;          <span class="keywordflow">if</span> (InfLoopBlock == 0) {</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;            <span class="comment">// Insert it at the end of the function, because it&#39;s either code,</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            <span class="comment">// or it won&#39;t matter if it&#39;s hot. :)</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;            InfLoopBlock = <a class="code" href="classllvm_1_1BasicBlock.html#ae1d53a21892854816885c7288f8b46f1">BasicBlock::Create</a>(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ad652423d9d91271ba153eb86482b2f55">getContext</a>(),</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                                              <span class="stringliteral">&quot;infloop&quot;</span>, BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>());</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;            <a class="code" href="classllvm_1_1BranchInst.html#ae9cbc599309fd2da33ec1c61df01ce1f">BranchInst::Create</a>(InfLoopBlock, InfLoopBlock);</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;          }</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;          NewSI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a7fc7899c254935205ca29b6bd7baa926">setSuccessor</a>(i, InfLoopBlock);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        }</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    }</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  }</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;}</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment">// isSafeToHoistInvoke - If we would need to insert a select that uses the</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment">// value of this invoke (comments in HoistThenElseCodeToIf explain why we</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment">// would need to do this), we can&#39;t hoist the invoke, as there is nowhere</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment">// to put the select in this case.</span></div><div class="line"><a name="l00983"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a3aaba0277f5dd5636e099fa81c20c533">  983</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a3aaba0277f5dd5636e099fa81c20c533">isSafeToHoistInvoke</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB1, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB2,</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                                <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I1, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I2) {</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SuccIterator.html">succ_iterator</a> SI = <a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(BB1), E = <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(BB1); SI != E; ++SI) {</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = SI-&gt;begin();</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;         (PN = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(BBI)); ++BBI) {</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BB1V = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(BB1);</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BB2V = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(BB2);</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      <span class="keywordflow">if</span> (BB1V != BB2V &amp;&amp; (BB1V==I1 || BB2V==I2)) {</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      }</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    }</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  }</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;}</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment">/// HoistThenElseCodeToIf - Given a conditional branch that goes to BB1 and</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">/// BB2, hoist any common code in the two blocks up into the branch block.  The</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment">/// caller of this function guarantees that BI&#39;s block dominates BB1 and BB2.</span></div><div class="line"><a name="l01002"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a6434e674d53619188f1a6b4bac3b304e"> 1002</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a6434e674d53619188f1a6b4bac3b304e">HoistThenElseCodeToIf</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI) {</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="comment">// This does very trivial matching, with limited scanning, to find identical</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <span class="comment">// instructions in the two blocks.  In particular, we don&#39;t want to get into</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="comment">// O(M*N) situations here where M and N are the sizes of BB1 and BB2.  As</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="comment">// such, we currently just scan for obviously identical instructions in an</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="comment">// identical order.</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB1 = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0);  <span class="comment">// The true destination.</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB2 = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1);  <span class="comment">// The false destination</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BB1_Itr = BB1-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BB2_Itr = BB2-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I1 = BB1_Itr++, *I2 = BB2_Itr++;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="comment">// Skip debug info if it is not identical.</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <a class="code" href="classllvm_1_1DbgInfoIntrinsic.html">DbgInfoIntrinsic</a> *DBI1 = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1DbgInfoIntrinsic.html">DbgInfoIntrinsic</a>&gt;(I1);</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <a class="code" href="classllvm_1_1DbgInfoIntrinsic.html">DbgInfoIntrinsic</a> *DBI2 = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1DbgInfoIntrinsic.html">DbgInfoIntrinsic</a>&gt;(I2);</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  <span class="keywordflow">if</span> (!DBI1 || !DBI2 || !DBI1-&gt;<a class="code" href="classllvm_1_1Instruction.html#a0998fa064652459be9475ad460ee381f">isIdenticalToWhenDefined</a>(DBI2)) {</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(I1))</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      I1 = BB1_Itr++;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(I2))</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      I2 = BB2_Itr++;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  }</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(I1) || !I1-&gt;<a class="code" href="classllvm_1_1Instruction.html#a0998fa064652459be9475ad460ee381f">isIdenticalToWhenDefined</a>(I2) ||</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      (isa&lt;InvokeInst&gt;(I1) &amp;&amp; !<a class="code" href="SimplifyCFG_8cpp.html#a3aaba0277f5dd5636e099fa81c20c533">isSafeToHoistInvoke</a>(BB1, BB2, I1, I2)))</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BIParent = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="comment">// If we are hoisting the terminator instruction, don&#39;t move one (making a</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="comment">// broken BB), instead clone it, and remove BI.</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keywordflow">if</span> (isa&lt;TerminatorInst&gt;(I1))</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      <span class="keywordflow">goto</span> HoistTerminator;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <span class="comment">// For a normal instruction, we just move one to right before the branch,</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <span class="comment">// then replace all uses of the other with the first.  Finally, we remove</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <span class="comment">// the now redundant second instruction.</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    BIParent-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#afe55b235779222b867c16d3321c1cd16">splice</a>(BI, BB1-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>(), I1);</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <span class="keywordflow">if</span> (!I2-&gt;use_empty())</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      I2-&gt;replaceAllUsesWith(I1);</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    I1-&gt;<a class="code" href="classllvm_1_1Value.html#a12b091e586dea5849c4d85723d2cba1b">intersectOptionalDataWith</a>(I2);</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    I2-&gt;eraseFromParent();</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    I1 = BB1_Itr++;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    I2 = BB2_Itr++;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <span class="comment">// Skip debug info if it is not identical.</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <a class="code" href="classllvm_1_1DbgInfoIntrinsic.html">DbgInfoIntrinsic</a> *DBI1 = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1DbgInfoIntrinsic.html">DbgInfoIntrinsic</a>&gt;(I1);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <a class="code" href="classllvm_1_1DbgInfoIntrinsic.html">DbgInfoIntrinsic</a> *DBI2 = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1DbgInfoIntrinsic.html">DbgInfoIntrinsic</a>&gt;(I2);</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <span class="keywordflow">if</span> (!DBI1 || !DBI2 || !DBI1-&gt;<a class="code" href="classllvm_1_1Instruction.html#a0998fa064652459be9475ad460ee381f">isIdenticalToWhenDefined</a>(DBI2)) {</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(I1))</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        I1 = BB1_Itr++;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;      <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(I2))</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        I2 = BB2_Itr++;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    }</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  } <span class="keywordflow">while</span> (I1-&gt;<a class="code" href="classllvm_1_1Instruction.html#a0998fa064652459be9475ad460ee381f">isIdenticalToWhenDefined</a>(I2));</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;HoistTerminator:</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <span class="comment">// It may not be possible to hoist an invoke.</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="keywordflow">if</span> (isa&lt;InvokeInst&gt;(I1) &amp;&amp; !<a class="code" href="SimplifyCFG_8cpp.html#a3aaba0277f5dd5636e099fa81c20c533">isSafeToHoistInvoke</a>(BB1, BB2, I1, I2))</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SuccIterator.html">succ_iterator</a> SI = <a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(BB1), E = <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(BB1); SI != E; ++SI) {</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = SI-&gt;begin();</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;         (PN = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(BBI)); ++BBI) {</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BB1V = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(BB1);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BB2V = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(BB2);</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <span class="keywordflow">if</span> (BB1V == BB2V)</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      <span class="keywordflow">if</span> (isa&lt;ConstantExpr&gt;(BB1V) &amp;&amp; !<a class="code" href="namespacellvm.html#acb7a7f0df849c2c44503352493524895">isSafeToSpeculativelyExecute</a>(BB1V))</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      <span class="keywordflow">if</span> (isa&lt;ConstantExpr&gt;(BB2V) &amp;&amp; !<a class="code" href="namespacellvm.html#acb7a7f0df849c2c44503352493524895">isSafeToSpeculativelyExecute</a>(BB2V))</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    }</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  }</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <span class="comment">// Okay, it is safe to hoist the terminator.</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NT = I1-&gt;<a class="code" href="classllvm_1_1Instruction.html#af6aad0c9ba7b8720130235c9621b55b5">clone</a>();</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  BIParent-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#a35c71de7e8bbe3c0353d042beb58263f">insert</a>(BI, NT);</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <span class="keywordflow">if</span> (!NT-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#af5c7041df3ad5edffe5da17b5264c1fc">isVoidTy</a>()) {</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    I1-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NT);</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    I2-&gt;replaceAllUsesWith(NT);</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    NT-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(I1);</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  }</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;true, NoFolder&gt;</a> Builder(NT);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="comment">// Hoisting one of the terminators from our successor is a great thing.</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  <span class="comment">// Unfortunately, the successors of the if/else blocks may have PHI nodes in</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  <span class="comment">// them.  If they do, all PHI entries for BB1/BB2 must agree for all PHI</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  <span class="comment">// nodes, so we insert select instruction to compute the final result.</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  std::map&lt;std::pair&lt;Value*,Value*&gt;, <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a>*&gt; InsertedSelects;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SuccIterator.html">succ_iterator</a> SI = <a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(BB1), E = <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(BB1); SI != E; ++SI) {</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = SI-&gt;begin();</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;         (PN = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(BBI)); ++BBI) {</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BB1V = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(BB1);</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BB2V = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(BB2);</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      <span class="keywordflow">if</span> (BB1V == BB2V) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      <span class="comment">// These values do not agree.  Insert a select instruction before NT</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      <span class="comment">// that determines the right value.</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *&amp;SI = InsertedSelects[std::make_pair(BB1V, BB2V)];</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      <span class="keywordflow">if</span> (SI == 0)</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        SI = cast&lt;SelectInst&gt;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;          (Builder.<a class="code" href="classllvm_1_1IRBuilder.html#ae19d9d49f39d404703b42161ce788954">CreateSelect</a>(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>(), BB1V, BB2V,</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                                BB1V-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.&quot;</span>+BB2V-&gt;getName()));</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      <span class="comment">// Make the PHI node use the select for all incoming values for BB1/BB2</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        <span class="keywordflow">if</span> (PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) == BB1 || PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) == BB2)</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;          PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, SI);</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    }</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  }</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="comment">// Update any PHI nodes in our new successors.</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SuccIterator.html">succ_iterator</a> SI = <a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(BB1), E = <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(BB1); SI != E; ++SI)</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#adfeed3997bba12e75a8e51d740f1969d">AddPredecessorToBlock</a>(*SI, BIParent, BB1);</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">EraseTerminatorInstAndDCECond</a>(BI);</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;}</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">/// SinkThenElseCodeToEnd - Given an unconditional branch that goes to BBEnd,</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">/// check whether BBEnd has only two predecessors and the other predecessor</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment">/// ends with an unconditional branch. If it is true, sink any common code</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">/// in the two predecessors to BBEnd.</span></div><div class="line"><a name="l01133"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a136cc7ed9c1041928df9f03631026a0d"> 1133</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a136cc7ed9c1041928df9f03631026a0d">SinkThenElseCodeToEnd</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI1) {</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  assert(BI1-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a382131e712e55e8324fbd5068de17b78">isUnconditional</a>());</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB1 = BI1-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BBEnd = BI1-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0);</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  <span class="comment">// Check that BBEnd has two predecessors and the other predecessor ends with</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  <span class="comment">// an unconditional branch.</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  <a class="code" href="classllvm_1_1PredIterator.html">pred_iterator</a> PI = <a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(BBEnd), PE = <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(BBEnd);</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred0 = *PI++;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  <span class="keywordflow">if</span> (PI == PE) <span class="comment">// Only one predecessor.</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred1 = *PI++;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  <span class="keywordflow">if</span> (PI != PE) <span class="comment">// More than two predecessors.</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB2 = (Pred0 == BB1) ? Pred1 : Pred0;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI2 = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a>&gt;(BB2-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <span class="keywordflow">if</span> (!BI2 || !BI2-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a382131e712e55e8324fbd5068de17b78">isUnconditional</a>())</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  <span class="comment">// Gather the PHI nodes in BBEnd.</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  std::map&lt;Value*, std::pair&lt;Value*, PHINode*&gt; &gt; MapValueFromBB1ToBB2;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *FirstNonPhiInBBEnd = 0;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BBEnd-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), E = BBEnd-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>();</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BB1V = PN-&gt;getIncomingValueForBlock(BB1);</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *BB2V = PN-&gt;getIncomingValueForBlock(BB2);</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      MapValueFromBB1ToBB2[BB1V] = std::make_pair(BB2V, PN);</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      FirstNonPhiInBBEnd = &amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    }</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  }</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  <span class="keywordflow">if</span> (!FirstNonPhiInBBEnd)</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <span class="comment">// This does very trivial matching, with limited scanning, to find identical</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="comment">// instructions in the two blocks.  We scan backward for obviously identical</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  <span class="comment">// instructions in an identical order.</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <a class="code" href="classllvm_1_1iplist.html#ab1b660345b57db3d80ad42123d6163ce">BasicBlock::InstListType::reverse_iterator</a> RI1 = BB1-&gt;getInstList().rbegin(),</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      RE1 = BB1-&gt;getInstList().rend(), RI2 = BB2-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#ad5f5ac50ca28fc89c173eb3d64344afc">rbegin</a>(),</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      RE2 = BB2-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#a99d24ef8a3c3b81d43fa244e43f976fc">rend</a>();</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  <span class="comment">// Skip debug info.</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  <span class="keywordflow">while</span> (RI1 != RE1 &amp;&amp; isa&lt;DbgInfoIntrinsic&gt;(&amp;*RI1)) ++RI1;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="keywordflow">if</span> (RI1 == RE1)</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <span class="keywordflow">while</span> (RI2 != RE2 &amp;&amp; isa&lt;DbgInfoIntrinsic&gt;(&amp;*RI2)) ++RI2;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <span class="keywordflow">if</span> (RI2 == RE2)</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <span class="comment">// Skip the unconditional branches.</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  ++RI1;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  ++RI2;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  <span class="keywordflow">while</span> (RI1 != RE1 &amp;&amp; RI2 != RE2) {</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="comment">// Skip debug info.</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keywordflow">while</span> (RI1 != RE1 &amp;&amp; isa&lt;DbgInfoIntrinsic&gt;(&amp;*RI1)) ++RI1;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="keywordflow">if</span> (RI1 == RE1)</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <span class="keywordflow">while</span> (RI2 != RE2 &amp;&amp; isa&lt;DbgInfoIntrinsic&gt;(&amp;*RI2)) ++RI2;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="keywordflow">if</span> (RI2 == RE2)</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I1 = &amp;*RI1, *I2 = &amp;*RI2;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="comment">// I1 and I2 should have a single use in the same PHI node, and they</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="comment">// perform the same operation.</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="comment">// Cannot move control-flow-involving, volatile loads, vaarg, etc.</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(I1) || isa&lt;PHINode&gt;(I2) ||</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        isa&lt;TerminatorInst&gt;(I1) || isa&lt;TerminatorInst&gt;(I2) ||</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        isa&lt;LandingPadInst&gt;(I1) || isa&lt;LandingPadInst&gt;(I2) ||</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        isa&lt;AllocaInst&gt;(I1) || isa&lt;AllocaInst&gt;(I2) ||</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        I1-&gt;<a class="code" href="classllvm_1_1Instruction.html#a573063aad4c101462893d0490d867524">mayHaveSideEffects</a>() || I2-&gt;mayHaveSideEffects() ||</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        I1-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9186dc5303ac8e5f788862f0ec11cb66">mayReadOrWriteMemory</a>() || I2-&gt;mayReadOrWriteMemory() ||</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        !I1-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>() || !I2-&gt;hasOneUse() ||</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        MapValueFromBB1ToBB2.find(I1) == MapValueFromBB1ToBB2.end() ||</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        MapValueFromBB1ToBB2[I1].first != I2)</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="comment">// Check whether we should swap the operands of ICmpInst.</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICmp1 = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a>&gt;(I1), *ICmp2 = dyn_cast&lt;ICmpInst&gt;(I2);</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="keywordtype">bool</span> SwapOpnds = <span class="keyword">false</span>;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <span class="keywordflow">if</span> (ICmp1 &amp;&amp; ICmp2 &amp;&amp;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        ICmp1-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0) != ICmp2-&gt;getOperand(0) &amp;&amp;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;        ICmp1-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1) != ICmp2-&gt;getOperand(1) &amp;&amp;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        (ICmp1-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0) == ICmp2-&gt;getOperand(1) ||</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;         ICmp1-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1) == ICmp2-&gt;getOperand(0))) {</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      ICmp2-&gt;swapOperands();</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;      SwapOpnds = <span class="keyword">true</span>;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    }</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="keywordflow">if</span> (!I1-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9f729c6c3e0de4a55dc5a3693fd4a9eb">isSameOperationAs</a>(I2)) {</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      <span class="keywordflow">if</span> (SwapOpnds)</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        ICmp2-&gt;swapOperands();</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    }</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="comment">// The operands should be either the same or they need to be generated</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="comment">// with a PHI node after sinking. We only handle the case where there is</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <span class="comment">// a single pair of different operands.</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *DifferentOp1 = 0, *DifferentOp2 = 0;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <span class="keywordtype">unsigned</span> Op1Idx = 0;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = I1-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;      <span class="keywordflow">if</span> (I1-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) == I2-&gt;getOperand(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      <span class="comment">// Early exit if we have more-than one pair of different operands or</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;      <span class="comment">// the different operand is already in MapValueFromBB1ToBB2.</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      <span class="comment">// Early exit if we need a PHI node to replace a constant.</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;      <span class="keywordflow">if</span> (DifferentOp1 ||</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;          MapValueFromBB1ToBB2.find(I1-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) !=</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;          MapValueFromBB1ToBB2.end() ||</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;          isa&lt;Constant&gt;(I1-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) ||</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;          isa&lt;Constant&gt;(I2-&gt;getOperand(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))) {</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        <span class="comment">// If we can&#39;t sink the instructions, undo the swapping.</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;        <span class="keywordflow">if</span> (SwapOpnds)</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;          ICmp2-&gt;swapOperands();</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      }</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      DifferentOp1 = I1-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      Op1Idx = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      DifferentOp2 = I2-&gt;getOperand(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    }</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="comment">// We insert the pair of different operands to MapValueFromBB1ToBB2 and</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <span class="comment">// remove (I1, I2) from MapValueFromBB1ToBB2.</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="keywordflow">if</span> (DifferentOp1) {</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *NewPN = <a class="code" href="classllvm_1_1PHINode.html#afb5e83bf5123ff7c51058eb0ebebcdc6">PHINode::Create</a>(DifferentOp1-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), 2,</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                                       DifferentOp1-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() + <span class="stringliteral">&quot;.sink&quot;</span>,</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                                       BBEnd-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;      MapValueFromBB1ToBB2[DifferentOp1] = std::make_pair(DifferentOp2, NewPN);</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      <span class="comment">// I1 should use NewPN instead of DifferentOp1.</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;      I1-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(Op1Idx, NewPN);</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;      NewPN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(DifferentOp1, BB1);</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;      NewPN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(DifferentOp2, BB2);</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Create PHI node &quot;</span> &lt;&lt; *NewPN &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;);</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    }</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *OldPN = MapValueFromBB1ToBB2[I1].second;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    MapValueFromBB1ToBB2.erase(I1);</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SINK common instructions &quot;</span> &lt;&lt; *I1 &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;);</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;                         &quot;</span> &lt;&lt; *I2 &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;);</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <span class="comment">// We need to update RE1 and RE2 if we are going to sink the first</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="comment">// instruction in the basic block down.</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <span class="keywordtype">bool</span> UpdateRE1 = (I1 == BB1-&gt;begin()), UpdateRE2 = (I2 == BB2-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <span class="comment">// Sink the instruction.</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    BBEnd-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#afe55b235779222b867c16d3321c1cd16">splice</a>(FirstNonPhiInBBEnd, BB1-&gt;getInstList(), I1);</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    <span class="keywordflow">if</span> (!OldPN-&gt;use_empty())</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      OldPN-&gt;replaceAllUsesWith(I1);</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    OldPN-&gt;eraseFromParent();</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <span class="keywordflow">if</span> (!I2-&gt;use_empty())</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      I2-&gt;replaceAllUsesWith(I1);</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    I1-&gt;<a class="code" href="classllvm_1_1Value.html#a12b091e586dea5849c4d85723d2cba1b">intersectOptionalDataWith</a>(I2);</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    I2-&gt;eraseFromParent();</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="keywordflow">if</span> (UpdateRE1)</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      RE1 = BB1-&gt;getInstList().rend();</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="keywordflow">if</span> (UpdateRE2)</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      RE2 = BB2-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#a99d24ef8a3c3b81d43fa244e43f976fc">rend</a>();</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    FirstNonPhiInBBEnd = I1;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    NumSinkCommons++;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  }</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;}</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment">/// \brief Determine if we can hoist sink a sole store instruction out of a</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="comment">/// conditional block.</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="comment">/// We are looking for code like the following:</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment">///   BrBB:</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="comment">///     store i32 %add, i32* %arrayidx2</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment">///     ... // No other stores or function calls (we could be calling a memory</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment">///     ... // function).</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment">///     %cmp = icmp ult %x, %y</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment">///     br i1 %cmp, label %EndBB, label %ThenBB</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="comment">///   ThenBB:</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="comment">///     store i32 %add5, i32* %arrayidx2</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">///     br label EndBB</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="comment">///   EndBB:</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="comment">///     ...</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="comment">///   We are going to transform this into:</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="comment">///   BrBB:</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="comment">///     store i32 %add, i32* %arrayidx2</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="comment">///     ... //</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment">///     %cmp = icmp ult %x, %y</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="comment">///     %add.add5 = select i1 %cmp, i32 %add, %add5</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="comment">///     store i32 %add.add5, i32* %arrayidx2</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="comment">///     ...</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment">/// \return The pointer to the value of the previous store if the store can be</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment">///         hoisted into the predecessor block. 0 otherwise.</span></div><div class="line"><a name="l01324"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a2ced9ed2427730cd9b6903f00cd22e4d"> 1324</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="SimplifyCFG_8cpp.html#a2ced9ed2427730cd9b6903f00cd22e4d">isSafeToSpeculateStore</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BrBB,</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;                                     <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *StoreBB, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *EndBB) {</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *StoreToHoist = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <span class="keywordflow">if</span> (!StoreToHoist)</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  <span class="comment">// Volatile or atomic.</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;  <span class="keywordflow">if</span> (!StoreToHoist-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a1149c7eeefca671ac2685bca13843568">isSimple</a>())</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *StorePtr = StoreToHoist-&gt;<a class="code" href="classllvm_1_1StoreInst.html#ac03c1c093059ea000216af8dd6f2dbf4">getPointerOperand</a>();</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="comment">// Look for a store to the same pointer in BrBB.</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <span class="keywordtype">unsigned</span> MaxNumInstToLookAt = 10;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1BasicBlock.html#ad403e5f1b62843ac7584a2c51c63bfa3">BasicBlock::reverse_iterator</a> RI = BrBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a1c2af7a9e501d399f06ca7e10eef46e4">rbegin</a>(),</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;       RE = BrBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a9237251072bf6816163abc2d053212ee">rend</a>(); RI != RE &amp;&amp; (--MaxNumInstToLookAt); ++RI) {</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *CurI = &amp;*RI;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="comment">// Could be calling an instruction that effects memory like free().</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    <span class="keywordflow">if</span> (CurI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a573063aad4c101462893d0490d867524">mayHaveSideEffects</a>() &amp;&amp; !isa&lt;StoreInst&gt;(CurI))</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>&gt;(CurI);</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="comment">// Found the previous store make sure it stores to the same location.</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <span class="keywordflow">if</span> (SI &amp;&amp; SI-&gt;<a class="code" href="classllvm_1_1StoreInst.html#ac03c1c093059ea000216af8dd6f2dbf4">getPointerOperand</a>() == StorePtr)</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      <span class="comment">// Found the previous store, return its value operand.</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      <span class="keywordflow">return</span> SI-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>();</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SI)</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      <span class="keywordflow">return</span> 0; <span class="comment">// Unknown store.</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  }</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;}</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">/// \brief Speculate a conditional basic block flattening the CFG.</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment">/// Note that this is a very risky transform currently. Speculating</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment">/// instructions like this is most often not desirable. Instead, there is an MI</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment">/// pass which can do it with full awareness of the resource constraints.</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment">/// However, some cases are &quot;obvious&quot; and we should do directly. An example of</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="comment">/// this is speculating a single, reasonably cheap instruction.</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment">/// There is only one distinct advantage to flattening the CFG at the IR level:</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment">/// it makes very common but simplistic optimizations such as are common in</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment">/// instcombine and the DAG combiner more powerful by removing CFG edges and</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment">/// modeling their effects with easier to reason about SSA value graphs.</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="comment">/// An illustration of this transform is turning this IR:</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="comment">/// \code</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="comment">///   BB:</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="comment">///     %cmp = icmp ult %x, %y</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="comment">///     br i1 %cmp, label %EndBB, label %ThenBB</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="comment">///   ThenBB:</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="comment">///     %sub = sub %x, %y</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="comment">///     br label BB2</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="comment">///   EndBB:</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="comment">///     %phi = phi [ %sub, %ThenBB ], [ 0, %EndBB ]</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment">///     ...</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment">/// \endcode</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment">/// Into this IR:</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">/// \code</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">///   BB:</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment">///     %cmp = icmp ult %x, %y</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment">///     %sub = sub %x, %y</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">///     %cond = select i1 %cmp, 0, %sub</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment">///     ...</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment">/// \endcode</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment">/// \returns true if the conditional block is removed.</span></div><div class="line"><a name="l01395"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ab63479922d7b88d6b4fc5d31458e44fd"> 1395</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#ab63479922d7b88d6b4fc5d31458e44fd">SpeculativelyExecuteBB</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ThenBB) {</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;  <span class="comment">// Be conservative for now. FP select instruction can often be expensive.</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *BrCond = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>();</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  <span class="keywordflow">if</span> (isa&lt;FCmpInst&gt;(BrCond))</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *EndBB = ThenBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>()-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a3aac3b6c36415a2b08f65ead9e3e51e7">getSuccessor</a>(0);</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  <span class="comment">// If ThenBB is actually on the false edge of the conditional branch, remember</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;  <span class="comment">// to swap the select operands later.</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  <span class="keywordtype">bool</span> Invert = <span class="keyword">false</span>;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  <span class="keywordflow">if</span> (ThenBB != BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0)) {</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    assert(ThenBB == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1) &amp;&amp; <span class="stringliteral">&quot;No edge from &#39;if&#39; block?&quot;</span>);</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    Invert = <span class="keyword">true</span>;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  }</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  assert(EndBB == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(!Invert) &amp;&amp; <span class="stringliteral">&quot;No edge from to end block&quot;</span>);</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  <span class="comment">// Keep a count of how many times instructions are used within CondBB when</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  <span class="comment">// they are candidates for sinking into CondBB. Specifically:</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  <span class="comment">// - They are defined in BB, and</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  <span class="comment">// - They have no side effects, and</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  <span class="comment">// - All of their uses are in CondBB.</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;Instruction *, unsigned, 4&gt;</a> SinkCandidateUseCounts;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  <span class="keywordtype">unsigned</span> SpeculationCost = 0;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *SpeculatedStoreValue = 0;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SpeculatedStore = 0;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = ThenBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(),</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;                            BBE = <a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(ThenBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;       BBI != BBE; ++BBI) {</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BBI;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    <span class="comment">// Skip debug info.</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="keywordflow">if</span> (isa&lt;DbgInfoIntrinsic&gt;(I))</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <span class="comment">// Only speculatively execution a single instruction (not counting the</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="comment">// terminator) for now.</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    ++SpeculationCost;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="keywordflow">if</span> (SpeculationCost &gt; 1)</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <span class="comment">// Don&#39;t hoist the instruction if it&#39;s unsafe or expensive.</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#acb7a7f0df849c2c44503352493524895">isSafeToSpeculativelyExecute</a>(I) &amp;&amp;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        !(<a class="code" href="SimplifyCFG_8cpp.html#a5d26d13ee0f270c3ad3cd25e7f798c89">HoistCondStores</a> &amp;&amp;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;          (SpeculatedStoreValue = <a class="code" href="SimplifyCFG_8cpp.html#a2ced9ed2427730cd9b6903f00cd22e4d">isSafeToSpeculateStore</a>(I, BB, ThenBB,</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;                                                         EndBB))))</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <span class="keywordflow">if</span> (!SpeculatedStoreValue &amp;&amp;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#aaaae27d25fe7431c2ad47c4fb12273e8">ComputeSpeculationCost</a>(I) &gt; <a class="code" href="SimplifyCFG_8cpp.html#a830a17648b2e5112beef220cc707c977">PHINodeFoldingThreshold</a>)</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <span class="comment">// Store the store speculation candidate.</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    <span class="keywordflow">if</span> (SpeculatedStoreValue)</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;      SpeculatedStore = cast&lt;StoreInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="comment">// Do not hoist the instruction if any of its operands are defined but not</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <span class="comment">// used in BB. The transformation will prevent the operand from</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <span class="comment">// being sunk into the use block.</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = I-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>(), e = I-&gt;<a class="code" href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">op_end</a>();</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;         <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *OpI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(*i);</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;      <span class="keywordflow">if</span> (!OpI || OpI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>() != BB ||</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;          OpI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a573063aad4c101462893d0490d867524">mayHaveSideEffects</a>())</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        <span class="keywordflow">continue</span>; <span class="comment">// Not a candidate for sinking.</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;      ++SinkCandidateUseCounts[OpI];</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    }</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  }</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  <span class="comment">// Consider any sink candidates which are only used in CondBB as costs for</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  <span class="comment">// speculation. Note, while we iterate over a DenseMap here, we are summing</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  <span class="comment">// and so iteration order isn&#39;t significant.</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;Instruction *, unsigned, 4&gt;::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> =</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;           SinkCandidateUseCounts.begin(), E = SinkCandidateUseCounts.end();</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first-&gt;getNumUses() == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second) {</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;      ++SpeculationCost;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      <span class="keywordflow">if</span> (SpeculationCost &gt; 1)</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    }</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  <span class="comment">// Check that the PHI nodes can be converted to selects.</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  <span class="keywordtype">bool</span> HaveRewritablePHIs = <span class="keyword">false</span>;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = EndBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;       <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OrigV = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(BB);</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ThenV = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(ThenBB);</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    <span class="comment">// FIXME: Try to remove some of the duplication with HoistThenElseCodeToIf.</span></div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    <span class="comment">// Skip PHIs which are trivial.</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    <span class="keywordflow">if</span> (ThenV == OrigV)</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    HaveRewritablePHIs = <span class="keyword">true</span>;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    <a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *OrigCE = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a>&gt;(OrigV);</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *ThenCE = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a>&gt;(ThenV);</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    <span class="keywordflow">if</span> (!OrigCE &amp;&amp; !ThenCE)</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      <span class="keywordflow">continue</span>; <span class="comment">// Known safe and cheap.</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <span class="keywordflow">if</span> ((ThenCE &amp;&amp; !<a class="code" href="namespacellvm.html#acb7a7f0df849c2c44503352493524895">isSafeToSpeculativelyExecute</a>(ThenCE)) ||</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;        (OrigCE &amp;&amp; !<a class="code" href="namespacellvm.html#acb7a7f0df849c2c44503352493524895">isSafeToSpeculativelyExecute</a>(OrigCE)))</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <span class="keywordtype">unsigned</span> OrigCost = OrigCE ? <a class="code" href="SimplifyCFG_8cpp.html#aaaae27d25fe7431c2ad47c4fb12273e8">ComputeSpeculationCost</a>(OrigCE) : 0;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordtype">unsigned</span> ThenCost = ThenCE ? <a class="code" href="SimplifyCFG_8cpp.html#aaaae27d25fe7431c2ad47c4fb12273e8">ComputeSpeculationCost</a>(ThenCE) : 0;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="keywordflow">if</span> (OrigCost + ThenCost &gt; 2 * <a class="code" href="SimplifyCFG_8cpp.html#a830a17648b2e5112beef220cc707c977">PHINodeFoldingThreshold</a>)</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    <span class="comment">// Account for the cost of an unfolded ConstantExpr which could end up</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    <span class="comment">// getting expanded into Instructions.</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    <span class="comment">// FIXME: This doesn&#39;t account for how many operations are combined in the</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    <span class="comment">// constant expression.</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    ++SpeculationCost;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    <span class="keywordflow">if</span> (SpeculationCost &gt; 1)</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;  }</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  <span class="comment">// If there are no PHIs to process, bail early. This helps ensure idempotence</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;  <span class="comment">// as well.</span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  <span class="keywordflow">if</span> (!HaveRewritablePHIs &amp;&amp; !(<a class="code" href="SimplifyCFG_8cpp.html#a5d26d13ee0f270c3ad3cd25e7f798c89">HoistCondStores</a> &amp;&amp; SpeculatedStoreValue))</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  <span class="comment">// If we get here, we can hoist the instruction and if-convert.</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SPECULATIVELY EXECUTING BB&quot;</span> &lt;&lt; *ThenBB &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;);</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  <span class="comment">// Insert a select of the value of the speculated store.</span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  <span class="keywordflow">if</span> (SpeculatedStoreValue) {</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;true, NoFolder&gt;</a> Builder(BI);</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *TrueV = SpeculatedStore-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">getValueOperand</a>();</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *FalseV = SpeculatedStoreValue;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <span class="keywordflow">if</span> (Invert)</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;      <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(TrueV, FalseV);</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#ae19d9d49f39d404703b42161ce788954">CreateSelect</a>(BrCond, TrueV, FalseV, TrueV-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() +</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;                                    <span class="stringliteral">&quot;.&quot;</span> + FalseV-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>());</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    SpeculatedStore-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, S);</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  }</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <span class="comment">// Hoist the instructions.</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#afe55b235779222b867c16d3321c1cd16">splice</a>(BI, ThenBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>(), ThenBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(),</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;                           <a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(ThenBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>()));</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <span class="comment">// Insert selects and rewrite the PHI operands.</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;true, NoFolder&gt;</a> Builder(BI);</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = EndBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;       <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    <span class="keywordtype">unsigned</span> OrigI = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a5c2b7d7f19aac93b27b845858a7eb73e">getBasicBlockIndex</a>(BB);</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    <span class="keywordtype">unsigned</span> ThenI = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a5c2b7d7f19aac93b27b845858a7eb73e">getBasicBlockIndex</a>(ThenBB);</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OrigV = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(OrigI);</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ThenV = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(ThenI);</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="comment">// Skip PHIs which are trivial.</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="keywordflow">if</span> (OrigV == ThenV)</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <span class="comment">// Create a select whose true value is the speculatively executed value and</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <span class="comment">// false value is the preexisting value. Swap them if the branch</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    <span class="comment">// destinations were inverted.</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *TrueV = ThenV, *FalseV = OrigV;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <span class="keywordflow">if</span> (Invert)</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;      <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(TrueV, FalseV);</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#ae19d9d49f39d404703b42161ce788954">CreateSelect</a>(BrCond, TrueV, FalseV,</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;                                    TrueV-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() + <span class="stringliteral">&quot;.&quot;</span> + FalseV-&gt;getName());</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(OrigI, V);</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(ThenI, V);</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  }</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  ++NumSpeculations;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;}</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;<span class="comment">/// \returns True if this block contains a CallInst with the NoDuplicate</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="comment">/// attribute.</span></div><div class="line"><a name="l01567"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#acb11ec5ef64171078a81b9e8d6d56585"> 1567</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#acb11ec5ef64171078a81b9e8d6d56585">HasNoDuplicateCall</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::const_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), E = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1CallInst.html">CallInst</a>&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    <span class="keywordflow">if</span> (!CI)</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a1cb46775fb4cd36bb709216d0d45bf36">cannotDuplicate</a>())</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  }</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;}</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="comment">/// BlockIsSimpleEnoughToThreadThrough - Return true if we can thread a branch</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="comment">/// across this block.</span></div><div class="line"><a name="l01580"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a03a2d451a241c934af3405a7cfc8adb4"> 1580</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a03a2d451a241c934af3405a7cfc8adb4">BlockIsSimpleEnoughToThreadThrough</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = cast&lt;BranchInst&gt;(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  <span class="keywordtype">unsigned</span> Size = 0;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); &amp;*BBI != BI; ++BBI) {</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="keywordflow">if</span> (isa&lt;DbgInfoIntrinsic&gt;(BBI))</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <span class="keywordflow">if</span> (Size &gt; 10) <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Don&#39;t clone large BB&#39;s.</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    ++Size;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    <span class="comment">// We can only support instructions that do not define values that are</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    <span class="comment">// live outside of the current basic block.</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = BBI-&gt;use_begin(), E = BBI-&gt;use_end();</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;         UI != E; ++UI) {</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *U = cast&lt;Instruction&gt;(*UI);</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;      <span class="keywordflow">if</span> (U-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>() != BB || isa&lt;PHINode&gt;(U)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    }</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    <span class="comment">// Looks ok, continue checking.</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;  }</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;}</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="comment">/// FoldCondBranchOnPHI - If we have a conditional branch on a PHI node value</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment">/// that is defined in the same block as the branch and if any PHI entries are</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="comment">/// constants, thread edges corresponding to that entry to be branches to their</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="comment">/// ultimate destination.</span></div><div class="line"><a name="l01608"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a1e3544295480ec7b23c650873d046538"> 1608</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a1e3544295480ec7b23c650873d046538">FoldCondBranchOnPHI</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD) {</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>());</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  <span class="comment">// NOTE: we currently cannot transform this case if the PHI node is used</span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;  <span class="comment">// outside of the block.</span></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;  <span class="keywordflow">if</span> (!PN || PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>() != BB || !PN-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>())</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  <span class="comment">// Degenerate case of a single entry PHI.</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  <span class="keywordflow">if</span> (PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>() == 1) {</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    <a class="code" href="namespacellvm.html#a877641e6e9032688e668adb7dcca7536">FoldSingleEntryPHINodes</a>(PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;  }</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;  <span class="comment">// Now we know that this block has multiple preds and two succs.</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a03a2d451a241c934af3405a7cfc8adb4">BlockIsSimpleEnoughToThreadThrough</a>(BB)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#acb11ec5ef64171078a81b9e8d6d56585">HasNoDuplicateCall</a>(BB)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;  <span class="comment">// Okay, this is a simple enough basic block.  See if any phi values are</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  <span class="comment">// constants.</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CB = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    <span class="keywordflow">if</span> (CB == 0 || !CB-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a240475f85dea79ec272c578fdf89acf1">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a6e328feb83afa5cf1c966d6704e43fc1">isIntegerTy</a>(1)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    <span class="comment">// Okay, we now know that all edges from PredBB should be revectored to</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    <span class="comment">// branch to RealDest.</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredBB = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *RealDest = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(!CB-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>());</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <span class="keywordflow">if</span> (RealDest == BB) <span class="keywordflow">continue</span>;  <span class="comment">// Skip self loops.</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    <span class="comment">// Skip if the predecessor&#39;s terminator is an indirect branch.</span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    <span class="keywordflow">if</span> (isa&lt;IndirectBrInst&gt;(PredBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>())) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    <span class="comment">// The dest block might have PHI nodes, other predecessors and other</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <span class="comment">// difficult cases.  Instead of being smart about this, just insert a new</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <span class="comment">// block that jumps to the destination block, effectively splitting</span></div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    <span class="comment">// the edge we are about to create.</span></div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *EdgeBB = <a class="code" href="classllvm_1_1BasicBlock.html#ae1d53a21892854816885c7288f8b46f1">BasicBlock::Create</a>(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ad652423d9d91271ba153eb86482b2f55">getContext</a>(),</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;                                            RealDest-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.critedge&quot;</span>,</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;                                            RealDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>(), RealDest);</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html#ae9cbc599309fd2da33ec1c61df01ce1f">BranchInst::Create</a>(RealDest, EdgeBB);</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    <span class="comment">// Update PHI nodes.</span></div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#adfeed3997bba12e75a8e51d740f1969d">AddPredecessorToBlock</a>(RealDest, EdgeBB, BB);</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="comment">// BB may have instructions that are being threaded over.  Clone these</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    <span class="comment">// instructions into EdgeBB.  We know that there will be no uses of the</span></div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="comment">// cloned instructions outside of EdgeBB.</span></div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> InsertPt = EdgeBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value*, Value*&gt;</a> TranslateMap;  <span class="comment">// Track translated values.</span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); &amp;*BBI != BI; ++BBI) {</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(BBI)) {</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        TranslateMap[PN] = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(PredBB);</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;      }</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;      <span class="comment">// Clone the instruction.</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = BBI-&gt;clone();</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      <span class="keywordflow">if</span> (BBI-&gt;hasName()) N-&gt;<a class="code" href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">setName</a>(BBI-&gt;getName()+<span class="stringliteral">&quot;.c&quot;</span>);</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      <span class="comment">// Update operands due to translation.</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = N-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>(), e = N-&gt;<a class="code" href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">op_end</a>();</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;           <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value*, Value*&gt;::iterator</a> PI = TranslateMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">find</a>(*<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        <span class="keywordflow">if</span> (PI != TranslateMap.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>())</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;          *<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = PI-&gt;second;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      }</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;      <span class="comment">// Check for trivial simplification.</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#a50f8f41fccbea466816345520e9bfabb">SimplifyInstruction</a>(N, TD)) {</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        TranslateMap[BBI] = V;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        <span class="keyword">delete</span> <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>;   <span class="comment">// Instruction folded away, don&#39;t need actual inst</span></div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        <span class="comment">// Insert the new instruction into its new home.</span></div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        EdgeBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#a35c71de7e8bbe3c0353d042beb58263f">insert</a>(InsertPt, N);</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;        <span class="keywordflow">if</span> (!BBI-&gt;use_empty())</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;          TranslateMap[BBI] = N;</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;      }</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    }</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    <span class="comment">// Loop over all of the edges from PredBB to BB, changing them to branch</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    <span class="comment">// to EdgeBB instead.</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;    <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *PredBBTI = PredBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>();</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PredBBTI-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a4c26d3b92af99a6c8defd89a2d39ca32">getNumSuccessors</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;      <span class="keywordflow">if</span> (PredBBTI-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a3aac3b6c36415a2b08f65ead9e3e51e7">getSuccessor</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) == <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;        BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6f6763e343549d530a1424f1b24053bb">removePredecessor</a>(PredBB);</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;        PredBBTI-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a79fb3df941bcb2ba32ba6438409d0c0b">setSuccessor</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, EdgeBB);</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;      }</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    <span class="comment">// Recurse, simplifying any other constants.</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="SimplifyCFG_8cpp.html#a1e3544295480ec7b23c650873d046538">FoldCondBranchOnPHI</a>(BI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;  }</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;}</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="comment">/// FoldTwoEntryPHINode - Given a BB that starts with the specified two-entry</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="comment">/// PHI node, see if we can eliminate it.</span></div><div class="line"><a name="l01706"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a518d290fbe6b5f5e314e5b4e29780635"> 1706</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a518d290fbe6b5f5e314e5b4e29780635">FoldTwoEntryPHINode</a>(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD) {</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;  <span class="comment">// Ok, this is a two entry PHI node.  Check to see if this is a simple &quot;if</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;  <span class="comment">// statement&quot;, which has a very simple dominance structure.  Basically, we</span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;  <span class="comment">// are trying to find the condition that is being branched on, which</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;  <span class="comment">// subsequently causes this merge to happen.  We really want control</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;  <span class="comment">// dependence information for this check, but simplifycfg can&#39;t keep it up</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  <span class="comment">// to date, and this catches most of the cases we care about anyway.</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *IfTrue, *IfFalse;</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *IfCond = <a class="code" href="namespacellvm.html#abcc98cb5da68b3d112f6a16137d1cec1">GetIfCondition</a>(BB, IfTrue, IfFalse);</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;  <span class="keywordflow">if</span> (!IfCond ||</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;      <span class="comment">// Don&#39;t bother if the branch will be constant folded trivially.</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;      isa&lt;ConstantInt&gt;(IfCond))</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  <span class="comment">// Okay, we found that we can merge this two-entry phi node into a select.</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  <span class="comment">// Doing so would require us to fold *all* two entry phi nodes in this block.</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;  <span class="comment">// At some point this becomes non-profitable (particularly if the target</span></div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;  <span class="comment">// doesn&#39;t support cmov&#39;s).  Only do this transformation if there are two or</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;  <span class="comment">// fewer PHI nodes in this block.</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  <span class="keywordtype">unsigned</span> NumPhis = 0;</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); isa&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++NumPhis, ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    <span class="keywordflow">if</span> (NumPhis &gt; 2)</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;  <span class="comment">// Loop over the PHI&#39;s seeing if we can promote them all to select</span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;  <span class="comment">// instructions.  While we are at it, keep track of the instructions</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;  <span class="comment">// that need to be moved to the dominating block.</span></div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction*, 4&gt;</a> AggressiveInsts;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;  <span class="keywordtype">unsigned</span> MaxCostVal0 = <a class="code" href="SimplifyCFG_8cpp.html#a830a17648b2e5112beef220cc707c977">PHINodeFoldingThreshold</a>,</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;           MaxCostVal1 = <a class="code" href="SimplifyCFG_8cpp.html#a830a17648b2e5112beef220cc707c977">PHINodeFoldingThreshold</a>;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> II = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); isa&lt;PHINode&gt;(II);) {</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = cast&lt;PHINode&gt;(II++);</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#a50f8f41fccbea466816345520e9bfabb">SimplifyInstruction</a>(PN, TD)) {</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;      PN-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;      PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    }</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#ad3acb8f156ef3691661eae4471cb4887">DominatesMergePoint</a>(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(0), <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, &amp;AggressiveInsts,</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;                             MaxCostVal0) ||</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;        !<a class="code" href="SimplifyCFG_8cpp.html#ad3acb8f156ef3691661eae4471cb4887">DominatesMergePoint</a>(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(1), <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, &amp;AggressiveInsts,</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;                             MaxCostVal1))</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;  }</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;  <span class="comment">// If we folded the first phi, PN dangles at this point.  Refresh it.  If</span></div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;  <span class="comment">// we ran out of PHIs then we simplified them all.</span></div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;  PN = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  <span class="keywordflow">if</span> (PN == 0) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;  <span class="comment">// Don&#39;t fold i1 branches on PHIs which contain binary operators.  These can</span></div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;  <span class="comment">// often be turned into switches and other things.</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;  <span class="keywordflow">if</span> (PN-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a6e328feb83afa5cf1c966d6704e43fc1">isIntegerTy</a>(1) &amp;&amp;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      (isa&lt;BinaryOperator&gt;(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(0)) ||</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;       isa&lt;BinaryOperator&gt;(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(1)) ||</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;       isa&lt;BinaryOperator&gt;(IfCond)))</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;  <span class="comment">// If we all PHI nodes are promotable, check to make sure that all</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;  <span class="comment">// instructions in the predecessor blocks can be promoted as well.  If</span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;  <span class="comment">// not, we won&#39;t be able to get rid of the control flow, so it&#39;s not</span></div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;  <span class="comment">// worth promoting to select instructions.</span></div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DomBlock = 0;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *IfBlock1 = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(0);</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *IfBlock2 = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(1);</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;  <span class="keywordflow">if</span> (cast&lt;BranchInst&gt;(IfBlock1-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>())-&gt;isConditional()) {</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    IfBlock1 = 0;</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    DomBlock = *<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(IfBlock1);</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = IfBlock1-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();!isa&lt;TerminatorInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;      <span class="keywordflow">if</span> (!AggressiveInsts.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !isa&lt;DbgInfoIntrinsic&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        <span class="comment">// This is not an aggressive instruction that we can promote.</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        <span class="comment">// Because of this, we won&#39;t be able to get rid of the control</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;        <span class="comment">// flow, so the xform is not worth it.</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;      }</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;  }</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;  <span class="keywordflow">if</span> (cast&lt;BranchInst&gt;(IfBlock2-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>())-&gt;isConditional()) {</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    IfBlock2 = 0;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    DomBlock = *<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(IfBlock2);</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = IfBlock2-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();!isa&lt;TerminatorInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;      <span class="keywordflow">if</span> (!AggressiveInsts.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !isa&lt;DbgInfoIntrinsic&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;        <span class="comment">// This is not an aggressive instruction that we can promote.</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;        <span class="comment">// Because of this, we won&#39;t be able to get rid of the control</span></div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;        <span class="comment">// flow, so the xform is not worth it.</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;      }</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  }</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;FOUND IF CONDITION!  &quot;</span> &lt;&lt; *IfCond &lt;&lt; <span class="stringliteral">&quot;  T: &quot;</span></div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;               &lt;&lt; IfTrue-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() &lt;&lt; <span class="stringliteral">&quot;  F: &quot;</span> &lt;&lt; IfFalse-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;  <span class="comment">// If we can still promote the PHI nodes after this gauntlet of tests,</span></div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;  <span class="comment">// do all of the PHI&#39;s now.</span></div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertPt = DomBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>();</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;true, NoFolder&gt;</a> Builder(InsertPt);</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;  <span class="comment">// Move all &#39;aggressive&#39; instructions, which are defined in the</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;  <span class="comment">// conditional parts of the if&#39;s up to the dominating block.</span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;  <span class="keywordflow">if</span> (IfBlock1)</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    DomBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#afe55b235779222b867c16d3321c1cd16">splice</a>(InsertPt,</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;                                   IfBlock1-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>(), IfBlock1-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(),</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                                   IfBlock1-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;  <span class="keywordflow">if</span> (IfBlock2)</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    DomBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#afe55b235779222b867c16d3321c1cd16">splice</a>(InsertPt,</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;                                   IfBlock2-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>(), IfBlock2-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(),</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;                                   IfBlock2-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>())) {</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <span class="comment">// Change the PHI node into a select instruction.</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *TrueVal  = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(0) == IfFalse);</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *FalseVal = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(0) == IfTrue);</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8">NV</a> =</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;      cast&lt;SelectInst&gt;(Builder.<a class="code" href="classllvm_1_1IRBuilder.html#ae19d9d49f39d404703b42161ce788954">CreateSelect</a>(IfCond, TrueVal, FalseVal, <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    PN-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NV);</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    NV-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(PN);</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;  }</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  <span class="comment">// At this point, IfBlock1 and IfBlock2 are both empty, so our if statement</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  <span class="comment">// has been flattened.  Change DomBlock to jump directly to our new block to</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  <span class="comment">// avoid other simplifycfg&#39;s kicking in on the diamond.</span></div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *OldTI = DomBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>();</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;  Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(OldTI);</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;  Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a0c00110a06b1eb96c92f87e4ca28129a">CreateBr</a>(BB);</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;  OldTI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;}</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="comment">/// SimplifyCondBranchToTwoReturns - If we found a conditional branch that goes</span></div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment">/// to two returning blocks, try to merge them together into one return,</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="comment">/// introducing a select if the return values disagree.</span></div><div class="line"><a name="l01843"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a2e1b28b7b4b85744d3a02881d4601122"> 1843</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a2e1b28b7b4b85744d3a02881d4601122">SimplifyCondBranchToTwoReturns</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI,</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;                                           <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder) {</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;  assert(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a03cc0dff22b31447f43af97acb76b1a2">isConditional</a>() &amp;&amp; <span class="stringliteral">&quot;Must be a conditional branch&quot;</span>);</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TrueSucc = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0);</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *FalseSucc = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1);</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;  <a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *TrueRet = cast&lt;ReturnInst&gt;(TrueSucc-&gt;getTerminator());</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;  <a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *FalseRet = cast&lt;ReturnInst&gt;(FalseSucc-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  <span class="comment">// Check to ensure both blocks are empty (just a return) or optionally empty</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  <span class="comment">// with PHI nodes.  If there are other instructions, merging would cause extra</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  <span class="comment">// computation on one path or the other.</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  <span class="keywordflow">if</span> (!TrueSucc-&gt;getFirstNonPHIOrDbg()-&gt;isTerminator())</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;  <span class="keywordflow">if</span> (!FalseSucc-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a225cbda41f4c27fbb522833e31cb18f9">getFirstNonPHIOrDbg</a>()-&gt;<a class="code" href="classllvm_1_1Instruction.html#a237e6bf58bc993ea494bdde7480ca428">isTerminator</a>())</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;  Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(BI);</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;  <span class="comment">// Okay, we found a branch that is going to two return nodes.  If</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;  <span class="comment">// there is no return value for this function, just change the</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;  <span class="comment">// branch into a return.</span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;  <span class="keywordflow">if</span> (FalseRet-&gt;getNumOperands() == 0) {</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    TrueSucc-&gt;removePredecessor(BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    FalseSucc-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6f6763e343549d530a1424f1b24053bb">removePredecessor</a>(BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a5d84e72ef1f1b122131557e4b44f2f0d">CreateRetVoid</a>();</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">EraseTerminatorInstAndDCECond</a>(BI);</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;  }</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;  <span class="comment">// Otherwise, figure out what the true and false return values are</span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;  <span class="comment">// so we can insert a new select instruction.</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *TrueValue = TrueRet-&gt;<a class="code" href="classllvm_1_1ReturnInst.html#a7f6ab6ba1947d832a651e3589614a10d">getReturnValue</a>();</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *FalseValue = FalseRet-&gt;getReturnValue();</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;  <span class="comment">// Unwrap any PHI nodes in the return blocks.</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *TVPN = dyn_cast_or_null&lt;PHINode&gt;(TrueValue))</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <span class="keywordflow">if</span> (TVPN-&gt;getParent() == TrueSucc)</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      TrueValue = TVPN-&gt;getIncomingValueForBlock(BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *FVPN = dyn_cast_or_null&lt;PHINode&gt;(FalseValue))</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="keywordflow">if</span> (FVPN-&gt;getParent() == FalseSucc)</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;      FalseValue = FVPN-&gt;getIncomingValueForBlock(BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;  <span class="comment">// In order for this transformation to be safe, we must be able to</span></div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;  <span class="comment">// unconditionally execute both operands to the return.  This is</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;  <span class="comment">// normally the case, but we could have a potentially-trapping</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;  <span class="comment">// constant expression that prevents this transformation from being</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;  <span class="comment">// safe.</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *TCV = dyn_cast_or_null&lt;ConstantExpr&gt;(TrueValue))</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    <span class="keywordflow">if</span> (TCV-&gt;canTrap())</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *FCV = dyn_cast_or_null&lt;ConstantExpr&gt;(FalseValue))</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    <span class="keywordflow">if</span> (FCV-&gt;canTrap())</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;  <span class="comment">// Okay, we collected all the mapped values and checked them for sanity, and</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;  <span class="comment">// defined to really do this transformation.  First, update the CFG.</span></div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;  TrueSucc-&gt;removePredecessor(BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;  FalseSucc-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6f6763e343549d530a1424f1b24053bb">removePredecessor</a>(BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;  <span class="comment">// Insert select instructions where needed.</span></div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *BrCond = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>();</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;  <span class="keywordflow">if</span> (TrueValue) {</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <span class="comment">// Insert a select if the results differ.</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    <span class="keywordflow">if</span> (TrueValue == FalseValue || isa&lt;UndefValue&gt;(FalseValue)) {</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(TrueValue)) {</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;      TrueValue = FalseValue;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;      TrueValue = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#ae19d9d49f39d404703b42161ce788954">CreateSelect</a>(BrCond, TrueValue,</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;                                       FalseValue, <span class="stringliteral">&quot;retval&quot;</span>);</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    }</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;  }</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *RI = !TrueValue ?</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;    Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a5d84e72ef1f1b122131557e4b44f2f0d">CreateRetVoid</a>() : Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a08a2941811ad93b69f0174b5e8104cc6">CreateRet</a>(TrueValue);</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;  (void) RI;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\nCHANGING BRANCH TO TWO RETURNS INTO SELECT:&quot;</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;\n  &quot;</span> &lt;&lt; *BI &lt;&lt; <span class="stringliteral">&quot;NewRet = &quot;</span> &lt;&lt; *RI</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;TRUEBLOCK: &quot;</span> &lt;&lt; *TrueSucc &lt;&lt; <span class="stringliteral">&quot;FALSEBLOCK: &quot;</span>&lt;&lt; *FalseSucc);</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">EraseTerminatorInstAndDCECond</a>(BI);</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;}</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;<span class="comment">/// ExtractBranchMetadata - Given a conditional BranchInstruction, retrieve the</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;<span class="comment">/// probabilities of the branch taking each edge. Fills in the two APInt</span></div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;<span class="comment">/// parameters and return true, or returns false if no or invalid metadata was</span></div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;<span class="comment">/// found.</span></div><div class="line"><a name="l01932"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a50c9506d55e08fb67115a29dde75388a"> 1932</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a50c9506d55e08fb67115a29dde75388a">ExtractBranchMetadata</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI,</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;                                  uint64_t &amp;ProbTrue, uint64_t &amp;ProbFalse) {</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;  assert(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a03cc0dff22b31447f43af97acb76b1a2">isConditional</a>() &amp;&amp;</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;         <span class="stringliteral">&quot;Looking for probabilities on unconditional branch?&quot;</span>);</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;  <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *ProfileData = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#aafa29112cbe02e4adc9b36752c771991">getMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">LLVMContext::MD_prof</a>);</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;  <span class="keywordflow">if</span> (!ProfileData || ProfileData-&gt;getNumOperands() != 3) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CITrue = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(ProfileData-&gt;getOperand(1));</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CIFalse = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(ProfileData-&gt;getOperand(2));</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;  <span class="keywordflow">if</span> (!CITrue || !CIFalse) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;  ProbTrue = CITrue-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a7dc983ebf0eb2d255fa90a67063c72e2">getZExtValue</a>();</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;  ProbFalse = CIFalse-&gt;getValue().getZExtValue();</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;}</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;<span class="comment">/// checkCSEInPredecessor - Return true if the given instruction is available</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;<span class="comment">/// in its predecessor block. If yes, the instruction will be removed.</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01949"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a747b33c392f2a4faef1bf40a4d169c7d"> 1949</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a747b33c392f2a4faef1bf40a4d169c7d">checkCSEInPredecessor</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PB) {</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;BinaryOperator&gt;(Inst) &amp;&amp; !isa&lt;CmpInst&gt;(Inst))</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = PB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), E = PB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) {</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *PBI = &amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    <span class="comment">// Check whether Inst and PBI generate the same value.</span></div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    <span class="keywordflow">if</span> (Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#ac72e0be80ec7138a1ec42c798b249981">isIdenticalTo</a>(PBI)) {</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;      Inst-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(PBI);</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;      Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    }</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;  }</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;}</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;<span class="comment">/// FoldBranchToCommonDest - If this basic block is simple enough, and if a</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="comment">/// predecessor branches to us and one of our successors, fold the block into</span></div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;<span class="comment">/// the predecessor and use logical operations to pick the right destination.</span></div><div class="line"><a name="l01967"></a><span class="lineno"><a class="line" href="namespacellvm.html#ab75560d250028c3c4e54556421109b9d"> 1967</a></span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#ab75560d250028c3c4e54556421109b9d">llvm::FoldBranchToCommonDest</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI) {</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Cond = 0;</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;  <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a03cc0dff22b31447f43af97acb76b1a2">isConditional</a>())</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    Cond = dyn_cast&lt;Instruction&gt;(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>());</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    <span class="comment">// For unconditional branch, check for a simple CFG pattern, where</span></div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;    <span class="comment">// BB has a single predecessor and BB&#39;s successor is also its predecessor&#39;s</span></div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    <span class="comment">// successor. If such pattern exisits, check for CSE between BB and its</span></div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    <span class="comment">// predecessor.</span></div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PB = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5ef55181ae0bb0f5c561b9a29087b1e5">getSinglePredecessor</a>())</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *PBI = dyn_cast&lt;BranchInst&gt;(PB-&gt;getTerminator()))</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;        <span class="keywordflow">if</span> (PBI-&gt;isConditional() &amp;&amp;</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;            (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0) == PBI-&gt;getSuccessor(0) ||</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;             BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0) == PBI-&gt;getSuccessor(1))) {</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), E = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>();</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;               <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ) {</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;            <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Curr = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;            <span class="keywordflow">if</span> (isa&lt;CmpInst&gt;(Curr)) {</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;              Cond = Curr;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;              <span class="keywordflow">break</span>;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;            }</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;            <span class="comment">// Quit if we can&#39;t remove this instruction.</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a747b33c392f2a4faef1bf40a4d169c7d">checkCSEInPredecessor</a>(Curr, PB))</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;              <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;          }</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;        }</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    <span class="keywordflow">if</span> (Cond == 0)</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;  }</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;  <span class="keywordflow">if</span> (Cond == 0 || (!isa&lt;CmpInst&gt;(Cond) &amp;&amp; !isa&lt;BinaryOperator&gt;(Cond)) ||</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;    Cond-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>() != BB || !Cond-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>())</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;  <span class="comment">// Only allow this if the condition is a simple instruction that can be</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;  <span class="comment">// executed unconditionally.  It must be in the same block as the branch, and</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;  <span class="comment">// must be at the front of the block.</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> FrontIt = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a33603355becfb1a050b62aa015c1cc57">front</a>();</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;  <span class="comment">// Ignore dbg intrinsics.</span></div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;  <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(FrontIt)) ++FrontIt;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  <span class="comment">// Allow a single instruction to be hoisted in addition to the compare</span></div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;  <span class="comment">// that feeds the branch.  We later ensure that any values that _it_ uses</span></div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;  <span class="comment">// were also live in the predecessor, so that we don&#39;t unnecessarily create</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;  <span class="comment">// register pressure or inhibit out-of-order execution.</span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *BonusInst = 0;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;  <span class="keywordflow">if</span> (&amp;*FrontIt != Cond &amp;&amp;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;      FrontIt-&gt;hasOneUse() &amp;&amp; *FrontIt-&gt;use_begin() == Cond &amp;&amp;</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;      <a class="code" href="namespacellvm.html#acb7a7f0df849c2c44503352493524895">isSafeToSpeculativelyExecute</a>(FrontIt)) {</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    BonusInst = &amp;*FrontIt;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    ++FrontIt;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    <span class="comment">// Ignore dbg intrinsics.</span></div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(FrontIt)) ++FrontIt;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;  }</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;  <span class="comment">// Only a single bonus inst is allowed.</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;  <span class="keywordflow">if</span> (&amp;*FrontIt != Cond)</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;  <span class="comment">// Make sure the instruction after the condition is the cond branch.</span></div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> CondIt = Cond; ++CondIt;</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;  <span class="comment">// Ingore dbg intrinsics.</span></div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;  <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(CondIt)) ++CondIt;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;  <span class="keywordflow">if</span> (&amp;*CondIt != BI)</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;  <span class="comment">// Cond is known to be a compare or binary operator.  Check to make sure that</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;  <span class="comment">// neither operand is a potentially-trapping constant expression.</span></div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(Cond-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0)))</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    <span class="keywordflow">if</span> (CE-&gt;canTrap())</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(Cond-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1)))</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    <span class="keywordflow">if</span> (CE-&gt;canTrap())</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;  <span class="comment">// Finally, don&#39;t infinitely unroll conditional loops.</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TrueDest  = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0);</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *FalseDest = (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a03cc0dff22b31447f43af97acb76b1a2">isConditional</a>()) ? BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1) : 0;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;  <span class="keywordflow">if</span> (TrueDest == BB || FalseDest == BB)</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PredIterator.html">pred_iterator</a> PI = <a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(BB), E = <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(BB); PI != E; ++PI) {</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *PredBlock = *PI;</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *PBI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a>&gt;(PredBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <span class="comment">// Check that we have two conditional branches.  If there is a PHI node in</span></div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    <span class="comment">// the common successor, verify that the same value flows in from both</span></div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;    <span class="comment">// blocks.</span></div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;PHINode*, 4&gt;</a> PHIs;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;    <span class="keywordflow">if</span> (PBI == 0 || PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a382131e712e55e8324fbd5068de17b78">isUnconditional</a>() ||</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a03cc0dff22b31447f43af97acb76b1a2">isConditional</a>() &amp;&amp;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;         !<a class="code" href="SimplifyCFG_8cpp.html#a02215e210f29948498aeb844022afe53">SafeToMergeTerminators</a>(BI, PBI)) ||</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;        (!BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a03cc0dff22b31447f43af97acb76b1a2">isConditional</a>() &amp;&amp;</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;         !<a class="code" href="SimplifyCFG_8cpp.html#a69987e50a47c1566fa22b3cfd696e7ea">isProfitableToFoldUnconditional</a>(BI, PBI, Cond, PHIs)))</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;    <span class="comment">// Determine if the two branches share a common destination.</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> Opc = Instruction::BinaryOpsEnd;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;    <span class="keywordtype">bool</span> InvertPredCond = <span class="keyword">false</span>;</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a03cc0dff22b31447f43af97acb76b1a2">isConditional</a>()) {</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;      <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0) == TrueDest)</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;        Opc = <a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a>;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1) == FalseDest)</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;        Opc = <a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">Instruction::And</a>;</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0) == FalseDest)</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        Opc = <a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">Instruction::And</a>, InvertPredCond = <span class="keyword">true</span>;</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1) == TrueDest)</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;        Opc = <a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a>, InvertPredCond = <span class="keyword">true</span>;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0) != TrueDest &amp;&amp; PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1) != TrueDest)</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;    }</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;    <span class="comment">// Ensure that any values used in the bonus instruction are also used</span></div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    <span class="comment">// by the terminator of the predecessor.  This means that those values</span></div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    <span class="comment">// must already have been resolved, so we won&#39;t be inhibiting the</span></div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    <span class="comment">// out-of-order core by speculating them earlier. We also allow</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    <span class="comment">// instructions that are used by the terminator&#39;s condition because it</span></div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;    <span class="comment">// exposes more merging opportunities.</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;    <span class="keywordtype">bool</span> UsedByBranch = (BonusInst &amp;&amp; BonusInst-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>() &amp;&amp;</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;                         *BonusInst-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>() == Cond);</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;    <span class="keywordflow">if</span> (BonusInst &amp;&amp; !UsedByBranch) {</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;      <span class="comment">// Collect the values used by the bonus inst</span></div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;      <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value*, 4&gt;</a> UsedValues;</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Instruction::op_iterator</a> OI = BonusInst-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>(),</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;           OE = BonusInst-&gt;<a class="code" href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">op_end</a>(); OI != OE; ++OI) {</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *V = *OI;</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;        <span class="keywordflow">if</span> (!isa&lt;Constant&gt;(V) &amp;&amp; !isa&lt;Argument&gt;(V))</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;          UsedValues.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(V);</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;      }</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;Value*, unsigned&gt;</a>, 4&gt; Worklist;</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;      Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(PBI-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), 0));</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;      <span class="comment">// Walk up to four levels back up the use-def chain of the predecessor&#39;s</span></div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;      <span class="comment">// terminator to see if all those values were used.  The choice of four</span></div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;      <span class="comment">// levels is arbitrary, to provide a compile-time-cost bound.</span></div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;      <span class="keywordflow">while</span> (!Worklist.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;        std::pair&lt;Value*, unsigned&gt; Pair = Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>();</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;        Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#a1f2303df9bbee2233c11d61c2f6f7930">pop_back</a>();</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;        <span class="keywordflow">if</span> (Pair.second &gt;= 4) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;        UsedValues.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ce650c1d4a48661b501206d04b6ab04">erase</a>(Pair.first);</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;        <span class="keywordflow">if</span> (UsedValues.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a095445850ef2c64e96b4c05120cecf66">empty</a>()) <span class="keywordflow">break</span>;</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(Pair.first)) {</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">Instruction::op_iterator</a> OI = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;op_begin(), OE = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;op_end();</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;               OI != OE; ++OI)</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;            Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(OI-&gt;get(), Pair.second+1));</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;        }</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;      }</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;      <span class="keywordflow">if</span> (!UsedValues.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a095445850ef2c64e96b4c05120cecf66">empty</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;    }</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;FOLDING BRANCH TO COMMON DEST:\n&quot;</span> &lt;&lt; *PBI &lt;&lt; *BB);</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(PBI);</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;    <span class="comment">// If we need to invert the condition in the pred block to match, do so now.</span></div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;    <span class="keywordflow">if</span> (InvertPredCond) {</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *NewCond = PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>();</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;      <span class="keywordflow">if</span> (NewCond-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>() &amp;&amp; isa&lt;CmpInst&gt;(NewCond)) {</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;        <a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *CI = cast&lt;CmpInst&gt;(NewCond);</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;        CI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#a126a12b67fa620ad28ec0c919ca7a3e8">setPredicate</a>(CI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#a3c76890714593c78e3b5d142c9030548">getInversePredicate</a>());</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;        NewCond = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a9f4834f0678648c5ac86c9ab37210be3">CreateNot</a>(NewCond,</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                                    PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.not&quot;</span>);</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;      }</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;      PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a3505dab06f59c36142a234321cdc3411">setCondition</a>(NewCond);</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;      PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a6550fe5bd437c1c3c6e237d726e36b90">swapSuccessors</a>();</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    }</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;    <span class="comment">// If we have a bonus inst, clone it into the predecessor block.</span></div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NewBonus = 0;</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;    <span class="keywordflow">if</span> (BonusInst) {</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;      NewBonus = BonusInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#af6aad0c9ba7b8720130235c9621b55b5">clone</a>();</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;      PredBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#a35c71de7e8bbe3c0353d042beb58263f">insert</a>(PBI, NewBonus);</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;      NewBonus-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(BonusInst);</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;      BonusInst-&gt;<a class="code" href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">setName</a>(BonusInst-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.old&quot;</span>);</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;    }</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;    <span class="comment">// Clone Cond into the predecessor basic block, and or/and the</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;    <span class="comment">// two conditions together.</span></div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *New = Cond-&gt;<a class="code" href="classllvm_1_1Instruction.html#af6aad0c9ba7b8720130235c9621b55b5">clone</a>();</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;    <span class="keywordflow">if</span> (BonusInst) New-&gt;<a class="code" href="classllvm_1_1User.html#a1f0b9358936e3e00c42a460abbfb2868">replaceUsesOfWith</a>(BonusInst, NewBonus);</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    PredBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#a35c71de7e8bbe3c0353d042beb58263f">insert</a>(PBI, New);</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    New-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(Cond);</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    Cond-&gt;<a class="code" href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">setName</a>(New-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.old&quot;</span>);</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a03cc0dff22b31447f43af97acb76b1a2">isConditional</a>()) {</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NewCond =</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;        cast&lt;Instruction&gt;(Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a2bd8d3ea479e99434bac72362a59f078">CreateBinOp</a>(Opc, PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>(),</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;                                            New, <span class="stringliteral">&quot;or.cond&quot;</span>));</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;      PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a3505dab06f59c36142a234321cdc3411">setCondition</a>(NewCond);</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;      uint64_t PredTrueWeight, PredFalseWeight, SuccTrueWeight, SuccFalseWeight;</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;      <span class="keywordtype">bool</span> PredHasWeights = <a class="code" href="SimplifyCFG_8cpp.html#a50c9506d55e08fb67115a29dde75388a">ExtractBranchMetadata</a>(PBI, PredTrueWeight,</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;                                                  PredFalseWeight);</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;      <span class="keywordtype">bool</span> SuccHasWeights = <a class="code" href="SimplifyCFG_8cpp.html#a50c9506d55e08fb67115a29dde75388a">ExtractBranchMetadata</a>(BI, SuccTrueWeight,</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;                                                  SuccFalseWeight);</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint64_t, 8&gt;</a> NewWeights;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;      <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0) == <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;        <span class="keywordflow">if</span> (PredHasWeights &amp;&amp; SuccHasWeights) {</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;          <span class="comment">// PBI: br i1 %x, BB, FalseDest</span></div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;          <span class="comment">// BI:  br i1 %y, TrueDest, FalseDest</span></div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;          <span class="comment">//TrueWeight is TrueWeight for PBI * TrueWeight for BI.</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;          NewWeights.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(PredTrueWeight * SuccTrueWeight);</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;          <span class="comment">//FalseWeight is FalseWeight for PBI * TotalWeight for BI +</span></div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;          <span class="comment">//               TrueWeight for PBI * FalseWeight for BI.</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;          <span class="comment">// We assume that total weights of a BranchInst can fit into 32 bits.</span></div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;          <span class="comment">// Therefore, we will not have overflow using 64-bit arithmetic.</span></div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;          NewWeights.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(PredFalseWeight * (SuccFalseWeight +</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;               SuccTrueWeight) + PredTrueWeight * SuccFalseWeight);</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        }</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#adfeed3997bba12e75a8e51d740f1969d">AddPredecessorToBlock</a>(TrueDest, PredBlock, BB);</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;        PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(0, TrueDest);</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;      }</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;      <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1) == <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;        <span class="keywordflow">if</span> (PredHasWeights &amp;&amp; SuccHasWeights) {</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;          <span class="comment">// PBI: br i1 %x, TrueDest, BB</span></div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;          <span class="comment">// BI:  br i1 %y, TrueDest, FalseDest</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;          <span class="comment">//TrueWeight is TrueWeight for PBI * TotalWeight for BI +</span></div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;          <span class="comment">//              FalseWeight for PBI * TrueWeight for BI.</span></div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;          NewWeights.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(PredTrueWeight * (SuccFalseWeight +</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;              SuccTrueWeight) + PredFalseWeight * SuccTrueWeight);</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;          <span class="comment">//FalseWeight is FalseWeight for PBI * FalseWeight for BI.</span></div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;          NewWeights.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(PredFalseWeight * SuccFalseWeight);</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        }</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#adfeed3997bba12e75a8e51d740f1969d">AddPredecessorToBlock</a>(FalseDest, PredBlock, BB);</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;        PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(1, FalseDest);</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      }</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;      <span class="keywordflow">if</span> (NewWeights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 2) {</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;        <span class="comment">// Halve the weights if any of them cannot fit in an uint32_t</span></div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#a95ec32778f2bb913dc4cc45ac7a66e42">FitWeights</a>(NewWeights);</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint32_t, 8&gt;</a> MDWeights(NewWeights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),NewWeights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>());</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;        PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">LLVMContext::MD_prof</a>,</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;                         <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a>(BI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()).</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;                         createBranchWeights(MDWeights));</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      } <span class="keywordflow">else</span></div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;        PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">LLVMContext::MD_prof</a>, NULL);</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;      <span class="comment">// Update PHI nodes in the common successors.</span></div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PHIs.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;        <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *PBI_C = cast&lt;ConstantInt&gt;(</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;          PHIs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;getIncomingValueForBlock(PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()));</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;        assert(PBI_C-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a240475f85dea79ec272c578fdf89acf1">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a6e328feb83afa5cf1c966d6704e43fc1">isIntegerTy</a>(1));</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *MergedCond = 0;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;        <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0) == TrueDest) {</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;          <span class="comment">// Create (PBI_Cond and PBI_C) or (!PBI_Cond and BI_Value)</span></div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;          <span class="comment">// PBI_C is true: PBI_Cond or (!PBI_Cond and BI_Value)</span></div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;          <span class="comment">//       is false: !PBI_Cond and BI_Value</span></div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;          <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NotCond =</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;            cast&lt;Instruction&gt;(Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a9f4834f0678648c5ac86c9ab37210be3">CreateNot</a>(PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>(),</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                                <span class="stringliteral">&quot;not.cond&quot;</span>));</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;          MergedCond =</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;            cast&lt;Instruction&gt;(Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a2bd8d3ea479e99434bac72362a59f078">CreateBinOp</a>(<a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">Instruction::And</a>,</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;                                NotCond, New,</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                                <span class="stringliteral">&quot;and.cond&quot;</span>));</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;          <span class="keywordflow">if</span> (PBI_C-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#aa96ca2cf0bb1e924523900fb911b0a45">isOne</a>())</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;            MergedCond =</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;              cast&lt;Instruction&gt;(Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a2bd8d3ea479e99434bac72362a59f078">CreateBinOp</a>(<a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a>,</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;                                  PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>(), MergedCond,</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;                                  <span class="stringliteral">&quot;or.cond&quot;</span>));</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;          <span class="comment">// Create (PBI_Cond and BI_Value) or (!PBI_Cond and PBI_C)</span></div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;          <span class="comment">// PBI_C is true: (PBI_Cond and BI_Value) or (!PBI_Cond)</span></div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;          <span class="comment">//       is false: PBI_Cond and BI_Value</span></div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;          MergedCond =</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;            cast&lt;Instruction&gt;(Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a2bd8d3ea479e99434bac72362a59f078">CreateBinOp</a>(<a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">Instruction::And</a>,</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;                                PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>(), New,</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;                                <span class="stringliteral">&quot;and.cond&quot;</span>));</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;          <span class="keywordflow">if</span> (PBI_C-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#aa96ca2cf0bb1e924523900fb911b0a45">isOne</a>()) {</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;            <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NotCond =</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;              cast&lt;Instruction&gt;(Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a9f4834f0678648c5ac86c9ab37210be3">CreateNot</a>(PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>(),</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;                                  <span class="stringliteral">&quot;not.cond&quot;</span>));</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;            MergedCond =</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;              cast&lt;Instruction&gt;(Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a2bd8d3ea479e99434bac72362a59f078">CreateBinOp</a>(<a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a>,</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                                  NotCond, MergedCond,</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;                                  <span class="stringliteral">&quot;or.cond&quot;</span>));</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;          }</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;        }</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;        <span class="comment">// Update PHI Node.</span></div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;        PHIs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;setIncomingValue(PHIs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;getBasicBlockIndex(PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()),</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;                                  MergedCond);</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;      }</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;      <span class="comment">// Change PBI from Conditional to Unconditional.</span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;      <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *New_PBI = <a class="code" href="classllvm_1_1BranchInst.html#ae9cbc599309fd2da33ec1c61df01ce1f">BranchInst::Create</a>(TrueDest, PBI);</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;      <a class="code" href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">EraseTerminatorInstAndDCECond</a>(PBI);</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;      PBI = New_PBI;</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;    }</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    <span class="comment">// TODO: If BB is reachable from all paths through PredBlock, then we</span></div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    <span class="comment">// could replace PBI&#39;s branch probabilities with BI&#39;s.</span></div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;    <span class="comment">// Copy any debug value intrinsics into the end of PredBlock.</span></div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), E = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;      <span class="keywordflow">if</span> (isa&lt;DbgInfoIntrinsic&gt;(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;        <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;clone()-&gt;insertBefore(PBI);</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;  }</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;}</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;<span class="comment">/// SimplifyCondBranchToCondBranch - If we have a conditional branch as a</span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;<span class="comment">/// predecessor of another block, this function tries to simplify it.  We know</span></div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;<span class="comment">/// that PBI and BI are both conditional branches, and BI is in one of the</span></div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;<span class="comment">/// successor blocks of PBI - PBI branches to BI.</span></div><div class="line"><a name="l02290"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a285d756a993fe2460d35129ba58f92a2"> 2290</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a285d756a993fe2460d35129ba58f92a2">SimplifyCondBranchToCondBranch</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *PBI, <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI) {</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;  assert(PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a03cc0dff22b31447f43af97acb76b1a2">isConditional</a>() &amp;&amp; BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a03cc0dff22b31447f43af97acb76b1a2">isConditional</a>());</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;  <span class="comment">// If this block ends with a branch instruction, and if there is a</span></div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;  <span class="comment">// predecessor that ends on a branch of the same condition, make</span></div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;  <span class="comment">// this conditional branch redundant.</span></div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;  <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>() == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>() &amp;&amp;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;      PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0) != PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1)) {</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;    <span class="comment">// Okay, the outcome of this conditional branch is statically</span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;    <span class="comment">// knowable.  If this block had a single pred, handle specially.</span></div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;    <span class="keywordflow">if</span> (BB-&gt;getSinglePredecessor()) {</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;      <span class="comment">// Turn this into a branch on constant.</span></div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;      <span class="keywordtype">bool</span> CondIsTrue = PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0) == <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;      BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a3505dab06f59c36142a234321cdc3411">setCondition</a>(<a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(<a class="code" href="classllvm_1_1Type.html#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(BB-&gt;getContext()),</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;                                        CondIsTrue));</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;  <span class="comment">// Nuke the branch on constant.</span></div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;    }</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;    <span class="comment">// Otherwise, if there are multiple predecessors, insert a PHI that merges</span></div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;    <span class="comment">// in the constant and simplify the block result.  Subsequent passes of</span></div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;    <span class="comment">// simplifycfg will thread the block.</span></div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a03a2d451a241c934af3405a7cfc8adb4">BlockIsSimpleEnoughToThreadThrough</a>(BB)) {</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;      <a class="code" href="classllvm_1_1PredIterator.html">pred_iterator</a> PB = <a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(BB), PE = <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(BB);</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *NewPN = <a class="code" href="classllvm_1_1PHINode.html#afb5e83bf5123ff7c51058eb0ebebcdc6">PHINode::Create</a>(<a class="code" href="classllvm_1_1Type.html#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(BB-&gt;getContext()),</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;                                       std::distance(PB, PE),</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;                                       BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() + <span class="stringliteral">&quot;.pr&quot;</span>,</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;                                       BB-&gt;<a class="code" href="classllvm_1_1StringRef.html#a4a0abf8eb4fa5989df63172649cba99f">begin</a>());</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;      <span class="comment">// Okay, we&#39;re going to insert the PHI node.  Since PBI is not the only</span></div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;      <span class="comment">// predecessor, compute the PHI&#39;d conditional value for all of the preds.</span></div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;      <span class="comment">// Any predecessor where the condition is not computable we keep symbolic.</span></div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PredIterator.html">pred_iterator</a> PI = PB; PI != PE; ++PI) {</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;        <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = *PI;</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        <span class="keywordflow">if</span> ((PBI = dyn_cast&lt;BranchInst&gt;(P-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>())) &amp;&amp;</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;            PBI != BI &amp;&amp; PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a03cc0dff22b31447f43af97acb76b1a2">isConditional</a>() &amp;&amp;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;            PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>() == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>() &amp;&amp;</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;            PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0) != PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1)) {</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;          <span class="keywordtype">bool</span> CondIsTrue = PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0) == <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;          NewPN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(<a class="code" href="classllvm_1_1Type.html#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(BB-&gt;getContext()),</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;                                              CondIsTrue), <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>);</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;          NewPN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>(), <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>);</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;        }</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;      }</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;      BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a3505dab06f59c36142a234321cdc3411">setCondition</a>(NewPN);</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;    }</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;  }</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;  <span class="comment">// If this is a conditional branch in an empty block, and if any</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;  <span class="comment">// predecessors is a conditional branch to one of our destinations,</span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;  <span class="comment">// fold the conditions into logical ops and one cond br.</span></div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = BB-&gt;begin();</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;  <span class="comment">// Ignore dbg intrinsics.</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;  <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(BBI))</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    ++BBI;</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;  <span class="keywordflow">if</span> (&amp;*BBI != BI)</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>()))</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    <span class="keywordflow">if</span> (CE-&gt;canTrap())</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;  <span class="keywordtype">int</span> PBIOp, BIOp;</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;  <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0))</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    PBIOp = BIOp = 0;</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1))</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;    PBIOp = 0, BIOp = 1;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0))</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;    PBIOp = 1, BIOp = 0;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1))</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;    PBIOp = BIOp = 1;</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  <span class="comment">// Check to make sure that the other destination of this branch</span></div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;  <span class="comment">// isn&#39;t BB itself.  If so, this is an infinite loop that will</span></div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;  <span class="comment">// keep getting unwound.</span></div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;  <span class="keywordflow">if</span> (PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(PBIOp) == <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>)</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;  <span class="comment">// Do not perform this transformation if it would require</span></div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;  <span class="comment">// insertion of a large number of select instructions. For targets</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;  <span class="comment">// without predication/cmovs, this is a big pessimization.</span></div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CommonDest = PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(PBIOp);</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;  <span class="keywordtype">unsigned</span> NumPhis = 0;</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> II = CommonDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;       isa&lt;PHINode&gt;(II); ++II, ++NumPhis)</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;    <span class="keywordflow">if</span> (NumPhis &gt; 2) <span class="comment">// Disable this xform.</span></div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;  <span class="comment">// Finally, if everything is ok, fold the branches to logical ops.</span></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *OtherDest  = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(BIOp ^ 1);</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;FOLDING BRs:&quot;</span> &lt;&lt; *PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;AND: &quot;</span> &lt;&lt; *BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;  <span class="comment">// If OtherDest *is* BB, then BB is a basic block with a single conditional</span></div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;  <span class="comment">// branch in it, where one edge (OtherDest) goes back to itself but the other</span></div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;  <span class="comment">// exits.  We don&#39;t *know* that the program avoids the infinite loop</span></div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;  <span class="comment">// (even though that seems likely).  If we do this xform naively, we&#39;ll end up</span></div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;  <span class="comment">// recursively unpeeling the loop.  Since we know that (after the xform is</span></div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;  <span class="comment">// done) that the block *is* infinite if reached, we just make it an obviously</span></div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;  <span class="comment">// infinite loop with no cond branch.</span></div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;  <span class="keywordflow">if</span> (OtherDest == BB) {</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;    <span class="comment">// Insert it at the end of the function, because it&#39;s either code,</span></div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;    <span class="comment">// or it won&#39;t matter if it&#39;s hot. :)</span></div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *InfLoopBlock = <a class="code" href="classllvm_1_1BasicBlock.html#ae1d53a21892854816885c7288f8b46f1">BasicBlock::Create</a>(BB-&gt;getContext(),</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;                                                  <span class="stringliteral">&quot;infloop&quot;</span>, BB-&gt;getParent());</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html#ae9cbc599309fd2da33ec1c61df01ce1f">BranchInst::Create</a>(InfLoopBlock, InfLoopBlock);</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;    OtherDest = InfLoopBlock;</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;  }</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; *PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>());</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;  <span class="comment">// BI may have other predecessors.  Because of this, we leave</span></div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;  <span class="comment">// it alone, but modify PBI.</span></div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;  <span class="comment">// Make sure we get to CommonDest on True&amp;True directions.</span></div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *PBICond = PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>();</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;true, NoFolder&gt;</a> Builder(PBI);</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;  <span class="keywordflow">if</span> (PBIOp)</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;    PBICond = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a9f4834f0678648c5ac86c9ab37210be3">CreateNot</a>(PBICond, PBICond-&gt;getName()+<span class="stringliteral">&quot;.not&quot;</span>);</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *BICond = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>();</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;  <span class="keywordflow">if</span> (BIOp)</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;    BICond = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a9f4834f0678648c5ac86c9ab37210be3">CreateNot</a>(BICond, BICond-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.not&quot;</span>);</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;  <span class="comment">// Merge the conditions.</span></div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Cond = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a8f55dd4237be6778517ddd752ca8b76a">CreateOr</a>(PBICond, BICond, <span class="stringliteral">&quot;brmerge&quot;</span>);</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;  <span class="comment">// Modify PBI to branch on the new condition to the new dests.</span></div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;  PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a3505dab06f59c36142a234321cdc3411">setCondition</a>(Cond);</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;  PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(0, CommonDest);</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;  PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(1, OtherDest);</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;  <span class="comment">// Update branch weight for PBI.</span></div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;  uint64_t PredTrueWeight, PredFalseWeight, SuccTrueWeight, SuccFalseWeight;</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;  <span class="keywordtype">bool</span> PredHasWeights = <a class="code" href="SimplifyCFG_8cpp.html#a50c9506d55e08fb67115a29dde75388a">ExtractBranchMetadata</a>(PBI, PredTrueWeight,</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;                                              PredFalseWeight);</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;  <span class="keywordtype">bool</span> SuccHasWeights = <a class="code" href="SimplifyCFG_8cpp.html#a50c9506d55e08fb67115a29dde75388a">ExtractBranchMetadata</a>(BI, SuccTrueWeight,</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                                              SuccFalseWeight);</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;  <span class="keywordflow">if</span> (PredHasWeights &amp;&amp; SuccHasWeights) {</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;    uint64_t PredCommon = PBIOp ? PredFalseWeight : PredTrueWeight;</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;    uint64_t PredOther = PBIOp ?PredTrueWeight : PredFalseWeight;</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;    uint64_t SuccCommon = BIOp ? SuccFalseWeight : SuccTrueWeight;</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;    uint64_t SuccOther = BIOp ? SuccTrueWeight : SuccFalseWeight;</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;    <span class="comment">// The weight to CommonDest should be PredCommon * SuccTotal +</span></div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;    <span class="comment">//                                    PredOther * SuccCommon.</span></div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;    <span class="comment">// The weight to OtherDest should be PredOther * SuccOther.</span></div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint64_t, 2&gt;</a> NewWeights;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;    NewWeights.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(PredCommon * (SuccCommon + SuccOther) +</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                         PredOther * SuccCommon);</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;    NewWeights.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(PredOther * SuccOther);</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;    <span class="comment">// Halve the weights if any of them cannot fit in an uint32_t</span></div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a95ec32778f2bb913dc4cc45ac7a66e42">FitWeights</a>(NewWeights);</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint32_t, 2&gt;</a> MDWeights(NewWeights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),NewWeights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>());</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;    PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">LLVMContext::MD_prof</a>,</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;                     <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a>(BI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()).</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                     createBranchWeights(MDWeights));</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;  }</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;  <span class="comment">// OtherDest may have phi nodes.  If so, add an entry from PBI&#39;s</span></div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;  <span class="comment">// block that are identical to the entries for BI&#39;s block.</span></div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#adfeed3997bba12e75a8e51d740f1969d">AddPredecessorToBlock</a>(OtherDest, PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>(), <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;  <span class="comment">// We know that the CommonDest already had an edge from PBI to</span></div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;  <span class="comment">// it.  If it has PHIs though, the PHIs may have different</span></div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;  <span class="comment">// entries for BB and PBI&#39;s BB.  If so, insert a select to make</span></div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;  <span class="comment">// them agree.</span></div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN;</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> II = CommonDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;       (PN = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(II)); ++II) {</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *BIV = PN-&gt;getIncomingValueForBlock(BB);</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;    <span class="keywordtype">unsigned</span> PBBIdx = PN-&gt;getBasicBlockIndex(PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *PBIV = PN-&gt;getIncomingValue(PBBIdx);</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;    <span class="keywordflow">if</span> (BIV != PBIV) {</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;      <span class="comment">// Insert a select in PBI to pick the right value.</span></div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8">NV</a> = cast&lt;SelectInst&gt;</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;        (Builder.<a class="code" href="classllvm_1_1IRBuilder.html#ae19d9d49f39d404703b42161ce788954">CreateSelect</a>(PBICond, PBIV, BIV, PBIV-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.mux&quot;</span>));</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;      PN-&gt;setIncomingValue(PBBIdx, NV);</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;    }</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;  }</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;INTO: &quot;</span> &lt;&lt; *PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; *PBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>());</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;  <span class="comment">// This basic block is probably dead.  We know it has at least</span></div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;  <span class="comment">// one fewer predecessor.</span></div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;}</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;<span class="comment">// SimplifyTerminatorOnSelect - Simplifies a terminator by replacing it with a</span></div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;<span class="comment">// branch to TrueBB if Cond is true or to FalseBB if Cond is false.</span></div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;<span class="comment">// Takes care of updating the successors and removing the old terminator.</span></div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;<span class="comment">// Also makes sure not to introduce new successors by assuming that edges to</span></div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;<span class="comment">// non-successor TrueBBs and FalseBBs aren&#39;t reachable.</span></div><div class="line"><a name="l02492"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#aae15857ee04fb44315481a693e4562c4"> 2492</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#aae15857ee04fb44315481a693e4562c4">SimplifyTerminatorOnSelect</a>(<a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *OldTerm, <a class="code" href="classllvm_1_1Value.html">Value</a> *Cond,</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;                                       <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TrueBB, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *FalseBB,</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;                                       uint32_t TrueWeight,</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                                       uint32_t FalseWeight){</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;  <span class="comment">// Remove any superfluous successor edges from the CFG.</span></div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;  <span class="comment">// First, figure out which successors to preserve.</span></div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;  <span class="comment">// If TrueBB and FalseBB are equal, only try to preserve one copy of that</span></div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;  <span class="comment">// successor.</span></div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *KeepEdge1 = TrueBB;</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *KeepEdge2 = TrueBB != FalseBB ? FalseBB : 0;</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;  <span class="comment">// Then remove the rest.</span></div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = OldTerm-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a4c26d3b92af99a6c8defd89a2d39ca32">getNumSuccessors</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ = OldTerm-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a3aac3b6c36415a2b08f65ead9e3e51e7">getSuccessor</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;    <span class="comment">// Make sure only to keep exactly one copy of each edge.</span></div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;    <span class="keywordflow">if</span> (Succ == KeepEdge1)</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;      KeepEdge1 = 0;</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Succ == KeepEdge2)</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;      KeepEdge2 = 0;</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;      Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6f6763e343549d530a1424f1b24053bb">removePredecessor</a>(OldTerm-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;  }</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(OldTerm);</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;  Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a571ae7ebae7038da7f6073efc65aaa50">SetCurrentDebugLocation</a>(OldTerm-&gt;<a class="code" href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">getDebugLoc</a>());</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;  <span class="comment">// Insert an appropriate new terminator.</span></div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;  <span class="keywordflow">if</span> ((KeepEdge1 == 0) &amp;&amp; (KeepEdge2 == 0)) {</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;    <span class="keywordflow">if</span> (TrueBB == FalseBB)</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;      <span class="comment">// We were only looking for one successor, and it was present.</span></div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;      <span class="comment">// Create an unconditional branch to it.</span></div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;      Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a0c00110a06b1eb96c92f87e4ca28129a">CreateBr</a>(TrueBB);</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;      <span class="comment">// We found both of the successors we were looking for.</span></div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;      <span class="comment">// Create a conditional branch sharing the condition of the select.</span></div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;      <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *NewBI = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a75e386c51bb947f44935b3c392a8eb4f">CreateCondBr</a>(Cond, TrueBB, FalseBB);</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;      <span class="keywordflow">if</span> (TrueWeight != FalseWeight)</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;        NewBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">LLVMContext::MD_prof</a>,</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;                           <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a>(OldTerm-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()).</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;                           createBranchWeights(TrueWeight, FalseWeight));</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;    }</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (KeepEdge1 &amp;&amp; (KeepEdge2 || TrueBB == FalseBB)) {</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;    <span class="comment">// Neither of the selected blocks were successors, so this</span></div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;    <span class="comment">// terminator must be unreachable.</span></div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;    <span class="keyword">new</span> <a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a>(OldTerm-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), OldTerm);</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;    <span class="comment">// One of the selected values was a successor, but the other wasn&#39;t.</span></div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;    <span class="comment">// Insert an unconditional branch to the one that was found;</span></div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;    <span class="comment">// the edge to the one that wasn&#39;t must be unreachable.</span></div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    <span class="keywordflow">if</span> (KeepEdge1 == 0)</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;      <span class="comment">// Only TrueBB was found.</span></div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;      Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a0c00110a06b1eb96c92f87e4ca28129a">CreateBr</a>(TrueBB);</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;      <span class="comment">// Only FalseBB was found.</span></div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;      Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a0c00110a06b1eb96c92f87e4ca28129a">CreateBr</a>(FalseBB);</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;  }</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">EraseTerminatorInstAndDCECond</a>(OldTerm);</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;}</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;<span class="comment">// SimplifySwitchOnSelect - Replaces</span></div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;<span class="comment">//   (switch (select cond, X, Y)) on constant X, Y</span></div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;<span class="comment">// with a branch - conditional if X and Y lead to distinct BBs,</span></div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;<span class="comment">// unconditional otherwise.</span></div><div class="line"><a name="l02557"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#af0d7fe1e3aa12d83e0af774a398d34ab"> 2557</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#af0d7fe1e3aa12d83e0af774a398d34ab">SimplifySwitchOnSelect</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI, <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba32dbd2c72a98eaee90e3ad5ef7b5af16">Select</a>) {</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;  <span class="comment">// Check for constant integer values in the select.</span></div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *TrueVal = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(Select-&gt;<a class="code" href="classllvm_1_1SelectInst.html#a67bf091383cd61e1225445e78b61d9f9">getTrueValue</a>());</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *FalseVal = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(Select-&gt;<a class="code" href="classllvm_1_1SelectInst.html#a29a16f32075ee4f23cd769701463952c">getFalseValue</a>());</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;  <span class="keywordflow">if</span> (!TrueVal || !FalseVal)</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;  <span class="comment">// Find the relevant condition and destinations.</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Condition = Select-&gt;<a class="code" href="classllvm_1_1SelectInst.html#ad285a69e32ddeee367fed93b5f392801">getCondition</a>();</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TrueBB = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#ad3a1537c850f63ce48bcf45694cde73f">findCaseValue</a>(TrueVal).<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIteratorT.html#a143819a808ec85e9997566fdf42e9372">getCaseSuccessor</a>();</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *FalseBB = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#ad3a1537c850f63ce48bcf45694cde73f">findCaseValue</a>(FalseVal).<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIteratorT.html#a143819a808ec85e9997566fdf42e9372">getCaseSuccessor</a>();</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;  <span class="comment">// Get weight for TrueBB and FalseBB.</span></div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;  uint32_t TrueWeight = 0, FalseWeight = 0;</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint64_t, 8&gt;</a> Weights;</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;  <span class="keywordtype">bool</span> HasWeights = <a class="code" href="SimplifyCFG_8cpp.html#ada99fd4fd27356d1518273d8248940a5">HasBranchWeights</a>(SI);</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;  <span class="keywordflow">if</span> (HasWeights) {</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a165512f38f31f01e7f18bf3838f3a12e">GetBranchWeights</a>(SI, Weights);</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;    <span class="keywordflow">if</span> (Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 1 + SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a4901d4ad48420014059e9393f75442ae">getNumCases</a>()) {</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;      TrueWeight = (uint32_t)Weights[SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#ad3a1537c850f63ce48bcf45694cde73f">findCaseValue</a>(TrueVal).</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;                                     getSuccessorIndex()];</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;      FalseWeight = (uint32_t)Weights[SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#ad3a1537c850f63ce48bcf45694cde73f">findCaseValue</a>(FalseVal).</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;                                      getSuccessorIndex()];</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;    }</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;  }</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;  <span class="comment">// Perform the actual simplification.</span></div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="SimplifyCFG_8cpp.html#aae15857ee04fb44315481a693e4562c4">SimplifyTerminatorOnSelect</a>(SI, Condition, TrueBB, FalseBB,</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;                                    TrueWeight, FalseWeight);</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;}</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;<span class="comment">// SimplifyIndirectBrOnSelect - Replaces</span></div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;<span class="comment">//   (indirectbr (select cond, blockaddress(@fn, BlockA),</span></div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;<span class="comment">//                             blockaddress(@fn, BlockB)))</span></div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;<span class="comment">// with</span></div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;<span class="comment">//   (br cond, BlockA, BlockB).</span></div><div class="line"><a name="l02593"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a3ab1a6ec499c9bfd45258e149aa555c5"> 2593</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a3ab1a6ec499c9bfd45258e149aa555c5">SimplifyIndirectBrOnSelect</a>(<a class="code" href="classllvm_1_1IndirectBrInst.html">IndirectBrInst</a> *IBI, <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *SI) {</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;  <span class="comment">// Check that both operands of the select are block addresses.</span></div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;  <a class="code" href="classllvm_1_1BlockAddress.html">BlockAddress</a> *TBA = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1BlockAddress.html">BlockAddress</a>&gt;(SI-&gt;<a class="code" href="classllvm_1_1SelectInst.html#a67bf091383cd61e1225445e78b61d9f9">getTrueValue</a>());</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;  <a class="code" href="classllvm_1_1BlockAddress.html">BlockAddress</a> *FBA = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1BlockAddress.html">BlockAddress</a>&gt;(SI-&gt;<a class="code" href="classllvm_1_1SelectInst.html#a29a16f32075ee4f23cd769701463952c">getFalseValue</a>());</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;  <span class="keywordflow">if</span> (!TBA || !FBA)</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;  <span class="comment">// Extract the actual blocks.</span></div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *TrueBB = TBA-&gt;<a class="code" href="classllvm_1_1BlockAddress.html#a976bfd676bf773eadde49138cfc7dcb5">getBasicBlock</a>();</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *FalseBB = FBA-&gt;getBasicBlock();</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;  <span class="comment">// Perform the actual simplification.</span></div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="SimplifyCFG_8cpp.html#aae15857ee04fb44315481a693e4562c4">SimplifyTerminatorOnSelect</a>(IBI, SI-&gt;<a class="code" href="classllvm_1_1SelectInst.html#ad285a69e32ddeee367fed93b5f392801">getCondition</a>(), TrueBB, FalseBB,</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;                                    0, 0);</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;}</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;<span class="comment">/// TryToSimplifyUncondBranchWithICmpInIt - This is called when we find an icmp</span></div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;<span class="comment">/// instruction (a seteq/setne with a constant) as the only instruction in a</span></div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;<span class="comment">/// block that ends with an uncond branch.  We are looking for a very specific</span></div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;<span class="comment">/// pattern that occurs when &quot;A == 1 || A == 2 || A == 3&quot; gets simplified.  In</span></div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;<span class="comment">/// this case, we merge the first two &quot;or&#39;s of icmp&quot; into a switch, but then the</span></div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;<span class="comment">/// default value goes to an uncond block with a seteq in it, we get something</span></div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;<span class="comment">/// like:</span></div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;<span class="comment">///   switch i8 %A, label %DEFAULT [ i8 1, label %end    i8 2, label %end ]</span></div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;<span class="comment">/// DEFAULT:</span></div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;<span class="comment">///   %tmp = icmp eq i8 %A, 92</span></div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;<span class="comment">///   br label %end</span></div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;<span class="comment">/// end:</span></div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;<span class="comment">///   ... = phi i1 [ true, %entry ], [ %tmp, %DEFAULT ], [ true, %entry ]</span></div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;<span class="comment">/// We prefer to split the edge to &#39;end&#39; so that there is a true/false entry to</span></div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;<span class="comment">/// the PHI, merging the third icmp into the switch.</span></div><div class="line"><a name="l02626"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a59db00fcf511b059606e9eddd6675883"> 2626</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a59db00fcf511b059606e9eddd6675883">TryToSimplifyUncondBranchWithICmpInIt</a>(</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;    <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI,</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD) {</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = ICI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;  <span class="comment">// If the block has any PHIs in it or the icmp has multiple uses, it is too</span></div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;  <span class="comment">// complex.</span></div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;  <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()) || !ICI-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *V = ICI-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0);</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Cst = cast&lt;ConstantInt&gt;(ICI-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1));</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;  <span class="comment">// The pattern we&#39;re looking for is where our only predecessor is a switch on</span></div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;  <span class="comment">// &#39;V&#39; and this block is the default case for the switch.  In this case we can</span></div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;  <span class="comment">// fold the compared value into the switch to simplify things.</span></div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5ef55181ae0bb0f5c561b9a29087b1e5">getSinglePredecessor</a>();</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;  <span class="keywordflow">if</span> (Pred == 0 || !isa&lt;SwitchInst&gt;(Pred-&gt;getTerminator())) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;  <a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI = cast&lt;SwitchInst&gt;(Pred-&gt;getTerminator());</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;  <span class="keywordflow">if</span> (SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#add5ee99852e9927d0777e74572c91708">getCondition</a>() != V)</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;  <span class="comment">// If BB is reachable on a non-default case, then we simply know the value of</span></div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;  <span class="comment">// V in this block.  Substitute it and constant fold the icmp instruction</span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;  <span class="comment">// away.</span></div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;  <span class="keywordflow">if</span> (SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a3feb6090a53e81f06d82da0a97be6e19">getDefaultDest</a>() != <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *VVal = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a2d6855f76c156c05cc76ec4dfb94cf57">findCaseDest</a>(BB);</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;    assert(VVal &amp;&amp; <span class="stringliteral">&quot;Should have a unique destination value&quot;</span>);</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;    ICI-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, VVal);</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#a50f8f41fccbea466816345520e9bfabb">SimplifyInstruction</a>(ICI, TD)) {</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;      ICI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;      ICI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;    }</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    <span class="comment">// BB is now empty, so it is likely to simplify away.</span></div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;  }</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;  <span class="comment">// Ok, the block is reachable from the default dest.  If the constant we&#39;re</span></div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;  <span class="comment">// comparing exists in one of the other edges, then we can constant fold ICI</span></div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;  <span class="comment">// and zap it.</span></div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;  <span class="keywordflow">if</span> (SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#ad3a1537c850f63ce48bcf45694cde73f">findCaseValue</a>(Cst) != SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a96a201f56500af4dd70b4169f140cb4c">case_default</a>()) {</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V;</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;    <span class="keywordflow">if</span> (ICI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#a8afd4995fae596b2c86eeed85b3d388b">getPredicate</a>() == <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05aa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP_EQ</a>)</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;      V = <a class="code" href="classllvm_1_1ConstantInt.html#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ad652423d9d91271ba153eb86482b2f55">getContext</a>());</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;      V = <a class="code" href="classllvm_1_1ConstantInt.html#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ad652423d9d91271ba153eb86482b2f55">getContext</a>());</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;    ICI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;    ICI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;    <span class="comment">// BB is now empty, so it is likely to simplify away.</span></div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;  }</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;  <span class="comment">// The use of the icmp has to be in the &#39;end&#39; block, by the only PHI node in</span></div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;  <span class="comment">// the block.</span></div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SuccBlock = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>()-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a3aac3b6c36415a2b08f65ead9e3e51e7">getSuccessor</a>(0);</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PHIUse = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(ICI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">use_back</a>());</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;  <span class="keywordflow">if</span> (PHIUse == 0 || PHIUse != &amp;SuccBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a33603355becfb1a050b62aa015c1cc57">front</a>() ||</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;      isa&lt;PHINode&gt;(++<a class="code" href="classllvm_1_1BasicBlock.html#a1445356b70fbb95acc5e0d3d2ac9101c">BasicBlock::iterator</a>(PHIUse)))</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;  <span class="comment">// If the icmp is a SETEQ, then the default dest gets false, the new edge gets</span></div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;  <span class="comment">// true in the PHI.</span></div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *DefaultCst = <a class="code" href="classllvm_1_1ConstantInt.html#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ad652423d9d91271ba153eb86482b2f55">getContext</a>());</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *NewCst     = <a class="code" href="classllvm_1_1ConstantInt.html#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ad652423d9d91271ba153eb86482b2f55">getContext</a>());</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;  <span class="keywordflow">if</span> (ICI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#a8afd4995fae596b2c86eeed85b3d388b">getPredicate</a>() == <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05aa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP_EQ</a>)</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(DefaultCst, NewCst);</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;  <span class="comment">// Replace ICI (which is used by the PHI for the default value) with true or</span></div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;  <span class="comment">// false depending on if it is EQ or NE.</span></div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;  ICI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(DefaultCst);</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;  ICI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;  <span class="comment">// Okay, the switch goes to this block on a default value.  Add an edge from</span></div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;  <span class="comment">// the switch to the merge point on the compared value.</span></div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NewBB = <a class="code" href="classllvm_1_1BasicBlock.html#ae1d53a21892854816885c7288f8b46f1">BasicBlock::Create</a>(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ad652423d9d91271ba153eb86482b2f55">getContext</a>(), <span class="stringliteral">&quot;switch.edge&quot;</span>,</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;                                         BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>(), <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint64_t, 8&gt;</a> Weights;</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;  <span class="keywordtype">bool</span> HasWeights = <a class="code" href="SimplifyCFG_8cpp.html#ada99fd4fd27356d1518273d8248940a5">HasBranchWeights</a>(SI);</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;  <span class="keywordflow">if</span> (HasWeights) {</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a165512f38f31f01e7f18bf3838f3a12e">GetBranchWeights</a>(SI, Weights);</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    <span class="keywordflow">if</span> (Weights.size() == 1 + SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a4901d4ad48420014059e9393f75442ae">getNumCases</a>()) {</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;      <span class="comment">// Split weight for default case to case for &quot;Cst&quot;.</span></div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;      Weights[0] = (Weights[0]+1) &gt;&gt; 1;</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;      Weights.push_back(Weights[0]);</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint32_t, 8&gt;</a> MDWeights(Weights.begin(), Weights.end());</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;      SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">LLVMContext::MD_prof</a>,</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;                      <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a>(SI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()).</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;                      createBranchWeights(MDWeights));</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;    }</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;  }</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;  SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a62abc2475d09c01d583ba24a487898fd">addCase</a>(Cst, NewBB);</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;  <span class="comment">// NewBB branches to the phi block, add the uncond branch and the phi entry.</span></div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;  Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(NewBB);</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;  Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a571ae7ebae7038da7f6073efc65aaa50">SetCurrentDebugLocation</a>(SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">getDebugLoc</a>());</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;  Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a0c00110a06b1eb96c92f87e4ca28129a">CreateBr</a>(SuccBlock);</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;  PHIUse-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewCst, NewBB);</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;}</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;<span class="comment">/// SimplifyBranchOnICmpChain - The specified branch is a conditional branch.</span></div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;<span class="comment">/// Check to see if it is branching on an or/and chain of icmp instructions, and</span></div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;<span class="comment">/// fold it into a switch instruction if so.</span></div><div class="line"><a name="l02733"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a39eb6c7310d5673dad5be0af7c6a79f8"> 2733</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a39eb6c7310d5673dad5be0af7c6a79f8">SimplifyBranchOnICmpChain</a>(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD,</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;                                      <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder) {</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Cond = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>());</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;  <span class="keywordflow">if</span> (Cond == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;  <span class="comment">// Change br (X == 0 | X == 1), T, F into a switch instruction.</span></div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;  <span class="comment">// If this is a bunch of seteq&#39;s or&#39;d together, or if it&#39;s a bunch of</span></div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;  <span class="comment">// &#39;setne&#39;s and&#39;ed together, collect them.</span></div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *CompVal = 0;</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;  std::vector&lt;ConstantInt*&gt; Values;</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;  <span class="keywordtype">bool</span> TrueWhenEqual = <span class="keyword">true</span>;</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ExtraCase = 0;</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;  <span class="keywordtype">unsigned</span> UsedICmps = 0;</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;  <span class="keywordflow">if</span> (Cond-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>() == <a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a>) {</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;    CompVal = <a class="code" href="SimplifyCFG_8cpp.html#aa62a063a23f704f9544485e57858b670">GatherConstantCompares</a>(Cond, Values, ExtraCase, TD, <span class="keyword">true</span>,</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;                                     UsedICmps);</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Cond-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>() == <a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">Instruction::And</a>) {</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;    CompVal = <a class="code" href="SimplifyCFG_8cpp.html#aa62a063a23f704f9544485e57858b670">GatherConstantCompares</a>(Cond, Values, ExtraCase, TD, <span class="keyword">false</span>,</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;                                     UsedICmps);</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;    TrueWhenEqual = <span class="keyword">false</span>;</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;  }</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;  <span class="comment">// If we didn&#39;t have a multiply compared value, fail.</span></div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;  <span class="keywordflow">if</span> (CompVal == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;  <span class="comment">// Avoid turning single icmps into a switch.</span></div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;  <span class="keywordflow">if</span> (UsedICmps &lt;= 1)</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;  <span class="comment">// There might be duplicate constants in the list, which the switch</span></div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;  <span class="comment">// instruction can&#39;t handle, remove them now.</span></div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;  <a class="code" href="namespacellvm.html#add1eb5637dd671428b6f138ed3db6428">array_pod_sort</a>(Values.begin(), Values.end(), <a class="code" href="SimplifyCFG_8cpp.html#a8a7f7d7aa56a6449ae814f48b6a8ce6f">ConstantIntSortPredicate</a>);</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;  Values.erase(std::unique(Values.begin(), Values.end()), Values.end());</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;  <span class="comment">// If Extra was used, we require at least two switch values to do the</span></div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;  <span class="comment">// transformation.  A switch with one value is just an cond branch.</span></div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;  <span class="keywordflow">if</span> (ExtraCase &amp;&amp; Values.size() &lt; 2) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;  <span class="comment">// TODO: Preserve branch weight metadata, similarly to how</span></div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;  <span class="comment">// FoldValueComparisonIntoPredecessors preserves it.</span></div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;  <span class="comment">// Figure out which block is which destination.</span></div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *DefaultBB = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1);</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *EdgeBB    = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0);</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;  <span class="keywordflow">if</span> (!TrueWhenEqual) <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(DefaultBB, EdgeBB);</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Converting &#39;icmp&#39; chain with &quot;</span> &lt;&lt; Values.size()</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; cases into SWITCH.  BB is:\n&quot;</span> &lt;&lt; *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>);</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;  <span class="comment">// If there are any extra values that couldn&#39;t be folded into the switch</span></div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;  <span class="comment">// then we evaluate them with an explicit branch first.  Split the block</span></div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;  <span class="comment">// right before the condbr to handle it.</span></div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;  <span class="keywordflow">if</span> (ExtraCase) {</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NewBB = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a19445f836d9e1ecb32cba27ec4338fff">splitBasicBlock</a>(BI, <span class="stringliteral">&quot;switch.early.test&quot;</span>);</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;    <span class="comment">// Remove the uncond branch added to the old block.</span></div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;    <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *OldTI = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>();</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;    Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(OldTI);</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;    <span class="keywordflow">if</span> (TrueWhenEqual)</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;      Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a75e386c51bb947f44935b3c392a8eb4f">CreateCondBr</a>(ExtraCase, EdgeBB, NewBB);</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;      Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a75e386c51bb947f44935b3c392a8eb4f">CreateCondBr</a>(ExtraCase, NewBB, EdgeBB);</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;    OldTI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;    <span class="comment">// If there are PHI nodes in EdgeBB, then we need to add a new entry to them</span></div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    <span class="comment">// for the edge we just added.</span></div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#adfeed3997bba12e75a8e51d740f1969d">AddPredecessorToBlock</a>(EdgeBB, BB, NewBB);</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  ** &#39;icmp&#39; chain unhandled condition: &quot;</span> &lt;&lt; *ExtraCase</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;\nEXTRABB = &quot;</span> &lt;&lt; *BB);</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;    BB = NewBB;</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;  }</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;  Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(BI);</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;  <span class="comment">// Convert pointer to int before we switch.</span></div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;  <span class="keywordflow">if</span> (CompVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>()) {</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;    assert(TD &amp;&amp; <span class="stringliteral">&quot;Cannot switch on pointer without DataLayout&quot;</span>);</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;    CompVal = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a9299aed1efa0ef459a0f1c7fa11fbe61">CreatePtrToInt</a>(CompVal,</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;                                     TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#ae84bb2408dfffa4e8b5fe2ce0714a3bd">getIntPtrType</a>(CompVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()),</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;                                     <span class="stringliteral">&quot;magicptr&quot;</span>);</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;  }</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;  <span class="comment">// Create the new switch instruction now.</span></div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;  <a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *New = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#ae3e9c98ce18a49f8eabe285032612a12">CreateSwitch</a>(CompVal, DefaultBB, Values.<a class="code" href="classllvm_1_1BasicBlock.html#aed28607f3ab19dda7ec1cf1a0319276f">size</a>());</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;  <span class="comment">// Add all of the &#39;cases&#39; to the switch instruction.</span></div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Values.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;    New-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a62abc2475d09c01d583ba24a487898fd">addCase</a>(Values[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], EdgeBB);</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;  <span class="comment">// We added edges from PI to the EdgeBB.  As such, if there were any</span></div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;  <span class="comment">// PHI nodes in EdgeBB, they need entries to be added corresponding to</span></div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;  <span class="comment">// the number of edges added.</span></div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = EdgeBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;       isa&lt;PHINode&gt;(BBI); ++BBI) {</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = cast&lt;PHINode&gt;(BBI);</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *InVal = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(BB);</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0, e = Values.size()-1; i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;      PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(InVal, BB);</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;  }</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;  <span class="comment">// Erase the old branch instruction.</span></div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;  <a class="code" href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">EraseTerminatorInstAndDCECond</a>(BI);</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  ** &#39;icmp&#39; chain result is:\n&quot;</span> &lt;&lt; *BB &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;}</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::SimplifyResume(<a class="code" href="classllvm_1_1ResumeInst.html">ResumeInst</a> *RI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder) {</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;  <span class="comment">// If this is a trivial landing pad that just continues unwinding the caught</span></div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;  <span class="comment">// exception then zap the landing pad, turning its invokes into calls.</span></div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = RI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;  <a class="code" href="classllvm_1_1LandingPadInst.html">LandingPadInst</a> *LPInst = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1LandingPadInst.html">LandingPadInst</a>&gt;(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0e73f4e09745bb69fdd7b15232c45428">getFirstNonPHI</a>());</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;  <span class="keywordflow">if</span> (RI-&gt;<a class="code" href="classllvm_1_1ResumeInst.html#ae0d530cc4c401732247bd561c48634b3">getValue</a>() != LPInst)</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;    <span class="comment">// Not a landing pad, or the resume is not unwinding the exception that</span></div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;    <span class="comment">// caused control to branch here.</span></div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;  <span class="comment">// Check that there are no other instructions except for debug intrinsics.</span></div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = LPInst, E = RI;</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;  <span class="keywordflow">while</span> (++I != E)</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;DbgInfoIntrinsic&gt;(I))</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;  <span class="comment">// Turn all invokes that unwind here into calls and delete the basic block.</span></div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;  <span class="keywordtype">bool</span> InvokeRequiresTableEntry = <span class="keyword">false</span>;</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PredIterator.html">pred_iterator</a> PI = <a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(BB), PE = <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(BB); PI != PE;) {</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;    <a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II = cast&lt;InvokeInst&gt;((*PI++)-&gt;getTerminator());</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;    <span class="keywordflow">if</span> (II-&gt;<a class="code" href="classllvm_1_1InvokeInst.html#ae8128ad2b6324cf4d4ea940cd1ad7c2d">hasFnAttr</a>(<a class="code" href="classllvm_1_1Attribute.html#aab7ee4b8fd1d3e7e4cea87868855e60ea05ac93db8aa4c0dfd25a69fd04a3c7b5">Attribute::UWTable</a>)) {</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;      <span class="comment">// Don&#39;t remove an `invoke&#39; instruction if the ABI requires an entry into</span></div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;      <span class="comment">// the table.</span></div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;      InvokeRequiresTableEntry = <span class="keyword">true</span>;</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;    }</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 8&gt;</a> Args(II-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>(), II-&gt;<a class="code" href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">op_end</a>() - 3);</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;    <span class="comment">// Insert a call instruction before the invoke.</span></div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;    <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *<a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Call</a> = <a class="code" href="classllvm_1_1CallInst.html#a861226dd056dd2438da26760b8e7a9a0">CallInst::Create</a>(II-&gt;<a class="code" href="classllvm_1_1InvokeInst.html#aaf176d8e8ffe24fa5971b879ec16f861">getCalledValue</a>(), Args, <span class="stringliteral">&quot;&quot;</span>, II);</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;    Call-&gt;takeName(II);</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;    Call-&gt;setCallingConv(II-&gt;<a class="code" href="classllvm_1_1InvokeInst.html#a2fcb5cdd1b70bf9ba792497a04f62253">getCallingConv</a>());</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;    Call-&gt;setAttributes(II-&gt;<a class="code" href="classllvm_1_1InvokeInst.html#abcf96faa5717afe76da1a6a8d31bea8f">getAttributes</a>());</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;    Call-&gt;setDebugLoc(II-&gt;<a class="code" href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">getDebugLoc</a>());</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;    <span class="comment">// Anything that used the value produced by the invoke instruction now uses</span></div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;    <span class="comment">// the value produced by the call instruction.  Note that we do this even</span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;    <span class="comment">// for void functions and calls with no uses so that the callgraph edge is</span></div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;    <span class="comment">// updated.</span></div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;    II-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Call);</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;    BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6f6763e343549d530a1424f1b24053bb">removePredecessor</a>(II-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;    <span class="comment">// Insert a branch to the normal destination right before the invoke.</span></div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html#ae9cbc599309fd2da33ec1c61df01ce1f">BranchInst::Create</a>(II-&gt;<a class="code" href="classllvm_1_1InvokeInst.html#aba6201d5f728b007f1c96fd61105afde">getNormalDest</a>(), II);</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;    <span class="comment">// Finally, delete the invoke instruction!</span></div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    II-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;  }</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;  <span class="keywordflow">if</span> (!InvokeRequiresTableEntry)</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;    <span class="comment">// The landingpad is now unreachable.  Zap it.</span></div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;    BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ace1ad5ed624dd5df8efb4eb611cb71ff">eraseFromParent</a>();</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;}</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::SimplifyReturn(<a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *RI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder) {</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = RI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;  <span class="keywordflow">if</span> (!BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a225cbda41f4c27fbb522833e31cb18f9">getFirstNonPHIOrDbg</a>()-&gt;<a class="code" href="classllvm_1_1Instruction.html#a237e6bf58bc993ea494bdde7480ca428">isTerminator</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;  <span class="comment">// Find predecessors that end with branches.</span></div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock*, 8&gt;</a> UncondBranchPreds;</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BranchInst*, 8&gt;</a> CondBranchPreds;</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PredIterator.html">pred_iterator</a> PI = <a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(BB), E = <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(BB); PI != E; ++PI) {</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = *PI;</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;    <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *PTI = P-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>();</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(PTI)) {</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;      <span class="keywordflow">if</span> (BI-&gt;isUnconditional())</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;        UncondBranchPreds.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(P);</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;        CondBranchPreds.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(BI);</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;    }</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;  }</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;  <span class="comment">// If we found some, do the transformation!</span></div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;  <span class="keywordflow">if</span> (!UncondBranchPreds.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>() &amp;&amp; <a class="code" href="SimplifyCFG_8cpp.html#a0b13773c26dad640e24611c48c657463">DupRet</a>) {</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;    <span class="keywordflow">while</span> (!UncondBranchPreds.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = UncondBranchPreds.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;FOLDING: &quot;</span> &lt;&lt; *BB</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;INTO UNCOND BRANCH PRED: &quot;</span> &lt;&lt; *Pred);</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;      (void)<a class="code" href="namespacellvm.html#a2b8a0d5fd8cacf34a300e31e25eaa77f">FoldReturnIntoUncondBranch</a>(RI, BB, Pred);</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    }</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;    <span class="comment">// If we eliminated all predecessors of the block, delete the block now.</span></div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(BB) == <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(BB))</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;      <span class="comment">// We know there are no successors, so just nuke the block.</span></div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;      BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ace1ad5ed624dd5df8efb4eb611cb71ff">eraseFromParent</a>();</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;  }</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;  <span class="comment">// Check out all of the conditional branches going to this return</span></div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;  <span class="comment">// instruction.  If any of them just select between returns, change the</span></div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;  <span class="comment">// branch itself into a select/return pair.</span></div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;  <span class="keywordflow">while</span> (!CondBranchPreds.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = CondBranchPreds.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;    <span class="comment">// Check to see if the non-BB successor is also a return block.</span></div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    <span class="keywordflow">if</span> (isa&lt;ReturnInst&gt;(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>()) &amp;&amp;</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;        isa&lt;ReturnInst&gt;(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>()) &amp;&amp;</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;        <a class="code" href="SimplifyCFG_8cpp.html#a2e1b28b7b4b85744d3a02881d4601122">SimplifyCondBranchToTwoReturns</a>(BI, Builder))</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;  }</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;}</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::SimplifyUnreachable(<a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a> *UI) {</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;  <span class="comment">// If there are any instructions immediately before the unreachable that can</span></div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;  <span class="comment">// be removed, do so.</span></div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;  <span class="keywordflow">while</span> (UI != BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()) {</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;    <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = UI;</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;    --BBI;</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;    <span class="comment">// Do not delete instructions that can have side effects which might cause</span></div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;    <span class="comment">// the unreachable to not be reachable; specifically, calls and volatile</span></div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;    <span class="comment">// operations may have this effect.</span></div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;    <span class="keywordflow">if</span> (isa&lt;CallInst&gt;(BBI) &amp;&amp; !isa&lt;DbgInfoIntrinsic&gt;(BBI)) <span class="keywordflow">break</span>;</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;    <span class="keywordflow">if</span> (BBI-&gt;mayHaveSideEffects()) {</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(BBI)) {</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;        <span class="keywordflow">if</span> (SI-&gt;isVolatile())</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(BBI)) {</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;        <span class="keywordflow">if</span> (LI-&gt;isVolatile())</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AtomicRMWInst.html">AtomicRMWInst</a> *RMWI = dyn_cast&lt;AtomicRMWInst&gt;(BBI)) {</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;        <span class="keywordflow">if</span> (RMWI-&gt;isVolatile())</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AtomicCmpXchgInst.html">AtomicCmpXchgInst</a> *CXI = dyn_cast&lt;AtomicCmpXchgInst&gt;(BBI)) {</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;        <span class="keywordflow">if</span> (CXI-&gt;isVolatile())</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!isa&lt;FenceInst&gt;(BBI) &amp;&amp; !isa&lt;VAArgInst&gt;(BBI) &amp;&amp;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;                 !isa&lt;LandingPadInst&gt;(BBI)) {</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;      }</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;      <span class="comment">// Note that deleting LandingPad&#39;s here is in fact okay, although it</span></div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;      <span class="comment">// involves a bit of subtle reasoning. If this inst is a LandingPad,</span></div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;      <span class="comment">// all the predecessors of this block will be the unwind edges of Invokes,</span></div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;      <span class="comment">// and we can therefore guarantee this block will be erased.</span></div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    }</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;    <span class="comment">// Delete this instruction (any uses are guaranteed to be dead)</span></div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;    <span class="keywordflow">if</span> (!BBI-&gt;use_empty())</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;      BBI-&gt;replaceAllUsesWith(<a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(BBI-&gt;getType()));</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;    BBI-&gt;eraseFromParent();</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;  }</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;  <span class="comment">// If the unreachable instruction is the first in the block, take a gander</span></div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;  <span class="comment">// at all of the predecessors of this instruction, and simplify them.</span></div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;  <span class="keywordflow">if</span> (&amp;BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a33603355becfb1a050b62aa015c1cc57">front</a>() != UI) <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock*, 8&gt;</a> Preds(<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(BB), <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(BB));</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Preds.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *TI = Preds[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;getTerminator();</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(TI);</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(TI)) {</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;      <span class="keywordflow">if</span> (BI-&gt;isUnconditional()) {</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;        <span class="keywordflow">if</span> (BI-&gt;getSuccessor(0) == <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;          <span class="keyword">new</span> <a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a>(TI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), TI);</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;          TI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;          Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;        }</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;        <span class="keywordflow">if</span> (BI-&gt;getSuccessor(0) == <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;          Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a0c00110a06b1eb96c92f87e4ca28129a">CreateBr</a>(BI-&gt;getSuccessor(1));</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;          <a class="code" href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">EraseTerminatorInstAndDCECond</a>(BI);</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (BI-&gt;getSuccessor(1) == <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;          Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a0c00110a06b1eb96c92f87e4ca28129a">CreateBr</a>(BI-&gt;getSuccessor(0));</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;          <a class="code" href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">EraseTerminatorInstAndDCECond</a>(BI);</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;          Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;        }</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;      }</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI = dyn_cast&lt;SwitchInst&gt;(TI)) {</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIt.html">SwitchInst::CaseIt</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = SI-&gt;case_begin(), e = SI-&gt;case_end();</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;           <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>.getCaseSuccessor() == <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;          BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6f6763e343549d530a1424f1b24053bb">removePredecessor</a>(SI-&gt;getParent());</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;          SI-&gt;removeCase(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;          --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>; --e;</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;          Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;        }</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;      <span class="comment">// If the default value is unreachable, figure out the most popular</span></div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;      <span class="comment">// destination and make it the default.</span></div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;      <span class="keywordflow">if</span> (SI-&gt;getDefaultDest() == <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;        std::map&lt;BasicBlock*, std::pair&lt;unsigned, unsigned&gt; &gt; Popularity;</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIt.html">SwitchInst::CaseIt</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = SI-&gt;case_begin(), e = SI-&gt;case_end();</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;             <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;          std::pair&lt;unsigned, unsigned&gt; &amp;entry =</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;              Popularity[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>.getCaseSuccessor()];</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;          <span class="keywordflow">if</span> (entry.first == 0) {</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;            entry.first = 1;</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;            entry.second = <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>.getCaseIndex();</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;            entry.first++;</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;          }</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;        }</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;        <span class="comment">// Find the most popular block.</span></div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;        <span class="keywordtype">unsigned</span> MaxPop = 0;</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;        <span class="keywordtype">unsigned</span> MaxIndex = 0;</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;        <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *MaxBlock = 0;</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;        <span class="keywordflow">for</span> (std::map&lt;<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a>*, std::pair&lt;unsigned, unsigned&gt; &gt;::iterator</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;             <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Popularity.begin(), E = Popularity.end(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second.first &gt; MaxPop ||</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;              (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second.first == MaxPop &amp;&amp; MaxIndex &gt; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second.second)) {</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;            MaxPop = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second.first;</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;            MaxIndex = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second.second;</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;            MaxBlock = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first;</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;          }</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;        }</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;        <span class="keywordflow">if</span> (MaxBlock) {</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;          <span class="comment">// Make this the new default, allowing us to delete any explicit</span></div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;          <span class="comment">// edges to it.</span></div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;          SI-&gt;setDefaultDest(MaxBlock);</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;          Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;          <span class="comment">// If MaxBlock has phinodes in it, remove MaxPop-1 entries from</span></div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;          <span class="comment">// it.</span></div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;          <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(MaxBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()))</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != MaxPop-1; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;              MaxBlock-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6f6763e343549d530a1424f1b24053bb">removePredecessor</a>(SI-&gt;getParent());</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIt.html">SwitchInst::CaseIt</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = SI-&gt;case_begin(), e = SI-&gt;case_end();</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;               <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>.getCaseSuccessor() == MaxBlock) {</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;              SI-&gt;removeCase(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;              --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>; --e;</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;            }</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;        }</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;      }</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II = dyn_cast&lt;InvokeInst&gt;(TI)) {</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;      <span class="keywordflow">if</span> (II-&gt;getUnwindDest() == <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;        <span class="comment">// Convert the invoke to a call instruction.  This would be a good</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;        <span class="comment">// place to note that the call does not throw though.</span></div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;        <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a0c00110a06b1eb96c92f87e4ca28129a">CreateBr</a>(II-&gt;getNormalDest());</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;        II-&gt;<a class="code" href="classllvm_1_1Instruction.html#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();   <span class="comment">// Take out of symbol table</span></div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;        <span class="comment">// Insert the call now...</span></div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 8&gt;</a> Args(II-&gt;op_begin(), II-&gt;op_end()-3);</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;        Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(BI);</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;        <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a7e31b0c02df2aeed261b103b790cc01e">CreateCall</a>(II-&gt;getCalledValue(),</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;                                          Args, II-&gt;getName());</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;        CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#acd74b2224788f8d010e47622bb3c2a04">setCallingConv</a>(II-&gt;getCallingConv());</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;        CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a179ef4c643fb35a8dc364e4ae63950f9">setAttributes</a>(II-&gt;getAttributes());</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;        <span class="comment">// If the invoke produced a value, the call does now instead.</span></div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;        II-&gt;replaceAllUsesWith(CI);</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;        <span class="keyword">delete</span> II;</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;      }</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;    }</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;  }</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;  <span class="comment">// If this block is now dead, remove it.</span></div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(BB) == <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(BB) &amp;&amp;</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;      BB != &amp;BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>()-&gt;<a class="code" href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">getEntryBlock</a>()) {</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;    <span class="comment">// We know there are no successors, so just nuke the block.</span></div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;    BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ace1ad5ed624dd5df8efb4eb611cb71ff">eraseFromParent</a>();</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;  }</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;}</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;<span class="comment">/// TurnSwitchRangeIntoICmp - Turns a switch with that contains only a</span></div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;<span class="comment">/// integer range comparison into a sub, an icmp and a branch.</span></div><div class="line"><a name="l03118"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#abf5ef34c952cc6bc5dce92d91598bdd2"> 3118</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#abf5ef34c952cc6bc5dce92d91598bdd2">TurnSwitchRangeIntoICmp</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder) {</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;  assert(SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a4901d4ad48420014059e9393f75442ae">getNumCases</a>() &gt; 1 &amp;&amp; <span class="stringliteral">&quot;Degenerate switch?&quot;</span>);</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;  <span class="comment">// Make sure all cases point to the same destination and gather the values.</span></div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ConstantInt *, 16&gt;</a> Cases;</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;  <a class="code" href="classllvm_1_1SwitchInst_1_1CaseIt.html">SwitchInst::CaseIt</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#ae69c15ce940c41719cb96209e113a26e">case_begin</a>();</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;  Cases.push_back(I.<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIteratorT.html#a60499571002635a94d89b8a9341b5e12">getCaseValue</a>());</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;  <a class="code" href="classllvm_1_1SwitchInst_1_1CaseIt.html">SwitchInst::CaseIt</a> PrevI = I++;</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIt.html">SwitchInst::CaseIt</a> E = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a219f2a3514d904d05dc8003a4ee5d291">case_end</a>(); I != E; PrevI = I++) {</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;    <span class="keywordflow">if</span> (PrevI.<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIteratorT.html#a143819a808ec85e9997566fdf42e9372">getCaseSuccessor</a>() != I.<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIteratorT.html#a143819a808ec85e9997566fdf42e9372">getCaseSuccessor</a>())</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;    Cases.push_back(I.<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIteratorT.html#a60499571002635a94d89b8a9341b5e12">getCaseValue</a>());</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;  }</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;  assert(Cases.size() == SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a4901d4ad48420014059e9393f75442ae">getNumCases</a>() &amp;&amp; <span class="stringliteral">&quot;Not all cases gathered&quot;</span>);</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;  <span class="comment">// Sort the case values, then check if they form a range we can transform.</span></div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;  <a class="code" href="namespacellvm.html#add1eb5637dd671428b6f138ed3db6428">array_pod_sort</a>(Cases.begin(), Cases.end(), <a class="code" href="SimplifyCFG_8cpp.html#a8a7f7d7aa56a6449ae814f48b6a8ce6f">ConstantIntSortPredicate</a>);</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> I = 1, E = Cases.size(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;    <span class="keywordflow">if</span> (Cases[I-1]-&gt;getValue() != Cases[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]-&gt;getValue()+1)</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;  }</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Offset = <a class="code" href="classllvm_1_1ConstantExpr.html#afa29f0cd072ab9b3a2630681ffe5760f">ConstantExpr::getNeg</a>(Cases.back());</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *NumCases = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(Offset-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a4901d4ad48420014059e9393f75442ae">getNumCases</a>());</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Sub = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#add5ee99852e9927d0777e74572c91708">getCondition</a>();</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;  <span class="keywordflow">if</span> (!Offset-&gt;<a class="code" href="classllvm_1_1Constant.html#ad7ec8482f19e8e86e3de573b060a17e5">isNullValue</a>())</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;    Sub = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a112f87f5844b5d94c07940f3d47f1e99">CreateAdd</a>(Sub, Offset, Sub-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.off&quot;</span>);</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Cmp;</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;  <span class="comment">// If NumCases overflowed, then all possible values jump to the successor.</span></div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;  <span class="keywordflow">if</span> (NumCases-&gt;isNullValue() &amp;&amp; SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a4901d4ad48420014059e9393f75442ae">getNumCases</a>() != 0)</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;    Cmp = <a class="code" href="classllvm_1_1ConstantInt.html#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(SI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>());</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;    Cmp = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a9c30c87af01068ceae02cd371748d175">CreateICmpULT</a>(Sub, NumCases, <span class="stringliteral">&quot;switch&quot;</span>);</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *NewBI = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a75e386c51bb947f44935b3c392a8eb4f">CreateCondBr</a>(</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;      Cmp, SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#ae69c15ce940c41719cb96209e113a26e">case_begin</a>().<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIteratorT.html#a143819a808ec85e9997566fdf42e9372">getCaseSuccessor</a>(), SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a3feb6090a53e81f06d82da0a97be6e19">getDefaultDest</a>());</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;  <span class="comment">// Update weight for the newly-created conditional branch.</span></div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint64_t, 8&gt;</a> Weights;</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;  <span class="keywordtype">bool</span> HasWeights = <a class="code" href="SimplifyCFG_8cpp.html#ada99fd4fd27356d1518273d8248940a5">HasBranchWeights</a>(SI);</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;  <span class="keywordflow">if</span> (HasWeights) {</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a165512f38f31f01e7f18bf3838f3a12e">GetBranchWeights</a>(SI, Weights);</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;    <span class="keywordflow">if</span> (Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 1 + SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a4901d4ad48420014059e9393f75442ae">getNumCases</a>()) {</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;      <span class="comment">// Combine all weights for the cases to be the true weight of NewBI.</span></div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;      <span class="comment">// We assume that the sum of all weights for a Terminator can fit into 32</span></div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;      <span class="comment">// bits.</span></div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;      uint32_t NewTrueWeight = 0;</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> I = 1, E = Weights.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;        NewTrueWeight += (uint32_t)Weights[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;      NewBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">LLVMContext::MD_prof</a>,</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;                         <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a>(SI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()).</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;                         createBranchWeights(NewTrueWeight,</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;                                             (uint32_t)Weights[0]));</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;    }</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;  }</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;  <span class="comment">// Prune obsolete incoming values off the successor&#39;s PHI nodes.</span></div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#ae69c15ce940c41719cb96209e113a26e">case_begin</a>().<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIteratorT.html#a143819a808ec85e9997566fdf42e9372">getCaseSuccessor</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;       isa&lt;PHINode&gt;(BBI); ++BBI) {</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> I = 0, E = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a4901d4ad48420014059e9393f75442ae">getNumCases</a>()-1; I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;      cast&lt;PHINode&gt;(BBI)-&gt;removeIncomingValue(SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;  }</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;  SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;}</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;<span class="comment">/// EliminateDeadSwitchCases - Compute masked bits for the condition of a switch</span></div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;<span class="comment">/// and use it to remove dead cases.</span></div><div class="line"><a name="l03187"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a48977a4b045a92bc5cf1c0ad4d95129e"> 3187</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a48977a4b045a92bc5cf1c0ad4d95129e">EliminateDeadSwitchCases</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI) {</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Cond = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#add5ee99852e9927d0777e74572c91708">getCondition</a>();</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">Bits</a> = Cond-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a0519dc6e2f153aaed61eed17d965a9f0">getIntegerBitWidth</a>();</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> KnownZero(Bits, 0), KnownOne(Bits, 0);</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;  <a class="code" href="namespacellvm.html#a7985318bedfe5c2040025ef13db9c57b">ComputeMaskedBits</a>(Cond, KnownZero, KnownOne);</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;  <span class="comment">// Gather dead cases.</span></div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ConstantInt*, 8&gt;</a> DeadCases;</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIt.html">SwitchInst::CaseIt</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#ae69c15ce940c41719cb96209e113a26e">case_begin</a>(), E = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a219f2a3514d904d05dc8003a4ee5d291">case_end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getCaseValue()-&gt;getValue() &amp; KnownZero) != 0 ||</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;        (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getCaseValue()-&gt;getValue() &amp; KnownOne) != KnownOne) {</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;      DeadCases.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getCaseValue());</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SimplifyCFG: switch case &#39;&quot;</span></div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;                   &lt;&lt; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getCaseValue() &lt;&lt; <span class="stringliteral">&quot;&#39; is dead.\n&quot;</span>);</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;    }</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;  }</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint64_t, 8&gt;</a> Weights;</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;  <span class="keywordtype">bool</span> HasWeight = <a class="code" href="SimplifyCFG_8cpp.html#ada99fd4fd27356d1518273d8248940a5">HasBranchWeights</a>(SI);</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;  <span class="keywordflow">if</span> (HasWeight) {</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#a165512f38f31f01e7f18bf3838f3a12e">GetBranchWeights</a>(SI, Weights);</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;    HasWeight = (Weights.size() == 1 + SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a4901d4ad48420014059e9393f75442ae">getNumCases</a>());</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;  }</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;  <span class="comment">// Remove dead cases from the switch.</span></div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = DeadCases.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;    <a class="code" href="classllvm_1_1SwitchInst_1_1CaseIt.html">SwitchInst::CaseIt</a> Case = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#ad3a1537c850f63ce48bcf45694cde73f">findCaseValue</a>(DeadCases[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>]);</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;    assert(Case != SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a96a201f56500af4dd70b4169f140cb4c">case_default</a>() &amp;&amp;</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;           <span class="stringliteral">&quot;Case was not found. Probably mistake in DeadCases forming.&quot;</span>);</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;    <span class="keywordflow">if</span> (HasWeight) {</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;      <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Weights[Case.<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIteratorT.html#a10aaece902a17099847aeb04681d236d">getCaseIndex</a>()+1], Weights.back());</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;      Weights.pop_back();</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;    }</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;    <span class="comment">// Prune unused values from PHI nodes.</span></div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;    Case.<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIteratorT.html#a143819a808ec85e9997566fdf42e9372">getCaseSuccessor</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6f6763e343549d530a1424f1b24053bb">removePredecessor</a>(SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;    SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a428c1dd0acc084fb894ceb71ca5b707a">removeCase</a>(Case);</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;  }</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;  <span class="keywordflow">if</span> (HasWeight) {</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;uint32_t, 8&gt;</a> MDWeights(Weights.begin(), Weights.end());</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;    SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">LLVMContext::MD_prof</a>,</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;                    <a class="code" href="classllvm_1_1MDBuilder.html">MDBuilder</a>(SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ad652423d9d91271ba153eb86482b2f55">getContext</a>()).</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;                    createBranchWeights(MDWeights));</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;  }</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;  <span class="keywordflow">return</span> !DeadCases.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>();</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;}</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;<span class="comment">/// FindPHIForConditionForwarding - If BB would be eligible for simplification</span></div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;<span class="comment">/// by TryToSimplifyUncondBranchFromEmptyBlock (i.e. it is empty and terminated</span></div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;<span class="comment">/// by an unconditional branch), look at the phi node for BB in the successor</span></div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;<span class="comment">/// block and see if the incoming value is equal to CaseValue. If so, return</span></div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;<span class="comment">/// the phi node, and set PhiIndex to BB&#39;s index in the phi node.</span></div><div class="line"><a name="l03240"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a3a785324436b8d2862b09f5fd8d1c061"> 3240</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="SimplifyCFG_8cpp.html#a3a785324436b8d2862b09f5fd8d1c061">FindPHIForConditionForwarding</a>(<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CaseValue,</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;                                              <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;                                              <span class="keywordtype">int</span> *PhiIndex) {</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;  <span class="keywordflow">if</span> (BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a225cbda41f4c27fbb522833e31cb18f9">getFirstNonPHIOrDbg</a>() != BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>())</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;    <span class="keywordflow">return</span> NULL; <span class="comment">// BB must be empty to be a candidate for simplification.</span></div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;  <span class="keywordflow">if</span> (!BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5ef55181ae0bb0f5c561b9a29087b1e5">getSinglePredecessor</a>())</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;    <span class="keywordflow">return</span> NULL; <span class="comment">// BB must be dominated by the switch.</span></div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *<a class="code" href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba359237c780f7c8e40645575826da8a3c">Branch</a> = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a>&gt;(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;  <span class="keywordflow">if</span> (!Branch || !Branch-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a382131e712e55e8324fbd5068de17b78">isUnconditional</a>())</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;    <span class="keywordflow">return</span> NULL; <span class="comment">// Terminator must be unconditional branch.</span></div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ = Branch-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0);</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a> = dyn_cast&lt;PHINode&gt;(I++)) {</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;    <span class="keywordtype">int</span> Idx = <a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a>-&gt;getBasicBlockIndex(BB);</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;    assert(Idx &gt;= 0 &amp;&amp; <span class="stringliteral">&quot;PHI has no entry for predecessor?&quot;</span>);</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *InValue = <a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a>-&gt;getIncomingValue(Idx);</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;    <span class="keywordflow">if</span> (InValue != CaseValue) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;    *PhiIndex = Idx;</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a>;</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;  }</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;  <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;}</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;<span class="comment">/// ForwardSwitchConditionToPHI - Try to forward the condition of a switch</span></div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;<span class="comment">/// instruction to a phi node dominated by the switch, if that would mean that</span></div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;<span class="comment">/// some of the destination blocks of the switch can be folded away.</span></div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;<span class="comment">/// Returns true if a change is made.</span></div><div class="line"><a name="l03273"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a819fe08329be34252ffde1e710574a34"> 3273</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a819fe08329be34252ffde1e710574a34">ForwardSwitchConditionToPHI</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI) {</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;PHINode*, SmallVector&lt;int,4&gt;</a> &gt; ForwardingNodesMap;</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;  ForwardingNodesMap ForwardingNodes;</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIt.html">SwitchInst::CaseIt</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#ae69c15ce940c41719cb96209e113a26e">case_begin</a>(), E = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a219f2a3514d904d05dc8003a4ee5d291">case_end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CaseValue = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getCaseValue();</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CaseDest = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getCaseSuccessor();</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;    <span class="keywordtype">int</span> PhiIndex;</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a> = <a class="code" href="SimplifyCFG_8cpp.html#a3a785324436b8d2862b09f5fd8d1c061">FindPHIForConditionForwarding</a>(CaseValue, CaseDest,</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;                                                 &amp;PhiIndex);</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;    <span class="keywordflow">if</span> (!PHI) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;    ForwardingNodes[<a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a>].push_back(PhiIndex);</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;  }</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;  <span class="keywordflow">for</span> (ForwardingNodesMap::iterator <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ForwardingNodes.begin(),</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;       E = ForwardingNodes.end(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *Phi = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first;</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;int&gt;</a> &amp;Indexes = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;    <span class="keywordflow">if</span> (Indexes.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() &lt; 2) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = Indexes.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;      Phi-&gt;<a class="code" href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(Indexes[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>], SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#add5ee99852e9927d0777e74572c91708">getCondition</a>());</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;  }</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;}</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;<span class="comment">/// ValidLookupTableConstant - Return true if the backend will be able to handle</span></div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;<span class="comment">/// initializing an array of constants like C.</span></div><div class="line"><a name="l03308"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a73476159b3f570043406e83b49ea036c"> 3308</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a73476159b3f570043406e83b49ea036c">ValidLookupTableConstant</a>(<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>) {</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(C))</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;    <span class="keywordflow">return</span> CE-&gt;isGEPWithNoNotionalOverIndexing();</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;  <span class="keywordflow">return</span> isa&lt;ConstantFP&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>) ||</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;      isa&lt;ConstantInt&gt;(C) ||</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;      isa&lt;ConstantPointerNull&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>) ||</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;      isa&lt;GlobalValue&gt;(C) ||</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;      isa&lt;UndefValue&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>);</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;}</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;<span class="comment">/// LookupConstant - If V is a Constant, return it. Otherwise, try to look up</span></div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;<span class="comment">/// its constant value in ConstantPool, returning 0 if it&#39;s not there.</span></div><div class="line"><a name="l03321"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b"> 3321</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b">LookupConstant</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V,</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;                         <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;Value*, Constant*&gt;</a>&amp; <a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aa8cad208c3cb96b33b5d8544590325b1">ConstantPool</a>) {</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;Constant&gt;(V))</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>;</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;  <span class="keywordflow">return</span> ConstantPool.<a class="code" href="classllvm_1_1DenseMapBase.html#acfd7cc74125222a81c02b4097ed5166c">lookup</a>(V);</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;}</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;<span class="comment">/// ConstantFold - Try to fold instruction I into a constant. This works for</span></div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;<span class="comment">/// simple instructions such as binary operations where both operands are</span></div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;<span class="comment">/// constant or can be replaced by constants from the ConstantPool. Returns the</span></div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;<span class="comment">/// resulting constant on success, 0 otherwise.</span></div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Constant.html">Constant</a> *</div><div class="line"><a name="l03333"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#abe3a801f7be20378621c4cbca8717aad"> 3333</a></span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#abe3a801f7be20378621c4cbca8717aad">ConstantFold</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;             <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;Value *, Constant *&gt;</a> &amp;<a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aa8cad208c3cb96b33b5d8544590325b1">ConstantPool</a>,</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;             <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *DL) {</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba32dbd2c72a98eaee90e3ad5ef7b5af16">Select</a> = dyn_cast&lt;SelectInst&gt;(I)) {</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a> = <a class="code" href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b">LookupConstant</a>(<a class="code" href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba32dbd2c72a98eaee90e3ad5ef7b5af16">Select</a>-&gt;getCondition(), <a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aa8cad208c3cb96b33b5d8544590325b1">ConstantPool</a>);</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;    <span class="keywordflow">if</span> (!A)</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;    <span class="keywordflow">if</span> (A-&gt;<a class="code" href="classllvm_1_1Constant.html#ac8ddb745480a7e75a3862ddf0be3a298">isAllOnesValue</a>())</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b">LookupConstant</a>(<a class="code" href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba32dbd2c72a98eaee90e3ad5ef7b5af16">Select</a>-&gt;getTrueValue(), <a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aa8cad208c3cb96b33b5d8544590325b1">ConstantPool</a>);</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;    <span class="keywordflow">if</span> (A-&gt;<a class="code" href="classllvm_1_1Constant.html#ad7ec8482f19e8e86e3de573b060a17e5">isNullValue</a>())</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b">LookupConstant</a>(<a class="code" href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba32dbd2c72a98eaee90e3ad5ef7b5af16">Select</a>-&gt;getFalseValue(), <a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aa8cad208c3cb96b33b5d8544590325b1">ConstantPool</a>);</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;  }</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Constant *, 4&gt;</a> COps;</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 0, E = I-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>(); <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> != E; ++<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>) {</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a> = <a class="code" href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b">LookupConstant</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(<a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>), <a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aa8cad208c3cb96b33b5d8544590325b1">ConstantPool</a>))</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;      COps.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>);</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;  }</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *Cmp = dyn_cast&lt;CmpInst&gt;(I))</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#aa61b351a455e9229d3dc58e0883b6cef">ConstantFoldCompareInstOperands</a>(Cmp-&gt;getPredicate(), COps[0],</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;                                           COps[1], DL);</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a3e98ee8971fbf32f7f84f5a7399b5b67">ConstantFoldInstOperands</a>(I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>(), I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), COps, DL);</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;}</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;<span class="comment">/// GetCaseResults - Try to determine the resulting constant values in phi nodes</span></div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;<span class="comment">/// at the common destination basic block, *CommonDest, for one of the case</span></div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;<span class="comment">/// destionations CaseDest corresponding to value CaseVal (0 for the default</span></div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;<span class="comment">/// case), of a switch instruction SI.</span></div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span></div><div class="line"><a name="l03367"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#abfe18d4b03b813d04ffd79e706cc62aa"> 3367</a></span>&#160;<a class="code" href="SimplifyCFG_8cpp.html#abfe18d4b03b813d04ffd79e706cc62aa">GetCaseResults</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI,</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;               <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CaseVal,</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;               <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CaseDest,</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;               <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> **CommonDest,</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;               <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl</a>&lt;std::pair&lt;PHINode *, Constant *&gt; &gt; &amp;Res,</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;               <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *DL) {</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;  <span class="comment">// The block from which we enter the common destination.</span></div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;  <span class="comment">// If CaseDest is empty except for some side-effect free instructions through</span></div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;  <span class="comment">// which we can constant-propagate the CaseVal, continue to its successor.</span></div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;Value*, Constant*&gt;</a> <a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aa8cad208c3cb96b33b5d8544590325b1">ConstantPool</a>;</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;  ConstantPool.<a class="code" href="classllvm_1_1DenseMapBase.html#a699a66e504b48fdeff124e82f6c61917">insert</a>(std::make_pair(SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#add5ee99852e9927d0777e74572c91708">getCondition</a>(), CaseVal));</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = CaseDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), E = CaseDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E;</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;       ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *<a class="code" href="classT.html">T</a> = dyn_cast&lt;TerminatorInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;      <span class="comment">// If the terminator is a simple branch, continue to the next block.</span></div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classT.html">T</a>-&gt;getNumSuccessors() != 1)</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;      Pred = CaseDest;</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;      CaseDest = <a class="code" href="classT.html">T</a>-&gt;getSuccessor(0);</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;DbgInfoIntrinsic&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;      <span class="comment">// Skip debug intrinsic.</span></div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = <a class="code" href="SimplifyCFG_8cpp.html#abe3a801f7be20378621c4cbca8717aad">ConstantFold</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ConstantPool, DL)) {</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;      <span class="comment">// Instruction is side-effect free and constant.</span></div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;      ConstantPool.<a class="code" href="classllvm_1_1DenseMapBase.html#a699a66e504b48fdeff124e82f6c61917">insert</a>(std::make_pair(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>));</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;    }</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;  }</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;  <span class="comment">// If we did not have a CommonDest before, use the current one.</span></div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;  <span class="keywordflow">if</span> (!*CommonDest)</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;    *CommonDest = CaseDest;</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;  <span class="comment">// If the destination isn&#39;t the common one, abort.</span></div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;  <span class="keywordflow">if</span> (CaseDest != *CommonDest)</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;  <span class="comment">// Get the values for this case from phi nodes in the destination block.</span></div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = (*CommonDest)-&gt;begin();</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a> = dyn_cast&lt;PHINode&gt;(I++)) {</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;    <span class="keywordtype">int</span> Idx = <a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a>-&gt;getBasicBlockIndex(Pred);</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;    <span class="keywordflow">if</span> (Idx == -1)</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *ConstVal = <a class="code" href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b">LookupConstant</a>(<a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a>-&gt;getIncomingValue(Idx),</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;                                        <a class="code" href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aa8cad208c3cb96b33b5d8544590325b1">ConstantPool</a>);</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;    <span class="keywordflow">if</span> (!ConstVal)</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;    <span class="comment">// Note: If the constant comes from constant-propagating the case value</span></div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;    <span class="comment">// through the CaseDest basic block, it will be safe to remove the</span></div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;    <span class="comment">// instructions in that block. They cannot be used (except in the phi nodes</span></div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;    <span class="comment">// we visit) outside CaseDest, because that block does not dominate its</span></div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;    <span class="comment">// successor. If it did, we would not be in this phi node.</span></div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;    <span class="comment">// Be conservative about which kinds of constants we support.</span></div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#a73476159b3f570043406e83b49ea036c">ValidLookupTableConstant</a>(ConstVal))</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;    Res.push_back(std::make_pair(<a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a>, ConstVal));</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;  }</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;}</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;<span class="comment">  /// SwitchLookupTable - This class represents a lookup table that can be used</span></div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;<span class="comment">  /// to replace a switch.</span></div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>SwitchLookupTable {</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;  <span class="keyword">public</span>:<span class="comment"></span></div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;<span class="comment">    /// SwitchLookupTable - Create a lookup table to use as a switch replacement</span></div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;<span class="comment">    /// with the contents of Values, using DefaultValue to fill any holes in the</span></div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;<span class="comment">    /// table.</span></div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;<span class="comment"></span>    SwitchLookupTable(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>,</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;                      uint64_t TableSize,</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;                      <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Offset,</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;             <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl</a>&lt;std::pair&lt;ConstantInt*, Constant*&gt; &gt;&amp; Values,</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;                      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *DefaultValue,</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;                      <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD);</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;<span class="comment">    /// BuildLookup - Build instructions with Builder to retrieve the value at</span></div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;<span class="comment">    /// the position given by Index in the lookup table.</span></div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1Value.html">Value</a> *BuildLookup(<a class="code" href="classllvm_1_1Value.html">Value</a> *Index, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder);</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;<span class="comment">    /// WouldFitInRegister - Return true if a table with TableSize elements of</span></div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;<span class="comment">    /// type ElementType would fit in a target-legal register.</span></div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keywordtype">bool</span> WouldFitInRegister(<span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD,</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;                                   uint64_t TableSize,</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1Type.html">Type</a> *ElementType);</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;  <span class="keyword">private</span>:</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;    <span class="comment">// Depending on the contents of the table, it can be represented in</span></div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;    <span class="comment">// different ways.</span></div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;    <span class="keyword">enum</span> {</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;      <span class="comment">// For tables where each element contains the same value, we just have to</span></div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;      <span class="comment">// store that single value and return it for each lookup.</span></div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;      SingleValueKind,</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;      <span class="comment">// For small tables with integer elements, we can pack them into a bitmap</span></div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;      <span class="comment">// that fits into a target-legal register. Values are retrieved by</span></div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;      <span class="comment">// shift and mask operations.</span></div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;      BitMapKind,</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;      <span class="comment">// The table is stored as an array of values. Values are retrieved by load</span></div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;      <span class="comment">// instructions from the table.</span></div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;      ArrayKind</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;    } <a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">Kind</a>;</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;    <span class="comment">// For SingleValueKind, this is the single value.</span></div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *SingleValue;</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;    <span class="comment">// For BitMapKind, this is the bitmap.</span></div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *BitMap;</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;    <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *BitMapElementTy;</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;    <span class="comment">// For ArrayKind, this is the array.</span></div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;    <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *Array;</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;  };</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;}</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;SwitchLookupTable::SwitchLookupTable(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>,</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;                                     uint64_t TableSize,</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;                                     <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Offset,</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;             <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl</a>&lt;std::pair&lt;ConstantInt*, Constant*&gt; &gt;&amp; Values,</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;                                     <a class="code" href="classllvm_1_1Constant.html">Constant</a> *DefaultValue,</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;                                     <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD)</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;    : SingleValue(0), BitMap(0), BitMapElementTy(0), Array(0) {</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;  assert(Values.size() &amp;&amp; <span class="stringliteral">&quot;Can&#39;t build lookup table without values!&quot;</span>);</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;  assert(TableSize &gt;= Values.size() &amp;&amp; <span class="stringliteral">&quot;Can&#39;t fit values in table!&quot;</span>);</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;  <span class="comment">// If all values in the table are equal, this is that value.</span></div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;  SingleValue = Values.begin()-&gt;second;</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;  <span class="comment">// Build up the table contents.</span></div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Constant*, 64&gt;</a> TableContents(TableSize);</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = Values.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CaseVal = Values[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first;</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *CaseRes = Values[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].second;</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;    assert(CaseRes-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() == DefaultValue-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;    uint64_t Idx = (CaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>() - Offset-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>())</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;                   .getLimitedValue();</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;    TableContents[Idx] = CaseRes;</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;    <span class="keywordflow">if</span> (CaseRes != SingleValue)</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;      SingleValue = 0;</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;  }</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;  <span class="comment">// Fill in any holes in the table with the default result.</span></div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;  <span class="keywordflow">if</span> (Values.size() &lt; TableSize) {</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;    <span class="keywordflow">for</span> (uint64_t <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; TableSize; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;      <span class="keywordflow">if</span> (!TableContents[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>])</div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;        TableContents[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = DefaultValue;</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;    }</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;    <span class="keywordflow">if</span> (DefaultValue != SingleValue)</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;      SingleValue = 0;</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;  }</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;  <span class="comment">// If each element in the table contains the same value, we only need to store</span></div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;  <span class="comment">// that single value.</span></div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;  <span class="keywordflow">if</span> (SingleValue) {</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;    <a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">Kind</a> = SingleValueKind;</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;  }</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;  <span class="comment">// If the type is integer and the table fits in a register, build a bitmap.</span></div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;  <span class="keywordflow">if</span> (WouldFitInRegister(TD, TableSize, DefaultValue-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())) {</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;    <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *<a class="code" href="ARMSubtarget_8cpp.html#aae20c66ad7139c9837b1d07d3a8b12c8">IT</a> = cast&lt;IntegerType&gt;(DefaultValue-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> TableInt(TableSize * IT-&gt;<a class="code" href="classllvm_1_1IntegerType.html#a6f603ab84f6f7c79985036f58cca9d48">getBitWidth</a>(), 0);</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;    <span class="keywordflow">for</span> (uint64_t <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = TableSize; <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> &gt; 0; --<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;      TableInt &lt;&lt;= IT-&gt;<a class="code" href="classllvm_1_1IntegerType.html#a6f603ab84f6f7c79985036f58cca9d48">getBitWidth</a>();</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;      <span class="comment">// Insert values into the bitmap. Undef values are set to zero.</span></div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;UndefValue&gt;(TableContents[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1])) {</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;        <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Val = cast&lt;ConstantInt&gt;(TableContents[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1]);</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;        TableInt |= Val-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a6142fc5662411269a7ca0217f49f338c">zext</a>(TableInt.getBitWidth());</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;      }</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;    }</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;    BitMap = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(M.<a class="code" href="classllvm_1_1Module.html#a0e74af4b7c739f3a14e737c3042b6617">getContext</a>(), TableInt);</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;    BitMapElementTy = <a class="code" href="ARMSubtarget_8cpp.html#aae20c66ad7139c9837b1d07d3a8b12c8">IT</a>;</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;    <a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">Kind</a> = BitMapKind;</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;    ++NumBitMaps;</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;  }</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;  <span class="comment">// Store the table in an array.</span></div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;  <a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *ArrayTy = <a class="code" href="classllvm_1_1ArrayType.html#adf411edc4f135b570ab218079474ce77">ArrayType::get</a>(DefaultValue-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), TableSize);</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Initializer = <a class="code" href="classllvm_1_1ConstantArray.html#a0900dacdc7ad8e3ea0cc92993c7fd422">ConstantArray::get</a>(ArrayTy, TableContents);</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;  Array = <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(M, ArrayTy, <span class="comment">/*constant=*/</span> <span class="keyword">true</span>,</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;                             <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca04ed141708c0fd16723d212502b046ae">GlobalVariable::PrivateLinkage</a>,</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;                             Initializer,</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;                             <span class="stringliteral">&quot;switch.table&quot;</span>);</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;  Array-&gt;setUnnamedAddr(<span class="keyword">true</span>);</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;  <a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">Kind</a> = ArrayKind;</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;}</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *SwitchLookupTable::BuildLookup(<a class="code" href="classllvm_1_1Value.html">Value</a> *Index, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder) {</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">Kind</a>) {</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;    <span class="keywordflow">case</span> SingleValueKind:</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;      <span class="keywordflow">return</span> SingleValue;</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;    <span class="keywordflow">case</span> BitMapKind: {</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;      <span class="comment">// Type of the bitmap (e.g. i59).</span></div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;      <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *MapTy = BitMap-&gt;getType();</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;      <span class="comment">// Cast Index to the same type as the bitmap.</span></div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;      <span class="comment">// Note: The Index is &lt;= the number of elements in the table, so</span></div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;      <span class="comment">// truncating it to the width of the bitmask is safe.</span></div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *ShiftAmt = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a7cca116ba5ef3fe3dfc9872b1600d11d">CreateZExtOrTrunc</a>(Index, MapTy, <span class="stringliteral">&quot;switch.cast&quot;</span>);</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;      <span class="comment">// Multiply the shift amount by the element width.</span></div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;      ShiftAmt = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a94c18bf85a5105e0a22fba23b0bedafa">CreateMul</a>(ShiftAmt,</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;                      <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(MapTy, BitMapElementTy-&gt;<a class="code" href="classllvm_1_1IntegerType.html#a6f603ab84f6f7c79985036f58cca9d48">getBitWidth</a>()),</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;                                   <span class="stringliteral">&quot;switch.shiftamt&quot;</span>);</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;      <span class="comment">// Shift down.</span></div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *DownShifted = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a3f8c45ea10c393433221a508b750dcd5">CreateLShr</a>(BitMap, ShiftAmt,</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;                                              <span class="stringliteral">&quot;switch.downshift&quot;</span>);</div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;      <span class="comment">// Mask off.</span></div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;      <span class="keywordflow">return</span> Builder.<a class="code" href="classllvm_1_1IRBuilder.html#aa933549689e79685bb67de64dddc9f7c">CreateTrunc</a>(DownShifted, BitMapElementTy,</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;                                 <span class="stringliteral">&quot;switch.masked&quot;</span>);</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;    }</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;    <span class="keywordflow">case</span> ArrayKind: {</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *GEPIndices[] = { Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#ac0e8c554bf1c1e117a74d51df89c137d">getInt32</a>(0), Index };</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *GEP = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a1f5e8b8d535e593299355288aa0cbd67">CreateInBoundsGEP</a>(Array, GEPIndices,</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;                                             <span class="stringliteral">&quot;switch.gep&quot;</span>);</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;      <span class="keywordflow">return</span> Builder.<a class="code" href="classllvm_1_1IRBuilder.html#af440b535b3b4e8d0d089dd0ed2283a0f">CreateLoad</a>(GEP, <span class="stringliteral">&quot;switch.load&quot;</span>);</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;    }</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;  }</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;  <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unknown lookup table kind!&quot;</span>);</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;}</div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;<span class="keywordtype">bool</span> SwitchLookupTable::WouldFitInRegister(<span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD,</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;                                           uint64_t TableSize,</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;                                           <span class="keyword">const</span> <a class="code" href="classllvm_1_1Type.html">Type</a> *ElementType) {</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;  <span class="keywordflow">if</span> (!TD)</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *<a class="code" href="ARMSubtarget_8cpp.html#aae20c66ad7139c9837b1d07d3a8b12c8">IT</a> = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a>&gt;(ElementType);</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;  <span class="keywordflow">if</span> (!IT)</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;  <span class="comment">// FIXME: If the type is wider than it needs to be, e.g. i8 but all values</span></div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;  <span class="comment">// are &lt;= 15, we could try to narrow the type.</span></div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;  <span class="comment">// Avoid overflow, fitsInLegalInteger uses unsigned int for the width.</span></div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;  <span class="keywordflow">if</span> (TableSize &gt;= UINT_MAX/IT-&gt;<a class="code" href="classllvm_1_1IntegerType.html#a6f603ab84f6f7c79985036f58cca9d48">getBitWidth</a>())</div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;  <span class="keywordflow">return</span> TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a87901387c729722d5d63edd1d35119d7">fitsInLegalInteger</a>(TableSize * IT-&gt;<a class="code" href="classllvm_1_1IntegerType.html#a6f603ab84f6f7c79985036f58cca9d48">getBitWidth</a>());</div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;}</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;<span class="comment">/// ShouldBuildLookupTable - Determine whether a lookup table should be built</span></div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;<span class="comment">/// for this switch, based on the number of cases, size of the table and the</span></div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;<span class="comment">/// types of the results.</span></div><div class="line"><a name="l03621"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#ac6717dc342ae7060e07e4585282552e7"> 3621</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#ac6717dc342ae7060e07e4585282552e7">ShouldBuildLookupTable</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI,</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;                                   uint64_t TableSize,</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI,</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD,</div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;                            <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;PHINode*, Type*&gt;</a>&amp; ResultTypes) {</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;  <span class="keywordflow">if</span> (SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a4901d4ad48420014059e9393f75442ae">getNumCases</a>() &gt; TableSize || TableSize &gt;= UINT64_MAX / 10)</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// TableSize overflowed, or mul below might overflow.</span></div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;</div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;  <span class="keywordtype">bool</span> AllTablesFitInRegister = <span class="keyword">true</span>;</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;  <span class="keywordtype">bool</span> HasIllegalType = <span class="keyword">false</span>;</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;PHINode*, Type*&gt;::const_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ResultTypes.<a class="code" href="classllvm_1_1DenseMapBase.html#a432d7e955f44b118b4261eae03d7a8af">begin</a>(),</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;       E = ResultTypes.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;    <span class="comment">// Saturate this flag to true.</span></div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;    HasIllegalType = HasIllegalType || !TTI.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a83f052a0d908e956128c8951451bde39">isTypeLegal</a>(Ty);</div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;    <span class="comment">// Saturate this flag to false.</span></div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;    AllTablesFitInRegister = AllTablesFitInRegister &amp;&amp;</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;      SwitchLookupTable::WouldFitInRegister(TD, TableSize, Ty);</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;    <span class="comment">// If both flags saturate, we&#39;re done. NOTE: This *only* works with</span></div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;    <span class="comment">// saturating flags, and all flags have to saturate first due to the</span></div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;    <span class="comment">// non-deterministic behavior of iterating over a dense map.</span></div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;    <span class="keywordflow">if</span> (HasIllegalType &amp;&amp; !AllTablesFitInRegister)</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;  }</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;  <span class="comment">// If each table would fit in a register, we should build it anyway.</span></div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;  <span class="keywordflow">if</span> (AllTablesFitInRegister)</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;  <span class="comment">// Don&#39;t build a table that doesn&#39;t fit in-register if it has illegal types.</span></div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;  <span class="keywordflow">if</span> (HasIllegalType)</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;  <span class="comment">// The table density should be at least 40%. This is the same criterion as for</span></div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;  <span class="comment">// jump tables, see SelectionDAGBuilder::handleJTSwitchCase.</span></div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;  <span class="comment">// FIXME: Find the best cut-off.</span></div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;  <span class="keywordflow">return</span> SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a4901d4ad48420014059e9393f75442ae">getNumCases</a>() * 10 &gt;= TableSize * 4;</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;}</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;<span class="comment">/// SwitchToLookupTable - If the switch is only used to initialize one or more</span></div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;<span class="comment">/// phi nodes in a common successor block with different constant values,</span></div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;<span class="comment">/// replace the switch with lookup tables.</span></div><div class="line"><a name="l03666"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#af6a36137bc1746faed3554c1eefe138a"> 3666</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#af6a36137bc1746faed3554c1eefe138a">SwitchToLookupTable</a>(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI,</div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;                                <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder,</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;                                <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI,</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;                                <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a>* TD) {</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;  assert(SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a4901d4ad48420014059e9393f75442ae">getNumCases</a>() &gt; 1 &amp;&amp; <span class="stringliteral">&quot;Degenerate switch?&quot;</span>);</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;  <span class="comment">// Only build lookup table when we have a target that supports it.</span></div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;  <span class="keywordflow">if</span> (!TTI.<a class="code" href="classllvm_1_1TargetTransformInfo.html#a74d97d9e66d1007252d8609b7b8ccf21">shouldBuildLookupTables</a>())</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;  <span class="comment">// FIXME: If the switch is too sparse for a lookup table, perhaps we could</span></div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;  <span class="comment">// split off a dense part and build a lookup table for that.</span></div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;  <span class="comment">// FIXME: This creates arrays of GEPs to constant strings, which means each</span></div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;  <span class="comment">// GEP needs a runtime relocation in PIC code. We should just build one big</span></div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;  <span class="comment">// string and lookup indices into that.</span></div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;  <span class="comment">// Ignore the switch if the number of cases is too small.</span></div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;  <span class="comment">// This is similar to the check when building jump tables in</span></div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;  <span class="comment">// SelectionDAGBuilder::handleJTSwitchCase.</span></div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;  <span class="comment">// FIXME: Determine the best cut-off.</span></div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;  <span class="keywordflow">if</span> (SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a4901d4ad48420014059e9393f75442ae">getNumCases</a>() &lt; 4)</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;  <span class="comment">// Figure out the corresponding result for each case value and phi node in the</span></div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;  <span class="comment">// common destination, as well as the the min and max case values.</span></div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;  assert(SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#ae69c15ce940c41719cb96209e113a26e">case_begin</a>() != SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a219f2a3514d904d05dc8003a4ee5d291">case_end</a>());</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;  <a class="code" href="classllvm_1_1SwitchInst_1_1CaseIt.html">SwitchInst::CaseIt</a> CI = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#ae69c15ce940c41719cb96209e113a26e">case_begin</a>();</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *MinCaseVal = CI.getCaseValue();</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *MaxCaseVal = CI.getCaseValue();</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CommonDest = 0;</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;ConstantInt*, Constant*&gt;</a>, 4&gt; ResultListTy;</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;PHINode*, ResultListTy&gt;</a> ResultLists;</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;PHINode*, Constant*&gt;</a> DefaultResults;</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;  <a class="code" href="classllvm_1_1SmallDenseMap.html">SmallDenseMap&lt;PHINode*, Type*&gt;</a> ResultTypes;</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;PHINode*, 4&gt;</a> PHIs;</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SwitchInst_1_1CaseIt.html">SwitchInst::CaseIt</a> E = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a219f2a3514d904d05dc8003a4ee5d291">case_end</a>(); CI != E; ++CI) {</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CaseVal = CI.getCaseValue();</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;    <span class="keywordflow">if</span> (CaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a0cf8014ad2d33b40a6bef55018547f57">slt</a>(MinCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>()))</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;      MinCaseVal = CaseVal;</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;    <span class="keywordflow">if</span> (CaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#a0671bc479b3d788cc233dc1ce20ebcb5">sgt</a>(MaxCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>()))</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;      MaxCaseVal = CaseVal;</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;    <span class="comment">// Resulting value at phi nodes for this case value.</span></div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;PHINode*, Constant*&gt;</a>, 4&gt; ResultsTy;</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;    ResultsTy Results;</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#abfe18d4b03b813d04ffd79e706cc62aa">GetCaseResults</a>(SI, CaseVal, CI.getCaseSuccessor(), &amp;CommonDest,</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;                        Results, TD))</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;    <span class="comment">// Append the result from this case to the list for each phi.</span></div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;    <span class="keywordflow">for</span> (ResultsTy::iterator <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Results.begin(), E = Results.end(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>!=E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;      <span class="keywordflow">if</span> (!ResultLists.<a class="code" href="classllvm_1_1DenseMapBase.html#a4efb46d4834f6f750ae0649ed89ce44c">count</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first))</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;        PHIs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first);</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;      ResultLists[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first].push_back(std::make_pair(CaseVal, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second));</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;    }</div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;  }</div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;</div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;  <span class="comment">// Get the resulting values for the default case.</span></div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;PHINode*, Constant*&gt;</a>, 4&gt; DefaultResultsList;</div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#abfe18d4b03b813d04ffd79e706cc62aa">GetCaseResults</a>(SI, 0, SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a3feb6090a53e81f06d82da0a97be6e19">getDefaultDest</a>(), &amp;CommonDest,</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;                      DefaultResultsList, TD))</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = DefaultResultsList.size(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a> = DefaultResultsList[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].first;</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Result = DefaultResultsList[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>].second;</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;    DefaultResults[<a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a>] = Result;</div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;    ResultTypes[<a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a>] = Result-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>();</div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;  }</div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> RangeSpread = MaxCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>() - MinCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>();</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;  uint64_t TableSize = RangeSpread.<a class="code" href="classllvm_1_1APInt.html#ae0c5e70885cf005feb6707932774f99c">getLimitedValue</a>() + 1;</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="SimplifyCFG_8cpp.html#ac6717dc342ae7060e07e4585282552e7">ShouldBuildLookupTable</a>(SI, TableSize, TTI, TD, ResultTypes))</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;</div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;  <span class="comment">// Create the BB that does the lookups.</span></div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;  <a class="code" href="classllvm_1_1Module.html">Module</a> &amp;Mod = *CommonDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>()-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>();</div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *LookupBB = <a class="code" href="classllvm_1_1BasicBlock.html#ae1d53a21892854816885c7288f8b46f1">BasicBlock::Create</a>(Mod.<a class="code" href="classllvm_1_1Module.html#a0e74af4b7c739f3a14e737c3042b6617">getContext</a>(),</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;                                            <span class="stringliteral">&quot;switch.lookup&quot;</span>,</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;                                            CommonDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>(),</div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;                                            CommonDest);</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;  <span class="comment">// Compute the table index value.</span></div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;  Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(SI);</div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *TableIndex = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#afa1cb82e021c7f516f65d40162fe6c53">CreateSub</a>(SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#add5ee99852e9927d0777e74572c91708">getCondition</a>(), MinCaseVal,</div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;                                        <span class="stringliteral">&quot;switch.tableidx&quot;</span>);</div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;</div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;  <span class="comment">// Compute the maximum table size representable by the integer type we are</span></div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;  <span class="comment">// switching upon.</span></div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;  <span class="keywordtype">unsigned</span> CaseSize = MinCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a240475f85dea79ec272c578fdf89acf1">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a5a7cfa245af120b44ac8a86143bb9e57">getPrimitiveSizeInBits</a>();</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;  uint64_t MaxTableSize = CaseSize &gt; 63? UINT64_MAX : 1ULL &lt;&lt; CaseSize;</div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;  assert(MaxTableSize &gt;= TableSize &amp;&amp;</div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;         <span class="stringliteral">&quot;It is impossible for a switch to have more entries than the max &quot;</span></div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;         <span class="stringliteral">&quot;representable value of its input integer type&#39;s size.&quot;</span>);</div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;  <span class="comment">// If we have a fully covered lookup table, unconditionally branch to the</span></div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;  <span class="comment">// lookup table BB. Otherwise, check if the condition value is within the case</span></div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;  <span class="comment">// range. If it is so, branch to the new BB. Otherwise branch to SI&#39;s default</span></div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;  <span class="comment">// destination.</span></div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> GeneratingCoveredLookupTable = MaxTableSize == TableSize;</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;  <span class="keywordflow">if</span> (GeneratingCoveredLookupTable) {</div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;    Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a0c00110a06b1eb96c92f87e4ca28129a">CreateBr</a>(LookupBB);</div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;    SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a3feb6090a53e81f06d82da0a97be6e19">getDefaultDest</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6f6763e343549d530a1424f1b24053bb">removePredecessor</a>(SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Cmp = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a9c30c87af01068ceae02cd371748d175">CreateICmpULT</a>(TableIndex, <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(</div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;                                         MinCaseVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a240475f85dea79ec272c578fdf89acf1">getType</a>(), TableSize));</div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;    Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a75e386c51bb947f44935b3c392a8eb4f">CreateCondBr</a>(Cmp, LookupBB, SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a3feb6090a53e81f06d82da0a97be6e19">getDefaultDest</a>());</div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;  }</div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;</div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;  <span class="comment">// Populate the BB that does the lookups.</span></div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;  Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(LookupBB);</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;  <span class="keywordtype">bool</span> ReturnedEarly = <span class="keyword">false</span>;</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = PHIs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a> = PHIs[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;    SwitchLookupTable Table(Mod, TableSize, MinCaseVal, ResultLists[PHI],</div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;                            DefaultResults[PHI], TD);</div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;</div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Result = Table.BuildLookup(TableIndex, Builder);</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;    <span class="comment">// If the result is used to return immediately from the function, we want to</span></div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;    <span class="comment">// do that right here.</span></div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;    <span class="keywordflow">if</span> (PHI-&gt;hasOneUse() &amp;&amp; isa&lt;ReturnInst&gt;(*PHI-&gt;use_begin()) &amp;&amp;</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;        *PHI-&gt;use_begin() == CommonDest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a225cbda41f4c27fbb522833e31cb18f9">getFirstNonPHIOrDbg</a>()) {</div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;      Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a08a2941811ad93b69f0174b5e8104cc6">CreateRet</a>(Result);</div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;      ReturnedEarly = <span class="keyword">true</span>;</div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;    }</div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;    PHI-&gt;addIncoming(Result, LookupBB);</div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;  }</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;  <span class="keywordflow">if</span> (!ReturnedEarly)</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;    Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a0c00110a06b1eb96c92f87e4ca28129a">CreateBr</a>(CommonDest);</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;</div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;  <span class="comment">// Remove the switch.</span></div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a1911781fed54dee847a46bf4fa4c5c34">getNumSuccessors</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#aef88cf6f3b68009b7901343e934368a8">getSuccessor</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;    <span class="keywordflow">if</span> (Succ == SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#a3feb6090a53e81f06d82da0a97be6e19">getDefaultDest</a>())</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;    Succ-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6f6763e343549d530a1424f1b24053bb">removePredecessor</a>(SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;  }</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;  SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;  ++NumLookupTables;</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;}</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::SimplifySwitch(<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder) {</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;  <span class="keywordflow">if</span> (isValueEqualityComparison(SI)) {</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;    <span class="comment">// If we only have one predecessor, and if it is a branch on this value,</span></div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;    <span class="comment">// see if that predecessor totally determines the outcome of this switch.</span></div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *OnlyPred = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5ef55181ae0bb0f5c561b9a29087b1e5">getSinglePredecessor</a>())</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;      <span class="keywordflow">if</span> (SimplifyEqualityComparisonWithOnlyPredecessor(SI, OnlyPred, Builder))</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Cond = SI-&gt;<a class="code" href="classllvm_1_1SwitchInst.html#add5ee99852e9927d0777e74572c91708">getCondition</a>();</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *<a class="code" href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba32dbd2c72a98eaee90e3ad5ef7b5af16">Select</a> = dyn_cast&lt;SelectInst&gt;(Cond))</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#af0d7fe1e3aa12d83e0af774a398d34ab">SimplifySwitchOnSelect</a>(SI, <a class="code" href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba32dbd2c72a98eaee90e3ad5ef7b5af16">Select</a>))</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;    <span class="comment">// If the block only contains the switch, see if we can fold the block</span></div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;    <span class="comment">// away into any preds.</span></div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;    <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;    <span class="comment">// Ignore dbg intrinsics.</span></div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;    <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(BBI))</div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;      ++BBI;</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;    <span class="keywordflow">if</span> (SI == &amp;*BBI)</div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;      <span class="keywordflow">if</span> (FoldValueComparisonIntoPredecessors(SI, Builder))</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;  }</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;  <span class="comment">// Try to transform the switch into an icmp and a branch.</span></div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#abf5ef34c952cc6bc5dce92d91598bdd2">TurnSwitchRangeIntoICmp</a>(SI, Builder))</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;  <span class="comment">// Remove unreachable cases.</span></div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a48977a4b045a92bc5cf1c0ad4d95129e">EliminateDeadSwitchCases</a>(SI))</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a819fe08329be34252ffde1e710574a34">ForwardSwitchConditionToPHI</a>(SI))</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#af6a36137bc1746faed3554c1eefe138a">SwitchToLookupTable</a>(SI, Builder, TTI, TD))</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;}</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::SimplifyIndirectBr(<a class="code" href="classllvm_1_1IndirectBrInst.html">IndirectBrInst</a> *IBI) {</div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = IBI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;  <span class="comment">// Eliminate redundant destinations.</span></div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value *, 8&gt;</a> Succs;</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = IBI-&gt;<a class="code" href="classllvm_1_1IndirectBrInst.html#a9e58646ca23225c0895a274e0e4704bf">getNumDestinations</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Dest = IBI-&gt;<a class="code" href="classllvm_1_1IndirectBrInst.html#a45656d5a2f380720a7618495fceed01e">getDestination</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;    <span class="keywordflow">if</span> (!Dest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a12fd03c41b1697fca070c12317794400">hasAddressTaken</a>() || !Succs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(Dest)) {</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;      Dest-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6f6763e343549d530a1424f1b24053bb">removePredecessor</a>(BB);</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;      IBI-&gt;<a class="code" href="classllvm_1_1IndirectBrInst.html#ac0cc9b34e16910d245245642350d4456">removeDestination</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;      --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>; --e;</div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;    }</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;  }</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;  <span class="keywordflow">if</span> (IBI-&gt;<a class="code" href="classllvm_1_1IndirectBrInst.html#a9e58646ca23225c0895a274e0e4704bf">getNumDestinations</a>() == 0) {</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;    <span class="comment">// If the indirectbr has no successors, change it to unreachable.</span></div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;    <span class="keyword">new</span> <a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a>(IBI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), IBI);</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">EraseTerminatorInstAndDCECond</a>(IBI);</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;  }</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;  <span class="keywordflow">if</span> (IBI-&gt;<a class="code" href="classllvm_1_1IndirectBrInst.html#a9e58646ca23225c0895a274e0e4704bf">getNumDestinations</a>() == 1) {</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;    <span class="comment">// If the indirectbr has one successor, change it to a direct branch.</span></div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html#ae9cbc599309fd2da33ec1c61df01ce1f">BranchInst::Create</a>(IBI-&gt;<a class="code" href="classllvm_1_1IndirectBrInst.html#a45656d5a2f380720a7618495fceed01e">getDestination</a>(0), IBI);</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;    <a class="code" href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">EraseTerminatorInstAndDCECond</a>(IBI);</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;  }</div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;</div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *SI = dyn_cast&lt;SelectInst&gt;(IBI-&gt;<a class="code" href="classllvm_1_1IndirectBrInst.html#a1ce0a14a79ac73a91f38aa91899bb377">getAddress</a>())) {</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a3ab1a6ec499c9bfd45258e149aa555c5">SimplifyIndirectBrOnSelect</a>(IBI, SI))</div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;  }</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;}</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::SimplifyUncondBranch(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder){</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;</div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#ac7707bcaec113d0d136467c7b97a62f1">SinkCommon</a> &amp;&amp; <a class="code" href="SimplifyCFG_8cpp.html#a136cc7ed9c1041928df9f03631026a0d">SinkThenElseCodeToEnd</a>(BI))</div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;</div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;  <span class="comment">// If the Terminator is the only non-phi instruction, simplify the block.</span></div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a00d5f71636b8a01747f15800b9a7a86a">getFirstNonPHIOrDbgOrLifetime</a>();</div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;  <span class="keywordflow">if</span> (I-&gt;isTerminator() &amp;&amp; BB != &amp;BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>()-&gt;<a class="code" href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">getEntryBlock</a>() &amp;&amp;</div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;      <a class="code" href="namespacellvm.html#a599000eece6fb1addb05b6b2c36be28c">TryToSimplifyUncondBranchFromEmptyBlock</a>(BB))</div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;</div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;  <span class="comment">// If the only instruction in the block is a seteq/setne comparison</span></div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;  <span class="comment">// against a constant, try to simplify the block.</span></div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI = dyn_cast&lt;ICmpInst&gt;(I))</div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;    <span class="keywordflow">if</span> (ICI-&gt;isEquality() &amp;&amp; isa&lt;ConstantInt&gt;(ICI-&gt;getOperand(1))) {</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;      <span class="keywordflow">for</span> (++I; isa&lt;DbgInfoIntrinsic&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;        ;</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;      <span class="keywordflow">if</span> (I-&gt;isTerminator() &amp;&amp;</div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;          <a class="code" href="SimplifyCFG_8cpp.html#a59db00fcf511b059606e9eddd6675883">TryToSimplifyUncondBranchWithICmpInIt</a>(ICI, Builder, TTI, TD))</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;    }</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;</div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;  <span class="comment">// If this basic block is ONLY a compare and a branch, and if a predecessor</span></div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;  <span class="comment">// branches to us and our successor, fold the comparison into the</span></div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;  <span class="comment">// predecessor and use logical operations to update the incoming value</span></div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;  <span class="comment">// for PHI nodes in common successor.</span></div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ab75560d250028c3c4e54556421109b9d">FoldBranchToCommonDest</a>(BI))</div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;}</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;</div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::SimplifyCondBranch(<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI, <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder) {</div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;</div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;  <span class="comment">// Conditional branch</span></div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;  <span class="keywordflow">if</span> (isValueEqualityComparison(BI)) {</div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;    <span class="comment">// If we only have one predecessor, and if it is a branch on this value,</span></div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;    <span class="comment">// see if that predecessor totally determines the outcome of this</span></div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;    <span class="comment">// switch.</span></div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *OnlyPred = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5ef55181ae0bb0f5c561b9a29087b1e5">getSinglePredecessor</a>())</div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;      <span class="keywordflow">if</span> (SimplifyEqualityComparisonWithOnlyPredecessor(BI, OnlyPred, Builder))</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;</div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;    <span class="comment">// This block must be empty, except for the setcond inst, if it exists.</span></div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;    <span class="comment">// Ignore dbg intrinsics.</span></div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;    <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;    <span class="comment">// Ignore dbg intrinsics.</span></div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;    <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(I))</div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;      ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;    <span class="keywordflow">if</span> (&amp;*I == BI) {</div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;      <span class="keywordflow">if</span> (FoldValueComparisonIntoPredecessors(BI, Builder))</div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (&amp;*I == cast&lt;Instruction&gt;(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>())){</div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;      ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;      <span class="comment">// Ignore dbg intrinsics.</span></div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;      <span class="keywordflow">while</span> (isa&lt;DbgInfoIntrinsic&gt;(I))</div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;        ++I;</div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;      <span class="keywordflow">if</span> (&amp;*I == BI &amp;&amp; FoldValueComparisonIntoPredecessors(BI, Builder))</div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;    }</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;  }</div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;</div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;  <span class="comment">// Try to turn &quot;br (X == 0 | X == 1), T, F&quot; into a switch instruction.</span></div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a39eb6c7310d5673dad5be0af7c6a79f8">SimplifyBranchOnICmpChain</a>(BI, TD, Builder))</div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;</div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;  <span class="comment">// If this basic block is ONLY a compare and a branch, and if a predecessor</span></div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;  <span class="comment">// branches to us and one of our successors, fold the comparison into the</span></div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;  <span class="comment">// predecessor and use logical operations to pick the right destination.</span></div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ab75560d250028c3c4e54556421109b9d">FoldBranchToCommonDest</a>(BI))</div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;</div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;  <span class="comment">// We have a conditional branch to two blocks that are only reachable</span></div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;  <span class="comment">// from BI.  We know that the condbr dominates the two blocks, so see if</span></div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;  <span class="comment">// there is any identical code in the &quot;then&quot; and &quot;else&quot; blocks.  If so, we</span></div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;  <span class="comment">// can hoist it up to the branching block.</span></div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;  <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5ef55181ae0bb0f5c561b9a29087b1e5">getSinglePredecessor</a>() != 0) {</div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;    <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5ef55181ae0bb0f5c561b9a29087b1e5">getSinglePredecessor</a>() != 0) {</div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a6434e674d53619188f1a6b4bac3b304e">HoistThenElseCodeToIf</a>(BI))</div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;      <span class="comment">// If Successor #1 has multiple preds, we may be able to conditionally</span></div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;      <span class="comment">// execute Successor #0 if it branches to successor #1.</span></div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;      <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *Succ0TI = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>();</div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;      <span class="keywordflow">if</span> (Succ0TI-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a4c26d3b92af99a6c8defd89a2d39ca32">getNumSuccessors</a>() == 1 &amp;&amp;</div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;          Succ0TI-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a3aac3b6c36415a2b08f65ead9e3e51e7">getSuccessor</a>(0) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1))</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#ab63479922d7b88d6b4fc5d31458e44fd">SpeculativelyExecuteBB</a>(BI, BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0)))</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;    }</div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5ef55181ae0bb0f5c561b9a29087b1e5">getSinglePredecessor</a>() != 0) {</div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;    <span class="comment">// If Successor #0 has multiple preds, we may be able to conditionally</span></div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;    <span class="comment">// execute Successor #1 if it branches to successor #0.</span></div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;    <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *Succ1TI = BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>();</div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;    <span class="keywordflow">if</span> (Succ1TI-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a4c26d3b92af99a6c8defd89a2d39ca32">getNumSuccessors</a>() == 1 &amp;&amp;</div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;        Succ1TI-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a3aac3b6c36415a2b08f65ead9e3e51e7">getSuccessor</a>(0) == BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0))</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#ab63479922d7b88d6b4fc5d31458e44fd">SpeculativelyExecuteBB</a>(BI, BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1)))</div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;  }</div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;</div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;  <span class="comment">// If this is a branch on a phi node in the current block, thread control</span></div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;  <span class="comment">// through this block if any PHI node entries are constants.</span></div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">getCondition</a>()))</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;    <span class="keywordflow">if</span> (PN-&gt;getParent() == BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>())</div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a1e3544295480ec7b23c650873d046538">FoldCondBranchOnPHI</a>(BI, TD))</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;  <span class="comment">// Scan predecessor blocks for conditional branches.</span></div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PredIterator.html">pred_iterator</a> PI = <a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(BB), E = <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(BB); PI != E; ++PI)</div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *PBI = dyn_cast&lt;BranchInst&gt;((*PI)-&gt;getTerminator()))</div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;      <span class="keywordflow">if</span> (PBI != BI &amp;&amp; PBI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a03cc0dff22b31447f43af97acb76b1a2">isConditional</a>())</div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a285d756a993fe2460d35129ba58f92a2">SimplifyCondBranchToCondBranch</a>(PBI, BI))</div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">SimplifyCFG</a>(BB, TTI, TD) | <span class="keyword">true</span>;</div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;</div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;}</div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;<span class="comment">/// Check if passing a value to an instruction will cause undefined behavior.</span></div><div class="line"><a name="l04016"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a8d718b79cd2832d71600169ac3e132b0"> 4016</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a8d718b79cd2832d71600169ac3e132b0">passingValueIsAlwaysUndefined</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Constant.html">Constant</a>&gt;(V);</div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;  <span class="keywordflow">if</span> (!C)</div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;</div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;  <span class="keywordflow">if</span> (I-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>())</div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;</div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;  <span class="keywordflow">if</span> (C-&gt;<a class="code" href="classllvm_1_1Constant.html#ad7ec8482f19e8e86e3de573b060a17e5">isNullValue</a>()) {</div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;    <span class="comment">// Only look at the first use, avoid hurting compile time with long uselists</span></div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;    <a class="code" href="classllvm_1_1User.html">User</a> *<a class="code" href="classllvm_1_1Use.html">Use</a> = *I-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>();</div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;</div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;    <span class="comment">// Now make sure that there are no instructions in between that can alter</span></div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;    <span class="comment">// control flow (eg. calls)</span></div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = ++<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a>(I); &amp;*<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != Use; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> == I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>() || <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>-&gt;mayHaveSideEffects())</div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;</div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;    <span class="comment">// Look through GEPs. A load from a GEP derived from NULL is still undefined</span></div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEP = dyn_cast&lt;GetElementPtrInst&gt;(Use))</div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;      <span class="keywordflow">if</span> (GEP-&gt;getPointerOperand() == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="SimplifyCFG_8cpp.html#a8d718b79cd2832d71600169ac3e132b0">passingValueIsAlwaysUndefined</a>(V, GEP);</div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;    <span class="comment">// Look through bitcasts.</span></div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BC = dyn_cast&lt;BitCastInst&gt;(Use))</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="SimplifyCFG_8cpp.html#a8d718b79cd2832d71600169ac3e132b0">passingValueIsAlwaysUndefined</a>(V, BC);</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;</div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;    <span class="comment">// Load from null is undefined.</span></div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(Use))</div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;      <span class="keywordflow">if</span> (!LI-&gt;isVolatile())</div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;        <span class="keywordflow">return</span> LI-&gt;getPointerAddressSpace() == 0;</div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;</div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;    <span class="comment">// Store to null is undefined.</span></div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(Use))</div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;      <span class="keywordflow">if</span> (!SI-&gt;isVolatile())</div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;        <span class="keywordflow">return</span> SI-&gt;getPointerAddressSpace() == 0 &amp;&amp; SI-&gt;getPointerOperand() == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;  }</div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;}</div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;<span class="comment">/// If BB has an incoming value that will always trigger undefined behavior</span></div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;<span class="comment">/// (eg. null pointer dereference), remove the branch leading here.</span></div><div class="line"><a name="l04058"></a><span class="lineno"><a class="line" href="SimplifyCFG_8cpp.html#a2026c2afa149ebc0c1ac8fd091fdc22c"> 4058</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="SimplifyCFG_8cpp.html#a2026c2afa149ebc0c1ac8fd091fdc22c">removeUndefIntroducingPredecessor</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;       <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *<a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a> = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>); ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PHI-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="SimplifyCFG_8cpp.html#a8d718b79cd2832d71600169ac3e132b0">passingValueIsAlwaysUndefined</a>(PHI-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>), <a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">PHI</a>)) {</div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;        <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *<a class="code" href="classT.html">T</a> = PHI-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>();</div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;        <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(T);</div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(T)) {</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;          BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6f6763e343549d530a1424f1b24053bb">removePredecessor</a>(PHI-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;          <span class="comment">// Turn uncoditional branches into unreachables and remove the dead</span></div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;          <span class="comment">// destination from conditional branches.</span></div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;          <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a382131e712e55e8324fbd5068de17b78">isUnconditional</a>())</div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;            Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a0d03639f5d4cef9541e5e8dbe46830cb">CreateUnreachable</a>();</div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;            Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a0c00110a06b1eb96c92f87e4ca28129a">CreateBr</a>(BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0) == BB ? BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(1) :</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;                                                         BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">getSuccessor</a>(0));</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;          BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;        }</div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;        <span class="comment">// TODO: SwitchInst.</span></div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;      }</div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;}</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;<span class="keywordtype">bool</span> SimplifyCFGOpt::run(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;</div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;  assert(BB &amp;&amp; BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>() &amp;&amp; <span class="stringliteral">&quot;Block not embedded in function!&quot;</span>);</div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;  assert(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>() &amp;&amp; <span class="stringliteral">&quot;Degenerate basic block encountered!&quot;</span>);</div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;  <span class="comment">// Remove basic blocks that have no predecessors (except the entry block)...</span></div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;  <span class="comment">// or that just have themself as a predecessor.  These are unreachable.</span></div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;  <span class="keywordflow">if</span> ((<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(BB) == <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(BB) &amp;&amp;</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;       BB != &amp;BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>()-&gt;<a class="code" href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">getEntryBlock</a>()) ||</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;      BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5ef55181ae0bb0f5c561b9a29087b1e5">getSinglePredecessor</a>() == <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Removing BB: \n&quot;</span> &lt;&lt; *BB);</div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;    <a class="code" href="namespacellvm.html#a9d7d0a4008434561f28c20126b992b89">DeleteDeadBlock</a>(BB);</div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;  }</div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;  <span class="comment">// Check to see if we can constant propagate this terminator instruction</span></div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;  <span class="comment">// away...</span></div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;  Changed |= <a class="code" href="namespacellvm.html#a78ab69092404fc83d77ccb06b3f7138d">ConstantFoldTerminator</a>(BB, <span class="keyword">true</span>);</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;  <span class="comment">// Check for and eliminate duplicate PHI nodes in this block.</span></div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;  Changed |= <a class="code" href="namespacellvm.html#aed498f056a09006219c59ee9fab0450f">EliminateDuplicatePHINodes</a>(BB);</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;</div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;  <span class="comment">// Check for and remove branches that will always cause undefined behavior.</span></div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;  Changed |= <a class="code" href="SimplifyCFG_8cpp.html#a2026c2afa149ebc0c1ac8fd091fdc22c">removeUndefIntroducingPredecessor</a>(BB);</div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;</div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;  <span class="comment">// Merge basic blocks into their predecessor if there is only one distinct</span></div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;  <span class="comment">// pred, and if there is only one distinct successor of the predecessor, and</span></div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;  <span class="comment">// if there are no PHI nodes.</span></div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a0f249e36f196bbea3e4178ad0793544d">MergeBlockIntoPredecessor</a>(BB))</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;</div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(BB);</div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;</div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;  <span class="comment">// If there is a trivial two-entry PHI node in this basic block, and we can</span></div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;  <span class="comment">// eliminate it, do so now.</span></div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()))</div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;    <span class="keywordflow">if</span> (PN-&gt;getNumIncomingValues() == 2)</div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;      Changed |= <a class="code" href="SimplifyCFG_8cpp.html#a518d290fbe6b5f5e314e5b4e29780635">FoldTwoEntryPHINode</a>(PN, TD);</div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;</div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;  Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>())) {</div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;    <span class="keywordflow">if</span> (BI-&gt;<a class="code" href="classllvm_1_1BranchInst.html#a382131e712e55e8324fbd5068de17b78">isUnconditional</a>()) {</div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;      <span class="keywordflow">if</span> (SimplifyUncondBranch(BI, Builder)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;      <span class="keywordflow">if</span> (SimplifyCondBranch(BI, Builder)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;    }</div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *RI = dyn_cast&lt;ReturnInst&gt;(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>())) {</div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;    <span class="keywordflow">if</span> (SimplifyReturn(RI, Builder)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ResumeInst.html">ResumeInst</a> *RI = dyn_cast&lt;ResumeInst&gt;(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>())) {</div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;    <span class="keywordflow">if</span> (SimplifyResume(RI, Builder)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI = dyn_cast&lt;SwitchInst&gt;(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>())) {</div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;    <span class="keywordflow">if</span> (SimplifySwitch(SI, Builder)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1UnreachableInst.html">UnreachableInst</a> *UI =</div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;               dyn_cast&lt;UnreachableInst&gt;(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>())) {</div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;    <span class="keywordflow">if</span> (SimplifyUnreachable(UI)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1IndirectBrInst.html">IndirectBrInst</a> *IBI =</div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;               dyn_cast&lt;IndirectBrInst&gt;(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>())) {</div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;    <span class="keywordflow">if</span> (SimplifyIndirectBr(IBI)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;  }</div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;</div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;}</div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;<span class="comment">/// SimplifyCFG - This function is used to do simplification of a CFG.  For</span></div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;<span class="comment">/// example, it adjusts branches to branches to eliminate the extra hop, it</span></div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;<span class="comment">/// eliminates unreachable basic blocks, and does other &quot;peephole&quot; optimization</span></div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;<span class="comment">/// of the CFG.  It returns true if a modification was made.</span></div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l04153"></a><span class="lineno"><a class="line" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d"> 4153</a></span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">llvm::SimplifyCFG</a>(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetTransformInfo.html">TargetTransformInfo</a> &amp;TTI,</div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD) {</div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;  <span class="keywordflow">return</span> SimplifyCFGOpt(TTI, TD).run(BB);</div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;}</div><div class="ttc" id="classllvm_1_1IRBuilder_html_a3f8c45ea10c393433221a508b750dcd5"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a3f8c45ea10c393433221a508b750dcd5">llvm::IRBuilder::CreateLShr</a></div><div class="ttdeci">Value * CreateLShr(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;, bool isExact=false)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00753">IRBuilder.h:753</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a518d290fbe6b5f5e314e5b4e29780635"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a518d290fbe6b5f5e314e5b4e29780635">FoldTwoEntryPHINode</a></div><div class="ttdeci">static bool FoldTwoEntryPHINode(PHINode *PN, const DataLayout *TD)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01706">SimplifyCFG.cpp:1706</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a075e34e98605d0e7c289763a104869ac"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">llvm::SmallVectorTemplateCommon&lt; T &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00114">SmallVector.h:114</a></div></div>
<div class="ttc" id="namespacellvm_1_1ISD_html_a22ea9cec080dd5f4f47ba234c2f59110aa8cad208c3cb96b33b5d8544590325b1"><div class="ttname"><a href="namespacellvm_1_1ISD.html#a22ea9cec080dd5f4f47ba234c2f59110aa8cad208c3cb96b33b5d8544590325b1">llvm::ISD::ConstantPool</a></div><div class="ttdef"><b>Definition:</b> <a href="ISDOpcodes_8h_source.html#l00063">ISDOpcodes.h:63</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_a427435d4da769ae680a8e77ef89520aa"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a427435d4da769ae680a8e77ef89520aa">llvm::PatternMatch::m_And</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::And &gt; m_And(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00467">PatternMatch.h:467</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a22a311dfe4c28a897de8a9365a4f0a84"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">llvm::SmallVectorTemplateCommon&lt; T &gt;::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00127">SmallVector.h:127</a></div></div>
<div class="ttc" id="classllvm_1_1ReturnInst_html"><div class="ttname"><a href="classllvm_1_1ReturnInst.html">llvm::ReturnInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02279">Instructions.h:2279</a></div></div>
<div class="ttc" id="classllvm_1_1StoreInst_html_a14298313bdf734e2db5a921cc6e861a0"><div class="ttname"><a href="classllvm_1_1StoreInst.html#a14298313bdf734e2db5a921cc6e861a0">llvm::StoreInst::getValueOperand</a></div><div class="ttdeci">Value * getValueOperand()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00343">Instructions.h:343</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_ae1a10b90f22c0478960fb5798ff73916"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">llvm::SmallVectorTemplateBase&lt; T, isPodLike&lt; T &gt;::value &gt;::push_back</a></div><div class="ttdeci">void push_back(const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00236">SmallVector.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html"><div class="ttname"><a href="classllvm_1_1DataLayout.html">llvm::DataLayout</a></div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00098">DataLayout.h:98</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_aa7cce62ac5cc6df09cce0535874336b7"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#aa7cce62ac5cc6df09cce0535874336b7">llvm::ConstantInt::getFalse</a></div><div class="ttdeci">static ConstantInt * getFalse(LLVMContext &amp;Context)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00445">Constants.cpp:445</a></div></div>
<div class="ttc" id="namespacellvm_html_a877641e6e9032688e668adb7dcca7536"><div class="ttname"><a href="namespacellvm.html#a877641e6e9032688e668adb7dcca7536">llvm::FoldSingleEntryPHINodes</a></div><div class="ttdeci">void FoldSingleEntryPHINodes(BasicBlock *BB, Pass *P=0)</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00068">BasicBlockUtils.cpp:68</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_ae3e9c98ce18a49f8eabe285032612a12"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#ae3e9c98ce18a49f8eabe285032612a12">llvm::IRBuilder::CreateSwitch</a></div><div class="ttdeci">SwitchInst * CreateSwitch(Value *V, BasicBlock *Dest, unsigned NumCases=10, MDNode *BranchWeights=0)</div><div class="ttdoc">Create a switch instruction with the specified value, default dest, and with a hint for the number of...</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00541">IRBuilder.h:541</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a240475f85dea79ec272c578fdf89acf1"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a240475f85dea79ec272c578fdf89acf1">llvm::ConstantInt::getType</a></div><div class="ttdeci">IntegerType * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00139">Constants.h:139</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_a24bca8838396aa81b87de8e7ac774b19"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a24bca8838396aa81b87de8e7ac774b19">llvm::PatternMatch::m_Value</a></div><div class="ttdeci">class_match&lt; Value &gt; m_Value()</div><div class="ttdoc">m_Value() - Match an arbitrary value and ignore it. </div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00070">PatternMatch.h:70</a></div></div>
<div class="ttc" id="classllvm_1_1SmallDenseMap_html"><div class="ttname"><a href="classllvm_1_1SmallDenseMap.html">llvm::SmallDenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00690">DenseMap.h:690</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html_a219f2a3514d904d05dc8003a4ee5d291"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#a219f2a3514d904d05dc8003a4ee5d291">llvm::SwitchInst::case_end</a></div><div class="ttdeci">CaseIt case_end()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02640">Instructions.h:2640</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html"><div class="ttname"><a href="classllvm_1_1CmpInst.html">llvm::CmpInst</a></div><div class="ttdoc">Abstract base class of comparison instructions. </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00633">InstrTypes.h:633</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_acb11ec5ef64171078a81b9e8d6d56585"><div class="ttname"><a href="SimplifyCFG_8cpp.html#acb11ec5ef64171078a81b9e8d6d56585">HasNoDuplicateCall</a></div><div class="ttdeci">static bool HasNoDuplicateCall(const BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01567">SimplifyCFG.cpp:1567</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARM__PROC_html_aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5"><div class="ttname"><a href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">llvm::ARM_PROC::A</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInfo_8h_source.html#l00098">ARMBaseInfo.h:98</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_1_1CaseIteratorT_html_a60499571002635a94d89b8a9341b5e12"><div class="ttname"><a href="classllvm_1_1SwitchInst_1_1CaseIteratorT.html#a60499571002635a94d89b8a9341b5e12">llvm::SwitchInst::CaseIteratorT::getCaseValue</a></div><div class="ttdeci">ConstantIntTy * getCaseValue()</div><div class="ttdoc">Resolves case value for current case. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02512">Instructions.h:2512</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a6f6763e343549d530a1424f1b24053bb"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a6f6763e343549d530a1424f1b24053bb">llvm::BasicBlock::removePredecessor</a></div><div class="ttdeci">void removePredecessor(BasicBlock *Pred, bool DontDeleteUselessPHIs=false)</div><div class="ttdoc">Notify the BasicBlock that the predecessor Pred is no longer able to reach it. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00216">BasicBlock.cpp:216</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_aa75984a442f2379de0c66018201fa628"><div class="ttname"><a href="classllvm_1_1Type.html#aa75984a442f2379de0c66018201fa628">llvm::Type::getInt1Ty</a></div><div class="ttdeci">static IntegerType * getInt1Ty(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00238">Type.cpp:238</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_af440b535b3b4e8d0d089dd0ed2283a0f"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#af440b535b3b4e8d0d089dd0ed2283a0f">llvm::IRBuilder::CreateLoad</a></div><div class="ttdeci">LoadInst * CreateLoad(Value *Ptr, const char *Name)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00879">IRBuilder.h:879</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a089cccb6f231efee72abc76d0f9c695f"><div class="ttname"><a href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">llvm::PHINode::addIncoming</a></div><div class="ttdeci">void addIncoming(Value *V, BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02100">Instructions.h:2100</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a830a17648b2e5112beef220cc707c977"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a830a17648b2e5112beef220cc707c977">PHINodeFoldingThreshold</a></div><div class="ttdeci">static cl::opt&lt; unsigned &gt; PHINodeFoldingThreshold(&quot;phi-node-folding-threshold&quot;, cl::Hidden, cl::init(1), cl::desc(&quot;Control the amount of phi node folding to perform (default = 1)&quot;))</div></div>
<div class="ttc" id="namespacellvm_1_1LibFunc_html_abf8f6830387f338fed0bce2e65108c6fae3540eb995a7957962c47300280f2e73"><div class="ttname"><a href="namespacellvm_1_1LibFunc.html#abf8f6830387f338fed0bce2e65108c6fae3540eb995a7957962c47300280f2e73">llvm::LibFunc::remove</a></div><div class="ttdoc">int remove(const char *path); </div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8h_source.html#l00466">TargetLibraryInfo.h:466</a></div></div>
<div class="ttc" id="namespacellvm_1_1SPII_html_a11e9b8fca4a074643a6a21f444e51406a5069619ca8fdce305534f3fe85091a0f"><div class="ttname"><a href="namespacellvm_1_1SPII.html#a11e9b8fca4a074643a6a21f444e51406a5069619ca8fdce305534f3fe85091a0f">llvm::SPII::Load</a></div><div class="ttdef"><b>Definition:</b> <a href="SparcInstrInfo_8h_source.html#l00031">SparcInstrInfo.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a6fe2f06b8a4b2c3d6308afb223a0238a"><div class="ttname"><a href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">llvm::Instruction::eraseFromParent</a></div><div class="ttdeci">void eraseFromParent()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00072">Instruction.cpp:72</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a7dc983ebf0eb2d255fa90a67063c72e2"><div class="ttname"><a href="classllvm_1_1APInt.html#a7dc983ebf0eb2d255fa90a67063c72e2">llvm::APInt::getZExtValue</a></div><div class="ttdeci">uint64_t getZExtValue() const </div><div class="ttdoc">Get zero extended value. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01306">APInt.h:1306</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilderBase_html_a571ae7ebae7038da7f6073efc65aaa50"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a571ae7ebae7038da7f6073efc65aaa50">llvm::IRBuilderBase::SetCurrentDebugLocation</a></div><div class="ttdeci">void SetCurrentDebugLocation(const DebugLoc &amp;L)</div><div class="ttdoc">Set location information used by debugging information. </div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00118">IRBuilder.h:118</a></div></div>
<div class="ttc" id="Instructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="namespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">List of target independent CodeGen pass IDs. </div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l00022">APFloat.h:22</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html_a6550fe5bd437c1c3c6e237d726e36b90"><div class="ttname"><a href="classllvm_1_1BranchInst.html#a6550fe5bd437c1c3c6e237d726e36b90">llvm::BranchInst::swapSuccessors</a></div><div class="ttdeci">void swapSuccessors()</div><div class="ttdoc">Swap the successors of this branch instruction. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l00786">Instructions.cpp:786</a></div></div>
<div class="ttc" id="ARMSubtarget_8cpp_html_aae20c66ad7139c9837b1d07d3a8b12c8"><div class="ttname"><a href="ARMSubtarget_8cpp.html#aae20c66ad7139c9837b1d07d3a8b12c8">IT</a></div><div class="ttdeci">static cl::opt&lt; ITMode &gt; IT(cl::desc(&quot;IT block support&quot;), cl::Hidden, cl::init(DefaultIT), cl::ZeroOrMore, cl::values(clEnumValN(DefaultIT,&quot;arm-default-it&quot;,&quot;Generate IT block based on arch&quot;), clEnumValN(RestrictedIT,&quot;arm-restrict-it&quot;,&quot;Disallow deprecated IT based on ARMv8&quot;), clEnumValN(NoRestrictedIT,&quot;arm-no-restrict-it&quot;,&quot;Allow IT blocks based on ARMv7&quot;), clEnumValEnd))</div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a094edb4846824b6513167facc6a7afe1"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a094edb4846824b6513167facc6a7afe1">STATISTIC</a></div><div class="ttdeci">STATISTIC(NumBitMaps,&quot;Number of switch instructions turned into bitmaps&quot;)</div></div>
<div class="ttc" id="DerivedTypes_8h_html"><div class="ttname"><a href="DerivedTypes_8h.html">DerivedTypes.h</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html"><div class="ttname"><a href="classllvm_1_1Module.html">llvm::Module</a></div><div class="ttdoc">The main container class for the LLVM Intermediate Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00112">Module.h:112</a></div></div>
<div class="ttc" id="Type_8h_html"><div class="ttname"><a href="Type_8h.html">Type.h</a></div></div>
<div class="ttc" id="classllvm_1_1iplist_html_a99d24ef8a3c3b81d43fa244e43f976fc"><div class="ttname"><a href="classllvm_1_1iplist.html#a99d24ef8a3c3b81d43fa244e43f976fc">llvm::iplist::rend</a></div><div class="ttdeci">reverse_iterator rend()</div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00379">ilist.h:379</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a58dc840fc84420b7f0b773794b8101c1"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a58dc840fc84420b7f0b773794b8101c1">llvm::SmallVectorTemplateCommon&lt; T &gt;::front</a></div><div class="ttdeci">reference front()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00148">SmallVector.h:148</a></div></div>
<div class="ttc" id="classllvm_1_1AtomicCmpXchgInst_html"><div class="ttname"><a href="classllvm_1_1AtomicCmpXchgInst.html">llvm::AtomicCmpXchgInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00449">Instructions.h:449</a></div></div>
<div class="ttc" id="IntrinsicInst_8h_html"><div class="ttname"><a href="IntrinsicInst_8h.html">IntrinsicInst.h</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_aaaae27d25fe7431c2ad47c4fb12273e8"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aaaae27d25fe7431c2ad47c4fb12273e8">ComputeSpeculationCost</a></div><div class="ttdeci">static unsigned ComputeSpeculationCost(const User *I)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00202">SimplifyCFG.cpp:202</a></div></div>
<div class="ttc" id="classllvm_1_1InvokeInst_html_ae8128ad2b6324cf4d4ea940cd1ad7c2d"><div class="ttname"><a href="classllvm_1_1InvokeInst.html#ae8128ad2b6324cf4d4ea940cd1ad7c2d">llvm::InvokeInst::hasFnAttr</a></div><div class="ttdeci">bool hasFnAttr(Attribute::AttrKind A) const </div><div class="ttdoc">Determine whether this call has the given attribute. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02916">Instructions.h:2916</a></div></div>
<div class="ttc" id="namespacellvm_html_a3f2f98c2a67c9e79f58aad9150a62e42"><div class="ttname"><a href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">llvm::dyn_cast</a></div><div class="ttdeci">enable_if_c&lt;!is_simple_type&lt; Y &gt;::value, typename cast_retty&lt; X, const Y &gt;::ret_type &gt;::type dyn_cast(const Y &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="Casting_8h_source.html#l00266">Casting.h:266</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a2026c2afa149ebc0c1ac8fd091fdc22c"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a2026c2afa149ebc0c1ac8fd091fdc22c">removeUndefIntroducingPredecessor</a></div><div class="ttdeci">static bool removeUndefIntroducingPredecessor(BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l04058">SimplifyCFG.cpp:4058</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a2f81e0c1fc6554df7ad2eafabf5fc5a5"><div class="ttname"><a href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">llvm::User::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const </div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00108">User.h:108</a></div></div>
<div class="ttc" id="classllvm_1_1MDNode_html_ade17b50e4f0b835cd9eb58dffe12a90d"><div class="ttname"><a href="classllvm_1_1MDNode.html#ade17b50e4f0b835cd9eb58dffe12a90d">llvm::MDNode::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const </div><div class="ttdoc">getNumOperands - Return number of MDNode operands. </div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l00146">Metadata.h:146</a></div></div>
<div class="ttc" id="namespacellvm_html_a9d7d0a4008434561f28c20126b992b89"><div class="ttname"><a href="namespacellvm.html#a9d7d0a4008434561f28c20126b992b89">llvm::DeleteDeadBlock</a></div><div class="ttdeci">void DeleteDeadBlock(BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00036">BasicBlockUtils.cpp:36</a></div></div>
<div class="ttc" id="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode_html_a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4"><div class="ttname"><a href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">llvm::NVPTX::PTXLdStInstCode::V2</a></div><div class="ttdef"><b>Definition:</b> <a href="NVPTX_8h_source.html#l00127">NVPTX.h:127</a></div></div>
<div class="ttc" id="DataLayout_8h_html"><div class="ttname"><a href="DataLayout_8h.html">DataLayout.h</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html_a62abc2475d09c01d583ba24a487898fd"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#a62abc2475d09c01d583ba24a487898fd">llvm::SwitchInst::addCase</a></div><div class="ttdeci">void addCase(ConstantInt *OnVal, BasicBlock *Dest)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l03344">Instructions.cpp:3344</a></div></div>
<div class="ttc" id="classllvm_1_1ResumeInst_html_ae0d530cc4c401732247bd561c48634b3"><div class="ttname"><a href="classllvm_1_1ResumeInst.html#ae0d530cc4c401732247bd561c48634b3">llvm::ResumeInst::getValue</a></div><div class="ttdeci">Value * getValue() const </div><div class="ttdoc">Convenience accessor. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03109">Instructions.h:3109</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00534">DenseMap.h:534</a></div></div>
<div class="ttc" id="classllvm_1_1StoreInst_html_a1149c7eeefca671ac2685bca13843568"><div class="ttname"><a href="classllvm_1_1StoreInst.html#a1149c7eeefca671ac2685bca13843568">llvm::StoreInst::isSimple</a></div><div class="ttdeci">bool isSimple() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00338">Instructions.h:338</a></div></div>
<div class="ttc" id="README-SSE_8txt_html_a63d206a063eefcdf8c318ded97b65020"><div class="ttname"><a href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a></div><div class="ttdeci">This currently compiles esp xmm0 movsd esp eax eax esp ret We should use not the dag combiner This is because dagcombine2 needs to be able to see through the X86ISD::Wrapper which DAGCombine can t really do The code for turning x load into a single vector load is target independent and should be moved to the dag combiner The code for turning x load into a vector load can only handle a direct load from a global or a direct load from the stack It should be generalized to handle any load from P</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00427">README-SSE.txt:427</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html"><div class="ttname"><a href="classllvm_1_1PHINode.html">llvm::PHINode</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01978">Instructions.h:1978</a></div></div>
<div class="ttc" id="namespacellvm_html_a23b3753cc662a87b599913814ccf2444"><div class="ttname"><a href="namespacellvm.html#a23b3753cc662a87b599913814ccf2444">llvm::RecursivelyDeleteTriviallyDeadInstructions</a></div><div class="ttdeci">bool RecursivelyDeleteTriviallyDeadInstructions(Value *V, const TargetLibraryInfo *TLI=0)</div><div class="ttdef"><b>Definition:</b> <a href="Local_8cpp_source.html#l00316">Local.cpp:316</a></div></div>
<div class="ttc" id="Debug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html"><div class="ttname"><a href="classllvm_1_1CallInst.html">llvm::CallInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01161">Instructions.h:1161</a></div></div>
<div class="ttc" id="Metadata_8h_html"><div class="ttname"><a href="Metadata_8h.html">Metadata.h</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a3c76890714593c78e3b5d142c9030548"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a3c76890714593c78e3b5d142c9030548">llvm::CmpInst::getInversePredicate</a></div><div class="ttdeci">Predicate getInversePredicate() const </div><div class="ttdoc">Return the inverse of the instruction&amp;#39;s predicate. </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00737">InstrTypes.h:737</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a3aaba0277f5dd5636e099fa81c20c533"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a3aaba0277f5dd5636e099fa81c20c533">isSafeToHoistInvoke</a></div><div class="ttdeci">static bool isSafeToHoistInvoke(BasicBlock *BB1, BasicBlock *BB2, Instruction *I1, Instruction *I2)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00983">SimplifyCFG.cpp:983</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html_ae69c15ce940c41719cb96209e113a26e"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#ae69c15ce940c41719cb96209e113a26e">llvm::SwitchInst::case_begin</a></div><div class="ttdeci">CaseIt case_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02629">Instructions.h:2629</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a9b6dd0fc7a648a939e571246045b673e"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">llvm::SmallPtrSet::insert</a></div><div class="ttdeci">bool insert(PtrType Ptr)</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00253">SmallPtrSet.h:253</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a573063aad4c101462893d0490d867524"><div class="ttname"><a href="classllvm_1_1Instruction.html#a573063aad4c101462893d0490d867524">llvm::Instruction::mayHaveSideEffects</a></div><div class="ttdeci">bool mayHaveSideEffects() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00324">Instruction.h:324</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_abe3a801f7be20378621c4cbca8717aad"><div class="ttname"><a href="SimplifyCFG_8cpp.html#abe3a801f7be20378621c4cbca8717aad">ConstantFold</a></div><div class="ttdeci">static Constant * ConstantFold(Instruction *I, const SmallDenseMap&lt; Value *, Constant * &gt; &amp;ConstantPool, const DataLayout *DL)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03333">SimplifyCFG.cpp:3333</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_aedfa75f0c85c4aa85b257f066fbea57ca04ed141708c0fd16723d212502b046ae"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca04ed141708c0fd16723d212502b046ae">llvm::GlobalValue::PrivateLinkage</a></div><div class="ttdoc">Like Internal, but omit from symbol table. </div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00042">GlobalValue.h:42</a></div></div>
<div class="ttc" id="namespacellvm_html_a7c469a194119a14e5a018ebb9b847cf0"><div class="ttname"><a href="namespacellvm.html#a7c469a194119a14e5a018ebb9b847cf0">llvm::operator&lt;</a></div><div class="ttdeci">void operator&lt;(const Optional&lt; T &gt; &amp;X, const Optional&lt; U &gt; &amp;Y)</div><div class="ttdoc">Poison comparison between two Optional objects. Clients needs to explicitly compare the underlying va...</div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a165512f38f31f01e7f18bf3838f3a12e"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a165512f38f31f01e7f18bf3838f3a12e">GetBranchWeights</a></div><div class="ttdeci">static void GetBranchWeights(TerminatorInst *TI, SmallVectorImpl&lt; uint64_t &gt; &amp;Weights)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00730">SimplifyCFG.cpp:730</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_af622128e353515efebccad40eae495cb"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#af622128e353515efebccad40eae495cb">llvm::SmallVectorImpl::insert</a></div><div class="ttdeci">iterator insert(iterator I, const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00537">SmallVector.h:537</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a9c30c87af01068ceae02cd371748d175"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a9c30c87af01068ceae02cd371748d175">llvm::IRBuilder::CreateICmpULT</a></div><div class="ttdeci">Value * CreateICmpULT(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01218">IRBuilder.h:1218</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_ae0c5e70885cf005feb6707932774f99c"><div class="ttname"><a href="classllvm_1_1APInt.html#ae0c5e70885cf005feb6707932774f99c">llvm::APInt::getLimitedValue</a></div><div class="ttdeci">uint64_t getLimitedValue(uint64_t Limit=~0ULL) const </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00408">APInt.h:408</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_af0d7fe1e3aa12d83e0af774a398d34ab"><div class="ttname"><a href="SimplifyCFG_8cpp.html#af0d7fe1e3aa12d83e0af774a398d34ab">SimplifySwitchOnSelect</a></div><div class="ttdeci">static bool SimplifySwitchOnSelect(SwitchInst *SI, SelectInst *Select)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l02557">SimplifyCFG.cpp:2557</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_aca229503e4f5c83a187a6a921c625fa8"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">llvm::BasicBlock::getParent</a></div><div class="ttdeci">const Function * getParent() const </div><div class="ttdoc">Return the enclosing method, or null if none. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00116">BasicBlock.h:116</a></div></div>
<div class="ttc" id="classllvm_1_1PredIterator_html"><div class="ttname"><a href="classllvm_1_1PredIterator.html">llvm::PredIterator</a></div><div class="ttdef"><b>Definition:</b> <a href="Support_2CFG_8h_source.html#l00029">Support/CFG.h:29</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a33603355becfb1a050b62aa015c1cc57"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a33603355becfb1a050b62aa015c1cc57">llvm::BasicBlock::front</a></div><div class="ttdeci">const Instruction &amp; front() const </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00205">BasicBlock.h:205</a></div></div>
<div class="ttc" id="classllvm_1_1MDNode_html"><div class="ttname"><a href="classllvm_1_1MDNode.html">llvm::MDNode</a></div><div class="ttdoc">MDNode - a tuple of other values. </div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l00073">Metadata.h:73</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a9237251072bf6816163abc2d053212ee"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a9237251072bf6816163abc2d053212ee">llvm::BasicBlock::rend</a></div><div class="ttdeci">reverse_iterator rend()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00200">BasicBlock.h:200</a></div></div>
<div class="ttc" id="classllvm_1_1LoadInst_html"><div class="ttname"><a href="classllvm_1_1LoadInst.html">llvm::LoadInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00136">Instructions.h:136</a></div></div>
<div class="ttc" id="InstructionSimplify_8h_html"><div class="ttname"><a href="InstructionSimplify_8h.html">InstructionSimplify.h</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a1c2af7a9e501d399f06ca7e10eef46e4"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a1c2af7a9e501d399f06ca7e10eef46e4">llvm::BasicBlock::rbegin</a></div><div class="ttdeci">reverse_iterator rbegin()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00198">BasicBlock.h:198</a></div></div>
<div class="ttc" id="classllvm_1_1IntegerType_html_a6f603ab84f6f7c79985036f58cca9d48"><div class="ttname"><a href="classllvm_1_1IntegerType.html#a6f603ab84f6f7c79985036f58cca9d48">llvm::IntegerType::getBitWidth</a></div><div class="ttdeci">unsigned getBitWidth() const </div><div class="ttdoc">Get the number of bits in this IntegerType. </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00061">DerivedTypes.h:61</a></div></div>
<div class="ttc" id="classllvm_1_1AtomicRMWInst_html"><div class="ttname"><a href="classllvm_1_1AtomicRMWInst.html">llvm::AtomicRMWInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00556">Instructions.h:556</a></div></div>
<div class="ttc" id="classllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00033">User.h:33</a></div></div>
<div class="ttc" id="Statistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a7bd545769621a0a9d2cfb074f86f4295"><div class="ttname"><a href="classllvm_1_1Instruction.html#a7bd545769621a0a9d2cfb074f86f4295">llvm::Instruction::setDebugLoc</a></div><div class="ttdeci">void setDebugLoc(const DebugLoc &amp;Loc)</div><div class="ttdoc">setDebugLoc - Set the debug location information for this instruction. </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00175">Instruction.h:175</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a2eeb1c7ed1cfe403f2ae0470e36c07e2"><div class="ttname"><a href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">llvm::User::op_begin</a></div><div class="ttdeci">op_iterator op_begin()</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00116">User.h:116</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html_a2d6855f76c156c05cc76ec4dfb94cf57"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#a2d6855f76c156c05cc76ec4dfb94cf57">llvm::SwitchInst::findCaseDest</a></div><div class="ttdeci">ConstantInt * findCaseDest(BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02679">Instructions.h:2679</a></div></div>
<div class="ttc" id="classllvm_1_1IndirectBrInst_html_a1ce0a14a79ac73a91f38aa91899bb377"><div class="ttname"><a href="classllvm_1_1IndirectBrInst.html#a1ce0a14a79ac73a91f38aa91899bb377">llvm::IndirectBrInst::getAddress</a></div><div class="ttdeci">Value * getAddress()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02785">Instructions.h:2785</a></div></div>
<div class="ttc" id="namespacellvm_1_1cl_html_a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6"><div class="ttname"><a href="namespacellvm_1_1cl.html#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">llvm::cl::Hidden</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00109">CommandLine.h:109</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_afa1cb82e021c7f516f65d40162fe6c53"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#afa1cb82e021c7f516f65d40162fe6c53">llvm::IRBuilder::CreateSub</a></div><div class="ttdeci">Value * CreateSub(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;, bool HasNUW=false, bool HasNSW=false)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00637">IRBuilder.h:637</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad452febc1ac0b394876e640ec03ffa38"><div class="ttname"><a href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00167">Value.cpp:167</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a8d718b79cd2832d71600169ac3e132b0"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a8d718b79cd2832d71600169ac3e132b0">passingValueIsAlwaysUndefined</a></div><div class="ttdeci">static bool passingValueIsAlwaysUndefined(Value *V, Instruction *I)</div><div class="ttdoc">Check if passing a value to an instruction will cause undefined behavior. </div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l04016">SimplifyCFG.cpp:4016</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0ed5f3ab3c2e4196ee0cffffa080c062"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">llvm::BasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00193">BasicBlock.h:193</a></div></div>
<div class="ttc" id="classllvm_1_1iplist_html_ad5f5ac50ca28fc89c173eb3d64344afc"><div class="ttname"><a href="classllvm_1_1iplist.html#ad5f5ac50ca28fc89c173eb3d64344afc">llvm::iplist::rbegin</a></div><div class="ttdeci">reverse_iterator rbegin()</div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00377">ilist.h:377</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_acd74b2224788f8d010e47622bb3c2a04"><div class="ttname"><a href="classllvm_1_1CallInst.html#acd74b2224788f8d010e47622bb3c2a04">llvm::CallInst::setCallingConv</a></div><div class="ttdeci">void setCallingConv(CallingConv::ID CC)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01253">Instructions.h:1253</a></div></div>
<div class="ttc" id="classllvm_1_1MDNode_html_adb91929f939ff02dbee552d32afaf4e6"><div class="ttname"><a href="classllvm_1_1MDNode.html#adb91929f939ff02dbee552d32afaf4e6">llvm::MDNode::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const LLVM_READONLY</div><div class="ttdoc">getOperand - Return specified operand. </div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l00307">Metadata.cpp:307</a></div></div>
<div class="ttc" id="namespacellvm_1_1APIntOps_html_a05e6b3a73a1d4fa4979f13a69d6f931a"><div class="ttname"><a href="namespacellvm_1_1APIntOps.html#a05e6b3a73a1d4fa4979f13a69d6f931a">llvm::APIntOps::Not</a></div><div class="ttdeci">APInt Not(const APInt &amp;APIVal)</div><div class="ttdoc">Bitwise complement function. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01855">APInt.h:1855</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a225cbda41f4c27fbb522833e31cb18f9"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a225cbda41f4c27fbb522833e31cb18f9">llvm::BasicBlock::getFirstNonPHIOrDbg</a></div><div class="ttdeci">Instruction * getFirstNonPHIOrDbg()</div><div class="ttdoc">Returns a pointer to the first instruction in this block that is not a PHINode or a debug intrinsic...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00140">BasicBlock.cpp:140</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a69987e50a47c1566fa22b3cfd696e7ea"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a69987e50a47c1566fa22b3cfd696e7ea">isProfitableToFoldUnconditional</a></div><div class="ttdeci">static bool isProfitableToFoldUnconditional(BranchInst *SI1, BranchInst *SI2, Instruction *Cond, SmallVectorImpl&lt; PHINode * &gt; &amp;PhiNodes)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00149">SimplifyCFG.cpp:149</a></div></div>
<div class="ttc" id="namespacellvm_1_1MCID_html_a8035044d40d3758eb45b65dce69dc90ba32dbd2c72a98eaee90e3ad5ef7b5af16"><div class="ttname"><a href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba32dbd2c72a98eaee90e3ad5ef7b5af16">llvm::MCID::Select</a></div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00113">MCInstrDesc.h:113</a></div></div>
<div class="ttc" id="classllvm_1_1BlockAddress_html"><div class="ttname"><a href="classllvm_1_1BlockAddress.html">llvm::BlockAddress</a></div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00748">Constants.h:748</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_a25d956d9e0beadd47ce4bc255dfa811d"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a25d956d9e0beadd47ce4bc255dfa811d">llvm::PatternMatch::match</a></div><div class="ttdeci">bool match(Val *V, const Pattern &amp;P)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00042">PatternMatch.h:42</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_ad3acb8f156ef3691661eae4471cb4887"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ad3acb8f156ef3691661eae4471cb4887">DominatesMergePoint</a></div><div class="ttdeci">static bool DominatesMergePoint(Value *V, BasicBlock *BB, SmallPtrSet&lt; Instruction *, 4 &gt; *AggressiveInsts, unsigned &amp;CostRemaining)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00252">SimplifyCFG.cpp:252</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html_a382131e712e55e8324fbd5068de17b78"><div class="ttname"><a href="classllvm_1_1BranchInst.html#a382131e712e55e8324fbd5068de17b78">llvm::BranchInst::isUnconditional</a></div><div class="ttdeci">bool isUnconditional() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02391">Instructions.h:2391</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_a81ad2fffd14e2df92cad4f631ae76480"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#a81ad2fffd14e2df92cad4f631ae76480">llvm::ConstantExpr::getIntegerCast</a></div><div class="ttdeci">static Constant * getIntegerCast(Constant *C, Type *Ty, bool isSigned)</div><div class="ttdoc">Create a ZExt, Bitcast or Trunc for integer -&gt; integer casts. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01513">Constants.cpp:1513</a></div></div>
<div class="ttc" id="classllvm_1_1value__use__iterator_html"><div class="ttname"><a href="classllvm_1_1value__use__iterator.html">llvm::value_use_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00168">Use.h:168</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a136cc7ed9c1041928df9f03631026a0d"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a136cc7ed9c1041928df9f03631026a0d">SinkThenElseCodeToEnd</a></div><div class="ttdeci">static bool SinkThenElseCodeToEnd(BranchInst *BI1)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01133">SimplifyCFG.cpp:1133</a></div></div>
<div class="ttc" id="classllvm_1_1SelectInst_html"><div class="ttname"><a href="classllvm_1_1SelectInst.html">llvm::SelectInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01430">Instructions.h:1430</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_ac72e0be80ec7138a1ec42c798b249981"><div class="ttname"><a href="classllvm_1_1Instruction.html#ac72e0be80ec7138a1ec42c798b249981">llvm::Instruction::isIdenticalTo</a></div><div class="ttdeci">bool isIdenticalTo(const Instruction *I) const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00264">Instruction.cpp:264</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a285d756a993fe2460d35129ba58f92a2"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a285d756a993fe2460d35129ba58f92a2">SimplifyCondBranchToCondBranch</a></div><div class="ttdeci">static bool SimplifyCondBranchToCondBranch(BranchInst *PBI, BranchInst *BI)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l02290">SimplifyCFG.cpp:2290</a></div></div>
<div class="ttc" id="classllvm_1_1ReturnInst_html_a7f6ab6ba1947d832a651e3589614a10d"><div class="ttname"><a href="classllvm_1_1ReturnInst.html#a7f6ab6ba1947d832a651e3589614a10d">llvm::ReturnInst::getReturnValue</a></div><div class="ttdeci">Value * getReturnValue() const </div><div class="ttdoc">Convenience accessor. Returns null if there is no return value. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02318">Instructions.h:2318</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_af8dde13a97efce293a7b04daf1e208fb"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">llvm::ConstantInt::getValue</a></div><div class="ttdeci">const APInt &amp; getValue() const </div><div class="ttdoc">Return the constant&amp;#39;s value. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00105">Constants.h:105</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05ac17897ebf2f6a6986280fc3bdf28a30a"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05ac17897ebf2f6a6986280fc3bdf28a30a">llvm::CmpInst::ICMP_NE</a></div><div class="ttdoc">not equal </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00673">InstrTypes.h:673</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a400eaca9881c8dcab97e9f42b1ab1815"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">llvm::SmallVectorImpl::pop_back_val</a></div><div class="ttdeci">T LLVM_ATTRIBUTE_UNUSED_RESULT pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00430">SmallVector.h:430</a></div></div>
<div class="ttc" id="ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdef"><b>Definition:</b> <a href="ErrorHandling_8h_source.html#l00103">ErrorHandling.h:103</a></div></div>
<div class="ttc" id="classllvm_1_1Use_html"><div class="ttname"><a href="classllvm_1_1Use.html">llvm::Use</a></div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00060">Use.h:60</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00035">APInt.h:35</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_aae15857ee04fb44315481a693e4562c4"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aae15857ee04fb44315481a693e4562c4">SimplifyTerminatorOnSelect</a></div><div class="ttdeci">static bool SimplifyTerminatorOnSelect(TerminatorInst *OldTerm, Value *Cond, BasicBlock *TrueBB, BasicBlock *FalseBB, uint32_t TrueWeight, uint32_t FalseWeight)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l02492">SimplifyCFG.cpp:2492</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a8a7f7d7aa56a6449ae814f48b6a8ce6f"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a8a7f7d7aa56a6449ae814f48b6a8ce6f">ConstantIntSortPredicate</a></div><div class="ttdeci">static int ConstantIntSortPredicate(ConstantInt *const *P1, ConstantInt *const *P2)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00707">SimplifyCFG.cpp:707</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0e73f4e09745bb69fdd7b15232c45428"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0e73f4e09745bb69fdd7b15232c45428">llvm::BasicBlock::getFirstNonPHI</a></div><div class="ttdeci">Instruction * getFirstNonPHI()</div><div class="ttdoc">Returns a pointer to the first instruction in this block that is not a PHINode instruction. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00130">BasicBlock.cpp:130</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a75e386c51bb947f44935b3c392a8eb4f"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a75e386c51bb947f44935b3c392a8eb4f">llvm::IRBuilder::CreateCondBr</a></div><div class="ttdeci">BranchInst * CreateCondBr(Value *Cond, BasicBlock *True, BasicBlock *False, MDNode *BranchWeights=0)</div><div class="ttdoc">Create a conditional &amp;#39;br Cond, TrueDest, FalseDest&amp;#39; instruction. </div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00532">IRBuilder.h:532</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html"><div class="ttname"><a href="classllvm_1_1IRBuilder.html">llvm::IRBuilder</a></div><div class="ttdoc">This provides a uniform API for creating instructions and inserting them into a basic block: either a...</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00421">IRBuilder.h:421</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html_ae9cbc599309fd2da33ec1c61df01ce1f"><div class="ttname"><a href="classllvm_1_1BranchInst.html#ae9cbc599309fd2da33ec1c61df01ce1f">llvm::BranchInst::Create</a></div><div class="ttdeci">static BranchInst * Create(BasicBlock *IfTrue, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02373">Instructions.h:2373</a></div></div>
<div class="ttc" id="classllvm_1_1InvokeInst_html_aaf176d8e8ffe24fa5971b879ec16f861"><div class="ttname"><a href="classllvm_1_1InvokeInst.html#aaf176d8e8ffe24fa5971b879ec16f861">llvm::InvokeInst::getCalledValue</a></div><div class="ttdeci">const Value * getCalledValue() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02994">Instructions.h:2994</a></div></div>
<div class="ttc" id="STLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a12fd03c41b1697fca070c12317794400"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a12fd03c41b1697fca070c12317794400">llvm::BasicBlock::hasAddressTaken</a></div><div class="ttdeci">bool hasAddressTaken() const </div><div class="ttdoc">Returns true if there are any uses of this basic block other than direct branches, switches, etc. to it. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00268">BasicBlock.h:268</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a465f75c78f1dc551152248c9f203b88d"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a465f75c78f1dc551152248c9f203b88d">llvm::SmallVectorImpl::assign</a></div><div class="ttdeci">void assign(unsigned NumElts, const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00470">SmallVector.h:470</a></div></div>
<div class="ttc" id="namespacellvm_1_1MCID_html_a8035044d40d3758eb45b65dce69dc90ba359237c780f7c8e40645575826da8a3c"><div class="ttname"><a href="namespacellvm_1_1MCID.html#a8035044d40d3758eb45b65dce69dc90ba359237c780f7c8e40645575826da8a3c">llvm::MCID::Branch</a></div><div class="ttdef"><b>Definition:</b> <a href="MCInstrDesc_8h_source.html#l00108">MCInstrDesc.h:108</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a3ab1a6ec499c9bfd45258e149aa555c5"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a3ab1a6ec499c9bfd45258e149aa555c5">SimplifyIndirectBrOnSelect</a></div><div class="ttdeci">static bool SimplifyIndirectBrOnSelect(IndirectBrInst *IBI, SelectInst *SI)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l02593">SimplifyCFG.cpp:2593</a></div></div>
<div class="ttc" id="namespacellvm_html_a0f249e36f196bbea3e4178ad0793544d"><div class="ttname"><a href="namespacellvm.html#a0f249e36f196bbea3e4178ad0793544d">llvm::MergeBlockIntoPredecessor</a></div><div class="ttdeci">bool MergeBlockIntoPredecessor(BasicBlock *BB, Pass *P=0)</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00116">BasicBlockUtils.cpp:116</a></div></div>
<div class="ttc" id="classllvm_1_1Attribute_html_aab7ee4b8fd1d3e7e4cea87868855e60ea05ac93db8aa4c0dfd25a69fd04a3c7b5"><div class="ttname"><a href="classllvm_1_1Attribute.html#aab7ee4b8fd1d3e7e4cea87868855e60ea05ac93db8aa4c0dfd25a69fd04a3c7b5">llvm::Attribute::UWTable</a></div><div class="ttdoc">Function must be in a unwind table. </div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l00109">Attributes.h:109</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a35ee267850af7c235474a8c46c7ac5af"><div class="ttname"><a href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">llvm::Value::setName</a></div><div class="ttdeci">void setName(const Twine &amp;Name)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00175">Value.cpp:175</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a03a2d451a241c934af3405a7cfc8adb4"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a03a2d451a241c934af3405a7cfc8adb4">BlockIsSimpleEnoughToThreadThrough</a></div><div class="ttdeci">static bool BlockIsSimpleEnoughToThreadThrough(BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01580">SimplifyCFG.cpp:1580</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_af6aad0c9ba7b8720130235c9621b55b5"><div class="ttname"><a href="classllvm_1_1Instruction.html#af6aad0c9ba7b8720130235c9621b55b5">llvm::Instruction::clone</a></div><div class="ttdeci">Instruction * clone() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00541">Instruction.cpp:541</a></div></div>
<div class="ttc" id="NoFolder_8h_html"><div class="ttname"><a href="NoFolder_8h.html">NoFolder.h</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a2ced9ed2427730cd9b6903f00cd22e4d"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a2ced9ed2427730cd9b6903f00cd22e4d">isSafeToSpeculateStore</a></div><div class="ttdeci">static Value * isSafeToSpeculateStore(Instruction *I, BasicBlock *BrBB, BasicBlock *StoreBB, BasicBlock *EndBB)</div><div class="ttdoc">Determine if we can hoist sink a sole store instruction out of a conditional block. </div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01324">SimplifyCFG.cpp:1324</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00031">Instruction.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1IndirectBrInst_html_a45656d5a2f380720a7618495fceed01e"><div class="ttname"><a href="classllvm_1_1IndirectBrInst.html#a45656d5a2f380720a7618495fceed01e">llvm::IndirectBrInst::getDestination</a></div><div class="ttdeci">BasicBlock * getDestination(unsigned i)</div><div class="ttdoc">getDestination - Return the specified destination. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02795">Instructions.h:2795</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a6434e674d53619188f1a6b4bac3b304e"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a6434e674d53619188f1a6b4bac3b304e">HoistThenElseCodeToIf</a></div><div class="ttdeci">static bool HoistThenElseCodeToIf(BranchInst *BI)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01002">SimplifyCFG.cpp:1002</a></div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_a944c25ac9b73b02a17a20a08a25b9b21"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a944c25ac9b73b02a17a20a08a25b9b21">llvm::PatternMatch::m_Add</a></div><div class="ttdeci">BinaryOp_match&lt; LHS, RHS, Instruction::Add &gt; m_Add(const LHS &amp;L, const RHS &amp;R)</div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00395">PatternMatch.h:395</a></div></div>
<div class="ttc" id="classllvm_1_1PtrToIntInst_html"><div class="ttname"><a href="classllvm_1_1PtrToIntInst.html">llvm::PtrToIntInst</a></div><div class="ttdoc">This class represents a cast from a pointer to an integer. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03539">Instructions.h:3539</a></div></div>
<div class="ttc" id="namespacellvm_html_a3720211f6e6389ab53734b989bfb6fce"><div class="ttname"><a href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">llvm::succ_begin</a></div><div class="ttdeci">Interval::succ_iterator succ_begin(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00107">Interval.h:107</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a6edd823ba5e4e1effc8280ca8a1194ef"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">llvm::ConstantInt::getZExtValue</a></div><div class="ttdeci">uint64_t getZExtValue() const </div><div class="ttdoc">Return the zero extended value. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00116">Constants.h:116</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_ab63479922d7b88d6b4fc5d31458e44fd"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ab63479922d7b88d6b4fc5d31458e44fd">SpeculativelyExecuteBB</a></div><div class="ttdeci">static bool SpeculativelyExecuteBB(BranchInst *BI, BasicBlock *ThenBB)</div><div class="ttdoc">Speculate a conditional basic block flattening the CFG. </div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01395">SimplifyCFG.cpp:1395</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_af6a36137bc1746faed3554c1eefe138a"><div class="ttname"><a href="SimplifyCFG_8cpp.html#af6a36137bc1746faed3554c1eefe138a">SwitchToLookupTable</a></div><div class="ttdeci">static bool SwitchToLookupTable(SwitchInst *SI, IRBuilder&lt;&gt; &amp;Builder, const TargetTransformInfo &amp;TTI, const DataLayout *TD)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03666">SimplifyCFG.cpp:3666</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html">llvm::ConstantExpr</a></div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00790">Constants.h:790</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a2e1b28b7b4b85744d3a02881d4601122"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a2e1b28b7b4b85744d3a02881d4601122">SimplifyCondBranchToTwoReturns</a></div><div class="ttdeci">static bool SimplifyCondBranchToTwoReturns(BranchInst *BI, IRBuilder&lt;&gt; &amp;Builder)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01843">SimplifyCFG.cpp:1843</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_aa62a063a23f704f9544485e57858b670"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aa62a063a23f704f9544485e57858b670">GatherConstantCompares</a></div><div class="ttdeci">static Value * GatherConstantCompares(Value *V, std::vector&lt; ConstantInt * &gt; &amp;Vals, Value *&amp;Extra, const DataLayout *TD, bool isEQ, unsigned &amp;UsedICmps)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00342">SimplifyCFG.cpp:342</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a8f55dd4237be6778517ddd752ca8b76a"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a8f55dd4237be6778517ddd752ca8b76a">llvm::IRBuilder::CreateOr</a></div><div class="ttdeci">Value * CreateOr(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00805">IRBuilder.h:805</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a2ced6343b8ad006a757059554bbf9f37"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">llvm::SmallPtrSet::count</a></div><div class="ttdeci">bool count(PtrType Ptr) const </div><div class="ttdoc">count - Return true if the specified pointer is in the set. </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00264">SmallPtrSet.h:264</a></div></div>
<div class="ttc" id="Operator_8h_html"><div class="ttname"><a href="Operator_8h.html">Operator.h</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorBase_html_a8a8df4d85555c7954a95f86080cd3b64"><div class="ttname"><a href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">llvm::SmallVectorBase::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00056">SmallVector.h:56</a></div></div>
<div class="ttc" id="classllvm_1_1TargetTransformInfo_html_a83f052a0d908e956128c8951451bde39"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a83f052a0d908e956128c8951451bde39">llvm::TargetTransformInfo::isTypeLegal</a></div><div class="ttdeci">virtual bool isTypeLegal(Type *Ty) const </div><div class="ttdoc">Is this type legal. </div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00132">TargetTransformInfo.cpp:132</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_ac26154a24f393f523c87cc5f8239f36c"><div class="ttname"><a href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">llvm::Instruction::BinaryOps</a></div><div class="ttdeci">BinaryOps</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00387">Instruction.h:387</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayType_html"><div class="ttname"><a href="classllvm_1_1ArrayType.html">llvm::ArrayType</a></div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00332">DerivedTypes.h:332</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a0d03639f5d4cef9541e5e8dbe46830cb"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a0d03639f5d4cef9541e5e8dbe46830cb">llvm::IRBuilder::CreateUnreachable</a></div><div class="ttdeci">UnreachableInst * CreateUnreachable()</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00586">IRBuilder.h:586</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a0671bc479b3d788cc233dc1ce20ebcb5"><div class="ttname"><a href="classllvm_1_1APInt.html#a0671bc479b3d788cc233dc1ce20ebcb5">llvm::APInt::sgt</a></div><div class="ttdeci">bool sgt(const APInt &amp;RHS) const </div><div class="ttdoc">Signed greather than comparison. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01100">APInt.h:1100</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html_a74e70ecbb79defbbfa6f6c87f76155bf"><div class="ttname"><a href="classllvm_1_1BranchInst.html#a74e70ecbb79defbbfa6f6c87f76155bf">llvm::BranchInst::getSuccessor</a></div><div class="ttdeci">BasicBlock * getSuccessor(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02406">Instructions.h:2406</a></div></div>
<div class="ttc" id="SmallPtrSet_8h_html"><div class="ttname"><a href="SmallPtrSet_8h.html">SmallPtrSet.h</a></div></div>
<div class="ttc" id="classllvm_1_1BitCastInst_html"><div class="ttname"><a href="classllvm_1_1BitCastInst.html">llvm::BitCastInst</a></div><div class="ttdoc">This class represents a no-op cast from one type to another. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03587">Instructions.h:3587</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_ac7707bcaec113d0d136467c7b97a62f1"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ac7707bcaec113d0d136467c7b97a62f1">SinkCommon</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; SinkCommon(&quot;simplifycfg-sink-common&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Sink common instructions down to the end block&quot;))</div></div>
<div class="ttc" id="namespacellvm_1_1PatternMatch_html_a34a92072122412c6020d4afb43725bf4"><div class="ttname"><a href="namespacellvm_1_1PatternMatch.html#a34a92072122412c6020d4afb43725bf4">llvm::PatternMatch::m_ConstantInt</a></div><div class="ttdeci">class_match&lt; ConstantInt &gt; m_ConstantInt()</div><div class="ttdoc">m_ConstantInt() - Match an arbitrary ConstantInt and ignore it. </div><div class="ttdef"><b>Definition:</b> <a href="PatternMatch_8h_source.html#l00072">PatternMatch.h:72</a></div></div>
<div class="ttc" id="namespacellvm_html_af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51"><div class="ttname"><a href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">llvm::Call</a></div><div class="ttdef"><b>Definition:</b> <a href="CallingConvLower_8h_source.html#l00149">CallingConvLower.h:149</a></div></div>
<div class="ttc" id="classllvm_1_1TerminatorInst_html_a79fb3df941bcb2ba32ba6438409d0c0b"><div class="ttname"><a href="classllvm_1_1TerminatorInst.html#a79fb3df941bcb2ba32ba6438409d0c0b">llvm::TerminatorInst::setSuccessor</a></div><div class="ttdeci">void setSuccessor(unsigned idx, BasicBlock *B)</div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00071">InstrTypes.h:71</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a38517d96538b847c6c3dbe58965c8053"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a38517d96538b847c6c3dbe58965c8053">EliminateBlockCases</a></div><div class="ttdeci">static void EliminateBlockCases(BasicBlock *BB, std::vector&lt; ValueEqualityComparisonCase &gt; &amp;Cases)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00515">SimplifyCFG.cpp:515</a></div></div>
<div class="ttc" id="classllvm_1_1StoreInst_html"><div class="ttname"><a href="classllvm_1_1StoreInst.html">llvm::StoreInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00255">Instructions.h:255</a></div></div>
<div class="ttc" id="classllvm_1_1LLVMContext_html_a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8"><div class="ttname"><a href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da31130c233c11d5b171bae969ee4c8af8">llvm::LLVMContext::MD_prof</a></div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00048">LLVMContext.h:48</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00303">Value.cpp:303</a></div></div>
<div class="ttc" id="namespacellvm_html_aed498f056a09006219c59ee9fab0450f"><div class="ttname"><a href="namespacellvm.html#aed498f056a09006219c59ee9fab0450f">llvm::EliminateDuplicatePHINodes</a></div><div class="ttdeci">bool EliminateDuplicatePHINodes(BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="Local_8cpp_source.html#l00808">Local.cpp:808</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantRange_html_acb48ab169ff254ba03e74f72f6f8e678"><div class="ttname"><a href="classllvm_1_1ConstantRange.html#acb48ab169ff254ba03e74f72f6f8e678">llvm::ConstantRange::subtract</a></div><div class="ttdeci">ConstantRange subtract(const APInt &amp;CI) const </div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8cpp_source.html#l00242">ConstantRange.cpp:242</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ae855357b6c5e6e7ed1869272708a3a84"><div class="ttname"><a href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">llvm::Value::takeName</a></div><div class="ttdeci">void takeName(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00239">Value.cpp:239</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayRef_html_a76878250107ee24ef7339870bdda4bcf"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a76878250107ee24ef7339870bdda4bcf">llvm::ArrayRef::size</a></div><div class="ttdeci">size_t size() const </div><div class="ttdoc">size - Get the array size. </div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00109">ArrayRef.h:109</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilderBase_html_ace45cae6925c65e9d6916e09dd5b17cc"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#ace45cae6925c65e9d6916e09dd5b17cc">llvm::IRBuilderBase::SetInsertPoint</a></div><div class="ttdeci">void SetInsertPoint(BasicBlock *TheBB)</div><div class="ttdoc">This specifies that created instructions should be appended to the end of the specified block...</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00083">IRBuilder.h:83</a></div></div>
<div class="ttc" id="classllvm_1_1InvokeInst_html_aba6201d5f728b007f1c96fd61105afde"><div class="ttname"><a href="classllvm_1_1InvokeInst.html#aba6201d5f728b007f1c96fd61105afde">llvm::InvokeInst::getNormalDest</a></div><div class="ttdeci">BasicBlock * getNormalDest() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03003">Instructions.h:3003</a></div></div>
<div class="ttc" id="namespacellvm_html_a7985318bedfe5c2040025ef13db9c57b"><div class="ttname"><a href="namespacellvm.html#a7985318bedfe5c2040025ef13db9c57b">llvm::ComputeMaskedBits</a></div><div class="ttdeci">void ComputeMaskedBits(Value *V, APInt &amp;KnownZero, APInt &amp;KnownOne, const DataLayout *TD=0, unsigned Depth=0)</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l00229">ValueTracking.cpp:229</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a9186dc5303ac8e5f788862f0ec11cb66"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9186dc5303ac8e5f788862f0ec11cb66">llvm::Instruction::mayReadOrWriteMemory</a></div><div class="ttdeci">bool mayReadOrWriteMemory() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00304">Instruction.h:304</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a1dc5339334162e650ff87e89629bf66c"><div class="ttname"><a href="classllvm_1_1APInt.html#a1dc5339334162e650ff87e89629bf66c">llvm::APInt::ult</a></div><div class="ttdeci">bool ult(const APInt &amp;RHS) const </div><div class="ttdoc">Unsigned less than comparison. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8cpp_source.html#l00515">APInt.cpp:515</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_aa45f6c0433576e3858a6209a43750ad4"><div class="ttname"><a href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">llvm::PHINode::getNumIncomingValues</a></div><div class="ttdeci">unsigned getNumIncomingValues() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02055">Instructions.h:2055</a></div></div>
<div class="ttc" id="namespacellvm_html_a069c4ae2290101bde0f8d6a5074dc72b"><div class="ttname"><a href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">llvm::succ_end</a></div><div class="ttdeci">Interval::succ_iterator succ_end(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00110">Interval.h:110</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a1f0b9358936e3e00c42a460abbfb2868"><div class="ttname"><a href="classllvm_1_1User.html#a1f0b9358936e3e00c42a460abbfb2868">llvm::User::replaceUsesOfWith</a></div><div class="ttdeci">void replaceUsesOfWith(Value *From, Value *To)</div><div class="ttdef"><b>Definition:</b> <a href="User_8cpp_source.html#l00026">User.cpp:26</a></div></div>
<div class="ttc" id="classllvm_1_1StringRef_html_a4a0abf8eb4fa5989df63172649cba99f"><div class="ttname"><a href="classllvm_1_1StringRef.html#a4a0abf8eb4fa5989df63172649cba99f">llvm::StringRef::begin</a></div><div class="ttdeci">iterator begin() const </div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00097">StringRef.h:97</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_ad403e5f1b62843ac7584a2c51c63bfa3"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#ad403e5f1b62843ac7584a2c51c63bfa3">llvm::BasicBlock::reverse_iterator</a></div><div class="ttdeci">InstListType::reverse_iterator reverse_iterator</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00101">BasicBlock.h:101</a></div></div>
<div class="ttc" id="classllvm_1_1TerminatorInst_html_a4c26d3b92af99a6c8defd89a2d39ca32"><div class="ttname"><a href="classllvm_1_1TerminatorInst.html#a4c26d3b92af99a6c8defd89a2d39ca32">llvm::TerminatorInst::getNumSuccessors</a></div><div class="ttdeci">unsigned getNumSuccessors() const </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00059">InstrTypes.h:59</a></div></div>
<div class="ttc" id="classllvm_1_1GetElementPtrInst_html"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html">llvm::GetElementPtrInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00709">Instructions.h:709</a></div></div>
<div class="ttc" id="README__ALTIVEC_8txt_html_a9aacd9146afe44bf656cd664e2a88c8c"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div><div class="ttdeci">(vector float) vec_cmpeq(*A,*B) C</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00091">README_ALTIVEC.txt:91</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a12b091e586dea5849c4d85723d2cba1b"><div class="ttname"><a href="classllvm_1_1Value.html#a12b091e586dea5849c4d85723d2cba1b">llvm::Value::intersectOptionalDataWith</a></div><div class="ttdeci">void intersectOptionalDataWith(const Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00258">Value.h:258</a></div></div>
<div class="ttc" id="CommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1cl_html_a10a041239ae1870cfcc064bfaa79fb65"><div class="ttname"><a href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00314">CommandLine.h:314</a></div></div>
<div class="ttc" id="namespacellvm_html_add1eb5637dd671428b6f138ed3db6428"><div class="ttname"><a href="namespacellvm.html#add1eb5637dd671428b6f138ed3db6428">llvm::array_pod_sort</a></div><div class="ttdeci">void array_pod_sort(IteratorTy Start, IteratorTy End)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00289">STLExtras.h:289</a></div></div>
<div class="ttc" id="namespacellvm_html_a0d7510b62253a63eec92eb1813dab79d"><div class="ttname"><a href="namespacellvm.html#a0d7510b62253a63eec92eb1813dab79d">llvm::SimplifyCFG</a></div><div class="ttdeci">bool SimplifyCFG(BasicBlock *BB, const TargetTransformInfo &amp;TTI, const DataLayout *TD=0)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l04153">SimplifyCFG.cpp:4153</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a2bd8d3ea479e99434bac72362a59f078"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a2bd8d3ea479e99434bac72362a59f078">llvm::IRBuilder::CreateBinOp</a></div><div class="ttdeci">Value * CreateBinOp(Instruction::BinaryOps Opc, Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00834">IRBuilder.h:834</a></div></div>
<div class="ttc" id="classllvm_1_1LandingPadInst_html"><div class="ttname"><a href="classllvm_1_1LandingPadInst.html">llvm::LandingPadInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02178">Instructions.h:2178</a></div></div>
<div class="ttc" id="classllvm_1_1TerminatorInst_html"><div class="ttname"><a href="classllvm_1_1TerminatorInst.html">llvm::TerminatorInst</a></div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00035">InstrTypes.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1MutableArrayRef_html"><div class="ttname"><a href="classllvm_1_1MutableArrayRef.html">llvm::MutableArrayRef</a></div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00184">ArrayRef.h:184</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_1_1CaseIteratorT_html_a10aaece902a17099847aeb04681d236d"><div class="ttname"><a href="classllvm_1_1SwitchInst_1_1CaseIteratorT.html#a10aaece902a17099847aeb04681d236d">llvm::SwitchInst::CaseIteratorT::getCaseIndex</a></div><div class="ttdeci">unsigned getCaseIndex() const </div><div class="ttdoc">Returns number of current case. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02526">Instructions.h:2526</a></div></div>
<div class="ttc" id="classllvm_1_1SuccIterator_html"><div class="ttname"><a href="classllvm_1_1SuccIterator.html">llvm::SuccIterator&lt; TerminatorInst *, BasicBlock &gt;</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a0998fa064652459be9475ad460ee381f"><div class="ttname"><a href="classllvm_1_1Instruction.html#a0998fa064652459be9475ad460ee381f">llvm::Instruction::isIdenticalToWhenDefined</a></div><div class="ttdeci">bool isIdenticalToWhenDefined(const Instruction *I) const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00272">Instruction.cpp:272</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_ada99fd4fd27356d1518273d8248940a5"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ada99fd4fd27356d1518273d8248940a5">HasBranchWeights</a></div><div class="ttdeci">static bool HasBranchWeights(const Instruction *I)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00718">SimplifyCFG.cpp:718</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_acd9e771a3296c6b24146955754620557"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">llvm::SmallVectorTemplateCommon&lt; T &gt;::back</a></div><div class="ttdeci">reference back()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00157">SmallVector.h:157</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00072">BasicBlock.h:72</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html"><div class="ttname"><a href="classllvm_1_1Type.html">llvm::Type</a></div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00044">Type.h:44</a></div></div>
<div class="ttc" id="classllvm_1_1TerminatorInst_html_a3aac3b6c36415a2b08f65ead9e3e51e7"><div class="ttname"><a href="classllvm_1_1TerminatorInst.html#a3aac3b6c36415a2b08f65ead9e3e51e7">llvm::TerminatorInst::getSuccessor</a></div><div class="ttdeci">BasicBlock * getSuccessor(unsigned idx) const </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00065">InstrTypes.h:65</a></div></div>
<div class="ttc" id="namespacellvm_html_a599000eece6fb1addb05b6b2c36be28c"><div class="ttname"><a href="namespacellvm.html#a599000eece6fb1addb05b6b2c36be28c">llvm::TryToSimplifyUncondBranchFromEmptyBlock</a></div><div class="ttdeci">bool TryToSimplifyUncondBranchFromEmptyBlock(BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="Local_8cpp_source.html#l00725">Local.cpp:725</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html"><div class="ttname"><a href="classllvm_1_1BranchInst.html">llvm::BranchInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02350">Instructions.h:2350</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a9f4834f0678648c5ac86c9ab37210be3"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a9f4834f0678648c5ac86c9ab37210be3">llvm::IRBuilder::CreateNot</a></div><div class="ttdeci">Value * CreateNot(Value *V, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00863">IRBuilder.h:863</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a112f87f5844b5d94c07940f3d47f1e99"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a112f87f5844b5d94c07940f3d47f1e99">llvm::IRBuilder::CreateAdd</a></div><div class="ttdeci">Value * CreateAdd(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;, bool HasNUW=false, bool HasNSW=false)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00615">IRBuilder.h:615</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_abf5ef34c952cc6bc5dce92d91598bdd2"><div class="ttname"><a href="SimplifyCFG_8cpp.html#abf5ef34c952cc6bc5dce92d91598bdd2">TurnSwitchRangeIntoICmp</a></div><div class="ttdeci">static bool TurnSwitchRangeIntoICmp(SwitchInst *SI, IRBuilder&lt;&gt; &amp;Builder)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03118">SimplifyCFG.cpp:3118</a></div></div>
<div class="ttc" id="classllvm_1_1UnreachableInst_html"><div class="ttname"><a href="classllvm_1_1UnreachableInst.html">llvm::UnreachableInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03142">Instructions.h:3142</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a9299aed1efa0ef459a0f1c7fa11fbe61"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a9299aed1efa0ef459a0f1c7fa11fbe61">llvm::IRBuilder::CreatePtrToInt</a></div><div class="ttdeci">Value * CreatePtrToInt(Value *V, Type *DestTy, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01124">IRBuilder.h:1124</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html"><div class="ttname"><a href="classllvm_1_1Constant.html">llvm::Constant</a></div><div class="ttdoc">LLVM Constant Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Constant_8h_source.html#l00041">Constant.h:41</a></div></div>
<div class="ttc" id="Support_2CFG_8h_html"><div class="ttname"><a href="Support_2CFG_8h.html">CFG.h</a></div></div>
<div class="ttc" id="classllvm_1_1SelectInst_html_ad285a69e32ddeee367fed93b5f392801"><div class="ttname"><a href="classllvm_1_1SelectInst.html#ad285a69e32ddeee367fed93b5f392801">llvm::SelectInst::getCondition</a></div><div class="ttdeci">const Value * getCondition() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01466">Instructions.h:1466</a></div></div>
<div class="ttc" id="classllvm_1_1ResumeInst_html"><div class="ttname"><a href="classllvm_1_1ResumeInst.html">llvm::ResumeInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03090">Instructions.h:3090</a></div></div>
<div class="ttc" id="Constants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="classllvm_1_1IndirectBrInst_html"><div class="ttname"><a href="classllvm_1_1IndirectBrInst.html">llvm::IndirectBrInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02743">Instructions.h:2743</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a08a2941811ad93b69f0174b5e8104cc6"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a08a2941811ad93b69f0174b5e8104cc6">llvm::IRBuilder::CreateRet</a></div><div class="ttdeci">ReturnInst * CreateRet(Value *V)</div><div class="ttdoc">Create a &amp;#39;ret &lt;val&gt;&amp;#39; instruction. </div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00507">IRBuilder.h:507</a></div></div>
<div class="ttc" id="namespacellvm_1_1APIntOps_html_a22f056804d2b9882f74adc905872bc39"><div class="ttname"><a href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">llvm::APIntOps::Or</a></div><div class="ttdeci">APInt Or(const APInt &amp;LHS, const APInt &amp;RHS)</div><div class="ttdoc">Bitwise OR function for APInt. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01845">APInt.h:1845</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantArray_html_a0900dacdc7ad8e3ea0cc92993c7fd422"><div class="ttname"><a href="classllvm_1_1ConstantArray.html#a0900dacdc7ad8e3ea0cc92993c7fd422">llvm::ConstantArray::get</a></div><div class="ttdeci">static Constant * get(ArrayType *T, ArrayRef&lt; Constant * &gt; V)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00745">Constants.cpp:745</a></div></div>
<div class="ttc" id="structllvm_1_1cl_1_1desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1desc.html">llvm::cl::desc</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00286">CommandLine.h:286</a></div></div>
<div class="ttc" id="namespacellvm_1_1APIntOps_html_afc7c4d88d09cba0c5e920f8a3a3ace55"><div class="ttname"><a href="namespacellvm_1_1APIntOps.html#afc7c4d88d09cba0c5e920f8a3a3ace55">llvm::APIntOps::Xor</a></div><div class="ttdeci">APInt Xor(const APInt &amp;LHS, const APInt &amp;RHS)</div><div class="ttdoc">Bitwise XOR function for APInt. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01850">APInt.h:1850</a></div></div>
<div class="ttc" id="namespacellvm_html_a7e108932dc3da5294aed99a353aac9c4"><div class="ttname"><a href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">llvm::pred_begin</a></div><div class="ttdeci">Interval::pred_iterator pred_begin(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00117">Interval.h:117</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_aab8e16a35183ce39aad394714087bcff"><div class="ttname"><a href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">llvm::Instruction::getDebugLoc</a></div><div class="ttdeci">const DebugLoc &amp; getDebugLoc() const </div><div class="ttdoc">getDebugLoc - Return the debug location for this node as a DebugLoc. </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00178">Instruction.h:178</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_afb5e83bf5123ff7c51058eb0ebebcdc6"><div class="ttname"><a href="classllvm_1_1PHINode.html#afb5e83bf5123ff7c51058eb0ebebcdc6">llvm::PHINode::Create</a></div><div class="ttdeci">static PHINode * Create(Type *Ty, unsigned NumReservedValues, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02013">Instructions.h:2013</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_af41f58e730804d10b91fcff39b035f74"><div class="ttname"><a href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">llvm::User::op_end</a></div><div class="ttdeci">op_iterator op_end()</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00118">User.h:118</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a4c25b6c00c4867281779c81ab64d2081"><div class="ttname"><a href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">llvm::PHINode::getIncomingBlock</a></div><div class="ttdeci">BasicBlock * getIncomingBlock(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02074">Instructions.h:2074</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a531d11ba36ed48d86057d507cc8d5567"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">llvm::BasicBlock::getInstList</a></div><div class="ttdeci">const InstListType &amp; getInstList() const </div><div class="ttdoc">Return the underlying instruction list container. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00214">BasicBlock.h:214</a></div></div>
<div class="ttc" id="classllvm_1_1ICmpInst_html"><div class="ttname"><a href="classllvm_1_1ICmpInst.html">llvm::ICmpInst</a></div><div class="ttdoc">Represent an integer comparison operator. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00911">Instructions.h:911</a></div></div>
<div class="ttc" id="classllvm_1_1iplist_html_a35c71de7e8bbe3c0353d042beb58263f"><div class="ttname"><a href="classllvm_1_1iplist.html#a35c71de7e8bbe3c0353d042beb58263f">llvm::iplist::insert</a></div><div class="ttdeci">iterator insert(iterator where, NodeTy *New)</div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00412">ilist.h:412</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a321e37d79af8b4287f8a1dcf9aff9c01"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, KeyInfoT &gt;, KeyT, ValueT, KeyInfoT &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00057">DenseMap.h:57</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a997ff6a1758bf732b9b263fc61011644"><div class="ttname"><a href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">llvm::User::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00088">User.h:88</a></div></div>
<div class="ttc" id="namespacellvm_html_a5eeaf08e96168c2cac8960f87f0ef360"><div class="ttname"><a href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">llvm::pred_end</a></div><div class="ttdeci">Interval::pred_iterator pred_end(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00120">Interval.h:120</a></div></div>
<div class="ttc" id="namespacellvm_html_aa61b351a455e9229d3dc58e0883b6cef"><div class="ttname"><a href="namespacellvm.html#aa61b351a455e9229d3dc58e0883b6cef">llvm::ConstantFoldCompareInstOperands</a></div><div class="ttdeci">Constant * ConstantFoldCompareInstOperands(unsigned Predicate, Constant *LHS, Constant *RHS, const DataLayout *TD=0, const TargetLibraryInfo *TLI=0)</div><div class="ttdef"><b>Definition:</b> <a href="ConstantFolding_8cpp_source.html#l01053">ConstantFolding.cpp:1053</a></div></div>
<div class="ttc" id="classllvm_1_1IntegerType_html"><div class="ttname"><a href="classllvm_1_1IntegerType.html">llvm::IntegerType</a></div><div class="ttdoc">Integer representation type. </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00037">DerivedTypes.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a8afd4995fae596b2c86eeed85b3d388b"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a8afd4995fae596b2c86eeed85b3d388b">llvm::CmpInst::getPredicate</a></div><div class="ttdeci">Predicate getPredicate() const </div><div class="ttdoc">Return the predicate for this instruction. </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00714">InstrTypes.h:714</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a4efb46d4834f6f750ae0649ed89ce44c"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a4efb46d4834f6f750ae0649ed89ce44c">llvm::DenseMapBase&lt; SmallDenseMap&lt; KeyT, ValueT, InlineBuckets, KeyInfoT &gt;, KeyT, ValueT, KeyInfoT &gt;::count</a></div><div class="ttdeci">bool count(const KeyT &amp;Val) const</div><div class="ttdoc">count - Return true if the specified key is in the map. </div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00103">DenseMap.h:103</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a747b33c392f2a4faef1bf40a4d169c7d"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a747b33c392f2a4faef1bf40a4d169c7d">checkCSEInPredecessor</a></div><div class="ttdeci">static bool checkCSEInPredecessor(Instruction *Inst, BasicBlock *PB)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01949">SimplifyCFG.cpp:1949</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSetImpl_html_a095445850ef2c64e96b4c05120cecf66"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a095445850ef2c64e96b4c05120cecf66">llvm::SmallPtrSetImpl::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00074">SmallPtrSet.h:74</a></div></div>
<div class="ttc" id="DenseMap_8h_html"><div class="ttname"><a href="DenseMap_8h.html">DenseMap.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1tgtok_html_abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95"><div class="ttname"><a href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a3c0710aa6b054662f67b480712fa2b95">llvm::tgtok::Bits</a></div><div class="ttdef"><b>Definition:</b> <a href="TGLexer_8h_source.html#l00046">TGLexer.h:46</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalVariable_html"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html">llvm::GlobalVariable</a></div><div class="ttdef"><b>Definition:</b> <a href="GlobalVariable_8h_source.html#l00035">GlobalVariable.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantRange_html_ae02fb0a19012613dcf2f9f24a1a3cf99"><div class="ttname"><a href="classllvm_1_1ConstantRange.html#ae02fb0a19012613dcf2f9f24a1a3cf99">llvm::ConstantRange::isEmptySet</a></div><div class="ttdeci">bool isEmptySet() const </div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8cpp_source.html#l00125">ConstantRange.cpp:125</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a2eba483f5cc876e824aa6c085736086b"><div class="ttname"><a href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">llvm::Type::isPointerTy</a></div><div class="ttdeci">bool isPointerTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00220">Type.h:220</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a1f5e8b8d535e593299355288aa0cbd67"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a1f5e8b8d535e593299355288aa0cbd67">llvm::IRBuilder::CreateInBoundsGEP</a></div><div class="ttdeci">Value * CreateInBoundsGEP(Value *Ptr, ArrayRef&lt; Value * &gt; IdxList, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00944">IRBuilder.h:944</a></div></div>
<div class="ttc" id="classllvm_1_1UndefValue_html_a4ae5ff22b700a42bcc5d889233721335"><div class="ttname"><a href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">llvm::UndefValue::get</a></div><div class="ttdeci">static UndefValue * get(Type *T)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01334">Constants.cpp:1334</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a18dbfcb332af7515599ee795cf462843"><div class="ttname"><a href="classllvm_1_1Value.html#a18dbfcb332af7515599ee795cf462843">llvm::Value::Value</a></div><div class="ttdeci">Value(Type *Ty, unsigned scid)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00044">Value.cpp:44</a></div></div>
<div class="ttc" id="namespacellvm_html_a50f8f41fccbea466816345520e9bfabb"><div class="ttname"><a href="namespacellvm.html#a50f8f41fccbea466816345520e9bfabb">llvm::SimplifyInstruction</a></div><div class="ttdeci">Value * SimplifyInstruction(Instruction *I, const DataLayout *TD=0, const TargetLibraryInfo *TLI=0, const DominatorTree *DT=0)</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8cpp_source.html#l03036">InstructionSimplify.cpp:3036</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a00d5f71636b8a01747f15800b9a7a86a"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a00d5f71636b8a01747f15800b9a7a86a">llvm::BasicBlock::getFirstNonPHIOrDbgOrLifetime</a></div><div class="ttdeci">Instruction * getFirstNonPHIOrDbgOrLifetime()</div><div class="ttdoc">Returns a pointer to the first instruction in this block that is not a PHINode, a debug intrinsic...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00150">BasicBlock.cpp:150</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_af85a4828b6b5a8de7fc0a55cc0e5b52f"><div class="ttname"><a href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">llvm::Value::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdoc">All values hold a context through their type. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00517">Value.cpp:517</a></div></div>
<div class="ttc" id="classT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="classllvm_1_1SelectInst_html_a67bf091383cd61e1225445e78b61d9f9"><div class="ttname"><a href="classllvm_1_1SelectInst.html#a67bf091383cd61e1225445e78b61d9f9">llvm::SelectInst::getTrueValue</a></div><div class="ttdeci">const Value * getTrueValue() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01467">Instructions.h:1467</a></div></div>
<div class="ttc" id="README-SSE_8txt_html_ae7fc2fb0e2d536219c1193f1a178e7db"><div class="ttname"><a href="README-SSE_8txt.html#ae7fc2fb0e2d536219c1193f1a178e7db">P2</a></div><div class="ttdeci">This might compile to this xmm1 xorps xmm0 movss xmm0 ret Now consider if the code caused xmm1 to get spilled This might produce this xmm1 movaps xmm0 movaps xmm1 movss xmm0 ret since the reload is only used by these we could fold it into the producing something like xmm1 movaps xmm0 ret saving two instructions The basic idea is that a reload from a spill if only one byte chunk is bring in zeros the one element instead of elements This can be used to simplify a variety of shuffle where the elements are fixed zeros This code generates ugly probably due to costs being off or&lt; 4 x float &gt; * P2</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00308">README-SSE.txt:308</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_af3deb6522c4fe2043fe07af2ec90190c"><div class="ttname"><a href="classllvm_1_1APInt.html#af3deb6522c4fe2043fe07af2ec90190c">llvm::APInt::isPowerOf2</a></div><div class="ttdeci">bool isPowerOf2() const </div><div class="ttdoc">Check if this APInt&amp;#39;s value is a power of two greater than zero. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00390">APInt.h:390</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a9247a212ea89acc9573fa7e7f557eaba"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">llvm::Instruction::setMetadata</a></div><div class="ttdeci">void setMetadata(unsigned KindID, MDNode *Node)</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l00589">Metadata.cpp:589</a></div></div>
<div class="ttc" id="classllvm_1_1InvokeInst_html_a2fcb5cdd1b70bf9ba792497a04f62253"><div class="ttname"><a href="classllvm_1_1InvokeInst.html#a2fcb5cdd1b70bf9ba792497a04f62253">llvm::InvokeInst::getCallingConv</a></div><div class="ttdeci">CallingConv::ID getCallingConv() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02894">Instructions.h:2894</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html_adc5e7f9c460c68455e826783d77f9a99"><div class="ttname"><a href="classllvm_1_1BranchInst.html#adc5e7f9c460c68455e826783d77f9a99">llvm::BranchInst::setSuccessor</a></div><div class="ttdeci">void setSuccessor(unsigned idx, BasicBlock *NewSucc)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02411">Instructions.h:2411</a></div></div>
<div class="ttc" id="namespacellvm_html_ab75560d250028c3c4e54556421109b9d"><div class="ttname"><a href="namespacellvm.html#ab75560d250028c3c4e54556421109b9d">llvm::FoldBranchToCommonDest</a></div><div class="ttdeci">bool FoldBranchToCommonDest(BranchInst *BI)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01967">SimplifyCFG.cpp:1967</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a237e6bf58bc993ea494bdde7480ca428"><div class="ttname"><a href="classllvm_1_1Instruction.html#a237e6bf58bc993ea494bdde7480ca428">llvm::Instruction::isTerminator</a></div><div class="ttdeci">bool isTerminator() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00086">Instruction.h:86</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_a861226dd056dd2438da26760b8e7a9a0"><div class="ttname"><a href="classllvm_1_1CallInst.html#a861226dd056dd2438da26760b8e7a9a0">llvm::CallInst::Create</a></div><div class="ttdeci">static CallInst * Create(Value *Func, ArrayRef&lt; Value * &gt; Args, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01187">Instructions.h:1187</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html_a03cc0dff22b31447f43af97acb76b1a2"><div class="ttname"><a href="classllvm_1_1BranchInst.html#a03cc0dff22b31447f43af97acb76b1a2">llvm::BranchInst::isConditional</a></div><div class="ttdeci">bool isConditional() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02392">Instructions.h:2392</a></div></div>
<div class="ttc" id="namespacellvm_html_acb7a7f0df849c2c44503352493524895"><div class="ttname"><a href="namespacellvm.html#acb7a7f0df849c2c44503352493524895">llvm::isSafeToSpeculativelyExecute</a></div><div class="ttdeci">bool isSafeToSpeculativelyExecute(const Value *V, const DataLayout *TD=0)</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l01974">ValueTracking.cpp:1974</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_ad3d358e03c6228af2d19b2e67028886e"><div class="ttname"><a href="classllvm_1_1APInt.html#ad3d358e03c6228af2d19b2e67028886e">llvm::APInt::ugt</a></div><div class="ttdeci">bool ugt(const APInt &amp;RHS) const </div><div class="ttdoc">Unsigned greather than comparison. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01084">APInt.h:1084</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_ae84bb2408dfffa4e8b5fe2ce0714a3bd"><div class="ttname"><a href="classllvm_1_1DataLayout.html#ae84bb2408dfffa4e8b5fe2ce0714a3bd">llvm::DataLayout::getIntPtrType</a></div><div class="ttdeci">IntegerType * getIntPtrType(LLVMContext &amp;C, unsigned AddressSpace=0) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8cpp_source.html#l00610">DataLayout.cpp:610</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_ac6717dc342ae7060e07e4585282552e7"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ac6717dc342ae7060e07e4585282552e7">ShouldBuildLookupTable</a></div><div class="ttdeci">static bool ShouldBuildLookupTable(SwitchInst *SI, uint64_t TableSize, const TargetTransformInfo &amp;TTI, const DataLayout *TD, const SmallDenseMap&lt; PHINode *, Type * &gt; &amp;ResultTypes)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03621">SimplifyCFG.cpp:3621</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a699a66e504b48fdeff124e82f6c61917"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a699a66e504b48fdeff124e82f6c61917">llvm::DenseMapBase&lt; SmallDenseMap&lt; KeyT, ValueT, InlineBuckets, KeyInfoT &gt;, KeyT, ValueT, KeyInfoT &gt;::insert</a></div><div class="ttdeci">std::pair&lt; iterator, bool &gt; insert(const std::pair&lt; KeyT, ValueT &gt; &amp;KV)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00153">DenseMap.h:153</a></div></div>
<div class="ttc" id="namespacellvm_1_1TargetOpcode_html_a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72"><div class="ttname"><a href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">llvm::TargetOpcode::PHI</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetOpcodes_8h_source.html#l00026">TargetOpcodes.h:26</a></div></div>
<div class="ttc" id="classllvm_1_1ilist__iterator_html"><div class="ttname"><a href="classllvm_1_1ilist__iterator.html">llvm::ilist_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00050">ilist.h:50</a></div></div>
<div class="ttc" id="ConstantRange_8h_html"><div class="ttname"><a href="ConstantRange_8h.html">ConstantRange.h</a></div></div>
<div class="ttc" id="Target_2ARM_2README_8txt_html_a1b45f45820a60c09244a87eb59824aec"><div class="ttname"><a href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a></div><div class="ttdeci">add sub stmia L5 ldr r0 bl L_printf $stub Instead of a and a wouldn t it be better to do three moves *Return an aggregate type is even return S</div><div class="ttdef"><b>Definition:</b> <a href="Target_2ARM_2README_8txt_source.html#l00197">Target/ARM/README.txt:197</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html">llvm::SmallPtrSet</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00236">SmallPtrSet.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a2ce650c1d4a48661b501206d04b6ab04"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a2ce650c1d4a48661b501206d04b6ab04">llvm::SmallPtrSet::erase</a></div><div class="ttdeci">bool erase(PtrType Ptr)</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00259">SmallPtrSet.h:259</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a0519dc6e2f153aaed61eed17d965a9f0"><div class="ttname"><a href="classllvm_1_1Type.html#a0519dc6e2f153aaed61eed17d965a9f0">llvm::Type::getIntegerBitWidth</a></div><div class="ttdeci">unsigned getIntegerBitWidth() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00178">Type.cpp:178</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_a87901387c729722d5d63edd1d35119d7"><div class="ttname"><a href="classllvm_1_1DataLayout.html#a87901387c729722d5d63edd1d35119d7">llvm::DataLayout::fitsInLegalInteger</a></div><div class="ttdeci">bool fitsInLegalInteger(unsigned Width) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00230">DataLayout.h:230</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html"><div class="ttname"><a href="classllvm_1_1ConstantInt.html">llvm::ConstantInt</a></div><div class="ttdoc">Class for constant integers. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00051">Constants.h:51</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a0cf8014ad2d33b40a6bef55018547f57"><div class="ttname"><a href="classllvm_1_1APInt.html#a0cf8014ad2d33b40a6bef55018547f57">llvm::APInt::slt</a></div><div class="ttdeci">bool slt(const APInt &amp;RHS) const </div><div class="ttdoc">Signed less than comparison. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8cpp_source.html#l00547">APInt.cpp:547</a></div></div>
<div class="ttc" id="classllvm_1_1TargetTransformInfo_html"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html">llvm::TargetTransformInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8h_source.html#l00039">TargetTransformInfo.h:39</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_aba6a4cc4ed6d6fef3664b8d65ef04820"><div class="ttname"><a href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">llvm::PHINode::getIncomingValue</a></div><div class="ttdeci">Value * getIncomingValue(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02059">Instructions.h:2059</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_a1cb46775fb4cd36bb709216d0d45bf36"><div class="ttname"><a href="classllvm_1_1CallInst.html#a1cb46775fb4cd36bb709216d0d45bf36">llvm::CallInst::cannotDuplicate</a></div><div class="ttdeci">bool cannotDuplicate() const </div><div class="ttdoc">Determine if the call cannot be duplicated. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01337">Instructions.h:1337</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00029">Target/README.txt:29</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0b4e7bee9b8575cc7db73329f1a561bd"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">llvm::BasicBlock::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00195">BasicBlock.h:195</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_a2a2df5a25b9c703e74e82b48a75d0c3d"><div class="ttname"><a href="Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a></div><div class="ttdeci">instcombine should handle this C2 when C1</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00300">Target/README.txt:300</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html_a1911781fed54dee847a46bf4fa4c5c34"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#a1911781fed54dee847a46bf4fa4c5c34">llvm::SwitchInst::getNumSuccessors</a></div><div class="ttdeci">unsigned getNumSuccessors() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02706">Instructions.h:2706</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantRange_html_a56327dc7ef2656bedacbe669d51abf61"><div class="ttname"><a href="classllvm_1_1ConstantRange.html#a56327dc7ef2656bedacbe669d51abf61">llvm::ConstantRange::getSetSize</a></div><div class="ttdeci">APInt getSetSize() const </div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8cpp_source.html#l00146">ConstantRange.cpp:146</a></div></div>
<div class="ttc" id="namespacellvm_1_1EngineKind_html_a9df47239a42cd9621ac26d9ecbd57441"><div class="ttname"><a href="namespacellvm_1_1EngineKind.html#a9df47239a42cd9621ac26d9ecbd57441">llvm::EngineKind::Kind</a></div><div class="ttdeci">Kind</div><div class="ttdef"><b>Definition:</b> <a href="ExecutionEngine_2ExecutionEngine_8h_source.html#l00499">ExecutionEngine/ExecutionEngine.h:499</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantRange_html_a3b6b85760d6f19980ca3f98b7dc6fad4"><div class="ttname"><a href="classllvm_1_1ConstantRange.html#a3b6b85760d6f19980ca3f98b7dc6fad4">llvm::ConstantRange::inverse</a></div><div class="ttdeci">ConstantRange inverse() const </div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8cpp_source.html#l00711">ConstantRange.cpp:711</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00880">SmallVector.h:880</a></div></div>
<div class="ttc" id="Module_8h_html"><div class="ttname"><a href="Module_8h.html">Module.h</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a0cf3748dba54f931bb1241ae4adc76bc"><div class="ttname"><a href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00111">Value.h:111</a></div></div>
<div class="ttc" id="MDBuilder_8h_html"><div class="ttname"><a href="MDBuilder_8h.html">MDBuilder.h</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_ace1ad5ed624dd5df8efb4eb611cb71ff"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#ace1ad5ed624dd5df8efb4eb611cb71ff">llvm::BasicBlock::eraseFromParent</a></div><div class="ttdeci">void eraseFromParent()</div><div class="ttdoc">Unlink &amp;#39;this&amp;#39; from the containing function and delete it. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00100">BasicBlock.cpp:100</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_aafa29112cbe02e4adc9b36752c771991"><div class="ttname"><a href="classllvm_1_1Instruction.html#aafa29112cbe02e4adc9b36752c771991">llvm::Instruction::getMetadata</a></div><div class="ttdeci">MDNode * getMetadata(unsigned KindID) const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00140">Instruction.h:140</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a50c9506d55e08fb67115a29dde75388a"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a50c9506d55e08fb67115a29dde75388a">ExtractBranchMetadata</a></div><div class="ttdeci">static bool ExtractBranchMetadata(BranchInst *BI, uint64_t &amp;ProbTrue, uint64_t &amp;ProbFalse)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01932">SimplifyCFG.cpp:1932</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantRange_html"><div class="ttname"><a href="classllvm_1_1ConstantRange.html">llvm::ConstantRange</a></div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8h_source.html#l00042">ConstantRange.h:42</a></div></div>
<div class="ttc" id="classllvm_1_1DbgInfoIntrinsic_html"><div class="ttname"><a href="classllvm_1_1DbgInfoIntrinsic.html">llvm::DbgInfoIntrinsic</a></div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00060">IntrinsicInst.h:60</a></div></div>
<div class="ttc" id="namespacellvm_html_abcc98cb5da68b3d112f6a16137d1cec1"><div class="ttname"><a href="namespacellvm.html#abcc98cb5da68b3d112f6a16137d1cec1">llvm::GetIfCondition</a></div><div class="ttdeci">Value * GetIfCondition(BasicBlock *BB, BasicBlock *&amp;IfTrue, BasicBlock *&amp;IfFalse)</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00681">BasicBlockUtils.cpp:681</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantRange_html_a35303bcc6354c08b4ed0cc75b1ec1084"><div class="ttname"><a href="classllvm_1_1ConstantRange.html#a35303bcc6354c08b4ed0cc75b1ec1084">llvm::ConstantRange::getLower</a></div><div class="ttdeci">const APInt &amp; getLower() const </div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8h_source.html#l00079">ConstantRange.h:79</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilderBase_html_ac0e8c554bf1c1e117a74d51df89c137d"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#ac0e8c554bf1c1e117a74d51df89c137d">llvm::IRBuilderBase::getInt32</a></div><div class="ttdeci">ConstantInt * getInt32(uint32_t C)</div><div class="ttdoc">Get a constant 32-bit value. </div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00276">IRBuilder.h:276</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_1_1CaseIteratorT_html_a143819a808ec85e9997566fdf42e9372"><div class="ttname"><a href="classllvm_1_1SwitchInst_1_1CaseIteratorT.html#a143819a808ec85e9997566fdf42e9372">llvm::SwitchInst::CaseIteratorT::getCaseSuccessor</a></div><div class="ttdeci">BasicBlockTy * getCaseSuccessor()</div><div class="ttdoc">Resolves successor for current case. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02518">Instructions.h:2518</a></div></div>
<div class="ttc" id="classllvm_1_1BlockAddress_html_a976bfd676bf773eadde49138cfc7dcb5"><div class="ttname"><a href="classllvm_1_1BlockAddress.html#a976bfd676bf773eadde49138cfc7dcb5">llvm::BlockAddress::getBasicBlock</a></div><div class="ttdeci">BasicBlock * getBasicBlock() const </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00764">Constants.h:764</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a94c18bf85a5105e0a22fba23b0bedafa"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a94c18bf85a5105e0a22fba23b0bedafa">llvm::IRBuilder::CreateMul</a></div><div class="ttdeci">Value * CreateMul(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;, bool HasNUW=false, bool HasNSW=false)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00659">IRBuilder.h:659</a></div></div>
<div class="ttc" id="classllvm_1_1iplist_html_ab1b660345b57db3d80ad42123d6163ce"><div class="ttname"><a href="classllvm_1_1iplist.html#ab1b660345b57db3d80ad42123d6163ce">llvm::iplist&lt; Instruction &gt;::reverse_iterator</a></div><div class="ttdeci">std::reverse_iterator&lt; iterator &gt; reverse_iterator</div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00349">ilist.h:349</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a9105541412dab869e18b3cceebfff07d"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">llvm::ConstantInt::get</a></div><div class="ttdeci">static Constant * get(Type *Ty, uint64_t V, bool isSigned=false)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00492">Constants.cpp:492</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a30f2c362631e3728d2f47a8203071ade"><div class="ttname"><a href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">llvm::Function::getEntryBlock</a></div><div class="ttdeci">const BasicBlock &amp; getEntryBlock() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00380">Function.h:380</a></div></div>
<div class="ttc" id="namespacellvm_html_a78ab69092404fc83d77ccb06b3f7138d"><div class="ttname"><a href="namespacellvm.html#a78ab69092404fc83d77ccb06b3f7138d">llvm::ConstantFoldTerminator</a></div><div class="ttdeci">bool ConstantFoldTerminator(BasicBlock *BB, bool DeleteDeadConditions=false, const TargetLibraryInfo *TLI=0)</div><div class="ttdef"><b>Definition:</b> <a href="Local_8cpp_source.html#l00059">Local.cpp:59</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html_ad7ec8482f19e8e86e3de573b060a17e5"><div class="ttname"><a href="classllvm_1_1Constant.html#ad7ec8482f19e8e86e3de573b060a17e5">llvm::Constant::isNullValue</a></div><div class="ttdeci">bool isNullValue() const </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00075">Constants.cpp:75</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html_ad3a1537c850f63ce48bcf45694cde73f"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#ad3a1537c850f63ce48bcf45694cde73f">llvm::SwitchInst::findCaseValue</a></div><div class="ttdeci">CaseIt findCaseValue(const ConstantInt *C)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02664">Instructions.h:2664</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a82dbbd8e3688b0bc1eedb338864d0d0c"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a82dbbd8e3688b0bc1eedb338864d0d0c">llvm::ConstantInt::getTrue</a></div><div class="ttdeci">static ConstantInt * getTrue(LLVMContext &amp;Context)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00438">Constants.cpp:438</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html_a7fc7899c254935205ca29b6bd7baa926"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#a7fc7899c254935205ca29b6bd7baa926">llvm::SwitchInst::setSuccessor</a></div><div class="ttdeci">void setSuccessor(unsigned idx, BasicBlock *NewSucc)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02711">Instructions.h:2711</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a126a12b67fa620ad28ec0c919ca7a3e8"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a126a12b67fa620ad28ec0c919ca7a3e8">llvm::CmpInst::setPredicate</a></div><div class="ttdeci">void setPredicate(Predicate P)</div><div class="ttdoc">Set the predicate for this instruction to the specified value. </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00719">InstrTypes.h:719</a></div></div>
<div class="ttc" id="classllvm_1_1iplist_html_afe55b235779222b867c16d3321c1cd16"><div class="ttname"><a href="classllvm_1_1iplist.html#afe55b235779222b867c16d3321c1cd16">llvm::iplist::splice</a></div><div class="ttdeci">void splice(iterator where, iplist &amp;L2)</div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00570">ilist.h:570</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_ad04d12b08532d23bbd327a7024caad89"><div class="ttname"><a href="SimplifyCFG_8cpp.html#ad04d12b08532d23bbd327a7024caad89">EraseTerminatorInstAndDCECond</a></div><div class="ttdeci">static void EraseTerminatorInstAndDCECond(TerminatorInst *TI)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00447">SimplifyCFG.cpp:447</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a5fa9b8e1842b354f64c1ba6be0a4a17f"><div class="ttname"><a href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">llvm::User::setOperand</a></div><div class="ttdeci">void setOperand(unsigned i, Value *Val)</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00092">User.h:92</a></div></div>
<div class="ttc" id="namespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs - Return a circular-buffered debug stream. </div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00101">Debug.cpp:101</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html_ac8ddb745480a7e75a3862ddf0be3a298"><div class="ttname"><a href="classllvm_1_1Constant.html#ac8ddb745480a7e75a3862ddf0be3a298">llvm::Constant::isAllOnesValue</a></div><div class="ttdeci">bool isAllOnesValue() const </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00088">Constants.cpp:88</a></div></div>
<div class="ttc" id="namespacestd_html_ab8424022895aee3e366fb9a32f2883cb"><div class="ttname"><a href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a></div><div class="ttdeci">void swap(llvm::BitVector &amp;LHS, llvm::BitVector &amp;RHS)</div><div class="ttdoc">Implement std::swap in terms of BitVector swap. </div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00591">BitVector.h:591</a></div></div>
<div class="ttc" id="GlobalVariable_8h_html"><div class="ttname"><a href="GlobalVariable_8h.html">GlobalVariable.h</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html"><div class="ttname"><a href="classllvm_1_1APInt.html">llvm::APInt</a></div><div class="ttdoc">Class for arbitrary precision integers. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00075">APInt.h:75</a></div></div>
<div class="ttc" id="CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="CodeGen_2README_8txt_source.html#l00036">CodeGen/README.txt:36</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a0b13773c26dad640e24611c48c657463"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a0b13773c26dad640e24611c48c657463">DupRet</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; DupRet(&quot;simplifycfg-dup-ret&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Duplicate return instructions into unconditional branches&quot;))</div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a21960167f529265a1cb02ac1e8ad10f6"><div class="ttname"><a href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">llvm::PHINode::getIncomingValueForBlock</a></div><div class="ttdeci">Value * getIncomingValueForBlock(const BasicBlock *BB) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02139">Instructions.h:2139</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a6e328feb83afa5cf1c966d6704e43fc1"><div class="ttname"><a href="classllvm_1_1Type.html#a6e328feb83afa5cf1c966d6704e43fc1">llvm::Type::isIntegerTy</a></div><div class="ttdeci">bool isIntegerTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00196">Type.h:196</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a5ac211f24970dea81fa9a7118a8ce36b"><div class="ttname"><a href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">llvm::Instruction::use_back</a></div><div class="ttdeci">Instruction * use_back()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00049">Instruction.h:49</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_ae19d9d49f39d404703b42161ce788954"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#ae19d9d49f39d404703b42161ce788954">llvm::IRBuilder::CreateSelect</a></div><div class="ttdeci">Value * CreateSelect(Value *C, Value *True, Value *False, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01336">IRBuilder.h:1336</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a5ef55181ae0bb0f5c561b9a29087b1e5"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a5ef55181ae0bb0f5c561b9a29087b1e5">llvm::BasicBlock::getSinglePredecessor</a></div><div class="ttdeci">BasicBlock * getSinglePredecessor()</div><div class="ttdoc">Return this block if it has a single predecessor block. Otherwise return a null pointer. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00183">BasicBlock.cpp:183</a></div></div>
<div class="ttc" id="PatternMatch_8h_html"><div class="ttname"><a href="PatternMatch_8h.html">PatternMatch.h</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a432d7e955f44b118b4261eae03d7a8af"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a432d7e955f44b118b4261eae03d7a8af">llvm::DenseMapBase&lt; SmallDenseMap&lt; KeyT, ValueT, InlineBuckets, KeyInfoT &gt;, KeyT, ValueT, KeyInfoT &gt;::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00053">DenseMap.h:53</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html_add5ee99852e9927d0777e74572c91708"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#add5ee99852e9927d0777e74572c91708">llvm::SwitchInst::getCondition</a></div><div class="ttdeci">Value * getCondition() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02610">Instructions.h:2610</a></div></div>
<div class="ttc" id="ConstantFolding_8h_html"><div class="ttname"><a href="ConstantFolding_8h.html">ConstantFolding.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1APIntOps_html_a684cfe02c582e8d75cd6d457e63e6c25"><div class="ttname"><a href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">llvm::APIntOps::And</a></div><div class="ttdeci">APInt And(const APInt &amp;LHS, const APInt &amp;RHS)</div><div class="ttdoc">Bitwise AND function for APInt. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01840">APInt.h:1840</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a0fd53f63d349dc8a7c5fc0cdd7a94c8d"><div class="ttname"><a href="classllvm_1_1Instruction.html#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">llvm::Instruction::removeFromParent</a></div><div class="ttdeci">void removeFromParent()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00068">Instruction.cpp:68</a></div></div>
<div class="ttc" id="classllvm_1_1Operator_html_a2f14b03fb8025d2bfa20a34da2b20ccf"><div class="ttname"><a href="classllvm_1_1Operator.html#a2f14b03fb8025d2bfa20a34da2b20ccf">llvm::Operator::getOpcode</a></div><div class="ttdeci">unsigned getOpcode() const </div><div class="ttdef"><b>Definition:</b> <a href="Operator_8h_source.html#l00051">Operator.h:51</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a8a045d250952c0867382a9840ee18fdf"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">llvm::SmallVectorTemplateCommon&lt; T &gt;::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00112">SmallVector.h:112</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_afa29f0cd072ab9b3a2630681ffe5760f"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#afa29f0cd072ab9b3a2630681ffe5760f">llvm::ConstantExpr::getNeg</a></div><div class="ttdeci">static Constant * getNeg(Constant *C, bool HasNUW=false, bool HasNSW=false)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l02021">Constants.cpp:2021</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a413abcab8dbc3900fc2fde96a5d8fca6"><div class="ttname"><a href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">llvm::Value::use_begin</a></div><div class="ttdeci">use_iterator use_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00150">Value.h:150</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a5d26d13ee0f270c3ad3cd25e7f798c89"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a5d26d13ee0f270c3ad3cd25e7f798c89">HoistCondStores</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; HoistCondStores(&quot;simplifycfg-hoist-cond-stores&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Hoist conditional stores if an unconditional store preceeds&quot;))</div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html_aef88cf6f3b68009b7901343e934368a8"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#aef88cf6f3b68009b7901343e934368a8">llvm::SwitchInst::getSuccessor</a></div><div class="ttdeci">BasicBlock * getSuccessor(unsigned idx) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02707">Instructions.h:2707</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a7cca116ba5ef3fe3dfc9872b1600d11d"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a7cca116ba5ef3fe3dfc9872b1600d11d">llvm::IRBuilder::CreateZExtOrTrunc</a></div><div class="ttdeci">Value * CreateZExtOrTrunc(Value *V, Type *DestTy, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdoc">Create a ZExt or Trunc from the integer value V to DestTy. Return the value untouched if the type of ...</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01079">IRBuilder.h:1079</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html_a84309bb8c34c8bc5694ec5d48dd8668f"><div class="ttname"><a href="classllvm_1_1BranchInst.html#a84309bb8c34c8bc5694ec5d48dd8668f">llvm::BranchInst::getCondition</a></div><div class="ttdeci">Value * getCondition() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02394">Instructions.h:2394</a></div></div>
<div class="ttc" id="classllvm_1_1InvokeInst_html_abcf96faa5717afe76da1a6a8d31bea8f"><div class="ttname"><a href="classllvm_1_1InvokeInst.html#abcf96faa5717afe76da1a6a8d31bea8f">llvm::InvokeInst::getAttributes</a></div><div class="ttdeci">const AttributeSet &amp; getAttributes() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02903">Instructions.h:2903</a></div></div>
<div class="ttc" id="classllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l01149">CommandLine.h:1149</a></div></div>
<div class="ttc" id="classllvm_1_1TargetTransformInfo_html_a74d97d9e66d1007252d8609b7b8ccf21"><div class="ttname"><a href="classllvm_1_1TargetTransformInfo.html#a74d97d9e66d1007252d8609b7b8ccf21">llvm::TargetTransformInfo::shouldBuildLookupTables</a></div><div class="ttdeci">virtual bool shouldBuildLookupTables() const </div><div class="ttdef"><b>Definition:</b> <a href="TargetTransformInfo_8cpp_source.html#l00144">TargetTransformInfo.cpp:144</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html_a3feb6090a53e81f06d82da0a97be6e19"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#a3feb6090a53e81f06d82da0a97be6e19">llvm::SwitchInst::getDefaultDest</a></div><div class="ttdeci">BasicBlock * getDefaultDest() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02613">Instructions.h:2613</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantRange_html_a1e2111f6405de8f2b3bd8fff249e2bb1"><div class="ttname"><a href="classllvm_1_1ConstantRange.html#a1e2111f6405de8f2b3bd8fff249e2bb1">llvm::ConstantRange::makeICmpRegion</a></div><div class="ttdeci">static ConstantRange makeICmpRegion(unsigned Pred, const ConstantRange &amp;Other)</div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8cpp_source.html#l00052">ConstantRange.cpp:52</a></div></div>
<div class="ttc" id="MD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00054">MD5.cpp:54</a></div></div>
<div class="ttc" id="regcomp_8c_html_a0240ac851181b84ac374872dc5434ee4"><div class="ttname"><a href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a></div><div class="ttdeci">#define N</div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a5cb76a65b6524dba1493dd2b9dc3abbe"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">llvm::BasicBlock::getTerminator</a></div><div class="ttdeci">TerminatorInst * getTerminator()</div><div class="ttdoc">Returns the terminator instruction if the block is well formed or null if the block is not well forme...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00120">BasicBlock.cpp:120</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a085b82f074c28030fb8e194377ed2d0c"><div class="ttname"><a href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">llvm::Value::hasOneUse</a></div><div class="ttdeci">bool hasOneUse() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00161">Value.h:161</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_ae1d53a21892854816885c7288f8b46f1"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#ae1d53a21892854816885c7288f8b46f1">llvm::BasicBlock::Create</a></div><div class="ttdeci">static BasicBlock * Create(LLVMContext &amp;Context, const Twine &amp;Name=&quot;&quot;, Function *Parent=0, BasicBlock *InsertBefore=0)</div><div class="ttdoc">Creates a new BasicBlock. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00109">BasicBlock.h:109</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayType_html_adf411edc4f135b570ab218079474ce77"><div class="ttname"><a href="classllvm_1_1ArrayType.html#adf411edc4f135b570ab218079474ce77">llvm::ArrayType::get</a></div><div class="ttdeci">static ArrayType * get(Type *ElementType, uint64_t NumElements)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00679">Type.cpp:679</a></div></div>
<div class="ttc" id="BasicBlockUtils_8h_html"><div class="ttname"><a href="BasicBlockUtils_8h.html">BasicBlockUtils.h</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_a1f2303df9bbee2233c11d61c2f6f7930"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#a1f2303df9bbee2233c11d61c2f6f7930">llvm::SmallVectorTemplateBase&lt; T, isPodLike&lt; T &gt;::value &gt;::pop_back</a></div><div class="ttdeci">void pop_back()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00260">SmallVector.h:260</a></div></div>
<div class="ttc" id="namespacellvm_html_a2b8a0d5fd8cacf34a300e31e25eaa77f"><div class="ttname"><a href="namespacellvm.html#a2b8a0d5fd8cacf34a300e31e25eaa77f">llvm::FoldReturnIntoUncondBranch</a></div><div class="ttdeci">ReturnInst * FoldReturnIntoUncondBranch(ReturnInst *RI, BasicBlock *BB, BasicBlock *Pred)</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlockUtils_8cpp_source.html#l00594">BasicBlockUtils.cpp:594</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_aaba6ba9e89bea12994fa7a7a6ade4d38"><div class="ttname"><a href="SimplifyCFG_8cpp.html#aaba6ba9e89bea12994fa7a7a6ade4d38">ValuesOverlap</a></div><div class="ttdeci">static bool ValuesOverlap(std::vector&lt; ValueEqualityComparisonCase &gt; &amp;C1, std::vector&lt; ValueEqualityComparisonCase &gt; &amp;C2)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00523">SimplifyCFG.cpp:523</a></div></div>
<div class="ttc" id="ValueTracking_8h_html"><div class="ttname"><a href="ValueTracking_8h.html">ValueTracking.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8">llvm::A64CC::NV</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00046">AArch64BaseInfo.h:46</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a5a7cfa245af120b44ac8a86143bb9e57"><div class="ttname"><a href="classllvm_1_1Type.html#a5a7cfa245af120b44ac8a86143bb9e57">llvm::Type::getPrimitiveSizeInBits</a></div><div class="ttdeci">unsigned getPrimitiveSizeInBits() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00117">Type.cpp:117</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a19445f836d9e1ecb32cba27ec4338fff"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a19445f836d9e1ecb32cba27ec4338fff">llvm::BasicBlock::splitBasicBlock</a></div><div class="ttdeci">BasicBlock * splitBasicBlock(iterator I, const Twine &amp;BBName=&quot;&quot;)</div><div class="ttdoc">Split the basic block into two basic blocks at the specified instruction. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00298">BasicBlock.cpp:298</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html_a428c1dd0acc084fb894ceb71ca5b707a"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#a428c1dd0acc084fb894ceb71ca5b707a">llvm::SwitchInst::removeCase</a></div><div class="ttdeci">void removeCase(CaseIt i)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l03359">Instructions.cpp:3359</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_aed28607f3ab19dda7ec1cf1a0319276f"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#aed28607f3ab19dda7ec1cf1a0319276f">llvm::BasicBlock::size</a></div><div class="ttdeci">size_t size() const </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00203">BasicBlock.h:203</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html_a96a201f56500af4dd70b4169f140cb4c"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#a96a201f56500af4dd70b4169f140cb4c">llvm::SwitchInst::case_default</a></div><div class="ttdeci">CaseIt case_default()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02653">Instructions.h:2653</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html_a4901d4ad48420014059e9393f75442ae"><div class="ttname"><a href="classllvm_1_1SwitchInst.html#a4901d4ad48420014059e9393f75442ae">llvm::SwitchInst::getNumCases</a></div><div class="ttdeci">unsigned getNumCases() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02623">Instructions.h:2623</a></div></div>
<div class="ttc" id="IRBuilder_8h_html"><div class="ttname"><a href="IRBuilder_8h.html">IRBuilder.h</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html_a3505dab06f59c36142a234321cdc3411"><div class="ttname"><a href="classllvm_1_1BranchInst.html#a3505dab06f59c36142a234321cdc3411">llvm::BranchInst::setCondition</a></div><div class="ttdeci">void setCondition(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02399">Instructions.h:2399</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05aa719225e2de4059f93fd3209e1f48218"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05aa719225e2de4059f93fd3209e1f48218">llvm::CmpInst::ICMP_EQ</a></div><div class="ttdoc">equal </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00672">InstrTypes.h:672</a></div></div>
<div class="ttc" id="LLVMContext_8h_html"><div class="ttname"><a href="LLVMContext_8h.html">LLVMContext.h</a></div></div>
<div class="ttc" id="SetVector_8h_html"><div class="ttname"><a href="SetVector_8h.html">SetVector.h</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html"><div class="ttname"><a href="classllvm_1_1SwitchInst.html">llvm::SwitchInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02449">Instructions.h:2449</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ac38c53f76ef532f91f1666c8a87370e9"><div class="ttname"><a href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">llvm::Value::use_empty</a></div><div class="ttdeci">bool use_empty() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00149">Value.h:149</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantRange_html_af88b7acdd025620663e38ca68ff746f5"><div class="ttname"><a href="classllvm_1_1ConstantRange.html#af88b7acdd025620663e38ca68ff746f5">llvm::ConstantRange::getUpper</a></div><div class="ttdeci">const APInt &amp; getUpper() const </div><div class="ttdef"><b>Definition:</b> <a href="ConstantRange_8h_source.html#l00083">ConstantRange.h:83</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_a179ef4c643fb35a8dc364e4ae63950f9"><div class="ttname"><a href="classllvm_1_1CallInst.html#a179ef4c643fb35a8dc364e4ae63950f9">llvm::CallInst::setAttributes</a></div><div class="ttdeci">void setAttributes(const AttributeSet &amp;Attrs)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01264">Instructions.h:1264</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_afe11668c8bd8d29c005ca8e66ba9ef6b"><div class="ttname"><a href="SimplifyCFG_8cpp.html#afe11668c8bd8d29c005ca8e66ba9ef6b">LookupConstant</a></div><div class="ttdeci">static Constant * LookupConstant(Value *V, const SmallDenseMap&lt; Value *, Constant * &gt; &amp;ConstantPool)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03321">SimplifyCFG.cpp:3321</a></div></div>
<div class="ttc" id="Local_8h_html"><div class="ttname"><a href="Local_8h.html">Local.h</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_ad652423d9d91271ba153eb86482b2f55"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#ad652423d9d91271ba153eb86482b2f55">llvm::BasicBlock::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdoc">Get the context in which this basic block lives. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00033">BasicBlock.cpp:33</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a819fe08329be34252ffde1e710574a34"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a819fe08329be34252ffde1e710574a34">ForwardSwitchConditionToPHI</a></div><div class="ttdeci">static bool ForwardSwitchConditionToPHI(SwitchInst *SI)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03273">SimplifyCFG.cpp:3273</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_a9e1fc23a17e97d2d1732e753ae9251ac"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">llvm::GlobalValue::getParent</a></div><div class="ttdeci">Module * getParent()</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00286">GlobalValue.h:286</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_aa933549689e79685bb67de64dddc9f7c"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#aa933549689e79685bb67de64dddc9f7c">llvm::IRBuilder::CreateTrunc</a></div><div class="ttdeci">Value * CreateTrunc(Value *V, Type *DestTy, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01068">IRBuilder.h:1068</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00066">Value.h:66</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_acfd7cc74125222a81c02b4097ed5166c"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#acfd7cc74125222a81c02b4097ed5166c">llvm::DenseMapBase&lt; SmallDenseMap&lt; KeyT, ValueT, InlineBuckets, KeyInfoT &gt;, KeyT, ValueT, KeyInfoT &gt;::lookup</a></div><div class="ttdeci">ValueT lookup(const KeyT &amp;Val) const</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00143">DenseMap.h:143</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a021bb7c9aad6003fe8089f6327356c6c"><div class="ttname"><a href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">llvm::Instruction::getOpcode</a></div><div class="ttdeci">unsigned getOpcode() const </div><div class="ttdoc">getOpcode() returns a member of one of the enums like Instruction::Add. </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00083">Instruction.h:83</a></div></div>
<div class="ttc" id="Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="Target_2X86_2README_8txt_source.html#l00297">Target/X86/README.txt:297</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a7e31b0c02df2aeed261b103b790cc01e"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a7e31b0c02df2aeed261b103b790cc01e">llvm::IRBuilder::CreateCall</a></div><div class="ttdeci">CallInst * CreateCall(Value *Callee, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01304">IRBuilder.h:1304</a></div></div>
<div class="ttc" id="SmallVector_8h_html"><div class="ttname"><a href="SmallVector_8h.html">SmallVector.h</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a5d84e72ef1f1b122131557e4b44f2f0d"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a5d84e72ef1f1b122131557e4b44f2f0d">llvm::IRBuilder::CreateRetVoid</a></div><div class="ttdeci">ReturnInst * CreateRetVoid()</div><div class="ttdoc">Create a &amp;#39;ret void&amp;#39; instruction. </div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00502">IRBuilder.h:502</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a02215e210f29948498aeb844022afe53"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a02215e210f29948498aeb844022afe53">SafeToMergeTerminators</a></div><div class="ttdeci">static bool SafeToMergeTerminators(TerminatorInst *SI1, TerminatorInst *SI2)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00121">SimplifyCFG.cpp:121</a></div></div>
<div class="ttc" id="namespacellvm_html_a3e98ee8971fbf32f7f84f5a7399b5b67"><div class="ttname"><a href="namespacellvm.html#a3e98ee8971fbf32f7f84f5a7399b5b67">llvm::ConstantFoldInstOperands</a></div><div class="ttdeci">Constant * ConstantFoldInstOperands(unsigned Opcode, Type *DestTy, ArrayRef&lt; Constant * &gt; Ops, const DataLayout *TD=0, const TargetLibraryInfo *TLI=0)</div><div class="ttdef"><b>Definition:</b> <a href="ConstantFolding_8cpp_source.html#l00954">ConstantFolding.cpp:954</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a59db00fcf511b059606e9eddd6675883"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a59db00fcf511b059606e9eddd6675883">TryToSimplifyUncondBranchWithICmpInIt</a></div><div class="ttdeci">static bool TryToSimplifyUncondBranchWithICmpInIt(ICmpInst *ICI, IRBuilder&lt;&gt; &amp;Builder, const TargetTransformInfo &amp;TTI, const DataLayout *TD)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l02626">SimplifyCFG.cpp:2626</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a0c00110a06b1eb96c92f87e4ca28129a"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a0c00110a06b1eb96c92f87e4ca28129a">llvm::IRBuilder::CreateBr</a></div><div class="ttdeci">BranchInst * CreateBr(BasicBlock *Dest)</div><div class="ttdoc">Create an unconditional &amp;#39;br label X&amp;#39; instruction. </div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00526">IRBuilder.h:526</a></div></div>
<div class="ttc" id="namespacellvm_html_a7923e3e207de8bc1d0d6a5091316ddde"><div class="ttname"><a href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a></div><div class="ttdeci">ItTy prior(ItTy it, Dist n)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00167">STLExtras.h:167</a></div></div>
<div class="ttc" id="classllvm_1_1InvokeInst_html"><div class="ttname"><a href="classllvm_1_1InvokeInst.html">llvm::InvokeInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02841">Instructions.h:2841</a></div></div>
<div class="ttc" id="Debug_8h_html_aef41e8aaf4c60819b30faf396cdf4978"><div class="ttname"><a href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a></div><div class="ttdeci">#define DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00097">Debug.h:97</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a73476159b3f570043406e83b49ea036c"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a73476159b3f570043406e83b49ea036c">ValidLookupTableConstant</a></div><div class="ttdeci">static bool ValidLookupTableConstant(Constant *C)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03308">SimplifyCFG.cpp:3308</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_abfe18d4b03b813d04ffd79e706cc62aa"><div class="ttname"><a href="SimplifyCFG_8cpp.html#abfe18d4b03b813d04ffd79e706cc62aa">GetCaseResults</a></div><div class="ttdeci">static bool GetCaseResults(SwitchInst *SI, ConstantInt *CaseVal, BasicBlock *CaseDest, BasicBlock **CommonDest, SmallVectorImpl&lt; std::pair&lt; PHINode *, Constant * &gt; &gt; &amp;Res, const DataLayout *DL)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03367">SimplifyCFG.cpp:3367</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a3a785324436b8d2862b09f5fd8d1c061"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a3a785324436b8d2862b09f5fd8d1c061">FindPHIForConditionForwarding</a></div><div class="ttdeci">static PHINode * FindPHIForConditionForwarding(ConstantInt *CaseValue, BasicBlock *BB, int *PhiIndex)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03240">SimplifyCFG.cpp:3240</a></div></div>
<div class="ttc" id="classllvm_1_1SelectInst_html_a29a16f32075ee4f23cd769701463952c"><div class="ttname"><a href="classllvm_1_1SelectInst.html#a29a16f32075ee4f23cd769701463952c">llvm::SelectInst::getFalseValue</a></div><div class="ttdeci">const Value * getFalseValue() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01468">Instructions.h:1468</a></div></div>
<div class="ttc" id="classllvm_1_1MDString_html"><div class="ttname"><a href="classllvm_1_1MDString.html">llvm::MDString</a></div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l00039">Metadata.h:39</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a6142fc5662411269a7ca0217f49f338c"><div class="ttname"><a href="classllvm_1_1APInt.html#a6142fc5662411269a7ca0217f49f338c">llvm::APInt::zext</a></div><div class="ttdeci">APInt LLVM_ATTRIBUTE_UNUSED_RESULT zext(unsigned width) const </div><div class="ttdoc">Zero extend to a new width. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8cpp_source.html#l00983">APInt.cpp:983</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a39eb6c7310d5673dad5be0af7c6a79f8"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a39eb6c7310d5673dad5be0af7c6a79f8">SimplifyBranchOnICmpChain</a></div><div class="ttdeci">static bool SimplifyBranchOnICmpChain(BranchInst *BI, const DataLayout *TD, IRBuilder&lt;&gt; &amp;Builder)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l02733">SimplifyCFG.cpp:2733</a></div></div>
<div class="ttc" id="raw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="TargetTransformInfo_8h_html"><div class="ttname"><a href="TargetTransformInfo_8h.html">TargetTransformInfo.h</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a9f729c6c3e0de4a55dc5a3693fd4a9eb"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9f729c6c3e0de4a55dc5a3693fd4a9eb">llvm::Instruction::isSameOperationAs</a></div><div class="ttdeci">bool isSameOperationAs(const Instruction *I, unsigned flags=0) const </div><div class="ttdoc">Determine if one instruction is the same operation as another. </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00334">Instruction.cpp:334</a></div></div>
<div class="ttc" id="namespacellvm_html_a162c90bc179a6359438d060722bee35f"><div class="ttname"><a href="namespacellvm.html#a162c90bc179a6359438d060722bee35f">llvm::operator==</a></div><div class="ttdeci">bool operator==(uint64_t V1, const APInt &amp;V2)</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01684">APInt.h:1684</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a95ec32778f2bb913dc4cc45ac7a66e42"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a95ec32778f2bb913dc4cc45ac7a66e42">FitWeights</a></div><div class="ttdeci">static void FitWeights(MutableArrayRef&lt; uint64_t &gt; Weights)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00753">SimplifyCFG.cpp:753</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a88cdefb709309eddc6e5daca0be6a7b4"><div class="ttname"><a href="classllvm_1_1PHINode.html#a88cdefb709309eddc6e5daca0be6a7b4">llvm::PHINode::setIncomingValue</a></div><div class="ttdeci">void setIncomingValue(unsigned i, Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02062">Instructions.h:2062</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a1e3544295480ec7b23c650873d046538"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a1e3544295480ec7b23c650873d046538">FoldCondBranchOnPHI</a></div><div class="ttdeci">static bool FoldCondBranchOnPHI(BranchInst *BI, const DataLayout *TD)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l01608">SimplifyCFG.cpp:1608</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a21cf94357e53cd1069aba475266fdb63"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, KeyInfoT &gt;, KeyT, ValueT, KeyInfoT &gt;::find</a></div><div class="ttdeci">iterator find(const KeyT &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00108">DenseMap.h:108</a></div></div>
<div class="ttc" id="classllvm_1_1StoreInst_html_ac03c1c093059ea000216af8dd6f2dbf4"><div class="ttname"><a href="classllvm_1_1StoreInst.html#ac03c1c093059ea000216af8dd6f2dbf4">llvm::StoreInst::getPointerOperand</a></div><div class="ttdeci">Value * getPointerOperand()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00346">Instructions.h:346</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_adfeed3997bba12e75a8e51d740f1969d"><div class="ttname"><a href="SimplifyCFG_8cpp.html#adfeed3997bba12e75a8e51d740f1969d">AddPredecessorToBlock</a></div><div class="ttdeci">static void AddPredecessorToBlock(BasicBlock *Succ, BasicBlock *NewPred, BasicBlock *ExistPred)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00189">SimplifyCFG.cpp:189</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a5c2b7d7f19aac93b27b845858a7eb73e"><div class="ttname"><a href="classllvm_1_1PHINode.html#a5c2b7d7f19aac93b27b845858a7eb73e">llvm::PHINode::getBasicBlockIndex</a></div><div class="ttdeci">int getBasicBlockIndex(const BasicBlock *BB) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02132">Instructions.h:2132</a></div></div>
<div class="ttc" id="classllvm_1_1IndirectBrInst_html_a9e58646ca23225c0895a274e0e4704bf"><div class="ttname"><a href="classllvm_1_1IndirectBrInst.html#a9e58646ca23225c0895a274e0e4704bf">llvm::IndirectBrInst::getNumDestinations</a></div><div class="ttdeci">unsigned getNumDestinations() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02792">Instructions.h:2792</a></div></div>
<div class="ttc" id="classllvm_1_1IndirectBrInst_html_ac0cc9b34e16910d245245642350d4456"><div class="ttname"><a href="classllvm_1_1IndirectBrInst.html#ac0cc9b34e16910d245245642350d4456">llvm::IndirectBrInst::removeDestination</a></div><div class="ttdeci">void removeDestination(unsigned i)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l03480">Instructions.cpp:3480</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a9cd49851904f15060edb782ef4dd1b2d"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00052">Instruction.h:52</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a1445356b70fbb95acc5e0d3d2ac9101c"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a1445356b70fbb95acc5e0d3d2ac9101c">llvm::BasicBlock::iterator</a></div><div class="ttdeci">InstListType::iterator iterator</div><div class="ttdoc">Instruction iterators... </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00099">BasicBlock.h:99</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a0b050aae0f188426acd4124d39e50ae6"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a0b050aae0f188426acd4124d39e50ae6">GetConstantInt</a></div><div class="ttdeci">static ConstantInt * GetConstantInt(Value *V, const DataLayout *TD)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l00309">SimplifyCFG.cpp:309</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_aa96ca2cf0bb1e924523900fb911b0a45"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#aa96ca2cf0bb1e924523900fb911b0a45">llvm::ConstantInt::isOne</a></div><div class="ttdeci">bool isOne() const </div><div class="ttdoc">Determine if the value is one. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00168">Constants.h:168</a></div></div>
<div class="ttc" id="classllvm_1_1MDBuilder_html"><div class="ttname"><a href="classllvm_1_1MDBuilder.html">llvm::MDBuilder</a></div><div class="ttdef"><b>Definition:</b> <a href="MDBuilder_8h_source.html#l00027">MDBuilder.h:27</a></div></div>
<div class="ttc" id="SimplifyCFG_8cpp_html_a48977a4b045a92bc5cf1c0ad4d95129e"><div class="ttname"><a href="SimplifyCFG_8cpp.html#a48977a4b045a92bc5cf1c0ad4d95129e">EliminateDeadSwitchCases</a></div><div class="ttdeci">static bool EliminateDeadSwitchCases(SwitchInst *SI)</div><div class="ttdef"><b>Definition:</b> <a href="SimplifyCFG_8cpp_source.html#l03187">SimplifyCFG.cpp:3187</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html_a0e74af4b7c739f3a14e737c3042b6617"><div class="ttname"><a href="classllvm_1_1Module.html#a0e74af4b7c739f3a14e737c3042b6617">llvm::Module::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00249">Module.h:249</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_af5c7041df3ad5edffe5da17b5264c1fc"><div class="ttname"><a href="classllvm_1_1Type.html#af5c7041df3ad5edffe5da17b5264c1fc">llvm::Type::isVoidTy</a></div><div class="ttdeci">bool isVoidTy() const </div><div class="ttdoc">isVoidTy - Return true if this is &amp;#39;void&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00140">Type.h:140</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_1_1CaseIt_html"><div class="ttname"><a href="classllvm_1_1SwitchInst_1_1CaseIt.html">llvm::SwitchInst::CaseIt</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02574">Instructions.h:2574</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<p class="footer">
Generated on Sat Nov 10 2018 23:02:08 for <a href="http://llvm.org/">LLVM</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.8.11</a><br>
Copyright &copy; 2003-2013 University of Illinois at Urbana-Champaign.
All Rights Reserved.</p>
<hr>
<!--#include virtual="/attrib.incl" -->
</body>
</html>
