<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="LLVM,Low Level Virtual Machine,C++,doxygen,API,documentation"/>
<meta name="description" content="C++ source code API documentation for LLVM."/>
<title>LLVM: ObjCARCOpts.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">LLVM API Documentation</p>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ObjCARCOpts_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ObjCARCOpts.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ObjCARCOpts_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- ObjCARCOpts.cpp - ObjC ARC Optimization ----------------------------===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                     The LLVM Compiler Infrastructure</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is distributed under the University of Illinois Open Source</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License. See LICENSE.TXT for details.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span><span class="comment"></span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">/// \file</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">/// This file defines ObjC ARC optimizations. ARC stands for Automatic</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">/// Reference Counting and is a system for managing reference counts for objects</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">/// in Objective C.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/// The optimizations performed include elimination of redundant, partially</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">/// redundant, and inconsequential reference count operations, elimination of</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">/// redundant weak pointer operations, and numerous minor simplifications.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">/// WARNING: This file knows about certain library functions. It recognizes them</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/// by name, and hardwires knowledge of their semantics.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">/// WARNING: This file knows about how certain Objective-C library functions are</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">/// used. Naive LLVM IR transformations which would otherwise be</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">/// behavior-preserving may break these assumptions.</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"></span><span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno"><a class="line" href="ObjCARCOpts_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   27</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;objc-arc-opts&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="lib_2Transforms_2ObjCARC_2ObjCARC_8h.html">ObjCARC.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ARCRuntimeEntryPoints_8h.html">ARCRuntimeEntryPoints.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DependencyAnalysis_8h.html">DependencyAnalysis.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ObjCARCAliasAnalysis_8h.html">ObjCARCAliasAnalysis.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ProvenanceAnalysis_8h.html">ProvenanceAnalysis.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseMap_8h.html">llvm/ADT/DenseMap.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseSet_8h.html">llvm/ADT/DenseSet.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallPtrSet_8h.html">llvm/ADT/SmallPtrSet.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IRBuilder_8h.html">llvm/IR/IRBuilder.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LLVMContext_8h.html">llvm/IR/LLVMContext.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Support_2CFG_8h.html">llvm/Support/CFG.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm_1_1objcarc.html">llvm::objcarc</a>;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">/// \defgroup MiscUtils Miscellaneous utilities that are not ARC specific.</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">/// @{</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">  /// \brief An associative container with fast insertion-order (deterministic)</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">  /// iteration over its elements. Plus the special blot operation.</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"></span>  <span class="keyword">template</span>&lt;<span class="keyword">class</span> KeyT, <span class="keyword">class</span> ValueT&gt;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keyword">class </span><a class="code" href="classllvm_1_1MapVector.html">MapVector</a> {<span class="comment"></span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">    /// Map keys to indices in Vector.</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"></span>    <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;KeyT, size_t&gt;</a> MapTy;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    MapTy Map;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keyword">typedef</span> std::vector&lt;std::pair&lt;KeyT, ValueT&gt; &gt; VectorTy;<span class="comment"></span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">    /// Keys and values.</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"></span>    VectorTy Vector;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keyword">typedef</span> <span class="keyword">typename</span> VectorTy::iterator iterator;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keyword">typedef</span> <span class="keyword">typename</span> VectorTy::const_iterator const_iterator;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    iterator <a class="code" href="namespacellvm_1_1sys_1_1path.html#a33706aab89e700b8f79e1fa6f4f0e3ee">begin</a>() { <span class="keywordflow">return</span> Vector.<a class="code" href="classllvm_1_1sys_1_1path_1_1const__iterator.html#a79fe46db1f88832bc90447c6ec541cf2">begin</a>(); }</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    iterator <a class="code" href="namespacellvm_1_1sys_1_1path.html#a214ec2f04ffd92636ed4bd2717607a1d">end</a>() { <span class="keywordflow">return</span> Vector.<a class="code" href="classllvm_1_1sys_1_1path_1_1const__iterator.html#a8a503d1cbee10d1b8c8f5ac2a03b90df">end</a>(); }</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    const_iterator <a class="code" href="namespacellvm_1_1sys_1_1path.html#a33706aab89e700b8f79e1fa6f4f0e3ee">begin</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Vector.<a class="code" href="classllvm_1_1sys_1_1path_1_1const__iterator.html#a79fe46db1f88832bc90447c6ec541cf2">begin</a>(); }</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    const_iterator <a class="code" href="namespacellvm_1_1sys_1_1path.html#a214ec2f04ffd92636ed4bd2717607a1d">end</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Vector.<a class="code" href="classllvm_1_1sys_1_1path_1_1const__iterator.html#a8a503d1cbee10d1b8c8f5ac2a03b90df">end</a>(); }</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#ifdef XDEBUG</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    ~<a class="code" href="classllvm_1_1MapVector.html">MapVector</a>() {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      assert(Vector.size() &gt;= Map.size()); <span class="comment">// May differ due to blotting.</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">typename</span> MapTy::const_iterator <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Map.begin(), E = Map.end();</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;           <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        assert(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second &lt; Vector.size());</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        assert(Vector[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second].first == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">typename</span> VectorTy::const_iterator <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Vector.begin(),</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;           E = Vector.end(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        assert(!<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first ||</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;               (Map.count(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first) &amp;&amp;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                Map[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first] == size_t(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> - Vector.begin())));</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    }</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    ValueT &amp;operator[](<span class="keyword">const</span> <a class="code" href="classKeyT.html">KeyT</a> &amp;Arg) {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      std::pair&lt;typename MapTy::iterator, bool&gt; Pair =</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        Map.insert(std::make_pair(Arg, <span class="keywordtype">size_t</span>(0)));</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <span class="keywordflow">if</span> (Pair.second) {</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordtype">size_t</span> Num = Vector.size();</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        Pair.first-&gt;second = Num;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        Vector.push_back(std::make_pair(Arg, ValueT()));</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keywordflow">return</span> Vector[Num].second;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="keywordflow">return</span> Vector[Pair.first-&gt;second].second;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    }</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    std::pair&lt;iterator, bool&gt;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    insert(<span class="keyword">const</span> std::pair&lt;KeyT, ValueT&gt; &amp;InsertPair) {</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      std::pair&lt;typename MapTy::iterator, bool&gt; Pair =</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        Map.insert(std::make_pair(InsertPair.first, <span class="keywordtype">size_t</span>(0)));</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      <span class="keywordflow">if</span> (Pair.second) {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keywordtype">size_t</span> Num = Vector.size();</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        Pair.first-&gt;second = Num;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        Vector.push_back(InsertPair);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keywordflow">return</span> std::make_pair(Vector.begin() + Num, <span class="keyword">true</span>);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="keywordflow">return</span> std::make_pair(Vector.begin() + Pair.first-&gt;second, <span class="keyword">false</span>);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    }</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    iterator find(<span class="keyword">const</span> <a class="code" href="classKeyT.html">KeyT</a> &amp;Key) {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <span class="keyword">typename</span> MapTy::iterator It = Map.find(Key);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      <span class="keywordflow">if</span> (It == Map.end()) <span class="keywordflow">return</span> Vector.end();</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <span class="keywordflow">return</span> Vector.begin() + It-&gt;second;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    }</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    const_iterator find(<span class="keyword">const</span> <a class="code" href="classKeyT.html">KeyT</a> &amp;Key)<span class="keyword"> const </span>{</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="keyword">typename</span> MapTy::const_iterator It = Map.find(Key);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keywordflow">if</span> (It == Map.end()) <span class="keywordflow">return</span> Vector.end();</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      <span class="keywordflow">return</span> Vector.begin() + It-&gt;second;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">    /// This is similar to erase, but instead of removing the element from the</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">    /// vector, it just zeros out the key in the vector. This leaves iterators</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">    /// intact, but clients must be prepared for zeroed-out keys when iterating.</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> blot(<span class="keyword">const</span> <a class="code" href="classKeyT.html">KeyT</a> &amp;Key) {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="keyword">typename</span> MapTy::iterator It = Map.find(Key);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="keywordflow">if</span> (It == Map.end()) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      Vector[It-&gt;second].first = <a class="code" href="classKeyT.html">KeyT</a>();</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      Map.erase(It);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordtype">void</span> clear() {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      Map.clear();</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      Vector.clear();</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    }</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  };</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;}</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">/// @}</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">/// \defgroup ARCUtilities Utility declarations/definitions specific to ARC.</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">/// @{</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"></span><span class="comment"></span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">/// \brief This is similar to StripPointerCastsAndObjCCalls but it stops as soon</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">/// as it finds a value with multiple uses.</span></div><div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="group__ARCUtilities.html#ga3e31fa79553c53df380d4054de2ca1c9">  148</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="group__ARCUtilities.html#ga3e31fa79553c53df380d4054de2ca1c9">FindSingleUseIdentifiedObject</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordflow">if</span> (Arg-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>()) {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BC = dyn_cast&lt;BitCastInst&gt;(Arg))</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="group__ARCUtilities.html#ga3e31fa79553c53df380d4054de2ca1c9">FindSingleUseIdentifiedObject</a>(BC-&gt;getOperand(0));</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEP = dyn_cast&lt;GetElementPtrInst&gt;(Arg))</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <span class="keywordflow">if</span> (GEP-&gt;hasAllZeroIndices())</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="group__ARCUtilities.html#ga3e31fa79553c53df380d4054de2ca1c9">FindSingleUseIdentifiedObject</a>(GEP-&gt;getPointerOperand());</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#a5da8c772f836519f6c891870ea5ef7b3">IsForwarding</a>(<a class="code" href="namespacellvm_1_1objcarc.html#aaa976a678f8297931857721e45e4803d">GetBasicInstructionClass</a>(Arg)))</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="group__ARCUtilities.html#ga3e31fa79553c53df380d4054de2ca1c9">FindSingleUseIdentifiedObject</a>(</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;               cast&lt;CallInst&gt;(Arg)-&gt;getArgOperand(0));</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1objcarc.html#a3e6b7918a169686d2131ad4bbaf201f3">IsObjCIdentifiedObject</a>(Arg))</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">return</span> Arg;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  }</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="comment">// If we found an identifiable object but it has multiple uses, but they are</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="comment">// trivial uses, we can still consider this to be a single-use value.</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#a3e6b7918a169686d2131ad4bbaf201f3">IsObjCIdentifiedObject</a>(Arg)) {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::const_use_iterator</a> UI = Arg-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), UE = Arg-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;         UI != UE; ++UI) {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1User.html">User</a> *U = *UI;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="keywordflow">if</span> (!U-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>() || <a class="code" href="namespacellvm_1_1objcarc.html#a85502898d19c32629e2e17fe94f34985">StripPointerCastsAndObjCCalls</a>(U) != Arg)</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    }</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">return</span> Arg;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;}</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">/// This is a wrapper around getUnderlyingObjCPtr along the lines of</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">/// GetUnderlyingObjects except that it returns early when it sees the first</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">/// alloca.</span></div><div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="group__ARCUtilities.html#ga0ea9cd5bf9acb5ded710efad514f139f">  182</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="group__ARCUtilities.html#ga0ea9cd5bf9acb5ded710efad514f139f">AreAnyUnderlyingObjectsAnAlloca</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const Value *, 4&gt;</a> Visited;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const Value *, 4&gt;</a> Worklist;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(V);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    P = <a class="code" href="namespacellvm_1_1objcarc.html#a573c7794ec488e927f074ba8a4647380">GetUnderlyingObjCPtr</a>(P);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">if</span> (isa&lt;AllocaInst&gt;(P))</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">if</span> (!Visited.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(P))</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *SI = dyn_cast&lt;const SelectInst&gt;(P)) {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SI-&gt;getTrueValue());</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SI-&gt;getFalseValue());</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;const PHINode&gt;(P)) {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PN-&gt;getNumIncomingValues(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(PN-&gt;getIncomingValue(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    }</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  } <span class="keywordflow">while</span> (!Worklist.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>());</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;}</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">/// @}</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">/// \defgroup ARCOpt ARC Optimization.</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">/// @{</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">// TODO: On code like this:</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">// objc_retain(%x)</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">// stuff_that_cannot_release()</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">// objc_autorelease(%x)</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">// stuff_that_cannot_release()</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">// objc_retain(%x)</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">// stuff_that_cannot_release()</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">// objc_autorelease(%x)</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">// The second retain and autorelease can be deleted.</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">// TODO: It should be possible to delete</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">// objc_autoreleasePoolPush and objc_autoreleasePoolPop</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">// pairs if nothing is actually autoreleased between them. Also, autorelease</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">// calls followed by objc_autoreleasePoolPop calls (perhaps in ObjC++ code</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">// after inlining) can be turned into plain release calls.</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">// TODO: Critical-edge splitting. If the optimial insertion point is</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">// a critical edge, the current algorithm has to fail, because it doesn&#39;t</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">// know how to split edges. It should be possible to make the optimizer</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">// think in terms of edges, rather than blocks, and then split critical</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">// edges on demand.</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">// TODO: OptimizeSequences could generalized to be Interprocedural.</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">// TODO: Recognize that a bunch of other objc runtime calls have</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">// non-escaping arguments and non-releasing arguments, and may be</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">// non-autoreleasing.</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">// TODO: Sink autorelease calls as far as possible. Unfortunately we</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">// usually can&#39;t sink them past other calls, which would be the main</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">// case where it would be useful.</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">// TODO: The pointer returned from objc_loadWeakRetained is retained.</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">// TODO: Delete release+retain pairs (rare).</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<a class="code" href="group__ARCOpt.html#ga904bef748519b92d799b4589ebfc51a8">STATISTIC</a>(NumNoops,       <span class="stringliteral">&quot;Number of no-op objc calls eliminated&quot;</span>);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<a class="code" href="group__ARCOpt.html#ga904bef748519b92d799b4589ebfc51a8">STATISTIC</a>(NumPartialNoops, <span class="stringliteral">&quot;Number of partially no-op objc calls eliminated&quot;</span>);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<a class="code" href="group__ARCOpt.html#ga904bef748519b92d799b4589ebfc51a8">STATISTIC</a>(NumAutoreleases,<span class="stringliteral">&quot;Number of autoreleases converted to releases&quot;</span>);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<a class="code" href="group__ARCOpt.html#ga904bef748519b92d799b4589ebfc51a8">STATISTIC</a>(NumRets,        <span class="stringliteral">&quot;Number of return value forwarding &quot;</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                          <span class="stringliteral">&quot;retain+autoreleases eliminated&quot;</span>);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<a class="code" href="group__ARCOpt.html#ga904bef748519b92d799b4589ebfc51a8">STATISTIC</a>(NumRRs,         <span class="stringliteral">&quot;Number of retain+release paths eliminated&quot;</span>);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<a class="code" href="group__ARCOpt.html#ga904bef748519b92d799b4589ebfc51a8">STATISTIC</a>(NumPeeps,       <span class="stringliteral">&quot;Number of calls peephole-optimized&quot;</span>);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<a class="code" href="group__ARCOpt.html#ga904bef748519b92d799b4589ebfc51a8">STATISTIC</a>(NumRetainsBeforeOpt,</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;          <span class="stringliteral">&quot;Number of retains before optimization&quot;</span>);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<a class="code" href="group__ARCOpt.html#ga904bef748519b92d799b4589ebfc51a8">STATISTIC</a>(NumReleasesBeforeOpt,</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;          <span class="stringliteral">&quot;Number of releases before optimization&quot;</span>);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<a class="code" href="group__ARCOpt.html#ga904bef748519b92d799b4589ebfc51a8">STATISTIC</a>(NumRetainsAfterOpt,</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;          <span class="stringliteral">&quot;Number of retains after optimization&quot;</span>);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<a class="code" href="group__ARCOpt.html#ga904bef748519b92d799b4589ebfc51a8">STATISTIC</a>(NumReleasesAfterOpt,</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;          <span class="stringliteral">&quot;Number of releases after optimization&quot;</span>);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">  /// \enum Sequence</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">  /// \brief A sequence of states that a pointer may go through in which an</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">  /// objc_retain and objc_release are actually needed.</span></div><div class="line"><a name="l00279"></a><span class="lineno"><a class="line" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">  279</a></span>&#160;<span class="comment"></span>  <span class="keyword">enum</span> <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    S_None,</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    S_Retain,         <span class="comment">///&lt; objc_retain(x).</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment"></span>    S_CanRelease,     <span class="comment">///&lt; foo(x) -- x could possibly see a ref count decrement.</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment"></span>    S_Use,            <span class="comment">///&lt; any use of x.</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment"></span>    S_Stop,           <span class="comment">///&lt; like S_Release, but code motion is stopped.</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment"></span>    S_Release,        <span class="comment">///&lt; objc_release(x).</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment"></span>    S_MovableRelease  <span class="comment">///&lt; objc_release(x), !clang.imprecise_release.</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment"></span>  };</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="namespacellvm_1_1objcarc.html#ad19ebfc50df266d6f4062104ac48933c">operator&lt;&lt;</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS, <span class="keyword">const</span> <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> <a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>)</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="Compiler_8h.html#acc1c483f4b4ee2f17bb6643a3b353609">LLVM_ATTRIBUTE_UNUSED</a>;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;<a class="code" href="namespacellvm_1_1objcarc.html#ad19ebfc50df266d6f4062104ac48933c">operator&lt;&lt;</a>(<a class="code" href="classllvm_1_1raw__ostream.html">raw_ostream</a> &amp;OS, <span class="keyword">const</span> <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> S) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">switch</span> (S) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">case</span> S_None:</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordflow">return</span> OS &lt;&lt; <span class="stringliteral">&quot;S_None&quot;</span>;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">case</span> S_Retain:</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="keywordflow">return</span> OS &lt;&lt; <span class="stringliteral">&quot;S_Retain&quot;</span>;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">case</span> S_CanRelease:</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="keywordflow">return</span> OS &lt;&lt; <span class="stringliteral">&quot;S_CanRelease&quot;</span>;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">case</span> S_Use:</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="keywordflow">return</span> OS &lt;&lt; <span class="stringliteral">&quot;S_Use&quot;</span>;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">case</span> S_Release:</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="keywordflow">return</span> OS &lt;&lt; <span class="stringliteral">&quot;S_Release&quot;</span>;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">case</span> S_MovableRelease:</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="keywordflow">return</span> OS &lt;&lt; <span class="stringliteral">&quot;S_MovableRelease&quot;</span>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">case</span> S_Stop:</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="keywordflow">return</span> OS &lt;&lt; <span class="stringliteral">&quot;S_Stop&quot;</span>;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    }</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unknown sequence type.&quot;</span>);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;}</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#ga01c7014451484f9784e68d42412d1b9c">  312</a></span>&#160;<span class="keyword">static</span> <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> <a class="code" href="group__ARCOpt.html#ga01c7014451484f9784e68d42412d1b9c">MergeSeqs</a>(<a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> <a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>, <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> <a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a>, <span class="keywordtype">bool</span> TopDown) {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="comment">// The easy cases.</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordflow">if</span> (A == B)</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordflow">if</span> (A == S_None || B == S_None)</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">return</span> S_None;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordflow">if</span> (A &gt; B) <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(A, B);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="keywordflow">if</span> (TopDown) {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">// Choose the side which is further along in the sequence.</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">if</span> ((A == S_Retain || A == S_CanRelease) &amp;&amp;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        (B == S_CanRelease || B == S_Use))</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a>;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">// Choose the side which is further along in the sequence.</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">if</span> ((A == S_Use || A == S_CanRelease) &amp;&amp;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        (B == S_Use || B == S_Release || B == S_Stop || B == S_MovableRelease))</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">// If both sides are releases, choose the more conservative one.</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordflow">if</span> (A == S_Stop &amp;&amp; (B == S_Release || B == S_MovableRelease))</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordflow">if</span> (A == S_Release &amp;&amp; B == S_MovableRelease)</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keywordflow">return</span> S_None;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;}</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">  /// \brief Unidirectional information about either a</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">  /// retain-decrement-use-release sequence or release-use-decrement-retain</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">  /// reverse sequence.</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span>RRInfo {<span class="comment"></span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">    /// After an objc_retain, the reference count of the referenced</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">    /// object is known to be positive. Similarly, before an objc_release, the</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">    /// reference count of the referenced object is known to be positive. If</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">    /// there are retain-release pairs in code regions where the retain count</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">    /// is known to be positive, they can be eliminated, regardless of any side</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">    /// effects between them.</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">    ///</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">    /// Also, a retain+release pair nested within another retain+release</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">    /// pair all on the known same pointer value can be eliminated, regardless</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">    /// of any intervening side effects.</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">    ///</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">    /// KnownSafe is true when either of these conditions is satisfied.</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> KnownSafe;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">    /// True of the objc_release calls are all marked with the &quot;tail&quot; keyword.</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> IsTailCallRelease;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">    /// If the Calls are objc_release calls and they all have a</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">    /// clang.imprecise_release tag, this is the metadata tag.</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *ReleaseMetadata;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">    /// For a top-down sequence, the set of objc_retains or</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">    /// objc_retainBlocks. For bottom-up, the set of objc_releases.</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 2&gt;</a> Calls;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">    /// The set of optimal insert positions for moving calls in the opposite</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">    /// sequence.</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 2&gt;</a> ReverseInsertPts;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">    /// If this is true, we cannot perform code motion but can still remove</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">    /// retain/release pairs.</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> CFGHazardAfflicted;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    RRInfo() :</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      KnownSafe(<span class="keyword">false</span>), IsTailCallRelease(<span class="keyword">false</span>), ReleaseMetadata(0),</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      CFGHazardAfflicted(<span class="keyword">false</span>) {}</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordtype">void</span> clear();</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">    /// Conservatively merge the two RRInfo. Returns true if a partial merge has</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">    /// occured, false otherwise.</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> Merge(<span class="keyword">const</span> RRInfo &amp;Other);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  };</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;}</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="keywordtype">void</span> RRInfo::clear() {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  KnownSafe = <span class="keyword">false</span>;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  IsTailCallRelease = <span class="keyword">false</span>;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  ReleaseMetadata = 0;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  Calls.clear();</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  ReverseInsertPts.clear();</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  CFGHazardAfflicted = <span class="keyword">false</span>;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;}</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="keywordtype">bool</span> RRInfo::Merge(<span class="keyword">const</span> RRInfo &amp;Other) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">// Conservatively merge the ReleaseMetadata information.</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">if</span> (ReleaseMetadata != Other.ReleaseMetadata)</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      ReleaseMetadata = 0;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="comment">// Conservatively merge the boolean state.</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    KnownSafe &amp;= Other.KnownSafe;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    IsTailCallRelease &amp;= Other.IsTailCallRelease;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    CFGHazardAfflicted |= Other.CFGHazardAfflicted;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="comment">// Merge the call sets.</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    Calls.insert(Other.Calls.begin(), Other.Calls.end());</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="comment">// Merge the insert point sets. If there are any differences,</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="comment">// that makes this a partial merge.</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordtype">bool</span> Partial = ReverseInsertPts.size() != Other.ReverseInsertPts.size();</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;Instruction *, 2&gt;::const_iterator</a></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;         <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Other.ReverseInsertPts.begin(),</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;         E = Other.ReverseInsertPts.end(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      Partial |= ReverseInsertPts.insert(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keywordflow">return</span> Partial;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;}</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">  /// \brief This class summarizes several per-pointer runtime properties which</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">  /// are propogated through the flow graph.</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>PtrState {<span class="comment"></span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">    /// True if the reference count is known to be incremented.</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> KnownPositiveRefCount;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">    /// True if we&#39;ve seen an opportunity for partial RR elimination, such as</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">    /// pushing calls into a CFG triangle or into one side of a CFG diamond.</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> Partial;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">    /// The current position in the sequence.</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> Seq : 8;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">    /// Unidirectional information about the current sequence.</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment"></span>    RRInfo RRI;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    PtrState() : KnownPositiveRefCount(<span class="keyword">false</span>), Partial(<span class="keyword">false</span>),</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                 Seq(S_None) {}</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordtype">bool</span> IsKnownSafe()<span class="keyword"> const </span>{</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <span class="keywordflow">return</span> RRI.KnownSafe;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    }</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordtype">void</span> SetKnownSafe(<span class="keyword">const</span> <span class="keywordtype">bool</span> NewValue) {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      RRI.KnownSafe = NewValue;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    }</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordtype">bool</span> IsTailCallRelease()<span class="keyword"> const </span>{</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="keywordflow">return</span> RRI.IsTailCallRelease;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    }</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordtype">void</span> SetTailCallRelease(<span class="keyword">const</span> <span class="keywordtype">bool</span> NewValue) {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      RRI.IsTailCallRelease = NewValue;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    }</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordtype">bool</span> IsTrackingImpreciseReleases()<span class="keyword"> const </span>{</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      <span class="keywordflow">return</span> RRI.ReleaseMetadata != 0;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *GetReleaseMetadata()<span class="keyword"> const </span>{</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <span class="keywordflow">return</span> RRI.ReleaseMetadata;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    }</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordtype">void</span> SetReleaseMetadata(<a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *NewValue) {</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      RRI.ReleaseMetadata = NewValue;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    }</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordtype">bool</span> IsCFGHazardAfflicted()<span class="keyword"> const </span>{</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <span class="keywordflow">return</span> RRI.CFGHazardAfflicted;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    }</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordtype">void</span> SetCFGHazardAfflicted(<span class="keyword">const</span> <span class="keywordtype">bool</span> NewValue) {</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      RRI.CFGHazardAfflicted = NewValue;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    }</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordtype">void</span> SetKnownPositiveRefCount() {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Setting Known Positive.\n&quot;</span>);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      KnownPositiveRefCount = <span class="keyword">true</span>;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordtype">void</span> ClearKnownPositiveRefCount() {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Clearing Known Positive.\n&quot;</span>);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      KnownPositiveRefCount = <span class="keyword">false</span>;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    }</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordtype">bool</span> HasKnownPositiveRefCount()<span class="keyword"> const </span>{</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <span class="keywordflow">return</span> KnownPositiveRefCount;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    }</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordtype">void</span> SetSeq(<a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> NewSeq) {</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Old: &quot;</span> &lt;&lt; Seq &lt;&lt; <span class="stringliteral">&quot;; New: &quot;</span> &lt;&lt; NewSeq &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      Seq = NewSeq;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    }</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> GetSeq()<span class="keyword"> const </span>{</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a><span class="keyword">&gt;</span>(Seq);</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    }</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordtype">void</span> ClearSequenceProgress() {</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      ResetSequenceProgress(S_None);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    }</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordtype">void</span> ResetSequenceProgress(<a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> NewSeq) {</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Resetting sequence progress.\n&quot;</span>);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      SetSeq(NewSeq);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      Partial = <span class="keyword">false</span>;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      RRI.clear();</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    }</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordtype">void</span> Merge(<span class="keyword">const</span> PtrState &amp;Other, <span class="keywordtype">bool</span> TopDown);</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordtype">void</span> InsertCall(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      RRI.Calls.insert(I);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordtype">void</span> InsertReverseInsertPt(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I) {</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      RRI.ReverseInsertPts.insert(I);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    }</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordtype">void</span> ClearReverseInsertPts() {</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      RRI.ReverseInsertPts.clear();</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    }</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordtype">bool</span> HasReverseInsertPts()<span class="keyword"> const </span>{</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="keywordflow">return</span> !RRI.ReverseInsertPts.empty();</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    }</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keyword">const</span> RRInfo &amp;GetRRInfo()<span class="keyword"> const </span>{</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <span class="keywordflow">return</span> RRI;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    }</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  };</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;}</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;PtrState::Merge(<span class="keyword">const</span> PtrState &amp;Other, <span class="keywordtype">bool</span> TopDown) {</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  Seq = <a class="code" href="group__ARCOpt.html#ga01c7014451484f9784e68d42412d1b9c">MergeSeqs</a>(static_cast&lt;Sequence&gt;(Seq), static_cast&lt;Sequence&gt;(Other.Seq),</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                  TopDown);</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  KnownPositiveRefCount &amp;= Other.KnownPositiveRefCount;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="comment">// If we&#39;re not in a sequence (anymore), drop all associated state.</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="keywordflow">if</span> (Seq == S_None) {</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    Partial = <span class="keyword">false</span>;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    RRI.clear();</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Partial || Other.Partial) {</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="comment">// If we&#39;re doing a merge on a path that&#39;s previously seen a partial</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="comment">// merge, conservatively drop the sequence, to avoid doing partial</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="comment">// RR elimination. If the branch predicates for the two merge differ,</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="comment">// mixing them is unsafe.</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    ClearSequenceProgress();</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="comment">// Otherwise merge the other PtrState&#39;s RRInfo into our RRInfo. At this</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="comment">// point, we know that currently we are not partial. Stash whether or not</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">// the merge operation caused us to undergo a partial merging of reverse</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="comment">// insertion points.</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    Partial = RRI.Merge(Other.RRI);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;}</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">  /// \brief Per-BasicBlock state.</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>BBState {<span class="comment"></span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">    /// The number of unique control paths from the entry which can reach this</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">    /// block.</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> TopDownPathCount;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">    /// The number of unique control paths to exits from this block.</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> BottomUpPathCount;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">    /// A type for PerPtrTopDown and PerPtrBottomUp.</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment"></span>    <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;const Value *, PtrState&gt;</a> MapTy;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">    /// The top-down traversal uses this to record information known about a</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">    /// pointer at the bottom of each block.</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment"></span>    MapTy PerPtrTopDown;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">    /// The bottom-up traversal uses this to record information known about a</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">    /// pointer at the top of each block.</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment"></span>    MapTy PerPtrBottomUp;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">    /// Effective predecessors of the current block ignoring ignorable edges and</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">    /// ignored backedges.</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 2&gt;</a> Preds;<span class="comment"></span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">    /// Effective successors of the current block ignoring ignorable edges and</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">    /// ignored backedges.</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 2&gt;</a> Succs;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> OverflowOccurredValue;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    BBState() : TopDownPathCount(0), BottomUpPathCount(0) { }</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keyword">typedef</span> MapTy::iterator ptr_iterator;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keyword">typedef</span> MapTy::const_iterator ptr_const_iterator;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    ptr_iterator top_down_ptr_begin() { <span class="keywordflow">return</span> PerPtrTopDown.begin(); }</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    ptr_iterator top_down_ptr_end() { <span class="keywordflow">return</span> PerPtrTopDown.end(); }</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    ptr_const_iterator top_down_ptr_begin()<span class="keyword"> const </span>{</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="keywordflow">return</span> PerPtrTopDown.begin();</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    }</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    ptr_const_iterator top_down_ptr_end()<span class="keyword"> const </span>{</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <span class="keywordflow">return</span> PerPtrTopDown.end();</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    }</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    ptr_iterator bottom_up_ptr_begin() { <span class="keywordflow">return</span> PerPtrBottomUp.begin(); }</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    ptr_iterator bottom_up_ptr_end() { <span class="keywordflow">return</span> PerPtrBottomUp.end(); }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    ptr_const_iterator bottom_up_ptr_begin()<span class="keyword"> const </span>{</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="keywordflow">return</span> PerPtrBottomUp.begin();</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    }</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    ptr_const_iterator bottom_up_ptr_end()<span class="keyword"> const </span>{</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      <span class="keywordflow">return</span> PerPtrBottomUp.end();</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    }</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment">    /// Mark this block as being an entry block, which has one path from the</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment">    /// entry by definition.</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> SetAsEntry() { TopDownPathCount = 1; }</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">    /// Mark this block as being an exit block, which has one path to an exit by</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">    /// definition.</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> SetAsExit()  { BottomUpPathCount = 1; }</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">    /// Attempt to find the PtrState object describing the top down state for</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">    /// pointer Arg. Return a new initialized PtrState describing the top down</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">    /// state for Arg if we do not find one.</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment"></span>    PtrState &amp;getPtrTopDownState(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg) {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="keywordflow">return</span> PerPtrTopDown[Arg];</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    }</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">    /// Attempt to find the PtrState object describing the bottom up state for</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">    /// pointer Arg. Return a new initialized PtrState describing the bottom up</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">    /// state for Arg if we do not find one.</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment"></span>    PtrState &amp;getPtrBottomUpState(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg) {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="keywordflow">return</span> PerPtrBottomUp[Arg];</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    }</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment">    /// Attempt to find the PtrState object describing the bottom up state for</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">    /// pointer Arg.</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment"></span>    ptr_iterator findPtrBottomUpState(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg) {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      <span class="keywordflow">return</span> PerPtrBottomUp.find(Arg);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    }</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordtype">void</span> clearBottomUpPointers() {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      PerPtrBottomUp.clear();</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    }</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordtype">void</span> clearTopDownPointers() {</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      PerPtrTopDown.clear();</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    }</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordtype">void</span> InitFromPred(<span class="keyword">const</span> BBState &amp;Other);</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordtype">void</span> InitFromSucc(<span class="keyword">const</span> BBState &amp;Other);</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordtype">void</span> MergePred(<span class="keyword">const</span> BBState &amp;Other);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordtype">void</span> MergeSucc(<span class="keyword">const</span> BBState &amp;Other);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment">    /// Compute the number of possible unique paths from an entry to an exit</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">    /// which pass through this block. This is only valid after both the</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">    /// top-down and bottom-up traversals are complete.</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">    ///</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">    /// Returns true if overflow occured. Returns false if overflow did not</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">    /// occur.</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> GetAllPathCountWithOverflow(<span class="keywordtype">unsigned</span> &amp;PathCount)<span class="keyword"> const </span>{</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="keywordflow">if</span> (TopDownPathCount == OverflowOccurredValue ||</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;          BottomUpPathCount == OverflowOccurredValue)</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> Product =</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> long)TopDownPathCount*BottomUpPathCount;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="comment">// Overflow occured if any of the upper bits of Product are set or if all</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      <span class="comment">// the lower bits of Product are all set.</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      <span class="keywordflow">return</span> (Product &gt;&gt; 32) ||</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;             ((PathCount = Product) == OverflowOccurredValue);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    }</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="comment">// Specialized CFG utilities.</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;BasicBlock *&gt;::const_iterator</a> edge_iterator;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    edge_iterator <a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Preds.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(); }</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    edge_iterator <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Preds.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); }</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    edge_iterator <a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Succs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(); }</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    edge_iterator <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Succs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); }</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordtype">void</span> addSucc(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ) { Succs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Succ); }</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordtype">void</span> addPred(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred) { Preds.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Pred); }</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordtype">bool</span> isExit()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Succs.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>(); }</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  };</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> BBState::OverflowOccurredValue = 0xffffffff;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;}</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="keywordtype">void</span> BBState::InitFromPred(<span class="keyword">const</span> BBState &amp;Other) {</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  PerPtrTopDown = Other.PerPtrTopDown;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  TopDownPathCount = Other.TopDownPathCount;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;}</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="keywordtype">void</span> BBState::InitFromSucc(<span class="keyword">const</span> BBState &amp;Other) {</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  PerPtrBottomUp = Other.PerPtrBottomUp;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  BottomUpPathCount = Other.BottomUpPathCount;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;}</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">/// The top-down traversal uses this to merge information about predecessors to</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">/// form the initial state for a new block.</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> BBState::MergePred(<span class="keyword">const</span> BBState &amp;Other) {</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="keywordflow">if</span> (TopDownPathCount == OverflowOccurredValue)</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="comment">// Other.TopDownPathCount can be 0, in which case it is either dead or a</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <span class="comment">// loop backedge. Loop backedges are special.</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  TopDownPathCount += Other.TopDownPathCount;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="comment">// In order to be consistent, we clear the top down pointers when by adding</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="comment">// TopDownPathCount becomes OverflowOccurredValue even though &quot;true&quot; overflow</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="comment">// has not occured.</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="keywordflow">if</span> (TopDownPathCount == OverflowOccurredValue) {</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    clearTopDownPointers();</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  }</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="comment">// Check for overflow. If we have overflow, fall back to conservative</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="comment">// behavior.</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keywordflow">if</span> (TopDownPathCount &lt; Other.TopDownPathCount) {</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    TopDownPathCount = OverflowOccurredValue;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    clearTopDownPointers();</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  }</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="comment">// For each entry in the other set, if our set has an entry with the same key,</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <span class="comment">// merge the entries. Otherwise, copy the entry and merge it with an empty</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <span class="comment">// entry.</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="keywordflow">for</span> (ptr_const_iterator <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> = Other.top_down_ptr_begin(),</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;       ME = Other.top_down_ptr_end(); <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> != ME; ++<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>) {</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    std::pair&lt;ptr_iterator, bool&gt; Pair = PerPtrTopDown.insert(*<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>);</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    Pair.first-&gt;second.Merge(Pair.second ? PtrState() : <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>-&gt;second,</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                             <span class="comment">/*TopDown=*/</span><span class="keyword">true</span>);</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  }</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="comment">// For each entry in our set, if the other set doesn&#39;t have an entry with the</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="comment">// same key, force it to merge with an empty entry.</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <span class="keywordflow">for</span> (ptr_iterator <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> = top_down_ptr_begin(),</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;       ME = top_down_ptr_end(); <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> != ME; ++<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>)</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="keywordflow">if</span> (Other.PerPtrTopDown.find(<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>-&gt;first) == Other.PerPtrTopDown.end())</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>-&gt;second.Merge(PtrState(), <span class="comment">/*TopDown=*/</span><span class="keyword">true</span>);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;}</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="comment">/// The bottom-up traversal uses this to merge information about successors to</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment">/// form the initial state for a new block.</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> BBState::MergeSucc(<span class="keyword">const</span> BBState &amp;Other) {</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="keywordflow">if</span> (BottomUpPathCount == OverflowOccurredValue)</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="comment">// Other.BottomUpPathCount can be 0, in which case it is either dead or a</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="comment">// loop backedge. Loop backedges are special.</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  BottomUpPathCount += Other.BottomUpPathCount;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="comment">// In order to be consistent, we clear the top down pointers when by adding</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="comment">// BottomUpPathCount becomes OverflowOccurredValue even though &quot;true&quot; overflow</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="comment">// has not occured.</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="keywordflow">if</span> (BottomUpPathCount == OverflowOccurredValue) {</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    clearBottomUpPointers();</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  }</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="comment">// Check for overflow. If we have overflow, fall back to conservative</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <span class="comment">// behavior.</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="keywordflow">if</span> (BottomUpPathCount &lt; Other.BottomUpPathCount) {</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    BottomUpPathCount = OverflowOccurredValue;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    clearBottomUpPointers();</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  }</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="comment">// For each entry in the other set, if our set has an entry with the</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="comment">// same key, merge the entries. Otherwise, copy the entry and merge</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="comment">// it with an empty entry.</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="keywordflow">for</span> (ptr_const_iterator <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> = Other.bottom_up_ptr_begin(),</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;       ME = Other.bottom_up_ptr_end(); <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> != ME; ++<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>) {</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    std::pair&lt;ptr_iterator, bool&gt; Pair = PerPtrBottomUp.insert(*<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>);</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    Pair.first-&gt;second.Merge(Pair.second ? PtrState() : <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>-&gt;second,</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                             <span class="comment">/*TopDown=*/</span><span class="keyword">false</span>);</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  }</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="comment">// For each entry in our set, if the other set doesn&#39;t have an entry</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <span class="comment">// with the same key, force it to merge with an empty entry.</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <span class="keywordflow">for</span> (ptr_iterator <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> = bottom_up_ptr_begin(),</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;       ME = bottom_up_ptr_end(); <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> != ME; ++<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>)</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keywordflow">if</span> (Other.PerPtrBottomUp.find(<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>-&gt;first) == Other.PerPtrBottomUp.end())</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>-&gt;second.Merge(PtrState(), <span class="comment">/*TopDown=*/</span><span class="keyword">false</span>);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;}</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment">// Only enable ARC Annotations if we are building a debug version of</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">// libObjCARCOpts.</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l00794"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#ga676b04872d6e54646a848e9f09732fb9">  794</a></span>&#160;<span class="preprocessor">#define ARC_ANNOTATIONS</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment">// Define some macros along the lines of DEBUG and some helper functions to make</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment">// it cleaner to create annotations in the source code and to no-op when not</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">// building in debug mode.</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="preprocessor">#ifdef ARC_ANNOTATIONS</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommandLine_8h.html">llvm/Support/CommandLine.h</a>&quot;</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="comment">/// Enable/disable ARC sequence annotations.</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<a class="code" href="group__ARCOpt.html#ga4320fed90984fab278ec601fb74c5dfe">EnableARCAnnotations</a>(<span class="stringliteral">&quot;enable-objc-arc-annotations&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                     <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Enable emission of arc data flow analysis &quot;</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                              <span class="stringliteral">&quot;annotations&quot;</span>));</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;bool&gt;</a></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<a class="code" href="group__ARCOpt.html#ga8ad945d6af5e5e566ce8fa704e617de3">DisableCheckForCFGHazards</a>(<span class="stringliteral">&quot;disable-objc-arc-checkforcfghazards&quot;</span>, <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="keyword">false</span>),</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                          <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;Disable check for cfg hazards when &quot;</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                                   <span class="stringliteral">&quot;annotating&quot;</span>));</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1cl_1_1opt.html">cl::opt&lt;std::string&gt;</a></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<a class="code" href="group__ARCOpt.html#gaf161d85830fb7b3acabeefce31e112ac">ARCAnnotationTargetIdentifier</a>(<span class="stringliteral">&quot;objc-arc-annotation-target-identifier&quot;</span>,</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                              <a class="code" href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">cl::init</a>(<span class="stringliteral">&quot;&quot;</span>),</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                              <a class="code" href="structllvm_1_1cl_1_1desc.html">cl::desc</a>(<span class="stringliteral">&quot;filter out all data flow annotations &quot;</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                                       <span class="stringliteral">&quot;but those that apply to the given &quot;</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                                       <span class="stringliteral">&quot;target llvm identifier.&quot;</span>));</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">/// This function appends a unique ARCAnnotationProvenanceSourceMDKind id to an</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="comment">/// instruction so that we can track backwards when post processing via the llvm</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment">/// arc annotation processor tool. If the function is an</span></div><div class="line"><a name="l00823"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#ga2b898cab6afd53d4c51bbc644ae3e7eb">  823</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1MDString.html">MDString</a> *<a class="code" href="group__ARCOpt.html#ga2b898cab6afd53d4c51bbc644ae3e7eb">AppendMDNodeToSourcePtr</a>(<span class="keywordtype">unsigned</span> NodeId,</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                                         <a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr) {</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  <a class="code" href="classllvm_1_1MDString.html">MDString</a> *Hash = 0;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="comment">// If pointer is a result of an instruction and it does not have a source</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="comment">// MDNode it, attach a new MDNode onto it. If pointer is a result of</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="comment">// an instruction and does have a source MDNode attached to it, return a</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="comment">// reference to said Node. Otherwise just return 0.</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = dyn_cast&lt;Instruction&gt;(Ptr)) {</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *Node;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keywordflow">if</span> (!(Node = Inst-&gt;getMetadata(NodeId))) {</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      <span class="comment">// We do not have any node. Generate and attatch the hash MDString to the</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="comment">// instruction.</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      <span class="comment">// We just use an MDString to ensure that this metadata gets written out</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      <span class="comment">// of line at the module level and to provide a very simple format</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <span class="comment">// encoding the information herein. Both of these makes it simpler to</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      <span class="comment">// parse the annotations by a simple external program.</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      std::string Str;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      <a class="code" href="classllvm_1_1raw__string__ostream.html">raw_string_ostream</a> os(Str);</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; Inst-&gt;getParent()-&gt;getParent()-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;,%&quot;</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;         &lt;&lt; Inst-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      Hash = <a class="code" href="classllvm_1_1MDString.html#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Inst-&gt;getContext(), os.<a class="code" href="classllvm_1_1raw__string__ostream.html#ae086260f8c216554ff46dcd96e171459">str</a>());</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      Inst-&gt;setMetadata(NodeId, <a class="code" href="classllvm_1_1MDNode.html#ad66ceb4f77078b084e527a19baab19d6">MDNode::get</a>(Inst-&gt;getContext(),Hash));</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      <span class="comment">// We have a node. Grab its hash and return it.</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      assert(Node-&gt;<a class="code" href="classllvm_1_1MDNode.html#ade17b50e4f0b835cd9eb58dffe12a90d">getNumOperands</a>() == 1 &amp;&amp;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <span class="stringliteral">&quot;An ARCAnnotationProvenanceSourceMDKind can only have 1 operand.&quot;</span>);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      Hash = cast&lt;MDString&gt;(Node-&gt;<a class="code" href="classllvm_1_1MDNode.html#adb91929f939ff02dbee552d32afaf4e6">getOperand</a>(0));</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    }</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Argument.html">Argument</a> *Arg = dyn_cast&lt;Argument&gt;(Ptr)) {</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    std::string str;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <a class="code" href="classllvm_1_1raw__string__ostream.html">raw_string_ostream</a> os(str);</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; Arg-&gt;getParent()-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;,%&quot;</span> &lt;&lt; Arg-&gt;getName()</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    Hash = <a class="code" href="classllvm_1_1MDString.html#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Arg-&gt;getContext(), os.<a class="code" href="classllvm_1_1raw__string__ostream.html#ae086260f8c216554ff46dcd96e171459">str</a>());</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  }</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="keywordflow">return</span> Hash;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;}</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#ga577d1729941a8a5903686ba11161aa7e">  865</a></span>&#160;<span class="keyword">static</span> std::string <a class="code" href="group__ARCOpt.html#ga577d1729941a8a5903686ba11161aa7e">SequenceToString</a>(<a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> <a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>) {</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  std::string str;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <a class="code" href="classllvm_1_1raw__string__ostream.html">raw_string_ostream</a> os(str);</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  os &lt;&lt; <a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="keywordflow">return</span> os.<a class="code" href="classllvm_1_1raw__string__ostream.html#ae086260f8c216554ff46dcd96e171459">str</a>();</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;}</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment">/// Helper function to change a Sequence into a String object using our overload</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">/// for raw_ostream so we only have printing code in one location.</span></div><div class="line"><a name="l00874"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#ga122c942371ff8ca7a7d9904d706f10c9">  874</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1MDString.html">MDString</a> *<a class="code" href="group__ARCOpt.html#ga122c942371ff8ca7a7d9904d706f10c9">SequenceToMDString</a>(<a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Context,</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                                    <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> <a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>) {</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1MDString.html#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Context, <a class="code" href="group__ARCOpt.html#ga577d1729941a8a5903686ba11161aa7e">SequenceToString</a>(A));</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;}</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="comment">/// A simple function to generate a MDNode which describes the change in state</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment">/// for Value *Ptr caused by Instruction *Inst.</span></div><div class="line"><a name="l00881"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#gae5a7eeb1b77c0ad38f27bb76e943743e">  881</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__ARCOpt.html#gae5a7eeb1b77c0ad38f27bb76e943743e">AppendMDNodeToInstForPtr</a>(<span class="keywordtype">unsigned</span> NodeId,</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                                     <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst,</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                                     <a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr,</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                                     <a class="code" href="classllvm_1_1MDString.html">MDString</a> *PtrSourceMDNodeID,</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                                     <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> OldSeq,</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                                     <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> NewSeq) {</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *Node = 0;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="Target_2X86_2README_8txt.html#a82bd4f4b721c049035c0d86cc261eadd">tmp</a>[3] = {PtrSourceMDNodeID,</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                   <a class="code" href="group__ARCOpt.html#ga122c942371ff8ca7a7d9904d706f10c9">SequenceToMDString</a>(Inst-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(),</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                                      OldSeq),</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                   <a class="code" href="group__ARCOpt.html#ga122c942371ff8ca7a7d9904d706f10c9">SequenceToMDString</a>(Inst-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(),</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                                      NewSeq)};</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  Node = <a class="code" href="classllvm_1_1MDNode.html#ad66ceb4f77078b084e527a19baab19d6">MDNode::get</a>(Inst-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(),</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                     <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Value*&gt;</a>(<a class="code" href="Target_2X86_2README_8txt.html#a82bd4f4b721c049035c0d86cc261eadd">tmp</a>, 3));</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(NodeId, Node);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;}</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">/// Add to the beginning of the basic block llvm.ptr.annotations which show the</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment">/// state of a pointer at the entrance to a basic block.</span></div><div class="line"><a name="l00901"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#ga386165b3085de31f1131538519c8240f">  901</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__ARCOpt.html#ga386165b3085de31f1131538519c8240f">GenerateARCBBEntranceAnnotation</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacellvm_1_1GraphProgram.html#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                                            <a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr, <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> Seq) {</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="comment">// If we have a target identifier, make sure that we match it before</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="comment">// continuing.</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="group__ARCOpt.html#gaf161d85830fb7b3acabeefce31e112ac">ARCAnnotationTargetIdentifier</a>.empty() &amp;&amp;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;     !Ptr-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>().<a class="code" href="classllvm_1_1StringRef.html#a29c565e0d52fdd3b366971d07fa0c83c">equals</a>(<a class="code" href="group__ARCOpt.html#gaf161d85830fb7b3acabeefce31e112ac">ARCAnnotationTargetIdentifier</a>))</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <a class="code" href="classllvm_1_1Module.html">Module</a> *<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>()-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>();</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = M-&gt;<a class="code" href="classllvm_1_1Module.html#a0e74af4b7c739f3a14e737c3042b6617">getContext</a>();</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *I8X = <a class="code" href="classllvm_1_1PointerType.html#a8db49fd5069f21d514e7bb0fd11f0902">PointerType::getUnqual</a>(<a class="code" href="classllvm_1_1Type.html#a7ba5de75f50bb4a4ba920698edf39b28">Type::getInt8Ty</a>(C));</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *I8XX = <a class="code" href="classllvm_1_1PointerType.html#a8db49fd5069f21d514e7bb0fd11f0902">PointerType::getUnqual</a>(I8X);</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *Params[] = {I8XX, I8XX};</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <a class="code" href="classllvm_1_1FunctionType.html">FunctionType</a> *FTy = <a class="code" href="classllvm_1_1FunctionType.html#a7e89b55242c964ae61b7850e99cacef0">FunctionType::get</a>(<a class="code" href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(C),</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                                        <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Type*&gt;</a>(Params, 2),</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                                        <span class="comment">/*isVarArg=*/</span><span class="keyword">false</span>);</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Callee = M-&gt;<a class="code" href="classllvm_1_1Module.html#a96581205e1149f5d70b56f9a83bc841a">getOrInsertFunction</a>(Name, FTy);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(BB, BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ab1cd5a3713b93a33f89a2086d473cf6e">getFirstInsertionPt</a>());</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *PtrName;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> Tmp = Ptr-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>();</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <span class="keywordflow">if</span> (0 == (PtrName = M-&gt;<a class="code" href="classllvm_1_1Module.html#a17ebd56685ee19e7761ae577cd511e25">getGlobalVariable</a>(Tmp, <span class="keyword">true</span>))) {</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ActualPtrName = Builder.CreateGlobalStringPtr(Tmp,</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                                                         Tmp + <span class="stringliteral">&quot;_STR&quot;</span>);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    PtrName = <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(*M, I8X, <span class="keyword">true</span>, <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalVariable::InternalLinkage</a>,</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                                 cast&lt;Constant&gt;(ActualPtrName), Tmp);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  }</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  std::string SeqStr = <a class="code" href="group__ARCOpt.html#ga577d1729941a8a5903686ba11161aa7e">SequenceToString</a>(Seq);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="keywordflow">if</span> (0 == (S = M-&gt;<a class="code" href="classllvm_1_1Module.html#a17ebd56685ee19e7761ae577cd511e25">getGlobalVariable</a>(SeqStr, <span class="keyword">true</span>))) {</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ActualPtrName = Builder.CreateGlobalStringPtr(SeqStr,</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                                                         SeqStr + <span class="stringliteral">&quot;_STR&quot;</span>);</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    S = <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(*M, I8X, <span class="keyword">true</span>, <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalVariable::InternalLinkage</a>,</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                           cast&lt;Constant&gt;(ActualPtrName), SeqStr);</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  }</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  Builder.CreateCall2(Callee, PtrName, S);</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;}</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment">/// Add to the end of the basic block llvm.ptr.annotations which show the state</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">/// of the pointer at the bottom of the basic block.</span></div><div class="line"><a name="l00944"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#ga5db61f160bd5ea2dde577876252e170d">  944</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__ARCOpt.html#ga5db61f160bd5ea2dde577876252e170d">GenerateARCBBTerminatorAnnotation</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacellvm_1_1GraphProgram.html#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                                              <a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr, <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> Seq) {</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="comment">// If we have a target identifier, make sure that we match it before emitting</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="comment">// an annotation.</span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keywordflow">if</span>(!<a class="code" href="group__ARCOpt.html#gaf161d85830fb7b3acabeefce31e112ac">ARCAnnotationTargetIdentifier</a>.empty() &amp;&amp;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;     !Ptr-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>().<a class="code" href="classllvm_1_1StringRef.html#a29c565e0d52fdd3b366971d07fa0c83c">equals</a>(<a class="code" href="group__ARCOpt.html#gaf161d85830fb7b3acabeefce31e112ac">ARCAnnotationTargetIdentifier</a>))</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <a class="code" href="classllvm_1_1Module.html">Module</a> *<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>()-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>();</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = M-&gt;<a class="code" href="classllvm_1_1Module.html#a0e74af4b7c739f3a14e737c3042b6617">getContext</a>();</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *I8X = <a class="code" href="classllvm_1_1PointerType.html#a8db49fd5069f21d514e7bb0fd11f0902">PointerType::getUnqual</a>(<a class="code" href="classllvm_1_1Type.html#a7ba5de75f50bb4a4ba920698edf39b28">Type::getInt8Ty</a>(C));</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *I8XX = <a class="code" href="classllvm_1_1PointerType.html#a8db49fd5069f21d514e7bb0fd11f0902">PointerType::getUnqual</a>(I8X);</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *Params[] = {I8XX, I8XX};</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <a class="code" href="classllvm_1_1FunctionType.html">FunctionType</a> *FTy = <a class="code" href="classllvm_1_1FunctionType.html#a7e89b55242c964ae61b7850e99cacef0">FunctionType::get</a>(<a class="code" href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(C),</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                                        <a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;Type*&gt;</a>(Params, 2),</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                                        <span class="comment">/*isVarArg=*/</span><span class="keyword">false</span>);</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Callee = M-&gt;<a class="code" href="classllvm_1_1Module.html#a96581205e1149f5d70b56f9a83bc841a">getOrInsertFunction</a>(Name, FTy);</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(BB, <a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>()));</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *PtrName;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <a class="code" href="classllvm_1_1StringRef.html">StringRef</a> Tmp = Ptr-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>();</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordflow">if</span> (0 == (PtrName = M-&gt;<a class="code" href="classllvm_1_1Module.html#a17ebd56685ee19e7761ae577cd511e25">getGlobalVariable</a>(Tmp, <span class="keyword">true</span>))) {</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ActualPtrName = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#ac7e494db1258c53ea78810a0d6a5c879">CreateGlobalStringPtr</a>(Tmp,</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                                                         Tmp + <span class="stringliteral">&quot;_STR&quot;</span>);</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    PtrName = <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(*M, I8X, <span class="keyword">true</span>, <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalVariable::InternalLinkage</a>,</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                                 cast&lt;Constant&gt;(ActualPtrName), Tmp);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  }</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  std::string SeqStr = <a class="code" href="group__ARCOpt.html#ga577d1729941a8a5903686ba11161aa7e">SequenceToString</a>(Seq);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keywordflow">if</span> (0 == (S = M-&gt;<a class="code" href="classllvm_1_1Module.html#a17ebd56685ee19e7761ae577cd511e25">getGlobalVariable</a>(SeqStr, <span class="keyword">true</span>))) {</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ActualPtrName = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#ac7e494db1258c53ea78810a0d6a5c879">CreateGlobalStringPtr</a>(SeqStr,</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                                                         SeqStr + <span class="stringliteral">&quot;_STR&quot;</span>);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    S = <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(*M, I8X, <span class="keyword">true</span>, <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalVariable::InternalLinkage</a>,</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                           cast&lt;Constant&gt;(ActualPtrName), SeqStr);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a902af4d6cb3a421a7f5723d0fc81efd1">CreateCall2</a>(Callee, PtrName, S);</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;}</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment">/// Adds a source annotation to pointer and a state change annotation to Inst</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment">/// referencing the source annotation and the old/new state of pointer.</span></div><div class="line"><a name="l00986"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#ga4b518a379da0bd2b440cc0fdc21c6ba5">  986</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__ARCOpt.html#ga4b518a379da0bd2b440cc0fdc21c6ba5">GenerateARCAnnotation</a>(<span class="keywordtype">unsigned</span> InstMDId,</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                                  <span class="keywordtype">unsigned</span> PtrMDId,</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                                  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst,</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                                  <a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr,</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                                  <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> OldSeq,</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                                  <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> NewSeq) {</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__ARCOpt.html#ga4320fed90984fab278ec601fb74c5dfe">EnableARCAnnotations</a>) {</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="comment">// If we have a target identifier, make sure that we match it before</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="comment">// emitting an annotation.</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="group__ARCOpt.html#gaf161d85830fb7b3acabeefce31e112ac">ARCAnnotationTargetIdentifier</a>.empty() &amp;&amp;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;       !Ptr-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>().<a class="code" href="classllvm_1_1StringRef.html#a29c565e0d52fdd3b366971d07fa0c83c">equals</a>(<a class="code" href="group__ARCOpt.html#gaf161d85830fb7b3acabeefce31e112ac">ARCAnnotationTargetIdentifier</a>))</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="comment">// First generate the source annotation on our pointer. This will return an</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="comment">// MDString* if Ptr actually comes from an instruction implying we can put</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="comment">// in a source annotation. If AppendMDNodeToSourcePtr returns 0 (i.e. NULL),</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <span class="comment">// then we know that our pointer is from an Argument so we put a reference</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <span class="comment">// to the argument number.</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="comment">// The point of this is to make it easy for the</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="comment">// llvm-arc-annotation-processor tool to cross reference where the source</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="comment">// pointer is in the LLVM IR since the LLVM IR parser does not submit such</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="comment">// information via debug info for backends to use (since why would anyone</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="comment">// need such a thing from LLVM IR besides in non standard cases</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="comment">// [i.e. this]).</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <a class="code" href="classllvm_1_1MDString.html">MDString</a> *SourcePtrMDNode =</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      <a class="code" href="group__ARCOpt.html#ga2b898cab6afd53d4c51bbc644ae3e7eb">AppendMDNodeToSourcePtr</a>(PtrMDId, Ptr);</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <a class="code" href="group__ARCOpt.html#gae5a7eeb1b77c0ad38f27bb76e943743e">AppendMDNodeToInstForPtr</a>(InstMDId, Inst, Ptr, SourcePtrMDNode, OldSeq,</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                             NewSeq);</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  }</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;}</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">// The actual interface for accessing the above functionality is defined via</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment">// some simple macros which are defined below. We do this so that the user does</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment">// not need to pass in what metadata id is needed resulting in cleaner code and</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment">// additionally since it provides an easy way to conditionally no-op all</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment">// annotation support in a non-debug build.</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">/// Use this macro to annotate a sequence state change when processing</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">/// instructions bottom up,</span></div><div class="line"><a name="l01026"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#ga6f340da01646bd4e2fa91be9dd87e01a"> 1026</a></span>&#160;<span class="comment"></span><span class="preprocessor">#define ANNOTATE_BOTTOMUP(inst, ptr, old, new)                          \</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="preprocessor">  GenerateARCAnnotation(ARCAnnotationBottomUpMDKind,                    \</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="preprocessor">                        ARCAnnotationProvenanceSourceMDKind, (inst),    \</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="preprocessor">                        const_cast&lt;Value*&gt;(ptr), (old), (new))</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment">/// Use this macro to annotate a sequence state change when processing</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment"></span><span class="comment">/// instructions top down.</span></div><div class="line"><a name="l01032"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#gaba2c11e914151022314fc9e623d55597"> 1032</a></span>&#160;<span class="comment"></span><span class="preprocessor">#define ANNOTATE_TOPDOWN(inst, ptr, old, new)                           \</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="preprocessor">  GenerateARCAnnotation(ARCAnnotationTopDownMDKind,                     \</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="preprocessor">                        ARCAnnotationProvenanceSourceMDKind, (inst),    \</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="preprocessor">                        const_cast&lt;Value*&gt;(ptr), (old), (new))</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#ga45d54abb34dae044e92d588ad23ad116"> 1037</a></span>&#160;<span class="preprocessor">#define ANNOTATE_BB(_states, _bb, _name, _type, _direction)                   \</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="preprocessor">  do {                                                                        \</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="preprocessor">    if (EnableARCAnnotations) {                                               \</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="preprocessor">      for(BBState::ptr_const_iterator I = (_states)._direction##_ptr_begin(), \</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="preprocessor">          E = (_states)._direction##_ptr_end(); I != E; ++I) {                \</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="preprocessor">        Value *Ptr = const_cast&lt;Value*&gt;(I-&gt;first);                            \</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="preprocessor">        Sequence Seq = I-&gt;second.GetSeq();                                    \</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="preprocessor">        GenerateARCBB ## _type ## Annotation(_name, (_bb), Ptr, Seq);         \</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="preprocessor">      }                                                                       \</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="preprocessor">    }                                                                         \</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="preprocessor">  } while (0)</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#gaca2215704eb21394afd5834ca3a8bd8d"> 1049</a></span>&#160;<span class="preprocessor">#define ANNOTATE_BOTTOMUP_BBSTART(_states, _basicblock)                       \</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="preprocessor">    ANNOTATE_BB(_states, _basicblock, &quot;llvm.arc.annotation.bottomup.bbstart&quot;, \</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="preprocessor">                Entrance, bottom_up)</span></div><div class="line"><a name="l01052"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#gaa24d32d1803abde016a7c3a2333bf091"> 1052</a></span>&#160;<span class="preprocessor">#define ANNOTATE_BOTTOMUP_BBEND(_states, _basicblock)                         \</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="preprocessor">    ANNOTATE_BB(_states, _basicblock, &quot;llvm.arc.annotation.bottomup.bbend&quot;,   \</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="preprocessor">                Terminator, bottom_up)</span></div><div class="line"><a name="l01055"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#gae17710516ddda1ff2b53b6a198dac754"> 1055</a></span>&#160;<span class="preprocessor">#define ANNOTATE_TOPDOWN_BBSTART(_states, _basicblock)                        \</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="preprocessor">    ANNOTATE_BB(_states, _basicblock, &quot;llvm.arc.annotation.topdown.bbstart&quot;,  \</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="preprocessor">                Entrance, top_down)</span></div><div class="line"><a name="l01058"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#gad7170a77f0d0dab67cfd7b20756043ec"> 1058</a></span>&#160;<span class="preprocessor">#define ANNOTATE_TOPDOWN_BBEND(_states, _basicblock)                          \</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="preprocessor">    ANNOTATE_BB(_states, _basicblock, &quot;llvm.arc.annotation.topdown.bbend&quot;,    \</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="preprocessor">                Terminator, top_down)</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="preprocessor">#else // !ARC_ANNOTATION</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment">// If annotations are off, noop.</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="preprocessor">#define ANNOTATE_BOTTOMUP(inst, ptr, old, new)</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="preprocessor">#define ANNOTATE_TOPDOWN(inst, ptr, old, new)</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="preprocessor">#define ANNOTATE_BOTTOMUP_BBSTART(states, basicblock)</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="preprocessor">#define ANNOTATE_BOTTOMUP_BBEND(states, basicblock)</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="preprocessor">#define ANNOTATE_TOPDOWN_BBSTART(states, basicblock)</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="preprocessor">#define ANNOTATE_TOPDOWN_BBEND(states, basicblock)</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="preprocessor">#endif // !ARC_ANNOTATION</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">  /// \brief The main ARC optimization pass.</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>ObjCARCOpt : <span class="keyword">public</span> <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> {</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordtype">bool</span> Changed;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <a class="code" href="classllvm_1_1objcarc_1_1ProvenanceAnalysis.html">ProvenanceAnalysis</a> PA;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <a class="code" href="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints.html">ARCRuntimeEntryPoints</a> EP;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <span class="comment">// This is used to track if a pointer is stored into an alloca.</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <a class="code" href="classllvm_1_1DenseSet.html">DenseSet&lt;const Value *&gt;</a> MultiOwnersSet;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">    /// A flag indicating whether this optimization pass should run.</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment"></span>    <span class="keywordtype">bool</span> Run;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">    /// Flags which determine whether each of the interesting runtine functions</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment">    /// is in fact used in the current function.</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> UsedInThisFunction;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment">    /// The Metadata Kind for clang.imprecise_release metadata.</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> ImpreciseReleaseMDKind;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">    /// The Metadata Kind for clang.arc.copy_on_escape metadata.</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> CopyOnEscapeMDKind;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment">    /// The Metadata Kind for clang.arc.no_objc_arc_exceptions metadata.</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> NoObjCARCExceptionsMDKind;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="preprocessor">#ifdef ARC_ANNOTATIONS</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="comment">    /// The Metadata Kind for llvm.arc.annotation.bottomup metadata.</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> ARCAnnotationBottomUpMDKind;<span class="comment"></span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="comment">    /// The Metadata Kind for llvm.arc.annotation.topdown metadata.</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> ARCAnnotationTopDownMDKind;<span class="comment"></span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment">    /// The Metadata Kind for llvm.arc.annotation.provenancesource metadata.</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> ARCAnnotationProvenanceSourceMDKind;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="preprocessor">#endif // ARC_ANNOATIONS</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="keywordtype">bool</span> OptimizeRetainRVCall(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *RetainRV);</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordtype">void</span> OptimizeAutoreleaseRVCall(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *AutoreleaseRV,</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                                   <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2a">InstructionClass</a> &amp;<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5ada3eb06ada644390db065d37b3fd87ac">Class</a>);</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="keywordtype">void</span> OptimizeIndividualCalls(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F);</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="keywordtype">void</span> CheckForCFGHazards(<span class="keyword">const</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                            <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;</a> &amp;BBStates,</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                            BBState &amp;MyStates) <span class="keyword">const</span>;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="keywordtype">bool</span> VisitInstructionBottomUp(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst,</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                                  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB,</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                                  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, RRInfo&gt;</a> &amp;Retains,</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                                  BBState &amp;MyStates);</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="keywordtype">bool</span> VisitBottomUp(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB,</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                       <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;</a> &amp;BBStates,</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                       <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, RRInfo&gt;</a> &amp;Retains);</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="keywordtype">bool</span> VisitInstructionTopDown(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst,</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                                 <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, RRInfo&gt;</a> &amp;Releases,</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                                 BBState &amp;MyStates);</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="keywordtype">bool</span> VisitTopDown(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB,</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                      <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;</a> &amp;BBStates,</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                      <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, RRInfo&gt;</a> &amp;Releases);</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <span class="keywordtype">bool</span> Visit(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F,</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;               <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;</a> &amp;BBStates,</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;               <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, RRInfo&gt;</a> &amp;Retains,</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;               <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, RRInfo&gt;</a> &amp;Releases);</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="keywordtype">void</span> MoveCalls(<a class="code" href="classllvm_1_1Value.html">Value</a> *Arg, RRInfo &amp;RetainsToMove, RRInfo &amp;ReleasesToMove,</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                   <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, RRInfo&gt;</a> &amp;Retains,</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                   <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, RRInfo&gt;</a> &amp;Releases,</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                   <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;DeadInsts,</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                   <a class="code" href="classllvm_1_1Module.html">Module</a> *<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>);</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    <span class="keywordtype">bool</span> ConnectTDBUTraversals(<a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;</a> &amp;BBStates,</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                               <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, RRInfo&gt;</a> &amp;Retains,</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                               <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, RRInfo&gt;</a> &amp;Releases,</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                               <a class="code" href="classllvm_1_1Module.html">Module</a> *M,</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                               <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;NewRetains,</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                               <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;NewReleases,</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                               <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;DeadInsts,</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                               RRInfo &amp;RetainsToMove,</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                               RRInfo &amp;ReleasesToMove,</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                               <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg,</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;                               <span class="keywordtype">bool</span> KnownSafe,</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                               <span class="keywordtype">bool</span> &amp;AnyPairsCompletelyEliminated);</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <span class="keywordtype">bool</span> PerformCodePlacement(<a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;</a> &amp;BBStates,</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                              <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, RRInfo&gt;</a> &amp;Retains,</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                              <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, RRInfo&gt;</a> &amp;Releases,</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                              <a class="code" href="classllvm_1_1Module.html">Module</a> *M);</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keywordtype">void</span> OptimizeWeakCalls(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F);</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keywordtype">bool</span> OptimizeSequences(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F);</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="keywordtype">void</span> OptimizeReturns(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F);</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="keywordtype">void</span> GatherStatistics(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F, <span class="keywordtype">bool</span> AfterOptimization = <span class="keyword">false</span>);</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU) <span class="keyword">const</span>;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> doInitialization(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M);</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> runOnFunction(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F);</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> releaseMemory();</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l01173"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#ga752eafaa4db45af368c44ec2f6cee9e6"> 1173</a></span>&#160;    <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="group__ARCOpt.html#ga752eafaa4db45af368c44ec2f6cee9e6">ID</a>;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    ObjCARCOpt() : <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a>(ID) {</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <a class="code" href="namespacellvm.html#a7098b8504987e5063c247c8b1c58948b">initializeObjCARCOptPass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    }</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  };</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;}</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ObjCARCOpt::ID</a> = 0;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<a class="code" href="group__ARCOpt.html#gaf2908adcd1e1db388d1ec6ef2f39e8eb">INITIALIZE_PASS_BEGIN</a>(ObjCARCOpt,</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;                      <span class="stringliteral">&quot;objc-arc&quot;</span>, <span class="stringliteral">&quot;ObjC ARC optimization&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<a class="code" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1objcarc_1_1ObjCARCAliasAnalysis.html">ObjCARCAliasAnalysis</a>)</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<a class="code" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(ObjCARCOpt,</div><div class="line"><a name="l01185"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#gab062c31556fab4a12873c5e492ed3cd1"> 1185</a></span>&#160;                    <span class="stringliteral">&quot;objc-arc&quot;</span>, <span class="stringliteral">&quot;ObjC ARC optimization&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div><div class="line"><a name="l01187"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#ga27d1a983231606f44b685cfe570729aa"> 1187</a></span>&#160;<a class="code" href="classllvm_1_1Pass.html">Pass</a> *<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="group__ARCOpt.html#ga27d1a983231606f44b685cfe570729aa">createObjCARCOptPass</a>() {</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> ObjCARCOpt();</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;}</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="keywordtype">void</span> ObjCARCOpt::getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const </span>{</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1objcarc_1_1ObjCARCAliasAnalysis.html">ObjCARCAliasAnalysis</a>&gt;();</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1AliasAnalysis.html">AliasAnalysis</a>&gt;();</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  <span class="comment">// ARC optimization doesn&#39;t currently split critical edges.</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#af11a6ebf7ab3c388234cb6d5378439a3">setPreservesCFG</a>();</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;}</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="comment">/// Turn objc_retainAutoreleasedReturnValue into objc_retain if the operand is</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="comment">/// not a return value.  Or, if it can be paired with an</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment">/// objc_autoreleaseReturnValue, delete the pair and return true.</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;ObjCARCOpt::OptimizeRetainRVCall(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *RetainRV) {</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  <span class="comment">// Check for the argument being from an immediately preceding call or invoke.</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg = <a class="code" href="namespacellvm_1_1objcarc.html#a271307f400deec412d9be2949a7bfea3">GetObjCArg</a>(RetainRV);</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  <a class="code" href="classllvm_1_1ImmutableCallSite.html">ImmutableCallSite</a> CS(Arg);</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Call</a> = CS.<a class="code" href="classllvm_1_1CallSiteBase.html#ae4c67f835911559821939fb23a2e7aff">getInstruction</a>()) {</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Call</a>-&gt;getParent() == RetainRV-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()) {</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::const_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Call</a>;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      <span class="keywordflow">while</span> (<a class="code" href="namespacellvm_1_1objcarc.html#a5b9ccd23396f8bc9c9780b8dedfe0b22">IsNoopInstruction</a>(I)) ++I;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      <span class="keywordflow">if</span> (&amp;*I == RetainRV)</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II = dyn_cast&lt;InvokeInst&gt;(<a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Call</a>)) {</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *RetainRVParent = RetainRV-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      <span class="keywordflow">if</span> (II-&gt;getNormalDest() == RetainRVParent) {</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::const_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = RetainRVParent-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="namespacellvm_1_1objcarc.html#a5b9ccd23396f8bc9c9780b8dedfe0b22">IsNoopInstruction</a>(I)) ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        <span class="keywordflow">if</span> (&amp;*I == RetainRV)</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      }</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    }</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  }</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  <span class="comment">// Check for being preceded by an objc_autoreleaseReturnValue on the same</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  <span class="comment">// pointer. In this case, we can delete the pair.</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = RetainRV, Begin = RetainRV-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  <span class="keywordflow">if</span> (I != Begin) {</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <span class="keywordflow">do</span> --<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>; <span class="keywordflow">while</span> (I != Begin &amp;&amp; <a class="code" href="namespacellvm_1_1objcarc.html#a5b9ccd23396f8bc9c9780b8dedfe0b22">IsNoopInstruction</a>(I));</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#aaa976a678f8297931857721e45e4803d">GetBasicInstructionClass</a>(I) == <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa2d4ba97e16dbcc5627f4550bbc072214">IC_AutoreleaseRV</a> &amp;&amp;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        <a class="code" href="namespacellvm_1_1objcarc.html#a271307f400deec412d9be2949a7bfea3">GetObjCArg</a>(I) == Arg) {</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;      ++NumPeeps;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Erasing autoreleaseRV,retainRV pair: &quot;</span> &lt;&lt; *I &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot;Erasing &quot;</span> &lt;&lt; *RetainRV &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      <a class="code" href="namespacellvm_1_1objcarc.html#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(I);</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;      <a class="code" href="namespacellvm_1_1objcarc.html#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(RetainRV);</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    }</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  }</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="comment">// Turn it to a plain objc_retain.</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  ++NumPeeps;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Transforming objc_retainAutoreleasedReturnValue =&gt; &quot;</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                  <span class="stringliteral">&quot;objc_retain since the operand is not a return value.\n&quot;</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                  <span class="stringliteral">&quot;Old = &quot;</span> &lt;&lt; *RetainRV &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *NewDecl = EP.get(<a class="code" href="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints.html#a8c0ce6d07197d6b03c59e80ea8b6c33ba4cabea25d6f015e582feb5eed1f97a81">ARCRuntimeEntryPoints::EPT_Retain</a>);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  cast&lt;CallInst&gt;(RetainRV)-&gt;setCalledFunction(NewDecl);</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;New = &quot;</span> &lt;&lt; *RetainRV &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;}</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="comment">/// Turn objc_autoreleaseReturnValue into objc_autorelease if the result is not</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment">/// used as a return value.</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment"></span><span class="keywordtype">void</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;ObjCARCOpt::OptimizeAutoreleaseRVCall(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *AutoreleaseRV,</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;                                      <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2a">InstructionClass</a> &amp;<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5ada3eb06ada644390db065d37b3fd87ac">Class</a>) {</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <span class="comment">// Check for a return of the pointer value.</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr = <a class="code" href="namespacellvm_1_1objcarc.html#a271307f400deec412d9be2949a7bfea3">GetObjCArg</a>(AutoreleaseRV);</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;const Value *, 2&gt;</a> <a class="code" href="IVUsers_8cpp.html#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  Users.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Ptr);</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    Ptr = Users.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::const_use_iterator</a> UI = Ptr-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), UE = Ptr-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;         UI != UE; ++UI) {</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1User.html">User</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = *UI;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      <span class="keywordflow">if</span> (isa&lt;ReturnInst&gt;(I) || <a class="code" href="namespacellvm_1_1objcarc.html#aaa976a678f8297931857721e45e4803d">GetBasicInstructionClass</a>(I) == <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaa7ab689fdb243382e550bcd4481ab6ef">IC_RetainRV</a>)</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      <span class="keywordflow">if</span> (isa&lt;BitCastInst&gt;(I))</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;        Users.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(I);</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    }</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  } <span class="keywordflow">while</span> (!Users.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>());</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  ++NumPeeps;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Transforming objc_autoreleaseReturnValue =&gt; &quot;</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                  <span class="stringliteral">&quot;objc_autorelease since its operand is not used as a return &quot;</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                  <span class="stringliteral">&quot;value.\n&quot;</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;                  <span class="stringliteral">&quot;Old = &quot;</span> &lt;&lt; *AutoreleaseRV &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *AutoreleaseRVCI = cast&lt;CallInst&gt;(AutoreleaseRV);</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *NewDecl = EP.get(<a class="code" href="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints.html#a8c0ce6d07197d6b03c59e80ea8b6c33ba3de34b12b54752da3c240513fa97780c">ARCRuntimeEntryPoints::EPT_Autorelease</a>);</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  AutoreleaseRVCI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a61f747edd1ca001427e02e02a320b709">setCalledFunction</a>(NewDecl);</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  AutoreleaseRVCI-&gt;<a class="code" href="classllvm_1_1CallInst.html#ad54481e3c992b555aeaba34a83daf7e6">setTailCall</a>(<span class="keyword">false</span>); <span class="comment">// Never tail call objc_autorelease.</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  Class = <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa02e0eccce75bf149ddc6aa9eb323ffaa">IC_Autorelease</a>;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;New: &quot;</span> &lt;&lt; *AutoreleaseRV &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;}</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment">/// Visit each call, one at a time, and make simplifications without doing any</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="comment">/// additional analysis.</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ObjCARCOpt::OptimizeIndividualCalls(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F) {</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n== ObjCARCOpt::OptimizeIndividualCalls ==\n&quot;</span>);</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;  <span class="comment">// Reset all the flags in preparation for recomputing them.</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  UsedInThisFunction = 0;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;  <span class="comment">// Visit all objc_* calls in F.</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1InstIterator.html">inst_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#a49a219f3fe3d7a6cc07c49a1ea766d6d">inst_begin</a>(&amp;F), E = <a class="code" href="namespacellvm.html#a945cded5463e0ccd3cf5a6ac80542a94">inst_end</a>(&amp;F); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ) {</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = &amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2a">InstructionClass</a> Class = <a class="code" href="namespacellvm_1_1objcarc.html#aaa976a678f8297931857721e45e4803d">GetBasicInstructionClass</a>(Inst);</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Visiting: Class: &quot;</span> &lt;&lt; Class &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="keywordflow">switch</span> (Class) {</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <span class="comment">// Delete no-op casts. These function calls have special semantics, but</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="comment">// the semantics are entirely implemented via lowering in the front-end,</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="comment">// so by the time they reach the optimizer, they are just no-op calls</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    <span class="comment">// which return their argument.</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <span class="comment">// There are gray areas here, as the ability to cast reference-counted</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="comment">// pointers to raw void* and back allows code to break ARC assumptions,</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <span class="comment">// however these are currently considered to be unimportant.</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa105b2f9524696bc5df0ed2eb1c2f88de">IC_NoopCast</a>:</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      ++NumNoops;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Erasing no-op cast: &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;      <a class="code" href="namespacellvm_1_1objcarc.html#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(Inst);</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="comment">// If the pointer-to-weak-pointer is null, it&#39;s undefined behavior.</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa435140d7b64d6414958067beccb4c94e">IC_StoreWeak</a>:</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaf3043c9d141f15c8e2539d027c612b0a">IC_LoadWeak</a>:</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aabbcd83d361a8b4bebcfe8b3e4cc3758d">IC_LoadWeakRetained</a>:</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa1534960469029dd730603e21fdf178e3">IC_InitWeak</a>:</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aac8d3271bcb25ea91e214a57a68d3856f">IC_DestroyWeak</a>: {</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;      <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = cast&lt;CallInst&gt;(Inst);</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#ad5330f6d2a7e879f0a480ccc30050de5">IsNullOrUndef</a>(CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(0))) {</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>();</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;        <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(<a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(cast&lt;PointerType&gt;(Ty)-&gt;getElementType()),</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;                      <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Ty),</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;                      CI);</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;        <a class="code" href="classllvm_1_1Value.html">llvm::Value</a> *NewValue = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;A null pointer-to-weak-pointer is undefined behavior.&quot;</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                       <span class="stringliteral">&quot;\nOld = &quot;</span> &lt;&lt; *CI &lt;&lt; <span class="stringliteral">&quot;\nNew = &quot;</span> &lt;&lt; *NewValue &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;        CI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewValue);</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;        CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      }</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    }</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa11b5bdda15281a198319b3c10debbe56">IC_CopyWeak</a>:</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa269efb4e3ea57dfd32d863410e85e2c3">IC_MoveWeak</a>: {</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;      <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = cast&lt;CallInst&gt;(Inst);</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#ad5330f6d2a7e879f0a480ccc30050de5">IsNullOrUndef</a>(CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(0)) ||</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;          <a class="code" href="namespacellvm_1_1objcarc.html#ad5330f6d2a7e879f0a480ccc30050de5">IsNullOrUndef</a>(CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(1))) {</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>();</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(<a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(cast&lt;PointerType&gt;(Ty)-&gt;getElementType()),</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                      <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Ty),</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                      CI);</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        <a class="code" href="classllvm_1_1Value.html">llvm::Value</a> *NewValue = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;A null pointer-to-weak-pointer is undefined behavior.&quot;</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                        <span class="stringliteral">&quot;\nOld = &quot;</span> &lt;&lt; *CI &lt;&lt; <span class="stringliteral">&quot;\nNew = &quot;</span> &lt;&lt; *NewValue &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        CI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewValue);</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;      }</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    }</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaa7ab689fdb243382e550bcd4481ab6ef">IC_RetainRV</a>:</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      <span class="keywordflow">if</span> (OptimizeRetainRVCall(F, Inst))</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa2d4ba97e16dbcc5627f4550bbc072214">IC_AutoreleaseRV</a>:</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      OptimizeAutoreleaseRVCall(F, Inst, Class);</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    }</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <span class="comment">// objc_autorelease(x) -&gt; objc_release(x) if x is otherwise unused.</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#a2c32f032263eb1fa0ec96e9132f0b7c3">IsAutorelease</a>(Class) &amp;&amp; Inst-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;      <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *<a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Call</a> = cast&lt;CallInst&gt;(Inst);</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg = Call-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(0);</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      Arg = <a class="code" href="group__ARCUtilities.html#ga3e31fa79553c53df380d4054de2ca1c9">FindSingleUseIdentifiedObject</a>(Arg);</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;      <span class="keywordflow">if</span> (Arg) {</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        ++NumAutoreleases;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        <span class="comment">// Create the declaration lazily.</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = Inst-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>();</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Decl = EP.get(<a class="code" href="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints.html#a8c0ce6d07197d6b03c59e80ea8b6c33ba82db7aa366c43e3d4c969b9159bc6d76">ARCRuntimeEntryPoints::EPT_Release</a>);</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;        <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *NewCall = <a class="code" href="classllvm_1_1CallInst.html#a861226dd056dd2438da26760b8e7a9a0">CallInst::Create</a>(Decl, Call-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(0), <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;                                             <a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Call</a>);</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        NewCall-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(ImpreciseReleaseMDKind, <a class="code" href="classllvm_1_1MDNode.html#ad66ceb4f77078b084e527a19baab19d6">MDNode::get</a>(C, <a class="code" href="namespacellvm.html#a1d0ac37acc2482f8794195f5042b61b5acd12d6cf678f7504ca49c922fb16ce01">None</a>));</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Replacing autorelease{,RV}(x) with objc_release(x) &quot;</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;              <span class="stringliteral">&quot;since x is otherwise unused.\nOld: &quot;</span> &lt;&lt; *Call &lt;&lt; <span class="stringliteral">&quot;\nNew: &quot;</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;              &lt;&lt; *NewCall &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;        <a class="code" href="namespacellvm_1_1objcarc.html#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(Call);</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        Inst = NewCall;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        Class = <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa442b643665868538ba47d657c13629e8">IC_Release</a>;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      }</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    }</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    <span class="comment">// For functions which can never be passed stack arguments, add</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    <span class="comment">// a tail keyword.</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#a02767ff646c069174b181da0a069e4b6">IsAlwaysTail</a>(Class)) {</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Adding tail keyword to function since it can never be &quot;</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;                      <span class="stringliteral">&quot;passed stack args: &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      cast&lt;CallInst&gt;(Inst)-&gt;setTailCall();</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    }</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="comment">// Ensure that functions that can never have a &quot;tail&quot; keyword due to the</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="comment">// semantics of ARC truly do not do so.</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#abc7c6543a527117c9d5b24c5e830eddb">IsNeverTail</a>(Class)) {</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Removing tail keyword from function: &quot;</span> &lt;&lt; *Inst &lt;&lt;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;            <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      cast&lt;CallInst&gt;(Inst)-&gt;setTailCall(<span class="keyword">false</span>);</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    }</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="comment">// Set nounwind as needed.</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#a9af0808dc66b73d8a1781feadce89111">IsNoThrow</a>(Class)) {</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found no throw class. Setting nounwind on: &quot;</span> &lt;&lt; *Inst</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      cast&lt;CallInst&gt;(Inst)-&gt;setDoesNotThrow();</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    }</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1objcarc.html#abb3826a839d3c715ce9538cb9ca7bec5">IsNoopOnNull</a>(Class)) {</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      UsedInThisFunction |= 1 &lt;&lt; <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5ada3eb06ada644390db065d37b3fd87ac">Class</a>;</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    }</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg = <a class="code" href="namespacellvm_1_1objcarc.html#a271307f400deec412d9be2949a7bfea3">GetObjCArg</a>(Inst);</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <span class="comment">// ARC calls with null are no-ops. Delete them.</span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#ad5330f6d2a7e879f0a480ccc30050de5">IsNullOrUndef</a>(Arg)) {</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;      ++NumNoops;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;ARC calls with  null are no-ops. Erasing: &quot;</span> &lt;&lt; *Inst</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;      <a class="code" href="namespacellvm_1_1objcarc.html#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(Inst);</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    }</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <span class="comment">// Keep track of which of retain, release, autorelease, and retain_block</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="comment">// are actually present in this function.</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    UsedInThisFunction |= 1 &lt;&lt; <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5ada3eb06ada644390db065d37b3fd87ac">Class</a>;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <span class="comment">// If Arg is a PHI, and one or more incoming values to the</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="comment">// PHI are null, and the call is control-equivalent to the PHI, and there</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    <span class="comment">// are no relevant side effects between the PHI and the call, the call</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    <span class="comment">// could be pushed up to just those paths with non-null incoming values.</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="comment">// For now, don&#39;t bother splitting critical edges for this.</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;Instruction *, const Value *&gt;</a>, 4&gt; Worklist;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(Inst, Arg));</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    <span class="keywordflow">do</span> {</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;      std::pair&lt;Instruction *, const Value *&gt; Pair = Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;      Inst = Pair.first;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      Arg = Pair.second;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(Arg);</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <span class="keywordflow">if</span> (!PN) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;      <span class="comment">// Determine if the PHI has any null operands, or any incoming</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      <span class="comment">// critical edges.</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;      <span class="keywordtype">bool</span> HasNull = <span class="keyword">false</span>;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      <span class="keywordtype">bool</span> HasCriticalEdges = <span class="keyword">false</span>;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Incoming =</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;          <a class="code" href="namespacellvm_1_1objcarc.html#a85502898d19c32629e2e17fe94f34985">StripPointerCastsAndObjCCalls</a>(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#ad5330f6d2a7e879f0a480ccc30050de5">IsNullOrUndef</a>(Incoming))</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;          HasNull = <span class="keyword">true</span>;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cast&lt;TerminatorInst&gt;(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6bce6440331683570a283df762902a09">back</a>())</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                   .getNumSuccessors() != 1) {</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;          HasCriticalEdges = <span class="keyword">true</span>;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        }</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;      }</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      <span class="comment">// If we have null operands and no critical edges, optimize.</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      <span class="keywordflow">if</span> (!HasCriticalEdges &amp;&amp; HasNull) {</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 4&gt;</a> DependingInstructions;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const BasicBlock *, 4&gt;</a> Visited;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        <span class="comment">// Check that there is nothing that cares about the reference</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        <span class="comment">// count between the call and the phi.</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        <span class="keywordflow">switch</span> (Class) {</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaa2c2d6f56cb091ae9470b8fb1e74757d">IC_Retain</a>:</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aabbf6ec1064199e8c4ecba1aaccf93f47">IC_RetainBlock</a>:</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;          <span class="comment">// These can always be moved up.</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa442b643665868538ba47d657c13629e8">IC_Release</a>:</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;          <span class="comment">// These can&#39;t be moved across things that care about the retain</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;          <span class="comment">// count.</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;          <a class="code" href="namespacellvm_1_1objcarc.html#a910c6858e79ffad2a32aee7db4dec1d8">FindDependencies</a>(<a class="code" href="namespacellvm_1_1objcarc.html#a353f4c1f85416c596ecaa9c4d5afca75ae9cb4656651e6d8f4748dac4bbe1b361">NeedsPositiveRetainCount</a>, Arg,</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;                           Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>(), Inst,</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                           DependingInstructions, Visited, PA);</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa02e0eccce75bf149ddc6aa9eb323ffaa">IC_Autorelease</a>:</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;          <span class="comment">// These can&#39;t be moved across autorelease pool scope boundaries.</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;          <a class="code" href="namespacellvm_1_1objcarc.html#a910c6858e79ffad2a32aee7db4dec1d8">FindDependencies</a>(<a class="code" href="namespacellvm_1_1objcarc.html#a353f4c1f85416c596ecaa9c4d5afca75ac6640fbd8b830536b76f884208bb53aa">AutoreleasePoolBoundary</a>, Arg,</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;                           Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>(), Inst,</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                           DependingInstructions, Visited, PA);</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaa7ab689fdb243382e550bcd4481ab6ef">IC_RetainRV</a>:</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa2d4ba97e16dbcc5627f4550bbc072214">IC_AutoreleaseRV</a>:</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;          <span class="comment">// Don&#39;t move these; the RV optimization depends on the autoreleaseRV</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;          <span class="comment">// being tail called, and the retainRV being immediately after a call</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;          <span class="comment">// (which might still happen if we get lucky with codegen layout, but</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;          <span class="comment">// it&#39;s not worth taking the chance).</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;          <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Invalid dependence flavor&quot;</span>);</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        }</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        <span class="keywordflow">if</span> (DependingInstructions.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a41c201584742f7eb45b2be8cd54e3bcb">size</a>() == 1 &amp;&amp;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;            *DependingInstructions.<a class="code" href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">begin</a>() == PN) {</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;          Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;          ++NumPartialNoops;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;          <span class="comment">// Clone the call into each predecessor that has a non-null value.</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;          <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CInst = cast&lt;CallInst&gt;(Inst);</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;          <a class="code" href="classllvm_1_1Type.html">Type</a> *ParamTy = CInst-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>();</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;            <a class="code" href="classllvm_1_1Value.html">Value</a> *Incoming =</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;              <a class="code" href="namespacellvm_1_1objcarc.html#a85502898d19c32629e2e17fe94f34985">StripPointerCastsAndObjCCalls</a>(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1objcarc.html#ad5330f6d2a7e879f0a480ccc30050de5">IsNullOrUndef</a>(Incoming)) {</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;              <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *Clone = cast&lt;CallInst&gt;(CInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#af6aad0c9ba7b8720130235c9621b55b5">clone</a>());</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;              <a class="code" href="classllvm_1_1Value.html">Value</a> *Op = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;              <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertPos = &amp;PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6bce6440331683570a283df762902a09">back</a>();</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;              <span class="keywordflow">if</span> (Op-&gt;getType() != ParamTy)</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;                Op = <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(Op, ParamTy, <span class="stringliteral">&quot;&quot;</span>, InsertPos);</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;              Clone-&gt;<a class="code" href="classllvm_1_1CallInst.html#abc04eae9879e3b4fe7f01ce0f4d4e71e">setArgOperand</a>(0, Op);</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;              Clone-&gt;<a class="code" href="classllvm_1_1Instruction.html#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(InsertPos);</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;              <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Cloning &quot;</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;                           &lt;&lt; *CInst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;                           <span class="stringliteral">&quot;And inserting clone at &quot;</span> &lt;&lt; *InsertPos &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;              Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(Clone, Incoming));</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;            }</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;          }</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;          <span class="comment">// Erase the original call.</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Erasing: &quot;</span> &lt;&lt; *CInst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;          <a class="code" href="namespacellvm_1_1objcarc.html#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(CInst);</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        }</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;      }</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    } <span class="keywordflow">while</span> (!Worklist.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>());</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  }</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;}</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="comment">/// If we have a top down pointer in the S_Use state, make sure that there are</span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="comment">/// no CFG hazards by checking the states of various bottom up pointers.</span></div><div class="line"><a name="l01560"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#ga61d78e7fc196dd16165fa1bed1639136"> 1560</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__ARCOpt.html#ga61d78e7fc196dd16165fa1bed1639136">CheckForUseCFGHazard</a>(<span class="keyword">const</span> <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> SuccSSeq,</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;                                 <span class="keyword">const</span> <span class="keywordtype">bool</span> SuccSRRIKnownSafe,</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;                                 PtrState &amp;<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>,</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                                 <span class="keywordtype">bool</span> &amp;SomeSuccHasSame,</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                                 <span class="keywordtype">bool</span> &amp;AllSuccsHaveSame,</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;                                 <span class="keywordtype">bool</span> &amp;NotAllSeqEqualButKnownSafe,</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                                 <span class="keywordtype">bool</span> &amp;ShouldContinue) {</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  <span class="keywordflow">switch</span> (SuccSSeq) {</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  <span class="keywordflow">case</span> S_CanRelease: {</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <span class="keywordflow">if</span> (!S.IsKnownSafe() &amp;&amp; !SuccSRRIKnownSafe) {</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      S.ClearSequenceProgress();</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    }</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    S.SetCFGHazardAfflicted(<span class="keyword">true</span>);</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    ShouldContinue = <span class="keyword">true</span>;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;  }</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  <span class="keywordflow">case</span> S_Use:</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    SomeSuccHasSame = <span class="keyword">true</span>;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  <span class="keywordflow">case</span> S_Stop:</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  <span class="keywordflow">case</span> S_Release:</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  <span class="keywordflow">case</span> S_MovableRelease:</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    <span class="keywordflow">if</span> (!S.IsKnownSafe() &amp;&amp; !SuccSRRIKnownSafe)</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;      AllSuccsHaveSame = <span class="keyword">false</span>;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      NotAllSeqEqualButKnownSafe = <span class="keyword">true</span>;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  <span class="keywordflow">case</span> S_Retain:</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;bottom-up pointer in retain state!&quot;</span>);</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  <span class="keywordflow">case</span> S_None:</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;This should have been handled earlier.&quot;</span>);</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;  }</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;}</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="comment">/// If we have a Top Down pointer in the S_CanRelease state, make sure that</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="comment">/// there are no CFG hazards by checking the states of various bottom up</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment">/// pointers.</span></div><div class="line"><a name="l01598"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#gad44eeecf3b037cda497f027bf50c8a3a"> 1598</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__ARCOpt.html#gad44eeecf3b037cda497f027bf50c8a3a">CheckForCanReleaseCFGHazard</a>(<span class="keyword">const</span> <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> SuccSSeq,</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">bool</span> SuccSRRIKnownSafe,</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;                                        PtrState &amp;<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>,</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;                                        <span class="keywordtype">bool</span> &amp;SomeSuccHasSame,</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;                                        <span class="keywordtype">bool</span> &amp;AllSuccsHaveSame,</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;                                        <span class="keywordtype">bool</span> &amp;NotAllSeqEqualButKnownSafe) {</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;  <span class="keywordflow">switch</span> (SuccSSeq) {</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;  <span class="keywordflow">case</span> S_CanRelease:</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    SomeSuccHasSame = <span class="keyword">true</span>;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;  <span class="keywordflow">case</span> S_Stop:</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  <span class="keywordflow">case</span> S_Release:</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;  <span class="keywordflow">case</span> S_MovableRelease:</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  <span class="keywordflow">case</span> S_Use:</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    <span class="keywordflow">if</span> (!S.IsKnownSafe() &amp;&amp; !SuccSRRIKnownSafe)</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      AllSuccsHaveSame = <span class="keyword">false</span>;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;      NotAllSeqEqualButKnownSafe = <span class="keyword">true</span>;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  <span class="keywordflow">case</span> S_Retain:</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;bottom-up pointer in retain state!&quot;</span>);</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  <span class="keywordflow">case</span> S_None:</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;This should have been handled earlier.&quot;</span>);</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;  }</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;}</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="comment">/// Check for critical edges, loop boundaries, irreducible control flow, or</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">/// other CFG structures where moving code across the edge would result in it</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">/// being executed more.</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment"></span><span class="keywordtype">void</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;ObjCARCOpt::CheckForCFGHazards(<span class="keyword">const</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>,</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                               <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;</a> &amp;BBStates,</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                               BBState &amp;MyStates)<span class="keyword"> const </span>{</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;  <span class="comment">// If any top-down local-use or possible-dec has a succ which is earlier in</span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;  <span class="comment">// the sequence, forget it.</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;  <span class="keywordflow">for</span> (BBState::ptr_iterator <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MyStates.top_down_ptr_begin(),</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;         E = MyStates.top_down_ptr_end(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;    PtrState &amp;<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <span class="keyword">const</span> <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> Seq = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second.GetSeq();</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <span class="comment">// We only care about S_Retain, S_CanRelease, and S_Use.</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    <span class="keywordflow">if</span> (Seq == S_None)</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    <span class="comment">// Make sure that if extra top down states are added in the future that this</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <span class="comment">// code is updated to handle it.</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    assert((Seq == S_Retain || Seq == S_CanRelease || Seq == S_Use) &amp;&amp;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;           <span class="stringliteral">&quot;Unknown top down sequence state.&quot;</span>);</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first;</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *TI = cast&lt;TerminatorInst&gt;(&amp;BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6bce6440331683570a283df762902a09">back</a>());</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    <span class="keywordtype">bool</span> SomeSuccHasSame = <span class="keyword">false</span>;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    <span class="keywordtype">bool</span> AllSuccsHaveSame = <span class="keyword">true</span>;</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    <span class="keywordtype">bool</span> NotAllSeqEqualButKnownSafe = <span class="keyword">false</span>;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    <a class="code" href="classllvm_1_1SuccIterator.html">succ_const_iterator</a> SI(TI), SE(TI, <span class="keyword">false</span>);</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    <span class="keywordflow">for</span> (; SI != SE; ++SI) {</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;      <span class="comment">// If VisitBottomUp has pointer information for this successor, take</span></div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      <span class="comment">// what we know about it.</span></div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;::iterator</a> BBI =</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        BBStates.<a class="code" href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">find</a>(*SI);</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;      assert(BBI != BBStates.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>());</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;      <span class="keyword">const</span> PtrState &amp;SuccS = BBI-&gt;second.getPtrBottomUpState(Arg);</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;      <span class="keyword">const</span> <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> SuccSSeq = SuccS.GetSeq();</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;      <span class="comment">// If bottom up, the pointer is in an S_None state, clear the sequence</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;      <span class="comment">// progress since the sequence in the bottom up state finished</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      <span class="comment">// suggesting a mismatch in between retains/releases. This is true for</span></div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;      <span class="comment">// all three cases that we are handling here: S_Retain, S_Use, and</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      <span class="comment">// S_CanRelease.</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      <span class="keywordflow">if</span> (SuccSSeq == S_None) {</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;        S.ClearSequenceProgress();</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      }</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      <span class="comment">// If we have S_Use or S_CanRelease, perform our check for cfg hazard</span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;      <span class="comment">// checks.</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">bool</span> SuccSRRIKnownSafe = SuccS.IsKnownSafe();</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;      <span class="comment">// *NOTE* We do not use Seq from above here since we are allowing for</span></div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;      <span class="comment">// S.GetSeq() to change while we are visiting basic blocks.</span></div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;      <span class="keywordflow">switch</span>(S.GetSeq()) {</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      <span class="keywordflow">case</span> S_Use: {</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        <span class="keywordtype">bool</span> ShouldContinue = <span class="keyword">false</span>;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;        <a class="code" href="group__ARCOpt.html#ga61d78e7fc196dd16165fa1bed1639136">CheckForUseCFGHazard</a>(SuccSSeq, SuccSRRIKnownSafe, S, SomeSuccHasSame,</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;                             AllSuccsHaveSame, NotAllSeqEqualButKnownSafe,</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                             ShouldContinue);</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        <span class="keywordflow">if</span> (ShouldContinue)</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      }</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;      <span class="keywordflow">case</span> S_CanRelease: {</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;        <a class="code" href="group__ARCOpt.html#gad44eeecf3b037cda497f027bf50c8a3a">CheckForCanReleaseCFGHazard</a>(SuccSSeq, SuccSRRIKnownSafe, S,</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                                    SomeSuccHasSame, AllSuccsHaveSame,</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                                    NotAllSeqEqualButKnownSafe);</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;      }</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;      <span class="keywordflow">case</span> S_Retain:</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;      <span class="keywordflow">case</span> S_None:</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;      <span class="keywordflow">case</span> S_Stop:</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;      <span class="keywordflow">case</span> S_Release:</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;      <span class="keywordflow">case</span> S_MovableRelease:</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;      }</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    }</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="comment">// If the state at the other end of any of the successor edges</span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <span class="comment">// matches the current state, require all edges to match. This</span></div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <span class="comment">// guards against loops in the middle of a sequence.</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    <span class="keywordflow">if</span> (SomeSuccHasSame &amp;&amp; !AllSuccsHaveSame) {</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;      S.ClearSequenceProgress();</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NotAllSeqEqualButKnownSafe) {</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      <span class="comment">// If we would have cleared the state foregoing the fact that we are known</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;      <span class="comment">// safe, stop code motion. This is because whether or not it is safe to</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;      <span class="comment">// remove RR pairs via KnownSafe is an orthogonal concept to whether we</span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;      <span class="comment">// are allowed to perform code motion.</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      S.SetCFGHazardAfflicted(<span class="keyword">true</span>);</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    }</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;  }</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;}</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;ObjCARCOpt::VisitInstructionBottomUp(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst,</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;                                     <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB,</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;                                     <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, RRInfo&gt;</a> &amp;Retains,</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;                                     BBState &amp;MyStates) {</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;  <span class="keywordtype">bool</span> NestingDetected = <span class="keyword">false</span>;</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2a">InstructionClass</a> Class = <a class="code" href="namespacellvm_1_1objcarc.html#a775dd3ca9940b5d893932c22a293be32">GetInstructionClass</a>(Inst);</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg = 0;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Class: &quot;</span> &lt;&lt; Class &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;  <span class="keywordflow">switch</span> (Class) {</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa442b643665868538ba47d657c13629e8">IC_Release</a>: {</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    Arg = <a class="code" href="namespacellvm_1_1objcarc.html#a271307f400deec412d9be2949a7bfea3">GetObjCArg</a>(Inst);</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    PtrState &amp;<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = MyStates.getPtrBottomUpState(Arg);</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    <span class="comment">// If we see two releases in a row on the same pointer. If so, make</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    <span class="comment">// a note, and we&#39;ll cicle back to revisit it after we&#39;ve</span></div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    <span class="comment">// hopefully eliminated the second release, which may allow us to</span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;    <span class="comment">// eliminate the first release too.</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    <span class="comment">// Theoretically we could implement removal of nested retain+release</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    <span class="comment">// pairs by making PtrState hold a stack of states, but this is</span></div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    <span class="comment">// simple and avoids adding overhead for the non-nested case.</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    <span class="keywordflow">if</span> (S.GetSeq() == S_Release || S.GetSeq() == S_MovableRelease) {</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found nested releases (i.e. a release pair)\n&quot;</span>);</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;      NestingDetected = <span class="keyword">true</span>;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    }</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *ReleaseMetadata = Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#aafa29112cbe02e4adc9b36752c771991">getMetadata</a>(ImpreciseReleaseMDKind);</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> NewSeq = ReleaseMetadata ? S_MovableRelease : S_Release;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <a class="code" href="group__ARCOpt.html#ga6f340da01646bd4e2fa91be9dd87e01a">ANNOTATE_BOTTOMUP</a>(Inst, Arg, S.GetSeq(), NewSeq);</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    S.ResetSequenceProgress(NewSeq);</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    S.SetReleaseMetadata(ReleaseMetadata);</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    S.SetKnownSafe(S.HasKnownPositiveRefCount());</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    S.SetTailCallRelease(cast&lt;CallInst&gt;(Inst)-&gt;isTailCall());</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    S.InsertCall(Inst);</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    S.SetKnownPositiveRefCount();</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;  }</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aabbf6ec1064199e8c4ecba1aaccf93f47">IC_RetainBlock</a>:</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    <span class="comment">// In OptimizeIndividualCalls, we have strength reduced all optimizable</span></div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <span class="comment">// objc_retainBlocks to objc_retains. Thus at this point any</span></div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="comment">// objc_retainBlocks that we see are not optimizable.</span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaa2c2d6f56cb091ae9470b8fb1e74757d">IC_Retain</a>:</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaa7ab689fdb243382e550bcd4481ab6ef">IC_RetainRV</a>: {</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    Arg = <a class="code" href="namespacellvm_1_1objcarc.html#a271307f400deec412d9be2949a7bfea3">GetObjCArg</a>(Inst);</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    PtrState &amp;<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = MyStates.getPtrBottomUpState(Arg);</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    S.SetKnownPositiveRefCount();</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> OldSeq = S.GetSeq();</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    <span class="keywordflow">switch</span> (OldSeq) {</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    <span class="keywordflow">case</span> S_Stop:</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    <span class="keywordflow">case</span> S_Release:</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    <span class="keywordflow">case</span> S_MovableRelease:</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <span class="keywordflow">case</span> S_Use:</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;      <span class="comment">// If OldSeq is not S_Use or OldSeq is S_Use and we are tracking an</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;      <span class="comment">// imprecise release, clear our reverse insertion points.</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;      <span class="keywordflow">if</span> (OldSeq != S_Use || S.IsTrackingImpreciseReleases())</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;        S.ClearReverseInsertPts();</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;      <span class="comment">// FALL THROUGH</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    <span class="keywordflow">case</span> S_CanRelease:</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;      <span class="comment">// Don&#39;t do retain+release tracking for IC_RetainRV, because it&#39;s</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      <span class="comment">// better to let it remain as the first instruction after a call.</span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      <span class="keywordflow">if</span> (Class != <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaa7ab689fdb243382e550bcd4481ab6ef">IC_RetainRV</a>)</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;        Retains[Inst] = S.GetRRInfo();</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;      S.ClearSequenceProgress();</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="keywordflow">case</span> S_None:</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <span class="keywordflow">case</span> S_Retain:</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;      <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;bottom-up pointer in retain state!&quot;</span>);</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    }</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    <a class="code" href="group__ARCOpt.html#ga6f340da01646bd4e2fa91be9dd87e01a">ANNOTATE_BOTTOMUP</a>(Inst, Arg, OldSeq, S.GetSeq());</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <span class="comment">// A retain moving bottom up can be a use.</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;  }</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa19c5bed13eb8e5eeafa2427c790f5148">IC_AutoreleasepoolPop</a>:</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    <span class="comment">// Conservatively, clear MyStates for all known pointers.</span></div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    MyStates.clearBottomUpPointers();</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <span class="keywordflow">return</span> NestingDetected;</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa043507659210c5bcea4f40804f24d769">IC_AutoreleasepoolPush</a>:</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa3f1e05902d8bb7ed742f01bb311b146e">IC_None</a>:</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    <span class="comment">// These are irrelevant.</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    <span class="keywordflow">return</span> NestingDetected;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaf7cd7b0299e107541779101a8d49a48a">IC_User</a>:</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    <span class="comment">// If we have a store into an alloca of a pointer we are tracking, the</span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    <span class="comment">// pointer has multiple owners implying that we must be more conservative.</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    <span class="comment">// This comes up in the context of a pointer being ``KnownSafe&#39;&#39;. In the</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    <span class="comment">// presense of a block being initialized, the frontend will emit the</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    <span class="comment">// objc_retain on the original pointer and the release on the pointer loaded</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    <span class="comment">// from the alloca. The optimizer will through the provenance analysis</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    <span class="comment">// realize that the two are related, but since we only require KnownSafe in</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    <span class="comment">// one direction, will match the inner retain on the original pointer with</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    <span class="comment">// the guard release on the original pointer. This is fixed by ensuring that</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    <span class="comment">// in the presense of allocas we only unconditionally remove pointers if</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <span class="comment">// both our retain and our release are KnownSafe.</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(Inst)) {</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="group__ARCUtilities.html#ga0ea9cd5bf9acb5ded710efad514f139f">AreAnyUnderlyingObjectsAnAlloca</a>(SI-&gt;getPointerOperand())) {</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;        BBState::ptr_iterator <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MyStates.findPtrBottomUpState(</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;          <a class="code" href="namespacellvm_1_1objcarc.html#a85502898d19c32629e2e17fe94f34985">StripPointerCastsAndObjCCalls</a>(SI-&gt;getValueOperand()));</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        <span class="keywordflow">if</span> (I != MyStates.bottom_up_ptr_end())</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;          MultiOwnersSet.insert(I-&gt;first);</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;      }</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    }</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  }</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  <span class="comment">// Consider any other possible effects of this instruction on each</span></div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;  <span class="comment">// pointer being tracked.</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;  <span class="keywordflow">for</span> (BBState::ptr_iterator <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> = MyStates.bottom_up_ptr_begin(),</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;       ME = MyStates.bottom_up_ptr_end(); <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> != ME; ++<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>) {</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr = <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>-&gt;first;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    <span class="keywordflow">if</span> (Ptr == Arg)</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;      <span class="keywordflow">continue</span>; <span class="comment">// Handled above.</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    PtrState &amp;<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>-&gt;second;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> Seq = S.GetSeq();</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    <span class="comment">// Check for possible releases.</span></div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#a18db47ff404831888e6f4dc327aec5f1">CanAlterRefCount</a>(Inst, Ptr, PA, Class)) {</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;CanAlterRefCount: Seq: &quot;</span> &lt;&lt; Seq &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; *Ptr</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;      S.ClearKnownPositiveRefCount();</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;      <span class="keywordflow">switch</span> (Seq) {</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;      <span class="keywordflow">case</span> S_Use:</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;        S.SetSeq(S_CanRelease);</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;        <a class="code" href="group__ARCOpt.html#ga6f340da01646bd4e2fa91be9dd87e01a">ANNOTATE_BOTTOMUP</a>(Inst, Ptr, Seq, S.GetSeq());</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      <span class="keywordflow">case</span> S_CanRelease:</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;      <span class="keywordflow">case</span> S_Release:</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;      <span class="keywordflow">case</span> S_MovableRelease:</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;      <span class="keywordflow">case</span> S_Stop:</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;      <span class="keywordflow">case</span> S_None:</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      <span class="keywordflow">case</span> S_Retain:</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;        <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;bottom-up pointer in retain state!&quot;</span>);</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;      }</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    }</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    <span class="comment">// Check for possible direct uses.</span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="keywordflow">switch</span> (Seq) {</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    <span class="keywordflow">case</span> S_Release:</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    <span class="keywordflow">case</span> S_MovableRelease:</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#a87f9d4600f3d15f611d99b1781c48d08">CanUse</a>(Inst, Ptr, PA, Class)) {</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;CanUse: Seq: &quot;</span> &lt;&lt; Seq &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; *Ptr</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;        assert(!S.HasReverseInsertPts());</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;        <span class="comment">// If this is an invoke instruction, we&#39;re scanning it as part of</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;        <span class="comment">// one of its successor blocks, since we can&#39;t insert code after it</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;        <span class="comment">// in its own block, and we don&#39;t want to split critical edges.</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;        <span class="keywordflow">if</span> (isa&lt;InvokeInst&gt;(Inst))</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;          S.InsertReverseInsertPt(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ab1cd5a3713b93a33f89a2086d473cf6e">getFirstInsertionPt</a>());</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;          S.InsertReverseInsertPt(<a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a>(Inst)));</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        S.SetSeq(S_Use);</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        <a class="code" href="group__ARCOpt.html#ga6f340da01646bd4e2fa91be9dd87e01a">ANNOTATE_BOTTOMUP</a>(Inst, Ptr, Seq, S_Use);</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Seq == S_Release &amp;&amp; <a class="code" href="namespacellvm_1_1objcarc.html#a8d035a0949c98e914f6b7446b9273eb8">IsUser</a>(Class)) {</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;PreciseReleaseUse: Seq: &quot;</span> &lt;&lt; Seq &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; *Ptr</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;        <span class="comment">// Non-movable releases depend on any possible objc pointer use.</span></div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;        S.SetSeq(S_Stop);</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;        <a class="code" href="group__ARCOpt.html#ga6f340da01646bd4e2fa91be9dd87e01a">ANNOTATE_BOTTOMUP</a>(Inst, Ptr, S_Release, S_Stop);</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        assert(!S.HasReverseInsertPts());</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;        <span class="comment">// As above; handle invoke specially.</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;        <span class="keywordflow">if</span> (isa&lt;InvokeInst&gt;(Inst))</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;          S.InsertReverseInsertPt(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ab1cd5a3713b93a33f89a2086d473cf6e">getFirstInsertionPt</a>());</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;          S.InsertReverseInsertPt(<a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a>(Inst)));</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;      }</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    <span class="keywordflow">case</span> S_Stop:</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#a87f9d4600f3d15f611d99b1781c48d08">CanUse</a>(Inst, Ptr, PA, Class)) {</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;PreciseStopUse: Seq: &quot;</span> &lt;&lt; Seq &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; *Ptr</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;        S.SetSeq(S_Use);</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;        <a class="code" href="group__ARCOpt.html#ga6f340da01646bd4e2fa91be9dd87e01a">ANNOTATE_BOTTOMUP</a>(Inst, Ptr, Seq, S_Use);</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;      }</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    <span class="keywordflow">case</span> S_CanRelease:</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <span class="keywordflow">case</span> S_Use:</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    <span class="keywordflow">case</span> S_None:</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    <span class="keywordflow">case</span> S_Retain:</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;      <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;bottom-up pointer in retain state!&quot;</span>);</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    }</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;  }</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;  <span class="keywordflow">return</span> NestingDetected;</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;}</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;ObjCARCOpt::VisitBottomUp(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB,</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                          <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;</a> &amp;BBStates,</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                          <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, RRInfo&gt;</a> &amp;Retains) {</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n== ObjCARCOpt::VisitBottomUp ==\n&quot;</span>);</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;  <span class="keywordtype">bool</span> NestingDetected = <span class="keyword">false</span>;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;  BBState &amp;MyStates = BBStates[<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>];</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;  <span class="comment">// Merge the states from each successor to compute the initial state</span></div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;  <span class="comment">// for the current block.</span></div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;  BBState::edge_iterator SI(MyStates.succ_begin()),</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;                         SE(MyStates.succ_end());</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;  <span class="keywordflow">if</span> (SI != SE) {</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Succ = *SI;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BBStates.<a class="code" href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">find</a>(Succ);</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    assert(I != BBStates.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>());</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    MyStates.InitFromSucc(I-&gt;second);</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    ++SI;</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    <span class="keywordflow">for</span> (; SI != SE; ++SI) {</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;      Succ = *SI;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;      I = BBStates.<a class="code" href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">find</a>(Succ);</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;      assert(I != BBStates.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>());</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      MyStates.MergeSucc(I-&gt;second);</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    }</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;  }</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;  <span class="comment">// If ARC Annotations are enabled, output the current state of pointers at the</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;  <span class="comment">// bottom of the basic block.</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;  <a class="code" href="group__ARCOpt.html#gaa24d32d1803abde016a7c3a2333bf091">ANNOTATE_BOTTOMUP_BBEND</a>(MyStates, BB);</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;  <span class="comment">// Visit all the instructions, bottom-up.</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(), E = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; --<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = <a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;    <span class="comment">// Invoke instructions are visited as part of their successors (below).</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;    <span class="keywordflow">if</span> (isa&lt;InvokeInst&gt;(Inst))</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Visiting &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;    NestingDetected |= VisitInstructionBottomUp(Inst, BB, Retains, MyStates);</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;  }</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;  <span class="comment">// If there&#39;s a predecessor with an invoke, visit the invoke as if it were</span></div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;  <span class="comment">// part of this block, since we can&#39;t insert code after an invoke in its own</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;  <span class="comment">// block, and we don&#39;t want to split critical edges.</span></div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;  <span class="keywordflow">for</span> (BBState::edge_iterator PI(MyStates.pred_begin()),</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;       PE(MyStates.pred_end()); PI != PE; ++PI) {</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = *PI;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II = dyn_cast&lt;InvokeInst&gt;(&amp;Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6bce6440331683570a283df762902a09">back</a>()))</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;      NestingDetected |= VisitInstructionBottomUp(II, BB, Retains, MyStates);</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;  }</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  <span class="comment">// If ARC Annotations are enabled, output the current state of pointers at the</span></div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;  <span class="comment">// top of the basic block.</span></div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;  <a class="code" href="group__ARCOpt.html#gaca2215704eb21394afd5834ca3a8bd8d">ANNOTATE_BOTTOMUP_BBSTART</a>(MyStates, BB);</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;  <span class="keywordflow">return</span> NestingDetected;</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;}</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;ObjCARCOpt::VisitInstructionTopDown(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst,</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                                    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, RRInfo&gt;</a> &amp;Releases,</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;                                    BBState &amp;MyStates) {</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;  <span class="keywordtype">bool</span> NestingDetected = <span class="keyword">false</span>;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;  <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2a">InstructionClass</a> Class = <a class="code" href="namespacellvm_1_1objcarc.html#a775dd3ca9940b5d893932c22a293be32">GetInstructionClass</a>(Inst);</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg = 0;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;  <span class="keywordflow">switch</span> (Class) {</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aabbf6ec1064199e8c4ecba1aaccf93f47">IC_RetainBlock</a>:</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    <span class="comment">// In OptimizeIndividualCalls, we have strength reduced all optimizable</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;    <span class="comment">// objc_retainBlocks to objc_retains. Thus at this point any</span></div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    <span class="comment">// objc_retainBlocks that we see are not optimizable.</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaa2c2d6f56cb091ae9470b8fb1e74757d">IC_Retain</a>:</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaa7ab689fdb243382e550bcd4481ab6ef">IC_RetainRV</a>: {</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    Arg = <a class="code" href="namespacellvm_1_1objcarc.html#a271307f400deec412d9be2949a7bfea3">GetObjCArg</a>(Inst);</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    PtrState &amp;<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = MyStates.getPtrTopDownState(Arg);</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    <span class="comment">// Don&#39;t do retain+release tracking for IC_RetainRV, because it&#39;s</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    <span class="comment">// better to let it remain as the first instruction after a call.</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    <span class="keywordflow">if</span> (Class != <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaa7ab689fdb243382e550bcd4481ab6ef">IC_RetainRV</a>) {</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;      <span class="comment">// If we see two retains in a row on the same pointer. If so, make</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;      <span class="comment">// a note, and we&#39;ll cicle back to revisit it after we&#39;ve</span></div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;      <span class="comment">// hopefully eliminated the second retain, which may allow us to</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;      <span class="comment">// eliminate the first retain too.</span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;      <span class="comment">// Theoretically we could implement removal of nested retain+release</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;      <span class="comment">// pairs by making PtrState hold a stack of states, but this is</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;      <span class="comment">// simple and avoids adding overhead for the non-nested case.</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;      <span class="keywordflow">if</span> (S.GetSeq() == S_Retain)</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;        NestingDetected = <span class="keyword">true</span>;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;      <a class="code" href="group__ARCOpt.html#gaba2c11e914151022314fc9e623d55597">ANNOTATE_TOPDOWN</a>(Inst, Arg, S.GetSeq(), S_Retain);</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;      S.ResetSequenceProgress(S_Retain);</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;      S.SetKnownSafe(S.HasKnownPositiveRefCount());</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;      S.InsertCall(Inst);</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    }</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    S.SetKnownPositiveRefCount();</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    <span class="comment">// A retain can be a potential use; procede to the generic checking</span></div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    <span class="comment">// code below.</span></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;  }</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa442b643665868538ba47d657c13629e8">IC_Release</a>: {</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    Arg = <a class="code" href="namespacellvm_1_1objcarc.html#a271307f400deec412d9be2949a7bfea3">GetObjCArg</a>(Inst);</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    PtrState &amp;<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = MyStates.getPtrTopDownState(Arg);</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;    S.ClearKnownPositiveRefCount();</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;    <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> OldSeq = S.GetSeq();</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *ReleaseMetadata = Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#aafa29112cbe02e4adc9b36752c771991">getMetadata</a>(ImpreciseReleaseMDKind);</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    <span class="keywordflow">switch</span> (OldSeq) {</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    <span class="keywordflow">case</span> S_Retain:</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;    <span class="keywordflow">case</span> S_CanRelease:</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;      <span class="keywordflow">if</span> (OldSeq == S_Retain || ReleaseMetadata != 0)</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;        S.ClearReverseInsertPts();</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;      <span class="comment">// FALL THROUGH</span></div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    <span class="keywordflow">case</span> S_Use:</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;      S.SetReleaseMetadata(ReleaseMetadata);</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;      S.SetTailCallRelease(cast&lt;CallInst&gt;(Inst)-&gt;isTailCall());</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;      Releases[Inst] = S.GetRRInfo();</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;      <a class="code" href="group__ARCOpt.html#gaba2c11e914151022314fc9e623d55597">ANNOTATE_TOPDOWN</a>(Inst, Arg, S.GetSeq(), S_None);</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;      S.ClearSequenceProgress();</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <span class="keywordflow">case</span> S_None:</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <span class="keywordflow">case</span> S_Stop:</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;    <span class="keywordflow">case</span> S_Release:</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    <span class="keywordflow">case</span> S_MovableRelease:</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;      <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;top-down pointer in release state!&quot;</span>);</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;    }</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;  }</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa19c5bed13eb8e5eeafa2427c790f5148">IC_AutoreleasepoolPop</a>:</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    <span class="comment">// Conservatively, clear MyStates for all known pointers.</span></div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    MyStates.clearTopDownPointers();</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    <span class="keywordflow">return</span> NestingDetected;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa043507659210c5bcea4f40804f24d769">IC_AutoreleasepoolPush</a>:</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa3f1e05902d8bb7ed742f01bb311b146e">IC_None</a>:</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    <span class="comment">// These are irrelevant.</span></div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;    <span class="keywordflow">return</span> NestingDetected;</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;  }</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;  <span class="comment">// Consider any other possible effects of this instruction on each</span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;  <span class="comment">// pointer being tracked.</span></div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;  <span class="keywordflow">for</span> (BBState::ptr_iterator <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> = MyStates.top_down_ptr_begin(),</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;       ME = MyStates.top_down_ptr_end(); <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> != ME; ++<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>) {</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr = <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>-&gt;first;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    <span class="keywordflow">if</span> (Ptr == Arg)</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;      <span class="keywordflow">continue</span>; <span class="comment">// Handled above.</span></div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    PtrState &amp;<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a> = <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>-&gt;second;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    <a class="code" href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a> Seq = S.GetSeq();</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;    <span class="comment">// Check for possible releases.</span></div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#a18db47ff404831888e6f4dc327aec5f1">CanAlterRefCount</a>(Inst, Ptr, PA, Class)) {</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;CanAlterRefCount: Seq: &quot;</span> &lt;&lt; Seq &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; *Ptr</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;      S.ClearKnownPositiveRefCount();</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;      <span class="keywordflow">switch</span> (Seq) {</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;      <span class="keywordflow">case</span> S_Retain:</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;        S.SetSeq(S_CanRelease);</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;        <a class="code" href="group__ARCOpt.html#gaba2c11e914151022314fc9e623d55597">ANNOTATE_TOPDOWN</a>(Inst, Ptr, Seq, S_CanRelease);</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;        assert(!S.HasReverseInsertPts());</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;        S.InsertReverseInsertPt(Inst);</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;        <span class="comment">// One call can&#39;t cause a transition from S_Retain to S_CanRelease</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;        <span class="comment">// and S_CanRelease to S_Use. If we&#39;ve made the first transition,</span></div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        <span class="comment">// we&#39;re done.</span></div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;      <span class="keywordflow">case</span> S_Use:</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;      <span class="keywordflow">case</span> S_CanRelease:</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;      <span class="keywordflow">case</span> S_None:</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;      <span class="keywordflow">case</span> S_Stop:</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;      <span class="keywordflow">case</span> S_Release:</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;      <span class="keywordflow">case</span> S_MovableRelease:</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;        <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;top-down pointer in release state!&quot;</span>);</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;      }</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;    }</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    <span class="comment">// Check for possible direct uses.</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    <span class="keywordflow">switch</span> (Seq) {</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    <span class="keywordflow">case</span> S_CanRelease:</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#a87f9d4600f3d15f611d99b1781c48d08">CanUse</a>(Inst, Ptr, PA, Class)) {</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;CanUse: Seq: &quot;</span> &lt;&lt; Seq &lt;&lt; <span class="stringliteral">&quot;; &quot;</span> &lt;&lt; *Ptr</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;        S.SetSeq(S_Use);</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;        <a class="code" href="group__ARCOpt.html#gaba2c11e914151022314fc9e623d55597">ANNOTATE_TOPDOWN</a>(Inst, Ptr, Seq, S_Use);</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;      }</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;    <span class="keywordflow">case</span> S_Retain:</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;    <span class="keywordflow">case</span> S_Use:</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;    <span class="keywordflow">case</span> S_None:</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;    <span class="keywordflow">case</span> S_Stop:</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;    <span class="keywordflow">case</span> S_Release:</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;    <span class="keywordflow">case</span> S_MovableRelease:</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;      <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;top-down pointer in release state!&quot;</span>);</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    }</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;  }</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;  <span class="keywordflow">return</span> NestingDetected;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;}</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;ObjCARCOpt::VisitTopDown(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB,</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;                         <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;</a> &amp;BBStates,</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;                         <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, RRInfo&gt;</a> &amp;Releases) {</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n== ObjCARCOpt::VisitTopDown ==\n&quot;</span>);</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;  <span class="keywordtype">bool</span> NestingDetected = <span class="keyword">false</span>;</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;  BBState &amp;MyStates = BBStates[<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>];</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;  <span class="comment">// Merge the states from each predecessor to compute the initial state</span></div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;  <span class="comment">// for the current block.</span></div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;  BBState::edge_iterator PI(MyStates.pred_begin()),</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;                         PE(MyStates.pred_end());</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;  <span class="keywordflow">if</span> (PI != PE) {</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = *PI;</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BBStates.<a class="code" href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">find</a>(Pred);</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;    assert(I != BBStates.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>());</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;    MyStates.InitFromPred(I-&gt;second);</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;    ++PI;</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;    <span class="keywordflow">for</span> (; PI != PE; ++PI) {</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;      Pred = *PI;</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;      I = BBStates.<a class="code" href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">find</a>(Pred);</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;      assert(I != BBStates.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>());</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;      MyStates.MergePred(I-&gt;second);</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;    }</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;  }</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;  <span class="comment">// If ARC Annotations are enabled, output the current state of pointers at the</span></div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;  <span class="comment">// top of the basic block.</span></div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;  <a class="code" href="group__ARCOpt.html#gae17710516ddda1ff2b53b6a198dac754">ANNOTATE_TOPDOWN_BBSTART</a>(MyStates, BB);</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;  <span class="comment">// Visit all the instructions, top-down.</span></div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), E = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Visiting &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    NestingDetected |= VisitInstructionTopDown(Inst, Releases, MyStates);</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;  }</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;  <span class="comment">// If ARC Annotations are enabled, output the current state of pointers at the</span></div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;  <span class="comment">// bottom of the basic block.</span></div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;  <a class="code" href="group__ARCOpt.html#gad7170a77f0d0dab67cfd7b20756043ec">ANNOTATE_TOPDOWN_BBEND</a>(MyStates, BB);</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;<span class="preprocessor">#ifdef ARC_ANNOTATIONS</span></div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;  <span class="keywordflow">if</span> (!(<a class="code" href="group__ARCOpt.html#ga4320fed90984fab278ec601fb74c5dfe">EnableARCAnnotations</a> &amp;&amp; <a class="code" href="group__ARCOpt.html#ga8ad945d6af5e5e566ce8fa704e617de3">DisableCheckForCFGHazards</a>))</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;  CheckForCFGHazards(BB, BBStates, MyStates);</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;  <span class="keywordflow">return</span> NestingDetected;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;}</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line"><a name="l02178"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#gac3778bafa67cdae223698e5bba785a76"> 2178</a></span>&#160;<a class="code" href="group__ARCOpt.html#gac3778bafa67cdae223698e5bba785a76">ComputePostOrders</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F,</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;                  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;BasicBlock *&gt;</a> &amp;PostOrder,</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;                  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;BasicBlock *&gt;</a> &amp;ReverseCFGPostOrder,</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;                  <span class="keywordtype">unsigned</span> NoObjCARCExceptionsMDKind,</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;                  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;</a> &amp;BBStates) {<span class="comment"></span></div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;<span class="comment">  /// The visited set, for doing DFS walks.</span></div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 16&gt;</a> Visited;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;  <span class="comment">// Do DFS, computing the PostOrder.</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 16&gt;</a> OnStack;</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;BasicBlock *, succ_iterator&gt;</a>, 16&gt; SuccStack;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;  <span class="comment">// Functions always have exactly one entry block, and we don&#39;t have</span></div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;  <span class="comment">// any other block that we treat like an entry block.</span></div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *EntryBB = &amp;F.<a class="code" href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">getEntryBlock</a>();</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;  BBState &amp;MyStates = BBStates[EntryBB];</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;  MyStates.SetAsEntry();</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;  <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *EntryTI = cast&lt;TerminatorInst&gt;(&amp;EntryBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6bce6440331683570a283df762902a09">back</a>());</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;  SuccStack.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(EntryBB, <a class="code" href="namespacellvm.html#a78dbfbdf83fd4c3146e47f6c877db842">succ_iterator</a>(EntryTI)));</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;  Visited.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(EntryBB);</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;  OnStack.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(EntryBB);</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;  dfs_next_succ:</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CurrBB = SuccStack.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>().first;</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *TI = cast&lt;TerminatorInst&gt;(&amp;CurrBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6bce6440331683570a283df762902a09">back</a>());</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    <a class="code" href="classllvm_1_1SuccIterator.html">succ_iterator</a> SE(TI, <span class="keyword">false</span>);</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;    <span class="keywordflow">while</span> (SuccStack.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>().second != SE) {</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SuccBB = *SuccStack.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>().second++;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;      <span class="keywordflow">if</span> (Visited.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(SuccBB)) {</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        <a class="code" href="classllvm_1_1TerminatorInst.html">TerminatorInst</a> *TI = cast&lt;TerminatorInst&gt;(&amp;SuccBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6bce6440331683570a283df762902a09">back</a>());</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;        SuccStack.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(SuccBB, <a class="code" href="namespacellvm.html#a78dbfbdf83fd4c3146e47f6c877db842">succ_iterator</a>(TI)));</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;        BBStates[CurrBB].addSucc(SuccBB);</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;        BBState &amp;SuccStates = BBStates[SuccBB];</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;        SuccStates.addPred(CurrBB);</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;        OnStack.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(SuccBB);</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        <span class="keywordflow">goto</span> dfs_next_succ;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;      }</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;      <span class="keywordflow">if</span> (!OnStack.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(SuccBB)) {</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;        BBStates[CurrBB].addSucc(SuccBB);</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;        BBStates[SuccBB].addPred(CurrBB);</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      }</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;    }</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;    OnStack.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ce650c1d4a48661b501206d04b6ab04">erase</a>(CurrBB);</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    PostOrder.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(CurrBB);</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    SuccStack.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#a1f2303df9bbee2233c11d61c2f6f7930">pop_back</a>();</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;  } <span class="keywordflow">while</span> (!SuccStack.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>());</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;  Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#aa72472422d95c7052d62432ec279ff85">clear</a>();</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;  <span class="comment">// Do reverse-CFG DFS, computing the reverse-CFG PostOrder.</span></div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;  <span class="comment">// Functions may have many exits, and there also blocks which we treat</span></div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;  <span class="comment">// as exits due to ignored edges.</span></div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;BasicBlock *, BBState::edge_iterator&gt;</a>, 16&gt; PredStack;</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Function::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = F.<a class="code" href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">begin</a>(), E = F.<a class="code" href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ExitBB = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;    BBState &amp;MyStates = BBStates[ExitBB];</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    <span class="keywordflow">if</span> (!MyStates.isExit())</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    MyStates.SetAsExit();</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    PredStack.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(ExitBB, MyStates.pred_begin()));</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;    Visited.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(ExitBB);</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;    <span class="keywordflow">while</span> (!PredStack.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;    reverse_dfs_next_succ:</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;      BBState::edge_iterator PE = BBStates[PredStack.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>().first].pred_end();</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;      <span class="keywordflow">while</span> (PredStack.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>().second != PE) {</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;        <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB = *PredStack.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>().second++;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;        <span class="keywordflow">if</span> (Visited.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(BB)) {</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;          PredStack.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(BB, BBStates[BB].<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>()));</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;          <span class="keywordflow">goto</span> reverse_dfs_next_succ;</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;        }</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;      }</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;      ReverseCFGPostOrder.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(PredStack.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>().first);</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;    }</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;  }</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;}</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;<span class="comment">// Visit the function both top-down and bottom-up.</span></div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;ObjCARCOpt::Visit(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F,</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;                  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;</a> &amp;BBStates,</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;                  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, RRInfo&gt;</a> &amp;Retains,</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, RRInfo&gt;</a> &amp;Releases) {</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;  <span class="comment">// Use reverse-postorder traversals, because we magically know that loops</span></div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;  <span class="comment">// will be well behaved, i.e. they won&#39;t repeatedly call retain on a single</span></div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;  <span class="comment">// pointer without doing a release. We can&#39;t use the ReversePostOrderTraversal</span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;  <span class="comment">// class here because we want the reverse-CFG postorder to consider each</span></div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;  <span class="comment">// function exit point, and we want to ignore selected cycle edges.</span></div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 16&gt;</a> PostOrder;</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 16&gt;</a> ReverseCFGPostOrder;</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;  <a class="code" href="group__ARCOpt.html#gac3778bafa67cdae223698e5bba785a76">ComputePostOrders</a>(F, PostOrder, ReverseCFGPostOrder,</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;                    NoObjCARCExceptionsMDKind,</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                    BBStates);</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;  <span class="comment">// Use reverse-postorder on the reverse CFG for bottom-up.</span></div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;  <span class="keywordtype">bool</span> BottomUpNestingDetected = <span class="keyword">false</span>;</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;BasicBlock *&gt;::const_reverse_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> =</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;       ReverseCFGPostOrder.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a23aab542398091e1fcfd46b6006d64ac">rbegin</a>(), E = ReverseCFGPostOrder.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#ad696953257cf1c4e5bd12d02146e7287">rend</a>();</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    BottomUpNestingDetected |= VisitBottomUp(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BBStates, Retains);</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;  <span class="comment">// Use reverse-postorder for top-down.</span></div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;  <span class="keywordtype">bool</span> TopDownNestingDetected = <span class="keyword">false</span>;</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;BasicBlock *&gt;::const_reverse_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> =</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;       PostOrder.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a23aab542398091e1fcfd46b6006d64ac">rbegin</a>(), E = PostOrder.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#ad696953257cf1c4e5bd12d02146e7287">rend</a>();</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    TopDownNestingDetected |= VisitTopDown(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BBStates, Releases);</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;  <span class="keywordflow">return</span> TopDownNestingDetected &amp;&amp; BottomUpNestingDetected;</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;}</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;<span class="comment">/// Move the calls in RetainsToMove and ReleasesToMove.</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ObjCARCOpt::MoveCalls(<a class="code" href="classllvm_1_1Value.html">Value</a> *Arg,</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;                           RRInfo &amp;RetainsToMove,</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;                           RRInfo &amp;ReleasesToMove,</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;                           <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, RRInfo&gt;</a> &amp;Retains,</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                           <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, RRInfo&gt;</a> &amp;Releases,</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;                           <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;DeadInsts,</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;                           <a class="code" href="classllvm_1_1Module.html">Module</a> *<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>) {</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *ArgTy = Arg-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>();</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *ParamTy = <a class="code" href="classllvm_1_1PointerType.html#a8db49fd5069f21d514e7bb0fd11f0902">PointerType::getUnqual</a>(<a class="code" href="classllvm_1_1Type.html#a7ba5de75f50bb4a4ba920698edf39b28">Type::getInt8Ty</a>(ArgTy-&gt;<a class="code" href="classllvm_1_1Type.html#af348d5ea83429d08ba891ca3dd0e92b2">getContext</a>()));</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;== ObjCARCOpt::MoveCalls ==\n&quot;</span>);</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;  <span class="comment">// Insert the new retain and release calls.</span></div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;Instruction *, 2&gt;::const_iterator</a></div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;       PI = ReleasesToMove.ReverseInsertPts.begin(),</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;       PE = ReleasesToMove.ReverseInsertPts.end(); PI != PE; ++PI) {</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertPt = *PI;</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *MyArg = ArgTy == ParamTy ? Arg :</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;                   <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(Arg, ParamTy, <span class="stringliteral">&quot;&quot;</span>, InsertPt);</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Decl = EP.get(<a class="code" href="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints.html#a8c0ce6d07197d6b03c59e80ea8b6c33ba4cabea25d6f015e582feb5eed1f97a81">ARCRuntimeEntryPoints::EPT_Retain</a>);</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;    <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *<a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Call</a> = <a class="code" href="classllvm_1_1CallInst.html#a861226dd056dd2438da26760b8e7a9a0">CallInst::Create</a>(Decl, MyArg, <span class="stringliteral">&quot;&quot;</span>, InsertPt);</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;    Call-&gt;<a class="code" href="classllvm_1_1CallInst.html#aaa3de05ef40ccacdcbc0326c1d951ad4">setDoesNotThrow</a>();</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;    Call-&gt;<a class="code" href="classllvm_1_1CallInst.html#ad54481e3c992b555aeaba34a83daf7e6">setTailCall</a>();</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Inserting new Retain: &quot;</span> &lt;&lt; *Call &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;                    <span class="stringliteral">&quot;At insertion point: &quot;</span> &lt;&lt; *InsertPt &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;  }</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;Instruction *, 2&gt;::const_iterator</a></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;       PI = RetainsToMove.ReverseInsertPts.begin(),</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;       PE = RetainsToMove.ReverseInsertPts.end(); PI != PE; ++PI) {</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertPt = *PI;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *MyArg = ArgTy == ParamTy ? Arg :</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;                   <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(Arg, ParamTy, <span class="stringliteral">&quot;&quot;</span>, InsertPt);</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Decl = EP.get(<a class="code" href="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints.html#a8c0ce6d07197d6b03c59e80ea8b6c33ba82db7aa366c43e3d4c969b9159bc6d76">ARCRuntimeEntryPoints::EPT_Release</a>);</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;    <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *<a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Call</a> = <a class="code" href="classllvm_1_1CallInst.html#a861226dd056dd2438da26760b8e7a9a0">CallInst::Create</a>(Decl, MyArg, <span class="stringliteral">&quot;&quot;</span>, InsertPt);</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;    <span class="comment">// Attach a clang.imprecise_release metadata tag, if appropriate.</span></div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *M = ReleasesToMove.ReleaseMetadata)</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;      Call-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(ImpreciseReleaseMDKind, M);</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;    Call-&gt;<a class="code" href="classllvm_1_1CallInst.html#aaa3de05ef40ccacdcbc0326c1d951ad4">setDoesNotThrow</a>();</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;    <span class="keywordflow">if</span> (ReleasesToMove.IsTailCallRelease)</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;      Call-&gt;<a class="code" href="classllvm_1_1CallInst.html#ad54481e3c992b555aeaba34a83daf7e6">setTailCall</a>();</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Inserting new Release: &quot;</span> &lt;&lt; *Call &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;                    <span class="stringliteral">&quot;At insertion point: &quot;</span> &lt;&lt; *InsertPt &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;  }</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;  <span class="comment">// Delete the original retain and release calls.</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;Instruction *, 2&gt;::const_iterator</a></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;       AI = RetainsToMove.Calls.begin(),</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;       AE = RetainsToMove.Calls.end(); AI != AE; ++AI) {</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *OrigRetain = *AI;</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    Retains.blot(OrigRetain);</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(OrigRetain);</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Deleting retain: &quot;</span> &lt;&lt; *OrigRetain &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;  }</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;Instruction *, 2&gt;::const_iterator</a></div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;       AI = ReleasesToMove.Calls.begin(),</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;       AE = ReleasesToMove.Calls.end(); AI != AE; ++AI) {</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *OrigRelease = *AI;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    Releases.<a class="code" href="classllvm_1_1DenseMapBase.html#a269c7b8adcd29645a4f901196fc08806">erase</a>(OrigRelease);</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(OrigRelease);</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Deleting release: &quot;</span> &lt;&lt; *OrigRelease &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;  }</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;}</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;ObjCARCOpt::ConnectTDBUTraversals(<a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;</a></div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;                                    &amp;BBStates,</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;                                  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, RRInfo&gt;</a> &amp;Retains,</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;                                  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, RRInfo&gt;</a> &amp;Releases,</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;                                  <a class="code" href="classllvm_1_1Module.html">Module</a> *M,</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;                                  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;NewRetains,</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;                                  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;NewReleases,</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;                                  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;</a> &amp;DeadInsts,</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;                                  RRInfo &amp;RetainsToMove,</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;                                  RRInfo &amp;ReleasesToMove,</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;                                  <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg,</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;                                  <span class="keywordtype">bool</span> KnownSafe,</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;                                  <span class="keywordtype">bool</span> &amp;AnyPairsCompletelyEliminated) {</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;  <span class="comment">// If a pair happens in a region where it is known that the reference count</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;  <span class="comment">// is already incremented, we can similarly ignore possible decrements unless</span></div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;  <span class="comment">// we are dealing with a retainable object with multiple provenance sources.</span></div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;  <span class="keywordtype">bool</span> KnownSafeTD = <span class="keyword">true</span>, KnownSafeBU = <span class="keyword">true</span>;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;  <span class="keywordtype">bool</span> MultipleOwners = <span class="keyword">false</span>;</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;  <span class="keywordtype">bool</span> CFGHazardAfflicted = <span class="keyword">false</span>;</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;  <span class="comment">// Connect the dots between the top-down-collected RetainsToMove and</span></div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;  <span class="comment">// bottom-up-collected ReleasesToMove to form sets of related calls.</span></div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;  <span class="comment">// This is an iterative process so that we connect multiple releases</span></div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;  <span class="comment">// to multiple retains if needed.</span></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  <span class="keywordtype">unsigned</span> OldDelta = 0;</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;  <span class="keywordtype">unsigned</span> NewDelta = 0;</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;  <span class="keywordtype">unsigned</span> OldCount = 0;</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;  <span class="keywordtype">unsigned</span> NewCount = 0;</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;  <span class="keywordtype">bool</span> FirstRelease = <span class="keyword">true</span>;</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;  <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;::const_iterator</a></div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;           NI = NewRetains.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a0555f297eceee28e5fc20d282dfeb8f4">NE</a> = NewRetains.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); NI != <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a0555f297eceee28e5fc20d282dfeb8f4">NE</a>; ++NI) {</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NewRetain = *NI;</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;      MapVector&lt;Value *, RRInfo&gt;::const_iterator It = Retains.<a class="code" href="classllvm_1_1MapVector.html#a6b0c3e15c351ba9682837c29b0a141b6">find</a>(NewRetain);</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;      assert(It != Retains.<a class="code" href="classllvm_1_1MapVector.html#a0881334358ff6ff7ff8cea5562c7988e">end</a>());</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;      <span class="keyword">const</span> RRInfo &amp;NewRetainRRI = It-&gt;second;</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;      KnownSafeTD &amp;= NewRetainRRI.KnownSafe;</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;      MultipleOwners =</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;        MultipleOwners || MultiOwnersSet.<a class="code" href="classllvm_1_1MapVector.html#ac2854f4232f02080c4e2105b84359a0e">count</a>(<a class="code" href="namespacellvm_1_1objcarc.html#a271307f400deec412d9be2949a7bfea3">GetObjCArg</a>(NewRetain));</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;Instruction *, 2&gt;::const_iterator</a></div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;             LI = NewRetainRRI.Calls.begin(),</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;             <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588">LE</a> = NewRetainRRI.Calls.end(); LI != <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588">LE</a>; ++LI) {</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NewRetainRelease = *LI;</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;        <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, RRInfo&gt;::const_iterator</a> Jt =</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;          Releases.<a class="code" href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">find</a>(NewRetainRelease);</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;        <span class="keywordflow">if</span> (Jt == Releases.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>())</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;        <span class="keyword">const</span> RRInfo &amp;NewRetainReleaseRRI = Jt-&gt;second;</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;        <span class="comment">// If the release does not have a reference to the retain as well,</span></div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;        <span class="comment">// something happened which is unaccounted for. Do not do anything.</span></div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;        <span class="comment">// This can happen if we catch an additive overflow during path count</span></div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;        <span class="comment">// merging.</span></div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;        <span class="keywordflow">if</span> (!NewRetainReleaseRRI.Calls.count(NewRetain))</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;        <span class="keywordflow">if</span> (ReleasesToMove.Calls.insert(NewRetainRelease)) {</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;          <span class="comment">// If we overflow when we compute the path count, don&#39;t remove/move</span></div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;          <span class="comment">// anything.</span></div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;          <span class="keyword">const</span> BBState &amp;NRRBBState = BBStates[NewRetainRelease-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()];</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;          <span class="keywordtype">unsigned</span> PathCount = BBState::OverflowOccurredValue;</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;          <span class="keywordflow">if</span> (NRRBBState.GetAllPathCountWithOverflow(PathCount))</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;          assert(PathCount != BBState::OverflowOccurredValue &amp;&amp;</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;                 <span class="stringliteral">&quot;PathCount at this point can not be &quot;</span></div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;                 <span class="stringliteral">&quot;OverflowOccurredValue.&quot;</span>);</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;          OldDelta -= PathCount;</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;          <span class="comment">// Merge the ReleaseMetadata and IsTailCallRelease values.</span></div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;          <span class="keywordflow">if</span> (FirstRelease) {</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;            ReleasesToMove.ReleaseMetadata =</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;              NewRetainReleaseRRI.ReleaseMetadata;</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;            ReleasesToMove.IsTailCallRelease =</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;              NewRetainReleaseRRI.IsTailCallRelease;</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;            FirstRelease = <span class="keyword">false</span>;</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;            <span class="keywordflow">if</span> (ReleasesToMove.ReleaseMetadata !=</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                NewRetainReleaseRRI.ReleaseMetadata)</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;              ReleasesToMove.ReleaseMetadata = 0;</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;            <span class="keywordflow">if</span> (ReleasesToMove.IsTailCallRelease !=</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                NewRetainReleaseRRI.IsTailCallRelease)</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;              ReleasesToMove.IsTailCallRelease = <span class="keyword">false</span>;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;          }</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;          <span class="comment">// Collect the optimal insertion points.</span></div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;          <span class="keywordflow">if</span> (!KnownSafe)</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;Instruction *, 2&gt;::const_iterator</a></div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;                   RI = NewRetainReleaseRRI.ReverseInsertPts.begin(),</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;                   RE = NewRetainReleaseRRI.ReverseInsertPts.end();</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                 RI != RE; ++RI) {</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;              <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *RIP = *RI;</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;              <span class="keywordflow">if</span> (ReleasesToMove.ReverseInsertPts.insert(RIP)) {</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                <span class="comment">// If we overflow when we compute the path count, don&#39;t</span></div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;                <span class="comment">// remove/move anything.</span></div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                <span class="keyword">const</span> BBState &amp;RIPBBState = BBStates[RIP-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()];</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;                PathCount = BBState::OverflowOccurredValue;</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                <span class="keywordflow">if</span> (RIPBBState.GetAllPathCountWithOverflow(PathCount))</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;                  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;                assert(PathCount != BBState::OverflowOccurredValue &amp;&amp;</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;                       <span class="stringliteral">&quot;PathCount at this point can not be &quot;</span></div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;                       <span class="stringliteral">&quot;OverflowOccurredValue.&quot;</span>);</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;                NewDelta -= PathCount;</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;              }</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;            }</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;          NewReleases.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(NewRetainRelease);</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;        }</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;      }</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    }</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;    NewRetains.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;    <span class="keywordflow">if</span> (NewReleases.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) <span class="keywordflow">break</span>;</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    <span class="comment">// Back the other way.</span></div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction *&gt;::const_iterator</a></div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;           NI = NewReleases.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a0555f297eceee28e5fc20d282dfeb8f4">NE</a> = NewReleases.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); NI != <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a0555f297eceee28e5fc20d282dfeb8f4">NE</a>; ++NI) {</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NewRelease = *NI;</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;      <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, RRInfo&gt;::const_iterator</a> It =</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;        Releases.<a class="code" href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">find</a>(NewRelease);</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;      assert(It != Releases.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>());</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;      <span class="keyword">const</span> RRInfo &amp;NewReleaseRRI = It-&gt;second;</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;      KnownSafeBU &amp;= NewReleaseRRI.KnownSafe;</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;      CFGHazardAfflicted |= NewReleaseRRI.CFGHazardAfflicted;</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;Instruction *, 2&gt;::const_iterator</a></div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;             LI = NewReleaseRRI.Calls.begin(),</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;             <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588">LE</a> = NewReleaseRRI.Calls.end(); LI != <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588">LE</a>; ++LI) {</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NewReleaseRetain = *LI;</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;        MapVector&lt;Value *, RRInfo&gt;::const_iterator Jt =</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;          Retains.<a class="code" href="classllvm_1_1MapVector.html#a6b0c3e15c351ba9682837c29b0a141b6">find</a>(NewReleaseRetain);</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;        <span class="keywordflow">if</span> (Jt == Retains.<a class="code" href="classllvm_1_1MapVector.html#a0881334358ff6ff7ff8cea5562c7988e">end</a>())</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;        <span class="keyword">const</span> RRInfo &amp;NewReleaseRetainRRI = Jt-&gt;second;</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;        <span class="comment">// If the retain does not have a reference to the release as well,</span></div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;        <span class="comment">// something happened which is unaccounted for. Do not do anything.</span></div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;        <span class="comment">// This can happen if we catch an additive overflow during path count</span></div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;        <span class="comment">// merging.</span></div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;        <span class="keywordflow">if</span> (!NewReleaseRetainRRI.Calls.count(NewRelease))</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;        <span class="keywordflow">if</span> (RetainsToMove.Calls.insert(NewReleaseRetain)) {</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;          <span class="comment">// If we overflow when we compute the path count, don&#39;t remove/move</span></div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;          <span class="comment">// anything.</span></div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;          <span class="keyword">const</span> BBState &amp;NRRBBState = BBStates[NewReleaseRetain-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()];</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;          <span class="keywordtype">unsigned</span> PathCount = BBState::OverflowOccurredValue;</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;          <span class="keywordflow">if</span> (NRRBBState.GetAllPathCountWithOverflow(PathCount))</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;          assert(PathCount != BBState::OverflowOccurredValue &amp;&amp;</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;                 <span class="stringliteral">&quot;PathCount at this point can not be &quot;</span></div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;                 <span class="stringliteral">&quot;OverflowOccurredValue.&quot;</span>);</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;          OldDelta += PathCount;</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;          OldCount += PathCount;</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;          <span class="comment">// Collect the optimal insertion points.</span></div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;          <span class="keywordflow">if</span> (!KnownSafe)</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;Instruction *, 2&gt;::const_iterator</a></div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;                   RI = NewReleaseRetainRRI.ReverseInsertPts.begin(),</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;                   RE = NewReleaseRetainRRI.ReverseInsertPts.end();</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;                 RI != RE; ++RI) {</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;              <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *RIP = *RI;</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;              <span class="keywordflow">if</span> (RetainsToMove.ReverseInsertPts.insert(RIP)) {</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;                <span class="comment">// If we overflow when we compute the path count, don&#39;t</span></div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;                <span class="comment">// remove/move anything.</span></div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;                <span class="keyword">const</span> BBState &amp;RIPBBState = BBStates[RIP-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()];</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;                PathCount = BBState::OverflowOccurredValue;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;                <span class="keywordflow">if</span> (RIPBBState.GetAllPathCountWithOverflow(PathCount))</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;                  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;                assert(PathCount != BBState::OverflowOccurredValue &amp;&amp;</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;                       <span class="stringliteral">&quot;PathCount at this point can not be &quot;</span></div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;                       <span class="stringliteral">&quot;OverflowOccurredValue.&quot;</span>);</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;                NewDelta += PathCount;</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;                NewCount += PathCount;</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;              }</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;            }</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;          NewRetains.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(NewReleaseRetain);</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;        }</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;      }</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;    }</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    NewReleases.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;    <span class="keywordflow">if</span> (NewRetains.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) <span class="keywordflow">break</span>;</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;  }</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;  <span class="comment">// If the pointer is known incremented in 1 direction and we do not have</span></div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;  <span class="comment">// MultipleOwners, we can safely remove the retain/releases. Otherwise we need</span></div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;  <span class="comment">// to be known safe in both directions.</span></div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;  <span class="keywordtype">bool</span> UnconditionallySafe = (KnownSafeTD &amp;&amp; KnownSafeBU) ||</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;    ((KnownSafeTD || KnownSafeBU) &amp;&amp; !MultipleOwners);</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;  <span class="keywordflow">if</span> (UnconditionallySafe) {</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;    RetainsToMove.ReverseInsertPts.clear();</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;    ReleasesToMove.ReverseInsertPts.clear();</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;    NewCount = 0;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;    <span class="comment">// Determine whether the new insertion points we computed preserve the</span></div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;    <span class="comment">// balance of retain and release calls through the program.</span></div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;    <span class="comment">// TODO: If the fully aggressive solution isn&#39;t valid, try to find a</span></div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;    <span class="comment">// less aggressive solution which is.</span></div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;    <span class="keywordflow">if</span> (NewDelta != 0)</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;    <span class="comment">// At this point, we are not going to remove any RR pairs, but we still are</span></div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;    <span class="comment">// able to move RR pairs. If one of our pointers is afflicted with</span></div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;    <span class="comment">// CFGHazards, we cannot perform such code motion so exit early.</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> WillPerformCodeMotion = RetainsToMove.ReverseInsertPts.size() ||</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;      ReleasesToMove.ReverseInsertPts.size();</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;    <span class="keywordflow">if</span> (CFGHazardAfflicted &amp;&amp; WillPerformCodeMotion)</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;  }</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;  <span class="comment">// Determine whether the original call points are balanced in the retain and</span></div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;  <span class="comment">// release calls through the program. If not, conservatively don&#39;t touch</span></div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;  <span class="comment">// them.</span></div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;  <span class="comment">// TODO: It&#39;s theoretically possible to do code motion in this case, as</span></div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;  <span class="comment">// long as the existing imbalances are maintained.</span></div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;  <span class="keywordflow">if</span> (OldDelta != 0)</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;<span class="preprocessor">#ifdef ARC_ANNOTATIONS</span></div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;  <span class="comment">// Do not move calls if ARC annotations are requested.</span></div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__ARCOpt.html#ga4320fed90984fab278ec601fb74c5dfe">EnableARCAnnotations</a>)</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;<span class="preprocessor">#endif // ARC_ANNOTATIONS</span></div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;  Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;  assert(OldCount != 0 &amp;&amp; <span class="stringliteral">&quot;Unreachable code?&quot;</span>);</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;  NumRRs += OldCount - NewCount;</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;  <span class="comment">// Set to true if we completely removed any RR pairs.</span></div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;  AnyPairsCompletelyEliminated = NewCount == 0;</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;  <span class="comment">// We can move calls!</span></div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;}</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;<span class="comment">/// Identify pairings between the retains and releases, and delete and/or move</span></div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;<span class="comment">/// them.</span></div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span></div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;ObjCARCOpt::PerformCodePlacement(<a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;</a></div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;                                   &amp;BBStates,</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;                                 <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, RRInfo&gt;</a> &amp;Retains,</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;                                 <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, RRInfo&gt;</a> &amp;Releases,</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;                                 <a class="code" href="classllvm_1_1Module.html">Module</a> *M) {</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n== ObjCARCOpt::PerformCodePlacement ==\n&quot;</span>);</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;  <span class="keywordtype">bool</span> AnyPairsCompletelyEliminated = <span class="keyword">false</span>;</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;  RRInfo RetainsToMove;</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;  RRInfo ReleasesToMove;</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 4&gt;</a> NewRetains;</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 4&gt;</a> NewReleases;</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction *, 8&gt;</a> DeadInsts;</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;  <span class="comment">// Visit each retain.</span></div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;  <span class="keywordflow">for</span> (MapVector&lt;Value *, RRInfo&gt;::const_iterator <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Retains.<a class="code" href="classllvm_1_1MapVector.html#aa610cab7ee61e36a6d1d122fc252c278">begin</a>(),</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;       E = Retains.<a class="code" href="classllvm_1_1MapVector.html#a0881334358ff6ff7ff8cea5562c7988e">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first;</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;    <span class="keywordflow">if</span> (!V) <span class="keywordflow">continue</span>; <span class="comment">// blotted</span></div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Retain = cast&lt;Instruction&gt;(V);</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Visiting: &quot;</span> &lt;&lt; *Retain &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg = <a class="code" href="namespacellvm_1_1objcarc.html#a271307f400deec412d9be2949a7bfea3">GetObjCArg</a>(Retain);</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;    <span class="comment">// If the object being released is in static or stack storage, we know it&#39;s</span></div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;    <span class="comment">// not being managed by ObjC reference counting, so we can delete pairs</span></div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;    <span class="comment">// regardless of what possible decrements or uses lie between them.</span></div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;    <span class="keywordtype">bool</span> KnownSafe = isa&lt;Constant&gt;(Arg) || isa&lt;AllocaInst&gt;(Arg);</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;    <span class="comment">// A constant pointer can&#39;t be pointing to an object on the heap. It may</span></div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;    <span class="comment">// be reference-counted, but it won&#39;t be deleted.</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(Arg))</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV =</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;            dyn_cast&lt;GlobalVariable&gt;(</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;              <a class="code" href="namespacellvm_1_1objcarc.html#a85502898d19c32629e2e17fe94f34985">StripPointerCastsAndObjCCalls</a>(LI-&gt;getPointerOperand())))</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;        <span class="keywordflow">if</span> (GV-&gt;isConstant())</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;          KnownSafe = <span class="keyword">true</span>;</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;    <span class="comment">// Connect the dots between the top-down-collected RetainsToMove and</span></div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;    <span class="comment">// bottom-up-collected ReleasesToMove to form sets of related calls.</span></div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;    NewRetains.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Retain);</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;    <span class="keywordtype">bool</span> PerformMoveCalls =</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;      ConnectTDBUTraversals(BBStates, Retains, Releases, M, NewRetains,</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;                            NewReleases, DeadInsts, RetainsToMove,</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;                            ReleasesToMove, Arg, KnownSafe,</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;                            AnyPairsCompletelyEliminated);</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;    <span class="keywordflow">if</span> (PerformMoveCalls) {</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;      <span class="comment">// Ok, everything checks out and we&#39;re all set. Let&#39;s move/delete some</span></div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;      <span class="comment">// code!</span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;      MoveCalls(Arg, RetainsToMove, ReleasesToMove,</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;                Retains, Releases, DeadInsts, M);</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;    }</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;    <span class="comment">// Clean up state for next retain.</span></div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;    NewReleases.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;    NewRetains.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;    RetainsToMove.clear();</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    ReleasesToMove.clear();</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;  }</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;  <span class="comment">// Now that we&#39;re done moving everything, we can delete the newly dead</span></div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;  <span class="comment">// instructions, as we no longer need them as insert points.</span></div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;  <span class="keywordflow">while</span> (!DeadInsts.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>())</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;    <a class="code" href="namespacellvm_1_1objcarc.html#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(DeadInsts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>());</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;  <span class="keywordflow">return</span> AnyPairsCompletelyEliminated;</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;}</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;<span class="comment">/// Weak pointer optimizations.</span></div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ObjCARCOpt::OptimizeWeakCalls(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F) {</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n== ObjCARCOpt::OptimizeWeakCalls ==\n&quot;</span>);</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;  <span class="comment">// First, do memdep-style RLE and S2L optimizations. We can&#39;t use memdep</span></div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;  <span class="comment">// itself because it uses AliasAnalysis and we need to do provenance</span></div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;  <span class="comment">// queries instead.</span></div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1InstIterator.html">inst_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#a49a219f3fe3d7a6cc07c49a1ea766d6d">inst_begin</a>(&amp;F), E = <a class="code" href="namespacellvm.html#a945cded5463e0ccd3cf5a6ac80542a94">inst_end</a>(&amp;F); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ) {</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = &amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Visiting: &quot;</span> &lt;&lt; *Inst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;    <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2a">InstructionClass</a> Class = <a class="code" href="namespacellvm_1_1objcarc.html#aaa976a678f8297931857721e45e4803d">GetBasicInstructionClass</a>(Inst);</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;    <span class="keywordflow">if</span> (Class != <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaf3043c9d141f15c8e2539d027c612b0a">IC_LoadWeak</a> &amp;&amp; Class != <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aabbcd83d361a8b4bebcfe8b3e4cc3758d">IC_LoadWeakRetained</a>)</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;    <span class="comment">// Delete objc_loadWeak calls with no users.</span></div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;    <span class="keywordflow">if</span> (Class == <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaf3043c9d141f15c8e2539d027c612b0a">IC_LoadWeak</a> &amp;&amp; Inst-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;      Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;    }</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;    <span class="comment">// TODO: For now, just look for an earlier available version of this value</span></div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;    <span class="comment">// within the same block. Theoretically, we could do memdep-style non-local</span></div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;    <span class="comment">// analysis too, but that would want caching. A better approach would be to</span></div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;    <span class="comment">// use the technique that EarlyCSE uses.</span></div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;    <a class="code" href="classllvm_1_1InstIterator.html">inst_iterator</a> Current = <a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CurrentBB = Current.<a class="code" href="classllvm_1_1InstIterator.html#a52e711b717fb6cf47b4b2b3de6f9169c">getBasicBlockIterator</a>();</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a> = CurrentBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(),</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;                              J = Current.<a class="code" href="classllvm_1_1InstIterator.html#a5be70ab4eb58e0b361d757b99b5169f2">getInstructionIterator</a>();</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;         J != <a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a>; --J) {</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *EarlierInst = &amp;*<a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(J);</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;      <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2a">InstructionClass</a> EarlierClass = <a class="code" href="namespacellvm_1_1objcarc.html#a775dd3ca9940b5d893932c22a293be32">GetInstructionClass</a>(EarlierInst);</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;      <span class="keywordflow">switch</span> (EarlierClass) {</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaf3043c9d141f15c8e2539d027c612b0a">IC_LoadWeak</a>:</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aabbcd83d361a8b4bebcfe8b3e4cc3758d">IC_LoadWeakRetained</a>: {</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;        <span class="comment">// If this is loading from the same pointer, replace this load&#39;s value</span></div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;        <span class="comment">// with that one.</span></div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;        <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *<a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Call</a> = cast&lt;CallInst&gt;(Inst);</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;        <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *EarlierCall = cast&lt;CallInst&gt;(EarlierInst);</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg = Call-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(0);</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *EarlierArg = EarlierCall-&gt;getArgOperand(0);</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;        <span class="keywordflow">switch</span> (PA.getAA()-&gt;alias(Arg, EarlierArg)) {</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AliasAnalysis.html#aa96743b70089c7a0ef5d935f34173826acc20b6673c6cc680294a17b0f0f5d676">AliasAnalysis::MustAlias</a>:</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;          Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;          <span class="comment">// If the load has a builtin retain, insert a plain retain for it.</span></div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;          <span class="keywordflow">if</span> (Class == <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aabbcd83d361a8b4bebcfe8b3e4cc3758d">IC_LoadWeakRetained</a>) {</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;            <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Decl = EP.get(<a class="code" href="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints.html#a8c0ce6d07197d6b03c59e80ea8b6c33ba4cabea25d6f015e582feb5eed1f97a81">ARCRuntimeEntryPoints::EPT_Retain</a>);</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;            <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = <a class="code" href="classllvm_1_1CallInst.html#a861226dd056dd2438da26760b8e7a9a0">CallInst::Create</a>(Decl, EarlierCall, <span class="stringliteral">&quot;&quot;</span>, Call);</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;            CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#ad54481e3c992b555aeaba34a83daf7e6">setTailCall</a>();</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;          }</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;          <span class="comment">// Zap the fully redundant load.</span></div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;          Call-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(EarlierCall);</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;          Call-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;          <span class="keywordflow">goto</span> clobbered;</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AliasAnalysis.html#aa96743b70089c7a0ef5d935f34173826a0bf1a5eebff2ab91056e19ebba6c90d5">AliasAnalysis::MayAlias</a>:</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AliasAnalysis.html#aa96743b70089c7a0ef5d935f34173826ab8760c4d7e18fd8a42e2cbe27518c9cd">AliasAnalysis::PartialAlias</a>:</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;          <span class="keywordflow">goto</span> clobbered;</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AliasAnalysis.html#aa96743b70089c7a0ef5d935f34173826a43c7577d5f7b09c310e42a6ab471610b">AliasAnalysis::NoAlias</a>:</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;        }</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;      }</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa435140d7b64d6414958067beccb4c94e">IC_StoreWeak</a>:</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa1534960469029dd730603e21fdf178e3">IC_InitWeak</a>: {</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;        <span class="comment">// If this is storing to the same pointer and has the same size etc.</span></div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;        <span class="comment">// replace this load&#39;s value with the stored value.</span></div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;        <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *<a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Call</a> = cast&lt;CallInst&gt;(Inst);</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;        <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *EarlierCall = cast&lt;CallInst&gt;(EarlierInst);</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg = Call-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(0);</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *EarlierArg = EarlierCall-&gt;getArgOperand(0);</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;        <span class="keywordflow">switch</span> (PA.getAA()-&gt;alias(Arg, EarlierArg)) {</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AliasAnalysis.html#aa96743b70089c7a0ef5d935f34173826acc20b6673c6cc680294a17b0f0f5d676">AliasAnalysis::MustAlias</a>:</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;          Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;          <span class="comment">// If the load has a builtin retain, insert a plain retain for it.</span></div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;          <span class="keywordflow">if</span> (Class == <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aabbcd83d361a8b4bebcfe8b3e4cc3758d">IC_LoadWeakRetained</a>) {</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;            <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Decl = EP.get(<a class="code" href="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints.html#a8c0ce6d07197d6b03c59e80ea8b6c33ba4cabea25d6f015e582feb5eed1f97a81">ARCRuntimeEntryPoints::EPT_Retain</a>);</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;            <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = <a class="code" href="classllvm_1_1CallInst.html#a861226dd056dd2438da26760b8e7a9a0">CallInst::Create</a>(Decl, EarlierCall, <span class="stringliteral">&quot;&quot;</span>, Call);</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;            CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#ad54481e3c992b555aeaba34a83daf7e6">setTailCall</a>();</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;          }</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;          <span class="comment">// Zap the fully redundant load.</span></div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;          Call-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(EarlierCall-&gt;getArgOperand(1));</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;          Call-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;          <span class="keywordflow">goto</span> clobbered;</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AliasAnalysis.html#aa96743b70089c7a0ef5d935f34173826a0bf1a5eebff2ab91056e19ebba6c90d5">AliasAnalysis::MayAlias</a>:</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AliasAnalysis.html#aa96743b70089c7a0ef5d935f34173826ab8760c4d7e18fd8a42e2cbe27518c9cd">AliasAnalysis::PartialAlias</a>:</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;          <span class="keywordflow">goto</span> clobbered;</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1AliasAnalysis.html#aa96743b70089c7a0ef5d935f34173826a43c7577d5f7b09c310e42a6ab471610b">AliasAnalysis::NoAlias</a>:</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;        }</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;      }</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa269efb4e3ea57dfd32d863410e85e2c3">IC_MoveWeak</a>:</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa11b5bdda15281a198319b3c10debbe56">IC_CopyWeak</a>:</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;        <span class="comment">// TOOD: Grab the copied value.</span></div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;        <span class="keywordflow">goto</span> clobbered;</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa043507659210c5bcea4f40804f24d769">IC_AutoreleasepoolPush</a>:</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa3f1e05902d8bb7ed742f01bb311b146e">IC_None</a>:</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaef6419c2f55a21022941218870534187">IC_IntrinsicUser</a>:</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaf7cd7b0299e107541779101a8d49a48a">IC_User</a>:</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;        <span class="comment">// Weak pointers are only modified through the weak entry points</span></div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;        <span class="comment">// (and arbitrary calls, which could call the weak entry points).</span></div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;        <span class="comment">// Anything else could modify the weak pointer.</span></div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;        <span class="keywordflow">goto</span> clobbered;</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;      }</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;    }</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;  clobbered:;</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;  }</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;  <span class="comment">// Then, for each destroyWeak with an alloca operand, check to see if</span></div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;  <span class="comment">// the alloca and all its users can be zapped.</span></div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1InstIterator.html">inst_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#a49a219f3fe3d7a6cc07c49a1ea766d6d">inst_begin</a>(&amp;F), E = <a class="code" href="namespacellvm.html#a945cded5463e0ccd3cf5a6ac80542a94">inst_end</a>(&amp;F); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ) {</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = &amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;    <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2a">InstructionClass</a> Class = <a class="code" href="namespacellvm_1_1objcarc.html#aaa976a678f8297931857721e45e4803d">GetBasicInstructionClass</a>(Inst);</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;    <span class="keywordflow">if</span> (Class != <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aac8d3271bcb25ea91e214a57a68d3856f">IC_DestroyWeak</a>)</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;    <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *<a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Call</a> = cast&lt;CallInst&gt;(Inst);</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg = Call-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(0);</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *Alloca = dyn_cast&lt;AllocaInst&gt;(Arg)) {</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = Alloca-&gt;use_begin(),</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;           UE = Alloca-&gt;use_end(); UI != UE; ++UI) {</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;        <span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserInst = cast&lt;Instruction&gt;(*UI);</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="namespacellvm_1_1objcarc.html#aaa976a678f8297931857721e45e4803d">GetBasicInstructionClass</a>(UserInst)) {</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa1534960469029dd730603e21fdf178e3">IC_InitWeak</a>:</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa435140d7b64d6414958067beccb4c94e">IC_StoreWeak</a>:</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aac8d3271bcb25ea91e214a57a68d3856f">IC_DestroyWeak</a>:</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;          <span class="keywordflow">goto</span> done;</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;        }</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;      }</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = Alloca-&gt;use_begin(),</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;           UE = Alloca-&gt;use_end(); UI != UE; ) {</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;        <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *UserInst = cast&lt;CallInst&gt;(*UI++);</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="namespacellvm_1_1objcarc.html#aaa976a678f8297931857721e45e4803d">GetBasicInstructionClass</a>(UserInst)) {</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa1534960469029dd730603e21fdf178e3">IC_InitWeak</a>:</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa435140d7b64d6414958067beccb4c94e">IC_StoreWeak</a>:</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;          <span class="comment">// These functions return their second argument.</span></div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;          UserInst-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(UserInst-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(1));</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aac8d3271bcb25ea91e214a57a68d3856f">IC_DestroyWeak</a>:</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;          <span class="comment">// No return value.</span></div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;          <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;alloca really is used!&quot;</span>);</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;        }</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;        UserInst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;      }</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;      Alloca-&gt;eraseFromParent();</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;    done:;</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;    }</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;  }</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;}</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;<span class="comment">/// Identify program paths which execute sequences of retains and releases which</span></div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;<span class="comment">/// can be eliminated.</span></div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ObjCARCOpt::OptimizeSequences(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F) {</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;  <span class="comment">// Releases, Retains - These are used to store the results of the main flow</span></div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;  <span class="comment">// analysis. These use Value* as the key instead of Instruction* so that the</span></div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;  <span class="comment">// map stays valid when we get around to rewriting code and calls get</span></div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;  <span class="comment">// replaced by arguments.</span></div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, RRInfo&gt;</a> Releases;</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;  <a class="code" href="classllvm_1_1MapVector.html">MapVector&lt;Value *, RRInfo&gt;</a> Retains;</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;  <span class="comment">// This is used during the traversal of the function to track the</span></div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;  <span class="comment">// states for each identified object at each block.</span></div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, BBState&gt;</a> BBStates;</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;  <span class="comment">// Analyze the CFG of the function, and all instructions.</span></div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;  <span class="keywordtype">bool</span> NestingDetected = Visit(F, BBStates, Retains, Releases);</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;  <span class="comment">// Transform.</span></div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;  <span class="keywordtype">bool</span> AnyPairsCompletelyEliminated = PerformCodePlacement(BBStates, Retains,</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;                                                           Releases,</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;                                                           F.<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>());</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;  <span class="comment">// Cleanup.</span></div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;  MultiOwnersSet.clear();</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;  <span class="keywordflow">return</span> AnyPairsCompletelyEliminated &amp;&amp; NestingDetected;</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;}</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;<span class="comment">/// Check if there is a dependent call earlier that does not have anything in</span></div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;<span class="comment">/// between the Retain and the call that can affect the reference count of their</span></div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;<span class="comment">/// shared pointer argument. Note that Retain need not be in BB.</span></div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span></div><div class="line"><a name="l02859"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#gabf7ea5e049c352b82f84b2c9c64cce89"> 2859</a></span>&#160;<a class="code" href="group__ARCOpt.html#gabf7ea5e049c352b82f84b2c9c64cce89">HasSafePathToPredecessorCall</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Retain,</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;                             <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 4&gt;</a> &amp;DepInsts,</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;                             <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const BasicBlock *, 4&gt;</a> &amp;Visited,</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;                             <a class="code" href="classllvm_1_1objcarc_1_1ProvenanceAnalysis.html">ProvenanceAnalysis</a> &amp;PA) {</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;  <a class="code" href="namespacellvm_1_1objcarc.html#a910c6858e79ffad2a32aee7db4dec1d8">FindDependencies</a>(<a class="code" href="namespacellvm_1_1objcarc.html#a353f4c1f85416c596ecaa9c4d5afca75a197563bb332a0ac8f6b578e8b6fcf0a7">CanChangeRetainCount</a>, Arg, Retain-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>(), Retain,</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;                   DepInsts, Visited, PA);</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;  <span class="keywordflow">if</span> (DepInsts.size() != 1)</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;  <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *<a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Call</a> =</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;    dyn_cast_or_null&lt;CallInst&gt;(*DepInsts.begin());</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;  <span class="comment">// Check that the pointer is the return value of the call.</span></div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;  <span class="keywordflow">if</span> (!Call || Arg != Call)</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;  <span class="comment">// Check that the call is a regular call.</span></div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;  <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2a">InstructionClass</a> Class = <a class="code" href="namespacellvm_1_1objcarc.html#aaa976a678f8297931857721e45e4803d">GetBasicInstructionClass</a>(Call);</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;  <span class="keywordflow">if</span> (Class != <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa4c8ef5e5f2c988594f20a6e8b4d86c26">IC_CallOrUser</a> &amp;&amp; Class != <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaad2deec0f4615604f0e42d07b3d38241">IC_Call</a>)</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;}</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;<span class="comment">/// Find a dependent retain that precedes the given autorelease for which there</span></div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;<span class="comment">/// is nothing in between the two instructions that can affect the ref count of</span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;<span class="comment">/// Arg.</span></div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *</div><div class="line"><a name="l02887"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#ga594b2da4d72bed758ccf2c1923d462c9"> 2887</a></span>&#160;<a class="code" href="group__ARCOpt.html#ga594b2da4d72bed758ccf2c1923d462c9">FindPredecessorRetainWithSafePath</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB,</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;                                  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Autorelease,</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;                                  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 4&gt;</a> &amp;DepInsts,</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;                                  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const BasicBlock *, 4&gt;</a> &amp;Visited,</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;                                  <a class="code" href="classllvm_1_1objcarc_1_1ProvenanceAnalysis.html">ProvenanceAnalysis</a> &amp;PA) {</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;  <a class="code" href="namespacellvm_1_1objcarc.html#a910c6858e79ffad2a32aee7db4dec1d8">FindDependencies</a>(<a class="code" href="namespacellvm_1_1objcarc.html#a353f4c1f85416c596ecaa9c4d5afca75a197563bb332a0ac8f6b578e8b6fcf0a7">CanChangeRetainCount</a>, Arg,</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;                   BB, Autorelease, DepInsts, Visited, PA);</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;  <span class="keywordflow">if</span> (DepInsts.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a41c201584742f7eb45b2be8cd54e3bcb">size</a>() != 1)</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;  <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *Retain =</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    dyn_cast_or_null&lt;CallInst&gt;(*DepInsts.<a class="code" href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">begin</a>());</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;  <span class="comment">// Check that we found a retain with the same argument.</span></div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;  <span class="keywordflow">if</span> (!Retain ||</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;      !<a class="code" href="namespacellvm_1_1objcarc.html#a21916491d53d3bcc4505817a4705e6bf">IsRetain</a>(<a class="code" href="namespacellvm_1_1objcarc.html#aaa976a678f8297931857721e45e4803d">GetBasicInstructionClass</a>(Retain)) ||</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;      <a class="code" href="namespacellvm_1_1objcarc.html#a271307f400deec412d9be2949a7bfea3">GetObjCArg</a>(Retain) != Arg) {</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;  }</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;  <span class="keywordflow">return</span> Retain;</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;}</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;<span class="comment">/// Look for an ``autorelease&#39;&#39; instruction dependent on Arg such that there are</span></div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;<span class="comment">/// no instructions dependent on Arg that need a positive ref count in between</span></div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;<span class="comment">/// the autorelease and the ret.</span></div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *</div><div class="line"><a name="l02914"></a><span class="lineno"><a class="line" href="group__ARCOpt.html#ga3aeae0d6eb47476fa712b6353747ed0c"> 2914</a></span>&#160;<a class="code" href="group__ARCOpt.html#ga3aeae0d6eb47476fa712b6353747ed0c">FindPredecessorAutoreleaseWithSafePath</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB,</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;                                       <a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *<a class="code" href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">Ret</a>,</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;                                       <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 4&gt;</a> &amp;DepInsts,</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;                                       <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const BasicBlock *, 4&gt;</a> &amp;V,</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;                                       <a class="code" href="classllvm_1_1objcarc_1_1ProvenanceAnalysis.html">ProvenanceAnalysis</a> &amp;PA) {</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;  <a class="code" href="namespacellvm_1_1objcarc.html#a910c6858e79ffad2a32aee7db4dec1d8">FindDependencies</a>(<a class="code" href="namespacellvm_1_1objcarc.html#a353f4c1f85416c596ecaa9c4d5afca75ae9cb4656651e6d8f4748dac4bbe1b361">NeedsPositiveRetainCount</a>, Arg,</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;                   BB, Ret, DepInsts, V, PA);</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;  <span class="keywordflow">if</span> (DepInsts.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a41c201584742f7eb45b2be8cd54e3bcb">size</a>() != 1)</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;  <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *Autorelease =</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;    dyn_cast_or_null&lt;CallInst&gt;(*DepInsts.<a class="code" href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">begin</a>());</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;  <span class="keywordflow">if</span> (!Autorelease)</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;  <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2a">InstructionClass</a> AutoreleaseClass = <a class="code" href="namespacellvm_1_1objcarc.html#aaa976a678f8297931857721e45e4803d">GetBasicInstructionClass</a>(Autorelease);</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1objcarc.html#a2c32f032263eb1fa0ec96e9132f0b7c3">IsAutorelease</a>(AutoreleaseClass))</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1objcarc.html#a271307f400deec412d9be2949a7bfea3">GetObjCArg</a>(Autorelease) != Arg)</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;  <span class="keywordflow">return</span> Autorelease;</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;}</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;<span class="comment">/// Look for this pattern:</span></div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;<span class="comment">/// \code</span></div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;<span class="comment">///    %call = call i8* @something(...)</span></div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;<span class="comment">///    %2 = call i8* @objc_retain(i8* %call)</span></div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;<span class="comment">///    %3 = call i8* @objc_autorelease(i8* %2)</span></div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;<span class="comment">///    ret i8* %3</span></div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;<span class="comment">/// \endcode</span></div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;<span class="comment">/// And delete the retain and autorelease.</span></div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ObjCARCOpt::OptimizeReturns(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F) {</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;  <span class="keywordflow">if</span> (!F.<a class="code" href="classllvm_1_1Function.html#a26ccf11b81c01a45cb40137c775f7cad">getReturnType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>())</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n== ObjCARCOpt::OptimizeReturns ==\n&quot;</span>);</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 4&gt;</a> DependingInstructions;</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const BasicBlock *, 4&gt;</a> Visited;</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Function::iterator</a> FI = F.<a class="code" href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">begin</a>(), FE = F.<a class="code" href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">end</a>(); FI != FE; ++FI) {</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB = FI;</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    <a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *<a class="code" href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">Ret</a> = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a>&gt;(&amp;BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a6bce6440331683570a283df762902a09">back</a>());</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Visiting: &quot;</span> &lt;&lt; *Ret &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;    <span class="keywordflow">if</span> (!Ret)</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg = <a class="code" href="namespacellvm_1_1objcarc.html#a85502898d19c32629e2e17fe94f34985">StripPointerCastsAndObjCCalls</a>(Ret-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0));</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;    <span class="comment">// Look for an ``autorelease&#39;&#39; instruction that is a predecessor of Ret and</span></div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;    <span class="comment">// dependent on Arg such that there are no instructions dependent on Arg</span></div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;    <span class="comment">// that need a positive ref count in between the autorelease and Ret.</span></div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;    <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *Autorelease =</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;      <a class="code" href="group__ARCOpt.html#ga3aeae0d6eb47476fa712b6353747ed0c">FindPredecessorAutoreleaseWithSafePath</a>(Arg, BB, Ret,</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;                                             DependingInstructions, Visited,</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;                                             PA);</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;    DependingInstructions.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#aa72472422d95c7052d62432ec279ff85">clear</a>();</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;    Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#aa72472422d95c7052d62432ec279ff85">clear</a>();</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;    <span class="keywordflow">if</span> (!Autorelease)</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;    <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *Retain =</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;      <a class="code" href="group__ARCOpt.html#ga594b2da4d72bed758ccf2c1923d462c9">FindPredecessorRetainWithSafePath</a>(Arg, BB, Autorelease,</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;                                        DependingInstructions, Visited, PA);</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;    DependingInstructions.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#aa72472422d95c7052d62432ec279ff85">clear</a>();</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;    Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#aa72472422d95c7052d62432ec279ff85">clear</a>();</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;    <span class="keywordflow">if</span> (!Retain)</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;    <span class="comment">// Check that there is nothing that can affect the reference count</span></div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;    <span class="comment">// between the retain and the call.  Note that Retain need not be in BB.</span></div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;    <span class="keywordtype">bool</span> HasSafePathToCall = <a class="code" href="group__ARCOpt.html#gabf7ea5e049c352b82f84b2c9c64cce89">HasSafePathToPredecessorCall</a>(Arg, Retain,</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;                                                          DependingInstructions,</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;                                                          Visited, PA);</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    DependingInstructions.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#aa72472422d95c7052d62432ec279ff85">clear</a>();</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;    Visited.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#aa72472422d95c7052d62432ec279ff85">clear</a>();</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;    <span class="keywordflow">if</span> (!HasSafePathToCall)</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;    <span class="comment">// If so, we can zap the retain and autorelease.</span></div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;    ++NumRets;</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Erasing: &quot;</span> &lt;&lt; *Retain &lt;&lt; <span class="stringliteral">&quot;\nErasing: &quot;</span></div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;          &lt;&lt; *Autorelease &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    <a class="code" href="namespacellvm_1_1objcarc.html#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(Retain);</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;    <a class="code" href="namespacellvm_1_1objcarc.html#af4e05bf48a81b884e707efa650560fbf">EraseInstruction</a>(Autorelease);</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;  }</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;}</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;ObjCARCOpt::GatherStatistics(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F, <span class="keywordtype">bool</span> AfterOptimization) {</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;  <a class="code" href="classllvm_1_1Statistic.html">llvm::Statistic</a> &amp;NumRetains =</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;    AfterOptimization? NumRetainsAfterOpt : NumRetainsBeforeOpt;</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;  <a class="code" href="classllvm_1_1Statistic.html">llvm::Statistic</a> &amp;NumReleases =</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;    AfterOptimization? NumReleasesAfterOpt : NumReleasesBeforeOpt;</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1InstIterator.html">inst_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#a49a219f3fe3d7a6cc07c49a1ea766d6d">inst_begin</a>(&amp;F), E = <a class="code" href="namespacellvm.html#a945cded5463e0ccd3cf5a6ac80542a94">inst_end</a>(&amp;F); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ) {</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = &amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="namespacellvm_1_1objcarc.html#aaa976a678f8297931857721e45e4803d">GetBasicInstructionClass</a>(Inst)) {</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaa2c2d6f56cb091ae9470b8fb1e74757d">IC_Retain</a>:</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;      ++NumRetains;</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa442b643665868538ba47d657c13629e8">IC_Release</a>:</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;      ++NumReleases;</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;    }</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;  }</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;}</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;<span class="keywordtype">bool</span> ObjCARCOpt::doInitialization(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M) {</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1objcarc.html#a6771e7364c5ab8a6354f744fe5bbc62b">EnableARCOpts</a>)</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;  <span class="comment">// If nothing in the Module uses ARC, don&#39;t do anything.</span></div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;  Run = <a class="code" href="namespacellvm_1_1objcarc.html#a9974a476e27654f3a1605a15a1c1d371">ModuleHasARC</a>(M);</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;  <span class="keywordflow">if</span> (!Run)</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;  <span class="comment">// Identify the imprecise release metadata kind.</span></div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;  ImpreciseReleaseMDKind =</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;    M.<a class="code" href="classllvm_1_1Module.html#a0e74af4b7c739f3a14e737c3042b6617">getContext</a>().<a class="code" href="classllvm_1_1LLVMContext.html#aa6ccc91e8705ccd80e1fa4568a1970da">getMDKindID</a>(<span class="stringliteral">&quot;clang.imprecise_release&quot;</span>);</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;  CopyOnEscapeMDKind =</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;    M.<a class="code" href="classllvm_1_1Module.html#a0e74af4b7c739f3a14e737c3042b6617">getContext</a>().<a class="code" href="classllvm_1_1LLVMContext.html#aa6ccc91e8705ccd80e1fa4568a1970da">getMDKindID</a>(<span class="stringliteral">&quot;clang.arc.copy_on_escape&quot;</span>);</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;  NoObjCARCExceptionsMDKind =</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;    M.<a class="code" href="classllvm_1_1Module.html#a0e74af4b7c739f3a14e737c3042b6617">getContext</a>().<a class="code" href="classllvm_1_1LLVMContext.html#aa6ccc91e8705ccd80e1fa4568a1970da">getMDKindID</a>(<span class="stringliteral">&quot;clang.arc.no_objc_arc_exceptions&quot;</span>);</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;<span class="preprocessor">#ifdef ARC_ANNOTATIONS</span></div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;  ARCAnnotationBottomUpMDKind =</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;    M.<a class="code" href="classllvm_1_1Module.html#a0e74af4b7c739f3a14e737c3042b6617">getContext</a>().<a class="code" href="classllvm_1_1LLVMContext.html#aa6ccc91e8705ccd80e1fa4568a1970da">getMDKindID</a>(<span class="stringliteral">&quot;llvm.arc.annotation.bottomup&quot;</span>);</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;  ARCAnnotationTopDownMDKind =</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;    M.<a class="code" href="classllvm_1_1Module.html#a0e74af4b7c739f3a14e737c3042b6617">getContext</a>().<a class="code" href="classllvm_1_1LLVMContext.html#aa6ccc91e8705ccd80e1fa4568a1970da">getMDKindID</a>(<span class="stringliteral">&quot;llvm.arc.annotation.topdown&quot;</span>);</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;  ARCAnnotationProvenanceSourceMDKind =</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    M.<a class="code" href="classllvm_1_1Module.html#a0e74af4b7c739f3a14e737c3042b6617">getContext</a>().<a class="code" href="classllvm_1_1LLVMContext.html#aa6ccc91e8705ccd80e1fa4568a1970da">getMDKindID</a>(<span class="stringliteral">&quot;llvm.arc.annotation.provenancesource&quot;</span>);</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;<span class="preprocessor">#endif // ARC_ANNOTATIONS</span></div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;  <span class="comment">// Intuitively, objc_retain and others are nocapture, however in practice</span></div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;  <span class="comment">// they are not, because they return their argument value. And objc_release</span></div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;  <span class="comment">// calls finalizers which can have arbitrary side effects.</span></div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;  <span class="comment">// Initialize our runtime entry point cache.</span></div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;  EP.Initialize(&amp;M);</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;}</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;<span class="keywordtype">bool</span> ObjCARCOpt::runOnFunction(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F) {</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm_1_1objcarc.html#a6771e7364c5ab8a6354f744fe5bbc62b">EnableARCOpts</a>)</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;  <span class="comment">// If nothing in the Module uses ARC, don&#39;t do anything.</span></div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;  <span class="keywordflow">if</span> (!Run)</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;  Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;&lt;&lt;&lt; ObjCARCOpt: Visiting Function: &quot;</span> &lt;&lt; F.<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() &lt;&lt; <span class="stringliteral">&quot; &gt;&gt;&gt;&quot;</span></div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;        <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;  PA.setAA(&amp;getAnalysis&lt;AliasAnalysis&gt;());</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a846137dc22b3b399b62f606698f3ed59">AreStatisticsEnabled</a>()) {</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;    GatherStatistics(F, <span class="keyword">false</span>);</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;  }</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;  <span class="comment">// This pass performs several distinct transformations. As a compile-time aid</span></div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;  <span class="comment">// when compiling code that isn&#39;t ObjC, skip these if the relevant ObjC</span></div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;  <span class="comment">// library functions aren&#39;t declared.</span></div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;  <span class="comment">// Preliminary optimizations. This also computes UsedInThisFunction.</span></div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;  OptimizeIndividualCalls(F);</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;  <span class="comment">// Optimizations for weak pointers.</span></div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;  <span class="keywordflow">if</span> (UsedInThisFunction &amp; ((1 &lt;&lt; <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaf3043c9d141f15c8e2539d027c612b0a">IC_LoadWeak</a>) |</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;                            (1 &lt;&lt; <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aabbcd83d361a8b4bebcfe8b3e4cc3758d">IC_LoadWeakRetained</a>) |</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;                            (1 &lt;&lt; <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa435140d7b64d6414958067beccb4c94e">IC_StoreWeak</a>) |</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;                            (1 &lt;&lt; <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa1534960469029dd730603e21fdf178e3">IC_InitWeak</a>) |</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;                            (1 &lt;&lt; <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa11b5bdda15281a198319b3c10debbe56">IC_CopyWeak</a>) |</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;                            (1 &lt;&lt; <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa269efb4e3ea57dfd32d863410e85e2c3">IC_MoveWeak</a>) |</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;                            (1 &lt;&lt; <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aac8d3271bcb25ea91e214a57a68d3856f">IC_DestroyWeak</a>)))</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;    OptimizeWeakCalls(F);</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;  <span class="comment">// Optimizations for retain+release pairs.</span></div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;  <span class="keywordflow">if</span> (UsedInThisFunction &amp; ((1 &lt;&lt; <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaa2c2d6f56cb091ae9470b8fb1e74757d">IC_Retain</a>) |</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;                            (1 &lt;&lt; <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaa7ab689fdb243382e550bcd4481ab6ef">IC_RetainRV</a>) |</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;                            (1 &lt;&lt; <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aabbf6ec1064199e8c4ecba1aaccf93f47">IC_RetainBlock</a>)))</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;    <span class="keywordflow">if</span> (UsedInThisFunction &amp; (1 &lt;&lt; <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa442b643665868538ba47d657c13629e8">IC_Release</a>))</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;      <span class="comment">// Run OptimizeSequences until it either stops making changes or</span></div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;      <span class="comment">// no retain+release pair nesting is detected.</span></div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;      <span class="keywordflow">while</span> (OptimizeSequences(F)) {}</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;  <span class="comment">// Optimizations if objc_autorelease is used.</span></div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;  <span class="keywordflow">if</span> (UsedInThisFunction &amp; ((1 &lt;&lt; <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa02e0eccce75bf149ddc6aa9eb323ffaa">IC_Autorelease</a>) |</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;                            (1 &lt;&lt; <a class="code" href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa2d4ba97e16dbcc5627f4550bbc072214">IC_AutoreleaseRV</a>)))</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;    OptimizeReturns(F);</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;  <span class="comment">// Gather statistics after optimization.</span></div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a846137dc22b3b399b62f606698f3ed59">AreStatisticsEnabled</a>()) {</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;    GatherStatistics(F, <span class="keyword">true</span>);</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;  }</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;}</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;<span class="keywordtype">void</span> ObjCARCOpt::releaseMemory() {</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;  PA.clear();</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;}</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;<span class="comment">/// @}</span></div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;<span class="comment">///</span></div><div class="ttc" id="classllvm_1_1Pass_html"><div class="ttname"><a href="classllvm_1_1Pass.html">llvm::Pass</a></div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00082">Pass.h:82</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a075e34e98605d0e7c289763a104869ac"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">llvm::SmallVectorTemplateCommon&lt; T &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00114">SmallVector.h:114</a></div></div>
<div class="ttc" id="classllvm_1_1ReturnInst_html"><div class="ttname"><a href="classllvm_1_1ReturnInst.html">llvm::ReturnInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02279">Instructions.h:2279</a></div></div>
<div class="ttc" id="classllvm_1_1InstIterator_html_a52e711b717fb6cf47b4b2b3de6f9169c"><div class="ttname"><a href="classllvm_1_1InstIterator.html#a52e711b717fb6cf47b4b2b3de6f9169c">llvm::InstIterator::getBasicBlockIterator</a></div><div class="ttdeci">BBIty &amp; getBasicBlockIterator()</div><div class="ttdef"><b>Definition:</b> <a href="InstIterator_8h_source.html#l00071">InstIterator.h:71</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_ae1a10b90f22c0478960fb5798ff73916"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">llvm::SmallVectorTemplateBase&lt; T, isPodLike&lt; T &gt;::value &gt;::push_back</a></div><div class="ttdeci">void push_back(const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00236">SmallVector.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad86469939d2a8bdd4169be9403b89f5a"><div class="ttname"><a href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">llvm::Value::use_end</a></div><div class="ttdeci">use_iterator use_end()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00152">Value.h:152</a></div></div>
<div class="ttc" id="namespacellvm_1_1sys_1_1path_html_a214ec2f04ffd92636ed4bd2717607a1d"><div class="ttname"><a href="namespacellvm_1_1sys_1_1path.html#a214ec2f04ffd92636ed4bd2717607a1d">llvm::sys::path::end</a></div><div class="ttdeci">const_iterator end(StringRef path)</div><div class="ttdoc">Get end iterator over path. </div><div class="ttdef"><b>Definition:</b> <a href="Path_8cpp_source.html#l00181">Path.cpp:181</a></div></div>
<div class="ttc" id="classllvm_1_1AliasAnalysis_html_aa96743b70089c7a0ef5d935f34173826ab8760c4d7e18fd8a42e2cbe27518c9cd"><div class="ttname"><a href="classllvm_1_1AliasAnalysis.html#aa96743b70089c7a0ef5d935f34173826ab8760c4d7e18fd8a42e2cbe27518c9cd">llvm::AliasAnalysis::PartialAlias</a></div><div class="ttdoc">Pointers differ, but pointees overlap. </div><div class="ttdef"><b>Definition:</b> <a href="AliasAnalysis_8h_source.html#l00164">AliasAnalysis.h:164</a></div></div>
<div class="ttc" id="DependencyAnalysis_8h_html"><div class="ttname"><a href="DependencyAnalysis_8h.html">DependencyAnalysis.h</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_aaa3de05ef40ccacdcbc0326c1d951ad4"><div class="ttname"><a href="classllvm_1_1CallInst.html#aaa3de05ef40ccacdcbc0326c1d951ad4">llvm::CallInst::setDoesNotThrow</a></div><div class="ttdeci">void setDoesNotThrow()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01332">Instructions.h:1332</a></div></div>
<div class="ttc" id="Target_2X86_2README_8txt_html_a82bd4f4b721c049035c0d86cc261eadd"><div class="ttname"><a href="Target_2X86_2README_8txt.html#a82bd4f4b721c049035c0d86cc261eadd">tmp</a></div><div class="ttdeci">alloca&lt; 16 x float &gt;, align 16%tmp2=alloca&lt; 16 x float &gt;, align 16 store&lt; 16 x float &gt;%A,&lt; 16 x float &gt; *%tmp%s=bitcast&lt; 16 x float &gt; *%tmp to i8 *%s2=bitcast&lt; 16 x float &gt; *%tmp2 to i8 *call void @llvm.memcpy.i64(i8 *%s, i8 *%s2, i64 64, i32 16)%R=load&lt; 16 x float &gt; *%tmp2 ret&lt; 16 x float &gt;%R}declare void @llvm.memcpy.i64(i8 *nocapture, i8 *nocapture, i64, i32) nounwind which compiles to:_foo:subl $140,%esp movaps%xmm3, 112(%esp) movaps%xmm2, 96(%esp) movaps%xmm1, 80(%esp) movaps%xmm0, 64(%esp) movl 60(%esp),%eax movl%eax, 124(%esp) movl 56(%esp),%eax movl%eax, 120(%esp) movl 52(%esp),%eax&lt; many many more 32-bit copies &gt; movaps(%esp),%xmm0 movaps 16(%esp),%xmm1 movaps 32(%esp),%xmm2 movaps 48(%esp),%xmm3 addl $140,%esp ret On Nehalem, it may even be cheaper to just use movups when unaligned than to fall back to lower-granularity chunks.Implement processor-specific optimizations for parity with GCC on these processors.GCC does two optimizations:1.ix86_pad_returns inserts a noop before ret instructions if immediately preceded by a conditional branch or is the target of a jump.2.ix86_avoid_jump_misspredicts inserts noops in cases where a 16-byte block of code contains more than 3 branches.The first one is done for all AMDs, Core2, and&quot;Generic&quot;The second one is done for:Atom, Pentium Pro, all AMDs, Pentium 4, Nocona, Core 2, and&quot;Generic&quot;Testcase:int x(int a){return(a &amp;0xf0)&gt;&gt;4 tmp</div><div class="ttdef"><b>Definition:</b> <a href="Target_2X86_2README_8txt_source.html#l01572">Target/X86/README.txt:1572</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARM__PROC_html_aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5"><div class="ttname"><a href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">llvm::ARM_PROC::A</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInfo_8h_source.html#l00098">ARMBaseInfo.h:98</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a98d7f1cf15bd78fd7c7c68e6543a9588">llvm::A64CC::LE</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00044">AArch64BaseInfo.h:44</a></div></div>
<div class="ttc" id="classllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00035">PassRegistry.cpp:35</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a6fe2f06b8a4b2c3d6308afb223a0238a"><div class="ttname"><a href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">llvm::Instruction::eraseFromParent</a></div><div class="ttdeci">void eraseFromParent()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00072">Instruction.cpp:72</a></div></div>
<div class="ttc" id="classllvm_1_1Argument_html"><div class="ttname"><a href="classllvm_1_1Argument.html">llvm::Argument</a></div><div class="ttdoc">LLVM Argument representation. </div><div class="ttdef"><b>Definition:</b> <a href="Argument_8h_source.html#l00035">Argument.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1InstIterator_html_a5be70ab4eb58e0b361d757b99b5169f2"><div class="ttname"><a href="classllvm_1_1InstIterator.html#a5be70ab4eb58e0b361d757b99b5169f2">llvm::InstIterator::getInstructionIterator</a></div><div class="ttdeci">BIty &amp; getInstructionIterator()</div><div class="ttdef"><b>Definition:</b> <a href="InstIterator_8h_source.html#l00072">InstIterator.h:72</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aa105b2f9524696bc5df0ed2eb1c2f88de"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa105b2f9524696bc5df0ed2eb1c2f88de">llvm::objcarc::IC_NoopCast</a></div><div class="ttdoc">objc_retainedObject, etc. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00082">lib/Transforms/ObjCARC/ObjCARC.h:82</a></div></div>
<div class="ttc" id="group__ARCOpt_html_gaca2215704eb21394afd5834ca3a8bd8d"><div class="ttname"><a href="group__ARCOpt.html#gaca2215704eb21394afd5834ca3a8bd8d">ANNOTATE_BOTTOMUP_BBSTART</a></div><div class="ttdeci">#define ANNOTATE_BOTTOMUP_BBSTART(_states, _basicblock)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l01049">ObjCARCOpts.cpp:1049</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aa19c5bed13eb8e5eeafa2427c790f5148"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa19c5bed13eb8e5eeafa2427c790f5148">llvm::objcarc::IC_AutoreleasepoolPop</a></div><div class="ttdoc">objc_autoreleasePoolPop </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00081">lib/Transforms/ObjCARC/ObjCARC.h:81</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a6bce6440331683570a283df762902a09"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a6bce6440331683570a283df762902a09">llvm::BasicBlock::back</a></div><div class="ttdeci">const Instruction &amp; back() const </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00207">BasicBlock.h:207</a></div></div>
<div class="ttc" id="ARCRuntimeEntryPoints_8h_html"><div class="ttname"><a href="ARCRuntimeEntryPoints_8h.html">ARCRuntimeEntryPoints.h</a></div></div>
<div class="ttc" id="namespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">List of target independent CodeGen pass IDs. </div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l00022">APFloat.h:22</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a0555f297eceee28e5fc20d282dfeb8f4"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a0555f297eceee28e5fc20d282dfeb8f4">llvm::A64CC::NE</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00032">AArch64BaseInfo.h:32</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aaa2c2d6f56cb091ae9470b8fb1e74757d"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaa2c2d6f56cb091ae9470b8fb1e74757d">llvm::objcarc::IC_Retain</a></div><div class="ttdoc">objc_retain </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00074">lib/Transforms/ObjCARC/ObjCARC.h:74</a></div></div>
<div class="ttc" id="namespacellvm_html_a1d0ac37acc2482f8794195f5042b61b5acd12d6cf678f7504ca49c922fb16ce01"><div class="ttname"><a href="namespacellvm.html#a1d0ac37acc2482f8794195f5042b61b5acd12d6cf678f7504ca49c922fb16ce01">llvm::None</a></div><div class="ttdef"><b>Definition:</b> <a href="None_8h_source.html#l00023">None.h:23</a></div></div>
<div class="ttc" id="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints_html_a8c0ce6d07197d6b03c59e80ea8b6c33ba82db7aa366c43e3d4c969b9159bc6d76"><div class="ttname"><a href="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints.html#a8c0ce6d07197d6b03c59e80ea8b6c33ba82db7aa366c43e3d4c969b9159bc6d76">llvm::objcarc::ARCRuntimeEntryPoints::EPT_Release</a></div><div class="ttdef"><b>Definition:</b> <a href="ARCRuntimeEntryPoints_8h_source.html#l00036">ARCRuntimeEntryPoints.h:36</a></div></div>
<div class="ttc" id="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints_html_a8c0ce6d07197d6b03c59e80ea8b6c33ba4cabea25d6f015e582feb5eed1f97a81"><div class="ttname"><a href="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints.html#a8c0ce6d07197d6b03c59e80ea8b6c33ba4cabea25d6f015e582feb5eed1f97a81">llvm::objcarc::ARCRuntimeEntryPoints::EPT_Retain</a></div><div class="ttdef"><b>Definition:</b> <a href="ARCRuntimeEntryPoints_8h_source.html#l00037">ARCRuntimeEntryPoints.h:37</a></div></div>
<div class="ttc" id="group__ARCOpt_html_ga752eafaa4db45af368c44ec2f6cee9e6"><div class="ttname"><a href="group__ARCOpt.html#ga752eafaa4db45af368c44ec2f6cee9e6">ObjCARCOpt::ID</a></div><div class="ttdeci">static char ID</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l01173">ObjCARCOpts.cpp:1173</a></div></div>
<div class="ttc" id="group__ARCOpt_html_ga3aeae0d6eb47476fa712b6353747ed0c"><div class="ttname"><a href="group__ARCOpt.html#ga3aeae0d6eb47476fa712b6353747ed0c">FindPredecessorAutoreleaseWithSafePath</a></div><div class="ttdeci">static CallInst * FindPredecessorAutoreleaseWithSafePath(const Value *Arg, BasicBlock *BB, ReturnInst *Ret, SmallPtrSet&lt; Instruction *, 4 &gt; &amp;DepInsts, SmallPtrSet&lt; const BasicBlock *, 4 &gt; &amp;V, ProvenanceAnalysis &amp;PA)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l02914">ObjCARCOpts.cpp:2914</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html"><div class="ttname"><a href="classllvm_1_1Module.html">llvm::Module</a></div><div class="ttdoc">The main container class for the LLVM Intermediate Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00112">Module.h:112</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_ae4ca2261b8b901e415fda7feac5051ea"><div class="ttname"><a href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">llvm::Function::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00397">Function.h:397</a></div></div>
<div class="ttc" id="classllvm_1_1MDString_html_affbb7e2e9ad8d18114816f2443d672b9"><div class="ttname"><a href="classllvm_1_1MDString.html#affbb7e2e9ad8d18114816f2443d672b9">llvm::MDString::get</a></div><div class="ttdeci">static MDString * get(LLVMContext &amp;Context, StringRef Str)</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l00038">Metadata.cpp:38</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a271307f400deec412d9be2949a7bfea3"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a271307f400deec412d9be2949a7bfea3">llvm::objcarc::GetObjCArg</a></div><div class="ttdeci">static Value * GetObjCArg(Value *Inst)</div><div class="ttdoc">Assuming the given instruction is one of the special calls such as objc_retain or objc_release...</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00261">lib/Transforms/ObjCARC/ObjCARC.h:261</a></div></div>
<div class="ttc" id="namespacellvm_html_a3f2f98c2a67c9e79f58aad9150a62e42"><div class="ttname"><a href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">llvm::dyn_cast</a></div><div class="ttdeci">enable_if_c&lt;!is_simple_type&lt; Y &gt;::value, typename cast_retty&lt; X, const Y &gt;::ret_type &gt;::type dyn_cast(const Y &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="Casting_8h_source.html#l00266">Casting.h:266</a></div></div>
<div class="ttc" id="classllvm_1_1DenseSet_html"><div class="ttname"><a href="classllvm_1_1DenseSet.html">llvm::DenseSet</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseSet_8h_source.html#l00026">DenseSet.h:26</a></div></div>
<div class="ttc" id="classllvm_1_1MDNode_html_ade17b50e4f0b835cd9eb58dffe12a90d"><div class="ttname"><a href="classllvm_1_1MDNode.html#ade17b50e4f0b835cd9eb58dffe12a90d">llvm::MDNode::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const </div><div class="ttdoc">getNumOperands - Return number of MDNode operands. </div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l00146">Metadata.h:146</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a8d035a0949c98e914f6b7446b9273eb8"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a8d035a0949c98e914f6b7446b9273eb8">llvm::objcarc::IsUser</a></div><div class="ttdeci">static bool IsUser(InstructionClass Class)</div><div class="ttdoc">Test if the given class is a kind of user. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00103">lib/Transforms/ObjCARC/ObjCARC.h:103</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00534">DenseMap.h:534</a></div></div>
<div class="ttc" id="README-SSE_8txt_html_a63d206a063eefcdf8c318ded97b65020"><div class="ttname"><a href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a></div><div class="ttdeci">This currently compiles esp xmm0 movsd esp eax eax esp ret We should use not the dag combiner This is because dagcombine2 needs to be able to see through the X86ISD::Wrapper which DAGCombine can t really do The code for turning x load into a single vector load is target independent and should be moved to the dag combiner The code for turning x load into a vector load can only handle a direct load from a global or a direct load from the stack It should be generalized to handle any load from P</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00427">README-SSE.txt:427</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html"><div class="ttname"><a href="classllvm_1_1PHINode.html">llvm::PHINode</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01978">Instructions.h:1978</a></div></div>
<div class="ttc" id="Debug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html"><div class="ttname"><a href="classllvm_1_1CallInst.html">llvm::CallInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01161">Instructions.h:1161</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_aaa976a678f8297931857721e45e4803d"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#aaa976a678f8297931857721e45e4803d">llvm::objcarc::GetBasicInstructionClass</a></div><div class="ttdeci">static InstructionClass GetBasicInstructionClass(const Value *V)</div><div class="ttdoc">Determine which objc runtime call instruction class V belongs to. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00203">lib/Transforms/ObjCARC/ObjCARC.h:203</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a9b6dd0fc7a648a939e571246045b673e"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">llvm::SmallPtrSet::insert</a></div><div class="ttdeci">bool insert(PtrType Ptr)</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00253">SmallPtrSet.h:253</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aa435140d7b64d6414958067beccb4c94e"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa435140d7b64d6414958067beccb4c94e">llvm::objcarc::IC_StoreWeak</a></div><div class="ttdoc">objc_storeWeak (primitive) </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00086">lib/Transforms/ObjCARC/ObjCARC.h:86</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abb3826a839d3c715ce9538cb9ca7bec5"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abb3826a839d3c715ce9538cb9ca7bec5">llvm::objcarc::IsNoopOnNull</a></div><div class="ttdeci">static bool IsNoopOnNull(InstructionClass Class)</div><div class="ttdoc">Test if the given class represents instructions which do nothing if passed a null pointer...</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00133">lib/Transforms/ObjCARC/ObjCARC.h:133</a></div></div>
<div class="ttc" id="group__ARCOpt_html_ga577d1729941a8a5903686ba11161aa7e"><div class="ttname"><a href="group__ARCOpt.html#ga577d1729941a8a5903686ba11161aa7e">SequenceToString</a></div><div class="ttdeci">static std::string SequenceToString(Sequence A)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l00865">ObjCARCOpts.cpp:865</a></div></div>
<div class="ttc" id="group__ARCOpt_html_gae17710516ddda1ff2b53b6a198dac754"><div class="ttname"><a href="group__ARCOpt.html#gae17710516ddda1ff2b53b6a198dac754">ANNOTATE_TOPDOWN_BBSTART</a></div><div class="ttdeci">#define ANNOTATE_TOPDOWN_BBSTART(_states, _basicblock)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l01055">ObjCARCOpts.cpp:1055</a></div></div>
<div class="ttc" id="namespacellvm_1_1sys_1_1path_html_a33706aab89e700b8f79e1fa6f4f0e3ee"><div class="ttname"><a href="namespacellvm_1_1sys_1_1path.html#a33706aab89e700b8f79e1fa6f4f0e3ee">llvm::sys::path::begin</a></div><div class="ttdeci">const_iterator begin(StringRef path)</div><div class="ttdoc">Get begin iterator over path. </div><div class="ttdef"><b>Definition:</b> <a href="Path_8cpp_source.html#l00173">Path.cpp:173</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a26ccf11b81c01a45cb40137c775f7cad"><div class="ttname"><a href="classllvm_1_1Function.html#a26ccf11b81c01a45cb40137c775f7cad">llvm::Function::getReturnType</a></div><div class="ttdeci">Type * getReturnType() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00179">Function.cpp:179</a></div></div>
<div class="ttc" id="classllvm_1_1MapVector_html"><div class="ttname"><a href="classllvm_1_1MapVector.html">llvm::MapVector</a></div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00033">MapVector.h:33</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_aca229503e4f5c83a187a6a921c625fa8"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">llvm::BasicBlock::getParent</a></div><div class="ttdeci">const Function * getParent() const </div><div class="ttdoc">Return the enclosing method, or null if none. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00116">BasicBlock.h:116</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_ad19ebfc50df266d6f4062104ac48933c"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#ad19ebfc50df266d6f4062104ac48933c">llvm::objcarc::operator&lt;&lt;</a></div><div class="ttdeci">raw_ostream &amp; operator&lt;&lt;(raw_ostream &amp;OS, const InstructionClass Class)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCUtil_8cpp_source.html#l00028">ObjCARCUtil.cpp:28</a></div></div>
<div class="ttc" id="classllvm_1_1MDNode_html"><div class="ttname"><a href="classllvm_1_1MDNode.html">llvm::MDNode</a></div><div class="ttdoc">MDNode - a tuple of other values. </div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l00073">Metadata.h:73</a></div></div>
<div class="ttc" id="LLParser_8cpp_html_a33ece1ef8074506a15d7f86eb76dbae6"><div class="ttname"><a href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a></div><div class="ttdeci">F(f)</div></div>
<div class="ttc" id="namespacellvm_html_a7098b8504987e5063c247c8b1c58948b"><div class="ttname"><a href="namespacellvm.html#a7098b8504987e5063c247c8b1c58948b">llvm::initializeObjCARCOptPass</a></div><div class="ttdeci">void initializeObjCARCOptPass(PassRegistry &amp;)</div></div>
<div class="ttc" id="classllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00070">Function.h:70</a></div></div>
<div class="ttc" id="classllvm_1_1LoadInst_html"><div class="ttname"><a href="classllvm_1_1LoadInst.html">llvm::LoadInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00136">Instructions.h:136</a></div></div>
<div class="ttc" id="classllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00033">User.h:33</a></div></div>
<div class="ttc" id="IVUsers_8cpp_html_a4e5b9edb51eec9dbca592075eb64dfcb"><div class="ttname"><a href="IVUsers_8cpp.html#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a></div><div class="ttdeci">iv Induction Variable Users</div><div class="ttdef"><b>Definition:</b> <a href="IVUsers_8cpp_source.html#l00039">IVUsers.cpp:39</a></div></div>
<div class="ttc" id="Statistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aa11b5bdda15281a198319b3c10debbe56"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa11b5bdda15281a198319b3c10debbe56">llvm::objcarc::IC_CopyWeak</a></div><div class="ttdoc">objc_copyWeak (derived) </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00090">lib/Transforms/ObjCARC/ObjCARC.h:90</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html_a17ebd56685ee19e7761ae577cd511e25"><div class="ttname"><a href="classllvm_1_1Module.html#a17ebd56685ee19e7761ae577cd511e25">llvm::Module::getGlobalVariable</a></div><div class="ttdeci">const GlobalVariable * getGlobalVariable(StringRef Name, bool AllowInternal=false) const </div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00355">Module.h:355</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a5da8c772f836519f6c891870ea5ef7b3"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a5da8c772f836519f6c891870ea5ef7b3">llvm::objcarc::IsForwarding</a></div><div class="ttdeci">static bool IsForwarding(InstructionClass Class)</div><div class="ttdoc">Test if the given class represents instructions which return their argument verbatim. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00123">lib/Transforms/ObjCARC/ObjCARC.h:123</a></div></div>
<div class="ttc" id="classllvm_1_1MDNode_html_ad66ceb4f77078b084e527a19baab19d6"><div class="ttname"><a href="classllvm_1_1MDNode.html#ad66ceb4f77078b084e527a19baab19d6">llvm::MDNode::get</a></div><div class="ttdeci">static MDNode * get(LLVMContext &amp;Context, ArrayRef&lt; Value * &gt; Vals)</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l00268">Metadata.cpp:268</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html_aa6574d526b3e38a28f688a7bb4325c2c"><div class="ttname"><a href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">llvm::Constant::getNullValue</a></div><div class="ttdeci">static Constant * getNullValue(Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00111">Constants.cpp:111</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad452febc1ac0b394876e640ec03ffa38"><div class="ttname"><a href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00167">Value.cpp:167</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0ed5f3ab3c2e4196ee0cffffa080c062"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">llvm::BasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00193">BasicBlock.h:193</a></div></div>
<div class="ttc" id="classllvm_1_1MDNode_html_adb91929f939ff02dbee552d32afaf4e6"><div class="ttname"><a href="classllvm_1_1MDNode.html#adb91929f939ff02dbee552d32afaf4e6">llvm::MDNode::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const LLVM_READONLY</div><div class="ttdoc">getOperand - Return specified operand. </div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l00307">Metadata.cpp:307</a></div></div>
<div class="ttc" id="group__ARCOpt_html_gaa24d32d1803abde016a7c3a2333bf091"><div class="ttname"><a href="group__ARCOpt.html#gaa24d32d1803abde016a7c3a2333bf091">ANNOTATE_BOTTOMUP_BBEND</a></div><div class="ttdeci">#define ANNOTATE_BOTTOMUP_BBEND(_states, _basicblock)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l01052">ObjCARCOpts.cpp:1052</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html_ae5c60fd282ee894c87ea02c3f0fcb6d0"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">llvm::AnalysisUsage::addRequired</a></div><div class="ttdeci">AnalysisUsage &amp; addRequired()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00055">PassAnalysisSupport.h:55</a></div></div>
<div class="ttc" id="namespacellvm_1_1GraphProgram_html_a0ad4685976f8c4d4a697a53fbe05d10b"><div class="ttname"><a href="namespacellvm_1_1GraphProgram.html#a0ad4685976f8c4d4a697a53fbe05d10b">llvm::GraphProgram::Name</a></div><div class="ttdeci">Name</div><div class="ttdef"><b>Definition:</b> <a href="GraphWriter_8h_source.html#l00044">GraphWriter.h:44</a></div></div>
<div class="ttc" id="PassSupport_8h_html_a14724f1ccf528e73bb29bc9230737967"><div class="ttname"><a href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a></div><div class="ttdeci">#define INITIALIZE_PASS_DEPENDENCY(depName)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00167">PassSupport.h:167</a></div></div>
<div class="ttc" id="classllvm_1_1InstIterator_html"><div class="ttname"><a href="classllvm_1_1InstIterator.html">llvm::InstIterator</a></div><div class="ttdef"><b>Definition:</b> <a href="InstIterator_8h_source.html#l00031">InstIterator.h:31</a></div></div>
<div class="ttc" id="group__ARCOpt_html_gabf7ea5e049c352b82f84b2c9c64cce89"><div class="ttname"><a href="group__ARCOpt.html#gabf7ea5e049c352b82f84b2c9c64cce89">HasSafePathToPredecessorCall</a></div><div class="ttdeci">static bool HasSafePathToPredecessorCall(const Value *Arg, Instruction *Retain, SmallPtrSet&lt; Instruction *, 4 &gt; &amp;DepInsts, SmallPtrSet&lt; const BasicBlock *, 4 &gt; &amp;Visited, ProvenanceAnalysis &amp;PA)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l02859">ObjCARCOpts.cpp:2859</a></div></div>
<div class="ttc" id="classllvm_1_1value__use__iterator_html"><div class="ttname"><a href="classllvm_1_1value__use__iterator.html">llvm::value_use_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00168">Use.h:168</a></div></div>
<div class="ttc" id="namespacellvm_html_a49a219f3fe3d7a6cc07c49a1ea766d6d"><div class="ttname"><a href="namespacellvm.html#a49a219f3fe3d7a6cc07c49a1ea766d6d">llvm::inst_begin</a></div><div class="ttdeci">inst_iterator inst_begin(Function *F)</div><div class="ttdef"><b>Definition:</b> <a href="InstIterator_8h_source.html#l00128">InstIterator.h:128</a></div></div>
<div class="ttc" id="classllvm_1_1SelectInst_html"><div class="ttname"><a href="classllvm_1_1SelectInst.html">llvm::SelectInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01430">Instructions.h:1430</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a400eaca9881c8dcab97e9f42b1ab1815"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">llvm::SmallVectorImpl::pop_back_val</a></div><div class="ttdeci">T LLVM_ATTRIBUTE_UNUSED_RESULT pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00430">SmallVector.h:430</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a85502898d19c32629e2e17fe94f34985"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a85502898d19c32629e2e17fe94f34985">llvm::objcarc::StripPointerCastsAndObjCCalls</a></div><div class="ttdeci">static const Value * StripPointerCastsAndObjCCalls(const Value *V)</div><div class="ttdoc">This is a wrapper around Value::stripPointerCasts which also knows how to look through objc_retain an...</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00235">lib/Transforms/ObjCARC/ObjCARC.h:235</a></div></div>
<div class="ttc" id="ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdef"><b>Definition:</b> <a href="ErrorHandling_8h_source.html#l00103">ErrorHandling.h:103</a></div></div>
<div class="ttc" id="group__ARCOpt_html_ga904bef748519b92d799b4589ebfc51a8"><div class="ttname"><a href="group__ARCOpt.html#ga904bef748519b92d799b4589ebfc51a8">STATISTIC</a></div><div class="ttdeci">STATISTIC(NumNoops,&quot;Number of no-op objc calls eliminated&quot;)</div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html"><div class="ttname"><a href="namespacellvm_1_1objcarc.html">llvm::objcarc</a></div><div class="ttdef"><b>Definition:</b> <a href="ARCRuntimeEntryPoints_8h_source.html#l00028">ARCRuntimeEntryPoints.h:28</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a775dd3ca9940b5d893932c22a293be32"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a775dd3ca9940b5d893932c22a293be32">llvm::objcarc::GetInstructionClass</a></div><div class="ttdeci">InstructionClass GetInstructionClass(const Value *V)</div><div class="ttdoc">Determine what kind of construct V is. </div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCUtil_8cpp_source.html#l00167">ObjCARCUtil.cpp:167</a></div></div>
<div class="ttc" id="PassSupport_8h_html_a74ce8276b89067e806f67c45a6d92575"><div class="ttname"><a href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a></div><div class="ttdeci">#define INITIALIZE_PASS_END(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00172">PassSupport.h:172</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00035">APInt.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html"><div class="ttname"><a href="classllvm_1_1IRBuilder.html">llvm::IRBuilder</a></div><div class="ttdoc">This provides a uniform API for creating instructions and inserting them into a basic block: either a...</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00421">IRBuilder.h:421</a></div></div>
<div class="ttc" id="STLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="classllvm_1_1AliasAnalysis_html"><div class="ttname"><a href="classllvm_1_1AliasAnalysis.html">llvm::AliasAnalysis</a></div><div class="ttdef"><b>Definition:</b> <a href="AliasAnalysis_8h_source.html#l00056">AliasAnalysis.h:56</a></div></div>
<div class="ttc" id="classllvm_1_1AliasAnalysis_html_aa96743b70089c7a0ef5d935f34173826a43c7577d5f7b09c310e42a6ab471610b"><div class="ttname"><a href="classllvm_1_1AliasAnalysis.html#aa96743b70089c7a0ef5d935f34173826a43c7577d5f7b09c310e42a6ab471610b">llvm::AliasAnalysis::NoAlias</a></div><div class="ttdoc">No dependencies. </div><div class="ttdef"><b>Definition:</b> <a href="AliasAnalysis_8h_source.html#l00162">AliasAnalysis.h:162</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aaf7cd7b0299e107541779101a8d49a48a"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaf7cd7b0299e107541779101a8d49a48a">llvm::objcarc::IC_User</a></div><div class="ttdoc">could &quot;use&quot; a pointer </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00096">lib/Transforms/ObjCARC/ObjCARC.h:96</a></div></div>
<div class="ttc" id="namespacellvm_1_1CallingConv_html_a4f861731fc6dbfdccc05af5968d98974"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">llvm::CallingConv::ID</a></div><div class="ttdeci">ID</div><div class="ttdoc">LLVM Calling Convention Representation. </div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00026">CallingConv.h:26</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_af6aad0c9ba7b8720130235c9621b55b5"><div class="ttname"><a href="classllvm_1_1Instruction.html#af6aad0c9ba7b8720130235c9621b55b5">llvm::Instruction::clone</a></div><div class="ttdeci">Instruction * clone() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00541">Instruction.cpp:541</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aa442b643665868538ba47d657c13629e8"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa442b643665868538ba47d657c13629e8">llvm::objcarc::IC_Release</a></div><div class="ttdoc">objc_release </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00077">lib/Transforms/ObjCARC/ObjCARC.h:77</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00031">Instruction.h:31</a></div></div>
<div class="ttc" id="namespacellvm_html_a3720211f6e6389ab53734b989bfb6fce"><div class="ttname"><a href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">llvm::succ_begin</a></div><div class="ttdeci">Interval::succ_iterator succ_begin(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00107">Interval.h:107</a></div></div>
<div class="ttc" id="lib_2Transforms_2ObjCARC_2ObjCARC_8h_html"><div class="ttname"><a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h.html">ObjCARC.h</a></div></div>
<div class="ttc" id="group__ARCOpt_html_ga386165b3085de31f1131538519c8240f"><div class="ttname"><a href="group__ARCOpt.html#ga386165b3085de31f1131538519c8240f">GenerateARCBBEntranceAnnotation</a></div><div class="ttdeci">static void GenerateARCBBEntranceAnnotation(const char *Name, BasicBlock *BB, Value *Ptr, Sequence Seq)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l00901">ObjCARCOpts.cpp:901</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionType_html"><div class="ttname"><a href="classllvm_1_1FunctionType.html">llvm::FunctionType</a></div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00096">DerivedTypes.h:96</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_af348d5ea83429d08ba891ca3dd0e92b2"><div class="ttname"><a href="classllvm_1_1Type.html#af348d5ea83429d08ba891ca3dd0e92b2">llvm::Type::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdoc">getContext - Return the LLVMContext in which this type was uniqued. </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00128">Type.h:128</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a2ced6343b8ad006a757059554bbf9f37"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">llvm::SmallPtrSet::count</a></div><div class="ttdeci">bool count(PtrType Ptr) const </div><div class="ttdoc">count - Return true if the specified pointer is in the set. </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00264">SmallPtrSet.h:264</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aa02e0eccce75bf149ddc6aa9eb323ffaa"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa02e0eccce75bf149ddc6aa9eb323ffaa">llvm::objcarc::IC_Autorelease</a></div><div class="ttdoc">objc_autorelease </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00078">lib/Transforms/ObjCARC/ObjCARC.h:78</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorBase_html_a8a8df4d85555c7954a95f86080cd3b64"><div class="ttname"><a href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">llvm::SmallVectorBase::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00056">SmallVector.h:56</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a6771e7364c5ab8a6354f744fe5bbc62b"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a6771e7364c5ab8a6354f744fe5bbc62b">llvm::objcarc::EnableARCOpts</a></div><div class="ttdeci">bool EnableARCOpts</div><div class="ttdoc">A handy option to enable/disable all ARC Optimizations. </div><div class="ttdef"><b>Definition:</b> <a href="ObjCARC_8cpp_source.html#l00030">ObjCARC.cpp:30</a></div></div>
<div class="ttc" id="SmallPtrSet_8h_html"><div class="ttname"><a href="SmallPtrSet_8h.html">SmallPtrSet.h</a></div></div>
<div class="ttc" id="classllvm_1_1BitCastInst_html"><div class="ttname"><a href="classllvm_1_1BitCastInst.html">llvm::BitCastInst</a></div><div class="ttdoc">This class represents a no-op cast from one type to another. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03587">Instructions.h:3587</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionType_html_a7e89b55242c964ae61b7850e99cacef0"><div class="ttname"><a href="classllvm_1_1FunctionType.html#a7e89b55242c964ae61b7850e99cacef0">llvm::FunctionType::get</a></div><div class="ttdeci">static FunctionType * get(Type *Result, ArrayRef&lt; Type * &gt; Params, bool isVarArg)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00361">Type.cpp:361</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayRef_html"><div class="ttname"><a href="classllvm_1_1ArrayRef.html">llvm::ArrayRef</a></div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00031">ArrayRef.h:31</a></div></div>
<div class="ttc" id="namespacellvm_html_af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51"><div class="ttname"><a href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">llvm::Call</a></div><div class="ttdef"><b>Definition:</b> <a href="CallingConvLower_8h_source.html#l00149">CallingConvLower.h:149</a></div></div>
<div class="ttc" id="classllvm_1_1StoreInst_html"><div class="ttname"><a href="classllvm_1_1StoreInst.html">llvm::StoreInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00255">Instructions.h:255</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00303">Value.cpp:303</a></div></div>
<div class="ttc" id="namespacellvm_1_1tgtok_html_abbc5259d649363016626e2529fabe0c5ada3eb06ada644390db065d37b3fd87ac"><div class="ttname"><a href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5ada3eb06ada644390db065d37b3fd87ac">llvm::tgtok::Class</a></div><div class="ttdef"><b>Definition:</b> <a href="TGLexer_8h_source.html#l00046">TGLexer.h:46</a></div></div>
<div class="ttc" id="ObjCARCOpts_8cpp_html_a7c6cee88be47642de240c7ed39a34ed3"><div class="ttname"><a href="ObjCARCOpts_8cpp.html#a7c6cee88be47642de240c7ed39a34ed3">Sequence</a></div><div class="ttdeci">Sequence</div><div class="ttdoc">A sequence of states that a pointer may go through in which an objc_retain and objc_release are actua...</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l00279">ObjCARCOpts.cpp:279</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a88a5e60837674780a9d812d661897ac5"><div class="ttname"><a href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">llvm::Function::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00395">Function.h:395</a></div></div>
<div class="ttc" id="group__ARCOpt_html_ga6f340da01646bd4e2fa91be9dd87e01a"><div class="ttname"><a href="group__ARCOpt.html#ga6f340da01646bd4e2fa91be9dd87e01a">ANNOTATE_BOTTOMUP</a></div><div class="ttdeci">#define ANNOTATE_BOTTOMUP(inst, ptr, old, new)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l01026">ObjCARCOpts.cpp:1026</a></div></div>
<div class="ttc" id="classllvm_1_1MapVector_html_a6b0c3e15c351ba9682837c29b0a141b6"><div class="ttname"><a href="classllvm_1_1MapVector.html#a6b0c3e15c351ba9682837c29b0a141b6">llvm::MapVector::find</a></div><div class="ttdeci">iterator find(const KeyT &amp;Key)</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00110">MapVector.h:110</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a910c6858e79ffad2a32aee7db4dec1d8"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a910c6858e79ffad2a32aee7db4dec1d8">llvm::objcarc::FindDependencies</a></div><div class="ttdeci">void FindDependencies(DependenceKind Flavor, const Value *Arg, BasicBlock *StartBB, Instruction *StartInst, SmallPtrSet&lt; Instruction *, 4 &gt; &amp;DependingInstructions, SmallPtrSet&lt; const BasicBlock *, 4 &gt; &amp;Visited, ProvenanceAnalysis &amp;PA)</div><div class="ttdef"><b>Definition:</b> <a href="DependencyAnalysis_8cpp_source.html#l00205">DependencyAnalysis.cpp:205</a></div></div>
<div class="ttc" id="group__ARCOpt_html_ga122c942371ff8ca7a7d9904d706f10c9"><div class="ttname"><a href="group__ARCOpt.html#ga122c942371ff8ca7a7d9904d706f10c9">SequenceToMDString</a></div><div class="ttdeci">static MDString * SequenceToMDString(LLVMContext &amp;Context, Sequence A)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l00874">ObjCARCOpts.cpp:874</a></div></div>
<div class="ttc" id="group__ARCOpt_html_ga01c7014451484f9784e68d42412d1b9c"><div class="ttname"><a href="group__ARCOpt.html#ga01c7014451484f9784e68d42412d1b9c">MergeSeqs</a></div><div class="ttdeci">static Sequence MergeSeqs(Sequence A, Sequence B, bool TopDown)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l00312">ObjCARCOpts.cpp:312</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_aa45f6c0433576e3858a6209a43750ad4"><div class="ttname"><a href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">llvm::PHINode::getNumIncomingValues</a></div><div class="ttdeci">unsigned getNumIncomingValues() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02055">Instructions.h:2055</a></div></div>
<div class="ttc" id="namespacellvm_html_a069c4ae2290101bde0f8d6a5074dc72b"><div class="ttname"><a href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">llvm::succ_end</a></div><div class="ttdeci">Interval::succ_iterator succ_end(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00110">Interval.h:110</a></div></div>
<div class="ttc" id="classllvm_1_1GetElementPtrInst_html"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html">llvm::GetElementPtrInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00709">Instructions.h:709</a></div></div>
<div class="ttc" id="classllvm_1_1objcarc_1_1ObjCARCAliasAnalysis_html"><div class="ttname"><a href="classllvm_1_1objcarc_1_1ObjCARCAliasAnalysis.html">llvm::objcarc::ObjCARCAliasAnalysis</a></div><div class="ttdoc">This is a simple alias analysis implementation that uses knowledge of ARC constructs to answer querie...</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCAliasAnalysis_8h_source.html#l00038">ObjCARCAliasAnalysis.h:38</a></div></div>
<div class="ttc" id="group__ARCOpt_html_gaf161d85830fb7b3acabeefce31e112ac"><div class="ttname"><a href="group__ARCOpt.html#gaf161d85830fb7b3acabeefce31e112ac">ARCAnnotationTargetIdentifier</a></div><div class="ttdeci">static cl::opt&lt; std::string &gt; ARCAnnotationTargetIdentifier(&quot;objc-arc-annotation-target-identifier&quot;, cl::init(&quot;&quot;), cl::desc(&quot;filter out all data flow annotations &quot;&quot;but those that apply to the given &quot;&quot;target llvm identifier.&quot;))</div></div>
<div class="ttc" id="README__ALTIVEC_8txt_html_a9aacd9146afe44bf656cd664e2a88c8c"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div><div class="ttdeci">(vector float) vec_cmpeq(*A,*B) C</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00091">README_ALTIVEC.txt:91</a></div></div>
<div class="ttc" id="CommandLine_8h_html"><div class="ttname"><a href="CommandLine_8h.html">CommandLine.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1cl_html_a10a041239ae1870cfcc064bfaa79fb65"><div class="ttname"><a href="namespacellvm_1_1cl.html#a10a041239ae1870cfcc064bfaa79fb65">llvm::cl::init</a></div><div class="ttdeci">initializer&lt; Ty &gt; init(const Ty &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00314">CommandLine.h:314</a></div></div>
<div class="ttc" id="classllvm_1_1sys_1_1path_1_1const__iterator_html_a8a503d1cbee10d1b8c8f5ac2a03b90df"><div class="ttname"><a href="classllvm_1_1sys_1_1path_1_1const__iterator.html#a8a503d1cbee10d1b8c8f5ac2a03b90df">llvm::sys::path::const_iterator::end</a></div><div class="ttdeci">friend const_iterator end(StringRef path)</div><div class="ttdoc">Get end iterator over path. </div><div class="ttdef"><b>Definition:</b> <a href="Path_8cpp_source.html#l00181">Path.cpp:181</a></div></div>
<div class="ttc" id="namespacellvm_1_1AArch64ISD_html_a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e"><div class="ttname"><a href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">llvm::AArch64ISD::Ret</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64ISelLowering_8h_source.html#l00060">AArch64ISelLowering.h:60</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_ac7e494db1258c53ea78810a0d6a5c879"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#ac7e494db1258c53ea78810a0d6a5c879">llvm::IRBuilder::CreateGlobalStringPtr</a></div><div class="ttdeci">Value * CreateGlobalStringPtr(StringRef Str, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdoc">Same as CreateGlobalString, but return a pointer with &quot;i8*&quot; type instead of a pointer to array of i8...</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01057">IRBuilder.h:1057</a></div></div>
<div class="ttc" id="group__ARCOpt_html_gad7170a77f0d0dab67cfd7b20756043ec"><div class="ttname"><a href="group__ARCOpt.html#gad7170a77f0d0dab67cfd7b20756043ec">ANNOTATE_TOPDOWN_BBEND</a></div><div class="ttdeci">#define ANNOTATE_TOPDOWN_BBEND(_states, _basicblock)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l01058">ObjCARCOpts.cpp:1058</a></div></div>
<div class="ttc" id="classllvm_1_1TerminatorInst_html"><div class="ttname"><a href="classllvm_1_1TerminatorInst.html">llvm::TerminatorInst</a></div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00035">InstrTypes.h:35</a></div></div>
<div class="ttc" id="namespacellvm_html_a78dbfbdf83fd4c3146e47f6c877db842"><div class="ttname"><a href="namespacellvm.html#a78dbfbdf83fd4c3146e47f6c877db842">llvm::succ_iterator</a></div><div class="ttdeci">SuccIterator&lt; TerminatorInst *, BasicBlock &gt; succ_iterator</div><div class="ttdef"><b>Definition:</b> <a href="Support_2CFG_8h_source.html#l00226">Support/CFG.h:226</a></div></div>
<div class="ttc" id="group__ARCOpt_html_ga4320fed90984fab278ec601fb74c5dfe"><div class="ttname"><a href="group__ARCOpt.html#ga4320fed90984fab278ec601fb74c5dfe">EnableARCAnnotations</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; EnableARCAnnotations(&quot;enable-objc-arc-annotations&quot;, cl::init(false), cl::desc(&quot;Enable emission of arc data flow analysis &quot;&quot;annotations&quot;))</div><div class="ttdoc">Enable/disable ARC sequence annotations. </div></div>
<div class="ttc" id="classllvm_1_1SuccIterator_html"><div class="ttname"><a href="classllvm_1_1SuccIterator.html">llvm::SuccIterator</a></div><div class="ttdef"><b>Definition:</b> <a href="Support_2CFG_8h_source.html#l00104">Support/CFG.h:104</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html_a96581205e1149f5d70b56f9a83bc841a"><div class="ttname"><a href="classllvm_1_1Module.html#a96581205e1149f5d70b56f9a83bc841a">llvm::Module::getOrInsertFunction</a></div><div class="ttdeci">Constant * getOrInsertFunction(StringRef Name, FunctionType *T, AttributeSet AttributeList)</div><div class="ttdef"><b>Definition:</b> <a href="Module_8cpp_source.html#l00138">Module.cpp:138</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_acd9e771a3296c6b24146955754620557"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">llvm::SmallVectorTemplateCommon&lt; T &gt;::back</a></div><div class="ttdeci">reference back()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00157">SmallVector.h:157</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a482498a1c760122fd33c7fc8190dd277"><div class="ttname"><a href="classllvm_1_1Instruction.html#a482498a1c760122fd33c7fc8190dd277">llvm::Instruction::insertBefore</a></div><div class="ttdeci">void insertBefore(Instruction *InsertPos)</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00078">Instruction.cpp:78</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_aac0ea55010b7b1a301e65a0baea057aa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">llvm::SmallVectorImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00396">SmallVector.h:396</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00072">BasicBlock.h:72</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html"><div class="ttname"><a href="classllvm_1_1Type.html">llvm::Type</a></div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00044">Type.h:44</a></div></div>
<div class="ttc" id="classllvm_1_1CallSiteBase_html_ae4c67f835911559821939fb23a2e7aff"><div class="ttname"><a href="classllvm_1_1CallSiteBase.html#ae4c67f835911559821939fb23a2e7aff">llvm::CallSiteBase::getInstruction</a></div><div class="ttdeci">InstrTy * getInstruction() const </div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00079">CallSite.h:79</a></div></div>
<div class="ttc" id="classllvm_1_1LLVMContext_html"><div class="ttname"><a href="classllvm_1_1LLVMContext.html">llvm::LLVMContext</a></div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00037">LLVMContext.h:37</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a18db47ff404831888e6f4dc327aec5f1"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a18db47ff404831888e6f4dc327aec5f1">llvm::objcarc::CanAlterRefCount</a></div><div class="ttdeci">bool CanAlterRefCount(const Instruction *Inst, const Value *Ptr, ProvenanceAnalysis &amp;PA, InstructionClass Class)</div><div class="ttdef"><b>Definition:</b> <a href="DependencyAnalysis_8cpp_source.html#l00035">DependencyAnalysis.cpp:35</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html"><div class="ttname"><a href="classllvm_1_1Constant.html">llvm::Constant</a></div><div class="ttdoc">LLVM Constant Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Constant_8h_source.html#l00041">Constant.h:41</a></div></div>
<div class="ttc" id="Support_2CFG_8h_html"><div class="ttname"><a href="Support_2CFG_8h.html">CFG.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aac8d3271bcb25ea91e214a57a68d3856f"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aac8d3271bcb25ea91e214a57a68d3856f">llvm::objcarc::IC_DestroyWeak</a></div><div class="ttdoc">objc_destroyWeak (derived) </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00091">lib/Transforms/ObjCARC/ObjCARC.h:91</a></div></div>
<div class="ttc" id="group__ARCOpt_html_ga2b898cab6afd53d4c51bbc644ae3e7eb"><div class="ttname"><a href="group__ARCOpt.html#ga2b898cab6afd53d4c51bbc644ae3e7eb">AppendMDNodeToSourcePtr</a></div><div class="ttdeci">static MDString * AppendMDNodeToSourcePtr(unsigned NodeId, Value *Ptr)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l00823">ObjCARCOpts.cpp:823</a></div></div>
<div class="ttc" id="structllvm_1_1cl_1_1desc_html"><div class="ttname"><a href="structllvm_1_1cl_1_1desc.html">llvm::cl::desc</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l00286">CommandLine.h:286</a></div></div>
<div class="ttc" id="namespacellvm_html_a7e108932dc3da5294aed99a353aac9c4"><div class="ttname"><a href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">llvm::pred_begin</a></div><div class="ttdeci">Interval::pred_iterator pred_begin(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00117">Interval.h:117</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00037">PassAnalysisSupport.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a6e20e76960d952de088354cbcd14c3ab"><div class="ttname"><a href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">llvm::Type::getVoidTy</a></div><div class="ttdeci">static Type * getVoidTy(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00227">Type.cpp:227</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a4c25b6c00c4867281779c81ab64d2081"><div class="ttname"><a href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">llvm::PHINode::getIncomingBlock</a></div><div class="ttdeci">BasicBlock * getIncomingBlock(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02074">Instructions.h:2074</a></div></div>
<div class="ttc" id="namespacellvm_html_aa1704159f75e6eacd595962ea6d93ffe"><div class="ttname"><a href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a></div><div class="ttdeci">ItTy next(ItTy it, Dist n)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00154">STLExtras.h:154</a></div></div>
<div class="ttc" id="group__ARCOpt_html_gad44eeecf3b037cda497f027bf50c8a3a"><div class="ttname"><a href="group__ARCOpt.html#gad44eeecf3b037cda497f027bf50c8a3a">CheckForCanReleaseCFGHazard</a></div><div class="ttdeci">static void CheckForCanReleaseCFGHazard(const Sequence SuccSSeq, const bool SuccSRRIKnownSafe, PtrState &amp;S, bool &amp;SomeSuccHasSame, bool &amp;AllSuccsHaveSame, bool &amp;NotAllSeqEqualButKnownSafe)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l01598">ObjCARCOpts.cpp:1598</a></div></div>
<div class="ttc" id="DenseSet_8h_html"><div class="ttname"><a href="DenseSet_8h.html">DenseSet.h</a></div></div>
<div class="ttc" id="Compiler_8h_html_acc1c483f4b4ee2f17bb6643a3b353609"><div class="ttname"><a href="Compiler_8h.html#acc1c483f4b4ee2f17bb6643a3b353609">LLVM_ATTRIBUTE_UNUSED</a></div><div class="ttdeci">#define LLVM_ATTRIBUTE_UNUSED</div><div class="ttdef"><b>Definition:</b> <a href="Compiler_8h_source.html#l00199">Compiler.h:199</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2a"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2a">llvm::objcarc::InstructionClass</a></div><div class="ttdeci">InstructionClass</div><div class="ttdoc">A simple classification for instructions. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00073">lib/Transforms/ObjCARC/ObjCARC.h:73</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionPass_html"><div class="ttname"><a href="classllvm_1_1FunctionPass.html">llvm::FunctionPass</a></div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00293">Pass.h:293</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a5b9ccd23396f8bc9c9780b8dedfe0b22"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a5b9ccd23396f8bc9c9780b8dedfe0b22">llvm::objcarc::IsNoopInstruction</a></div><div class="ttdeci">static bool IsNoopInstruction(const Instruction *I)</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00269">lib/Transforms/ObjCARC/ObjCARC.h:269</a></div></div>
<div class="ttc" id="classllvm_1_1LLVMContext_html_aa6ccc91e8705ccd80e1fa4568a1970da"><div class="ttname"><a href="classllvm_1_1LLVMContext.html#aa6ccc91e8705ccd80e1fa4568a1970da">llvm::LLVMContext::getMDKindID</a></div><div class="ttdeci">unsigned getMDKindID(StringRef Name) const </div><div class="ttdoc">getMDKindID - Return a unique non-zero ID for the specified metadata kind. </div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8cpp_source.html#l00152">LLVMContext.cpp:152</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a321e37d79af8b4287f8a1dcf9aff9c01"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, KeyInfoT &gt;, KeyT, ValueT, KeyInfoT &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00057">DenseMap.h:57</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a997ff6a1758bf732b9b263fc61011644"><div class="ttname"><a href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">llvm::User::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00088">User.h:88</a></div></div>
<div class="ttc" id="namespacellvm_html_a5eeaf08e96168c2cac8960f87f0ef360"><div class="ttname"><a href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">llvm::pred_end</a></div><div class="ttdeci">Interval::pred_iterator pred_end(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00120">Interval.h:120</a></div></div>
<div class="ttc" id="group__ARCUtilities_html_ga3e31fa79553c53df380d4054de2ca1c9"><div class="ttname"><a href="group__ARCUtilities.html#ga3e31fa79553c53df380d4054de2ca1c9">FindSingleUseIdentifiedObject</a></div><div class="ttdeci">static const Value * FindSingleUseIdentifiedObject(const Value *Arg)</div><div class="ttdoc">This is similar to StripPointerCastsAndObjCCalls but it stops as soon as it finds a value with multip...</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l00148">ObjCARCOpts.cpp:148</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a3e6b7918a169686d2131ad4bbaf201f3"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a3e6b7918a169686d2131ad4bbaf201f3">llvm::objcarc::IsObjCIdentifiedObject</a></div><div class="ttdeci">static bool IsObjCIdentifiedObject(const Value *V)</div><div class="ttdoc">Return true if this value refers to a distinct and identifiable object. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00362">lib/Transforms/ObjCARC/ObjCARC.h:362</a></div></div>
<div class="ttc" id="group__ARCOpt_html_ga61d78e7fc196dd16165fa1bed1639136"><div class="ttname"><a href="group__ARCOpt.html#ga61d78e7fc196dd16165fa1bed1639136">CheckForUseCFGHazard</a></div><div class="ttdeci">static void CheckForUseCFGHazard(const Sequence SuccSSeq, const bool SuccSRRIKnownSafe, PtrState &amp;S, bool &amp;SomeSuccHasSame, bool &amp;AllSuccsHaveSame, bool &amp;NotAllSeqEqualButKnownSafe, bool &amp;ShouldContinue)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l01560">ObjCARCOpts.cpp:1560</a></div></div>
<div class="ttc" id="DenseMap_8h_html"><div class="ttname"><a href="DenseMap_8h.html">DenseMap.h</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_ad696953257cf1c4e5bd12d02146e7287"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#ad696953257cf1c4e5bd12d02146e7287">llvm::SmallVectorTemplateCommon&lt; T &gt;::rend</a></div><div class="ttdeci">reverse_iterator rend()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00124">SmallVector.h:124</a></div></div>
<div class="ttc" id="group__ARCOpt_html_gaf2908adcd1e1db388d1ec6ef2f39e8eb"><div class="ttname"><a href="group__ARCOpt.html#gaf2908adcd1e1db388d1ec6ef2f39e8eb">INITIALIZE_PASS_BEGIN</a></div><div class="ttdeci">INITIALIZE_PASS_BEGIN(ObjCARCOpt,&quot;objc-arc&quot;,&quot;ObjC ARC optimization&quot;, false, false) INITIALIZE_PASS_END(ObjCARCOpt</div></div>
<div class="ttc" id="group__ARCOpt_html_gaba2c11e914151022314fc9e623d55597"><div class="ttname"><a href="group__ARCOpt.html#gaba2c11e914151022314fc9e623d55597">ANNOTATE_TOPDOWN</a></div><div class="ttdeci">#define ANNOTATE_TOPDOWN(inst, ptr, old, new)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l01032">ObjCARCOpts.cpp:1032</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalVariable_html"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html">llvm::GlobalVariable</a></div><div class="ttdef"><b>Definition:</b> <a href="GlobalVariable_8h_source.html#l00035">GlobalVariable.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1Statistic_html"><div class="ttname"><a href="classllvm_1_1Statistic.html">llvm::Statistic</a></div><div class="ttdef"><b>Definition:</b> <a href="Statistic_8h_source.html#l00035">Statistic.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_ad54481e3c992b555aeaba34a83daf7e6"><div class="ttname"><a href="classllvm_1_1CallInst.html#ad54481e3c992b555aeaba34a83daf7e6">llvm::CallInst::setTailCall</a></div><div class="ttdeci">void setTailCall(bool isTC=true)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01231">Instructions.h:1231</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a2eba483f5cc876e824aa6c085736086b"><div class="ttname"><a href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">llvm::Type::isPointerTy</a></div><div class="ttdeci">bool isPointerTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00220">Type.h:220</a></div></div>
<div class="ttc" id="classllvm_1_1UndefValue_html_a4ae5ff22b700a42bcc5d889233721335"><div class="ttname"><a href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">llvm::UndefValue::get</a></div><div class="ttdeci">static UndefValue * get(Type *T)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01334">Constants.cpp:1334</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_af85a4828b6b5a8de7fc0a55cc0e5b52f"><div class="ttname"><a href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">llvm::Value::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdoc">All values hold a context through their type. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00517">Value.cpp:517</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aaf3043c9d141f15c8e2539d027c612b0a"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaf3043c9d141f15c8e2539d027c612b0a">llvm::objcarc::IC_LoadWeak</a></div><div class="ttdoc">objc_loadWeak (derived) </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00088">lib/Transforms/ObjCARC/ObjCARC.h:88</a></div></div>
<div class="ttc" id="classllvm_1_1MapVector_html_ac2854f4232f02080c4e2105b84359a0e"><div class="ttname"><a href="classllvm_1_1MapVector.html#ac2854f4232f02080c4e2105b84359a0e">llvm::MapVector::count</a></div><div class="ttdeci">unsigned count(const KeyT &amp;Key) const </div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00105">MapVector.h:105</a></div></div>
<div class="ttc" id="classllvm_1_1raw__string__ostream_html_ae086260f8c216554ff46dcd96e171459"><div class="ttname"><a href="classllvm_1_1raw__string__ostream.html#ae086260f8c216554ff46dcd96e171459">llvm::raw_string_ostream::str</a></div><div class="ttdeci">std::string &amp; str()</div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8h_source.html#l00441">raw_ostream.h:441</a></div></div>
<div class="ttc" id="ObjCARCAliasAnalysis_8h_html"><div class="ttname"><a href="ObjCARCAliasAnalysis_8h.html">ObjCARCAliasAnalysis.h</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a9247a212ea89acc9573fa7e7f557eaba"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">llvm::Instruction::setMetadata</a></div><div class="ttdeci">void setMetadata(unsigned KindID, MDNode *Node)</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l00589">Metadata.cpp:589</a></div></div>
<div class="ttc" id="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints_html_a8c0ce6d07197d6b03c59e80ea8b6c33ba3de34b12b54752da3c240513fa97780c"><div class="ttname"><a href="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints.html#a8c0ce6d07197d6b03c59e80ea8b6c33ba3de34b12b54752da3c240513fa97780c">llvm::objcarc::ARCRuntimeEntryPoints::EPT_Autorelease</a></div><div class="ttdef"><b>Definition:</b> <a href="ARCRuntimeEntryPoints_8h_source.html#l00039">ARCRuntimeEntryPoints.h:39</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_a861226dd056dd2438da26760b8e7a9a0"><div class="ttname"><a href="classllvm_1_1CallInst.html#a861226dd056dd2438da26760b8e7a9a0">llvm::CallInst::Create</a></div><div class="ttdeci">static CallInst * Create(Value *Func, ArrayRef&lt; Value * &gt; Args, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01187">Instructions.h:1187</a></div></div>
<div class="ttc" id="classKeyT_html"><div class="ttname"><a href="classKeyT.html">KeyT</a></div></div>
<div class="ttc" id="group__ARCUtilities_html_ga0ea9cd5bf9acb5ded710efad514f139f"><div class="ttname"><a href="group__ARCUtilities.html#ga0ea9cd5bf9acb5ded710efad514f139f">AreAnyUnderlyingObjectsAnAlloca</a></div><div class="ttdeci">static bool AreAnyUnderlyingObjectsAnAlloca(const Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l00182">ObjCARCOpts.cpp:182</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSetIterator_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSetIterator.html">llvm::SmallPtrSetIterator</a></div><div class="ttdoc">SmallPtrSetIterator - This implements a const_iterator for SmallPtrSet. </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00174">SmallPtrSet.h:174</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSetImpl_html_aa72472422d95c7052d62432ec279ff85"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#aa72472422d95c7052d62432ec279ff85">llvm::SmallPtrSetImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00077">SmallPtrSet.h:77</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_af4e05bf48a81b884e707efa650560fbf"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#af4e05bf48a81b884e707efa650560fbf">llvm::objcarc::EraseInstruction</a></div><div class="ttdeci">static void EraseInstruction(Instruction *CI)</div><div class="ttdoc">Erase the given instruction. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00282">lib/Transforms/ObjCARC/ObjCARC.h:282</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a9af0808dc66b73d8a1781feadce89111"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a9af0808dc66b73d8a1781feadce89111">llvm::objcarc::IsNoThrow</a></div><div class="ttdeci">static bool IsNoThrow(InstructionClass Class)</div><div class="ttdoc">Test if the given class represents instructions which are always safe to mark with the nounwind attri...</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00164">lib/Transforms/ObjCARC/ObjCARC.h:164</a></div></div>
<div class="ttc" id="classllvm_1_1ilist__iterator_html"><div class="ttname"><a href="classllvm_1_1ilist__iterator.html">llvm::ilist_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00050">ilist.h:50</a></div></div>
<div class="ttc" id="Target_2ARM_2README_8txt_html_a1b45f45820a60c09244a87eb59824aec"><div class="ttname"><a href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a></div><div class="ttdeci">add sub stmia L5 ldr r0 bl L_printf $stub Instead of a and a wouldn t it be better to do three moves *Return an aggregate type is even return S</div><div class="ttdef"><b>Definition:</b> <a href="Target_2ARM_2README_8txt_source.html#l00197">Target/ARM/README.txt:197</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html">llvm::SmallPtrSet</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00236">SmallPtrSet.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a2ce650c1d4a48661b501206d04b6ab04"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a2ce650c1d4a48661b501206d04b6ab04">llvm::SmallPtrSet::erase</a></div><div class="ttdeci">bool erase(PtrType Ptr)</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00259">SmallPtrSet.h:259</a></div></div>
<div class="ttc" id="classllvm_1_1PointerType_html_a8db49fd5069f21d514e7bb0fd11f0902"><div class="ttname"><a href="classllvm_1_1PointerType.html#a8db49fd5069f21d514e7bb0fd11f0902">llvm::PointerType::getUnqual</a></div><div class="ttdeci">static PointerType * getUnqual(Type *ElementType)</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00436">DerivedTypes.h:436</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_aba6a4cc4ed6d6fef3664b8d65ef04820"><div class="ttname"><a href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">llvm::PHINode::getIncomingValue</a></div><div class="ttdeci">Value * getIncomingValue(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02059">Instructions.h:2059</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00029">Target/README.txt:29</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0b4e7bee9b8575cc7db73329f1a561bd"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">llvm::BasicBlock::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00195">BasicBlock.h:195</a></div></div>
<div class="ttc" id="classllvm_1_1sys_1_1path_1_1const__iterator_html_a79fe46db1f88832bc90447c6ec541cf2"><div class="ttname"><a href="classllvm_1_1sys_1_1path_1_1const__iterator.html#a79fe46db1f88832bc90447c6ec541cf2">llvm::sys::path::const_iterator::begin</a></div><div class="ttdeci">friend const_iterator begin(StringRef path)</div><div class="ttdoc">Get begin iterator over path. </div><div class="ttdef"><b>Definition:</b> <a href="Path_8cpp_source.html#l00173">Path.cpp:173</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_ad5330f6d2a7e879f0a480ccc30050de5"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#ad5330f6d2a7e879f0a480ccc30050de5">llvm::objcarc::IsNullOrUndef</a></div><div class="ttdeci">static bool IsNullOrUndef(const Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00265">lib/Transforms/ObjCARC/ObjCARC.h:265</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a87f9d4600f3d15f611d99b1781c48d08"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a87f9d4600f3d15f611d99b1781c48d08">llvm::objcarc::CanUse</a></div><div class="ttdeci">bool CanUse(const Instruction *Inst, const Value *Ptr, ProvenanceAnalysis &amp;PA, InstructionClass Class)</div><div class="ttdef"><b>Definition:</b> <a href="DependencyAnalysis_8cpp_source.html#l00072">DependencyAnalysis.cpp:72</a></div></div>
<div class="ttc" id="ProvenanceAnalysis_8h_html"><div class="ttname"><a href="ProvenanceAnalysis_8h.html">ProvenanceAnalysis.h</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00880">SmallVector.h:880</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a0cf3748dba54f931bb1241ae4adc76bc"><div class="ttname"><a href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00111">Value.h:111</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_aafa29112cbe02e4adc9b36752c771991"><div class="ttname"><a href="classllvm_1_1Instruction.html#aafa29112cbe02e4adc9b36752c771991">llvm::Instruction::getMetadata</a></div><div class="ttdeci">MDNode * getMetadata(unsigned KindID) const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00140">Instruction.h:140</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a269c7b8adcd29645a4f901196fc08806"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a269c7b8adcd29645a4f901196fc08806">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, KeyInfoT &gt;, KeyT, ValueT, KeyInfoT &gt;::erase</a></div><div class="ttdeci">bool erase(const KeyT &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00190">DenseMap.h:190</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a353f4c1f85416c596ecaa9c4d5afca75a197563bb332a0ac8f6b578e8b6fcf0a7"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a353f4c1f85416c596ecaa9c4d5afca75a197563bb332a0ac8f6b578e8b6fcf0a7">llvm::objcarc::CanChangeRetainCount</a></div><div class="ttdef"><b>Definition:</b> <a href="DependencyAnalysis_8h_source.html#l00047">DependencyAnalysis.h:47</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abc7c6543a527117c9d5b24c5e830eddb"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abc7c6543a527117c9d5b24c5e830eddb">llvm::objcarc::IsNeverTail</a></div><div class="ttdeci">static bool IsNeverTail(InstructionClass Class)</div><div class="ttdoc">Test if the given class represents instructions which are never safe to mark with the &quot;tail&quot; keyword...</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00153">lib/Transforms/ObjCARC/ObjCARC.h:153</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSetImpl_html_a41c201584742f7eb45b2be8cd54e3bcb"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a41c201584742f7eb45b2be8cd54e3bcb">llvm::SmallPtrSetImpl::size</a></div><div class="ttdeci">unsigned size() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00075">SmallPtrSet.h:75</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aa4c8ef5e5f2c988594f20a6e8b4d86c26"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa4c8ef5e5f2c988594f20a6e8b4d86c26">llvm::objcarc::IC_CallOrUser</a></div><div class="ttdoc">could call objc_release and/or &quot;use&quot; pointers </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00094">lib/Transforms/ObjCARC/ObjCARC.h:94</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html_af11a6ebf7ab3c388234cb6d5378439a3"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#af11a6ebf7ab3c388234cb6d5378439a3">llvm::AnalysisUsage::setPreservesCFG</a></div><div class="ttdeci">void setPreservesCFG()</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8cpp_source.html#l00249">Pass.cpp:249</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a30f2c362631e3728d2f47a8203071ade"><div class="ttname"><a href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">llvm::Function::getEntryBlock</a></div><div class="ttdeci">const BasicBlock &amp; getEntryBlock() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00380">Function.h:380</a></div></div>
<div class="ttc" id="namespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs - Return a circular-buffered debug stream. </div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00101">Debug.cpp:101</a></div></div>
<div class="ttc" id="namespacestd_html_ab8424022895aee3e366fb9a32f2883cb"><div class="ttname"><a href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a></div><div class="ttdeci">void swap(llvm::BitVector &amp;LHS, llvm::BitVector &amp;RHS)</div><div class="ttdoc">Implement std::swap in terms of BitVector swap. </div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00591">BitVector.h:591</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_a150b33ecedbc8c7803c2db8040fbe3f8"><div class="ttname"><a href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">llvm::CallInst::getArgOperand</a></div><div class="ttdeci">Value * getArgOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01245">Instructions.h:1245</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a2c32f032263eb1fa0ec96e9132f0b7c3"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a2c32f032263eb1fa0ec96e9132f0b7c3">llvm::objcarc::IsAutorelease</a></div><div class="ttdeci">static bool IsAutorelease(InstructionClass Class)</div><div class="ttdoc">Test if the given class is objc_autorelease or equivalent. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00116">lib/Transforms/ObjCARC/ObjCARC.h:116</a></div></div>
<div class="ttc" id="CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="CodeGen_2README_8txt_source.html#l00036">CodeGen/README.txt:36</a></div></div>
<div class="ttc" id="group__ARCOpt_html_ga4b518a379da0bd2b440cc0fdc21c6ba5"><div class="ttname"><a href="group__ARCOpt.html#ga4b518a379da0bd2b440cc0fdc21c6ba5">GenerateARCAnnotation</a></div><div class="ttdeci">static void GenerateARCAnnotation(unsigned InstMDId, unsigned PtrMDId, Instruction *Inst, Value *Ptr, Sequence OldSeq, Sequence NewSeq)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l00986">ObjCARCOpts.cpp:986</a></div></div>
<div class="ttc" id="group__ARCOpt_html_ga27d1a983231606f44b685cfe570729aa"><div class="ttname"><a href="group__ARCOpt.html#ga27d1a983231606f44b685cfe570729aa">llvm::createObjCARCOptPass</a></div><div class="ttdeci">Pass * createObjCARCOptPass()</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l01187">ObjCARCOpts.cpp:1187</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aa2d4ba97e16dbcc5627f4550bbc072214"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa2d4ba97e16dbcc5627f4550bbc072214">llvm::objcarc::IC_AutoreleaseRV</a></div><div class="ttdoc">objc_autoreleaseReturnValue </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00079">lib/Transforms/ObjCARC/ObjCARC.h:79</a></div></div>
<div class="ttc" id="classllvm_1_1AliasAnalysis_html_aa96743b70089c7a0ef5d935f34173826a0bf1a5eebff2ab91056e19ebba6c90d5"><div class="ttname"><a href="classllvm_1_1AliasAnalysis.html#aa96743b70089c7a0ef5d935f34173826a0bf1a5eebff2ab91056e19ebba6c90d5">llvm::AliasAnalysis::MayAlias</a></div><div class="ttdoc">Anything goes. </div><div class="ttdef"><b>Definition:</b> <a href="AliasAnalysis_8h_source.html#l00163">AliasAnalysis.h:163</a></div></div>
<div class="ttc" id="classllvm_1_1StringRef_html_a29c565e0d52fdd3b366971d07fa0c83c"><div class="ttname"><a href="classllvm_1_1StringRef.html#a29c565e0d52fdd3b366971d07fa0c83c">llvm::StringRef::equals</a></div><div class="ttdeci">bool equals(StringRef RHS) const </div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00129">StringRef.h:129</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a8a045d250952c0867382a9840ee18fdf"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">llvm::SmallVectorTemplateCommon&lt; T &gt;::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00112">SmallVector.h:112</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a413abcab8dbc3900fc2fde96a5d8fca6"><div class="ttname"><a href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">llvm::Value::use_begin</a></div><div class="ttdeci">use_iterator use_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00150">Value.h:150</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aa1534960469029dd730603e21fdf178e3"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa1534960469029dd730603e21fdf178e3">llvm::objcarc::IC_InitWeak</a></div><div class="ttdoc">objc_initWeak (derived) </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00087">lib/Transforms/ObjCARC/ObjCARC.h:87</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_a61f747edd1ca001427e02e02a320b709"><div class="ttname"><a href="classllvm_1_1CallInst.html#a61f747edd1ca001427e02e02a320b709">llvm::CallInst::setCalledFunction</a></div><div class="ttdeci">void setCalledFunction(Value *Fn)</div><div class="ttdoc">setCalledFunction - Set the function called. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01367">Instructions.h:1367</a></div></div>
<div class="ttc" id="group__ARCOpt_html_ga594b2da4d72bed758ccf2c1923d462c9"><div class="ttname"><a href="group__ARCOpt.html#ga594b2da4d72bed758ccf2c1923d462c9">FindPredecessorRetainWithSafePath</a></div><div class="ttdeci">static CallInst * FindPredecessorRetainWithSafePath(const Value *Arg, BasicBlock *BB, Instruction *Autorelease, SmallPtrSet&lt; Instruction *, 4 &gt; &amp;DepInsts, SmallPtrSet&lt; const BasicBlock *, 4 &gt; &amp;Visited, ProvenanceAnalysis &amp;PA)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l02887">ObjCARCOpts.cpp:2887</a></div></div>
<div class="ttc" id="classllvm_1_1cl_1_1opt_html"><div class="ttname"><a href="classllvm_1_1cl_1_1opt.html">llvm::cl::opt</a></div><div class="ttdef"><b>Definition:</b> <a href="CommandLine_8h_source.html#l01149">CommandLine.h:1149</a></div></div>
<div class="ttc" id="classllvm_1_1ImmutableCallSite_html"><div class="ttname"><a href="classllvm_1_1ImmutableCallSite.html">llvm::ImmutableCallSite</a></div><div class="ttdoc">ImmutableCallSite - establish a view to a call site for examination. </div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00318">CallSite.h:318</a></div></div>
<div class="ttc" id="MD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00054">MD5.cpp:54</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a085b82f074c28030fb8e194377ed2d0c"><div class="ttname"><a href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">llvm::Value::hasOneUse</a></div><div class="ttdeci">bool hasOneUse() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00161">Value.h:161</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_abc04eae9879e3b4fe7f01ce0f4d4e71e"><div class="ttname"><a href="classllvm_1_1CallInst.html#abc04eae9879e3b4fe7f01ce0f4d4e71e">llvm::CallInst::setArgOperand</a></div><div class="ttdeci">void setArgOperand(unsigned i, Value *v)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01246">Instructions.h:1246</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aaa7ab689fdb243382e550bcd4481ab6ef"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaa7ab689fdb243382e550bcd4481ab6ef">llvm::objcarc::IC_RetainRV</a></div><div class="ttdoc">objc_retainAutoreleasedReturnValue </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00075">lib/Transforms/ObjCARC/ObjCARC.h:75</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a353f4c1f85416c596ecaa9c4d5afca75ae9cb4656651e6d8f4748dac4bbe1b361"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a353f4c1f85416c596ecaa9c4d5afca75ae9cb4656651e6d8f4748dac4bbe1b361">llvm::objcarc::NeedsPositiveRetainCount</a></div><div class="ttdef"><b>Definition:</b> <a href="DependencyAnalysis_8h_source.html#l00045">DependencyAnalysis.h:45</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aaef6419c2f55a21022941218870534187"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaef6419c2f55a21022941218870534187">llvm::objcarc::IC_IntrinsicUser</a></div><div class="ttdoc">clang.arc.use </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00093">lib/Transforms/ObjCARC/ObjCARC.h:93</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_a1f2303df9bbee2233c11d61c2f6f7930"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#a1f2303df9bbee2233c11d61c2f6f7930">llvm::SmallVectorTemplateBase&lt; T, isPodLike&lt; T &gt;::value &gt;::pop_back</a></div><div class="ttdeci">void pop_back()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00260">SmallVector.h:260</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">llvm::GlobalValue::InternalLinkage</a></div><div class="ttdoc">Rename collisions when linking (static functions). </div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00041">GlobalValue.h:41</a></div></div>
<div class="ttc" id="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints_html"><div class="ttname"><a href="classllvm_1_1objcarc_1_1ARCRuntimeEntryPoints.html">llvm::objcarc::ARCRuntimeEntryPoints</a></div><div class="ttdef"><b>Definition:</b> <a href="ARCRuntimeEntryPoints_8h_source.html#l00032">ARCRuntimeEntryPoints.h:32</a></div></div>
<div class="ttc" id="IRBuilder_8h_html"><div class="ttname"><a href="IRBuilder_8h.html">IRBuilder.h</a></div></div>
<div class="ttc" id="classllvm_1_1MapVector_html_aa610cab7ee61e36a6d1d122fc252c278"><div class="ttname"><a href="classllvm_1_1MapVector.html#aa610cab7ee61e36a6d1d122fc252c278">llvm::MapVector::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00047">MapVector.h:47</a></div></div>
<div class="ttc" id="LLVMContext_8h_html"><div class="ttname"><a href="LLVMContext_8h.html">LLVMContext.h</a></div></div>
<div class="ttc" id="group__ARCOpt_html_gae5a7eeb1b77c0ad38f27bb76e943743e"><div class="ttname"><a href="group__ARCOpt.html#gae5a7eeb1b77c0ad38f27bb76e943743e">AppendMDNodeToInstForPtr</a></div><div class="ttdeci">static void AppendMDNodeToInstForPtr(unsigned NodeId, Instruction *Inst, Value *Ptr, MDString *PtrSourceMDNodeID, Sequence OldSeq, Sequence NewSeq)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l00881">ObjCARCOpts.cpp:881</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ac38c53f76ef532f91f1666c8a87370e9"><div class="ttname"><a href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">llvm::Value::use_empty</a></div><div class="ttdeci">bool use_empty() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00149">Value.h:149</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a902af4d6cb3a421a7f5723d0fc81efd1"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a902af4d6cb3a421a7f5723d0fc81efd1">llvm::IRBuilder::CreateCall2</a></div><div class="ttdeci">CallInst * CreateCall2(Value *Callee, Value *Arg1, Value *Arg2, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01310">IRBuilder.h:1310</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a23aab542398091e1fcfd46b6006d64ac"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a23aab542398091e1fcfd46b6006d64ac">llvm::SmallVectorTemplateCommon&lt; T &gt;::rbegin</a></div><div class="ttdeci">reverse_iterator rbegin()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00122">SmallVector.h:122</a></div></div>
<div class="ttc" id="classllvm_1_1MapVector_html_a0881334358ff6ff7ff8cea5562c7988e"><div class="ttname"><a href="classllvm_1_1MapVector.html#a0881334358ff6ff7ff8cea5562c7988e">llvm::MapVector::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="MapVector_8h_source.html#l00055">MapVector.h:55</a></div></div>
<div class="ttc" id="classllvm_1_1raw__string__ostream_html"><div class="ttname"><a href="classllvm_1_1raw__string__ostream.html">llvm::raw_string_ostream</a></div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8h_source.html#l00426">raw_ostream.h:426</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aaad2deec0f4615604f0e42d07b3d38241"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aaad2deec0f4615604f0e42d07b3d38241">llvm::objcarc::IC_Call</a></div><div class="ttdoc">could call objc_release </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00095">lib/Transforms/ObjCARC/ObjCARC.h:95</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_a9e1fc23a17e97d2d1732e753ae9251ac"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">llvm::GlobalValue::getParent</a></div><div class="ttdeci">Module * getParent()</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00286">GlobalValue.h:286</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00066">Value.h:66</a></div></div>
<div class="ttc" id="Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="Target_2X86_2README_8txt_source.html#l00297">Target/X86/README.txt:297</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a669d599eeacffd29a09050e2af83bf67"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">llvm::SmallPtrSet::begin</a></div><div class="ttdeci">iterator begin() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00276">SmallPtrSet.h:276</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">llvm::A64CC::MI</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00035">AArch64BaseInfo.h:35</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a353f4c1f85416c596ecaa9c4d5afca75ac6640fbd8b830536b76f884208bb53aa"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a353f4c1f85416c596ecaa9c4d5afca75ac6640fbd8b830536b76f884208bb53aa">llvm::objcarc::AutoreleasePoolBoundary</a></div><div class="ttdef"><b>Definition:</b> <a href="DependencyAnalysis_8h_source.html#l00046">DependencyAnalysis.h:46</a></div></div>
<div class="ttc" id="namespacellvm_html_a7923e3e207de8bc1d0d6a5091316ddde"><div class="ttname"><a href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a></div><div class="ttdeci">ItTy prior(ItTy it, Dist n)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00167">STLExtras.h:167</a></div></div>
<div class="ttc" id="classllvm_1_1raw__ostream_html"><div class="ttname"><a href="classllvm_1_1raw__ostream.html">llvm::raw_ostream</a></div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8h_source.html#l00031">raw_ostream.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1InvokeInst_html"><div class="ttname"><a href="classllvm_1_1InvokeInst.html">llvm::InvokeInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02841">Instructions.h:2841</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a21916491d53d3bcc4505817a4705e6bf"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a21916491d53d3bcc4505817a4705e6bf">llvm::objcarc::IsRetain</a></div><div class="ttdeci">static bool IsRetain(InstructionClass Class)</div><div class="ttdoc">Test if the given class is objc_retain or equivalent. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00110">lib/Transforms/ObjCARC/ObjCARC.h:110</a></div></div>
<div class="ttc" id="Debug_8h_html_aef41e8aaf4c60819b30faf396cdf4978"><div class="ttname"><a href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a></div><div class="ttdeci">#define DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00097">Debug.h:97</a></div></div>
<div class="ttc" id="classllvm_1_1objcarc_1_1ProvenanceAnalysis_html"><div class="ttname"><a href="classllvm_1_1objcarc_1_1ProvenanceAnalysis.html">llvm::objcarc::ProvenanceAnalysis</a></div><div class="ttdoc">This is similar to BasicAliasAnalysis, and it uses many of the same techniques, except it uses specia...</div><div class="ttdef"><b>Definition:</b> <a href="ProvenanceAnalysis_8h_source.html#l00049">ProvenanceAnalysis.h:49</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aabbcd83d361a8b4bebcfe8b3e4cc3758d"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aabbcd83d361a8b4bebcfe8b3e4cc3758d">llvm::objcarc::IC_LoadWeakRetained</a></div><div class="ttdoc">objc_loadWeakRetained (primitive) </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00085">lib/Transforms/ObjCARC/ObjCARC.h:85</a></div></div>
<div class="ttc" id="classllvm_1_1StringRef_html"><div class="ttname"><a href="classllvm_1_1StringRef.html">llvm::StringRef</a></div><div class="ttdef"><b>Definition:</b> <a href="StringRef_8h_source.html#l00041">StringRef.h:41</a></div></div>
<div class="ttc" id="namespacellvm_html_a945cded5463e0ccd3cf5a6ac80542a94"><div class="ttname"><a href="namespacellvm.html#a945cded5463e0ccd3cf5a6ac80542a94">llvm::inst_end</a></div><div class="ttdeci">inst_iterator inst_end(Function *F)</div><div class="ttdef"><b>Definition:</b> <a href="InstIterator_8h_source.html#l00129">InstIterator.h:129</a></div></div>
<div class="ttc" id="classllvm_1_1MDString_html"><div class="ttname"><a href="classllvm_1_1MDString.html">llvm::MDString</a></div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l00039">Metadata.h:39</a></div></div>
<div class="ttc" id="group__ARCOpt_html_gac3778bafa67cdae223698e5bba785a76"><div class="ttname"><a href="group__ARCOpt.html#gac3778bafa67cdae223698e5bba785a76">ComputePostOrders</a></div><div class="ttdeci">static void ComputePostOrders(Function &amp;F, SmallVectorImpl&lt; BasicBlock * &gt; &amp;PostOrder, SmallVectorImpl&lt; BasicBlock * &gt; &amp;ReverseCFGPostOrder, unsigned NoObjCARCExceptionsMDKind, DenseMap&lt; const BasicBlock *, BBState &gt; &amp;BBStates)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l02178">ObjCARCOpts.cpp:2178</a></div></div>
<div class="ttc" id="raw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_ab1cd5a3713b93a33f89a2086d473cf6e"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#ab1cd5a3713b93a33f89a2086d473cf6e">llvm::BasicBlock::getFirstInsertionPt</a></div><div class="ttdeci">iterator getFirstInsertionPt()</div><div class="ttdoc">Returns an iterator to the first instruction in this block that is suitable for inserting a non-PHI i...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00170">BasicBlock.cpp:170</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aa3f1e05902d8bb7ed742f01bb311b146e"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa3f1e05902d8bb7ed742f01bb311b146e">llvm::objcarc::IC_None</a></div><div class="ttdoc">anything else </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00097">lib/Transforms/ObjCARC/ObjCARC.h:97</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a573c7794ec488e927f074ba8a4647380"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a573c7794ec488e927f074ba8a4647380">llvm::objcarc::GetUnderlyingObjCPtr</a></div><div class="ttdeci">static const Value * GetUnderlyingObjCPtr(const Value *V)</div><div class="ttdoc">This is a wrapper around getUnderlyingObject which also knows how to look through objc_retain and obj...</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00221">lib/Transforms/ObjCARC/ObjCARC.h:221</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a02767ff646c069174b181da0a069e4b6"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a02767ff646c069174b181da0a069e4b6">llvm::objcarc::IsAlwaysTail</a></div><div class="ttdeci">static bool IsAlwaysTail(InstructionClass Class)</div><div class="ttdoc">Test if the given class represents instructions which are always safe to mark with the &quot;tail&quot; keyword...</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00144">lib/Transforms/ObjCARC/ObjCARC.h:144</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a21cf94357e53cd1069aba475266fdb63"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, KeyInfoT &gt;, KeyT, ValueT, KeyInfoT &gt;::find</a></div><div class="ttdeci">iterator find(const KeyT &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00108">DenseMap.h:108</a></div></div>
<div class="ttc" id="Target_2ARM_2README_8txt_html_a90cca76dd78688687e0d697679dbc799"><div class="ttname"><a href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional ldr LCPI1_0 ldr ldr tst movne lsr ldr LCPI1_1 and r0 bx lr it saves an instruction and a register It might be profitable to cse MOVi16 if there are lots of bit immediates with the same bottom half Robert Muth started working on an alternate jump table implementation that does not put the tables in line in the text This is more like the llvm default jump table implementation This might be useful sometime Several revisions of patches are on the mailing beginning while CMP sets them like a subtract Therefore to be able to use CMN for comparisons other than the Z we ll need additional logic to reverse the conditionals associated with the comparison Perhaps a pseudo instruction for the with a post codegen pass to clean up and handle the condition codes See PR5694 for testcase Given the following on int B</div><div class="ttdef"><b>Definition:</b> <a href="Target_2ARM_2README_8txt_source.html#l00592">Target/ARM/README.txt:592</a></div></div>
<div class="ttc" id="classllvm_1_1AliasAnalysis_html_aa96743b70089c7a0ef5d935f34173826acc20b6673c6cc680294a17b0f0f5d676"><div class="ttname"><a href="classllvm_1_1AliasAnalysis.html#aa96743b70089c7a0ef5d935f34173826acc20b6673c6cc680294a17b0f0f5d676">llvm::AliasAnalysis::MustAlias</a></div><div class="ttdoc">Pointers are equal. </div><div class="ttdef"><b>Definition:</b> <a href="AliasAnalysis_8h_source.html#l00165">AliasAnalysis.h:165</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a7ba5de75f50bb4a4ba920698edf39b28"><div class="ttname"><a href="classllvm_1_1Type.html#a7ba5de75f50bb4a4ba920698edf39b28">llvm::Type::getInt8Ty</a></div><div class="ttdeci">static IntegerType * getInt8Ty(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00239">Type.cpp:239</a></div></div>
<div class="ttc" id="namespacellvm_html_a846137dc22b3b399b62f606698f3ed59"><div class="ttname"><a href="namespacellvm.html#a846137dc22b3b399b62f606698f3ed59">llvm::AreStatisticsEnabled</a></div><div class="ttdeci">bool AreStatisticsEnabled()</div><div class="ttdoc">Check if statistics are enabled. </div><div class="ttdef"><b>Definition:</b> <a href="Statistic_8cpp_source.html#l00110">Statistic.cpp:110</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a9cd49851904f15060edb782ef4dd1b2d"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00052">Instruction.h:52</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_a9974a476e27654f3a1605a15a1c1d371"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#a9974a476e27654f3a1605a15a1c1d371">llvm::objcarc::ModuleHasARC</a></div><div class="ttdeci">static bool ModuleHasARC(const Module &amp;M)</div><div class="ttdoc">Test if the given module looks interesting to run ARC optimization on. </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00049">lib/Transforms/ObjCARC/ObjCARC.h:49</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aabbf6ec1064199e8c4ecba1aaccf93f47"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aabbf6ec1064199e8c4ecba1aaccf93f47">llvm::objcarc::IC_RetainBlock</a></div><div class="ttdoc">objc_retainBlock </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00076">lib/Transforms/ObjCARC/ObjCARC.h:76</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html_a0e74af4b7c739f3a14e737c3042b6617"><div class="ttname"><a href="classllvm_1_1Module.html#a0e74af4b7c739f3a14e737c3042b6617">llvm::Module::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00249">Module.h:249</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aa269efb4e3ea57dfd32d863410e85e2c3"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa269efb4e3ea57dfd32d863410e85e2c3">llvm::objcarc::IC_MoveWeak</a></div><div class="ttdoc">objc_moveWeak (derived) </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00089">lib/Transforms/ObjCARC/ObjCARC.h:89</a></div></div>
<div class="ttc" id="classllvm_1_1AllocaInst_html"><div class="ttname"><a href="classllvm_1_1AllocaInst.html">llvm::AllocaInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00058">Instructions.h:58</a></div></div>
<div class="ttc" id="group__ARCOpt_html_ga8ad945d6af5e5e566ce8fa704e617de3"><div class="ttname"><a href="group__ARCOpt.html#ga8ad945d6af5e5e566ce8fa704e617de3">DisableCheckForCFGHazards</a></div><div class="ttdeci">static cl::opt&lt; bool &gt; DisableCheckForCFGHazards(&quot;disable-objc-arc-checkforcfghazards&quot;, cl::init(false), cl::desc(&quot;Disable check for cfg hazards when &quot;&quot;annotating&quot;))</div></div>
<div class="ttc" id="group__ARCOpt_html_ga5db61f160bd5ea2dde577876252e170d"><div class="ttname"><a href="group__ARCOpt.html#ga5db61f160bd5ea2dde577876252e170d">GenerateARCBBTerminatorAnnotation</a></div><div class="ttdeci">static void GenerateARCBBTerminatorAnnotation(const char *Name, BasicBlock *BB, Value *Ptr, Sequence Seq)</div><div class="ttdef"><b>Definition:</b> <a href="ObjCARCOpts_8cpp_source.html#l00944">ObjCARCOpts.cpp:944</a></div></div>
<div class="ttc" id="namespacellvm_1_1objcarc_html_abba93b7feb4ffebce5927b8def92ee2aa043507659210c5bcea4f40804f24d769"><div class="ttname"><a href="namespacellvm_1_1objcarc.html#abba93b7feb4ffebce5927b8def92ee2aa043507659210c5bcea4f40804f24d769">llvm::objcarc::IC_AutoreleasepoolPush</a></div><div class="ttdoc">objc_autoreleasePoolPush </div><div class="ttdef"><b>Definition:</b> <a href="lib_2Transforms_2ObjCARC_2ObjCARC_8h_source.html#l00080">lib/Transforms/ObjCARC/ObjCARC.h:80</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<p class="footer">
Generated on Sat Nov 10 2018 23:00:30 for <a href="http://llvm.org/">LLVM</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.8.11</a><br>
Copyright &copy; 2003-2013 University of Illinois at Urbana-Champaign.
All Rights Reserved.</p>
<hr>
<!--#include virtual="/attrib.incl" -->
</body>
</html>
