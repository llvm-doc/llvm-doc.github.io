<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="LLVM,Low Level Virtual Machine,C++,doxygen,API,documentation"/>
<meta name="description" content="C++ source code API documentation for LLVM."/>
<title>LLVM: ScalarReplAggregates.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">LLVM API Documentation</p>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ScalarReplAggregates_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ScalarReplAggregates.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ScalarReplAggregates_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- ScalarReplAggregates.cpp - Scalar Replacement of Aggregates --------===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                     The LLVM Compiler Infrastructure</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is distributed under the University of Illinois Open Source</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License. See LICENSE.TXT for details.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// This transformation implements the well known scalar replacement of</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// aggregates transformation.  This xform breaks up alloca instructions of</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// aggregate type (structure or array) into individual alloca instructions for</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// each member (if possible).  Then, if possible, it transforms the individual</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// alloca instructions into nice clean scalar SSA form.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// This combines a simple SRoA algorithm with the Mem2Reg algorithm because they</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// often interact, especially for C++ programs.  As such, iterating between</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// SRoA, then Mem2Reg until we run out of things to promote works well.</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="ScalarReplAggregates_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   22</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;scalarrepl&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Transforms_2Scalar_8h.html">llvm/Transforms/Scalar.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SetVector_8h.html">llvm/ADT/SetVector.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallVector_8h.html">llvm/ADT/SmallVector.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Dominators_8h.html">llvm/Analysis/Dominators.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Loads_8h.html">llvm/Analysis/Loads.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueTracking_8h.html">llvm/Analysis/ValueTracking.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DIBuilder_8h.html">llvm/DIBuilder.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DebugInfo_8h.html">llvm/DebugInfo.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DataLayout_8h.html">llvm/IR/DataLayout.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DerivedTypes_8h.html">llvm/IR/DerivedTypes.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Function_8h.html">llvm/IR/Function.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GlobalVariable_8h.html">llvm/IR/GlobalVariable.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IRBuilder_8h.html">llvm/IR/IRBuilder.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IntrinsicInst_8h.html">llvm/IR/IntrinsicInst.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="LLVMContext_8h.html">llvm/IR/LLVMContext.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Module_8h.html">llvm/IR/Module.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Operator_8h.html">llvm/IR/Operator.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Pass_8h.html">llvm/Pass.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CallSite_8h.html">llvm/Support/CallSite.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ErrorHandling_8h.html">llvm/Support/ErrorHandling.h</a>&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GetElementPtrTypeIterator_8h.html">llvm/Support/GetElementPtrTypeIterator.h</a>&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MathExtras_8h.html">llvm/Support/MathExtras.h</a>&quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Local_8h.html">llvm/Transforms/Utils/Local.h</a>&quot;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PromoteMemToReg_8h.html">llvm/Transforms/Utils/PromoteMemToReg.h</a>&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SSAUpdater_8h.html">llvm/Transforms/Utils/SSAUpdater.h</a>&quot;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<a class="code" href="ScalarReplAggregates_8cpp.html#a49e4c863caf09cc174f83f0abd93f554">STATISTIC</a>(NumReplaced,  <span class="stringliteral">&quot;Number of allocas broken up&quot;</span>);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<a class="code" href="ScalarReplAggregates_8cpp.html#a49e4c863caf09cc174f83f0abd93f554">STATISTIC</a>(NumPromoted,  <span class="stringliteral">&quot;Number of allocas promoted&quot;</span>);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<a class="code" href="ScalarReplAggregates_8cpp.html#a49e4c863caf09cc174f83f0abd93f554">STATISTIC</a>(NumAdjusted,  <span class="stringliteral">&quot;Number of scalar allocas adjusted to allow promotion&quot;</span>);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<a class="code" href="ScalarReplAggregates_8cpp.html#a49e4c863caf09cc174f83f0abd93f554">STATISTIC</a>(NumConverted, <span class="stringliteral">&quot;Number of aggregates converted to scalar&quot;</span>);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keyword">struct </span>SROA : <span class="keyword">public</span> <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    SROA(<span class="keywordtype">int</span> <a class="code" href="classT.html">T</a>, <span class="keywordtype">bool</span> hasDT, <span class="keywordtype">char</span> &amp;<a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a>, <span class="keywordtype">int</span> <a class="code" href="namespacellvm_1_1A64DB.html#a6fce8157775f3ec93f326b52b0f1e0f5a4916e736d6b7cc68359b39d5eb50f6db">ST</a>, <span class="keywordtype">int</span> AT, <span class="keywordtype">int</span> SLT)</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      : <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a>(ID), HasDomTree(hasDT) {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <span class="keywordflow">if</span> (T == -1)</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        SRThreshold = 128;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        SRThreshold = <a class="code" href="Mips16ISelLowering_8cpp.html#a0acb682b8260ab1c60b918599864e2e5">T</a>;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      <span class="keywordflow">if</span> (ST == -1)</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        StructMemberThreshold = 32;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        StructMemberThreshold = <a class="code" href="namespacellvm_1_1A64DB.html#a6fce8157775f3ec93f326b52b0f1e0f5a4916e736d6b7cc68359b39d5eb50f6db">ST</a>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      <span class="keywordflow">if</span> (AT == -1)</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        ArrayElementThreshold = 8;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        ArrayElementThreshold = AT;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      <span class="keywordflow">if</span> (SLT == -1)</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="comment">// Do not limit the scalar integer load size if no threshold is given.</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        ScalarLoadThreshold = -1;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        ScalarLoadThreshold = SLT;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    }</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordtype">bool</span> runOnFunction(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordtype">bool</span> performScalarRepl(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordtype">bool</span> performPromotion(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keyword">private</span>:</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordtype">bool</span> HasDomTree;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">    /// DeadInsts - Keep track of instructions we have made dead, so that</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">    /// we can remove them after we are done working.</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 32&gt;</a> DeadInsts;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">    /// AllocaInfo - When analyzing uses of an alloca instruction, this captures</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">    /// information about the uses.  All these fields are initialized to false</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">    /// and set to true when something is learned.</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment"></span>    <span class="keyword">struct </span>AllocaInfo {<span class="comment"></span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">      /// The alloca to promote.</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"></span>      <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">      /// CheckedPHIs - This is a set of verified PHI nodes, to prevent infinite</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">      /// looping and avoid redundant work.</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"></span>      <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;PHINode*, 8&gt;</a> CheckedPHIs;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">      /// isUnsafe - This is set to true if the alloca cannot be SROA&#39;d.</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"></span>      <span class="keywordtype">bool</span> isUnsafe : 1;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">      /// isMemCpySrc - This is true if this aggregate is memcpy&#39;d from.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"></span>      <span class="keywordtype">bool</span> isMemCpySrc : 1;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">      /// isMemCpyDst - This is true if this aggregate is memcpy&#39;d into.</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"></span>      <span class="keywordtype">bool</span> isMemCpyDst : 1;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">      /// hasSubelementAccess - This is true if a subelement of the alloca is</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">      /// ever accessed, or false if the alloca is only accessed with mem</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">      /// intrinsics or load/store that only access the entire alloca at once.</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"></span>      <span class="keywordtype">bool</span> hasSubelementAccess : 1;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">      /// hasALoadOrStore - This is true if there are any loads or stores to it.</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">      /// The alloca may just be accessed with memcpy, for example, which would</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">      /// not set this.</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment"></span>      <span class="keywordtype">bool</span> hasALoadOrStore : 1;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <span class="keyword">explicit</span> AllocaInfo(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *ai)</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        : AI(ai), isUnsafe(<a class="code" href="namespacefalse.html">false</a>), isMemCpySrc(<a class="code" href="namespacefalse.html">false</a>), isMemCpyDst(<a class="code" href="namespacefalse.html">false</a>),</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;          hasSubelementAccess(<a class="code" href="namespacefalse.html">false</a>), hasALoadOrStore(<a class="code" href="namespacefalse.html">false</a>) {}</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    };</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">    /// SRThreshold - The maximum alloca size to considered for SROA.</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> SRThreshold;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">    /// StructMemberThreshold - The maximum number of members a struct can</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">    /// contain to be considered for SROA.</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> StructMemberThreshold;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">    /// ArrayElementThreshold - The maximum number of elements an array can</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">    /// have to be considered for SROA.</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> ArrayElementThreshold;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">    /// ScalarLoadThreshold - The maximum size in bits of scalars to load when</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">    /// converting to scalar</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment"></span>    <span class="keywordtype">unsigned</span> ScalarLoadThreshold;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordtype">void</span> MarkUnsafe(AllocaInfo &amp;<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a>) {</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      I.isUnsafe = <span class="keyword">true</span>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  Transformation preventing inst: &quot;</span> &lt;&lt; *User &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    }</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordtype">bool</span> isSafeAllocaToScalarRepl(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordtype">void</span> isSafeForScalarRepl(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I, uint64_t Offset, AllocaInfo &amp;Info);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordtype">void</span> isSafePHISelectUseForScalarRepl(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *User, uint64_t Offset,</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                                         AllocaInfo &amp;Info);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordtype">void</span> isSafeGEP(<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI, uint64_t &amp;Offset, AllocaInfo &amp;Info);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordtype">void</span> isSafeMemAccess(uint64_t Offset, uint64_t MemSize,</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                         <a class="code" href="classllvm_1_1Type.html">Type</a> *MemOpType, <span class="keywordtype">bool</span> isStore, AllocaInfo &amp;Info,</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                         <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TheAccess, <span class="keywordtype">bool</span> AllowWholeAccess);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordtype">bool</span> TypeHasComponent(<a class="code" href="classllvm_1_1Type.html">Type</a> *T, uint64_t Offset, uint64_t Size);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    uint64_t FindElementAndOffset(<a class="code" href="classllvm_1_1Type.html">Type</a> *&amp;T, uint64_t &amp;Offset,</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                                  <a class="code" href="classllvm_1_1Type.html">Type</a> *&amp;IdxTy);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordtype">void</span> DoScalarReplacement(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI,</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                             std::vector&lt;AllocaInst*&gt; &amp;WorkList);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordtype">void</span> DeleteDeadInstructions();</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordtype">void</span> RewriteForScalarRepl(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I, <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI, uint64_t Offset,</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                              <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;AllocaInst *&gt;</a> &amp;NewElts);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordtype">void</span> RewriteBitCast(<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BC, <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI, uint64_t Offset,</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                        <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;AllocaInst *&gt;</a> &amp;NewElts);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordtype">void</span> RewriteGEP(<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI, <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI, uint64_t Offset,</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;AllocaInst *&gt;</a> &amp;NewElts);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordtype">void</span> RewriteLifetimeIntrinsic(<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II, <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI,</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                                  uint64_t Offset,</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                                  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;AllocaInst *&gt;</a> &amp;NewElts);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordtype">void</span> RewriteMemIntrinUserOfAlloca(<a class="code" href="classllvm_1_1MemIntrinsic.html">MemIntrinsic</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst,</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                                      <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI,</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                                      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;AllocaInst *&gt;</a> &amp;NewElts);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordtype">void</span> RewriteStoreUserOfWholeAlloca(<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI, <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI,</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                       <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;AllocaInst *&gt;</a> &amp;NewElts);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordtype">void</span> RewriteLoadUserOfWholeAlloca(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI, <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI,</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                                      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;AllocaInst *&gt;</a> &amp;NewElts);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordtype">bool</span> ShouldAttemptScalarRepl(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  };</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="comment">// SROA_DT - SROA that uses DominatorTree.</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keyword">struct </span>SROA_DT : <span class="keyword">public</span> SROA {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a>;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    SROA_DT(<span class="keywordtype">int</span> T = -1, <span class="keywordtype">int</span> ST = -1, <span class="keywordtype">int</span> AT = -1, <span class="keywordtype">int</span> SLT = -1) :</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        SROA(T, <a class="code" href="namespacetrue.html">true</a>, ID, ST, AT, SLT) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <a class="code" href="namespacellvm.html#a7d0c6287665ca74c18123703fc1ba056">initializeSROA_DTPass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">// getAnalysisUsage - This pass does not require any passes, but we know it</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// will not alter the CFG, so say so.</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const </span>{</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a>&gt;();</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#af11a6ebf7ab3c388234cb6d5378439a3">setPreservesCFG</a>();</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  };</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="comment">// SROA_SSAUp - SROA that uses SSAUpdater.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keyword">struct </span>SROA_SSAUp : <span class="keyword">public</span> SROA {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a>;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    SROA_SSAUp(<span class="keywordtype">int</span> T = -1, <span class="keywordtype">int</span> ST = -1, <span class="keywordtype">int</span> AT = -1, <span class="keywordtype">int</span> SLT = -1) :</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        SROA(T, <a class="code" href="namespacefalse.html">false</a>, ID, ST, AT, SLT) {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <a class="code" href="namespacellvm.html#a4fc3b9dced401b7561bb2c0780c2d918">initializeSROA_SSAUpPass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// getAnalysisUsage - This pass does not require any passes, but we know it</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">// will not alter the CFG, so say so.</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const </span>{</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#af11a6ebf7ab3c388234cb6d5378439a3">setPreservesCFG</a>();</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  };</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;}</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">SROA_DT::ID</a> = 0;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">SROA_SSAUp::ID</a> = 0;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<a class="code" href="ScalarReplAggregates_8cpp.html#a756c240784833c6e582f1ffbef25667e">INITIALIZE_PASS_BEGIN</a>(SROA_DT, <span class="stringliteral">&quot;scalarrepl&quot;</span>,</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                <span class="stringliteral">&quot;Scalar Replacement of Aggregates (DT)&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<a class="code" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a>)</div><div class="line"><a name="l00228"></a><span class="lineno"><a class="line" href="ScalarReplAggregates_8cpp.html#a6d63a04af963aaff0422a4a1ef425100">  228</a></span>&#160;<a class="code" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(SROA_DT, &quot;<a class="code" href="ScalarReplAggregates_8cpp.html#a6d63a04af963aaff0422a4a1ef425100">scalarrepl</a>&quot;,</div><div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="ScalarReplAggregates_8cpp.html#a3898a228575af19a9b2052f2b3677dce">  229</a></span>&#160;                &quot;<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a> Replacement <a class="code" href="Target_2README_8txt.html#ace6b37d5eaf50e6fd3465513bc022e93">of</a> <a class="code" href="ScalarReplAggregates_8cpp.html#affb347572bf7943b60e44d940841e3b2">Aggregates</a> (DT)&quot;, <a class="code" href="namespacefalse.html">false</a>, false)</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<a class="code" href="ScalarReplAggregates_8cpp.html#a756c240784833c6e582f1ffbef25667e">INITIALIZE_PASS_BEGIN</a>(SROA_SSAUp, &quot;scalarrepl-<a class="code" href="ScalarReplAggregates_8cpp.html#a3d60b300c3988b10f2e6d963d3707f58">ssa</a>&quot;,</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                      &quot;<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a> Replacement <a class="code" href="Target_2README_8txt.html#ace6b37d5eaf50e6fd3465513bc022e93">of</a> <a class="code" href="ScalarReplAggregates_8cpp.html#affb347572bf7943b60e44d940841e3b2">Aggregates</a> (SSAUp)&quot;, false, false)</div><div class="line"><a name="l00233"></a><span class="lineno"><a class="line" href="ScalarReplAggregates_8cpp.html#a3d60b300c3988b10f2e6d963d3707f58">  233</a></span>&#160;<a class="code" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(SROA_SSAUp, &quot;scalarrepl-ssa&quot;,</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                    &quot;<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">Scalar</a> Replacement <a class="code" href="Target_2README_8txt.html#ace6b37d5eaf50e6fd3465513bc022e93">of</a> <a class="code" href="ScalarReplAggregates_8cpp.html#affb347572bf7943b60e44d940841e3b2">Aggregates</a> (SSAUp)&quot;, false, false)</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">// Public interface to the ScalarReplAggregates pass</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> *<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="namespacellvm.html#a92c9f6b95aaca2b3090b0b046e5eb194">createScalarReplAggregatesPass</a>(<span class="keywordtype">int</span> <a class="code" href="CaptureTracking_8cpp.html#ac30708db2a991631cbf3d95c6324d929">Threshold</a>,</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                                                   <span class="keywordtype">bool</span> UseDomTree,</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                                   <span class="keywordtype">int</span> StructMemberThreshold,</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                                                   <span class="keywordtype">int</span> ArrayElementThreshold,</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                                                   <span class="keywordtype">int</span> ScalarLoadThreshold) {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keywordflow">if</span> (UseDomTree)</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> SROA_DT(Threshold, StructMemberThreshold, ArrayElementThreshold,</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                       ScalarLoadThreshold);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> SROA_SSAUp(Threshold, StructMemberThreshold,</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                        ArrayElementThreshold, ScalarLoadThreshold);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;}</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">// Convert To Scalar Optimization.</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">/// ConvertToScalarInfo - This class implements the &quot;Convert To Scalar&quot;</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">/// optimization, which scans the uses of an alloca and determines if it can</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">/// rewrite it in terms of a single new alloca that can be mem2reg&#39;d.</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment"></span><span class="keyword">class </span>ConvertToScalarInfo {<span class="comment"></span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">  /// AllocaSize - The size of the alloca being considered in bytes.</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment"></span>  <span class="keywordtype">unsigned</span> AllocaSize;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;TD;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordtype">unsigned</span> ScalarLoadThreshold;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">  /// IsNotTrivial - This is set to true if there is some access to the object</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">  /// which means that mem2reg can&#39;t promote it.</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> IsNotTrivial;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">  /// ScalarKind - Tracks the kind of alloca being considered for promotion,</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">  /// computed based on the uses of the alloca rather than the LLVM type system.</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment"></span>  <span class="keyword">enum</span> {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eabd20bd987f5233a02a053b0c90f35aa6">Unknown</a>,</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="comment">// Accesses via GEPs that are consistent with element access of a vector</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="comment">// type. This will not be converted into a vector unless there is a later</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">// access using an actual vector type.</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    ImplicitVector,</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="comment">// Accesses via vector operations and GEPs that are consistent with the</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// layout of a vector type.</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    Vector,</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">// An integer bag-of-bits with bitwise operations for insertion and</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// extraction. Any combination of types can be converted into this kind</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// of scalar.</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    Integer</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  } ScalarKind;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">  /// VectorTy - This tracks the type that we should promote the vector to if</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">  /// it is possible to turn it into a vector.  This starts out null, and if it</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">  /// isn&#39;t possible to turn into a vector type, it gets set to VoidTy.</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *VectorTy;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">  /// HadNonMemTransferAccess - True if there is at least one access to the</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">  /// alloca that is not a MemTransferInst.  We don&#39;t want to turn structs into</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">  /// large integers unless there is some potential for optimization.</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> HadNonMemTransferAccess;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">  /// HadDynamicAccess - True if some element of this alloca was dynamic.</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">  /// We don&#39;t yet have support for turning a dynamic access into a large</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">  /// integer.</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> HadDynamicAccess;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="keyword">explicit</span> ConvertToScalarInfo(<span class="keywordtype">unsigned</span> Size, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;<a class="code" href="Target_2X86_2README_8txt.html#a1b0f9b510ec52cc3cbaa14e6e6211168">td</a>,</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                               <span class="keywordtype">unsigned</span> SLT)</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    : AllocaSize(Size), TD(td), ScalarLoadThreshold(SLT), IsNotTrivial(<span class="keyword">false</span>),</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    ScalarKind(<a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eabd20bd987f5233a02a053b0c90f35aa6">Unknown</a>), VectorTy(0), HadNonMemTransferAccess(<span class="keyword">false</span>),</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    HadDynamicAccess(<span class="keyword">false</span>) { }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *TryConvert(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordtype">bool</span> CanConvertToScalar(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, uint64_t Offset, <a class="code" href="classllvm_1_1Value.html">Value</a>* NonConstantIdx);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordtype">void</span> MergeInTypeForLoadOrStore(<a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>, uint64_t Offset);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keywordtype">bool</span> MergeInVectorType(<a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *VInTy, uint64_t Offset);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordtype">void</span> ConvertUsesToScalar(<a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr, <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *NewAI, uint64_t Offset,</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                           <a class="code" href="classllvm_1_1Value.html">Value</a> *NonConstantIdx);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ConvertScalar_ExtractValue(<a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8">NV</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *ToType,</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                                    uint64_t Offset, <a class="code" href="classllvm_1_1Value.html">Value</a>* NonConstantIdx,</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                                    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ConvertScalar_InsertValue(<a class="code" href="classllvm_1_1Value.html">Value</a> *StoredVal, <a class="code" href="classllvm_1_1Value.html">Value</a> *ExistingVal,</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                                   uint64_t Offset, <a class="code" href="classllvm_1_1Value.html">Value</a>* NonConstantIdx,</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                                   <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;};</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;} <span class="comment">// end anonymous namespace.</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">/// TryConvert - Analyze the specified alloca, and if it is safe to do so,</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">/// rewrite it to be a new alloca which is mem2reg&#39;able.  This returns the new</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">/// alloca if possible or null if not.</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *ConvertToScalarInfo::TryConvert(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI) {</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="comment">// If we can&#39;t convert this scalar, or if mem2reg can trivially do it, bail</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="comment">// out.</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordflow">if</span> (!CanConvertToScalar(AI, 0, 0) || !IsNotTrivial)</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="comment">// If an alloca has only memset / memcpy uses, it may still have an Unknown</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="comment">// ScalarKind. Treat it as an Integer below.</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keywordflow">if</span> (ScalarKind == <a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eabd20bd987f5233a02a053b0c90f35aa6">Unknown</a>)</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    ScalarKind = Integer;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keywordflow">if</span> (ScalarKind == Vector &amp;&amp; VectorTy-&gt;getBitWidth() != AllocaSize * 8)</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    ScalarKind = Integer;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="comment">// If we were able to find a vector type that can handle this with</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="comment">// insert/extract elements, and if there was at least one use that had</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="comment">// a vector type, promote this to a vector.  We don&#39;t want to promote</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="comment">// random stuff that doesn&#39;t use vectors (e.g. &lt;9 x double&gt;) because then</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="comment">// we just get a lot of insert/extracts.  If at least one vector is</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="comment">// involved, then we probably really do have a union of vector/array.</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *NewTy;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordflow">if</span> (ScalarKind == Vector) {</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    assert(VectorTy &amp;&amp; <span class="stringliteral">&quot;Missing type for vector scalar.&quot;</span>);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;CONVERT TO VECTOR: &quot;</span> &lt;&lt; *AI &lt;&lt; <span class="stringliteral">&quot;\n  TYPE = &quot;</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;          &lt;&lt; *VectorTy &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    NewTy = VectorTy;  <span class="comment">// Use the vector type.</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordtype">unsigned</span> BitWidth = AllocaSize * 8;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">// Do not convert to scalar integer if the alloca size exceeds the</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="comment">// scalar load threshold.</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">if</span> (BitWidth &gt; ScalarLoadThreshold)</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span> ((ScalarKind == ImplicitVector || ScalarKind == Integer) &amp;&amp;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        !HadNonMemTransferAccess &amp;&amp; !TD.<a class="code" href="classllvm_1_1DataLayout.html#a87901387c729722d5d63edd1d35119d7">fitsInLegalInteger</a>(BitWidth))</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="comment">// Dynamic accesses on integers aren&#39;t yet supported.  They need us to shift</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">// by a dynamic amount which could be difficult to work out as we might not</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">// know whether to use a left or right shift.</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">if</span> (ScalarKind == Integer &amp;&amp; HadDynamicAccess)</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;CONVERT TO SCALAR INTEGER: &quot;</span> &lt;&lt; *AI &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="comment">// Create and insert the integer alloca.</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    NewTy = <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(AI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), BitWidth);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *NewAI = <span class="keyword">new</span> <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a>(NewTy, 0, <span class="stringliteral">&quot;&quot;</span>, AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  ConvertUsesToScalar(AI, NewAI, 0, 0);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keywordflow">return</span> NewAI;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;}</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">/// MergeInTypeForLoadOrStore - Add the &#39;In&#39; type to the accumulated vector type</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">/// (VectorTy) so far at the offset specified by Offset (which is specified in</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">/// bytes).</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">/// There are two cases we handle here:</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">///   1) A union of vector types of the same size and potentially its elements.</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">///      Here we turn element accesses into insert/extract element operations.</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">///      This promotes a &lt;4 x float&gt; with a store of float to the third element</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">///      into a &lt;4 x float&gt; that uses insert element.</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">///   2) A fully general blob of memory, which we turn into some (potentially</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">///      large) integer type with extract and insert operations where the loads</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">///      and stores would mutate the memory.  We mark this by setting VectorTy</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">///      to VoidTy.</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ConvertToScalarInfo::MergeInTypeForLoadOrStore(<a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>,</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                                                    uint64_t Offset) {</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="comment">// If we already decided to turn this into a blob of integer memory, there is</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="comment">// nothing to be done.</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keywordflow">if</span> (ScalarKind == Integer)</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="comment">// If this could be contributing to a vector, analyze it.</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="comment">// If the In type is a vector that is the same size as the alloca, see if it</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="comment">// matches the existing VecTy.</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *VInTy = dyn_cast&lt;VectorType&gt;(In)) {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">if</span> (MergeInVectorType(VInTy, Offset))</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (In-&gt;<a class="code" href="classllvm_1_1Type.html#aeb06cf0f813f643b62d8dd98db0bc249">isFloatTy</a>() || In-&gt;<a class="code" href="classllvm_1_1Type.html#ac67ad08d36c989a872a887caa72803c6">isDoubleTy</a>() ||</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;             (In-&gt;<a class="code" href="classllvm_1_1Type.html#a6e328feb83afa5cf1c966d6704e43fc1">isIntegerTy</a>() &amp;&amp; In-&gt;<a class="code" href="classllvm_1_1Type.html#a5a7cfa245af120b44ac8a86143bb9e57">getPrimitiveSizeInBits</a>() &gt;= 8 &amp;&amp;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;              <a class="code" href="namespacellvm.html#af4d1a918800291e75b01ce1447be0e83">isPowerOf2_32</a>(In-&gt;<a class="code" href="classllvm_1_1Type.html#a5a7cfa245af120b44ac8a86143bb9e57">getPrimitiveSizeInBits</a>()))) {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="comment">// Full width accesses can be ignored, because they can always be turned</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="comment">// into bitcasts.</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordtype">unsigned</span> EltSize = In-&gt;<a class="code" href="classllvm_1_1Type.html#a5a7cfa245af120b44ac8a86143bb9e57">getPrimitiveSizeInBits</a>()/8;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">if</span> (EltSize == AllocaSize)</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="comment">// If we&#39;re accessing something that could be an element of a vector, see</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="comment">// if the implied vector agrees with what we already have and if Offset is</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">// compatible with it.</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">if</span> (Offset % EltSize == 0 &amp;&amp; AllocaSize % EltSize == 0 &amp;&amp;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        (!VectorTy || EltSize == VectorTy-&gt;getElementType()</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                                         -&gt;getPrimitiveSizeInBits()/8)) {</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="keywordflow">if</span> (!VectorTy) {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        ScalarKind = ImplicitVector;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        VectorTy = <a class="code" href="classllvm_1_1VectorType.html#ab43657ed1abe2e2ed3a6a394f233ebd0">VectorType::get</a>(In, AllocaSize/EltSize);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      }</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  }</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <span class="comment">// Otherwise, we have a case that we can&#39;t handle with an optimized vector</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="comment">// form.  We can still turn this into a large integer.</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  ScalarKind = Integer;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;}</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">/// MergeInVectorType - Handles the vector case of MergeInTypeForLoadOrStore,</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">/// returning true if the type was successfully merged and false otherwise.</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ConvertToScalarInfo::MergeInVectorType(<a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *VInTy,</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                                            uint64_t Offset) {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordflow">if</span> (VInTy-&gt;<a class="code" href="classllvm_1_1VectorType.html#a5e5bbb41f2a8c82330f868fdf1026b9b">getBitWidth</a>()/8 == AllocaSize &amp;&amp; Offset == 0) {</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="comment">// If we&#39;re storing/loading a vector of the right size, allow it as a</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="comment">// vector.  If this the first vector we see, remember the type so that</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="comment">// we know the element size. If this is a subsequent access, ignore it</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="comment">// even if it is a differing type but the same size. Worst case we can</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">// bitcast the resultant vectors.</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">if</span> (!VectorTy)</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      VectorTy = VInTy;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    ScalarKind = Vector;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  }</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;}</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">/// CanConvertToScalar - V is a pointer.  If we can convert the pointee and all</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">/// its accesses to a single vector type, return true and set VecTy to</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">/// the new type.  If we could convert the alloca into a single promotable</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">/// integer, return true but set VecTy to VoidTy.  Further, if the use is not a</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">/// completely trivial use that mem2reg could promote, set IsNotTrivial.  Offset</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">/// is the current offset from the base of the alloca being analyzed.</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">/// If we see at least one access to the value that is as a vector type, set the</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">/// SawVec flag.</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> ConvertToScalarInfo::CanConvertToScalar(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, uint64_t Offset,</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                                             <a class="code" href="classllvm_1_1Value.html">Value</a>* NonConstantIdx) {</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = V-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = V-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI!=E; ++UI) {</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(*UI);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(User)) {</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <span class="comment">// Don&#39;t break volatile loads.</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <span class="keywordflow">if</span> (!LI-&gt;isSimple())</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="comment">// Don&#39;t touch MMX operations.</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="keywordflow">if</span> (LI-&gt;getType()-&gt;isX86_MMXTy())</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      HadNonMemTransferAccess = <span class="keyword">true</span>;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      MergeInTypeForLoadOrStore(LI-&gt;getType(), Offset);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    }</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(User)) {</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      <span class="comment">// Storing the pointer, not into the value?</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <span class="keywordflow">if</span> (SI-&gt;getOperand(0) == V || !SI-&gt;isSimple()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <span class="comment">// Don&#39;t touch MMX operations.</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="keywordflow">if</span> (SI-&gt;getOperand(0)-&gt;getType()-&gt;isX86_MMXTy())</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      HadNonMemTransferAccess = <span class="keyword">true</span>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      MergeInTypeForLoadOrStore(SI-&gt;getOperand(0)-&gt;getType(), Offset);</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    }</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BCI = dyn_cast&lt;BitCastInst&gt;(User)) {</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a9d0a7040918ba81ef34046fd474cee10">onlyUsedByLifetimeMarkers</a>(BCI))</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        IsNotTrivial = <span class="keyword">true</span>;  <span class="comment">// Can&#39;t be mem2reg&#39;d.</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="keywordflow">if</span> (!CanConvertToScalar(BCI, Offset, NonConstantIdx))</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    }</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEP = dyn_cast&lt;GetElementPtrInst&gt;(User)) {</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <span class="comment">// If this is a GEP with a variable indices, we can&#39;t handle it.</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      <a class="code" href="classllvm_1_1PointerType.html">PointerType</a>* PtrTy = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PointerType.html">PointerType</a>&gt;(GEP-&gt;getPointerOperandType());</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="keywordflow">if</span> (!PtrTy)</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <span class="comment">// Compute the offset that this GEP adds to the pointer.</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 8&gt;</a> Indices(GEP-&gt;op_begin()+1, GEP-&gt;op_end());</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *GEPNonConstantIdx = 0;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <span class="keywordflow">if</span> (!GEP-&gt;hasAllConstantIndices()) {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keywordflow">if</span> (!isa&lt;VectorType&gt;(PtrTy-&gt;<a class="code" href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">getElementType</a>()))</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="keywordflow">if</span> (NonConstantIdx)</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        GEPNonConstantIdx = Indices.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">if</span> (!GEPNonConstantIdx-&gt;getType()-&gt;isIntegerTy(32))</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        HadDynamicAccess = <span class="keyword">true</span>;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      } <span class="keywordflow">else</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        GEPNonConstantIdx = NonConstantIdx;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      uint64_t GEPOffset = TD.<a class="code" href="classllvm_1_1DataLayout.html#af81977584678ef1ff229fcf2f1b69b2b">getIndexedOffset</a>(PtrTy,</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                                               Indices);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <span class="comment">// See if all uses can be converted.</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <span class="keywordflow">if</span> (!CanConvertToScalar(GEP, Offset+GEPOffset, GEPNonConstantIdx))</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      IsNotTrivial = <span class="keyword">true</span>;  <span class="comment">// Can&#39;t be mem2reg&#39;d.</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      HadNonMemTransferAccess = <span class="keyword">true</span>;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    }</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="comment">// If this is a constant sized memset of a constant value (e.g. 0) we can</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="comment">// handle it.</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MemSetInst.html">MemSetInst</a> *MSI = dyn_cast&lt;MemSetInst&gt;(User)) {</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="comment">// Store to dynamic index.</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keywordflow">if</span> (NonConstantIdx)</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="comment">// Store of constant value.</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;ConstantInt&gt;(MSI-&gt;getValue()))</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="comment">// Store of constant size.</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Len = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(MSI-&gt;getLength());</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <span class="keywordflow">if</span> (!Len)</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <span class="comment">// If the size differs from the alloca, we can only convert the alloca to</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <span class="comment">// an integer bag-of-bits.</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="comment">// FIXME: This should handle all of the cases that are currently accepted</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      <span class="comment">// as vector element insertions.</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <span class="keywordflow">if</span> (Len-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>() != AllocaSize || Offset != 0)</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        ScalarKind = Integer;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      IsNotTrivial = <span class="keyword">true</span>;  <span class="comment">// Can&#39;t be mem2reg&#39;d.</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      HadNonMemTransferAccess = <span class="keyword">true</span>;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    }</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">// If this is a memcpy or memmove into or out of the whole allocation, we</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="comment">// can handle it like a load or store of the scalar type.</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MemTransferInst.html">MemTransferInst</a> *MTI = dyn_cast&lt;MemTransferInst&gt;(User)) {</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="comment">// Store to dynamic index.</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="keywordflow">if</span> (NonConstantIdx)</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Len = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(MTI-&gt;getLength());</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="keywordflow">if</span> (Len == 0 || Len-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>() != AllocaSize || Offset != 0)</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      IsNotTrivial = <span class="keyword">true</span>;  <span class="comment">// Can&#39;t be mem2reg&#39;d.</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    }</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="comment">// If this is a lifetime intrinsic, we can handle it.</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II = dyn_cast&lt;IntrinsicInst&gt;(User)) {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="keywordflow">if</span> (II-&gt;getIntrinsicID() == <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ae365354e47542c51f9bd46e329e3323e">Intrinsic::lifetime_start</a> ||</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;          II-&gt;getIntrinsicID() == <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90aa332b90dd5e4ebf4bbbcc0964220d373">Intrinsic::lifetime_end</a>) {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      }</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="comment">// Otherwise, we cannot handle this!</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  }</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;}</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">/// ConvertUsesToScalar - Convert all of the users of Ptr to use the new alloca</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">/// directly.  This happens when we are converting an &quot;integer union&quot; to a</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">/// single integer scalar, or when we are converting a &quot;vector union&quot; to a</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">/// vector with insert/extractelement instructions.</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">/// Offset is an offset from the original alloca, in bits that need to be</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">/// shifted to the right.  By the end of this, there should be no uses of Ptr.</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> ConvertToScalarInfo::ConvertUsesToScalar(<a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr, <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *NewAI,</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                                              uint64_t Offset,</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                                              <a class="code" href="classllvm_1_1Value.html">Value</a>* NonConstantIdx) {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keywordflow">while</span> (!Ptr-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(Ptr-&gt;<a class="code" href="classllvm_1_1Value.html#ad9a329f9f85bc896a726a628aa3f4e9d">use_back</a>());</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *CI = dyn_cast&lt;BitCastInst&gt;(User)) {</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      ConvertUsesToScalar(CI, NewAI, Offset, NonConstantIdx);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      CI-&gt;eraseFromParent();</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    }</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEP = dyn_cast&lt;GetElementPtrInst&gt;(User)) {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="comment">// Compute the offset that this GEP adds to the pointer.</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 8&gt;</a> Indices(GEP-&gt;op_begin()+1, GEP-&gt;op_end());</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a>* GEPNonConstantIdx = 0;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="keywordflow">if</span> (!GEP-&gt;hasAllConstantIndices()) {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        assert(!NonConstantIdx &amp;&amp;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;               <span class="stringliteral">&quot;Dynamic GEP reading from dynamic GEP unsupported&quot;</span>);</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        GEPNonConstantIdx = Indices.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      } <span class="keywordflow">else</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        GEPNonConstantIdx = NonConstantIdx;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      uint64_t GEPOffset = TD.<a class="code" href="classllvm_1_1DataLayout.html#af81977584678ef1ff229fcf2f1b69b2b">getIndexedOffset</a>(GEP-&gt;getPointerOperandType(),</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                                               Indices);</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      ConvertUsesToScalar(GEP, NewAI, Offset+GEPOffset*8, GEPNonConstantIdx);</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      GEP-&gt;eraseFromParent();</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    }</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(User);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(User)) {</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      <span class="comment">// The load is a bit extract from NewAI shifted right by Offset bits.</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *LoadedVal = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#af440b535b3b4e8d0d089dd0ed2283a0f">CreateLoad</a>(NewAI);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *NewLoadVal</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        = ConvertScalar_ExtractValue(LoadedVal, LI-&gt;getType(), Offset,</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                                     NonConstantIdx, Builder);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      LI-&gt;replaceAllUsesWith(NewLoadVal);</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      LI-&gt;eraseFromParent();</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    }</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(User)) {</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      assert(SI-&gt;getOperand(0) != Ptr &amp;&amp; <span class="stringliteral">&quot;Consistency error!&quot;</span>);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Old = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#af440b535b3b4e8d0d089dd0ed2283a0f">CreateLoad</a>(NewAI, NewAI-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.in&quot;</span>);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *New = ConvertScalar_InsertValue(SI-&gt;getOperand(0), Old, Offset,</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                                             NonConstantIdx, Builder);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a43f7fa52a3fbe01e44c40d9db278ab3e">CreateStore</a>(New, NewAI);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="comment">// If the load we just inserted is now dead, then the inserted store</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="comment">// overwrote the entire thing.</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="keywordflow">if</span> (Old-&gt;use_empty())</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        Old-&gt;eraseFromParent();</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    }</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="comment">// If this is a constant sized memset of a constant value (e.g. 0) we can</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="comment">// transform it into a store of the expanded constant value.</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MemSetInst.html">MemSetInst</a> *MSI = dyn_cast&lt;MemSetInst&gt;(User)) {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      assert(MSI-&gt;getRawDest() == Ptr &amp;&amp; <span class="stringliteral">&quot;Consistency error!&quot;</span>);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      assert(!NonConstantIdx &amp;&amp; <span class="stringliteral">&quot;Cannot replace dynamic memset with insert&quot;</span>);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      int64_t SNumBytes = cast&lt;ConstantInt&gt;(MSI-&gt;getLength())-&gt;getSExtValue();</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keywordflow">if</span> (SNumBytes &gt; 0 &amp;&amp; (SNumBytes &gt;&gt; 32) == 0) {</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="keywordtype">unsigned</span> NumBytes = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(SNumBytes);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="keywordtype">unsigned</span> Val = cast&lt;ConstantInt&gt;(MSI-&gt;getValue())-&gt;getZExtValue();</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="comment">// Compute the value replicated the right number of times.</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <a class="code" href="classllvm_1_1APInt.html">APInt</a> APVal(NumBytes*8, Val);</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="comment">// Splat the value if non-zero.</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">if</span> (Val)</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != NumBytes; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            APVal |= APVal &lt;&lt; 8;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Old = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#af440b535b3b4e8d0d089dd0ed2283a0f">CreateLoad</a>(NewAI, NewAI-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.in&quot;</span>);</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *New = ConvertScalar_InsertValue(</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                                    <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(User-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), APVal),</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                                               Old, Offset, 0, Builder);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a43f7fa52a3fbe01e44c40d9db278ab3e">CreateStore</a>(New, NewAI);</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <span class="comment">// If the load we just inserted is now dead, then the memset overwrote</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="comment">// the entire thing.</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">if</span> (Old-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>())</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;          Old-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      }</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      MSI-&gt;eraseFromParent();</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    }</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="comment">// If this is a memcpy or memmove into or out of the whole allocation, we</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="comment">// can handle it like a load or store of the scalar type.</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MemTransferInst.html">MemTransferInst</a> *MTI = dyn_cast&lt;MemTransferInst&gt;(User)) {</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      assert(Offset == 0 &amp;&amp; <span class="stringliteral">&quot;must be store to start of alloca&quot;</span>);</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      assert(!NonConstantIdx &amp;&amp; <span class="stringliteral">&quot;Cannot replace dynamic transfer with insert&quot;</span>);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="comment">// If the source and destination are both to the same alloca, then this is</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="comment">// a noop copy-to-self, just delete it.  Otherwise, emit a load and store</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      <span class="comment">// as appropriate.</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *OrigAI = cast&lt;AllocaInst&gt;(<a class="code" href="namespacellvm.html#ace6c957db39858291c6ce01c38e78480">GetUnderlyingObject</a>(Ptr, &amp;TD, 0));</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ace6c957db39858291c6ce01c38e78480">GetUnderlyingObject</a>(MTI-&gt;getSource(), &amp;TD, 0) != OrigAI) {</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="comment">// Dest must be OrigAI, change this to be a load from the original</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="comment">// pointer (bitcasted), then a store to our new alloca.</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        assert(MTI-&gt;getRawDest() == Ptr &amp;&amp; <span class="stringliteral">&quot;Neither use is of pointer?&quot;</span>);</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *SrcPtr = MTI-&gt;getSource();</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <a class="code" href="classllvm_1_1PointerType.html">PointerType</a>* SPTy = cast&lt;PointerType&gt;(SrcPtr-&gt;getType());</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <a class="code" href="classllvm_1_1PointerType.html">PointerType</a>* AIPTy = cast&lt;PointerType&gt;(NewAI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a597c918a615f26a0cea7adb84f06fc3f">getType</a>());</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <span class="keywordflow">if</span> (SPTy-&gt;<a class="code" href="classllvm_1_1PointerType.html#a921061a57ec3cfbaf6422f09f7d79fc3">getAddressSpace</a>() != AIPTy-&gt;getAddressSpace()) {</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;          AIPTy = <a class="code" href="classllvm_1_1PointerType.html#a050a395d1656e546679d8b144d951bb2">PointerType::get</a>(AIPTy-&gt;getElementType(),</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                                   SPTy-&gt;<a class="code" href="classllvm_1_1PointerType.html#a921061a57ec3cfbaf6422f09f7d79fc3">getAddressSpace</a>());</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        SrcPtr = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a87b363b9dad9f5040ea7e29ea9e60ff5">CreateBitCast</a>(SrcPtr, AIPTy);</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *SrcVal = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#af440b535b3b4e8d0d089dd0ed2283a0f">CreateLoad</a>(SrcPtr, <span class="stringliteral">&quot;srcval&quot;</span>);</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        SrcVal-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a218ef27c964707a907f12db0f9b002ba">setAlignment</a>(MTI-&gt;getAlignment());</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a43f7fa52a3fbe01e44c40d9db278ab3e">CreateStore</a>(SrcVal, NewAI);</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#ace6c957db39858291c6ce01c38e78480">GetUnderlyingObject</a>(MTI-&gt;getDest(), &amp;TD, 0) != OrigAI) {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <span class="comment">// Src must be OrigAI, change this to be a load from NewAI then a store</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <span class="comment">// through the original dest pointer (bitcasted).</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        assert(MTI-&gt;getRawSource() == Ptr &amp;&amp; <span class="stringliteral">&quot;Neither use is of pointer?&quot;</span>);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *SrcVal = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#af440b535b3b4e8d0d089dd0ed2283a0f">CreateLoad</a>(NewAI, <span class="stringliteral">&quot;srcval&quot;</span>);</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <a class="code" href="classllvm_1_1PointerType.html">PointerType</a>* DPTy = cast&lt;PointerType&gt;(MTI-&gt;getDest()-&gt;getType());</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <a class="code" href="classllvm_1_1PointerType.html">PointerType</a>* AIPTy = cast&lt;PointerType&gt;(NewAI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a597c918a615f26a0cea7adb84f06fc3f">getType</a>());</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keywordflow">if</span> (DPTy-&gt;<a class="code" href="classllvm_1_1PointerType.html#a921061a57ec3cfbaf6422f09f7d79fc3">getAddressSpace</a>() != AIPTy-&gt;getAddressSpace()) {</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;          AIPTy = <a class="code" href="classllvm_1_1PointerType.html#a050a395d1656e546679d8b144d951bb2">PointerType::get</a>(AIPTy-&gt;getElementType(),</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                                   DPTy-&gt;<a class="code" href="classllvm_1_1PointerType.html#a921061a57ec3cfbaf6422f09f7d79fc3">getAddressSpace</a>());</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        }</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *DstPtr = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a87b363b9dad9f5040ea7e29ea9e60ff5">CreateBitCast</a>(MTI-&gt;getDest(), AIPTy);</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *NewStore = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a43f7fa52a3fbe01e44c40d9db278ab3e">CreateStore</a>(SrcVal, DstPtr);</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        NewStore-&gt;<a class="code" href="classllvm_1_1StoreInst.html#a50d3891cd26db1308e81540f468de8c8">setAlignment</a>(MTI-&gt;getAlignment());</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <span class="comment">// Noop transfer. Src == Dst</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      }</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      MTI-&gt;eraseFromParent();</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    }</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II = dyn_cast&lt;IntrinsicInst&gt;(User)) {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="keywordflow">if</span> (II-&gt;getIntrinsicID() == <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ae365354e47542c51f9bd46e329e3323e">Intrinsic::lifetime_start</a> ||</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;          II-&gt;getIntrinsicID() == <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90aa332b90dd5e4ebf4bbbcc0964220d373">Intrinsic::lifetime_end</a>) {</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="comment">// There&#39;s no need to preserve these, as the resulting alloca will be</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <span class="comment">// converted to a register anyways.</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        II-&gt;eraseFromParent();</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      }</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    }</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unsupported operation!&quot;</span>);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  }</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;}</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">/// ConvertScalar_ExtractValue - Extract a value of type ToType from an integer</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="comment">/// or vector value FromVal, extracting the bits from the offset specified by</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="comment">/// Offset.  This returns the value, which is of type ToType.</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">/// This happens when we are converting an &quot;integer union&quot; to a single</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment">/// integer scalar, or when we are converting a &quot;vector union&quot; to a vector with</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">/// insert/extractelement instructions.</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment">/// Offset is an offset from the original alloca, in bits that need to be</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment">/// shifted to the right.</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1Value.html">Value</a> *ConvertToScalarInfo::</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;ConvertScalar_ExtractValue(<a class="code" href="classllvm_1_1Value.html">Value</a> *FromVal, <a class="code" href="classllvm_1_1Type.html">Type</a> *ToType,</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                           uint64_t Offset, <a class="code" href="classllvm_1_1Value.html">Value</a>* NonConstantIdx,</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                           <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder) {</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="comment">// If the load is of the whole new alloca, no conversion is needed.</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a0c4e2aa2235abdd10d2beffa32cd9b14">FromType</a> = FromVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>();</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="keywordflow">if</span> (FromType == ToType &amp;&amp; Offset == 0)</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordflow">return</span> FromVal;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="comment">// If the result alloca is a vector type, this is either an element</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="comment">// access or a bitcast to another vector type of the same size.</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *VTy = dyn_cast&lt;VectorType&gt;(FromType)) {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordtype">unsigned</span> FromTypeSize = TD.<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(FromType);</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordtype">unsigned</span> ToTypeSize = TD.<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(ToType);</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordflow">if</span> (FromTypeSize == ToTypeSize)</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="keywordflow">return</span> Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a87b363b9dad9f5040ea7e29ea9e60ff5">CreateBitCast</a>(FromVal, ToType);</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="comment">// Otherwise it must be an element access.</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordtype">unsigned</span> Elt = 0;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordflow">if</span> (Offset) {</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="keywordtype">unsigned</span> EltSize = TD.<a class="code" href="classllvm_1_1DataLayout.html#ab9c1bc49a2be2d26ca426b2ec23d6cf5">getTypeAllocSizeInBits</a>(VTy-&gt;getElementType());</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      Elt = Offset/EltSize;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      assert(EltSize*Elt == Offset &amp;&amp; <span class="stringliteral">&quot;Invalid modulus in validity checking&quot;</span>);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    }</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="comment">// Return the element extracted out of it.</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Idx;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keywordflow">if</span> (NonConstantIdx) {</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <span class="keywordflow">if</span> (Elt)</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        Idx = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a112f87f5844b5d94c07940f3d47f1e99">CreateAdd</a>(NonConstantIdx,</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                                Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#ac0e8c554bf1c1e117a74d51df89c137d">getInt32</a>(Elt),</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                                <span class="stringliteral">&quot;dyn.offset&quot;</span>);</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        Idx = NonConstantIdx;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    } <span class="keywordflow">else</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      Idx = Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#ac0e8c554bf1c1e117a74d51df89c137d">getInt32</a>(Elt);</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#ad0affa936bea7c530da1597e9bb60bbd">CreateExtractElement</a>(FromVal, Idx);</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">if</span> (V-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() != ToType)</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      V = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a87b363b9dad9f5040ea7e29ea9e60ff5">CreateBitCast</a>(V, ToType);</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keywordflow">return</span> V;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  }</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="comment">// If ToType is a first class aggregate, extract out each of the pieces and</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="comment">// use insertvalue&#39;s to form the FCA.</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *ST = dyn_cast&lt;StructType&gt;(ToType)) {</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    assert(!NonConstantIdx &amp;&amp;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;           <span class="stringliteral">&quot;Dynamic indexing into struct types not supported&quot;</span>);</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1StructLayout.html">StructLayout</a> &amp;Layout = *TD.<a class="code" href="classllvm_1_1DataLayout.html#a35c840104f32575e0d91422cf1ef3ce4">getStructLayout</a>(ST);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Res = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(ST);</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = ST-&gt;getNumElements(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Elt = ConvertScalar_ExtractValue(FromVal, ST-&gt;getElementType(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>),</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                                        Offset+Layout.<a class="code" href="classllvm_1_1StructLayout.html#a05c049a3bc016b91dddf9ab5433855bb">getElementOffsetInBits</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>),</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                                              0, Builder);</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      Res = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a8bbeae6f9dd03923c7cf63a6ff9f4036">CreateInsertValue</a>(Res, Elt, <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    }</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="keywordflow">return</span> Res;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  }</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *AT = dyn_cast&lt;ArrayType&gt;(ToType)) {</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    assert(!NonConstantIdx &amp;&amp;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;           <span class="stringliteral">&quot;Dynamic indexing into array types not supported&quot;</span>);</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    uint64_t EltSize = TD.<a class="code" href="classllvm_1_1DataLayout.html#ab9c1bc49a2be2d26ca426b2ec23d6cf5">getTypeAllocSizeInBits</a>(AT-&gt;getElementType());</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Res = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(AT);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = AT-&gt;getNumElements(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Elt = ConvertScalar_ExtractValue(FromVal, AT-&gt;getElementType(),</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                                              Offset+<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>*EltSize, 0, Builder);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      Res = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a8bbeae6f9dd03923c7cf63a6ff9f4036">CreateInsertValue</a>(Res, Elt, <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    }</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">return</span> Res;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  }</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="comment">// Otherwise, this must be a union that was converted to an integer value.</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *NTy = cast&lt;IntegerType&gt;(FromVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="comment">// If this is a big-endian system and the load is narrower than the</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <span class="comment">// full alloca type, we need to do a shift to get the right bits.</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="keywordtype">int</span> ShAmt = 0;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keywordflow">if</span> (TD.<a class="code" href="classllvm_1_1DataLayout.html#a9b876cc57d1884621f481b26b0892633">isBigEndian</a>()) {</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="comment">// On big-endian machines, the lowest bit is stored at the bit offset</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="comment">// from the pointer given by getTypeStoreSizeInBits.  This matters for</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="comment">// integers with a bitwidth that is not a multiple of 8.</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    ShAmt = TD.<a class="code" href="classllvm_1_1DataLayout.html#a328b37dd0e404674678018ac2f2e38af">getTypeStoreSizeInBits</a>(NTy) -</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            TD.<a class="code" href="classllvm_1_1DataLayout.html#a328b37dd0e404674678018ac2f2e38af">getTypeStoreSizeInBits</a>(ToType) - Offset;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    ShAmt = Offset;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  }</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="comment">// Note: we support negative bitwidths (with shl) which are not defined.</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="comment">// We do this to support (f.e.) loads off the end of a structure where</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="comment">// only some bits are used.</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="keywordflow">if</span> (ShAmt &gt; 0 &amp;&amp; (<span class="keywordtype">unsigned</span>)ShAmt &lt; NTy-&gt;<a class="code" href="ValueTracking_8cpp.html#a06c14477546c3a0eb4c79ff007ea2375">getBitWidth</a>())</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    FromVal = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a3f8c45ea10c393433221a508b750dcd5">CreateLShr</a>(FromVal,</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                                 <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(FromVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), ShAmt));</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ShAmt &lt; 0 &amp;&amp; (<span class="keywordtype">unsigned</span>)-ShAmt &lt; NTy-&gt;<a class="code" href="classllvm_1_1IntegerType.html#a6f603ab84f6f7c79985036f58cca9d48">getBitWidth</a>())</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    FromVal = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a4d49fd9a4cc4f2a74d4555bd08b13910">CreateShl</a>(FromVal,</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                                <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(FromVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), -ShAmt));</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="comment">// Finally, unconditionally truncate the integer to the right width.</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="keywordtype">unsigned</span> LIBitWidth = TD.<a class="code" href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">getTypeSizeInBits</a>(ToType);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keywordflow">if</span> (LIBitWidth &lt; NTy-&gt;<a class="code" href="ValueTracking_8cpp.html#a06c14477546c3a0eb4c79ff007ea2375">getBitWidth</a>())</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    FromVal =</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      Builder.<a class="code" href="classllvm_1_1IRBuilder.html#aa933549689e79685bb67de64dddc9f7c">CreateTrunc</a>(FromVal, <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(FromVal-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(),</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                                                    LIBitWidth));</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (LIBitWidth &gt; NTy-&gt;<a class="code" href="classllvm_1_1IntegerType.html#a6f603ab84f6f7c79985036f58cca9d48">getBitWidth</a>())</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    FromVal =</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;       Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a277dfeaad2a2ada72a6024b0eedc5301">CreateZExt</a>(FromVal, <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(FromVal-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(),</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                                                    LIBitWidth));</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="comment">// If the result is an integer, this is a trunc or bitcast.</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="keywordflow">if</span> (ToType-&gt;<a class="code" href="classllvm_1_1Type.html#a6e328feb83afa5cf1c966d6704e43fc1">isIntegerTy</a>()) {</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="comment">// Should be done.</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ToType-&gt;<a class="code" href="classllvm_1_1Type.html#a40113570b0c52a18c34cabed8359e2c8">isFloatingPointTy</a>() || ToType-&gt;<a class="code" href="classllvm_1_1Type.html#a6f725580f7834e2ca90762965866dad4">isVectorTy</a>()) {</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="comment">// Just do a bitcast, we know the sizes match up.</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    FromVal = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a87b363b9dad9f5040ea7e29ea9e60ff5">CreateBitCast</a>(FromVal, ToType);</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="comment">// Otherwise must be a pointer.</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    FromVal = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a11d3f8bbc5a14f60879a87175db6695c">CreateIntToPtr</a>(FromVal, ToType);</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  }</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  assert(FromVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() == ToType &amp;&amp; <span class="stringliteral">&quot;Didn&#39;t convert right?&quot;</span>);</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="keywordflow">return</span> FromVal;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;}</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment">/// ConvertScalar_InsertValue - Insert the value &quot;SV&quot; into the existing integer</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment">/// or vector value &quot;Old&quot; at the offset specified by Offset.</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">/// This happens when we are converting an &quot;integer union&quot; to a</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment">/// single integer scalar, or when we are converting a &quot;vector union&quot; to a</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment">/// vector with insert/extractelement instructions.</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment">/// Offset is an offset from the original alloca, in bits that need to be</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment">/// shifted to the right.</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment">/// NonConstantIdx is an index value if there was a GEP with a non-constant</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">/// index value.  If this is 0 then all GEPs used to find this insert address</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">/// are constant.</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1Value.html">Value</a> *ConvertToScalarInfo::</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;ConvertScalar_InsertValue(<a class="code" href="classllvm_1_1Value.html">Value</a> *SV, <a class="code" href="classllvm_1_1Value.html">Value</a> *Old,</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                          uint64_t Offset, <a class="code" href="classllvm_1_1Value.html">Value</a>* NonConstantIdx,</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                          <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder) {</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="comment">// Convert the stored type to the actual type, shift it left to insert</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="comment">// then &#39;or&#39; into place.</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *AllocaType = Old-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>();</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Context = Old-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>();</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *VTy = dyn_cast&lt;VectorType&gt;(AllocaType)) {</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    uint64_t VecSize = TD.<a class="code" href="classllvm_1_1DataLayout.html#ab9c1bc49a2be2d26ca426b2ec23d6cf5">getTypeAllocSizeInBits</a>(VTy);</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    uint64_t ValSize = TD.<a class="code" href="classllvm_1_1DataLayout.html#ab9c1bc49a2be2d26ca426b2ec23d6cf5">getTypeAllocSizeInBits</a>(SV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="comment">// Changing the whole vector with memset or with an access of a different</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="comment">// vector type?</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">if</span> (ValSize == VecSize)</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <span class="keywordflow">return</span> Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a87b363b9dad9f5040ea7e29ea9e60ff5">CreateBitCast</a>(SV, AllocaType);</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="comment">// Must be an element insertion.</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *EltTy = VTy-&gt;getElementType();</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <span class="keywordflow">if</span> (SV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() != EltTy)</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      SV = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a87b363b9dad9f5040ea7e29ea9e60ff5">CreateBitCast</a>(SV, EltTy);</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    uint64_t EltSize = TD.<a class="code" href="classllvm_1_1DataLayout.html#ab9c1bc49a2be2d26ca426b2ec23d6cf5">getTypeAllocSizeInBits</a>(EltTy);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="keywordtype">unsigned</span> Elt = Offset/EltSize;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Idx;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="keywordflow">if</span> (NonConstantIdx) {</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      <span class="keywordflow">if</span> (Elt)</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        Idx = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a112f87f5844b5d94c07940f3d47f1e99">CreateAdd</a>(NonConstantIdx,</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                                Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#ac0e8c554bf1c1e117a74d51df89c137d">getInt32</a>(Elt),</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                                <span class="stringliteral">&quot;dyn.offset&quot;</span>);</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        Idx = NonConstantIdx;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    } <span class="keywordflow">else</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      Idx = Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#ac0e8c554bf1c1e117a74d51df89c137d">getInt32</a>(Elt);</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <span class="keywordflow">return</span> Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a40e48df9196b3c092096138cd9af8465">CreateInsertElement</a>(Old, SV, Idx);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="comment">// If SV is a first-class aggregate value, insert each value recursively.</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *ST = dyn_cast&lt;StructType&gt;(SV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())) {</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    assert(!NonConstantIdx &amp;&amp;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;           <span class="stringliteral">&quot;Dynamic indexing into struct types not supported&quot;</span>);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1StructLayout.html">StructLayout</a> &amp;Layout = *TD.<a class="code" href="classllvm_1_1DataLayout.html#a35c840104f32575e0d91422cf1ef3ce4">getStructLayout</a>(ST);</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = ST-&gt;getNumElements(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Elt = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a478d9db5034ad1bef340198c3aaf861a">CreateExtractValue</a>(SV, <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      Old = ConvertScalar_InsertValue(Elt, Old,</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                                      Offset+Layout.<a class="code" href="classllvm_1_1StructLayout.html#a05c049a3bc016b91dddf9ab5433855bb">getElementOffsetInBits</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>),</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                                      0, Builder);</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    }</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keywordflow">return</span> Old;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  }</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *AT = dyn_cast&lt;ArrayType&gt;(SV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())) {</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    assert(!NonConstantIdx &amp;&amp;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;           <span class="stringliteral">&quot;Dynamic indexing into array types not supported&quot;</span>);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    uint64_t EltSize = TD.<a class="code" href="classllvm_1_1DataLayout.html#ab9c1bc49a2be2d26ca426b2ec23d6cf5">getTypeAllocSizeInBits</a>(AT-&gt;getElementType());</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = AT-&gt;getNumElements(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Elt = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a478d9db5034ad1bef340198c3aaf861a">CreateExtractValue</a>(SV, <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      Old = ConvertScalar_InsertValue(Elt, Old, Offset+<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>*EltSize, 0, Builder);</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    }</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="keywordflow">return</span> Old;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  }</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="comment">// If SV is a float, convert it to the appropriate integer type.</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <span class="comment">// If it is a pointer, do the same.</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <span class="keywordtype">unsigned</span> SrcWidth = TD.<a class="code" href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">getTypeSizeInBits</a>(SV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  <span class="keywordtype">unsigned</span> DestWidth = TD.<a class="code" href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">getTypeSizeInBits</a>(AllocaType);</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="keywordtype">unsigned</span> SrcStoreWidth = TD.<a class="code" href="classllvm_1_1DataLayout.html#a328b37dd0e404674678018ac2f2e38af">getTypeStoreSizeInBits</a>(SV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="keywordtype">unsigned</span> DestStoreWidth = TD.<a class="code" href="classllvm_1_1DataLayout.html#a328b37dd0e404674678018ac2f2e38af">getTypeStoreSizeInBits</a>(AllocaType);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="keywordflow">if</span> (SV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a40113570b0c52a18c34cabed8359e2c8">isFloatingPointTy</a>() || SV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a6f725580f7834e2ca90762965866dad4">isVectorTy</a>())</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    SV = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a87b363b9dad9f5040ea7e29ea9e60ff5">CreateBitCast</a>(SV, <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(SV-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(),SrcWidth));</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>())</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    SV = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a9299aed1efa0ef459a0f1c7fa11fbe61">CreatePtrToInt</a>(SV, TD.<a class="code" href="classllvm_1_1DataLayout.html#ae84bb2408dfffa4e8b5fe2ce0714a3bd">getIntPtrType</a>(SV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()));</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="comment">// Zero extend or truncate the value if needed.</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="keywordflow">if</span> (SV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() != AllocaType) {</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keywordflow">if</span> (SV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a5a7cfa245af120b44ac8a86143bb9e57">getPrimitiveSizeInBits</a>() &lt;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;             AllocaType-&gt;<a class="code" href="classllvm_1_1Type.html#a5a7cfa245af120b44ac8a86143bb9e57">getPrimitiveSizeInBits</a>())</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      SV = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a277dfeaad2a2ada72a6024b0eedc5301">CreateZExt</a>(SV, AllocaType);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="comment">// Truncation may be needed if storing more than the alloca can hold</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="comment">// (undefined behavior).</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      SV = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#aa933549689e79685bb67de64dddc9f7c">CreateTrunc</a>(SV, AllocaType);</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      SrcWidth = DestWidth;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      SrcStoreWidth = DestStoreWidth;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    }</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="comment">// If this is a big-endian system and the store is narrower than the</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  <span class="comment">// full alloca type, we need to do a shift to get the right bits.</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="keywordtype">int</span> ShAmt = 0;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordflow">if</span> (TD.<a class="code" href="classllvm_1_1DataLayout.html#a9b876cc57d1884621f481b26b0892633">isBigEndian</a>()) {</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="comment">// On big-endian machines, the lowest bit is stored at the bit offset</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="comment">// from the pointer given by getTypeStoreSizeInBits.  This matters for</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="comment">// integers with a bitwidth that is not a multiple of 8.</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    ShAmt = DestStoreWidth - SrcStoreWidth - Offset;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    ShAmt = Offset;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  }</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="comment">// Note: we support negative bitwidths (with shr) which are not defined.</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="comment">// We do this to support (f.e.) stores off the end of a structure where</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="comment">// only some bits in the structure are set.</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> Mask(<a class="code" href="classllvm_1_1APInt.html#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(DestWidth, SrcWidth));</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <span class="keywordflow">if</span> (ShAmt &gt; 0 &amp;&amp; (<span class="keywordtype">unsigned</span>)ShAmt &lt; DestWidth) {</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    SV = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a4d49fd9a4cc4f2a74d4555bd08b13910">CreateShl</a>(SV, <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(SV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), ShAmt));</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    Mask &lt;&lt;= ShAmt;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ShAmt &lt; 0 &amp;&amp; (<span class="keywordtype">unsigned</span>)-ShAmt &lt; DestWidth) {</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    SV = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a3f8c45ea10c393433221a508b750dcd5">CreateLShr</a>(SV, <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(SV-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), -ShAmt));</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    Mask = Mask.<a class="code" href="classllvm_1_1APInt.html#aa1953b3ad7ef6aa87dc0205db0c2ea45">lshr</a>(-ShAmt);</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  }</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="comment">// Mask out the bits we are about to insert from the old value, and or</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="comment">// in the new bits.</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <span class="keywordflow">if</span> (SrcWidth != DestWidth) {</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    assert(DestWidth &gt; SrcWidth);</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    Old = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a197d5dd77cad4560a082900962a830aa">CreateAnd</a>(Old, <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(Context, ~Mask), <span class="stringliteral">&quot;mask&quot;</span>);</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    SV = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a8f55dd4237be6778517ddd752ca8b76a">CreateOr</a>(Old, SV, <span class="stringliteral">&quot;ins&quot;</span>);</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  }</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="keywordflow">return</span> SV;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;}</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">// SRoA Driver</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="keywordtype">bool</span> SROA::runOnFunction(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>) {</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  TD = getAnalysisIfAvailable&lt;DataLayout&gt;();</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="keywordtype">bool</span> Changed = performPromotion(F);</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="comment">// FIXME: ScalarRepl currently depends on DataLayout more than it</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <span class="comment">// theoretically needs to. It should be refactored in order to support</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  <span class="comment">// target-independent IR. Until this is done, just skip the actual</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="comment">// scalar-replacement portion of this pass.</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="keywordflow">if</span> (!TD) <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <span class="keywordflow">while</span> (1) {</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keywordtype">bool</span> LocalChange = performScalarRepl(F);</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="keywordflow">if</span> (!LocalChange) <span class="keywordflow">break</span>;   <span class="comment">// No need to repromote if no scalarrepl</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    LocalChange = performPromotion(F);</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <span class="keywordflow">if</span> (!LocalChange) <span class="keywordflow">break</span>;   <span class="comment">// No need to re-scalarrepl if no promotion</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  }</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;}</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="keyword">class </span>AllocaPromoter : <span class="keyword">public</span> <a class="code" href="classllvm_1_1LoadAndStorePromoter.html">LoadAndStorePromoter</a> {</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  <a class="code" href="classllvm_1_1DIBuilder.html">DIBuilder</a> *DIB;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DbgDeclareInst *, 4&gt;</a> DDIs;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DbgValueInst *, 4&gt;</a> DVIs;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  AllocaPromoter(<span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction*&gt;</a> &amp;Insts, <a class="code" href="classllvm_1_1SSAUpdater.html">SSAUpdater</a> &amp;<a class="code" href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a>,</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                 <a class="code" href="classllvm_1_1DIBuilder.html">DIBuilder</a> *<a class="code" href="namespacellvm_1_1X86II.html#a97dc14052814702ba0e2b14fb14dd02dac75439f87e76167e734537afa670905c">DB</a>)</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    : <a class="code" href="classllvm_1_1LoadAndStorePromoter.html">LoadAndStorePromoter</a>(Insts, S), AI(0), DIB(DB) {}</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  <span class="keywordtype">void</span> run(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction*&gt;</a> &amp;Insts) {</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="comment">// Remember which alloca we&#39;re promoting (for isInstInList).</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    this-&gt;AI = AI;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *DebugNode = <a class="code" href="classllvm_1_1MDNode.html#a05433bf2c7b926ea34946266b6a222e3">MDNode::getIfExists</a>(AI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), AI)) {</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = DebugNode-&gt;use_begin(),</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;             E = DebugNode-&gt;use_end(); UI != E; ++UI)</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1DbgDeclareInst.html">DbgDeclareInst</a> *DDI = dyn_cast&lt;DbgDeclareInst&gt;(*UI))</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;          DDIs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(DDI);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1DbgValueInst.html">DbgValueInst</a> *DVI = dyn_cast&lt;DbgValueInst&gt;(*UI))</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;          DVIs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(DVI);</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    }</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <a class="code" href="classllvm_1_1LoadAndStorePromoter.html#a0e97a303d712494969b8800d3b6d712d">LoadAndStorePromoter::run</a>(Insts);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classT.html">SmallVectorImpl&lt;DbgDeclareInst *&gt;::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = DDIs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;           E = DDIs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      <a class="code" href="classllvm_1_1DbgDeclareInst.html">DbgDeclareInst</a> *DDI = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      DDI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    }</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classT.html">SmallVectorImpl&lt;DbgValueInst *&gt;::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = DVIs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;           E = DVIs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      <a class="code" href="classllvm_1_1DbgValueInst.html">DbgValueInst</a> *DVI = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      DVI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    }</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  }</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> isInstInList(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;                            <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Instruction*&gt;</a> &amp;Insts)<span class="keyword"> const </span>{</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(I))</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      <span class="keywordflow">return</span> LI-&gt;getOperand(0) == AI;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keywordflow">return</span> cast&lt;StoreInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a class="code" href="Delinearization_8cpp.html#a67193aea0752a127930d6f762e685eef">getPointerOperand</a>() == AI;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  }</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> updateDebugInfo(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst)<span class="keyword"> const </span>{</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;DbgDeclareInst *&gt;::const_iterator</a> I = DDIs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;           E = DDIs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      <a class="code" href="classllvm_1_1DbgDeclareInst.html">DbgDeclareInst</a> *DDI = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(Inst))</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <a class="code" href="namespacellvm.html#ab3d313ef442aae5b5bebf03c923506d0">ConvertDebugDeclareToDebugValue</a>(DDI, SI, *DIB);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(Inst))</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        <a class="code" href="namespacellvm.html#ab3d313ef442aae5b5bebf03c923506d0">ConvertDebugDeclareToDebugValue</a>(DDI, LI, *DIB);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    }</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;DbgValueInst *&gt;::const_iterator</a> I = DVIs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;           E = DVIs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      <a class="code" href="classllvm_1_1DbgValueInst.html">DbgValueInst</a> *DVI = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Arg = NULL;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(Inst)) {</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        <span class="comment">// If an argument is zero extended then use argument directly. The ZExt</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        <span class="comment">// may be zapped by an optimization pass in future.</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ZExtInst.html">ZExtInst</a> *ZExt = dyn_cast&lt;ZExtInst&gt;(SI-&gt;getOperand(0)))</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;          Arg = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Argument.html">Argument</a>&gt;(ZExt-&gt;getOperand(0));</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SExtInst.html">SExtInst</a> *SExt = dyn_cast&lt;SExtInst&gt;(SI-&gt;getOperand(0)))</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;          Arg = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Argument.html">Argument</a>&gt;(SExt-&gt;getOperand(0));</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <span class="keywordflow">if</span> (!Arg)</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;          Arg = SI-&gt;getOperand(0);</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(Inst)) {</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        Arg = LI-&gt;getOperand(0);</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      }</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *DbgVal =</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        DIB-&gt;<a class="code" href="classllvm_1_1DIBuilder.html#a827de4664f26cd97746786b159fa997f">insertDbgValueIntrinsic</a>(Arg, 0, <a class="code" href="classllvm_1_1DIVariable.html">DIVariable</a>(DVI-&gt;<a class="code" href="classllvm_1_1DbgValueInst.html#adae1fa6a78df1a034751ba599b71ed68">getVariable</a>()),</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                                     Inst);</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      DbgVal-&gt;<a class="code" href="classllvm_1_1Instruction.html#a7bd545769621a0a9d2cfb074f86f4295">setDebugLoc</a>(DVI-&gt;<a class="code" href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">getDebugLoc</a>());</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    }</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  }</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;};</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;} <span class="comment">// end anon namespace</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">/// isSafeSelectToSpeculate - Select instructions that use an alloca and are</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">/// subsequently loaded can be rewritten to load both input pointers and then</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">/// select between the result, allowing the load of the alloca to be promoted.</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">/// From this:</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">///   %P2 = select i1 %cond, i32* %Alloca, i32* %Other</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">///   %V = load i32* %P2</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">/// to:</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment">///   %V1 = load i32* %Alloca      -&gt; will be mem2reg&#39;d</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">///   %V2 = load i32* %Other</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment">///   %V = select i1 %cond, i32 %V1, i32 %V2</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment">/// We can do this to a select if its only uses are loads and if the operand to</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment">/// the select can be loaded unconditionally.</span></div><div class="line"><a name="l01137"></a><span class="lineno"><a class="line" href="ScalarReplAggregates_8cpp.html#a8696165958abcc64cb88491c32c3e4bf"> 1137</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="ScalarReplAggregates_8cpp.html#a8696165958abcc64cb88491c32c3e4bf">isSafeSelectToSpeculate</a>(<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *SI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD) {</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  <span class="keywordtype">bool</span> TDerefable = SI-&gt;<a class="code" href="classllvm_1_1SelectInst.html#a67bf091383cd61e1225445e78b61d9f9">getTrueValue</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#ae6a2729f1446acc2ae3e5a05bc2a5a4b">isDereferenceablePointer</a>();</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  <span class="keywordtype">bool</span> FDerefable = SI-&gt;<a class="code" href="classllvm_1_1SelectInst.html#a29a16f32075ee4f23cd769701463952c">getFalseValue</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#ae6a2729f1446acc2ae3e5a05bc2a5a4b">isDereferenceablePointer</a>();</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = SI-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), UE = SI-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;       UI != UE; ++UI) {</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>&gt;(*UI);</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="keywordflow">if</span> (LI == 0 || !LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a156c478ee8e7d1602143cdbad4bd5385">isSimple</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    <span class="comment">// Both operands to the select need to be dereferencable, either absolutely</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <span class="comment">// (e.g. allocas) or at this point because we can see other accesses to it.</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    <span class="keywordflow">if</span> (!TDerefable &amp;&amp; !<a class="code" href="namespacellvm.html#a2bb15e529c55b5356aabfb006d1e98aa">isSafeToLoadUnconditionally</a>(SI-&gt;<a class="code" href="classllvm_1_1SelectInst.html#a67bf091383cd61e1225445e78b61d9f9">getTrueValue</a>(), LI,</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;                                                    LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad1168fc42bcba1b71217a4969483671a">getAlignment</a>(), TD))</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keywordflow">if</span> (!FDerefable &amp;&amp; !<a class="code" href="namespacellvm.html#a2bb15e529c55b5356aabfb006d1e98aa">isSafeToLoadUnconditionally</a>(SI-&gt;<a class="code" href="classllvm_1_1SelectInst.html#a29a16f32075ee4f23cd769701463952c">getFalseValue</a>(), LI,</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                                                    LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad1168fc42bcba1b71217a4969483671a">getAlignment</a>(), TD))</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  }</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;}</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="comment">/// isSafePHIToSpeculate - PHI instructions that use an alloca and are</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">/// subsequently loaded can be rewritten to load both input pointers in the pred</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">/// blocks and then PHI the results, allowing the load of the alloca to be</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="comment">/// promoted.</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">/// From this:</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">///   %P2 = phi [i32* %Alloca, i32* %Other]</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment">///   %V = load i32* %P2</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment">/// to:</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment">///   %V1 = load i32* %Alloca      -&gt; will be mem2reg&#39;d</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="comment">///   ...</span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment">///   %V2 = load i32* %Other</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment">///   ...</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment">///   %V = phi [i32 %V1, i32 %V2]</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment">/// We can do this to a select if its only uses are loads and if the operand to</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment">/// the select can be loaded unconditionally.</span></div><div class="line"><a name="l01175"></a><span class="lineno"><a class="line" href="ScalarReplAggregates_8cpp.html#a89033fbc159675f1d92988b218ee3426"> 1175</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="ScalarReplAggregates_8cpp.html#a89033fbc159675f1d92988b218ee3426">isSafePHIToSpeculate</a>(<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD) {</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  <span class="comment">// For now, we can only do this promotion if the load is in the same block as</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  <span class="comment">// the PHI, and if there are no stores between the phi and load.</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="comment">// TODO: Allow recursive phi users.</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  <span class="comment">// TODO: Allow stores.</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <span class="keywordtype">unsigned</span> MaxAlign = 0;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = PN-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), UE = PN-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;       UI != UE; ++UI) {</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>&gt;(*UI);</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordflow">if</span> (LI == 0 || !LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a156c478ee8e7d1602143cdbad4bd5385">isSimple</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="comment">// For now we only allow loads in the same block as the PHI.  This is a</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="comment">// common case that happens when instcombine merges two loads through a PHI.</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">if</span> (LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>() != <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="comment">// Ensure that there are no instructions between the PHI and the load that</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <span class="comment">// could store.</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = PN; &amp;*BBI != LI; ++BBI)</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      <span class="keywordflow">if</span> (BBI-&gt;mayWriteToMemory())</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    MaxAlign = std::max(MaxAlign, LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad1168fc42bcba1b71217a4969483671a">getAlignment</a>());</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  }</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <span class="comment">// Okay, we know that we have one or more loads in the same block as the PHI.</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  <span class="comment">// We can transform this if it is safe to push the loads into the predecessor</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  <span class="comment">// blocks.  The only thing to watch out for is that we can&#39;t put a possibly</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  <span class="comment">// trapping load in the predecessor if it is a critical edge.</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *InVal = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <span class="comment">// If the terminator of the predecessor has side-effects (an invoke),</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="comment">// there is no safe place to put a load in the predecessor.</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    <span class="keywordflow">if</span> (Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>()-&gt;<a class="code" href="classllvm_1_1Instruction.html#a573063aad4c101462893d0490d867524">mayHaveSideEffects</a>())</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="comment">// If the value is produced by the terminator of the predecessor</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="comment">// (an invoke), there is no valid place to put a load in the predecessor.</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <span class="keywordflow">if</span> (Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>() == InVal)</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="comment">// If the predecessor has a single successor, then the edge isn&#39;t critical.</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="keywordflow">if</span> (Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>()-&gt;<a class="code" href="classllvm_1_1TerminatorInst.html#a4c26d3b92af99a6c8defd89a2d39ca32">getNumSuccessors</a>() == 1)</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="comment">// If this pointer is always safe to load, or if we can prove that there is</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="comment">// already a load in the block, then we can move the load to the pred block.</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordflow">if</span> (InVal-&gt;<a class="code" href="classllvm_1_1Value.html#ae6a2729f1446acc2ae3e5a05bc2a5a4b">isDereferenceablePointer</a>() ||</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        <a class="code" href="namespacellvm.html#a2bb15e529c55b5356aabfb006d1e98aa">isSafeToLoadUnconditionally</a>(InVal, Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>(), MaxAlign, TD))</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  }</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;}</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment">/// tryToMakeAllocaBePromotable - This returns true if the alloca only has</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="comment">/// direct (non-volatile) loads and stores to it.  If the alloca is close but</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment">/// not quite there, this will transform the code to allow promotion.  As such,</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="comment">/// it is a non-pure predicate.</span></div><div class="line"><a name="l01239"></a><span class="lineno"><a class="line" href="ScalarReplAggregates_8cpp.html#ae56008e3ce94b653130107b75b9332a8"> 1239</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="ScalarReplAggregates_8cpp.html#ae56008e3ce94b653130107b75b9332a8">tryToMakeAllocaBePromotable</a>(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD) {</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;Instruction*, SmallVector&lt;Instruction*, 4&gt;</a>,</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;            <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction*, 4&gt;</a> &gt; InstsToRewrite;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = AI-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), UE = AI-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;       UI != UE; ++UI) {</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <a class="code" href="classllvm_1_1User.html">User</a> *U = *UI;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(U)) {</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      <span class="keywordflow">if</span> (!LI-&gt;isSimple())</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    }</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(U)) {</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      <span class="keywordflow">if</span> (SI-&gt;getOperand(0) == AI || !SI-&gt;isSimple())</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;   <span class="comment">// Don&#39;t allow a store OF the AI, only INTO the AI.</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    }</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *SI = dyn_cast&lt;SelectInst&gt;(U)) {</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      <span class="comment">// If the condition being selected on is a constant, fold the select, yes</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      <span class="comment">// this does (rarely) happen early on.</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = dyn_cast&lt;ConstantInt&gt;(SI-&gt;getCondition())) {</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Result = SI-&gt;getOperand(1+CI-&gt;isZero());</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;        SI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Result);</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;        SI-&gt;eraseFromParent();</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        <span class="comment">// This is very rare and we just scrambled the use list of AI, start</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        <span class="comment">// over completely.</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="ScalarReplAggregates_8cpp.html#ae56008e3ce94b653130107b75b9332a8">tryToMakeAllocaBePromotable</a>(AI, TD);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;      }</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;      <span class="comment">// If it is safe to turn &quot;load (select c, AI, ptr)&quot; into a select of two</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;      <span class="comment">// loads, then we can transform this by rewriting the select.</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="ScalarReplAggregates_8cpp.html#a8696165958abcc64cb88491c32c3e4bf">isSafeSelectToSpeculate</a>(SI, TD))</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      InstsToRewrite.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(SI);</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    }</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(U)) {</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <span class="keywordflow">if</span> (PN-&gt;use_empty()) {  <span class="comment">// Dead PHIs can be stripped.</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        InstsToRewrite.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(PN);</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      }</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      <span class="comment">// If it is safe to turn &quot;load (phi [AI, ptr, ...])&quot; into a PHI of loads</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      <span class="comment">// in the pred blocks, then we can transform this by rewriting the PHI.</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="ScalarReplAggregates_8cpp.html#a89033fbc159675f1d92988b218ee3426">isSafePHIToSpeculate</a>(PN, TD))</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      InstsToRewrite.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(PN);</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    }</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BCI = dyn_cast&lt;BitCastInst&gt;(U)) {</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a9d0a7040918ba81ef34046fd474cee10">onlyUsedByLifetimeMarkers</a>(BCI)) {</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        InstsToRewrite.<a class="code" href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">insert</a>(BCI);</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;      }</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    }</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  }</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;  <span class="comment">// If there are no instructions to rewrite, then all uses are load/stores and</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  <span class="comment">// we&#39;re done!</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  <span class="keywordflow">if</span> (InstsToRewrite.<a class="code" href="classllvm_1_1SetVector.html#a298a4f422dfc8478ad9cdd0a106cd5e4">empty</a>())</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  <span class="comment">// If we have instructions that need to be rewritten for this to be promotable</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  <span class="comment">// take care of it now.</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = InstsToRewrite.<a class="code" href="classllvm_1_1SetVector.html#a95ea0587484ef2fc182e64dfd36a62c8">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BCI = dyn_cast&lt;BitCastInst&gt;(InstsToRewrite[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>])) {</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      <span class="comment">// This could only be a bitcast used by nothing but lifetime intrinsics.</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html#ac33c7ecbf1c0f1e8bf93403522e6976b">BitCastInst::use_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BCI-&gt;use_begin(), E = BCI-&gt;use_end();</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;           <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E;) {</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;        <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;U = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getUse();</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        cast&lt;Instruction&gt;(U.<a class="code" href="classllvm_1_1Use.html#ac3564961c33fa9f636c6444db4c7fa85">getUser</a>())-&gt;eraseFromParent();</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      }</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;      BCI-&gt;eraseFromParent();</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    }</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *SI = dyn_cast&lt;SelectInst&gt;(InstsToRewrite[i])) {</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      <span class="comment">// Selects in InstsToRewrite only have load uses.  Rewrite each as two</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;      <span class="comment">// loads with a new select.</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;      <span class="keywordflow">while</span> (!SI-&gt;use_empty()) {</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = cast&lt;LoadInst&gt;(SI-&gt;use_back());</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(LI);</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *TrueLoad =</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;          Builder.CreateLoad(SI-&gt;getTrueValue(), LI-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.t&quot;</span>);</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *FalseLoad =</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;          Builder.CreateLoad(SI-&gt;getFalseValue(), LI-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.f&quot;</span>);</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        <span class="comment">// Transfer alignment and TBAA info if present.</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        TrueLoad-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a218ef27c964707a907f12db0f9b002ba">setAlignment</a>(LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad1168fc42bcba1b71217a4969483671a">getAlignment</a>());</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        FalseLoad-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a218ef27c964707a907f12db0f9b002ba">setAlignment</a>(LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#ad1168fc42bcba1b71217a4969483671a">getAlignment</a>());</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *Tag = LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#aafa29112cbe02e4adc9b36752c771991">getMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da66682b7e33233c8e51196bbf274726a2">LLVMContext::MD_tbaa</a>)) {</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;          TrueLoad-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da66682b7e33233c8e51196bbf274726a2">LLVMContext::MD_tbaa</a>, Tag);</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;          FalseLoad-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da66682b7e33233c8e51196bbf274726a2">LLVMContext::MD_tbaa</a>, Tag);</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        }</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *V = Builder.CreateSelect(SI-&gt;getCondition(), TrueLoad, FalseLoad);</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;        V-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(LI);</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;        LI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;        LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      }</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;      <span class="comment">// Now that all the loads are gone, the select is gone too.</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      SI-&gt;eraseFromParent();</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    }</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <span class="comment">// Otherwise, we have a PHI node which allows us to push the loads into the</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <span class="comment">// predecessors.</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = cast&lt;PHINode&gt;(InstsToRewrite[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    <span class="keywordflow">if</span> (PN-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;      PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    }</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *LoadTy = cast&lt;PointerType&gt;(PN-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())-&gt;getElementType();</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *NewPN = <a class="code" href="classllvm_1_1PHINode.html#afb5e83bf5123ff7c51058eb0ebebcdc6">PHINode::Create</a>(LoadTy, PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>(),</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                                     PN-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.ld&quot;</span>, PN);</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <span class="comment">// Get the TBAA tag and alignment to use from one of the loads.  It doesn&#39;t</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    <span class="comment">// matter which one we get and if any differ, it doesn&#39;t matter.</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *SomeLoad = cast&lt;LoadInst&gt;(PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">use_back</a>());</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    <a class="code" href="classllvm_1_1MDNode.html">MDNode</a> *TBAATag = SomeLoad-&gt;getMetadata(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da66682b7e33233c8e51196bbf274726a2">LLVMContext::MD_tbaa</a>);</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="ARMSubtarget_8cpp.html#a4bd80d4e433d9f72af26b364036900dc">Align</a> = SomeLoad-&gt;getAlignment();</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <span class="comment">// Rewrite all loads of the PN to use the new PHI.</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    <span class="keywordflow">while</span> (!PN-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = cast&lt;LoadInst&gt;(PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">use_back</a>());</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;      LI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewPN);</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    }</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <span class="comment">// Inject loads into all of the pred blocks.  Keep track of which blocks we</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <span class="comment">// insert them into in case we have multiple edges from the same block.</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;BasicBlock*, LoadInst*&gt;</a> InsertedLoads;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0, e = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(i);</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *&amp;<a class="code" href="namespacellvm_1_1SPII.html#a11e9b8fca4a074643a6a21f444e51406a5069619ca8fdce305534f3fe85091a0f">Load</a> = InsertedLoads[Pred];</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;      <span class="keywordflow">if</span> (Load == 0) {</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        Load = <span class="keyword">new</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(i),</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;                            PN-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() + <span class="stringliteral">&quot;.&quot;</span> + Pred-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>(),</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;                            Pred-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        Load-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a218ef27c964707a907f12db0f9b002ba">setAlignment</a>(Align);</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        <span class="keywordflow">if</span> (TBAATag) Load-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(<a class="code" href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da66682b7e33233c8e51196bbf274726a2">LLVMContext::MD_tbaa</a>, TBAATag);</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;      }</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;      NewPN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(Load, Pred);</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    }</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;  }</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  ++NumAdjusted;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;}</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="keywordtype">bool</span> SROA::performPromotion(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F) {</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  std::vector&lt;AllocaInst*&gt; Allocas;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> *DT = 0;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  <span class="keywordflow">if</span> (HasDomTree)</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    DT = &amp;getAnalysis&lt;DominatorTree&gt;();</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = F.<a class="code" href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">getEntryBlock</a>();  <span class="comment">// Get the entry node for the function</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  <a class="code" href="classllvm_1_1DIBuilder.html">DIBuilder</a> DIB(*F.<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>());</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Instruction*, 64&gt;</a> Insts;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  <span class="keywordflow">while</span> (1) {</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    Allocas.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="comment">// Find allocas that are safe to promote, by looking at all instructions in</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="comment">// the entry node</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB.begin(), E = --BB.end(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI = dyn_cast&lt;AllocaInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))       <span class="comment">// Is it an alloca?</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ScalarReplAggregates_8cpp.html#ae56008e3ce94b653130107b75b9332a8">tryToMakeAllocaBePromotable</a>(AI, TD))</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;          Allocas.push_back(AI);</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    <span class="keywordflow">if</span> (Allocas.empty()) <span class="keywordflow">break</span>;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="keywordflow">if</span> (HasDomTree)</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;      <a class="code" href="namespacellvm.html#afd92ce3a3b5db58abf81981d3fcd95c6">PromoteMemToReg</a>(Allocas, *DT);</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      <a class="code" href="classllvm_1_1SSAUpdater.html">SSAUpdater</a> SSA;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Allocas.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;        <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI = Allocas[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        <span class="comment">// Build list of instructions to promote.</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = AI-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = AI-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;             UI != E; ++UI)</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;          Insts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(cast&lt;Instruction&gt;(*UI));</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        AllocaPromoter(Insts, SSA, &amp;DIB).run(AI, Insts);</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        Insts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      }</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    }</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    NumPromoted += Allocas.size();</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  }</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;}</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="comment">/// ShouldAttemptScalarRepl - Decide if an alloca is a good candidate for</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="comment">/// SROA.  It must be a struct or array type with a small number of elements.</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> SROA::ShouldAttemptScalarRepl(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI) {</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *T = AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>();</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  <span class="comment">// Do not promote any struct that has too many members.</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *ST = dyn_cast&lt;StructType&gt;(T))</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <span class="keywordflow">return</span> ST-&gt;getNumElements() &lt;= StructMemberThreshold;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;  <span class="comment">// Do not promote any array that has too many elements.</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *AT = dyn_cast&lt;ArrayType&gt;(T))</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    <span class="keywordflow">return</span> AT-&gt;getNumElements() &lt;= ArrayElementThreshold;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;}</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="comment">// performScalarRepl - This algorithm is a simple worklist driven algorithm,</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="comment">// which runs on all of the alloca instructions in the entry block, removing</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="comment">// them if they are only used by getelementptr instructions.</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="keywordtype">bool</span> SROA::performScalarRepl(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F) {</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;  std::vector&lt;AllocaInst*&gt; WorkList;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  <span class="comment">// Scan the entry basic block, adding allocas to the worklist.</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = F.<a class="code" href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">getEntryBlock</a>();</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB.<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), E = BB.<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a> = dyn_cast&lt;AllocaInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      WorkList.push_back(<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>);</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  <span class="comment">// Process the worklist</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <span class="keywordflow">while</span> (!WorkList.empty()) {</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI = WorkList.back();</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    WorkList.pop_back();</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="comment">// Handle dead allocas trivially.  These can be formed by SROA&#39;ing arrays</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    <span class="comment">// with unused elements.</span></div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    <span class="keywordflow">if</span> (AI-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;      AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    }</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="comment">// If this alloca is impossible for us to promote, reject it early.</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    <span class="keywordflow">if</span> (AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a066eba0d0eb9d9655c9b580a2a279b0a">isArrayAllocation</a>() || !AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a9dc5111b1a9b1d5c4652d50f74fe850b">isSized</a>())</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <span class="comment">// Check to see if we can perform the core SROA transformation.  We cannot</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="comment">// transform the allocation instruction if it is an array allocation</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <span class="comment">// (allocations OF arrays are ok though), and an allocation of a scalar</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <span class="comment">// value cannot be decomposed at all.</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    uint64_t AllocaSize = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>());</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="comment">// Do not promote [0 x %struct].</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="keywordflow">if</span> (AllocaSize == 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    <span class="comment">// Do not promote any struct whose size is too big.</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    <span class="keywordflow">if</span> (AllocaSize &gt; SRThreshold) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    <span class="comment">// If the alloca looks like a good candidate for scalar replacement, and if</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    <span class="comment">// all its users can be transformed, then split up the aggregate into its</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    <span class="comment">// separate elements.</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <span class="keywordflow">if</span> (ShouldAttemptScalarRepl(AI) &amp;&amp; isSafeAllocaToScalarRepl(AI)) {</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      DoScalarReplacement(AI, WorkList);</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    }</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    <span class="comment">// If we can turn this aggregate value (potentially with casts) into a</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    <span class="comment">// simple scalar value that can be mem2reg&#39;d into a register value.</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    <span class="comment">// IsNotTrivial tracks whether this is something that mem2reg could have</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    <span class="comment">// promoted itself.  If so, we don&#39;t want to transform it needlessly.  Note</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <span class="comment">// that we can&#39;t just check based on the type: the alloca may be of an i32</span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <span class="comment">// but that has pointer arithmetic to set byte 3 of it or something.</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *NewAI = ConvertToScalarInfo(</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;              (<span class="keywordtype">unsigned</span>)AllocaSize, *TD, ScalarLoadThreshold).TryConvert(AI)) {</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;      NewAI-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(AI);</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;      AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;      ++NumConverted;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    }</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    <span class="comment">// Otherwise, couldn&#39;t process this alloca.</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  }</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;}</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="comment">/// DoScalarReplacement - This alloca satisfied the isSafeAllocaToScalarRepl</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="comment">/// predicate, do SROA now.</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> SROA::DoScalarReplacement(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI,</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                               std::vector&lt;AllocaInst*&gt; &amp;WorkList) {</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found inst to SROA: &quot;</span> &lt;&lt; *AI &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;AllocaInst*, 32&gt;</a> ElementAllocas;</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *ST = dyn_cast&lt;StructType&gt;(AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>())) {</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    ElementAllocas.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a4786e64977a3af38f29adee46b70a863">reserve</a>(ST-&gt;getNumContainedTypes());</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = ST-&gt;getNumContainedTypes(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *NA = <span class="keyword">new</span> <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a>(ST-&gt;getContainedType(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>), 0,</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;                                      AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#ad441932c20e5b9ba36c8c72a6c7f5ec3">getAlignment</a>(),</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;                                      AI-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() + <span class="stringliteral">&quot;.&quot;</span> + <a class="code" href="classllvm_1_1Twine.html">Twine</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>), AI);</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;      ElementAllocas.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(NA);</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;      WorkList.push_back(NA);  <span class="comment">// Add to worklist for recursive processing</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    }</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *AT = cast&lt;ArrayType&gt;(AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>());</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    ElementAllocas.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a4786e64977a3af38f29adee46b70a863">reserve</a>(AT-&gt;<a class="code" href="classllvm_1_1ArrayType.html#a688547c04258bde2eaf6515048bf3f3b">getNumElements</a>());</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *ElTy = AT-&gt;<a class="code" href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">getElementType</a>();</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = AT-&gt;<a class="code" href="classllvm_1_1ArrayType.html#a688547c04258bde2eaf6515048bf3f3b">getNumElements</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;      <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *NA = <span class="keyword">new</span> <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a>(ElTy, 0, AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#ad441932c20e5b9ba36c8c72a6c7f5ec3">getAlignment</a>(),</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;                                      AI-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() + <span class="stringliteral">&quot;.&quot;</span> + <a class="code" href="classllvm_1_1Twine.html">Twine</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>), AI);</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;      ElementAllocas.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(NA);</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;      WorkList.push_back(NA);  <span class="comment">// Add to worklist for recursive processing</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    }</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  }</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="comment">// Now that we have created the new alloca instructions, rewrite all the</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  <span class="comment">// uses of the old alloca.</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  RewriteForScalarRepl(AI, AI, 0, ElementAllocas);</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  <span class="comment">// Now erase any instructions that were made dead while rewriting the alloca.</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  DeleteDeadInstructions();</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;  AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  ++NumReplaced;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;}</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="comment">/// DeleteDeadInstructions - Erase instructions on the DeadInstrs list,</span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="comment">/// recursively including all their operands that become trivially dead.</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> SROA::DeleteDeadInstructions() {</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  <span class="keywordflow">while</span> (!DeadInsts.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = cast&lt;Instruction&gt;(DeadInsts.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>());</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> OI = I-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>(), E = I-&gt;<a class="code" href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">op_end</a>(); OI != E; ++OI)</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *U = dyn_cast&lt;Instruction&gt;(*OI)) {</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;        <span class="comment">// Zero out the operand and see if it becomes trivially dead.</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;        <span class="comment">// (But, don&#39;t add allocas to the dead instruction list -- they are</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;        <span class="comment">// already on the worklist and will be deleted separately.)</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;        *OI = 0;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#abe283966f269761ee387642061c4451e">isInstructionTriviallyDead</a>(U) &amp;&amp; !isa&lt;AllocaInst&gt;(U))</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;          DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(U);</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      }</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;  }</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;}</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="comment">/// isSafeForScalarRepl - Check if instruction I is a safe use with regard to</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="comment">/// performing scalar replacement of alloca AI.  The results are flagged in</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment">/// the Info parameter.  Offset indicates the position within AI that is</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="comment">/// referenced by this instruction.</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> SROA::isSafeForScalarRepl(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, uint64_t Offset,</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;                               AllocaInfo &amp;Info) {</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = I-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = I-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI!=E; ++UI) {</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(*UI);</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BC = dyn_cast&lt;BitCastInst&gt;(User)) {</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      isSafeForScalarRepl(BC, Offset, Info);</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI = dyn_cast&lt;GetElementPtrInst&gt;(User)) {</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;      uint64_t GEPOffset = Offset;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;      isSafeGEP(GEPI, GEPOffset, Info);</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      <span class="keywordflow">if</span> (!Info.isUnsafe)</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        isSafeForScalarRepl(GEPI, GEPOffset, Info);</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MemIntrinsic.html">MemIntrinsic</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> = dyn_cast&lt;MemIntrinsic&gt;(User)) {</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;      <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Length = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>-&gt;getLength());</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      <span class="keywordflow">if</span> (Length == 0)</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;        <span class="keywordflow">return</span> MarkUnsafe(Info, User);</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;      <span class="keywordflow">if</span> (Length-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a97c35b2ca7fa3e1f17c9f25e9dc2087b">isNegative</a>())</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        <span class="keywordflow">return</span> MarkUnsafe(Info, User);</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;      isSafeMemAccess(Offset, Length-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>(), 0,</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;                      UI.getOperandNo() == 0, Info, <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>,</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;                      <span class="keyword">true</span> <span class="comment">/*AllowWholeAccess*/</span>);</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(User)) {</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;      <span class="keywordflow">if</span> (!LI-&gt;isSimple())</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        <span class="keywordflow">return</span> MarkUnsafe(Info, User);</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *LIType = LI-&gt;getType();</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;      isSafeMemAccess(Offset, TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(LIType),</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;                      LIType, <span class="keyword">false</span>, Info, LI, <span class="keyword">true</span> <span class="comment">/*AllowWholeAccess*/</span>);</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;      Info.hasALoadOrStore = <span class="keyword">true</span>;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(User)) {</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      <span class="comment">// Store is ok if storing INTO the pointer, not storing the pointer</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;      <span class="keywordflow">if</span> (!SI-&gt;isSimple() || SI-&gt;getOperand(0) == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;        <span class="keywordflow">return</span> MarkUnsafe(Info, User);</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *SIType = SI-&gt;getOperand(0)-&gt;getType();</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;      isSafeMemAccess(Offset, TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(SIType),</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;                      SIType, <span class="keyword">true</span>, Info, SI, <span class="keyword">true</span> <span class="comment">/*AllowWholeAccess*/</span>);</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;      Info.hasALoadOrStore = <span class="keyword">true</span>;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II = dyn_cast&lt;IntrinsicInst&gt;(User)) {</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;      <span class="keywordflow">if</span> (II-&gt;getIntrinsicID() != <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ae365354e47542c51f9bd46e329e3323e">Intrinsic::lifetime_start</a> &amp;&amp;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;          II-&gt;getIntrinsicID() != <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90aa332b90dd5e4ebf4bbbcc0964220d373">Intrinsic::lifetime_end</a>)</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;        <span class="keywordflow">return</span> MarkUnsafe(Info, User);</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(User) || isa&lt;SelectInst&gt;(User)) {</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;      isSafePHISelectUseForScalarRepl(User, Offset, Info);</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;      <span class="keywordflow">return</span> MarkUnsafe(Info, User);</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    }</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    <span class="keywordflow">if</span> (Info.isUnsafe) <span class="keywordflow">return</span>;</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;  }</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;}</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;<span class="comment">/// isSafePHIUseForScalarRepl - If we see a PHI node or select using a pointer</span></div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="comment">/// derived from the alloca, we can often still split the alloca into elements.</span></div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="comment">/// This is useful if we have a large alloca where one element is phi&#39;d</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;<span class="comment">/// together somewhere: we can SRoA and promote all the other elements even if</span></div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;<span class="comment">/// we end up not being able to promote this one.</span></div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="comment">/// All we require is that the uses of the PHI do not index into other parts of</span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;<span class="comment">/// the alloca.  The most important use case for this is single load and stores</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;<span class="comment">/// that are PHI&#39;d together, which can happen due to code sinking.</span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> SROA::isSafePHISelectUseForScalarRepl(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I, uint64_t Offset,</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;                                           AllocaInfo &amp;Info) {</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;  <span class="comment">// If we&#39;ve already checked this PHI, don&#39;t do it again.</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(I))</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    <span class="keywordflow">if</span> (!Info.CheckedPHIs.insert(PN))</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = I-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = I-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI!=E; ++UI) {</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(*UI);</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BC = dyn_cast&lt;BitCastInst&gt;(User)) {</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      isSafePHISelectUseForScalarRepl(BC, Offset, Info);</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI = dyn_cast&lt;GetElementPtrInst&gt;(User)) {</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      <span class="comment">// Only allow &quot;bitcast&quot; GEPs for simplicity.  We could generalize this,</span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;      <span class="comment">// but would have to prove that we&#39;re staying inside of an element being</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;      <span class="comment">// promoted.</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      <span class="keywordflow">if</span> (!GEPI-&gt;hasAllZeroIndices())</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        <span class="keywordflow">return</span> MarkUnsafe(Info, User);</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;      isSafePHISelectUseForScalarRepl(GEPI, Offset, Info);</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(User)) {</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      <span class="keywordflow">if</span> (!LI-&gt;isSimple())</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        <span class="keywordflow">return</span> MarkUnsafe(Info, User);</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *LIType = LI-&gt;getType();</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;      isSafeMemAccess(Offset, TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(LIType),</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                      LIType, <span class="keyword">false</span>, Info, LI, <span class="keyword">false</span> <span class="comment">/*AllowWholeAccess*/</span>);</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;      Info.hasALoadOrStore = <span class="keyword">true</span>;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(User)) {</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      <span class="comment">// Store is ok if storing INTO the pointer, not storing the pointer</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;      <span class="keywordflow">if</span> (!SI-&gt;isSimple() || SI-&gt;getOperand(0) == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;        <span class="keywordflow">return</span> MarkUnsafe(Info, User);</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *SIType = SI-&gt;getOperand(0)-&gt;getType();</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;      isSafeMemAccess(Offset, TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(SIType),</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                      SIType, <span class="keyword">true</span>, Info, SI, <span class="keyword">false</span> <span class="comment">/*AllowWholeAccess*/</span>);</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;      Info.hasALoadOrStore = <span class="keyword">true</span>;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;PHINode&gt;(User) || isa&lt;SelectInst&gt;(User)) {</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;      isSafePHISelectUseForScalarRepl(User, Offset, Info);</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;      <span class="keywordflow">return</span> MarkUnsafe(Info, User);</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    }</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    <span class="keywordflow">if</span> (Info.isUnsafe) <span class="keywordflow">return</span>;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;  }</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;}</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="comment">/// isSafeGEP - Check if a GEP instruction can be handled for scalar</span></div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;<span class="comment">/// replacement.  It is safe when all the indices are constant, in-bounds</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="comment">/// references, and when the resulting offset corresponds to an element within</span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;<span class="comment">/// the alloca type.  The results are flagged in the Info parameter.  Upon</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="comment">/// return, Offset is adjusted as specified by the GEP indices.</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> SROA::isSafeGEP(<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI,</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                     uint64_t &amp;Offset, AllocaInfo &amp;Info) {</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;  <a class="code" href="classllvm_1_1generic__gep__type__iterator.html">gep_type_iterator</a> GEPIt = <a class="code" href="namespacellvm.html#ac828b9b52935f87659a4adf237f820a3">gep_type_begin</a>(GEPI), E = <a class="code" href="namespacellvm.html#a43c6ebb4fd35ebd815d66a2df4eed0b9">gep_type_end</a>(GEPI);</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;  <span class="keywordflow">if</span> (GEPIt == E)</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;  <span class="keywordtype">bool</span> NonConstant = <span class="keyword">false</span>;</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;  <span class="keywordtype">unsigned</span> NonConstantIdxSize = 0;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;  <span class="comment">// Walk through the GEP type indices, checking the types that this indexes</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;  <span class="comment">// into.</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  <span class="keywordflow">for</span> (; GEPIt != E; ++GEPIt) {</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="comment">// Ignore struct elements, no extra checking needed for these.</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    <span class="keywordflow">if</span> ((*GEPIt)-&gt;isStructTy())</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *IdxVal = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(GEPIt.<a class="code" href="classllvm_1_1generic__gep__type__iterator.html#a8ca2ac53bb7661363b852abc99971d74">getOperand</a>());</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    <span class="keywordflow">if</span> (!IdxVal)</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      <span class="keywordflow">return</span> MarkUnsafe(Info, GEPI);</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;  }</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;  <span class="comment">// Compute the offset due to this GEP and check if the alloca has a</span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;  <span class="comment">// component element at that offset.</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 8&gt;</a> Indices(GEPI-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>() + 1, GEPI-&gt;<a class="code" href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">op_end</a>());</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;  <span class="comment">// If this GEP is non constant then the last operand must have been a</span></div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;  <span class="comment">// dynamic index into a vector.  Pop this now as it has no impact on the</span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;  <span class="comment">// constant part of the offset.</span></div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;  <span class="keywordflow">if</span> (NonConstant)</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    Indices.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#a1f2303df9bbee2233c11d61c2f6f7930">pop_back</a>();</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;  Offset += TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#af81977584678ef1ff229fcf2f1b69b2b">getIndexedOffset</a>(GEPI-&gt;<a class="code" href="classllvm_1_1GetElementPtrInst.html#a7400b6ae12470abc8ea6e18e171016b2">getPointerOperandType</a>(), Indices);</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  <span class="keywordflow">if</span> (!TypeHasComponent(Info.AI-&gt;getAllocatedType(), Offset,</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;                        NonConstantIdxSize))</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    MarkUnsafe(Info, GEPI);</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;}</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;<span class="comment">/// isHomogeneousAggregate - Check if type T is a struct or array containing</span></div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="comment">/// elements of the same type (which is always true for arrays).  If so,</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="comment">/// return true with NumElts and EltTy set to the number of elements and the</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="comment">/// element type, respectively.</span></div><div class="line"><a name="l01749"></a><span class="lineno"><a class="line" href="ScalarReplAggregates_8cpp.html#a7197c0101d6d4a90db6dfb8a0216f69f"> 1749</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="ScalarReplAggregates_8cpp.html#a7197c0101d6d4a90db6dfb8a0216f69f">isHomogeneousAggregate</a>(<a class="code" href="classllvm_1_1Type.html">Type</a> *T, <span class="keywordtype">unsigned</span> &amp;NumElts,</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;                                   <a class="code" href="classllvm_1_1Type.html">Type</a> *&amp;EltTy) {</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *AT = dyn_cast&lt;ArrayType&gt;(T)) {</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    NumElts = AT-&gt;getNumElements();</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    EltTy = (NumElts == 0 ? 0 : AT-&gt;getElementType());</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;  }</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *ST = dyn_cast&lt;StructType&gt;(T)) {</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    NumElts = ST-&gt;<a class="code" href="classllvm_1_1Type.html#ad083201ba4e1f8217bdc1f1ab05bd83d">getNumContainedTypes</a>();</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    EltTy = (NumElts == 0 ? 0 : ST-&gt;getContainedType(0));</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a> = 1; <a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a> &lt; NumElts; ++<a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>) {</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;      <span class="keywordflow">if</span> (ST-&gt;getContainedType(<a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>) != EltTy)</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    }</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;  }</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;}</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="comment">/// isCompatibleAggregate - Check if T1 and T2 are either the same type or are</span></div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="comment">/// &quot;homogeneous&quot; aggregates with the same element type and number of elements.</span></div><div class="line"><a name="l01770"></a><span class="lineno"><a class="line" href="ScalarReplAggregates_8cpp.html#aed0e85fc9abd34c5e7c4a96386d33007"> 1770</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="ScalarReplAggregates_8cpp.html#aed0e85fc9abd34c5e7c4a96386d33007">isCompatibleAggregate</a>(<a class="code" href="classllvm_1_1Type.html">Type</a> *<a class="code" href="Mips16ISelLowering_8cpp.html#ac16509a75e3d3fc46b9df1726be486ec">T1</a>, <a class="code" href="classllvm_1_1Type.html">Type</a> *T2) {</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  <span class="keywordflow">if</span> (T1 == T2)</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  <span class="keywordtype">unsigned</span> NumElts1, NumElts2;</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *EltTy1, *EltTy2;</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ScalarReplAggregates_8cpp.html#a7197c0101d6d4a90db6dfb8a0216f69f">isHomogeneousAggregate</a>(T1, NumElts1, EltTy1) &amp;&amp;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;      <a class="code" href="ScalarReplAggregates_8cpp.html#a7197c0101d6d4a90db6dfb8a0216f69f">isHomogeneousAggregate</a>(T2, NumElts2, EltTy2) &amp;&amp;</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;      NumElts1 == NumElts2 &amp;&amp;</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;      EltTy1 == EltTy2)</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;}</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="comment">/// isSafeMemAccess - Check if a load/store/memcpy operates on the entire AI</span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="comment">/// alloca or has an offset and size that corresponds to a component element</span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="comment">/// within it.  The offset checked here may have been formed from a GEP with a</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="comment">/// pointer bitcasted to a different type.</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="comment">/// If AllowWholeAccess is true, then this allows uses of the entire alloca as a</span></div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="comment">/// unit.  If false, it only allows accesses known to be in a single element.</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> SROA::isSafeMemAccess(uint64_t Offset, uint64_t MemSize,</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;                           <a class="code" href="classllvm_1_1Type.html">Type</a> *MemOpType, <span class="keywordtype">bool</span> isStore,</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;                           AllocaInfo &amp;Info, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *TheAccess,</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;                           <span class="keywordtype">bool</span> AllowWholeAccess) {</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;  <span class="comment">// Check if this is a load/store of the entire alloca.</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  <span class="keywordflow">if</span> (Offset == 0 &amp;&amp; AllowWholeAccess &amp;&amp;</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      MemSize == TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(Info.AI-&gt;getAllocatedType())) {</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    <span class="comment">// This can be safe for MemIntrinsics (where MemOpType is 0) and integer</span></div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    <span class="comment">// loads/stores (which are essentially the same as the MemIntrinsics with</span></div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    <span class="comment">// regard to copying padding between elements).  But, if an alloca is</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <span class="comment">// flagged as both a source and destination of such operations, we&#39;ll need</span></div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <span class="comment">// to check later for padding between elements.</span></div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <span class="keywordflow">if</span> (!MemOpType || MemOpType-&gt;<a class="code" href="classllvm_1_1Type.html#a6e328feb83afa5cf1c966d6704e43fc1">isIntegerTy</a>()) {</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;      <span class="keywordflow">if</span> (isStore)</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        Info.isMemCpyDst = <span class="keyword">true</span>;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;        Info.isMemCpySrc = <span class="keyword">true</span>;</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    }</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    <span class="comment">// This is also safe for references using a type that is compatible with</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    <span class="comment">// the type of the alloca, so that loads/stores can be rewritten using</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    <span class="comment">// insertvalue/extractvalue.</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ScalarReplAggregates_8cpp.html#aed0e85fc9abd34c5e7c4a96386d33007">isCompatibleAggregate</a>(MemOpType, Info.AI-&gt;getAllocatedType())) {</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;      Info.hasSubelementAccess = <span class="keyword">true</span>;</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    }</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  }</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  <span class="comment">// Check if the offset/size correspond to a component within the alloca type.</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *T = Info.AI-&gt;getAllocatedType();</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  <span class="keywordflow">if</span> (TypeHasComponent(T, Offset, MemSize)) {</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    Info.hasSubelementAccess = <span class="keyword">true</span>;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  }</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;  <span class="keywordflow">return</span> MarkUnsafe(Info, TheAccess);</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;}</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="comment">/// TypeHasComponent - Return true if T has a component type with the</span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="comment">/// specified offset and size.  If Size is zero, do not check the size.</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> SROA::TypeHasComponent(<a class="code" href="classllvm_1_1Type.html">Type</a> *T, uint64_t Offset, uint64_t Size) {</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *EltTy;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  uint64_t EltSize;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *ST = dyn_cast&lt;StructType&gt;(T)) {</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1StructLayout.html">StructLayout</a> *Layout = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a35c840104f32575e0d91422cf1ef3ce4">getStructLayout</a>(ST);</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    <span class="keywordtype">unsigned</span> EltIdx = Layout-&gt;<a class="code" href="classllvm_1_1StructLayout.html#a795cfd43d30c44c33b97fe850bc0451f">getElementContainingOffset</a>(Offset);</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;    EltTy = ST-&gt;<a class="code" href="classllvm_1_1Type.html#a1e2a8dc174c34596e7e8efc7ab7e08a0">getContainedType</a>(EltIdx);</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    EltSize = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(EltTy);</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    Offset -= Layout-&gt;<a class="code" href="classllvm_1_1StructLayout.html#ae10c4483372a357a0d3411b3d64be10c">getElementOffset</a>(EltIdx);</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *AT = dyn_cast&lt;ArrayType&gt;(T)) {</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    EltTy = AT-&gt;getElementType();</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    EltSize = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(EltTy);</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    <span class="keywordflow">if</span> (Offset &gt;= AT-&gt;getNumElements() * EltSize)</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    Offset %= EltSize;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *VT = dyn_cast&lt;VectorType&gt;(T)) {</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    EltTy = VT-&gt;getElementType();</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;    EltSize = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(EltTy);</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    <span class="keywordflow">if</span> (Offset &gt;= VT-&gt;getNumElements() * EltSize)</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    Offset %= EltSize;</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  }</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;  <span class="keywordflow">if</span> (Offset == 0 &amp;&amp; (Size == 0 || EltSize == Size))</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;  <span class="comment">// Check if the component spans multiple elements.</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;  <span class="keywordflow">if</span> (Offset + Size &gt; EltSize)</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;  <span class="keywordflow">return</span> TypeHasComponent(EltTy, Offset, Size);</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;}</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="comment">/// RewriteForScalarRepl - Alloca AI is being split into NewElts, so rewrite</span></div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="comment">/// the instruction I, which references it, to use the separate elements.</span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;<span class="comment">/// Offset indicates the position within AI that is referenced by this</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;<span class="comment">/// instruction.</span></div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> SROA::RewriteForScalarRepl(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I, <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI, uint64_t Offset,</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;                                <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;AllocaInst *&gt;</a> &amp;NewElts) {</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = I-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = I-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI!=E;) {</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;TheUse = UI.getUse();</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(*UI++);</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BC = dyn_cast&lt;BitCastInst&gt;(User)) {</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;      RewriteBitCast(BC, AI, Offset, NewElts);</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    }</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI = dyn_cast&lt;GetElementPtrInst&gt;(User)) {</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      RewriteGEP(GEPI, AI, Offset, NewElts);</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    }</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MemIntrinsic.html">MemIntrinsic</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> = dyn_cast&lt;MemIntrinsic&gt;(User)) {</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;      <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Length = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>-&gt;getLength());</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;      uint64_t MemSize = Length-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>();</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;      <span class="keywordflow">if</span> (Offset == 0 &amp;&amp;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;          MemSize == TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>()))</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;        RewriteMemIntrinUserOfAlloca(<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>, I, AI, NewElts);</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;      <span class="comment">// Otherwise the intrinsic can only touch a single element and the</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;      <span class="comment">// address operand will be updated, so nothing else needs to be done.</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;    }</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II = dyn_cast&lt;IntrinsicInst&gt;(User)) {</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;      <span class="keywordflow">if</span> (II-&gt;getIntrinsicID() == <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ae365354e47542c51f9bd46e329e3323e">Intrinsic::lifetime_start</a> ||</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;          II-&gt;getIntrinsicID() == <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90aa332b90dd5e4ebf4bbbcc0964220d373">Intrinsic::lifetime_end</a>) {</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;        RewriteLifetimeIntrinsic(II, AI, Offset, NewElts);</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;      }</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    }</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(User)) {</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *LIType = LI-&gt;getType();</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="ScalarReplAggregates_8cpp.html#aed0e85fc9abd34c5e7c4a96386d33007">isCompatibleAggregate</a>(LIType, AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>())) {</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <span class="comment">// Replace:</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        <span class="comment">//   %res = load { i32, i32 }* %alloc</span></div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;        <span class="comment">// with:</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        <span class="comment">//   %load.0 = load i32* %alloc.0</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;        <span class="comment">//   %insert.0 insertvalue { i32, i32 } zeroinitializer, i32 %load.0, 0</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;        <span class="comment">//   %load.1 = load i32* %alloc.1</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;        <span class="comment">//   %insert = insertvalue { i32, i32 } %insert.0, i32 %load.1, 1</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;        <span class="comment">// (Also works for arrays instead of structs)</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Insert = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(LIType);</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;        <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(LI);</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = NewElts.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1SPII.html#a11e9b8fca4a074643a6a21f444e51406a5069619ca8fdce305534f3fe85091a0f">Load</a> = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#af440b535b3b4e8d0d089dd0ed2283a0f">CreateLoad</a>(NewElts[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], <span class="stringliteral">&quot;load&quot;</span>);</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;          Insert = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a8bbeae6f9dd03923c7cf63a6ff9f4036">CreateInsertValue</a>(Insert, Load, i, <span class="stringliteral">&quot;insert&quot;</span>);</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;        }</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;        LI-&gt;replaceAllUsesWith(Insert);</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(LI);</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (LIType-&gt;<a class="code" href="classllvm_1_1Type.html#a6e328feb83afa5cf1c966d6704e43fc1">isIntegerTy</a>() &amp;&amp;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;                 TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(LIType) ==</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                 TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>())) {</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;        <span class="comment">// If this is a load of the entire alloca to an integer, rewrite it.</span></div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;        RewriteLoadUserOfWholeAlloca(LI, AI, NewElts);</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      }</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;    }</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(User)) {</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Val = SI-&gt;getOperand(0);</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *SIType = Val-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>();</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="ScalarReplAggregates_8cpp.html#aed0e85fc9abd34c5e7c4a96386d33007">isCompatibleAggregate</a>(SIType, AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>())) {</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;        <span class="comment">// Replace:</span></div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;        <span class="comment">//   store { i32, i32 } %val, { i32, i32 }* %alloc</span></div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;        <span class="comment">// with:</span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;        <span class="comment">//   %val.0 = extractvalue { i32, i32 } %val, 0</span></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;        <span class="comment">//   store i32 %val.0, i32* %alloc.0</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;        <span class="comment">//   %val.1 = extractvalue { i32, i32 } %val, 1</span></div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;        <span class="comment">//   store i32 %val.1, i32* %alloc.1</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;        <span class="comment">// (Also works for arrays instead of structs)</span></div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(SI);</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = NewElts.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *Extract = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a478d9db5034ad1bef340198c3aaf861a">CreateExtractValue</a>(Val, <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, Val-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>());</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;          Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a43f7fa52a3fbe01e44c40d9db278ab3e">CreateStore</a>(Extract, NewElts[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;        }</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;        DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SI);</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SIType-&gt;<a class="code" href="classllvm_1_1Type.html#a6e328feb83afa5cf1c966d6704e43fc1">isIntegerTy</a>() &amp;&amp;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;                 TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(SIType) ==</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;                 TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>())) {</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;        <span class="comment">// If this is a store of the entire alloca from an integer, rewrite it.</span></div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;        RewriteStoreUserOfWholeAlloca(SI, AI, NewElts);</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;      }</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    }</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    <span class="keywordflow">if</span> (isa&lt;SelectInst&gt;(User) || isa&lt;PHINode&gt;(User)) {</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;      <span class="comment">// If we have a PHI user of the alloca itself (as opposed to a GEP or</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;      <span class="comment">// bitcast) we have to rewrite it.  GEP and bitcast uses will be RAUW&#39;d to</span></div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;      <span class="comment">// the new pointer.</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;AllocaInst&gt;(I)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;      assert(Offset == 0 &amp;&amp; NewElts[0] &amp;&amp;</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;             <span class="stringliteral">&quot;Direct alloca use should have a zero offset&quot;</span>);</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;      <span class="comment">// If we have a use of the alloca, we know the derived uses will be</span></div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;      <span class="comment">// utilizing just the first element of the scalarized result.  Insert a</span></div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;      <span class="comment">// bitcast of the first alloca before the user as required.</span></div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;      <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *NewAI = NewElts[0];</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;      <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BCI = <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(NewAI, AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a597c918a615f26a0cea7adb84f06fc3f">getType</a>(), <span class="stringliteral">&quot;&quot;</span>, NewAI);</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;      NewAI-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(BCI);</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;      TheUse = BCI;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;    }</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;  }</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;}</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="comment">/// RewriteBitCast - Update a bitcast reference to the alloca being replaced</span></div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="comment">/// and recursively continue updating all of its uses.</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> SROA::RewriteBitCast(<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BC, <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI, uint64_t Offset,</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;                          <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;AllocaInst *&gt;</a> &amp;NewElts) {</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;  RewriteForScalarRepl(BC, AI, Offset, NewElts);</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;  <span class="keywordflow">if</span> (BC-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0) != AI)</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;  <span class="comment">// The bitcast references the original alloca.  Replace its uses with</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;  <span class="comment">// references to the alloca containing offset zero (which is normally at</span></div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;  <span class="comment">// index zero, but might not be in cases involving structs with elements</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;  <span class="comment">// of size zero).</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *T = AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>();</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;  uint64_t EltOffset = 0;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *IdxTy;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;  uint64_t Idx = FindElementAndOffset(T, EltOffset, IdxTy);</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Val = NewElts[Idx];</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;  <span class="keywordflow">if</span> (Val-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() != BC-&gt;<a class="code" href="classllvm_1_1CastInst.html#a1ff119ca13ef1b365ee0c9fa6e7fb861">getDestTy</a>()) {</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    Val = <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(Val, BC-&gt;<a class="code" href="classllvm_1_1CastInst.html#a1ff119ca13ef1b365ee0c9fa6e7fb861">getDestTy</a>(), <span class="stringliteral">&quot;&quot;</span>, BC);</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    Val-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(BC);</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;  }</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;  BC-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Val);</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;  DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(BC);</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;}</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="comment">/// FindElementAndOffset - Return the index of the element containing Offset</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="comment">/// within the specified type, which must be either a struct or an array.</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;<span class="comment">/// Sets T to the type of the element and Offset to the offset within that</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;<span class="comment">/// element.  IdxTy is set to the type of the index result to be used in a</span></div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;<span class="comment">/// GEP instruction.</span></div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;<span class="comment"></span>uint64_t SROA::FindElementAndOffset(<a class="code" href="classllvm_1_1Type.html">Type</a> *&amp;T, uint64_t &amp;Offset,</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;                                    <a class="code" href="classllvm_1_1Type.html">Type</a> *&amp;IdxTy) {</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;  uint64_t Idx = 0;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *ST = dyn_cast&lt;StructType&gt;(T)) {</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1StructLayout.html">StructLayout</a> *Layout = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a35c840104f32575e0d91422cf1ef3ce4">getStructLayout</a>(ST);</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    Idx = Layout-&gt;<a class="code" href="classllvm_1_1StructLayout.html#a795cfd43d30c44c33b97fe850bc0451f">getElementContainingOffset</a>(Offset);</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;    T = ST-&gt;<a class="code" href="classllvm_1_1Type.html#a1e2a8dc174c34596e7e8efc7ab7e08a0">getContainedType</a>(Idx);</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    Offset -= Layout-&gt;<a class="code" href="classllvm_1_1StructLayout.html#ae10c4483372a357a0d3411b3d64be10c">getElementOffset</a>(Idx);</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    IdxTy = <a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(T-&gt;<a class="code" href="classllvm_1_1Type.html#af348d5ea83429d08ba891ca3dd0e92b2">getContext</a>());</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    <span class="keywordflow">return</span> Idx;</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *AT = dyn_cast&lt;ArrayType&gt;(T)) {</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    T = AT-&gt;getElementType();</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    uint64_t EltSize = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(T);</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    Idx = Offset / EltSize;</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    Offset -= Idx * EltSize;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    IdxTy = <a class="code" href="classllvm_1_1Type.html#a05186fa23e4d11b9855a9599ba87a4b7">Type::getInt64Ty</a>(T-&gt;<a class="code" href="classllvm_1_1Type.html#af348d5ea83429d08ba891ca3dd0e92b2">getContext</a>());</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    <span class="keywordflow">return</span> Idx;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;  }</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;  <a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *VT = cast&lt;VectorType&gt;(<a class="code" href="Mips16ISelLowering_8cpp.html#a0acb682b8260ab1c60b918599864e2e5">T</a>);</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;  T = VT-&gt;<a class="code" href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">getElementType</a>();</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;  uint64_t EltSize = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(T);</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;  Idx = Offset / EltSize;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;  Offset -= Idx * EltSize;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;  IdxTy = <a class="code" href="classllvm_1_1Type.html#a05186fa23e4d11b9855a9599ba87a4b7">Type::getInt64Ty</a>(T-&gt;getContext());</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;  <span class="keywordflow">return</span> Idx;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;}</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="comment">/// RewriteGEP - Check if this GEP instruction moves the pointer across</span></div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="comment">/// elements of the alloca that are being split apart, and if so, rewrite</span></div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;<span class="comment">/// the GEP to be relative to the new element.</span></div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> SROA::RewriteGEP(<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI, <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI, uint64_t Offset,</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;                      <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;AllocaInst *&gt;</a> &amp;NewElts) {</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;  uint64_t OldOffset = Offset;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 8&gt;</a> Indices(GEPI-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>() + 1, GEPI-&gt;<a class="code" href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">op_end</a>());</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;  <span class="comment">// If the GEP was dynamic then it must have been a dynamic vector lookup.</span></div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;  <span class="comment">// In this case, it must be the last GEP operand which is dynamic so keep that</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;  <span class="comment">// aside until we&#39;ve found the constant GEP offset then add it back in at the</span></div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;  <span class="comment">// end.</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a>* NonConstantIdx = 0;</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;  <span class="keywordflow">if</span> (!GEPI-&gt;<a class="code" href="classllvm_1_1GetElementPtrInst.html#a933a0843a97a4ef41022634d9a557de9">hasAllConstantIndices</a>())</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    NonConstantIdx = Indices.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;  Offset += TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#af81977584678ef1ff229fcf2f1b69b2b">getIndexedOffset</a>(GEPI-&gt;<a class="code" href="classllvm_1_1GetElementPtrInst.html#a7400b6ae12470abc8ea6e18e171016b2">getPointerOperandType</a>(), Indices);</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;  RewriteForScalarRepl(GEPI, AI, Offset, NewElts);</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *T = AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>();</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *IdxTy;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;  uint64_t OldIdx = FindElementAndOffset(T, OldOffset, IdxTy);</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;  <span class="keywordflow">if</span> (GEPI-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0) == AI)</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;    OldIdx = ~0ULL; <span class="comment">// Force the GEP to be rewritten.</span></div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;  T = AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>();</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;  uint64_t EltOffset = Offset;</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;  uint64_t Idx = FindElementAndOffset(T, EltOffset, IdxTy);</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;  <span class="comment">// If this GEP does not move the pointer across elements of the alloca</span></div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;  <span class="comment">// being split, then it does not needs to be rewritten.</span></div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;  <span class="keywordflow">if</span> (Idx == OldIdx)</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *i32Ty = <a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(AI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>());</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 8&gt;</a> NewArgs;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;  NewArgs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(<a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(i32Ty));</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;  <span class="keywordflow">while</span> (EltOffset != 0) {</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    uint64_t EltIdx = FindElementAndOffset(T, EltOffset, IdxTy);</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    NewArgs.push_back(<a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(IdxTy, EltIdx));</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;  }</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;  <span class="keywordflow">if</span> (NonConstantIdx) {</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a>* GepTy = <a class="code" href="Mips16ISelLowering_8cpp.html#a0acb682b8260ab1c60b918599864e2e5">T</a>;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;    <span class="comment">// This GEP has a dynamic index.  We need to add &quot;i32 0&quot; to index through</span></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;    <span class="comment">// any structs or arrays in the original type until we get to the vector</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;    <span class="comment">// to index.</span></div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    <span class="keywordflow">while</span> (!isa&lt;VectorType&gt;(GepTy)) {</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;      NewArgs.push_back(<a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(i32Ty));</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;      GepTy = cast&lt;CompositeType&gt;(GepTy)-&gt;getTypeAtIndex(0U);</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;    }</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    NewArgs.push_back(NonConstantIdx);</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;  }</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Val = NewElts[Idx];</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;  <span class="keywordflow">if</span> (NewArgs.size() &gt; 1) {</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;    Val = <a class="code" href="classllvm_1_1GetElementPtrInst.html#a3e10b4db1ded36654416d3aed2bc56ba">GetElementPtrInst::CreateInBounds</a>(Val, NewArgs, <span class="stringliteral">&quot;&quot;</span>, GEPI);</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;    Val-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(GEPI);</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;  }</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;  <span class="keywordflow">if</span> (Val-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() != GEPI-&gt;<a class="code" href="classllvm_1_1GetElementPtrInst.html#abfc8f5fb56fb06e32a26f28ba7ec1c0b">getType</a>())</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    Val = <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(Val, GEPI-&gt;<a class="code" href="classllvm_1_1GetElementPtrInst.html#abfc8f5fb56fb06e32a26f28ba7ec1c0b">getType</a>(), Val-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>(), GEPI);</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;  GEPI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Val);</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;  DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(GEPI);</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;}</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;<span class="comment">/// RewriteLifetimeIntrinsic - II is a lifetime.start/lifetime.end. Rewrite it</span></div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;<span class="comment">/// to mark the lifetime of the scalarized memory.</span></div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> SROA::RewriteLifetimeIntrinsic(<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II, <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI,</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;                                    uint64_t Offset,</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;                                    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;AllocaInst *&gt;</a> &amp;NewElts) {</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *OldSize = cast&lt;ConstantInt&gt;(II-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(0));</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;  <span class="comment">// Put matching lifetime markers on everything from Offset up to</span></div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;  <span class="comment">// Offset+OldSize.</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *AIType = AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>();</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;  uint64_t NewOffset = Offset;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *IdxTy;</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;  uint64_t Idx = FindElementAndOffset(AIType, NewOffset, IdxTy);</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(II);</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;  uint64_t Size = OldSize-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a024bb83a7f01e7661ea72ff7dcc460f5">getLimitedValue</a>();</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;  <span class="keywordflow">if</span> (NewOffset) {</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;    <span class="comment">// Splice the first element and index &#39;NewOffset&#39; bytes in.  SROA will</span></div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;    <span class="comment">// split the alloca again later.</span></div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a87b363b9dad9f5040ea7e29ea9e60ff5">CreateBitCast</a>(NewElts[Idx], Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a7badbb741cd23e73ad063428c9cd5fea">getInt8PtrTy</a>());</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;    V = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#ac46176b523c8a76a9ccdb5683279db94">CreateGEP</a>(V, Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a675da14f55ad277eae001b705c42be8b">getInt64</a>(NewOffset));</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;    IdxTy = NewElts[Idx]-&gt;getAllocatedType();</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    uint64_t EltSize = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(IdxTy) - NewOffset;</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;    <span class="keywordflow">if</span> (EltSize &gt; Size) {</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;      EltSize = Size;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;      Size = 0;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;      Size -= EltSize;</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    }</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;    <span class="keywordflow">if</span> (II-&gt;<a class="code" href="classllvm_1_1IntrinsicInst.html#a6cbb4809b81f3994ee0c79b38556bd66">getIntrinsicID</a>() == <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ae365354e47542c51f9bd46e329e3323e">Intrinsic::lifetime_start</a>)</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;      Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a9a1fcb8473324a0f50ce3ddb823054c2">CreateLifetimeStart</a>(V, Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a675da14f55ad277eae001b705c42be8b">getInt64</a>(EltSize));</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;      Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a9b1be210e6549573e2e46105c671d0be">CreateLifetimeEnd</a>(V, Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a675da14f55ad277eae001b705c42be8b">getInt64</a>(EltSize));</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;    ++Idx;</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;  }</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;  <span class="keywordflow">for</span> (; Idx != NewElts.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() &amp;&amp; Size; ++Idx) {</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;    IdxTy = NewElts[Idx]-&gt;getAllocatedType();</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;    uint64_t EltSize = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(IdxTy);</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    <span class="keywordflow">if</span> (EltSize &gt; Size) {</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;      EltSize = Size;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;      Size = 0;</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;      Size -= EltSize;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;    }</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;    <span class="keywordflow">if</span> (II-&gt;<a class="code" href="classllvm_1_1IntrinsicInst.html#a6cbb4809b81f3994ee0c79b38556bd66">getIntrinsicID</a>() == <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ae365354e47542c51f9bd46e329e3323e">Intrinsic::lifetime_start</a>)</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;      Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a9a1fcb8473324a0f50ce3ddb823054c2">CreateLifetimeStart</a>(NewElts[Idx],</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;                                  Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a675da14f55ad277eae001b705c42be8b">getInt64</a>(EltSize));</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;      Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a9b1be210e6549573e2e46105c671d0be">CreateLifetimeEnd</a>(NewElts[Idx],</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;                                Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a675da14f55ad277eae001b705c42be8b">getInt64</a>(EltSize));</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;  }</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;  DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(II);</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;}</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;<span class="comment">/// RewriteMemIntrinUserOfAlloca - MI is a memcpy/memset/memmove from or to AI.</span></div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;<span class="comment">/// Rewrite it to copy or set the elements of the scalarized memory.</span></div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;<span class="comment"></span><span class="keywordtype">void</span></div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;SROA::RewriteMemIntrinUserOfAlloca(<a class="code" href="classllvm_1_1MemIntrinsic.html">MemIntrinsic</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst,</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                                   <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI,</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;                                   <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;AllocaInst *&gt;</a> &amp;NewElts) {</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;  <span class="comment">// If this is a memcpy/memmove, construct the other pointer as the</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;  <span class="comment">// appropriate type.  The &quot;Other&quot; pointer is the pointer that goes to memory</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;  <span class="comment">// that doesn&#39;t have anything to do with the alloca that we are promoting. For</span></div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;  <span class="comment">// memset, this Value* stays null.</span></div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *OtherPtr = 0;</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;  <span class="keywordtype">unsigned</span> MemAlignment = MI-&gt;<a class="code" href="classllvm_1_1MemIntrinsic.html#a42dd65db3521498f10afb8c6f66e1bb5">getAlignment</a>();</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MemTransferInst.html">MemTransferInst</a> *MTI = dyn_cast&lt;MemTransferInst&gt;(MI)) { <span class="comment">// memmove/memcopy</span></div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    <span class="keywordflow">if</span> (Inst == MTI-&gt;getRawDest())</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;      OtherPtr = MTI-&gt;getRawSource();</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;      assert(Inst == MTI-&gt;getRawSource());</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;      OtherPtr = MTI-&gt;getRawDest();</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    }</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;  }</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;  <span class="comment">// If there is an other pointer, we want to convert it to the same pointer</span></div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;  <span class="comment">// type as AI has, so we can GEP through it safely.</span></div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;  <span class="keywordflow">if</span> (OtherPtr) {</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    <span class="keywordtype">unsigned</span> AddrSpace =</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;      cast&lt;PointerType&gt;(OtherPtr-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())-&gt;getAddressSpace();</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    <span class="comment">// Remove bitcasts and all-zero GEPs from OtherPtr.  This is an</span></div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    <span class="comment">// optimization, but it&#39;s also required to detect the corner case where</span></div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;    <span class="comment">// both pointer operands are referencing the same memory, and where</span></div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    <span class="comment">// OtherPtr may be a bitcast or GEP that currently being rewritten.  (This</span></div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;    <span class="comment">// function is only called for mem intrinsics that access the whole</span></div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    <span class="comment">// aggregate, so non-zero GEPs are not an issue here.)</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    OtherPtr = OtherPtr-&gt;<a class="code" href="classllvm_1_1Value.html#a38ea12c04523d63adda732b9c5d6da0a">stripPointerCasts</a>();</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    <span class="comment">// Copying the alloca to itself is a no-op: just delete it.</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;    <span class="keywordflow">if</span> (OtherPtr == AI || OtherPtr == NewElts[0]) {</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;      <span class="comment">// This code will run twice for a no-op memcpy -- once for each operand.</span></div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;      <span class="comment">// Put only one reference to MI on the DeadInsts list.</span></div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value *&gt;::const_iterator</a> I = DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(),</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;             E = DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        <span class="keywordflow">if</span> (*I == MI) <span class="keywordflow">return</span>;</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;      DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(MI);</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    }</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    <span class="comment">// If the pointer is not the right type, insert a bitcast to the right</span></div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    <span class="comment">// type.</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *NewTy =</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;      <a class="code" href="classllvm_1_1PointerType.html#a050a395d1656e546679d8b144d951bb2">PointerType::get</a>(AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a597c918a615f26a0cea7adb84f06fc3f">getType</a>()-&gt;<a class="code" href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">getElementType</a>(), AddrSpace);</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;    <span class="keywordflow">if</span> (OtherPtr-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() != NewTy)</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;      OtherPtr = <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(OtherPtr, NewTy, OtherPtr-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>(), <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>);</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;  }</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;  <span class="comment">// Process each element of the aggregate.</span></div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;  <span class="keywordtype">bool</span> SROADest = MI-&gt;<a class="code" href="classllvm_1_1MemIntrinsic.html#a3ec0c47a5532e568d54c8d452dfb58df">getRawDest</a>() == Inst;</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Zero = <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(MI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()));</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = NewElts.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;    <span class="comment">// If this is a memcpy/memmove, emit a GEP of the other element address.</span></div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OtherElt = 0;</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;    <span class="keywordtype">unsigned</span> OtherEltAlign = MemAlignment;</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;    <span class="keywordflow">if</span> (OtherPtr) {</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Idx[2] = { Zero,</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;                      <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(<a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(MI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()), <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) };</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;      OtherElt = <a class="code" href="classllvm_1_1GetElementPtrInst.html#a3e10b4db1ded36654416d3aed2bc56ba">GetElementPtrInst::CreateInBounds</a>(OtherPtr, Idx,</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;                                              OtherPtr-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.&quot;</span>+<a class="code" href="classllvm_1_1Twine.html">Twine</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>),</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;                                                   <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>);</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;      uint64_t EltOffset;</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;      <a class="code" href="classllvm_1_1PointerType.html">PointerType</a> *OtherPtrTy = cast&lt;PointerType&gt;(OtherPtr-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *OtherTy = OtherPtrTy-&gt;<a class="code" href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">getElementType</a>();</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *ST = dyn_cast&lt;StructType&gt;(OtherTy)) {</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;        EltOffset = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a35c840104f32575e0d91422cf1ef3ce4">getStructLayout</a>(ST)-&gt;<a class="code" href="classllvm_1_1StructLayout.html#ae10c4483372a357a0d3411b3d64be10c">getElementOffset</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;        <a class="code" href="classllvm_1_1Type.html">Type</a> *EltTy = cast&lt;SequentialType&gt;(OtherTy)-&gt;getElementType();</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;        EltOffset = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(EltTy)*<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;      }</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;      <span class="comment">// The alignment of the other pointer is the guaranteed alignment of the</span></div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;      <span class="comment">// element, which is affected by both the known alignment of the whole</span></div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;      <span class="comment">// mem intrinsic and the alignment of the element.  If the alignment of</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;      <span class="comment">// the memcpy (f.e.) is 32 but the element is at a 4-byte offset, then the</span></div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;      <span class="comment">// known alignment is just 4 bytes.</span></div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;      OtherEltAlign = (unsigned)<a class="code" href="namespacellvm.html#af36d7e69ab16b64b2e3a48c83aa9f0f6">MinAlign</a>(OtherEltAlign, EltOffset);</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    }</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *EltPtr = NewElts[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *EltTy = cast&lt;PointerType&gt;(EltPtr-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())-&gt;getElementType();</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;    <span class="comment">// If we got down to a scalar, insert a load or store as appropriate.</span></div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;    <span class="keywordflow">if</span> (EltTy-&gt;<a class="code" href="classllvm_1_1Type.html#a36e21267fe14e69d3251eab1cd3a0076">isSingleValueType</a>()) {</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;      <span class="keywordflow">if</span> (isa&lt;MemTransferInst&gt;(MI)) {</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;        <span class="keywordflow">if</span> (SROADest) {</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;          <span class="comment">// From Other to Alloca.</span></div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *Elt = <span class="keyword">new</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>(OtherElt, <span class="stringliteral">&quot;tmp&quot;</span>, <span class="keyword">false</span>, OtherEltAlign, MI);</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;          <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(Elt, EltPtr, MI);</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;          <span class="comment">// From Alloca to Other.</span></div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *Elt = <span class="keyword">new</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>(EltPtr, <span class="stringliteral">&quot;tmp&quot;</span>, MI);</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;          <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(Elt, OtherElt, <span class="keyword">false</span>, OtherEltAlign, MI);</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;        }</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;      }</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;      assert(isa&lt;MemSetInst&gt;(MI));</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;      <span class="comment">// If the stored element is zero (common case), just store a null</span></div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;      <span class="comment">// constant.</span></div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *StoreVal;</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = dyn_cast&lt;ConstantInt&gt;(MI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(1))) {</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;        <span class="keywordflow">if</span> (CI-&gt;isZero()) {</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;          StoreVal = <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(EltTy);  <span class="comment">// 0.0, null, 0, &lt;0,0&gt;</span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;          <span class="comment">// If EltTy is a vector type, get the element type.</span></div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;          <a class="code" href="classllvm_1_1Type.html">Type</a> *ValTy = EltTy-&gt;<a class="code" href="classllvm_1_1Type.html#a8eafa71cf399da8f21b2af5549f3f9e7">getScalarType</a>();</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;          <span class="comment">// Construct an integer with the right value.</span></div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;          <span class="keywordtype">unsigned</span> EltSize = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">getTypeSizeInBits</a>(ValTy);</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;          <a class="code" href="classllvm_1_1APInt.html">APInt</a> OneVal(EltSize, CI-&gt;getZExtValue());</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;          <a class="code" href="classllvm_1_1APInt.html">APInt</a> TotalVal(OneVal);</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;          <span class="comment">// Set each byte.</span></div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; 8*<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; EltSize; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;            TotalVal = TotalVal.shl(8);</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;            TotalVal |= OneVal;</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;          }</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;          <span class="comment">// Convert the integer value to the appropriate type.</span></div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;          StoreVal = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(CI-&gt;getContext(), TotalVal);</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;          <span class="keywordflow">if</span> (ValTy-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>())</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;            StoreVal = <a class="code" href="classllvm_1_1ConstantExpr.html#a15e279291892399c141cd01c7e358cbf">ConstantExpr::getIntToPtr</a>(StoreVal, ValTy);</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ValTy-&gt;<a class="code" href="classllvm_1_1Type.html#a40113570b0c52a18c34cabed8359e2c8">isFloatingPointTy</a>())</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;            StoreVal = <a class="code" href="classllvm_1_1ConstantExpr.html#aba93ec4079f8d709a1d5b4745310782e">ConstantExpr::getBitCast</a>(StoreVal, ValTy);</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;          assert(StoreVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() == ValTy &amp;&amp; <span class="stringliteral">&quot;Type mismatch!&quot;</span>);</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;          <span class="comment">// If the requested value was a vector constant, create it.</span></div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;          <span class="keywordflow">if</span> (EltTy-&gt;<a class="code" href="classllvm_1_1Type.html#a6f725580f7834e2ca90762965866dad4">isVectorTy</a>()) {</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;            <span class="keywordtype">unsigned</span> NumElts = cast&lt;VectorType&gt;(EltTy)-&gt;getNumElements();</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;            StoreVal = <a class="code" href="classllvm_1_1ConstantVector.html#a5ce0c10fc8f570a6411da209203a1c6e">ConstantVector::getSplat</a>(NumElts, StoreVal);</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;          }</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;        }</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;        <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(StoreVal, EltPtr, MI);</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;      }</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;      <span class="comment">// Otherwise, if we&#39;re storing a byte variable, use a memset call for</span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;      <span class="comment">// this element.</span></div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;    }</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    <span class="keywordtype">unsigned</span> EltSize = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(EltTy);</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;    <span class="keywordflow">if</span> (!EltSize)</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;    <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(MI);</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;    <span class="comment">// Finally, insert the meminst for this element.</span></div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;    <span class="keywordflow">if</span> (isa&lt;MemSetInst&gt;(MI)) {</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;      Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a58f62481bd3a4bfc5d07102fe857741a">CreateMemSet</a>(EltPtr, MI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(1), EltSize,</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;                           MI-&gt;<a class="code" href="classllvm_1_1MemIntrinsic.html#a9558faebdbb62c072aed98e33604889d">isVolatile</a>());</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;      assert(isa&lt;MemTransferInst&gt;(MI));</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Dst = SROADest ? EltPtr : OtherElt;  <span class="comment">// Dest ptr</span></div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Src = SROADest ? OtherElt : EltPtr;  <span class="comment">// Src ptr</span></div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;      <span class="keywordflow">if</span> (isa&lt;MemCpyInst&gt;(MI))</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;        Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a849b50da820a274b4d001fbeadaf5cd7">CreateMemCpy</a>(Dst, Src, EltSize, OtherEltAlign,MI-&gt;<a class="code" href="classllvm_1_1MemIntrinsic.html#a9558faebdbb62c072aed98e33604889d">isVolatile</a>());</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;        Builder.<a class="code" href="classllvm_1_1IRBuilderBase.html#a248295120710baf72dbbd3a862c840e4">CreateMemMove</a>(Dst, Src, EltSize,OtherEltAlign,MI-&gt;<a class="code" href="classllvm_1_1MemIntrinsic.html#a9558faebdbb62c072aed98e33604889d">isVolatile</a>());</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;    }</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;  }</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;  DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(MI);</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;}</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;<span class="comment">/// RewriteStoreUserOfWholeAlloca - We found a store of an integer that</span></div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;<span class="comment">/// overwrites the entire allocation.  Extract out the pieces of the stored</span></div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;<span class="comment">/// integer and store them individually.</span></div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;<span class="comment"></span><span class="keywordtype">void</span></div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;SROA::RewriteStoreUserOfWholeAlloca(<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI, <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI,</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;                                    <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;AllocaInst *&gt;</a> &amp;NewElts) {</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;  <span class="comment">// Extract each element out of the integer according to its structure offset</span></div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;  <span class="comment">// and store the element value to the individual alloca.</span></div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *SrcVal = SI-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0);</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *AllocaEltTy = AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>();</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;  uint64_t AllocaSizeBits = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#ab9c1bc49a2be2d26ca426b2ec23d6cf5">getTypeAllocSizeInBits</a>(AllocaEltTy);</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(SI);</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;  <span class="comment">// Handle tail padding by extending the operand</span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;  <span class="keywordflow">if</span> (TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">getTypeSizeInBits</a>(SrcVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()) != AllocaSizeBits)</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;    SrcVal = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a277dfeaad2a2ada72a6024b0eedc5301">CreateZExt</a>(SrcVal,</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;                            <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(SI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), AllocaSizeBits));</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;PROMOTING STORE TO WHOLE ALLOCA: &quot;</span> &lt;&lt; *AI &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; *SI</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;               &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;  <span class="comment">// There are two forms here: AI could be an array or struct.  Both cases</span></div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;  <span class="comment">// have different ways to compute the element offset.</span></div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *EltSTy = dyn_cast&lt;StructType&gt;(AllocaEltTy)) {</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1StructLayout.html">StructLayout</a> *Layout = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a35c840104f32575e0d91422cf1ef3ce4">getStructLayout</a>(EltSTy);</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = NewElts.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;      <span class="comment">// Get the number of bits to shift SrcVal to get the value.</span></div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *FieldTy = EltSTy-&gt;getElementType(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;      uint64_t <a class="code" href="Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a> = Layout-&gt;<a class="code" href="classllvm_1_1StructLayout.html#a05c049a3bc016b91dddf9ab5433855bb">getElementOffsetInBits</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;      <span class="keywordflow">if</span> (TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a9b876cc57d1884621f481b26b0892633">isBigEndian</a>())</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;        Shift = AllocaSizeBits-Shift-TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#ab9c1bc49a2be2d26ca426b2ec23d6cf5">getTypeAllocSizeInBits</a>(FieldTy);</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *EltVal = SrcVal;</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;      <span class="keywordflow">if</span> (Shift) {</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *ShiftVal = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(EltVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), <a class="code" href="Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>);</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;        EltVal = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a3f8c45ea10c393433221a508b750dcd5">CreateLShr</a>(EltVal, ShiftVal, <span class="stringliteral">&quot;sroa.store.elt&quot;</span>);</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;      }</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;      <span class="comment">// Truncate down to an integer of the right size.</span></div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;      uint64_t FieldSizeBits = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">getTypeSizeInBits</a>(FieldTy);</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;      <span class="comment">// Ignore zero sized fields like {}, they obviously contain no data.</span></div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;      <span class="keywordflow">if</span> (FieldSizeBits == 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;      <span class="keywordflow">if</span> (FieldSizeBits != AllocaSizeBits)</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;        EltVal = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#aa933549689e79685bb67de64dddc9f7c">CreateTrunc</a>(EltVal,</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;                             <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(SI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), FieldSizeBits));</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *DestField = NewElts[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;      <span class="keywordflow">if</span> (EltVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() == FieldTy) {</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;        <span class="comment">// Storing to an integer field of this size, just do it.</span></div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (FieldTy-&gt;<a class="code" href="classllvm_1_1Type.html#a40113570b0c52a18c34cabed8359e2c8">isFloatingPointTy</a>() || FieldTy-&gt;<a class="code" href="classllvm_1_1Type.html#a6f725580f7834e2ca90762965866dad4">isVectorTy</a>()) {</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;        <span class="comment">// Bitcast to the right element type (for fp/vector values).</span></div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;        EltVal = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a87b363b9dad9f5040ea7e29ea9e60ff5">CreateBitCast</a>(EltVal, FieldTy);</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;        <span class="comment">// Otherwise, bitcast the dest pointer (for aggregates).</span></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;        DestField = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a87b363b9dad9f5040ea7e29ea9e60ff5">CreateBitCast</a>(DestField,</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;                                     <a class="code" href="classllvm_1_1PointerType.html#a8db49fd5069f21d514e7bb0fd11f0902">PointerType::getUnqual</a>(EltVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()));</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;      }</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;      <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(EltVal, DestField, SI);</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;    }</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;    <a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *ATy = cast&lt;ArrayType&gt;(AllocaEltTy);</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *ArrayEltTy = ATy-&gt;<a class="code" href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">getElementType</a>();</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;    uint64_t ElementOffset = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#ab9c1bc49a2be2d26ca426b2ec23d6cf5">getTypeAllocSizeInBits</a>(ArrayEltTy);</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;    uint64_t ElementSizeBits = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">getTypeSizeInBits</a>(ArrayEltTy);</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;    uint64_t <a class="code" href="Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>;</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;    <span class="keywordflow">if</span> (TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a9b876cc57d1884621f481b26b0892633">isBigEndian</a>())</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;      Shift = AllocaSizeBits-ElementOffset;</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;      Shift = 0;</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = NewElts.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;      <span class="comment">// Ignore zero sized fields like {}, they obviously contain no data.</span></div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;      <span class="keywordflow">if</span> (ElementSizeBits == 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *EltVal = SrcVal;</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;      <span class="keywordflow">if</span> (Shift) {</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *ShiftVal = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(EltVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), <a class="code" href="Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>);</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;        EltVal = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a3f8c45ea10c393433221a508b750dcd5">CreateLShr</a>(EltVal, ShiftVal, <span class="stringliteral">&quot;sroa.store.elt&quot;</span>);</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;      }</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;      <span class="comment">// Truncate down to an integer of the right size.</span></div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;      <span class="keywordflow">if</span> (ElementSizeBits != AllocaSizeBits)</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;        EltVal = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#aa933549689e79685bb67de64dddc9f7c">CreateTrunc</a>(EltVal,</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;                                     <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(SI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(),</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;                                                      ElementSizeBits));</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *DestField = NewElts[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;      <span class="keywordflow">if</span> (EltVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() == ArrayEltTy) {</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;        <span class="comment">// Storing to an integer field of this size, just do it.</span></div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ArrayEltTy-&gt;isFloatingPointTy() ||</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;                 ArrayEltTy-&gt;isVectorTy()) {</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;        <span class="comment">// Bitcast to the right element type (for fp/vector values).</span></div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;        EltVal = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a87b363b9dad9f5040ea7e29ea9e60ff5">CreateBitCast</a>(EltVal, ArrayEltTy);</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;        <span class="comment">// Otherwise, bitcast the dest pointer (for aggregates).</span></div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;        DestField = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a87b363b9dad9f5040ea7e29ea9e60ff5">CreateBitCast</a>(DestField,</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;                                     <a class="code" href="classllvm_1_1PointerType.html#a8db49fd5069f21d514e7bb0fd11f0902">PointerType::getUnqual</a>(EltVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()));</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;      }</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;      <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(EltVal, DestField, SI);</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      <span class="keywordflow">if</span> (TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a9b876cc57d1884621f481b26b0892633">isBigEndian</a>())</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;        Shift -= ElementOffset;</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;        Shift += ElementOffset;</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;    }</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;  }</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;  DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SI);</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;}</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;<span class="comment">/// RewriteLoadUserOfWholeAlloca - We found a load of the entire allocation to</span></div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;<span class="comment">/// an integer.  Load the individual pieces to form the aggregate value.</span></div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;<span class="comment"></span><span class="keywordtype">void</span></div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;SROA::RewriteLoadUserOfWholeAlloca(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI, <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI,</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;                                   <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;AllocaInst *&gt;</a> &amp;NewElts) {</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;  <span class="comment">// Extract each element out of the NewElts according to its structure offset</span></div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;  <span class="comment">// and form the result value.</span></div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *AllocaEltTy = AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>();</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;  uint64_t AllocaSizeBits = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#ab9c1bc49a2be2d26ca426b2ec23d6cf5">getTypeAllocSizeInBits</a>(AllocaEltTy);</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;PROMOTING LOAD OF WHOLE ALLOCA: &quot;</span> &lt;&lt; *AI &lt;&lt; <span class="charliteral">&#39;\n&#39;</span> &lt;&lt; *LI</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;               &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  <span class="comment">// There are two forms here: AI could be an array or struct.  Both cases</span></div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;  <span class="comment">// have different ways to compute the element offset.</span></div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1StructLayout.html">StructLayout</a> *Layout = 0;</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;  uint64_t ArrayEltBitOffset = 0;</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *EltSTy = dyn_cast&lt;StructType&gt;(AllocaEltTy)) {</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;    Layout = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a35c840104f32575e0d91422cf1ef3ce4">getStructLayout</a>(EltSTy);</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *ArrayEltTy = cast&lt;ArrayType&gt;(AllocaEltTy)-&gt;getElementType();</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;    ArrayEltBitOffset = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#ab9c1bc49a2be2d26ca426b2ec23d6cf5">getTypeAllocSizeInBits</a>(ArrayEltTy);</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;  }</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *ResultVal =</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;    <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(LI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), AllocaSizeBits));</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = NewElts.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;    <span class="comment">// Load the value from the alloca.  If the NewElt is an aggregate, cast</span></div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;    <span class="comment">// the pointer to an integer of the same size before doing the load.</span></div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *SrcField = NewElts[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *FieldTy =</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;      cast&lt;PointerType&gt;(SrcField-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())-&gt;getElementType();</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;    uint64_t FieldSizeBits = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">getTypeSizeInBits</a>(FieldTy);</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;    <span class="comment">// Ignore zero sized fields like {}, they obviously contain no data.</span></div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;    <span class="keywordflow">if</span> (FieldSizeBits == 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;    <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *FieldIntTy = <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(LI-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(),</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;                                                     FieldSizeBits);</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;    <span class="keywordflow">if</span> (!FieldTy-&gt;<a class="code" href="classllvm_1_1Type.html#a6e328feb83afa5cf1c966d6704e43fc1">isIntegerTy</a>() &amp;&amp; !FieldTy-&gt;<a class="code" href="classllvm_1_1Type.html#a40113570b0c52a18c34cabed8359e2c8">isFloatingPointTy</a>() &amp;&amp;</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;        !FieldTy-&gt;<a class="code" href="classllvm_1_1Type.html#a6f725580f7834e2ca90762965866dad4">isVectorTy</a>())</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;      SrcField = <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(SrcField,</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;                                 <a class="code" href="classllvm_1_1PointerType.html#a8db49fd5069f21d514e7bb0fd11f0902">PointerType::getUnqual</a>(FieldIntTy),</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;                                 <span class="stringliteral">&quot;&quot;</span>, LI);</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    SrcField = <span class="keyword">new</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>(SrcField, <span class="stringliteral">&quot;sroa.load.elt&quot;</span>, LI);</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;    <span class="comment">// If SrcField is a fp or vector of the right size but that isn&#39;t an</span></div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;    <span class="comment">// integer type, bitcast to an integer so we can shift it.</span></div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;    <span class="keywordflow">if</span> (SrcField-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() != FieldIntTy)</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;      SrcField = <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(SrcField, FieldIntTy, <span class="stringliteral">&quot;&quot;</span>, LI);</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;    <span class="comment">// Zero extend the field to be the same size as the final alloca so that</span></div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;    <span class="comment">// we can shift and insert it.</span></div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;    <span class="keywordflow">if</span> (SrcField-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() != ResultVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;      SrcField = <span class="keyword">new</span> <a class="code" href="classllvm_1_1ZExtInst.html">ZExtInst</a>(SrcField, ResultVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), <span class="stringliteral">&quot;&quot;</span>, LI);</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;    <span class="comment">// Determine the number of bits to shift SrcField.</span></div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;    uint64_t <a class="code" href="Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>;</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;    <span class="keywordflow">if</span> (Layout) <span class="comment">// Struct case.</span></div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;      Shift = Layout-&gt;<a class="code" href="classllvm_1_1StructLayout.html#a05c049a3bc016b91dddf9ab5433855bb">getElementOffsetInBits</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;    <span class="keywordflow">else</span>  <span class="comment">// Array case.</span></div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;      Shift = <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>*ArrayEltBitOffset;</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;    <span class="keywordflow">if</span> (TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a9b876cc57d1884621f481b26b0892633">isBigEndian</a>())</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;      Shift = AllocaSizeBits-Shift-FieldIntTy-&gt;<a class="code" href="classllvm_1_1IntegerType.html#a6f603ab84f6f7c79985036f58cca9d48">getBitWidth</a>();</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;    <span class="keywordflow">if</span> (Shift) {</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *ShiftVal = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(SrcField-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), <a class="code" href="Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a>);</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;      SrcField = BinaryOperator::CreateShl(SrcField, ShiftVal, <span class="stringliteral">&quot;&quot;</span>, LI);</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;    }</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;    <span class="comment">// Don&#39;t create an &#39;or x, 0&#39; on the first iteration.</span></div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;Constant&gt;(ResultVal) ||</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;        !cast&lt;Constant&gt;(ResultVal)-&gt;isNullValue())</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;      ResultVal = BinaryOperator::CreateOr(SrcField, ResultVal, <span class="stringliteral">&quot;&quot;</span>, LI);</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;      ResultVal = SrcField;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;  }</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;  <span class="comment">// Handle tail padding by truncating the result</span></div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;  <span class="keywordflow">if</span> (TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">getTypeSizeInBits</a>(LI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()) != AllocaSizeBits)</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    ResultVal = <span class="keyword">new</span> <a class="code" href="classllvm_1_1TruncInst.html">TruncInst</a>(ResultVal, LI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), <span class="stringliteral">&quot;&quot;</span>, LI);</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;  LI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(ResultVal);</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;  DeadInsts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(LI);</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;}</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;<span class="comment">/// HasPadding - Return true if the specified type has any structure or</span></div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;<span class="comment">/// alignment padding in between the elements that would be split apart</span></div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;<span class="comment">/// by SROA; return false otherwise.</span></div><div class="line"><a name="l02534"></a><span class="lineno"><a class="line" href="ScalarReplAggregates_8cpp.html#a5cbfdaa36d24d28ff146ab89883eaba8"> 2534</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="ScalarReplAggregates_8cpp.html#a5cbfdaa36d24d28ff146ab89883eaba8">HasPadding</a>(<a class="code" href="classllvm_1_1Type.html">Type</a> *Ty, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;TD) {</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *ATy = dyn_cast&lt;ArrayType&gt;(Ty)) {</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;    Ty = ATy-&gt;getElementType();</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;    <span class="keywordflow">return</span> TD.<a class="code" href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">getTypeSizeInBits</a>(Ty) != TD.<a class="code" href="classllvm_1_1DataLayout.html#ab9c1bc49a2be2d26ca426b2ec23d6cf5">getTypeAllocSizeInBits</a>(Ty);</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;  }</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;  <span class="comment">// SROA currently handles only Arrays and Structs.</span></div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;  <a class="code" href="classllvm_1_1StructType.html">StructType</a> *STy = cast&lt;StructType&gt;(Ty);</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1StructLayout.html">StructLayout</a> *SL = TD.<a class="code" href="classllvm_1_1DataLayout.html#a35c840104f32575e0d91422cf1ef3ce4">getStructLayout</a>(STy);</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;  <span class="keywordtype">unsigned</span> PrevFieldBitOffset = 0;</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = STy-&gt;<a class="code" href="classllvm_1_1StructType.html#aa2113dcf8c96c19c9a2abf786b9ad3b7">getNumElements</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;    <span class="keywordtype">unsigned</span> FieldBitOffset = SL-&gt;<a class="code" href="classllvm_1_1StructLayout.html#a05c049a3bc016b91dddf9ab5433855bb">getElementOffsetInBits</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;    <span class="comment">// Check to see if there is any padding between this element and the</span></div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;    <span class="comment">// previous one.</span></div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;      <span class="keywordtype">unsigned</span> PrevFieldEnd =</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;        PrevFieldBitOffset+TD.<a class="code" href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">getTypeSizeInBits</a>(STy-&gt;<a class="code" href="classllvm_1_1StructType.html#a2f54639fcb5162f6f51192eb1697d2ad">getElementType</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>-1));</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;      <span class="keywordflow">if</span> (PrevFieldEnd &lt; FieldBitOffset)</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;    }</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;    PrevFieldBitOffset = FieldBitOffset;</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;  }</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;  <span class="comment">// Check for tail padding.</span></div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;  <span class="keywordflow">if</span> (<span class="keywordtype">unsigned</span> EltCount = STy-&gt;<a class="code" href="classllvm_1_1StructType.html#aa2113dcf8c96c19c9a2abf786b9ad3b7">getNumElements</a>()) {</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;    <span class="keywordtype">unsigned</span> PrevFieldEnd = PrevFieldBitOffset +</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;      TD.<a class="code" href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">getTypeSizeInBits</a>(STy-&gt;<a class="code" href="classllvm_1_1StructType.html#a2f54639fcb5162f6f51192eb1697d2ad">getElementType</a>(EltCount-1));</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;    <span class="keywordflow">if</span> (PrevFieldEnd &lt; SL-&gt;getSizeInBits())</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;  }</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;}</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;<span class="comment">/// isSafeStructAllocaToScalarRepl - Check to see if the specified allocation of</span></div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;<span class="comment">/// an aggregate can be broken down into elements.  Return 0 if not, 3 if safe,</span></div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;<span class="comment">/// or 1 if safe after canonicalization has been performed.</span></div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> SROA::isSafeAllocaToScalarRepl(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI) {</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;  <span class="comment">// Loop over the use list of the alloca.  We can only transform it if all of</span></div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;  <span class="comment">// the users are safe to transform.</span></div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;  AllocaInfo Info(AI);</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;  isSafeForScalarRepl(AI, 0, Info);</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;  <span class="keywordflow">if</span> (Info.isUnsafe) {</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Cannot transform: &quot;</span> &lt;&lt; *AI &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;  }</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;  <span class="comment">// Okay, we know all the users are promotable.  If the aggregate is a memcpy</span></div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;  <span class="comment">// source and destination, we have to be careful.  In particular, the memcpy</span></div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;  <span class="comment">// could be moving around elements that live in structure padding of the LLVM</span></div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;  <span class="comment">// types, but may actually be used.  In these cases, we refuse to promote the</span></div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;  <span class="comment">// struct.</span></div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;  <span class="keywordflow">if</span> (Info.isMemCpySrc &amp;&amp; Info.isMemCpyDst &amp;&amp;</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;      <a class="code" href="ScalarReplAggregates_8cpp.html#a5cbfdaa36d24d28ff146ab89883eaba8">HasPadding</a>(AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>(), *TD))</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;  <span class="comment">// If the alloca never has an access to just *part* of it, but is accessed</span></div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;  <span class="comment">// via loads and stores, then we should use ConvertToScalarInfo to promote</span></div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;  <span class="comment">// the alloca instead of promoting each piece at a time and inserting fission</span></div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;  <span class="comment">// and fusion code.</span></div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;  <span class="keywordflow">if</span> (!Info.hasSubelementAccess &amp;&amp; Info.hasALoadOrStore) {</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;    <span class="comment">// If the struct/array just has one element, use basic SRoA.</span></div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *ST = dyn_cast&lt;StructType&gt;(AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>())) {</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;      <span class="keywordflow">if</span> (ST-&gt;getNumElements() &gt; 1) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;      <span class="keywordflow">if</span> (cast&lt;ArrayType&gt;(AI-&gt;<a class="code" href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">getAllocatedType</a>())-&gt;getNumElements() &gt; 1)</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;    }</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;  }</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;}</div><div class="ttc" id="Target_2X86_2README_8txt_html_a1b0f9b510ec52cc3cbaa14e6e6211168"><div class="ttname"><a href="Target_2X86_2README_8txt.html#a1b0f9b510ec52cc3cbaa14e6e6211168">td</a></div><div class="ttdeci">gets compiled into this on rsp movaps rsp movaps rsp movaps rsp movaps rsp movaps rsp movaps rsp movaps rsp movaps rsp movq rsp movq rsp movq rsp movq rsp movq rsp rax movq rsp rax movq rsp rsp rsp eax eax jbe LBB1_3 rcx rax movq rsp eax rsp ret ecx eax rcx movl rsp jmp LBB1_2 gcc rsp rax movq rsp rsp movq rsp rax movq rsp eax eax jb L6 rdx eax rsp ret p2align edx rdx eax movl rsp eax rsp ret and it gets compiled into this on ebp esp eax movl ebp eax movl ebp eax esp popl ebp ret gcc ebp eax popl ebp ret Teach tblgen not to check bitconvert source type in some cases This allows us to consolidate the following patterns in X86InstrMMX td</div><div class="ttdef"><b>Definition:</b> <a href="Target_2X86_2README_8txt_source.html#l01367">Target/X86/README.txt:1367</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a3f8c45ea10c393433221a508b750dcd5"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a3f8c45ea10c393433221a508b750dcd5">llvm::IRBuilder::CreateLShr</a></div><div class="ttdeci">Value * CreateLShr(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;, bool isExact=false)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00753">IRBuilder.h:753</a></div></div>
<div class="ttc" id="classllvm_1_1MemIntrinsic_html_a42dd65db3521498f10afb8c6f66e1bb5"><div class="ttname"><a href="classllvm_1_1MemIntrinsic.html#a42dd65db3521498f10afb8c6f66e1bb5">llvm::MemIntrinsic::getAlignment</a></div><div class="ttdeci">unsigned getAlignment() const </div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00127">IntrinsicInst.h:127</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a075e34e98605d0e7c289763a104869ac"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">llvm::SmallVectorTemplateCommon&lt; T &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00114">SmallVector.h:114</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_ac46176b523c8a76a9ccdb5683279db94"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#ac46176b523c8a76a9ccdb5683279db94">llvm::IRBuilder::CreateGEP</a></div><div class="ttdeci">Value * CreateGEP(Value *Ptr, ArrayRef&lt; Value * &gt; IdxList, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00931">IRBuilder.h:931</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a22a311dfe4c28a897de8a9365a4f0a84"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">llvm::SmallVectorTemplateCommon&lt; T &gt;::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00127">SmallVector.h:127</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_ae1a10b90f22c0478960fb5798ff73916"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">llvm::SmallVectorTemplateBase&lt; T, isPodLike&lt; T &gt;::value &gt;::push_back</a></div><div class="ttdeci">void push_back(const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00236">SmallVector.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad86469939d2a8bdd4169be9403b89f5a"><div class="ttname"><a href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">llvm::Value::use_end</a></div><div class="ttdeci">use_iterator use_end()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00152">Value.h:152</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a73349916f7e54a6b988a3646c7a02e90aa332b90dd5e4ebf4bbbcc0964220d373"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90aa332b90dd5e4ebf4bbbcc0964220d373">llvm::Intrinsic::lifetime_end</a></div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l01254">Intrinsics.h:1254</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html"><div class="ttname"><a href="classllvm_1_1DataLayout.html">llvm::DataLayout</a></div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00098">DataLayout.h:98</a></div></div>
<div class="ttc" id="Loads_8h_html"><div class="ttname"><a href="Loads_8h.html">Loads.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARM__PROC_html_aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5"><div class="ttname"><a href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">llvm::ARM_PROC::A</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInfo_8h_source.html#l00098">ARMBaseInfo.h:98</a></div></div>
<div class="ttc" id="namespacellvm_1_1tgtok_html_abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac"><div class="ttname"><a href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">llvm::tgtok::In</a></div><div class="ttdef"><b>Definition:</b> <a href="TGLexer_8h_source.html#l00046">TGLexer.h:46</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a4786e64977a3af38f29adee46b70a863"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a4786e64977a3af38f29adee46b70a863">llvm::SmallVectorImpl::reserve</a></div><div class="ttdeci">void reserve(unsigned N)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00425">SmallVector.h:425</a></div></div>
<div class="ttc" id="classllvm_1_1SSAUpdater_html"><div class="ttname"><a href="classllvm_1_1SSAUpdater.html">llvm::SSAUpdater</a></div><div class="ttdoc">Helper class for SSA formation on a set of values defined in multiple blocks. </div><div class="ttdef"><b>Definition:</b> <a href="SSAUpdater_8h_source.html#l00037">SSAUpdater.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_af440b535b3b4e8d0d089dd0ed2283a0f"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#af440b535b3b4e8d0d089dd0ed2283a0f">llvm::IRBuilder::CreateLoad</a></div><div class="ttdeci">LoadInst * CreateLoad(Value *Ptr, const char *Name)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00879">IRBuilder.h:879</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a089cccb6f231efee72abc76d0f9c695f"><div class="ttname"><a href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">llvm::PHINode::addIncoming</a></div><div class="ttdeci">void addIncoming(Value *V, BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02100">Instructions.h:2100</a></div></div>
<div class="ttc" id="classllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00035">PassRegistry.cpp:35</a></div></div>
<div class="ttc" id="namespacellvm_1_1SPII_html_a11e9b8fca4a074643a6a21f444e51406a5069619ca8fdce305534f3fe85091a0f"><div class="ttname"><a href="namespacellvm_1_1SPII.html#a11e9b8fca4a074643a6a21f444e51406a5069619ca8fdce305534f3fe85091a0f">llvm::SPII::Load</a></div><div class="ttdef"><b>Definition:</b> <a href="SparcInstrInfo_8h_source.html#l00031">SparcInstrInfo.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a6fe2f06b8a4b2c3d6308afb223a0238a"><div class="ttname"><a href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">llvm::Instruction::eraseFromParent</a></div><div class="ttdeci">void eraseFromParent()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00072">Instruction.cpp:72</a></div></div>
<div class="ttc" id="classllvm_1_1Argument_html"><div class="ttname"><a href="classllvm_1_1Argument.html">llvm::Argument</a></div><div class="ttdoc">LLVM Argument representation. </div><div class="ttdef"><b>Definition:</b> <a href="Argument_8h_source.html#l00035">Argument.h:35</a></div></div>
<div class="ttc" id="Instructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="classllvm_1_1LoadAndStorePromoter_html_a0e97a303d712494969b8800d3b6d712d"><div class="ttname"><a href="classllvm_1_1LoadAndStorePromoter.html#a0e97a303d712494969b8800d3b6d712d">llvm::LoadAndStorePromoter::run</a></div><div class="ttdeci">void run(const SmallVectorImpl&lt; Instruction * &gt; &amp;Insts) const </div><div class="ttdoc">This does the promotion. </div><div class="ttdef"><b>Definition:</b> <a href="SSAUpdater_8cpp_source.html#l00342">SSAUpdater.cpp:342</a></div></div>
<div class="ttc" id="namespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">List of target independent CodeGen pass IDs. </div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l00022">APFloat.h:22</a></div></div>
<div class="ttc" id="classllvm_1_1MemIntrinsic_html_a9558faebdbb62c072aed98e33604889d"><div class="ttname"><a href="classllvm_1_1MemIntrinsic.html#a9558faebdbb62c072aed98e33604889d">llvm::MemIntrinsic::isVolatile</a></div><div class="ttdeci">bool isVolatile() const </div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00134">IntrinsicInst.h:134</a></div></div>
<div class="ttc" id="DerivedTypes_8h_html"><div class="ttname"><a href="DerivedTypes_8h.html">DerivedTypes.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a92c9f6b95aaca2b3090b0b046e5eb194"><div class="ttname"><a href="namespacellvm.html#a92c9f6b95aaca2b3090b0b046e5eb194">llvm::createScalarReplAggregatesPass</a></div><div class="ttdeci">FunctionPass * createScalarReplAggregatesPass(signed Threshold=-1, bool UseDomTree=true, signed StructMemberThreshold=-1, signed ArrayElementThreshold=-1, signed ScalarLoadThreshold=-1)</div></div>
<div class="ttc" id="ScalarReplAggregates_8cpp_html_a49e4c863caf09cc174f83f0abd93f554"><div class="ttname"><a href="ScalarReplAggregates_8cpp.html#a49e4c863caf09cc174f83f0abd93f554">STATISTIC</a></div><div class="ttdeci">STATISTIC(NumReplaced,&quot;Number of allocas broken up&quot;)</div></div>
<div class="ttc" id="classllvm_1_1IntrinsicInst_html_a6cbb4809b81f3994ee0c79b38556bd66"><div class="ttname"><a href="classllvm_1_1IntrinsicInst.html#a6cbb4809b81f3994ee0c79b38556bd66">llvm::IntrinsicInst::getIntrinsicID</a></div><div class="ttdeci">Intrinsic::ID getIntrinsicID() const </div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00043">IntrinsicInst.h:43</a></div></div>
<div class="ttc" id="IntrinsicInst_8h_html"><div class="ttname"><a href="IntrinsicInst_8h.html">IntrinsicInst.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a3f2f98c2a67c9e79f58aad9150a62e42"><div class="ttname"><a href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">llvm::dyn_cast</a></div><div class="ttdeci">enable_if_c&lt;!is_simple_type&lt; Y &gt;::value, typename cast_retty&lt; X, const Y &gt;::ret_type &gt;::type dyn_cast(const Y &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="Casting_8h_source.html#l00266">Casting.h:266</a></div></div>
<div class="ttc" id="classllvm_1_1ZExtInst_html"><div class="ttname"><a href="classllvm_1_1ZExtInst.html">llvm::ZExtInst</a></div><div class="ttdoc">This class represents zero extension of integer types. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03211">Instructions.h:3211</a></div></div>
<div class="ttc" id="DataLayout_8h_html"><div class="ttname"><a href="DataLayout_8h.html">DataLayout.h</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00534">DenseMap.h:534</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html"><div class="ttname"><a href="classllvm_1_1PHINode.html">llvm::PHINode</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01978">Instructions.h:1978</a></div></div>
<div class="ttc" id="Debug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_ad960e1ff48d25c382b6d28e7961f074e"><div class="ttname"><a href="classllvm_1_1APInt.html#ad960e1ff48d25c382b6d28e7961f074e">llvm::APInt::getLowBitsSet</a></div><div class="ttdeci">static APInt getLowBitsSet(unsigned numBits, unsigned loBitsSet)</div><div class="ttdoc">Get a value with low bits set. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00528">APInt.h:528</a></div></div>
<div class="ttc" id="classllvm_1_1PointerType_html_a050a395d1656e546679d8b144d951bb2"><div class="ttname"><a href="classllvm_1_1PointerType.html#a050a395d1656e546679d8b144d951bb2">llvm::PointerType::get</a></div><div class="ttdeci">static PointerType * get(Type *ElementType, unsigned AddressSpace)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00730">Type.cpp:730</a></div></div>
<div class="ttc" id="namespacellvm_html_a43c6ebb4fd35ebd815d66a2df4eed0b9"><div class="ttname"><a href="namespacellvm.html#a43c6ebb4fd35ebd815d66a2df4eed0b9">llvm::gep_type_end</a></div><div class="ttdeci">gep_type_iterator gep_type_end(const User *GEP)</div><div class="ttdef"><b>Definition:</b> <a href="GetElementPtrTypeIterator_8h_source.html#l00089">GetElementPtrTypeIterator.h:89</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a573063aad4c101462893d0490d867524"><div class="ttname"><a href="classllvm_1_1Instruction.html#a573063aad4c101462893d0490d867524">llvm::Instruction::mayHaveSideEffects</a></div><div class="ttdeci">bool mayHaveSideEffects() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00324">Instruction.h:324</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_ac67ad08d36c989a872a887caa72803c6"><div class="ttname"><a href="classllvm_1_1Type.html#ac67ad08d36c989a872a887caa72803c6">llvm::Type::isDoubleTy</a></div><div class="ttdeci">bool isDoubleTy() const </div><div class="ttdoc">isDoubleTy - Return true if this is &amp;#39;double&amp;#39;, a 64-bit IEEE fp type. </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00149">Type.h:149</a></div></div>
<div class="ttc" id="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode_html_a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217"><div class="ttname"><a href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca09c68d67f7dbfa6cc77eaf73aa535217">llvm::NVPTX::PTXLdStInstCode::Scalar</a></div><div class="ttdef"><b>Definition:</b> <a href="NVPTX_8h_source.html#l00126">NVPTX.h:126</a></div></div>
<div class="ttc" id="classllvm_1_1MemSetInst_html"><div class="ttname"><a href="classllvm_1_1MemSetInst.html">llvm::MemSetInst</a></div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00190">IntrinsicInst.h:190</a></div></div>
<div class="ttc" id="SSAUpdater_8h_html"><div class="ttname"><a href="SSAUpdater_8h.html">SSAUpdater.h</a></div></div>
<div class="ttc" id="classllvm_1_1MDNode_html"><div class="ttname"><a href="classllvm_1_1MDNode.html">llvm::MDNode</a></div><div class="ttdoc">MDNode - a tuple of other values. </div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8h_source.html#l00073">Metadata.h:73</a></div></div>
<div class="ttc" id="namespacellvm_html_afd92ce3a3b5db58abf81981d3fcd95c6"><div class="ttname"><a href="namespacellvm.html#afd92ce3a3b5db58abf81981d3fcd95c6">llvm::PromoteMemToReg</a></div><div class="ttdeci">void PromoteMemToReg(ArrayRef&lt; AllocaInst * &gt; Allocas, DominatorTree &amp;DT, AliasSetTracker *AST=0)</div><div class="ttdoc">Promote the specified list of alloca instructions into scalar registers, inserting PHI nodes as appro...</div><div class="ttdef"><b>Definition:</b> <a href="PromoteMemoryToRegister_8cpp_source.html#l01072">PromoteMemoryToRegister.cpp:1072</a></div></div>
<div class="ttc" id="LLParser_8cpp_html_a33ece1ef8074506a15d7f86eb76dbae6"><div class="ttname"><a href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a></div><div class="ttdeci">F(f)</div></div>
<div class="ttc" id="namespacellvm_html_a2bb15e529c55b5356aabfb006d1e98aa"><div class="ttname"><a href="namespacellvm.html#a2bb15e529c55b5356aabfb006d1e98aa">llvm::isSafeToLoadUnconditionally</a></div><div class="ttdeci">bool isSafeToLoadUnconditionally(Value *V, Instruction *ScanFrom, unsigned Align, const DataLayout *TD=0)</div><div class="ttdef"><b>Definition:</b> <a href="Loads_8cpp_source.html#l00056">Loads.cpp:56</a></div></div>
<div class="ttc" id="classllvm_1_1SExtInst_html"><div class="ttname"><a href="classllvm_1_1SExtInst.html">llvm::SExtInst</a></div><div class="ttdoc">This class represents a sign extension of integer types. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03247">Instructions.h:3247</a></div></div>
<div class="ttc" id="classllvm_1_1PointerType_html_a921061a57ec3cfbaf6422f09f7d79fc3"><div class="ttname"><a href="classllvm_1_1PointerType.html#a921061a57ec3cfbaf6422f09f7d79fc3">llvm::PointerType::getAddressSpace</a></div><div class="ttdeci">unsigned getAddressSpace() const </div><div class="ttdoc">Return the address space of the Pointer type. </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00445">DerivedTypes.h:445</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00070">Function.h:70</a></div></div>
<div class="ttc" id="classllvm_1_1LoadInst_html"><div class="ttname"><a href="classllvm_1_1LoadInst.html">llvm::LoadInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00136">Instructions.h:136</a></div></div>
<div class="ttc" id="classllvm_1_1IntegerType_html_a6f603ab84f6f7c79985036f58cca9d48"><div class="ttname"><a href="classllvm_1_1IntegerType.html#a6f603ab84f6f7c79985036f58cca9d48">llvm::IntegerType::getBitWidth</a></div><div class="ttdeci">unsigned getBitWidth() const </div><div class="ttdoc">Get the number of bits in this IntegerType. </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00061">DerivedTypes.h:61</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a05186fa23e4d11b9855a9599ba87a4b7"><div class="ttname"><a href="classllvm_1_1Type.html#a05186fa23e4d11b9855a9599ba87a4b7">llvm::Type::getInt64Ty</a></div><div class="ttdeci">static IntegerType * getInt64Ty(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00242">Type.cpp:242</a></div></div>
<div class="ttc" id="classllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00033">User.h:33</a></div></div>
<div class="ttc" id="Statistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="classllvm_1_1LoadInst_html_a156c478ee8e7d1602143cdbad4bd5385"><div class="ttname"><a href="classllvm_1_1LoadInst.html#a156c478ee8e7d1602143cdbad4bd5385">llvm::LoadInst::isSimple</a></div><div class="ttdeci">bool isSimple() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00218">Instructions.h:218</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a7bd545769621a0a9d2cfb074f86f4295"><div class="ttname"><a href="classllvm_1_1Instruction.html#a7bd545769621a0a9d2cfb074f86f4295">llvm::Instruction::setDebugLoc</a></div><div class="ttdeci">void setDebugLoc(const DebugLoc &amp;Loc)</div><div class="ttdoc">setDebugLoc - Set the debug location information for this instruction. </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00175">Instruction.h:175</a></div></div>
<div class="ttc" id="classllvm_1_1SetVector_html_a95ea0587484ef2fc182e64dfd36a62c8"><div class="ttname"><a href="classllvm_1_1SetVector.html#a95ea0587484ef2fc182e64dfd36a62c8">llvm::SetVector::size</a></div><div class="ttdeci">size_type size() const </div><div class="ttdoc">Determine the number of elements in the SetVector. </div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00064">SetVector.h:64</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a2eeb1c7ed1cfe403f2ae0470e36c07e2"><div class="ttname"><a href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">llvm::User::op_begin</a></div><div class="ttdeci">op_iterator op_begin()</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00116">User.h:116</a></div></div>
<div class="ttc" id="namespacellvm_html_a7d0c6287665ca74c18123703fc1ba056"><div class="ttname"><a href="namespacellvm.html#a7d0c6287665ca74c18123703fc1ba056">llvm::initializeSROA_DTPass</a></div><div class="ttdeci">void initializeSROA_DTPass(PassRegistry &amp;)</div></div>
<div class="ttc" id="classllvm_1_1IRBuilderBase_html_a9b1be210e6549573e2e46105c671d0be"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a9b1be210e6549573e2e46105c671d0be">llvm::IRBuilderBase::CreateLifetimeEnd</a></div><div class="ttdeci">CallInst * CreateLifetimeEnd(Value *Ptr, ConstantInt *Size=0)</div><div class="ttdoc">Create a lifetime.end intrinsic. </div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8cpp_source.html#l00140">IRBuilder.cpp:140</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_ab9c1bc49a2be2d26ca426b2ec23d6cf5"><div class="ttname"><a href="classllvm_1_1DataLayout.html#ab9c1bc49a2be2d26ca426b2ec23d6cf5">llvm::DataLayout::getTypeAllocSizeInBits</a></div><div class="ttdeci">uint64_t getTypeAllocSizeInBits(Type *Ty) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00335">DataLayout.h:335</a></div></div>
<div class="ttc" id="CallSite_8h_html"><div class="ttname"><a href="CallSite_8h.html">CallSite.h</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a40e48df9196b3c092096138cd9af8465"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a40e48df9196b3c092096138cd9af8465">llvm::IRBuilder::CreateInsertElement</a></div><div class="ttdeci">Value * CreateInsertElement(Value *Vec, Value *NewElt, Value *Idx, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01357">IRBuilder.h:1357</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html_aa6574d526b3e38a28f688a7bb4325c2c"><div class="ttname"><a href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">llvm::Constant::getNullValue</a></div><div class="ttdeci">static Constant * getNullValue(Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00111">Constants.cpp:111</a></div></div>
<div class="ttc" id="classllvm_1_1generic__gep__type__iterator_html"><div class="ttname"><a href="classllvm_1_1generic__gep__type__iterator.html">llvm::generic_gep_type_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="GetElementPtrTypeIterator_8h_source.html#l00023">GetElementPtrTypeIterator.h:23</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad452febc1ac0b394876e640ec03ffa38"><div class="ttname"><a href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00167">Value.cpp:167</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0ed5f3ab3c2e4196ee0cffffa080c062"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">llvm::BasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00193">BasicBlock.h:193</a></div></div>
<div class="ttc" id="classllvm_1_1DIBuilder_html"><div class="ttname"><a href="classllvm_1_1DIBuilder.html">llvm::DIBuilder</a></div><div class="ttdef"><b>Definition:</b> <a href="DIBuilder_8h_source.html#l00055">DIBuilder.h:55</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a36e21267fe14e69d3251eab1cd3a0076"><div class="ttname"><a href="classllvm_1_1Type.html#a36e21267fe14e69d3251eab1cd3a0076">llvm::Type::isSingleValueType</a></div><div class="ttdeci">bool isSingleValueType() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00259">Type.h:259</a></div></div>
<div class="ttc" id="classllvm_1_1AllocaInst_html_a066eba0d0eb9d9655c9b580a2a279b0a"><div class="ttname"><a href="classllvm_1_1AllocaInst.html#a066eba0d0eb9d9655c9b580a2a279b0a">llvm::AllocaInst::isArrayAllocation</a></div><div class="ttdeci">bool isArrayAllocation() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l00900">Instructions.cpp:900</a></div></div>
<div class="ttc" id="ScalarReplAggregates_8cpp_html_affb347572bf7943b60e44d940841e3b2"><div class="ttname"><a href="ScalarReplAggregates_8cpp.html#affb347572bf7943b60e44d940841e3b2">Aggregates</a></div><div class="ttdeci">Scalar Replacement of Aggregates(DT)&quot;</div></div>
<div class="ttc" id="PromoteMemToReg_8h_html"><div class="ttname"><a href="PromoteMemToReg_8h.html">PromoteMemToReg.h</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilderBase_html_a248295120710baf72dbbd3a862c840e4"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a248295120710baf72dbbd3a862c840e4">llvm::IRBuilderBase::CreateMemMove</a></div><div class="ttdeci">CallInst * CreateMemMove(Value *Dst, Value *Src, uint64_t Size, unsigned Align, bool isVolatile=false, MDNode *TBAATag=0)</div><div class="ttdoc">Create and insert a memmove between the specified pointers. </div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00381">IRBuilder.h:381</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a478d9db5034ad1bef340198c3aaf861a"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a478d9db5034ad1bef340198c3aaf861a">llvm::IRBuilder::CreateExtractValue</a></div><div class="ttdeci">Value * CreateExtractValue(Value *Agg, ArrayRef&lt; unsigned &gt; Idxs, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01375">IRBuilder.h:1375</a></div></div>
<div class="ttc" id="namespacellvm_html_ace6c957db39858291c6ce01c38e78480"><div class="ttname"><a href="namespacellvm.html#ace6c957db39858291c6ce01c38e78480">llvm::GetUnderlyingObject</a></div><div class="ttdeci">Value * GetUnderlyingObject(Value *V, const DataLayout *TD=0, unsigned MaxLookup=6)</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l01899">ValueTracking.cpp:1899</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html_ae5c60fd282ee894c87ea02c3f0fcb6d0"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">llvm::AnalysisUsage::addRequired</a></div><div class="ttdeci">AnalysisUsage &amp; addRequired()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00055">PassAnalysisSupport.h:55</a></div></div>
<div class="ttc" id="classllvm_1_1StructLayout_html"><div class="ttname"><a href="classllvm_1_1StructLayout.html">llvm::StructLayout</a></div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00418">DataLayout.h:418</a></div></div>
<div class="ttc" id="PassSupport_8h_html_a14724f1ccf528e73bb29bc9230737967"><div class="ttname"><a href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a></div><div class="ttdeci">#define INITIALIZE_PASS_DEPENDENCY(depName)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00167">PassSupport.h:167</a></div></div>
<div class="ttc" id="Delinearization_8cpp_html_a67193aea0752a127930d6f762e685eef"><div class="ttname"><a href="Delinearization_8cpp.html#a67193aea0752a127930d6f762e685eef">getPointerOperand</a></div><div class="ttdeci">static Value * getPointerOperand(Instruction &amp;Inst)</div><div class="ttdef"><b>Definition:</b> <a href="Delinearization_8cpp_source.html#l00072">Delinearization.cpp:72</a></div></div>
<div class="ttc" id="classllvm_1_1value__use__iterator_html"><div class="ttname"><a href="classllvm_1_1value__use__iterator.html">llvm::value_use_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00168">Use.h:168</a></div></div>
<div class="ttc" id="ValueTracking_8cpp_html_a06c14477546c3a0eb4c79ff007ea2375"><div class="ttname"><a href="ValueTracking_8cpp.html#a06c14477546c3a0eb4c79ff007ea2375">getBitWidth</a></div><div class="ttdeci">static unsigned getBitWidth(Type *Ty, const DataLayout *TD)</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l00040">ValueTracking.cpp:40</a></div></div>
<div class="ttc" id="classllvm_1_1SelectInst_html"><div class="ttname"><a href="classllvm_1_1SelectInst.html">llvm::SelectInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01430">Instructions.h:1430</a></div></div>
<div class="ttc" id="classllvm_1_1Twine_html"><div class="ttname"><a href="classllvm_1_1Twine.html">llvm::Twine</a></div><div class="ttdef"><b>Definition:</b> <a href="Twine_8h_source.html#l00081">Twine.h:81</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_a35c840104f32575e0d91422cf1ef3ce4"><div class="ttname"><a href="classllvm_1_1DataLayout.html#a35c840104f32575e0d91422cf1ef3ce4">llvm::DataLayout::getStructLayout</a></div><div class="ttdeci">const StructLayout * getStructLayout(StructType *Ty) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8cpp_source.html#l00445">DataLayout.cpp:445</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a400eaca9881c8dcab97e9f42b1ab1815"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">llvm::SmallVectorImpl::pop_back_val</a></div><div class="ttdeci">T LLVM_ATTRIBUTE_UNUSED_RESULT pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00430">SmallVector.h:430</a></div></div>
<div class="ttc" id="classllvm_1_1StructType_html"><div class="ttname"><a href="classllvm_1_1StructType.html">llvm::StructType</a></div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00187">DerivedTypes.h:187</a></div></div>
<div class="ttc" id="ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdef"><b>Definition:</b> <a href="ErrorHandling_8h_source.html#l00103">ErrorHandling.h:103</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a11d3f8bbc5a14f60879a87175db6695c"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a11d3f8bbc5a14f60879a87175db6695c">llvm::IRBuilder::CreateIntToPtr</a></div><div class="ttdeci">Value * CreateIntToPtr(Value *V, Type *DestTy, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01128">IRBuilder.h:1128</a></div></div>
<div class="ttc" id="classllvm_1_1Use_html"><div class="ttname"><a href="classllvm_1_1Use.html">llvm::Use</a></div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00060">Use.h:60</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_aa1953b3ad7ef6aa87dc0205db0c2ea45"><div class="ttname"><a href="classllvm_1_1APInt.html#aa1953b3ad7ef6aa87dc0205db0c2ea45">llvm::APInt::lshr</a></div><div class="ttdeci">APInt LLVM_ATTRIBUTE_UNUSED_RESULT lshr(unsigned shiftAmt) const </div><div class="ttdoc">Logical right-shift function. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8cpp_source.html#l01127">APInt.cpp:1127</a></div></div>
<div class="ttc" id="PassSupport_8h_html_a74ce8276b89067e806f67c45a6d92575"><div class="ttname"><a href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a></div><div class="ttdeci">#define INITIALIZE_PASS_END(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00172">PassSupport.h:172</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00035">APInt.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html"><div class="ttname"><a href="classllvm_1_1IRBuilder.html">llvm::IRBuilder</a></div><div class="ttdoc">This provides a uniform API for creating instructions and inserting them into a basic block: either a...</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00421">IRBuilder.h:421</a></div></div>
<div class="ttc" id="classllvm_1_1VectorType_html_a5e5bbb41f2a8c82330f868fdf1026b9b"><div class="ttname"><a href="classllvm_1_1VectorType.html#a5e5bbb41f2a8c82330f868fdf1026b9b">llvm::VectorType::getBitWidth</a></div><div class="ttdeci">unsigned getBitWidth() const </div><div class="ttdoc">Return the number of bits in the Vector type. Returns zero when the vector is a vector of pointers...</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00412">DerivedTypes.h:412</a></div></div>
<div class="ttc" id="ErrorHandling_8h_html"><div class="ttname"><a href="ErrorHandling_8h.html">ErrorHandling.h</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_af81977584678ef1ff229fcf2f1b69b2b"><div class="ttname"><a href="classllvm_1_1DataLayout.html#af81977584678ef1ff229fcf2f1b69b2b">llvm::DataLayout::getIndexedOffset</a></div><div class="ttdeci">uint64_t getIndexedOffset(Type *Ty, ArrayRef&lt; Value * &gt; Indices) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8cpp_source.html#l00639">DataLayout.cpp:639</a></div></div>
<div class="ttc" id="namespacefalse_html"><div class="ttname"><a href="namespacefalse.html">false</a></div><div class="ttdef"><b>Definition:</b> <a href="StackSlotColoring_8cpp_source.html#l00126">StackSlotColoring.cpp:126</a></div></div>
<div class="ttc" id="classllvm_1_1AllocaInst_html_a214c60dbb4f1ed467e5a3420db6eefd6"><div class="ttname"><a href="classllvm_1_1AllocaInst.html#a214c60dbb4f1ed467e5a3420db6eefd6">llvm::AllocaInst::getAllocatedType</a></div><div class="ttdeci">Type * getAllocatedType() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l00906">Instructions.cpp:906</a></div></div>
<div class="ttc" id="namespacellvm_1_1CallingConv_html_a4f861731fc6dbfdccc05af5968d98974"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">llvm::CallingConv::ID</a></div><div class="ttdeci">ID</div><div class="ttdoc">LLVM Calling Convention Representation. </div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00026">CallingConv.h:26</a></div></div>
<div class="ttc" id="ScalarReplAggregates_8cpp_html_ae56008e3ce94b653130107b75b9332a8"><div class="ttname"><a href="ScalarReplAggregates_8cpp.html#ae56008e3ce94b653130107b75b9332a8">tryToMakeAllocaBePromotable</a></div><div class="ttdeci">static bool tryToMakeAllocaBePromotable(AllocaInst *AI, const DataLayout *TD)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarReplAggregates_8cpp_source.html#l01239">ScalarReplAggregates.cpp:1239</a></div></div>
<div class="ttc" id="classllvm_1_1GetElementPtrInst_html_a7400b6ae12470abc8ea6e18e171016b2"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html#a7400b6ae12470abc8ea6e18e171016b2">llvm::GetElementPtrInst::getPointerOperandType</a></div><div class="ttdeci">Type * getPointerOperandType() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00802">Instructions.h:802</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00031">Instruction.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a97c35b2ca7fa3e1f17c9f25e9dc2087b"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a97c35b2ca7fa3e1f17c9f25e9dc2087b">llvm::ConstantInt::isNegative</a></div><div class="ttdeci">bool isNegative() const </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00155">Constants.h:155</a></div></div>
<div class="ttc" id="Dominators_8h_html"><div class="ttname"><a href="Dominators_8h.html">Dominators.h</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a6edd823ba5e4e1effc8280ca8a1194ef"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">llvm::ConstantInt::getZExtValue</a></div><div class="ttdeci">uint64_t getZExtValue() const </div><div class="ttdoc">Return the zero extended value. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00116">Constants.h:116</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a197d5dd77cad4560a082900962a830aa"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a197d5dd77cad4560a082900962a830aa">llvm::IRBuilder::CreateAnd</a></div><div class="ttdeci">Value * CreateAnd(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00789">IRBuilder.h:789</a></div></div>
<div class="ttc" id="classllvm_1_1SetVector_html_a72d928b7fc2c5f2d56c6ac0265fd9c6e"><div class="ttname"><a href="classllvm_1_1SetVector.html#a72d928b7fc2c5f2d56c6ac0265fd9c6e">llvm::SetVector::insert</a></div><div class="ttdeci">bool insert(const value_type &amp;X)</div><div class="ttdoc">Insert a new element into the SetVector. </div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00102">SetVector.h:102</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_af348d5ea83429d08ba891ca3dd0e92b2"><div class="ttname"><a href="classllvm_1_1Type.html#af348d5ea83429d08ba891ca3dd0e92b2">llvm::Type::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdoc">getContext - Return the LLVMContext in which this type was uniqued. </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00128">Type.h:128</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a8f55dd4237be6778517ddd752ca8b76a"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a8f55dd4237be6778517ddd752ca8b76a">llvm::IRBuilder::CreateOr</a></div><div class="ttdeci">Value * CreateOr(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00805">IRBuilder.h:805</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_a8db36c82f32d6f6a4d35a00e55be03a8"><div class="ttname"><a href="Target_2README_8txt.html#a8db36c82f32d6f6a4d35a00e55be03a8">Shift</a></div><div class="ttdeci">bool Shift</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00506">Target/README.txt:506</a></div></div>
<div class="ttc" id="Operator_8h_html"><div class="ttname"><a href="Operator_8h.html">Operator.h</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorBase_html_a8a8df4d85555c7954a95f86080cd3b64"><div class="ttname"><a href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">llvm::SmallVectorBase::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00056">SmallVector.h:56</a></div></div>
<div class="ttc" id="Mips16ISelLowering_8cpp_html_a0acb682b8260ab1c60b918599864e2e5"><div class="ttname"><a href="Mips16ISelLowering_8cpp.html#a0acb682b8260ab1c60b918599864e2e5">T</a></div><div class="ttdeci">#define T</div><div class="ttdef"><b>Definition:</b> <a href="Mips16ISelLowering_8cpp_source.html#l00349">Mips16ISelLowering.cpp:349</a></div></div>
<div class="ttc" id="DebugInfo_8h_html"><div class="ttname"><a href="DebugInfo_8h.html">DebugInfo.h</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayType_html"><div class="ttname"><a href="classllvm_1_1ArrayType.html">llvm::ArrayType</a></div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00332">DerivedTypes.h:332</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a024bb83a7f01e7661ea72ff7dcc460f5"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a024bb83a7f01e7661ea72ff7dcc460f5">llvm::ConstantInt::getLimitedValue</a></div><div class="ttdeci">uint64_t getLimitedValue(uint64_t Limit=~0ULL) const </div><div class="ttdoc">Get the constant&amp;#39;s value with a saturation limit. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00218">Constants.h:218</a></div></div>
<div class="ttc" id="classllvm_1_1BitCastInst_html"><div class="ttname"><a href="classllvm_1_1BitCastInst.html">llvm::BitCastInst</a></div><div class="ttdoc">This class represents a no-op cast from one type to another. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03587">Instructions.h:3587</a></div></div>
<div class="ttc" id="classllvm_1_1SetVector_html_a298a4f422dfc8478ad9cdd0a106cd5e4"><div class="ttname"><a href="classllvm_1_1SetVector.html#a298a4f422dfc8478ad9cdd0a106cd5e4">llvm::SetVector::empty</a></div><div class="ttdeci">bool empty() const </div><div class="ttdoc">Determine if the SetVector is empty or not. </div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00059">SetVector.h:59</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a40113570b0c52a18c34cabed8359e2c8"><div class="ttname"><a href="classllvm_1_1Type.html#a40113570b0c52a18c34cabed8359e2c8">llvm::Type::isFloatingPointTy</a></div><div class="ttdeci">bool isFloatingPointTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00162">Type.h:162</a></div></div>
<div class="ttc" id="classllvm_1_1StoreInst_html"><div class="ttname"><a href="classllvm_1_1StoreInst.html">llvm::StoreInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00255">Instructions.h:255</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00303">Value.cpp:303</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_a15e279291892399c141cd01c7e358cbf"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#a15e279291892399c141cd01c7e358cbf">llvm::ConstantExpr::getIntToPtr</a></div><div class="ttdeci">static Constant * getIntToPtr(Constant *C, Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01660">Constants.cpp:1660</a></div></div>
<div class="ttc" id="MathExtras_8h_html"><div class="ttname"><a href="MathExtras_8h.html">MathExtras.h</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ae855357b6c5e6e7ed1869272708a3a84"><div class="ttname"><a href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">llvm::Value::takeName</a></div><div class="ttdeci">void takeName(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00239">Value.cpp:239</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a43f7fa52a3fbe01e44c40d9db278ab3e"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a43f7fa52a3fbe01e44c40d9db278ab3e">llvm::IRBuilder::CreateStore</a></div><div class="ttdeci">StoreInst * CreateStore(Value *Val, Value *Ptr, bool isVolatile=false)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00888">IRBuilder.h:888</a></div></div>
<div class="ttc" id="classllvm_1_1DominatorTree_html"><div class="ttname"><a href="classllvm_1_1DominatorTree.html">llvm::DominatorTree</a></div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00740">Dominators.h:740</a></div></div>
<div class="ttc" id="classllvm_1_1TruncInst_html"><div class="ttname"><a href="classllvm_1_1TruncInst.html">llvm::TruncInst</a></div><div class="ttdoc">This class represents a truncation of integer types. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03175">Instructions.h:3175</a></div></div>
<div class="ttc" id="classllvm_1_1SequentialType_html_a39f2c3a62f293faf11ac28b15bc53359"><div class="ttname"><a href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">llvm::SequentialType::getElementType</a></div><div class="ttdeci">Type * getElementType() const </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00319">DerivedTypes.h:319</a></div></div>
<div class="ttc" id="classllvm_1_1PointerType_html"><div class="ttname"><a href="classllvm_1_1PointerType.html">llvm::PointerType</a></div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00425">DerivedTypes.h:425</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_aa45f6c0433576e3858a6209a43750ad4"><div class="ttname"><a href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">llvm::PHINode::getNumIncomingValues</a></div><div class="ttdeci">unsigned getNumIncomingValues() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02055">Instructions.h:2055</a></div></div>
<div class="ttc" id="classllvm_1_1StructLayout_html_ae10c4483372a357a0d3411b3d64be10c"><div class="ttname"><a href="classllvm_1_1StructLayout.html#ae10c4483372a357a0d3411b3d64be10c">llvm::StructLayout::getElementOffset</a></div><div class="ttdeci">uint64_t getElementOffset(unsigned Idx) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00442">DataLayout.h:442</a></div></div>
<div class="ttc" id="classllvm_1_1StructLayout_html_a05c049a3bc016b91dddf9ab5433855bb"><div class="ttname"><a href="classllvm_1_1StructLayout.html#a05c049a3bc016b91dddf9ab5433855bb">llvm::StructLayout::getElementOffsetInBits</a></div><div class="ttdeci">uint64_t getElementOffsetInBits(unsigned Idx) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00447">DataLayout.h:447</a></div></div>
<div class="ttc" id="classllvm_1_1TerminatorInst_html_a4c26d3b92af99a6c8defd89a2d39ca32"><div class="ttname"><a href="classllvm_1_1TerminatorInst.html#a4c26d3b92af99a6c8defd89a2d39ca32">llvm::TerminatorInst::getNumSuccessors</a></div><div class="ttdeci">unsigned getNumSuccessors() const </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00059">InstrTypes.h:59</a></div></div>
<div class="ttc" id="classllvm_1_1GetElementPtrInst_html"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html">llvm::GetElementPtrInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00709">Instructions.h:709</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64DB_html_a6fce8157775f3ec93f326b52b0f1e0f5a4916e736d6b7cc68359b39d5eb50f6db"><div class="ttname"><a href="namespacellvm_1_1A64DB.html#a6fce8157775f3ec93f326b52b0f1e0f5a4916e736d6b7cc68359b39d5eb50f6db">llvm::A64DB::ST</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00178">AArch64BaseInfo.h:178</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ac33c7ecbf1c0f1e8bf93403522e6976b"><div class="ttname"><a href="classllvm_1_1Value.html#ac33c7ecbf1c0f1e8bf93403522e6976b">llvm::Value::use_iterator</a></div><div class="ttdeci">value_use_iterator&lt; User &gt; use_iterator</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00146">Value.h:146</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_aac0ea55010b7b1a301e65a0baea057aa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">llvm::SmallVectorImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00396">SmallVector.h:396</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00072">BasicBlock.h:72</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html"><div class="ttname"><a href="classllvm_1_1Type.html">llvm::Type</a></div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00044">Type.h:44</a></div></div>
<div class="ttc" id="classllvm_1_1LLVMContext_html"><div class="ttname"><a href="classllvm_1_1LLVMContext.html">llvm::LLVMContext</a></div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00037">LLVMContext.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_a328b37dd0e404674678018ac2f2e38af"><div class="ttname"><a href="classllvm_1_1DataLayout.html#a328b37dd0e404674678018ac2f2e38af">llvm::DataLayout::getTypeStoreSizeInBits</a></div><div class="ttdeci">uint64_t getTypeStoreSizeInBits(Type *Ty) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00318">DataLayout.h:318</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a6f725580f7834e2ca90762965866dad4"><div class="ttname"><a href="classllvm_1_1Type.html#a6f725580f7834e2ca90762965866dad4">llvm::Type::isVectorTy</a></div><div class="ttdeci">bool isVectorTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00229">Type.h:229</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a112f87f5844b5d94c07940f3d47f1e99"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a112f87f5844b5d94c07940f3d47f1e99">llvm::IRBuilder::CreateAdd</a></div><div class="ttdeci">Value * CreateAdd(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;, bool HasNUW=false, bool HasNSW=false)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00615">IRBuilder.h:615</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a1e2a8dc174c34596e7e8efc7ab7e08a0"><div class="ttname"><a href="classllvm_1_1Type.html#a1e2a8dc174c34596e7e8efc7ab7e08a0">llvm::Type::getContainedType</a></div><div class="ttdeci">Type * getContainedType(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00339">Type.h:339</a></div></div>
<div class="ttc" id="classllvm_1_1StructType_html_a2f54639fcb5162f6f51192eb1697d2ad"><div class="ttname"><a href="classllvm_1_1StructType.html#a2f54639fcb5162f6f51192eb1697d2ad">llvm::StructType::getElementType</a></div><div class="ttdeci">Type * getElementType(unsigned N) const </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00287">DerivedTypes.h:287</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a9299aed1efa0ef459a0f1c7fa11fbe61"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a9299aed1efa0ef459a0f1c7fa11fbe61">llvm::IRBuilder::CreatePtrToInt</a></div><div class="ttdeci">Value * CreatePtrToInt(Value *V, Type *DestTy, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01124">IRBuilder.h:1124</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html"><div class="ttname"><a href="classllvm_1_1Constant.html">llvm::Constant</a></div><div class="ttdoc">LLVM Constant Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Constant_8h_source.html#l00041">Constant.h:41</a></div></div>
<div class="ttc" id="classllvm_1_1AllocaInst_html_a597c918a615f26a0cea7adb84f06fc3f"><div class="ttname"><a href="classllvm_1_1AllocaInst.html#a597c918a615f26a0cea7adb84f06fc3f">llvm::AllocaInst::getType</a></div><div class="ttdeci">PointerType * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00091">Instructions.h:91</a></div></div>
<div class="ttc" id="Constants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a9d0a7040918ba81ef34046fd474cee10"><div class="ttname"><a href="namespacellvm.html#a9d0a7040918ba81ef34046fd474cee10">llvm::onlyUsedByLifetimeMarkers</a></div><div class="ttdeci">bool onlyUsedByLifetimeMarkers(const Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l01961">ValueTracking.cpp:1961</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_aeb06cf0f813f643b62d8dd98db0bc249"><div class="ttname"><a href="classllvm_1_1Type.html#aeb06cf0f813f643b62d8dd98db0bc249">llvm::Type::isFloatTy</a></div><div class="ttdeci">bool isFloatTy() const </div><div class="ttdoc">isFloatTy - Return true if this is &amp;#39;float&amp;#39;, a 32-bit IEEE fp type. </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00146">Type.h:146</a></div></div>
<div class="ttc" id="namespacellvm_html_abe283966f269761ee387642061c4451e"><div class="ttname"><a href="namespacellvm.html#abe283966f269761ee387642061c4451e">llvm::isInstructionTriviallyDead</a></div><div class="ttdeci">bool isInstructionTriviallyDead(Instruction *I, const TargetLibraryInfo *TLI=0)</div><div class="ttdef"><b>Definition:</b> <a href="Local_8cpp_source.html#l00266">Local.cpp:266</a></div></div>
<div class="ttc" id="classllvm_1_1AllocaInst_html_ad441932c20e5b9ba36c8c72a6c7f5ec3"><div class="ttname"><a href="classllvm_1_1AllocaInst.html#ad441932c20e5b9ba36c8c72a6c7f5ec3">llvm::AllocaInst::getAlignment</a></div><div class="ttdeci">unsigned getAlignment() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00103">Instructions.h:103</a></div></div>
<div class="ttc" id="classllvm_1_1MemIntrinsic_html_a3ec0c47a5532e568d54c8d452dfb58df"><div class="ttname"><a href="classllvm_1_1MemIntrinsic.html#a3ec0c47a5532e568d54c8d452dfb58df">llvm::MemIntrinsic::getRawDest</a></div><div class="ttdeci">Value * getRawDest() const </div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00120">IntrinsicInst.h:120</a></div></div>
<div class="ttc" id="classllvm_1_1DIBuilder_html_a827de4664f26cd97746786b159fa997f"><div class="ttname"><a href="classllvm_1_1DIBuilder.html#a827de4664f26cd97746786b159fa997f">llvm::DIBuilder::insertDbgValueIntrinsic</a></div><div class="ttdeci">Instruction * insertDbgValueIntrinsic(llvm::Value *Val, uint64_t Offset, DIVariable VarInfo, BasicBlock *InsertAtEnd)</div><div class="ttdoc">insertDbgValueIntrinsic - Insert a new llvm.dbg.value intrinsic call. </div><div class="ttdef"><b>Definition:</b> <a href="DIBuilder_8cpp_source.html#l01251">DIBuilder.cpp:1251</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_aab8e16a35183ce39aad394714087bcff"><div class="ttname"><a href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">llvm::Instruction::getDebugLoc</a></div><div class="ttdeci">const DebugLoc &amp; getDebugLoc() const </div><div class="ttdoc">getDebugLoc - Return the debug location for this node as a DebugLoc. </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00178">Instruction.h:178</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_ace6b37d5eaf50e6fd3465513bc022e93"><div class="ttname"><a href="Target_2README_8txt.html#ace6b37d5eaf50e6fd3465513bc022e93">of</a></div><div class="ttdeci">Add support for conditional and other related patterns Instead of</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00169">Target/README.txt:169</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00037">PassAnalysisSupport.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_af41f58e730804d10b91fcff39b035f74"><div class="ttname"><a href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">llvm::User::op_end</a></div><div class="ttdeci">op_iterator op_end()</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00118">User.h:118</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_afb5e83bf5123ff7c51058eb0ebebcdc6"><div class="ttname"><a href="classllvm_1_1PHINode.html#afb5e83bf5123ff7c51058eb0ebebcdc6">llvm::PHINode::Create</a></div><div class="ttdeci">static PHINode * Create(Type *Ty, unsigned NumReservedValues, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02013">Instructions.h:2013</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a4c25b6c00c4867281779c81ab64d2081"><div class="ttname"><a href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">llvm::PHINode::getIncomingBlock</a></div><div class="ttdeci">BasicBlock * getIncomingBlock(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02074">Instructions.h:2074</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayType_html_a688547c04258bde2eaf6515048bf3f3b"><div class="ttname"><a href="classllvm_1_1ArrayType.html#a688547c04258bde2eaf6515048bf3f3b">llvm::ArrayType::getNumElements</a></div><div class="ttdeci">uint64_t getNumElements() const </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00348">DerivedTypes.h:348</a></div></div>
<div class="ttc" id="classllvm_1_1Use_html_ac3564961c33fa9f636c6444db4c7fa85"><div class="ttname"><a href="classllvm_1_1Use.html#ac3564961c33fa9f636c6444db4c7fa85">llvm::Use::getUser</a></div><div class="ttdeci">User * getUser() const </div><div class="ttdef"><b>Definition:</b> <a href="Use_8cpp_source.html#l00137">Use.cpp:137</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionPass_html"><div class="ttname"><a href="classllvm_1_1FunctionPass.html">llvm::FunctionPass</a></div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00293">Pass.h:293</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a997ff6a1758bf732b9b263fc61011644"><div class="ttname"><a href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">llvm::User::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00088">User.h:88</a></div></div>
<div class="ttc" id="classllvm_1_1DIVariable_html"><div class="ttname"><a href="classllvm_1_1DIVariable.html">llvm::DIVariable</a></div><div class="ttdef"><b>Definition:</b> <a href="DebugInfo_8h_source.html#l00605">DebugInfo.h:605</a></div></div>
<div class="ttc" id="classllvm_1_1LLVMContext_html_a0869c4dfee48696ce863fcd367eba52da66682b7e33233c8e51196bbf274726a2"><div class="ttname"><a href="classllvm_1_1LLVMContext.html#a0869c4dfee48696ce863fcd367eba52da66682b7e33233c8e51196bbf274726a2">llvm::LLVMContext::MD_tbaa</a></div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00047">LLVMContext.h:47</a></div></div>
<div class="ttc" id="classllvm_1_1IntegerType_html"><div class="ttname"><a href="classllvm_1_1IntegerType.html">llvm::IntegerType</a></div><div class="ttdoc">Integer representation type. </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00037">DerivedTypes.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilderBase_html_a675da14f55ad277eae001b705c42be8b"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a675da14f55ad277eae001b705c42be8b">llvm::IRBuilderBase::getInt64</a></div><div class="ttdeci">ConstantInt * getInt64(uint64_t C)</div><div class="ttdoc">Get a constant 64-bit value. </div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00281">IRBuilder.h:281</a></div></div>
<div class="ttc" id="classllvm_1_1LoadInst_html_a218ef27c964707a907f12db0f9b002ba"><div class="ttname"><a href="classllvm_1_1LoadInst.html#a218ef27c964707a907f12db0f9b002ba">llvm::LoadInst::setAlignment</a></div><div class="ttdeci">void setAlignment(unsigned Align)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01065">Instructions.cpp:1065</a></div></div>
<div class="ttc" id="ScalarReplAggregates_8cpp_html_a6d63a04af963aaff0422a4a1ef425100"><div class="ttname"><a href="ScalarReplAggregates_8cpp.html#a6d63a04af963aaff0422a4a1ef425100">scalarrepl</a></div><div class="ttdeci">scalarrepl</div><div class="ttdef"><b>Definition:</b> <a href="ScalarReplAggregates_8cpp_source.html#l00228">ScalarReplAggregates.cpp:228</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_ad083201ba4e1f8217bdc1f1ab05bd83d"><div class="ttname"><a href="classllvm_1_1Type.html#ad083201ba4e1f8217bdc1f1ab05bd83d">llvm::Type::getNumContainedTypes</a></div><div class="ttdeci">unsigned getNumContainedTypes() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00346">Type.h:346</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a2eba483f5cc876e824aa6c085736086b"><div class="ttname"><a href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">llvm::Type::isPointerTy</a></div><div class="ttdeci">bool isPointerTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00220">Type.h:220</a></div></div>
<div class="ttc" id="classllvm_1_1UndefValue_html_a4ae5ff22b700a42bcc5d889233721335"><div class="ttname"><a href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">llvm::UndefValue::get</a></div><div class="ttdeci">static UndefValue * get(Type *T)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01334">Constants.cpp:1334</a></div></div>
<div class="ttc" id="classllvm_1_1GetElementPtrInst_html_a933a0843a97a4ef41022634d9a557de9"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html#a933a0843a97a4ef41022634d9a557de9">llvm::GetElementPtrInst::hasAllConstantIndices</a></div><div class="ttdeci">bool hasAllConstantIndices() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01414">Instructions.cpp:1414</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_af85a4828b6b5a8de7fc0a55cc0e5b52f"><div class="ttname"><a href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">llvm::Value::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdoc">All values hold a context through their type. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00517">Value.cpp:517</a></div></div>
<div class="ttc" id="classT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="classllvm_1_1DbgValueInst_html_adae1fa6a78df1a034751ba599b71ed68"><div class="ttname"><a href="classllvm_1_1DbgValueInst.html#adae1fa6a78df1a034751ba599b71ed68">llvm::DbgValueInst::getVariable</a></div><div class="ttdeci">MDNode * getVariable() const </div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00105">IntrinsicInst.h:105</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilderBase_html_a7badbb741cd23e73ad063428c9cd5fea"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a7badbb741cd23e73ad063428c9cd5fea">llvm::IRBuilderBase::getInt8PtrTy</a></div><div class="ttdeci">PointerType * getInt8PtrTy(unsigned AddrSpace=0)</div><div class="ttdoc">Fetch the type representing a pointer to an 8-bit integer value. </div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00335">IRBuilder.h:335</a></div></div>
<div class="ttc" id="ScalarReplAggregates_8cpp_html_a89033fbc159675f1d92988b218ee3426"><div class="ttname"><a href="ScalarReplAggregates_8cpp.html#a89033fbc159675f1d92988b218ee3426">isSafePHIToSpeculate</a></div><div class="ttdeci">static bool isSafePHIToSpeculate(PHINode *PN, const DataLayout *TD)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarReplAggregates_8cpp_source.html#l01175">ScalarReplAggregates.cpp:1175</a></div></div>
<div class="ttc" id="classllvm_1_1SelectInst_html_a67bf091383cd61e1225445e78b61d9f9"><div class="ttname"><a href="classllvm_1_1SelectInst.html#a67bf091383cd61e1225445e78b61d9f9">llvm::SelectInst::getTrueValue</a></div><div class="ttdeci">const Value * getTrueValue() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01467">Instructions.h:1467</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a9247a212ea89acc9573fa7e7f557eaba"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9247a212ea89acc9573fa7e7f557eaba">llvm::Instruction::setMetadata</a></div><div class="ttdeci">void setMetadata(unsigned KindID, MDNode *Node)</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l00589">Metadata.cpp:589</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_ab335e668fd33542ea14a2c7b527e64d3"><div class="ttname"><a href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a></div><div class="ttdeci">The same transformation can work with an even modulo with the addition of a and shrink the compare RHS by the same amount Unless the target supports that transformation probably isn t worthwhile The transformation can also easily be made to work with non zero equality for n</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00723">Target/README.txt:723</a></div></div>
<div class="ttc" id="namespacellvm_1_1X86II_html_a97dc14052814702ba0e2b14fb14dd02dac75439f87e76167e734537afa670905c"><div class="ttname"><a href="namespacellvm_1_1X86II.html#a97dc14052814702ba0e2b14fb14dd02dac75439f87e76167e734537afa670905c">llvm::X86II::DB</a></div><div class="ttdef"><b>Definition:</b> <a href="X86BaseInfo_8h_source.html#l00330">X86BaseInfo.h:330</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_ae84bb2408dfffa4e8b5fe2ce0714a3bd"><div class="ttname"><a href="classllvm_1_1DataLayout.html#ae84bb2408dfffa4e8b5fe2ce0714a3bd">llvm::DataLayout::getIntPtrType</a></div><div class="ttdeci">IntegerType * getIntPtrType(LLVMContext &amp;C, unsigned AddressSpace=0) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8cpp_source.html#l00610">DataLayout.cpp:610</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantVector_html_a5ce0c10fc8f570a6411da209203a1c6e"><div class="ttname"><a href="classllvm_1_1ConstantVector.html#a5ce0c10fc8f570a6411da209203a1c6e">llvm::ConstantVector::getSplat</a></div><div class="ttdeci">static Constant * getSplat(unsigned NumElts, Constant *Elt)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01021">Constants.cpp:1021</a></div></div>
<div class="ttc" id="classllvm_1_1IntegerType_html_a14f7b4f1aed38192fb6b7772eb506bdb"><div class="ttname"><a href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">llvm::IntegerType::get</a></div><div class="ttdeci">static IntegerType * get(LLVMContext &amp;C, unsigned NumBits)</div><div class="ttdoc">Get or create an IntegerType instance. </div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00305">Type.cpp:305</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_aba93ec4079f8d709a1d5b4745310782e"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#aba93ec4079f8d709a1d5b4745310782e">llvm::ConstantExpr::getBitCast</a></div><div class="ttdeci">static Constant * getBitCast(Constant *C, Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01672">Constants.cpp:1672</a></div></div>
<div class="ttc" id="classllvm_1_1MemIntrinsic_html"><div class="ttname"><a href="classllvm_1_1MemIntrinsic.html">llvm::MemIntrinsic</a></div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00118">IntrinsicInst.h:118</a></div></div>
<div class="ttc" id="classllvm_1_1ilist__iterator_html"><div class="ttname"><a href="classllvm_1_1ilist__iterator.html">llvm::ilist_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00050">ilist.h:50</a></div></div>
<div class="ttc" id="Target_2ARM_2README_8txt_html_a1b45f45820a60c09244a87eb59824aec"><div class="ttname"><a href="Target_2ARM_2README_8txt.html#a1b45f45820a60c09244a87eb59824aec">S</a></div><div class="ttdeci">add sub stmia L5 ldr r0 bl L_printf $stub Instead of a and a wouldn t it be better to do three moves *Return an aggregate type is even return S</div><div class="ttdef"><b>Definition:</b> <a href="Target_2ARM_2README_8txt_source.html#l00197">Target/ARM/README.txt:197</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html">llvm::SmallPtrSet</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00236">SmallPtrSet.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1PointerType_html_a8db49fd5069f21d514e7bb0fd11f0902"><div class="ttname"><a href="classllvm_1_1PointerType.html#a8db49fd5069f21d514e7bb0fd11f0902">llvm::PointerType::getUnqual</a></div><div class="ttdeci">static PointerType * getUnqual(Type *ElementType)</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00436">DerivedTypes.h:436</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_a87901387c729722d5d63edd1d35119d7"><div class="ttname"><a href="classllvm_1_1DataLayout.html#a87901387c729722d5d63edd1d35119d7">llvm::DataLayout::fitsInLegalInteger</a></div><div class="ttdeci">bool fitsInLegalInteger(unsigned Width) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00230">DataLayout.h:230</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html"><div class="ttname"><a href="classllvm_1_1ConstantInt.html">llvm::ConstantInt</a></div><div class="ttdoc">Class for constant integers. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00051">Constants.h:51</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_ad0affa936bea7c530da1597e9bb60bbd"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#ad0affa936bea7c530da1597e9bb60bbd">llvm::IRBuilder::CreateExtractElement</a></div><div class="ttdeci">Value * CreateExtractElement(Value *Vec, Value *Idx, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01349">IRBuilder.h:1349</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a277dfeaad2a2ada72a6024b0eedc5301"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a277dfeaad2a2ada72a6024b0eedc5301">llvm::IRBuilder::CreateZExt</a></div><div class="ttdeci">Value * CreateZExt(Value *V, Type *DestTy, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01071">IRBuilder.h:1071</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_aba6a4cc4ed6d6fef3664b8d65ef04820"><div class="ttname"><a href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">llvm::PHINode::getIncomingValue</a></div><div class="ttdeci">Value * getIncomingValue(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02059">Instructions.h:2059</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_a1d6fcc02e91ba24510aba42660c90e29"><div class="ttname"><a href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">llvm::DataLayout::getTypeAllocSize</a></div><div class="ttdeci">uint64_t getTypeAllocSize(Type *Ty) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00326">DataLayout.h:326</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00029">Target/README.txt:29</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0b4e7bee9b8575cc7db73329f1a561bd"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">llvm::BasicBlock::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00195">BasicBlock.h:195</a></div></div>
<div class="ttc" id="classllvm_1_1LoadAndStorePromoter_html"><div class="ttname"><a href="classllvm_1_1LoadAndStorePromoter.html">llvm::LoadAndStorePromoter</a></div><div class="ttdoc">Helper class for promoting a collection of loads and stores into SSA Form using the SSAUpdater...</div><div class="ttdef"><b>Definition:</b> <a href="SSAUpdater_8h_source.html#l00133">SSAUpdater.h:133</a></div></div>
<div class="ttc" id="namespacellvm_html_ab3d313ef442aae5b5bebf03c923506d0"><div class="ttname"><a href="namespacellvm.html#ab3d313ef442aae5b5bebf03c923506d0">llvm::ConvertDebugDeclareToDebugValue</a></div><div class="ttdeci">bool ConvertDebugDeclareToDebugValue(DbgDeclareInst *DDI, StoreInst *SI, DIBuilder &amp;Builder)</div><div class="ttdef"><b>Definition:</b> <a href="Local_8cpp_source.html#l00971">Local.cpp:971</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a87b363b9dad9f5040ea7e29ea9e60ff5"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a87b363b9dad9f5040ea7e29ea9e60ff5">llvm::IRBuilder::CreateBitCast</a></div><div class="ttdeci">Value * CreateBitCast(Value *V, Type *DestTy, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01132">IRBuilder.h:1132</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00880">SmallVector.h:880</a></div></div>
<div class="ttc" id="classllvm_1_1MDNode_html_a05433bf2c7b926ea34946266b6a222e3"><div class="ttname"><a href="classllvm_1_1MDNode.html#a05433bf2c7b926ea34946266b6a222e3">llvm::MDNode::getIfExists</a></div><div class="ttdeci">static MDNode * getIfExists(LLVMContext &amp;Context, ArrayRef&lt; Value * &gt; Vals)</div><div class="ttdef"><b>Definition:</b> <a href="Metadata_8cpp_source.html#l00278">Metadata.cpp:278</a></div></div>
<div class="ttc" id="Module_8h_html"><div class="ttname"><a href="Module_8h.html">Module.h</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a0cf3748dba54f931bb1241ae4adc76bc"><div class="ttname"><a href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00111">Value.h:111</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_aafa29112cbe02e4adc9b36752c771991"><div class="ttname"><a href="classllvm_1_1Instruction.html#aafa29112cbe02e4adc9b36752c771991">llvm::Instruction::getMetadata</a></div><div class="ttdeci">MDNode * getMetadata(unsigned KindID) const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00140">Instruction.h:140</a></div></div>
<div class="ttc" id="namespacellvm_html_a4fc3b9dced401b7561bb2c0780c2d918"><div class="ttname"><a href="namespacellvm.html#a4fc3b9dced401b7561bb2c0780c2d918">llvm::initializeSROA_SSAUpPass</a></div><div class="ttdeci">void initializeSROA_SSAUpPass(PassRegistry &amp;)</div></div>
<div class="ttc" id="classllvm_1_1CastInst_html_a1ff119ca13ef1b365ee0c9fa6e7fb861"><div class="ttname"><a href="classllvm_1_1CastInst.html#a1ff119ca13ef1b365ee0c9fa6e7fb861">llvm::CastInst::getDestTy</a></div><div class="ttdeci">Type * getDestTy() const </div><div class="ttdoc">Return the destination type, as a convenience. </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00610">InstrTypes.h:610</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilderBase_html_ac0e8c554bf1c1e117a74d51df89c137d"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#ac0e8c554bf1c1e117a74d51df89c137d">llvm::IRBuilderBase::getInt32</a></div><div class="ttdeci">ConstantInt * getInt32(uint32_t C)</div><div class="ttdoc">Get a constant 32-bit value. </div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00276">IRBuilder.h:276</a></div></div>
<div class="ttc" id="classllvm_1_1GetElementPtrInst_html_abfc8f5fb56fb06e32a26f28ba7ec1c0b"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html#abfc8f5fb56fb06e32a26f28ba7ec1c0b">llvm::GetElementPtrInst::getType</a></div><div class="ttdeci">SequentialType * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00764">Instructions.h:764</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a38ea12c04523d63adda732b9c5d6da0a"><div class="ttname"><a href="classllvm_1_1Value.html#a38ea12c04523d63adda732b9c5d6da0a">llvm::Value::stripPointerCasts</a></div><div class="ttdeci">Value * stripPointerCasts()</div><div class="ttdoc">Strips off any unneeded pointer casts, all-zero GEPs and aliases from the specified value...</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00385">Value.cpp:385</a></div></div>
<div class="ttc" id="classllvm_1_1StructLayout_html_a795cfd43d30c44c33b97fe850bc0451f"><div class="ttname"><a href="classllvm_1_1StructLayout.html#a795cfd43d30c44c33b97fe850bc0451f">llvm::StructLayout::getElementContainingOffset</a></div><div class="ttdeci">unsigned getElementContainingOffset(uint64_t Offset) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8cpp_source.html#l00078">DataLayout.cpp:78</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a9105541412dab869e18b3cceebfff07d"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">llvm::ConstantInt::get</a></div><div class="ttdeci">static Constant * get(Type *Ty, uint64_t V, bool isSigned=false)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00492">Constants.cpp:492</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html_af11a6ebf7ab3c388234cb6d5378439a3"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#af11a6ebf7ab3c388234cb6d5378439a3">llvm::AnalysisUsage::setPreservesCFG</a></div><div class="ttdeci">void setPreservesCFG()</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8cpp_source.html#l00249">Pass.cpp:249</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a30f2c362631e3728d2f47a8203071ade"><div class="ttname"><a href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">llvm::Function::getEntryBlock</a></div><div class="ttdeci">const BasicBlock &amp; getEntryBlock() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00380">Function.h:380</a></div></div>
<div class="ttc" id="namespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs - Return a circular-buffered debug stream. </div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00101">Debug.cpp:101</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_a150b33ecedbc8c7803c2db8040fbe3f8"><div class="ttname"><a href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">llvm::CallInst::getArgOperand</a></div><div class="ttdeci">Value * getArgOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01245">Instructions.h:1245</a></div></div>
<div class="ttc" id="classllvm_1_1VectorType_html"><div class="ttname"><a href="classllvm_1_1VectorType.html">llvm::VectorType</a></div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00358">DerivedTypes.h:358</a></div></div>
<div class="ttc" id="GlobalVariable_8h_html"><div class="ttname"><a href="GlobalVariable_8h.html">GlobalVariable.h</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html"><div class="ttname"><a href="classllvm_1_1APInt.html">llvm::APInt</a></div><div class="ttdoc">Class for arbitrary precision integers. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00075">APInt.h:75</a></div></div>
<div class="ttc" id="CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="CodeGen_2README_8txt_source.html#l00036">CodeGen/README.txt:36</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a6e328feb83afa5cf1c966d6704e43fc1"><div class="ttname"><a href="classllvm_1_1Type.html#a6e328feb83afa5cf1c966d6704e43fc1">llvm::Type::isIntegerTy</a></div><div class="ttdeci">bool isIntegerTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00196">Type.h:196</a></div></div>
<div class="ttc" id="Pass_8h_html"><div class="ttname"><a href="Pass_8h.html">Pass.h</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a5ac211f24970dea81fa9a7118a8ce36b"><div class="ttname"><a href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">llvm::Instruction::use_back</a></div><div class="ttdeci">Instruction * use_back()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00049">Instruction.h:49</a></div></div>
<div class="ttc" id="Function_8h_html"><div class="ttname"><a href="Function_8h.html">Function.h</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a8bbeae6f9dd03923c7cf63a6ff9f4036"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a8bbeae6f9dd03923c7cf63a6ff9f4036">llvm::IRBuilder::CreateInsertValue</a></div><div class="ttdeci">Value * CreateInsertValue(Value *Agg, Value *Val, ArrayRef&lt; unsigned &gt; Idxs, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01383">IRBuilder.h:1383</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a8a045d250952c0867382a9840ee18fdf"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">llvm::SmallVectorTemplateCommon&lt; T &gt;::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00112">SmallVector.h:112</a></div></div>
<div class="ttc" id="classllvm_1_1generic__gep__type__iterator_html_a8ca2ac53bb7661363b852abc99971d74"><div class="ttname"><a href="classllvm_1_1generic__gep__type__iterator.html#a8ca2ac53bb7661363b852abc99971d74">llvm::generic_gep_type_iterator::getOperand</a></div><div class="ttdeci">Value * getOperand() const </div><div class="ttdef"><b>Definition:</b> <a href="GetElementPtrTypeIterator_8h_source.html#l00066">GetElementPtrTypeIterator.h:66</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a4d49fd9a4cc4f2a74d4555bd08b13910"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a4d49fd9a4cc4f2a74d4555bd08b13910">llvm::IRBuilder::CreateShl</a></div><div class="ttdeci">Value * CreateShl(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;, bool HasNUW=false, bool HasNSW=false)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00734">IRBuilder.h:734</a></div></div>
<div class="ttc" id="ScalarReplAggregates_8cpp_html_a756c240784833c6e582f1ffbef25667e"><div class="ttname"><a href="ScalarReplAggregates_8cpp.html#a756c240784833c6e582f1ffbef25667e">INITIALIZE_PASS_BEGIN</a></div><div class="ttdeci">INITIALIZE_PASS_BEGIN(SROA_DT,&quot;scalarrepl&quot;,&quot;Scalar Replacement of Aggregates (DT)&quot;, false, false) INITIALIZE_PASS_END(SROA_DT</div></div>
<div class="ttc" id="classllvm_1_1Value_html_ae6a2729f1446acc2ae3e5a05bc2a5a4b"><div class="ttname"><a href="classllvm_1_1Value.html#ae6a2729f1446acc2ae3e5a05bc2a5a4b">llvm::Value::isDereferenceablePointer</a></div><div class="ttdeci">bool isDereferenceablePointer() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00500">Value.cpp:500</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a413abcab8dbc3900fc2fde96a5d8fca6"><div class="ttname"><a href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">llvm::Value::use_begin</a></div><div class="ttdeci">use_iterator use_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00150">Value.h:150</a></div></div>
<div class="ttc" id="GetElementPtrTypeIterator_8h_html"><div class="ttname"><a href="GetElementPtrTypeIterator_8h.html">GetElementPtrTypeIterator.h</a></div></div>
<div class="ttc" id="namespacellvm_html_af36d7e69ab16b64b2e3a48c83aa9f0f6"><div class="ttname"><a href="namespacellvm.html#af36d7e69ab16b64b2e3a48c83aa9f0f6">llvm::MinAlign</a></div><div class="ttdeci">uint64_t MinAlign(uint64_t A, uint64_t B)</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00535">MathExtras.h:535</a></div></div>
<div class="ttc" id="classllvm_1_1MemTransferInst_html"><div class="ttname"><a href="classllvm_1_1MemTransferInst.html">llvm::MemTransferInst</a></div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00213">IntrinsicInst.h:213</a></div></div>
<div class="ttc" id="Transforms_2Scalar_8h_html"><div class="ttname"><a href="Transforms_2Scalar_8h.html">Scalar.h</a></div></div>
<div class="ttc" id="ScalarReplAggregates_8cpp_html_a8696165958abcc64cb88491c32c3e4bf"><div class="ttname"><a href="ScalarReplAggregates_8cpp.html#a8696165958abcc64cb88491c32c3e4bf">isSafeSelectToSpeculate</a></div><div class="ttdeci">static bool isSafeSelectToSpeculate(SelectInst *SI, const DataLayout *TD)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarReplAggregates_8cpp_source.html#l01137">ScalarReplAggregates.cpp:1137</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a30dd396c5b40cd86c1591872e574ccdf"><div class="ttname"><a href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">llvm::Type::getInt32Ty</a></div><div class="ttdeci">static IntegerType * getInt32Ty(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00241">Type.cpp:241</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad9a329f9f85bc896a726a628aa3f4e9d"><div class="ttname"><a href="classllvm_1_1Value.html#ad9a329f9f85bc896a726a628aa3f4e9d">llvm::Value::use_back</a></div><div class="ttdeci">User * use_back()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00154">Value.h:154</a></div></div>
<div class="ttc" id="classllvm_1_1DbgValueInst_html"><div class="ttname"><a href="classllvm_1_1DbgValueInst.html">llvm::DbgValueInst</a></div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00097">IntrinsicInst.h:97</a></div></div>
<div class="ttc" id="classllvm_1_1LoadInst_html_ad1168fc42bcba1b71217a4969483671a"><div class="ttname"><a href="classllvm_1_1LoadInst.html#ad1168fc42bcba1b71217a4969483671a">llvm::LoadInst::getAlignment</a></div><div class="ttdeci">unsigned getAlignment() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00181">Instructions.h:181</a></div></div>
<div class="ttc" id="MD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00054">MD5.cpp:54</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a5cb76a65b6524dba1493dd2b9dc3abbe"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">llvm::BasicBlock::getTerminator</a></div><div class="ttdeci">TerminatorInst * getTerminator()</div><div class="ttdoc">Returns the terminator instruction if the block is well formed or null if the block is not well forme...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00120">BasicBlock.cpp:120</a></div></div>
<div class="ttc" id="ScalarReplAggregates_8cpp_html_a3d60b300c3988b10f2e6d963d3707f58"><div class="ttname"><a href="ScalarReplAggregates_8cpp.html#a3d60b300c3988b10f2e6d963d3707f58">ssa</a></div><div class="ttdeci">Scalar Replacement of false scalarrepl ssa</div><div class="ttdef"><b>Definition:</b> <a href="ScalarReplAggregates_8cpp_source.html#l00233">ScalarReplAggregates.cpp:233</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilderBase_html_a58f62481bd3a4bfc5d07102fe857741a"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a58f62481bd3a4bfc5d07102fe857741a">llvm::IRBuilderBase::CreateMemSet</a></div><div class="ttdeci">CallInst * CreateMemSet(Value *Ptr, Value *Val, uint64_t Size, unsigned Align, bool isVolatile=false, MDNode *TBAATag=0)</div><div class="ttdoc">Create and insert a memset to the specified pointer and the specified value. </div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00353">IRBuilder.h:353</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_a1f2303df9bbee2233c11d61c2f6f7930"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#a1f2303df9bbee2233c11d61c2f6f7930">llvm::SmallVectorTemplateBase::pop_back</a></div><div class="ttdeci">void pop_back()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00260">SmallVector.h:260</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a8eafa71cf399da8f21b2af5549f3f9e7"><div class="ttname"><a href="classllvm_1_1Type.html#a8eafa71cf399da8f21b2af5549f3f9e7">llvm::Type::getScalarType</a></div><div class="ttdeci">const Type * getScalarType() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00051">Type.cpp:51</a></div></div>
<div class="ttc" id="DIBuilder_8h_html"><div class="ttname"><a href="DIBuilder_8h.html">DIBuilder.h</a></div></div>
<div class="ttc" id="ValueTracking_8h_html"><div class="ttname"><a href="ValueTracking_8h.html">ValueTracking.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8">llvm::A64CC::NV</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00046">AArch64BaseInfo.h:46</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a5a7cfa245af120b44ac8a86143bb9e57"><div class="ttname"><a href="classllvm_1_1Type.html#a5a7cfa245af120b44ac8a86143bb9e57">llvm::Type::getPrimitiveSizeInBits</a></div><div class="ttdeci">unsigned getPrimitiveSizeInBits() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00117">Type.cpp:117</a></div></div>
<div class="ttc" id="IRBuilder_8h_html"><div class="ttname"><a href="IRBuilder_8h.html">IRBuilder.h</a></div></div>
<div class="ttc" id="ScalarReplAggregates_8cpp_html_aed0e85fc9abd34c5e7c4a96386d33007"><div class="ttname"><a href="ScalarReplAggregates_8cpp.html#aed0e85fc9abd34c5e7c4a96386d33007">isCompatibleAggregate</a></div><div class="ttdeci">static bool isCompatibleAggregate(Type *T1, Type *T2)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarReplAggregates_8cpp_source.html#l01770">ScalarReplAggregates.cpp:1770</a></div></div>
<div class="ttc" id="ScalarReplAggregates_8cpp_html_a5cbfdaa36d24d28ff146ab89883eaba8"><div class="ttname"><a href="ScalarReplAggregates_8cpp.html#a5cbfdaa36d24d28ff146ab89883eaba8">HasPadding</a></div><div class="ttdeci">static bool HasPadding(Type *Ty, const DataLayout &amp;TD)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarReplAggregates_8cpp_source.html#l02534">ScalarReplAggregates.cpp:2534</a></div></div>
<div class="ttc" id="LLVMContext_8h_html"><div class="ttname"><a href="LLVMContext_8h.html">LLVMContext.h</a></div></div>
<div class="ttc" id="CaptureTracking_8cpp_html_ac30708db2a991631cbf3d95c6324d929"><div class="ttname"><a href="CaptureTracking_8cpp.html#ac30708db2a991631cbf3d95c6324d929">Threshold</a></div><div class="ttdeci">static int const Threshold</div><div class="ttdef"><b>Definition:</b> <a href="CaptureTracking_8cpp_source.html#l00080">CaptureTracking.cpp:80</a></div></div>
<div class="ttc" id="SetVector_8h_html"><div class="ttname"><a href="SetVector_8h.html">SetVector.h</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ac38c53f76ef532f91f1666c8a87370e9"><div class="ttname"><a href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">llvm::Value::use_empty</a></div><div class="ttdeci">bool use_empty() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00149">Value.h:149</a></div></div>
<div class="ttc" id="ARMSubtarget_8cpp_html_a4bd80d4e433d9f72af26b364036900dc"><div class="ttname"><a href="ARMSubtarget_8cpp.html#a4bd80d4e433d9f72af26b364036900dc">Align</a></div><div class="ttdeci">static cl::opt&lt; AlignMode &gt; Align(cl::desc(&quot;Load/store alignment support&quot;), cl::Hidden, cl::init(DefaultAlign), cl::values(clEnumValN(DefaultAlign,&quot;arm-default-align&quot;,&quot;Generate unaligned accesses only on hardware/OS &quot;&quot;combinations that are known to support them&quot;), clEnumValN(StrictAlign,&quot;arm-strict-align&quot;,&quot;Disallow all unaligned memory accesses&quot;), clEnumValN(NoStrictAlign,&quot;arm-no-strict-align&quot;,&quot;Allow unaligned memory accesses&quot;), clEnumValEnd))</div></div>
<div class="ttc" id="Local_8h_html"><div class="ttname"><a href="Local_8h.html">Local.h</a></div></div>
<div class="ttc" id="namespacetrue_html"><div class="ttname"><a href="namespacetrue.html">true</a></div><div class="ttdef"><b>Definition:</b> <a href="DominanceFrontier_8cpp_source.html#l00024">DominanceFrontier.cpp:24</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_a9e1fc23a17e97d2d1732e753ae9251ac"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">llvm::GlobalValue::getParent</a></div><div class="ttdeci">Module * getParent()</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00286">GlobalValue.h:286</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_aa933549689e79685bb67de64dddc9f7c"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#aa933549689e79685bb67de64dddc9f7c">llvm::IRBuilder::CreateTrunc</a></div><div class="ttdeci">Value * CreateTrunc(Value *V, Type *DestTy, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l01068">IRBuilder.h:1068</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00066">Value.h:66</a></div></div>
<div class="ttc" id="classllvm_1_1StoreInst_html_a50d3891cd26db1308e81540f468de8c8"><div class="ttname"><a href="classllvm_1_1StoreInst.html#a50d3891cd26db1308e81540f468de8c8">llvm::StoreInst::setAlignment</a></div><div class="ttdeci">void setAlignment(unsigned Align)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01204">Instructions.cpp:1204</a></div></div>
<div class="ttc" id="classllvm_1_1SetVector_html"><div class="ttname"><a href="classllvm_1_1SetVector.html">llvm::SetVector</a></div><div class="ttdoc">A vector that has set insertion semantics. </div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00037">SetVector.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1VectorType_html_ab43657ed1abe2e2ed3a6a394f233ebd0"><div class="ttname"><a href="classllvm_1_1VectorType.html#ab43657ed1abe2e2ed3a6a394f233ebd0">llvm::VectorType::get</a></div><div class="ttdeci">static VectorType * get(Type *ElementType, unsigned NumElements)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00706">Type.cpp:706</a></div></div>
<div class="ttc" id="ScalarReplAggregates_8cpp_html_a7197c0101d6d4a90db6dfb8a0216f69f"><div class="ttname"><a href="ScalarReplAggregates_8cpp.html#a7197c0101d6d4a90db6dfb8a0216f69f">isHomogeneousAggregate</a></div><div class="ttdeci">static bool isHomogeneousAggregate(Type *T, unsigned &amp;NumElts, Type *&amp;EltTy)</div><div class="ttdef"><b>Definition:</b> <a href="ScalarReplAggregates_8cpp_source.html#l01749">ScalarReplAggregates.cpp:1749</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilderBase_html_a9a1fcb8473324a0f50ce3ddb823054c2"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a9a1fcb8473324a0f50ce3ddb823054c2">llvm::IRBuilderBase::CreateLifetimeStart</a></div><div class="ttdeci">CallInst * CreateLifetimeStart(Value *Ptr, ConstantInt *Size=0)</div><div class="ttdoc">Create a lifetime.start intrinsic. </div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8cpp_source.html#l00125">IRBuilder.cpp:125</a></div></div>
<div class="ttc" id="SmallVector_8h_html"><div class="ttname"><a href="SmallVector_8h.html">SmallVector.h</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_af67d1f3a518964d80a109bb3d9d5cf1e"><div class="ttname"><a href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">llvm::Instruction::moveBefore</a></div><div class="ttdeci">void moveBefore(Instruction *MovePos)</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00091">Instruction.cpp:91</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">llvm::A64CC::MI</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00035">AArch64BaseInfo.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a9dc5111b1a9b1d5c4652d50f74fe850b"><div class="ttname"><a href="classllvm_1_1Type.html#a9dc5111b1a9b1d5c4652d50f74fe850b">llvm::Type::isSized</a></div><div class="ttdeci">bool isSized() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00278">Type.h:278</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_add914112e0b2935dda06ad5dfd3a31db"><div class="ttname"><a href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">llvm::DataLayout::getTypeSizeInBits</a></div><div class="ttdeci">uint64_t getTypeSizeInBits(Type *Ty) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00459">DataLayout.h:459</a></div></div>
<div class="ttc" id="Debug_8h_html_aef41e8aaf4c60819b30faf396cdf4978"><div class="ttname"><a href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a></div><div class="ttdeci">#define DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00097">Debug.h:97</a></div></div>
<div class="ttc" id="namespacellvm_html_af4d1a918800291e75b01ce1447be0e83"><div class="ttname"><a href="namespacellvm.html#af4d1a918800291e75b01ce1447be0e83">llvm::isPowerOf2_32</a></div><div class="ttdeci">bool isPowerOf2_32(uint32_t Value)</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00354">MathExtras.h:354</a></div></div>
<div class="ttc" id="classllvm_1_1SelectInst_html_a29a16f32075ee4f23cd769701463952c"><div class="ttname"><a href="classllvm_1_1SelectInst.html#a29a16f32075ee4f23cd769701463952c">llvm::SelectInst::getFalseValue</a></div><div class="ttdeci">const Value * getFalseValue() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01468">Instructions.h:1468</a></div></div>
<div class="ttc" id="raw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="classllvm_1_1GetElementPtrInst_html_a3e10b4db1ded36654416d3aed2bc56ba"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html#a3e10b4db1ded36654416d3aed2bc56ba">llvm::GetElementPtrInst::CreateInBounds</a></div><div class="ttdeci">static GetElementPtrInst * CreateInBounds(Value *Ptr, ArrayRef&lt; Value * &gt; IdxList, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00743">Instructions.h:743</a></div></div>
<div class="ttc" id="classllvm_1_1StructType_html_aa2113dcf8c96c19c9a2abf786b9ad3b7"><div class="ttname"><a href="classllvm_1_1StructType.html#aa2113dcf8c96c19c9a2abf786b9ad3b7">llvm::StructType::getNumElements</a></div><div class="ttdeci">unsigned getNumElements() const </div><div class="ttdoc">Random access to the elements. </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00286">DerivedTypes.h:286</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_a9b876cc57d1884621f481b26b0892633"><div class="ttname"><a href="classllvm_1_1DataLayout.html#a9b876cc57d1884621f481b26b0892633">llvm::DataLayout::isBigEndian</a></div><div class="ttdeci">bool isBigEndian() const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00196">DataLayout.h:196</a></div></div>
<div class="ttc" id="classllvm_1_1DbgDeclareInst_html"><div class="ttname"><a href="classllvm_1_1DbgDeclareInst.html">llvm::DbgDeclareInst</a></div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00081">IntrinsicInst.h:81</a></div></div>
<div class="ttc" id="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode_html_a0c4e2aa2235abdd10d2beffa32cd9b14"><div class="ttname"><a href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a0c4e2aa2235abdd10d2beffa32cd9b14">llvm::NVPTX::PTXLdStInstCode::FromType</a></div><div class="ttdeci">FromType</div><div class="ttdef"><b>Definition:</b> <a href="NVPTX_8h_source.html#l00120">NVPTX.h:120</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a9cd49851904f15060edb782ef4dd1b2d"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00052">Instruction.h:52</a></div></div>
<div class="ttc" id="namespacellvm_html_af6d6a791770bad2303c4399986979e3eabd20bd987f5233a02a053b0c90f35aa6"><div class="ttname"><a href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eabd20bd987f5233a02a053b0c90f35aa6">llvm::Unknown</a></div><div class="ttdef"><b>Definition:</b> <a href="CallingConvLower_8h_source.html#l00149">CallingConvLower.h:149</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a73349916f7e54a6b988a3646c7a02e90ae365354e47542c51f9bd46e329e3323e"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ae365354e47542c51f9bd46e329e3323e">llvm::Intrinsic::lifetime_start</a></div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l01255">Intrinsics.h:1255</a></div></div>
<div class="ttc" id="Mips16ISelLowering_8cpp_html_ac16509a75e3d3fc46b9df1726be486ec"><div class="ttname"><a href="Mips16ISelLowering_8cpp.html#ac16509a75e3d3fc46b9df1726be486ec">T1</a></div><div class="ttdeci">#define T1</div><div class="ttdef"><b>Definition:</b> <a href="Mips16ISelLowering_8cpp_source.html#l00348">Mips16ISelLowering.cpp:348</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilderBase_html_a849b50da820a274b4d001fbeadaf5cd7"><div class="ttname"><a href="classllvm_1_1IRBuilderBase.html#a849b50da820a274b4d001fbeadaf5cd7">llvm::IRBuilderBase::CreateMemCpy</a></div><div class="ttdeci">CallInst * CreateMemCpy(Value *Dst, Value *Src, uint64_t Size, unsigned Align, bool isVolatile=false, MDNode *TBAATag=0, MDNode *TBAAStructTag=0)</div><div class="ttdoc">Create and insert a memcpy between the specified pointers. </div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00365">IRBuilder.h:365</a></div></div>
<div class="ttc" id="classllvm_1_1IntrinsicInst_html"><div class="ttname"><a href="classllvm_1_1IntrinsicInst.html">llvm::IntrinsicInst</a></div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00036">IntrinsicInst.h:36</a></div></div>
<div class="ttc" id="classllvm_1_1AllocaInst_html"><div class="ttname"><a href="classllvm_1_1AllocaInst.html">llvm::AllocaInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00058">Instructions.h:58</a></div></div>
<div class="ttc" id="namespacellvm_html_ac828b9b52935f87659a4adf237f820a3"><div class="ttname"><a href="namespacellvm.html#ac828b9b52935f87659a4adf237f820a3">llvm::gep_type_begin</a></div><div class="ttdeci">gep_type_iterator gep_type_begin(const User *GEP)</div><div class="ttdef"><b>Definition:</b> <a href="GetElementPtrTypeIterator_8h_source.html#l00085">GetElementPtrTypeIterator.h:85</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<p class="footer">
Generated on Sat Nov 10 2018 23:01:26 for <a href="http://llvm.org/">LLVM</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.8.11</a><br>
Copyright &copy; 2003-2013 University of Illinois at Urbana-Champaign.
All Rights Reserved.</p>
<hr>
<!--#include virtual="/attrib.incl" -->
</body>
</html>
