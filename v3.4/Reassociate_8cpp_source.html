<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="LLVM,Low Level Virtual Machine,C++,doxygen,API,documentation"/>
<meta name="description" content="C++ source code API documentation for LLVM."/>
<title>LLVM: Reassociate.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">LLVM API Documentation</p>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('Reassociate_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Reassociate.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="Reassociate_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- Reassociate.cpp - Reassociate binary expressions -------------------===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                     The LLVM Compiler Infrastructure</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is distributed under the University of Illinois Open Source</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License. See LICENSE.TXT for details.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// This pass reassociates commutative expressions in an order that is designed</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// to promote better constant propagation, GCSE, LICM, PRE, etc.</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// For example: 4 + (x + 5) -&gt; x + (4 + 5)</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// In the implementation of this algorithm, constants are assigned rank = 0,</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// function arguments are rank = 1, and other values are assigned ranks</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// corresponding to the reverse post order traversal of current function</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// (starting at 2), which effectively gives values in deep loops higher rank</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">// than values not in loops.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   23</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;reassociate&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Transforms_2Scalar_8h.html">llvm/Transforms/Scalar.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseMap_8h.html">llvm/ADT/DenseMap.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PostOrderIterator_8h.html">llvm/ADT/PostOrderIterator.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SetVector_8h.html">llvm/ADT/SetVector.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Writer_8h.html">llvm/Assembly/Writer.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DerivedTypes_8h.html">llvm/IR/DerivedTypes.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Function_8h.html">llvm/IR/Function.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IRBuilder_8h.html">llvm/IR/IRBuilder.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IntrinsicInst_8h.html">llvm/IR/IntrinsicInst.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Pass_8h.html">llvm/Pass.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Support_2CFG_8h.html">llvm/Support/CFG.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueHandle_8h.html">llvm/Support/ValueHandle.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Local_8h.html">llvm/Transforms/Utils/Local.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<a class="code" href="Reassociate_8cpp.html#accc461d406589e0d5f010481a3095dc5">STATISTIC</a>(NumChanged, <span class="stringliteral">&quot;Number of insts reassociated&quot;</span>);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<a class="code" href="Reassociate_8cpp.html#accc461d406589e0d5f010481a3095dc5">STATISTIC</a>(NumAnnihil, <span class="stringliteral">&quot;Number of expr tree annihilated&quot;</span>);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<a class="code" href="Reassociate_8cpp.html#accc461d406589e0d5f010481a3095dc5">STATISTIC</a>(NumFactor , <span class="stringliteral">&quot;Number of multiplies factored&quot;</span>);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keyword">struct </span>ValueEntry {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordtype">unsigned</span> Rank;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Op;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    ValueEntry(<span class="keywordtype">unsigned</span> R, <a class="code" href="classllvm_1_1Value.html">Value</a> *O) : Rank(R), Op(O) {}</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  };</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a7c469a194119a14e5a018ebb9b847cf0">operator&lt;</a>(<span class="keyword">const</span> ValueEntry &amp;LHS, <span class="keyword">const</span> ValueEntry &amp;RHS) {</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">return</span> LHS.Rank &gt; RHS.Rank;   <span class="comment">// Sort so that highest rank goes to start.</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  }</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">/// PrintOps - Print out the expression identified in the Ops list.</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"></span><span class="comment">///</span></div><div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#a035830591fff503ea933e8c88c84f3f8">   64</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Reassociate_8cpp.html#a035830591fff503ea933e8c88c84f3f8">PrintOps</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops) {</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <a class="code" href="classllvm_1_1Module.html">Module</a> *<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> = I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>()-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>();</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a class="code" href="classllvm_1_1Instruction.html#a3d95172e192ecd22f18b0b76da6d2320">Instruction::getOpcodeName</a>(I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>()) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;       &lt;&lt; *Ops[0].Op-&gt;getType() &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;[ &quot;</span>;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="namespacellvm.html#ae712552495c21ee77ad82ced255ad6df">WriteAsOperand</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>(), Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op, <span class="keyword">false</span>, M);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;, #&quot;</span> &lt;&lt; Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Rank &lt;&lt; <span class="stringliteral">&quot;] &quot;</span>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  }</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">  /// \brief Utility class representing a base and exponent pair which form one</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">  /// factor of some product.</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span>Factor {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Base;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordtype">unsigned</span> Power;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    Factor(<a class="code" href="classllvm_1_1Value.html">Value</a> *Base, <span class="keywordtype">unsigned</span> Power) : Base(Base), Power(Power) {}</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">    /// \brief Sort factors by their Base.</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"></span>    <span class="keyword">struct </span>BaseSorter {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> Factor &amp;LHS, <span class="keyword">const</span> Factor &amp;RHS) {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">return</span> LHS.Base &lt; RHS.Base;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    };</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">    /// \brief Compare factors for equal bases.</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"></span>    <span class="keyword">struct </span>BaseEqual {</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> Factor &amp;LHS, <span class="keyword">const</span> Factor &amp;RHS) {</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">return</span> LHS.Base == RHS.Base;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      }</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    };</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">    /// \brief Sort factors in descending order by their power.</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"></span>    <span class="keyword">struct </span>PowerDescendingSorter {</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> Factor &amp;LHS, <span class="keyword">const</span> Factor &amp;RHS) {</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordflow">return</span> LHS.Power &gt; RHS.Power;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    };</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">    /// \brief Compare factors for equal powers.</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"></span>    <span class="keyword">struct </span>PowerEqual {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> Factor &amp;LHS, <span class="keyword">const</span> Factor &amp;RHS) {</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keywordflow">return</span> LHS.Power == RHS.Power;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      }</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    };</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  };</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="comment"></span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">  /// Utility class representing a non-constant Xor-operand. We classify</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">  /// non-constant Xor-Operands into two categories:</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">  ///  C1) The operand is in the form &quot;X &amp; C&quot;, where C is a constant and C != ~0</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">  ///  C2)</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">  ///    C2.1) The operand is in the form of &quot;X | C&quot;, where C is a non-zero</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">  ///          constant.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">  ///    C2.2) Any operand E which doesn&#39;t fall into C1 and C2.1, we view this</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">  ///          operand as &quot;E | 0&quot;</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment"></span>  <span class="keyword">class </span>XorOpnd {</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    XorOpnd(<a class="code" href="classllvm_1_1Value.html">Value</a> *V);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordtype">bool</span> isInvalid()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> SymbolicPart == 0; }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordtype">bool</span> isOrExpr()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> isOr; }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *getValue()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> OrigVal; }</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *getSymbolicPart()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> SymbolicPart; }</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordtype">unsigned</span> getSymbolicRank()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> SymbolicRank; }</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;getConstPart()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ConstPart; }</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordtype">void</span> Invalidate() { SymbolicPart = OrigVal = 0; }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordtype">void</span> setSymbolicRank(<span class="keywordtype">unsigned</span> R) { SymbolicRank = R; }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// Sort the XorOpnd-Pointer in ascending order of symbolic-value-rank.</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">// The purpose is twofold:</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">// 1) Cluster together the operands sharing the same symbolic-value.</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">// 2) Operand having smaller symbolic-value-rank is permuted earlier, which </span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">//   could potentially shorten crital path, and expose more loop-invariants.</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">//   Note that values&#39; rank are basically defined in RPO order (FIXME). </span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">//   So, if Rank(X) &lt; Rank(Y) &lt; Rank(Z), it means X is defined earlier </span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">//   than Y which is defined earlier than Z. Permute &quot;x | 1&quot;, &quot;Y &amp; 2&quot;,</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">//   &quot;z&quot; in the order of X-Y-Z is better than any other orders.</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keyword">struct </span>PtrSortFunctor {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      <span class="keywordtype">bool</span> operator()(XorOpnd * <span class="keyword">const</span> &amp;LHS, XorOpnd * <span class="keyword">const</span> &amp;RHS) {</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">return</span> LHS-&gt;getSymbolicRank() &lt; RHS-&gt;getSymbolicRank();</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    };</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keyword">private</span>:</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OrigVal;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *SymbolicPart;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> ConstPart;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordtype">unsigned</span> SymbolicRank;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordtype">bool</span> isOr;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  };</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;}</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keyword">class </span>Reassociate : <span class="keyword">public</span> <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;BasicBlock*, unsigned&gt;</a> RankMap;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;AssertingVH&lt;Value&gt;</a>, <span class="keywordtype">unsigned</span>&gt; ValueRankMap;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="classllvm_1_1SetVector.html">SetVector&lt;AssertingVH&lt;Instruction&gt;</a> &gt; RedoInsts;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordtype">bool</span> MadeChange;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a>; <span class="comment">// Pass identification, replacement for typeid</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    Reassociate() : <a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a>(ID) {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <a class="code" href="namespacellvm.html#a3365ab6a499cd47658f57dab9a8d4703">initializeReassociatePass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    }</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordtype">bool</span> runOnFunction(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const </span>{</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#af11a6ebf7ab3c388234cb6d5378439a3">setPreservesCFG</a>();</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keyword">private</span>:</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordtype">void</span> BuildRankMap(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordtype">unsigned</span> getRank(<a class="code" href="classllvm_1_1Value.html">Value</a> *V);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordtype">void</span> ReassociateExpression(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordtype">void</span> RewriteExprTree(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *I, <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OptimizeExpression(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *I,</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                              <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OptimizeAdd(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I, <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OptimizeXor(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I, <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordtype">bool</span> CombineXorOpnd(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I, XorOpnd *Opnd1, <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;ConstOpnd,</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                        <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;Res);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordtype">bool</span> CombineXorOpnd(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I, XorOpnd *Opnd1, XorOpnd *Opnd2,</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                        <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;ConstOpnd, <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;Res);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordtype">bool</span> collectMultiplyFactors(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops,</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Factor&gt;</a> &amp;Factors);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *buildMinimalMultiplyDAG(<a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder,</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                                   <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Factor&gt;</a> &amp;Factors);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *OptimizeMul(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *I, <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *RemoveFactorFromExpression(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Value.html">Value</a> *Factor);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordtype">void</span> EraseInst(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordtype">void</span> OptimizeInst(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  };</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;XorOpnd::XorOpnd(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  assert(!isa&lt;ConstantInt&gt;(V) &amp;&amp; <span class="stringliteral">&quot;No ConstantInt&quot;</span>);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  OrigVal = V;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(V);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  SymbolicRank = 0;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordflow">if</span> (I &amp;&amp; (I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>() == <a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a> ||</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>() == <a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">Instruction::And</a>)) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V0 = I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V1 = I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">if</span> (isa&lt;ConstantInt&gt;(V0))</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(V0, V1);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;ConstantInt&gt;(V1)) {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      ConstPart = <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;getValue();</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      SymbolicPart = V0;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      isOr = (I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>() == <a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a>);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  }</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="comment">// view the operand as &quot;V | 0&quot;</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  SymbolicPart = V;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  ConstPart = <a class="code" href="classllvm_1_1APInt.html#a4ba7d7f0a1e911c8384e236b5f6c1959">APInt::getNullValue</a>(V-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a0519dc6e2f153aaed61eed17d965a9f0">getIntegerBitWidth</a>());</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  isOr = <span class="keyword">true</span>;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;}</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">Reassociate::ID</a> = 0;</div><div class="line"><a name="l00228"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#ac2c09b1da0dee14d7f8c81a90992712e">  228</a></span>&#160;<a class="code" href="Reassociate_8cpp.html#ac2c09b1da0dee14d7f8c81a90992712e">INITIALIZE_PASS</a>(Reassociate, <span class="stringliteral">&quot;reassociate&quot;</span>,</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                <span class="stringliteral">&quot;Reassociate expressions&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">// Public interface to the Reassociate pass</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<a class="code" href="classllvm_1_1FunctionPass.html">FunctionPass</a> *<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="namespacellvm.html#abd087b119f6143ca14a6475168a91f54">createReassociatePass</a>() { <span class="keywordflow">return</span> <span class="keyword">new</span> Reassociate(); }</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">/// isReassociableOp - Return true if V is an instruction of the specified</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">/// opcode and if it only has one use.</span></div><div class="line"><a name="l00236"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">  236</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *<a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keywordtype">unsigned</span> Opcode) {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">if</span> (V-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>() &amp;&amp; isa&lt;Instruction&gt;(V) &amp;&amp;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      cast&lt;Instruction&gt;(V)-&gt;getOpcode() == Opcode)</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">return</span> cast&lt;BinaryOperator&gt;(V);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;}</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#a1916c6024adf200133717bb5227fcbf4">  243</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="Reassociate_8cpp.html#a1916c6024adf200133717bb5227fcbf4">isUnmovableInstruction</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keywordflow">switch</span> (I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>()) {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">Instruction::PHI</a>:</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordflow">case</span> Instruction::LandingPad:</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordflow">case</span> Instruction::Alloca:</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1SPII.html#a11e9b8fca4a074643a6a21f444e51406a5069619ca8fdce305534f3fe85091a0f">Instruction::Load</a>:</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordflow">case</span> Instruction::Invoke:</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="keywordflow">case</span> Instruction::UDiv:</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keywordflow">case</span> Instruction::SDiv:</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordflow">case</span> Instruction::FDiv:</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordflow">case</span> Instruction::URem:</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordflow">case</span> Instruction::SRem:</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordflow">case</span> Instruction::FRem:</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">Instruction::Call</a>:</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">return</span> !isa&lt;DbgInfoIntrinsic&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keywordflow">default</span>:</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  }</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;}</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="keywordtype">void</span> Reassociate::BuildRankMap(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>) {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 2;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">// Assign distinct ranks to function arguments</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Function::arg_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = F.<a class="code" href="classllvm_1_1Function.html#a8bf193a781a92cae52d7f9216d0824f8">arg_begin</a>(), E = F.<a class="code" href="classllvm_1_1Function.html#a8300ac1ef141b8a7c63c13fa9369d976">arg_end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    ValueRankMap[&amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = ++i;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <a class="code" href="classllvm_1_1ReversePostOrderTraversal.html">ReversePostOrderTraversal&lt;Function*&gt;</a> RPOT(&amp;F);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ReversePostOrderTraversal.html#aa447608e2881e813215c3f289496c6ea">ReversePostOrderTraversal&lt;Function*&gt;::rpo_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = RPOT.<a class="code" href="classllvm_1_1ReversePostOrderTraversal.html#ac958000d711f19778f1b40792821b5b3">begin</a>(),</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;         E = RPOT.<a class="code" href="classllvm_1_1ReversePostOrderTraversal.html#ae945899e1218a9240c3fed1e5789cbba">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordtype">unsigned</span> BBRank = RankMap[<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>] = ++i &lt;&lt; 16;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="comment">// Walk the basic block, adding precomputed ranks for any instructions that</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="comment">// we cannot move.  This ensures that the ranks for these instructions are</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// all different in the block.</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), E = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="Reassociate_8cpp.html#a1916c6024adf200133717bb5227fcbf4">isUnmovableInstruction</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        ValueRankMap[&amp;*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = ++BBRank;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  }</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;}</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="keywordtype">unsigned</span> Reassociate::getRank(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(V);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordflow">if</span> (I == 0) {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">if</span> (isa&lt;Argument&gt;(V)) <span class="keywordflow">return</span> ValueRankMap[V];   <span class="comment">// Function argument.</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">return</span> 0;  <span class="comment">// Otherwise it&#39;s a global or constant, rank 0.</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordflow">if</span> (<span class="keywordtype">unsigned</span> Rank = ValueRankMap[I])</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">return</span> Rank;    <span class="comment">// Rank already known?</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="comment">// If this is an expression, return the 1+MAX(rank(LHS), rank(RHS)) so that</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="comment">// we can reassociate expressions for code motion!  Since we do not recurse</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="comment">// for PHI nodes, we cannot have infinite recursion here, because there</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="comment">// cannot be loops in the value graph that do not go through PHI nodes.</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordtype">unsigned</span> Rank = 0, MaxRank = RankMap[I-&gt;getParent()];</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = I-&gt;getNumOperands();</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;       <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e &amp;&amp; Rank != MaxRank; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    Rank = std::max(Rank, getRank(I-&gt;getOperand(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)));</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="comment">// If this is a not or neg instruction, do not count it for rank.  This</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="comment">// assures us that X and ~X will have the same rank.</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordflow">if</span> (!I-&gt;getType()-&gt;isIntegerTy() ||</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      (!<a class="code" href="classllvm_1_1BinaryOperator.html#a454128b3938d8b6c6305e9c74204cc53">BinaryOperator::isNot</a>(I) &amp;&amp; !<a class="code" href="classllvm_1_1BinaryOperator.html#a2215d5a274d2cf9c064e69452ce17f03">BinaryOperator::isNeg</a>(I)))</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    ++Rank;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="comment">//DEBUG(dbgs() &lt;&lt; &quot;Calculated Rank[&quot; &lt;&lt; V-&gt;getName() &lt;&lt; &quot;] = &quot;</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">//     &lt;&lt; Rank &lt;&lt; &quot;\n&quot;);</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordflow">return</span> ValueRankMap[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = Rank;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;}</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">/// LowerNegateToMultiply - Replace 0-X with X*-1.</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00319"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#abd28e5089281e47a20646dd504218f3b">  319</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *<a class="code" href="Reassociate_8cpp.html#abd28e5089281e47a20646dd504218f3b">LowerNegateToMultiply</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Neg) {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Cst = <a class="code" href="classllvm_1_1Constant.html#a4d51384de6e1798bb6aa875aebeea9f0">Constant::getAllOnesValue</a>(Neg-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *Res =</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    BinaryOperator::CreateMul(Neg-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1), Cst, <span class="stringliteral">&quot;&quot;</span>,Neg);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  Neg-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Neg-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())); <span class="comment">// Drop use of op.</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  Res-&gt;takeName(Neg);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  Neg-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Res);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  Res-&gt;setDebugLoc(Neg-&gt;<a class="code" href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">getDebugLoc</a>());</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordflow">return</span> Res;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;}</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">/// CarmichaelShift - Returns k such that lambda(2^Bitwidth) = 2^k, where lambda</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">/// is the Carmichael function. This means that x^(2^k) === 1 mod 2^Bitwidth for</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">/// every odd x, i.e. x^(2^k) = 1 for every odd x in Bitwidth-bit arithmetic.</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">/// Note that 0 &lt;= k &lt; Bitwidth, and if Bitwidth &gt; 3 then x^(2^k) = 0 for every</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">/// even x in Bitwidth-bit arithmetic.</span></div><div class="line"><a name="l00336"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#a3b5239d08485869f6cb244badd0727fd">  336</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="Reassociate_8cpp.html#a3b5239d08485869f6cb244badd0727fd">CarmichaelShift</a>(<span class="keywordtype">unsigned</span> Bitwidth) {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keywordflow">if</span> (Bitwidth &lt; 3)</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">return</span> Bitwidth - 1;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordflow">return</span> Bitwidth - 2;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;}</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">/// IncorporateWeight - Add the extra weight &#39;RHS&#39; to the existing weight &#39;LHS&#39;,</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">/// reducing the combined weight using any special properties of the operation.</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">/// The existing weight LHS represents the computation X op X op ... op X where</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">/// X occurs LHS times.  The combined weight represents  X op X op ... op X with</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">/// X occurring LHS + RHS times.  If op is &quot;Xor&quot; for example then the combined</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">/// operation is equivalent to X if LHS + RHS is odd, or 0 if LHS + RHS is even;</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">/// the routine returns 1 in LHS in the first case, and 0 in LHS in the second.</span></div><div class="line"><a name="l00349"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#a838450a1f01fb48a3cc7da747418a8c5">  349</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Reassociate_8cpp.html#a838450a1f01fb48a3cc7da747418a8c5">IncorporateWeight</a>(<a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;LHS, <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;RHS, <span class="keywordtype">unsigned</span> Opcode) {</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="comment">// If we were working with infinite precision arithmetic then the combined</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="comment">// weight would be LHS + RHS.  But we are using finite precision arithmetic,</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="comment">// and the APInt sum LHS + RHS may not be correct if it wraps (it is correct</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="comment">// for nilpotent operations and addition, but not for idempotent operations</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="comment">// and multiplication), so it is important to correctly reduce the combined</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="comment">// weight back into range if wrapping would be wrong.</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="comment">// If RHS is zero then the weight didn&#39;t change.</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keywordflow">if</span> (RHS.<a class="code" href="classllvm_1_1APInt.html#a963c4f881fbc3e316e8260bf98453ce4">isMinValue</a>())</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="comment">// If LHS is zero then the combined weight is RHS.</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordflow">if</span> (LHS.<a class="code" href="classllvm_1_1APInt.html#a963c4f881fbc3e316e8260bf98453ce4">isMinValue</a>()) {</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    LHS = RHS;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  }</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="comment">// From this point on we know that neither LHS nor RHS is zero.</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html#ade4b72d6a35be96766511e1c9c58b706">Instruction::isIdempotent</a>(Opcode)) {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="comment">// Idempotent means X op X === X, so any non-zero weight is equivalent to a</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="comment">// weight of 1.  Keeping weights at zero or one also means that wrapping is</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">// not a problem.</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    assert(LHS == 1 &amp;&amp; RHS == 1 &amp;&amp; <span class="stringliteral">&quot;Weights not reduced!&quot;</span>);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">return</span>; <span class="comment">// Return a weight of 1.</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html#ab3448ed426eb302864ffef6e1584a971">Instruction::isNilpotent</a>(Opcode)) {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="comment">// Nilpotent means X op X === 0, so reduce weights modulo 2.</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    assert(LHS == 1 &amp;&amp; RHS == 1 &amp;&amp; <span class="stringliteral">&quot;Weights not reduced!&quot;</span>);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    LHS = 0; <span class="comment">// 1 + 1 === 0 modulo 2.</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  }</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keywordflow">if</span> (Opcode == Instruction::Add) {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="comment">// TODO: Reduce the weight by exploiting nsw/nuw?</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    LHS += RHS;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  }</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  assert(Opcode == Instruction::Mul &amp;&amp; <span class="stringliteral">&quot;Unknown associative operation!&quot;</span>);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordtype">unsigned</span> Bitwidth = LHS.<a class="code" href="classllvm_1_1APInt.html#ad081689e23a8f5dea78dedd623d6a8f8">getBitWidth</a>();</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="comment">// If CM is the Carmichael number then a weight W satisfying W &gt;= CM+Bitwidth</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="comment">// can be replaced with W-CM.  That&#39;s because x^W=x^(W-CM) for every Bitwidth</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="comment">// bit number x, since either x is odd in which case x^CM = 1, or x is even in</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="comment">// which case both x^W and x^(W - CM) are zero.  By subtracting off multiples</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="comment">// of CM like this weights can always be reduced to the range [0, CM+Bitwidth)</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="comment">// which by a happy accident means that they can always be represented using</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <span class="comment">// Bitwidth bits.</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="comment">// TODO: Reduce the weight by exploiting nsw/nuw?  (Could do much better than</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="comment">// the Carmichael number).</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordflow">if</span> (Bitwidth &gt; 3) {<span class="comment"></span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">    /// CM - The value of Carmichael&#39;s lambda function.</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment"></span>    <a class="code" href="classllvm_1_1APInt.html">APInt</a> CM = <a class="code" href="classllvm_1_1APInt.html#aec662ee6ab1490a4cabebf2812e5b9ca">APInt::getOneBitSet</a>(Bitwidth, <a class="code" href="Reassociate_8cpp.html#a3b5239d08485869f6cb244badd0727fd">CarmichaelShift</a>(Bitwidth));</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="comment">// Any weight W &gt;= Threshold can be replaced with W - CM.</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> <a class="code" href="CaptureTracking_8cpp.html#ac30708db2a991631cbf3d95c6324d929">Threshold</a> = CM + Bitwidth;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    assert(LHS.<a class="code" href="classllvm_1_1APInt.html#a1dc5339334162e650ff87e89629bf66c">ult</a>(Threshold) &amp;&amp; RHS.<a class="code" href="classllvm_1_1APInt.html#a1dc5339334162e650ff87e89629bf66c">ult</a>(Threshold) &amp;&amp; <span class="stringliteral">&quot;Weights not reduced!&quot;</span>);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="comment">// For Bitwidth 4 or more the following sum does not overflow.</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    LHS += RHS;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">while</span> (LHS.uge(Threshold))</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      LHS -= CM;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="comment">// To avoid problems with overflow do everything the same as above but using</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="comment">// a larger type.</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordtype">unsigned</span> CM = 1U &lt;&lt; <a class="code" href="Reassociate_8cpp.html#a3b5239d08485869f6cb244badd0727fd">CarmichaelShift</a>(Bitwidth);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="CaptureTracking_8cpp.html#ac30708db2a991631cbf3d95c6324d929">Threshold</a> = CM + Bitwidth;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    assert(LHS.<a class="code" href="classllvm_1_1APInt.html#a7dc983ebf0eb2d255fa90a67063c72e2">getZExtValue</a>() &lt; Threshold &amp;&amp; RHS.<a class="code" href="classllvm_1_1APInt.html#a7dc983ebf0eb2d255fa90a67063c72e2">getZExtValue</a>() &lt; Threshold &amp;&amp;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;           <span class="stringliteral">&quot;Weights not reduced!&quot;</span>);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordtype">unsigned</span> Total = LHS.<a class="code" href="classllvm_1_1APInt.html#a7dc983ebf0eb2d255fa90a67063c72e2">getZExtValue</a>() + RHS.<a class="code" href="classllvm_1_1APInt.html#a7dc983ebf0eb2d255fa90a67063c72e2">getZExtValue</a>();</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">while</span> (Total &gt;= Threshold)</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      Total -= CM;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    LHS = Total;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;}</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div><div class="line"><a name="l00421"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#a16254da0c95d3c3ade9165fca5e192b6">  421</a></span>&#160;<span class="keyword">typedef</span> std::pair&lt;Value*, APInt&gt; <a class="code" href="Reassociate_8cpp.html#a16254da0c95d3c3ade9165fca5e192b6">RepeatedValue</a>;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">/// LinearizeExprTree - Given an associative binary expression, return the leaf</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">/// nodes in Ops along with their weights (how many times the leaf occurs).  The</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">/// original expression is the same as</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">///   (Ops[0].first op Ops[0].first op ... Ops[0].first)  &lt;- Ops[0].second times</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">/// op</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">///   (Ops[1].first op Ops[1].first op ... Ops[1].first)  &lt;- Ops[1].second times</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">/// op</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">///   ...</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">/// op</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">///   (Ops[N].first op Ops[N].first op ... Ops[N].first)  &lt;- Ops[N].second times</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">/// Note that the values Ops[0].first, ..., Ops[N].first are all distinct.</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">/// This routine may modify the function, in which case it returns &#39;true&#39;.  The</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">/// changes it makes may well be destructive, changing the value computed by &#39;I&#39;</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">/// to something completely different.  Thus if the routine returns &#39;true&#39; then</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">/// you MUST either replace I with a new expression computed from the Ops array,</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">/// or use RewriteExprTree to put the values back in.</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">/// A leaf node is either not a binary operation of the same kind as the root</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">/// node &#39;I&#39; (i.e. is not a binary operator at all, or is, but with a different</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">/// opcode), or is the same kind of binary operator but has a use which either</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">/// does not belong to the expression, or does belong to the expression but is</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">/// a leaf node.  Every leaf node has at least one use that is a non-leaf node</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">/// of the expression, while for non-leaf nodes (except for the root &#39;I&#39;) every</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">/// use is a non-leaf node of the expression.</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">/// For example:</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">///           expression graph        node names</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">///                     +        |        I</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">///                    / \       |</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">///                   +   +      |      A,  B</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">///                  / \ / \     |</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">///                 *   +   *    |    C,  D,  E</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">///                / \ / \ / \   |</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">///                   +   *      |      F,  G</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">/// The leaf nodes are C, E, F and G.  The Ops array will contain (maybe not in</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">/// that order) (C, 1), (E, 1), (F, 2), (G, 2).</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">/// The expression is maximal: if some instruction is a binary operator of the</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">/// same kind as &#39;I&#39;, and all of its uses are non-leaf nodes of the expression,</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">/// then the instruction also belongs to the expression, is not a leaf node of</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">/// it, and its operands also belong to the expression (but may be leaf nodes).</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">/// NOTE: This routine will set operands of non-leaf non-root nodes to undef in</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">/// order to ensure that every non-root node in the expression has *exactly one*</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">/// use by a non-leaf node of the expression.  This destruction means that the</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">/// caller MUST either replace &#39;I&#39; with a new expression or use something like</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">/// RewriteExprTree to put the values back in if the routine indicates that it</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">/// made a change by returning &#39;true&#39;.</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">/// In the above example either the right operand of A or the left operand of B</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">/// will be replaced by undef.  If it is B&#39;s operand then this gives:</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">///                     +        |        I</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">///                    / \       |</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">///                   +   +      |      A,  B - operand of B replaced with undef</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">///                  / \   \     |</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">///                 *   +   *    |    C,  D,  E</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">///                / \ / \ / \   |</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">///                   +   *      |      F,  G</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">/// Note that such undef operands can only be reached by passing through &#39;I&#39;.</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">/// For example, if you visit operands recursively starting from a leaf node</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">/// then you will never see such an undef operand unless you get back to &#39;I&#39;,</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">/// which requires passing through a phi node.</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">/// Note that this routine may also mutate binary operators of the wrong type</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">/// that have all uses inside the expression (i.e. only used by non-leaf nodes</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">/// of the expression) if it can turn them into binary operators of the right</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">/// type and thus make the expression bigger.</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00497"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#a628b394cb65dc0a50e31719469cad132">  497</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="Reassociate_8cpp.html#a628b394cb65dc0a50e31719469cad132">LinearizeExprTree</a>(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                              <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;RepeatedValue&gt;</a> &amp;Ops) {</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;LINEARIZE: &quot;</span> &lt;&lt; *I &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="keywordtype">unsigned</span> Bitwidth = I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a8eafa71cf399da8f21b2af5549f3f9e7">getScalarType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a5a7cfa245af120b44ac8a86143bb9e57">getPrimitiveSizeInBits</a>();</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordtype">unsigned</span> Opcode = I-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>();</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  assert(<a class="code" href="classllvm_1_1Instruction.html#aa113b8a9ef3de9c2f075a046ad658717">Instruction::isAssociative</a>(Opcode) &amp;&amp;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;         <a class="code" href="classllvm_1_1Instruction.html#a1c2048f254df730c4de1643ec791ddf9">Instruction::isCommutative</a>(Opcode) &amp;&amp;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;         <span class="stringliteral">&quot;Expected an associative and commutative operation!&quot;</span>);</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="comment">// Visit all operands of the expression, keeping track of their weight (the</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="comment">// number of paths from the expression root to the operand, or if you like</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="comment">// the number of times that operand occurs in the linearized expression).</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="comment">// For example, if I = X + A, where X = A + B, then I, X and B have weight 1</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="comment">// while A has weight two.</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <span class="comment">// Worklist of non-leaf nodes (their operands are in the expression too) along</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="comment">// with their weights, representing a certain number of paths to the operator.</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="comment">// If an operator occurs in the worklist multiple times then we found multiple</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="comment">// ways to get to it.</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;BinaryOperator*, APInt&gt;</a>, 8&gt; Worklist; <span class="comment">// (Op, Weight)</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(I, <a class="code" href="classllvm_1_1APInt.html">APInt</a>(Bitwidth, 1)));</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="comment">// Leaves of the expression are values that either aren&#39;t the right kind of</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="comment">// operation (eg: a constant, or a multiply in an add tree), or are, but have</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="comment">// some uses that are not inside the expression.  For example, in I = X + X,</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="comment">// X = A + B, the value X has two uses (by I) that are in the expression.  If</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="comment">// X has any other uses, for example in a return instruction, then we consider</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="comment">// X to be a leaf, and won&#39;t analyze it further.  When we first visit a value,</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="comment">// if it has more than one use then at first we conservatively consider it to</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="comment">// be a leaf.  Later, as the expression is explored, we may discover some more</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="comment">// uses of the value from inside the expression.  If all uses turn out to be</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="comment">// from within the expression (and the value is a binary operator of the right</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="comment">// kind) then the value is no longer considered to be a leaf, and its operands</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="comment">// are explored.</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="comment">// Leaves - Keeps track of the set of putative leaves as well as the number of</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="comment">// paths to each leaf seen so far.</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value*, APInt&gt;</a> LeafMap;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  LeafMap Leaves; <span class="comment">// Leaf -&gt; Total weight so far.</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 8&gt;</a> LeafOrder; <span class="comment">// Ensure deterministic leaf output order.</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value*, 8&gt;</a> Visited; <span class="comment">// For sanity checking the iteration scheme.</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keywordflow">while</span> (!Worklist.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    std::pair&lt;BinaryOperator*, APInt&gt; <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    I = P.first; <span class="comment">// We examine the operands of this binary operator.</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> OpIdx = 0; OpIdx &lt; 2; ++OpIdx) { <span class="comment">// Visit operands.</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Op = I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(OpIdx);</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <a class="code" href="classllvm_1_1APInt.html">APInt</a> Weight = P.second; <span class="comment">// Number of paths to this operand.</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;OPERAND: &quot;</span> &lt;&lt; *Op &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; Weight &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      assert(!Op-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>() &amp;&amp; <span class="stringliteral">&quot;No uses, so how did we get to it?!&quot;</span>);</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <span class="comment">// If this is a binary operation of the right kind with only one use then</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="comment">// add its operands to the expression.</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO = <a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(Op, Opcode)) {</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        assert(Visited.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(Op) &amp;&amp; <span class="stringliteral">&quot;Not first visit!&quot;</span>);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;DIRECT ADD: &quot;</span> &lt;&lt; *Op &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; Weight &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(BO, Weight));</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      }</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="comment">// Appears to be a leaf.  Is the operand already in the set of leaves?</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      LeafMap::iterator It = Leaves.find(Op);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="keywordflow">if</span> (It == Leaves.end()) {</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="comment">// Not in the leaf map.  Must be the first time we saw this operand.</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        assert(Visited.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(Op) &amp;&amp; <span class="stringliteral">&quot;Not first visit!&quot;</span>);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="keywordflow">if</span> (!Op-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>()) {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;          <span class="comment">// This value has uses not accounted for by the expression, so it is</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;          <span class="comment">// not safe to modify.  Mark it as being a leaf.</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;ADD USES LEAF: &quot;</span> &lt;&lt; *Op &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; Weight &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>);</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;          LeafOrder.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Op);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;          Leaves[Op] = Weight;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        }</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        <span class="comment">// No uses outside the expression, try morphing it.</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (It != Leaves.end()) {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="comment">// Already in the leaf map.</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        assert(Visited.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(Op) &amp;&amp; <span class="stringliteral">&quot;In leaf map but not visited!&quot;</span>);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="comment">// Update the number of paths to the leaf.</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <a class="code" href="Reassociate_8cpp.html#a838450a1f01fb48a3cc7da747418a8c5">IncorporateWeight</a>(It-&gt;second, Weight, Opcode);</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="preprocessor">#if 0   // TODO: Re-enable once PR13021 is fixed.</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="comment">// The leaf already has one use from inside the expression.  As we want</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="comment">// exactly one such use, drop this new use of the leaf.</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        assert(!Op-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>() &amp;&amp; <span class="stringliteral">&quot;Only one use, but we got here twice!&quot;</span>);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        I-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(OpIdx, <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()));</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="comment">// If the leaf is a binary operation of the right kind and we now see</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <span class="comment">// that its multiple original uses were in fact all by nodes belonging</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="comment">// to the expression, then no longer consider it to be a leaf and add</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="comment">// its operands to the expression.</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO = <a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(Op, Opcode)) {</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;UNLEAF: &quot;</span> &lt;&lt; *Op &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; It-&gt;second &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;          Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(BO, It-&gt;second));</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;          Leaves.erase(It);</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        }</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="comment">// If we still have uses that are not accounted for by the expression</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="comment">// then it is not safe to modify the value.</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">if</span> (!Op-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>())</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="comment">// No uses outside the expression, try morphing it.</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        Weight = It-&gt;second;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        Leaves.erase(It); <span class="comment">// Since the value may be morphed below.</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      }</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="comment">// At this point we have a value which, first of all, is not a binary</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="comment">// expression of the right kind, and secondly, is only used inside the</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="comment">// expression.  This means that it can safely be modified.  See if we</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      <span class="comment">// can usefully morph it into an expression of the right kind.</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      assert((!isa&lt;Instruction&gt;(Op) ||</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;              cast&lt;Instruction&gt;(Op)-&gt;getOpcode() != Opcode) &amp;&amp;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;             <span class="stringliteral">&quot;Should have been handled above!&quot;</span>);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      assert(Op-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>() &amp;&amp; <span class="stringliteral">&quot;Has uses outside the expression tree!&quot;</span>);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="comment">// If this is a multiply expression, turn any internal negations into</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="comment">// multiplies by -1 so they can be reassociated.</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a>&gt;(Op);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="keywordflow">if</span> (Opcode == Instruction::Mul &amp;&amp; BO &amp;&amp; <a class="code" href="classllvm_1_1BinaryOperator.html#a2215d5a274d2cf9c064e69452ce17f03">BinaryOperator::isNeg</a>(BO)) {</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;MORPH LEAF: &quot;</span> &lt;&lt; *Op &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; Weight &lt;&lt; <span class="stringliteral">&quot;) TO &quot;</span>);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        BO = <a class="code" href="Reassociate_8cpp.html#abd28e5089281e47a20646dd504218f3b">LowerNegateToMultiply</a>(BO);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; *BO &lt;&lt; <span class="charliteral">&#39;n&#39;</span>);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(BO, Weight));</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      }</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <span class="comment">// Failed to morph into an expression of the right type.  This really is</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <span class="comment">// a leaf.</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;ADD LEAF: &quot;</span> &lt;&lt; *Op &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; Weight &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      assert(!<a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(Op, Opcode) &amp;&amp; <span class="stringliteral">&quot;Value was morphed?&quot;</span>);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      LeafOrder.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Op);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      Leaves[Op] = Weight;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    }</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <span class="comment">// The leaves, repeated according to their weights, represent the linearized</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="comment">// form of the expression.</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = LeafOrder.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = LeafOrder[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    LeafMap::iterator It = Leaves.find(V);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordflow">if</span> (It == Leaves.end())</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="comment">// Node initially thought to be a leaf wasn&#39;t.</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    assert(!<a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(V, Opcode) &amp;&amp; <span class="stringliteral">&quot;Shouldn&#39;t be a leaf!&quot;</span>);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> Weight = It-&gt;second;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordflow">if</span> (Weight.<a class="code" href="classllvm_1_1APInt.html#a963c4f881fbc3e316e8260bf98453ce4">isMinValue</a>())</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <span class="comment">// Leaf already output or weight reduction eliminated it.</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="comment">// Ensure the leaf is only output once.</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    It-&gt;second = 0;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(V, Weight));</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  }</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="comment">// For nilpotent operations or addition there may be no operands, for example</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="comment">// because the expression was &quot;X xor X&quot; or consisted of 2^Bitwidth additions:</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <span class="comment">// in both cases the weight reduces to 0 causing the value to be skipped.</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="keywordflow">if</span> (Ops.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Identity = <a class="code" href="classllvm_1_1ConstantExpr.html#a7ffd35e4b6d2f3455d4aedf18778e7c3">ConstantExpr::getBinOpIdentity</a>(Opcode, I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    assert(Identity &amp;&amp; <span class="stringliteral">&quot;Associative operation without identity!&quot;</span>);</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(Identity, <a class="code" href="classllvm_1_1APInt.html">APInt</a>(Bitwidth, 1)));</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  }</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;}</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">// RewriteExprTree - Now that the operands for this expression tree are</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">// linearized and optimized, emit them in-order.</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="keywordtype">void</span> Reassociate::RewriteExprTree(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                                  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops) {</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  assert(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() &gt; 1 &amp;&amp; <span class="stringliteral">&quot;Single values should be used directly!&quot;</span>);</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="comment">// Since our optimizations should never increase the number of operations, the</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="comment">// new expression can usually be written reusing the existing binary operators</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="comment">// from the original expression tree, without creating any new instructions,</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="comment">// though the rewritten expression may have a completely different topology.</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="comment">// We take care to not change anything if the new expression will be the same</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <span class="comment">// as the original.  If more than trivial changes (like commuting operands)</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="comment">// were made then we are obliged to clear out any optional subclass data like</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="comment">// nsw flags.</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">  /// NodesToRewrite - Nodes from the original expression available for writing</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">  /// the new expression into.</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BinaryOperator*, 8&gt;</a> NodesToRewrite;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keywordtype">unsigned</span> Opcode = I-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>();</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *Op = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment">  /// NotRewritable - The operands being written will be the leaves of the new</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="comment">  /// expression and must not be used as inner nodes (via NodesToRewrite) by</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment">  /// mistake.  Inner nodes are always reassociable, and usually leaves are not</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="comment">  /// (if they were they would have been incorporated into the expression and so</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="comment">  /// would not be leaves), so most of the time there is no danger of this.  But</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="comment">  /// in rare cases a leaf may become reassociable if an optimization kills uses</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">  /// of it, or it may momentarily become reassociable during rewriting (below)</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">  /// due it being removed as an operand of one of its uses.  Ensure that misuse</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">  /// of leaf nodes as inner nodes cannot occur by remembering all of the future</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">  /// leaves and refusing to reuse any of them as inner nodes.</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value*, 8&gt;</a> NotRewritable;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    NotRewritable.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op);</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="comment">// ExpressionChanged - Non-null if the rewritten expression differs from the</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="comment">// original in some non-trivial way, requiring the clearing of optional flags.</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <span class="comment">// Flags are cleared from the operator in ExpressionChanged up to I inclusive.</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *ExpressionChanged = 0;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; ; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="comment">// The last operation (which comes earliest in the IR) is special as both</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="comment">// operands will come from Ops, rather than just one with the other being</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="comment">// a subexpression.</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keywordflow">if</span> (i+2 == Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>()) {</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *NewLHS = Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *NewRHS = Ops[i+1].Op;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *OldLHS = Op-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0);</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *OldRHS = Op-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <span class="keywordflow">if</span> (NewLHS == OldLHS &amp;&amp; NewRHS == OldRHS)</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="comment">// Nothing changed, leave it alone.</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <span class="keywordflow">if</span> (NewLHS == OldRHS &amp;&amp; NewRHS == OldLHS) {</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="comment">// The order of the operands was reversed.  Swap them.</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;RA: &quot;</span> &lt;&lt; *Op &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        Op-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a80cc7c4bd4a37fc13e9765fd3a31dbfe">swapOperands</a>();</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;TO: &quot;</span> &lt;&lt; *Op &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        ++NumChanged;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <span class="comment">// The new operation differs non-trivially from the original. Overwrite</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="comment">// the old operands with the new ones.</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;RA: &quot;</span> &lt;&lt; *Op &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="keywordflow">if</span> (NewLHS != OldLHS) {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO = <a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(OldLHS, Opcode);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="keywordflow">if</span> (BO &amp;&amp; !NotRewritable.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(BO))</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;          NodesToRewrite.push_back(BO);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        Op-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, NewLHS);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      }</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <span class="keywordflow">if</span> (NewRHS != OldRHS) {</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO = <a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(OldRHS, Opcode);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="keywordflow">if</span> (BO &amp;&amp; !NotRewritable.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(BO))</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;          NodesToRewrite.push_back(BO);</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        Op-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, NewRHS);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      }</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;TO: &quot;</span> &lt;&lt; *Op &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      ExpressionChanged = Op;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      ++NumChanged;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    }</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="comment">// Not the last operation.  The left-hand side will be a sub-expression</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="comment">// while the right-hand side will be the current element of Ops.</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewRHS = Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">if</span> (NewRHS != Op-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1)) {</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;RA: &quot;</span> &lt;&lt; *Op &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      <span class="keywordflow">if</span> (NewRHS == Op-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0)) {</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="comment">// The new right-hand side was already present as the left operand.  If</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="comment">// we are lucky then swapping the operands will sort out both of them.</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        Op-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a80cc7c4bd4a37fc13e9765fd3a31dbfe">swapOperands</a>();</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="comment">// Overwrite with the new right-hand side.</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO = <a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(Op-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1), Opcode);</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <span class="keywordflow">if</span> (BO &amp;&amp; !NotRewritable.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(BO))</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;          NodesToRewrite.push_back(BO);</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        Op-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, NewRHS);</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        ExpressionChanged = Op;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      }</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;TO: &quot;</span> &lt;&lt; *Op &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;      MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      ++NumChanged;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    }</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="comment">// Now deal with the left-hand side.  If this is already an operation node</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="comment">// from the original expression then just rewrite the rest of the expression</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="comment">// into it.</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO = <a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(Op-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), Opcode);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordflow">if</span> (BO &amp;&amp; !NotRewritable.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(BO)) {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      Op = BO;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    }</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="comment">// Otherwise, grab a spare node from the original expression and use that as</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="comment">// the left-hand side.  If there are no nodes left then the optimizers made</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="comment">// an expression with more nodes than the original!  This usually means that</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="comment">// they did something stupid but it might mean that the problem was just too</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="comment">// hard (finding the mimimal number of multiplications needed to realize a</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="comment">// multiplication expression is NP-complete).  Whatever the reason, smart or</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="comment">// stupid, create a new node if there are none left.</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *NewOp;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">if</span> (NodesToRewrite.empty()) {</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="namespacellvm_1_1RegState.html#a079b254e749130fbe5d740f314ca92daab502f975742e9bff6d6dd7b49439b806">Undef</a> = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      NewOp = <a class="code" href="classllvm_1_1BinaryOperator.html#a4a4628e91a9c6a339fa61105614fac76">BinaryOperator::Create</a>(<a class="code" href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a>(Opcode),</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                                     Undef, Undef, <span class="stringliteral">&quot;&quot;</span>, I);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      NewOp = NodesToRewrite.pop_back_val();</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    }</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;RA: &quot;</span> &lt;&lt; *Op &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    Op-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, NewOp);</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;TO: &quot;</span> &lt;&lt; *Op &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    ExpressionChanged = Op;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    ++NumChanged;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    Op = NewOp;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  }</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="comment">// If the expression changed non-trivially then clear out all subclass data</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <span class="comment">// starting from the operator specified in ExpressionChanged, and compactify</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="comment">// the operators to just before the expression root to guarantee that the</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="comment">// expression tree is dominated by all of Ops.</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="keywordflow">if</span> (ExpressionChanged)</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="keywordflow">do</span> {</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      ExpressionChanged-&gt;<a class="code" href="classllvm_1_1Value.html#a48790dc28d4007833380faed30c9f44c">clearSubclassOptionalData</a>();</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <span class="keywordflow">if</span> (ExpressionChanged == I)</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      ExpressionChanged-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(I);</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      ExpressionChanged = cast&lt;BinaryOperator&gt;(*ExpressionChanged-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>());</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    } <span class="keywordflow">while</span> (1);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="comment">// Throw away any left over nodes from the original expression.</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0, e = NodesToRewrite.size(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    RedoInsts.insert(NodesToRewrite[i]);</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;}</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">/// NegateValue - Insert instructions before the instruction pointed to by BI,</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="comment">/// that computes the negative version of the value specified.  The negative</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment">/// version of the value is returned, and BI is left pointing at the instruction</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment">/// that should be processed next by the reassociation pass.</span></div><div class="line"><a name="l00836"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#a48b0ec8ef22f4b5a509119d94069f7fb">  836</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="Reassociate_8cpp.html#a48b0ec8ef22f4b5a509119d94069f7fb">NegateValue</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *BI) {</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;Constant&gt;(V))</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1ConstantExpr.html#afa29f0cd072ab9b3a2630681ffe5760f">ConstantExpr::getNeg</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>);</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  <span class="comment">// We are trying to expose opportunity for reassociation.  One of the things</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="comment">// that we want to do to achieve this is to push a negation as deep into an</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="comment">// expression chain as possible, to expose the add instructions.  In practice,</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="comment">// this means that we turn this:</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="comment">//   X = -(A+12+C+D)   into    X = -A + -12 + -C + -D = -12 + -A + -C + -D</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="comment">// so that later, a: Y = 12+X could get reassociated with the -12 to eliminate</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <span class="comment">// the constants.  We assume that instcombine will clean up the mess later if</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="comment">// we introduce tons of unnecessary negation instructions.</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *I = <a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(V, Instruction::Add)) {</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="comment">// Push the negates through the add.</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    I-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, <a class="code" href="Reassociate_8cpp.html#a48b0ec8ef22f4b5a509119d94069f7fb">NegateValue</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), BI));</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    I-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, <a class="code" href="Reassociate_8cpp.html#a48b0ec8ef22f4b5a509119d94069f7fb">NegateValue</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1), BI));</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="comment">// We must move the add instruction here, because the neg instructions do</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="comment">// not dominate the old add instruction in general.  By moving it, we are</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="comment">// assured that the neg instructions we just inserted dominate the</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="comment">// instruction we are about to insert after them.</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    I-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(BI);</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    I-&gt;<a class="code" href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">setName</a>(I-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.neg&quot;</span>);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  }</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="comment">// Okay, we need to materialize a negated version of V with an instruction.</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="comment">// Scan the use lists of V to see if we have one already.</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = V-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = V-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI != E;++UI){</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <a class="code" href="classllvm_1_1User.html">User</a> *U = *UI;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1BinaryOperator.html#a2215d5a274d2cf9c064e69452ce17f03">BinaryOperator::isNeg</a>(U)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="comment">// We found one!  Now we have to make sure that the definition dominates</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="comment">// this use.  We do this by moving it to the entry block (if it is a</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="comment">// non-instruction value) or right after the definition.  These negates will</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="comment">// be zapped by reassociate later, so we don&#39;t need much finesse here.</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *TheNeg = cast&lt;BinaryOperator&gt;(U);</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="comment">// Verify that the negate is in this function, V might be a constant expr.</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="keywordflow">if</span> (TheNeg-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>() != BI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>())</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> InsertPt;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InstInput = dyn_cast&lt;Instruction&gt;(V)) {</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II = dyn_cast&lt;InvokeInst&gt;(InstInput)) {</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        InsertPt = II-&gt;getNormalDest()-&gt;begin();</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        InsertPt = InstInput;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        ++InsertPt;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      }</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      <span class="keywordflow">while</span> (isa&lt;PHINode&gt;(InsertPt)) ++InsertPt;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      InsertPt = TheNeg-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>()-&gt;<a class="code" href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">getEntryBlock</a>().<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    }</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    TheNeg-&gt;<a class="code" href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(InsertPt);</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keywordflow">return</span> TheNeg;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  }</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="comment">// Insert a &#39;neg&#39; instruction that subtracts the value from zero to get the</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <span class="comment">// negation.</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1BinaryOperator.html#ac0b4ab314244698be760dbe58b869956">BinaryOperator::CreateNeg</a>(V, V-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() + <span class="stringliteral">&quot;.neg&quot;</span>, BI);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;}</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment">/// ShouldBreakUpSubtract - Return true if we should break up this subtract of</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment">/// X-Y into (X + -Y).</span></div><div class="line"><a name="l00903"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#a19d2abc5a580be68aa7751c0e1ce7263">  903</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="Reassociate_8cpp.html#a19d2abc5a580be68aa7751c0e1ce7263">ShouldBreakUpSubtract</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Sub) {</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="comment">// If this is a negation, we can&#39;t split it up!</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BinaryOperator.html#a2215d5a274d2cf9c064e69452ce17f03">BinaryOperator::isNeg</a>(Sub))</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <span class="comment">// Don&#39;t bother to break this up unless either the LHS is an associable add or</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="comment">// subtract or if this is only used by one.</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(Sub-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), Instruction::Add) ||</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      <a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(Sub-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), Instruction::Sub))</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(Sub-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1), Instruction::Add) ||</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(Sub-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1), Instruction::Sub))</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="keywordflow">if</span> (Sub-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>() &amp;&amp;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      (<a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(Sub-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">use_back</a>(), Instruction::Add) ||</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;       <a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(Sub-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">use_back</a>(), Instruction::Sub)))</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;}</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment">/// BreakUpSubtract - If we have (X-Y), and if either X is an add, or if this is</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">/// only used by an add, transform this into (X+(0-Y)) to promote better</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">/// reassociation.</span></div><div class="line"><a name="l00927"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#ae20b217e73a0ca8f5d8841ce09d7f144">  927</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *<a class="code" href="Reassociate_8cpp.html#ae20b217e73a0ca8f5d8841ce09d7f144">BreakUpSubtract</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Sub) {</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <span class="comment">// Convert a subtract into an add and a neg instruction. This allows sub</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  <span class="comment">// instructions to be commuted with other add instructions.</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  <span class="comment">// Calculate the negative value of Operand 1 of the sub instruction,</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="comment">// and set it as the RHS of the add instruction we just made.</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NegVal = <a class="code" href="Reassociate_8cpp.html#a48b0ec8ef22f4b5a509119d94069f7fb">NegateValue</a>(Sub-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1), Sub);</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *New =</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    BinaryOperator::CreateAdd(Sub-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), NegVal, <span class="stringliteral">&quot;&quot;</span>, Sub);</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  Sub-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Sub-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())); <span class="comment">// Drop use of op.</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  Sub-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Sub-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())); <span class="comment">// Drop use of op.</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  New-&gt;takeName(Sub);</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="comment">// Everyone now refers to the add instruction.</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  Sub-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(New);</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  New-&gt;setDebugLoc(Sub-&gt;<a class="code" href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">getDebugLoc</a>());</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Negated: &quot;</span> &lt;&lt; *New &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="keywordflow">return</span> New;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;}</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment">/// ConvertShiftToMul - If this is a shift of a reassociable multiply or is used</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment">/// by one, change this into a multiply by a constant to assist with further</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">/// reassociation.</span></div><div class="line"><a name="l00952"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#a0f1f6d5922fdbea17fd61e9b033d0e0c">  952</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *<a class="code" href="Reassociate_8cpp.html#a0f1f6d5922fdbea17fd61e9b033d0e0c">ConvertShiftToMul</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Shl) {</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *MulCst = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(Shl-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), 1);</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  MulCst = <a class="code" href="classllvm_1_1ConstantExpr.html#aa5ad9e9e7cc67e1675d8d1631a73e625">ConstantExpr::getShl</a>(MulCst, cast&lt;Constant&gt;(Shl-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1)));</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *Mul =</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    BinaryOperator::CreateMul(Shl-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), MulCst, <span class="stringliteral">&quot;&quot;</span>, Shl);</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  Shl-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(Shl-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())); <span class="comment">// Drop use of op.</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  Mul-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(Shl);</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  Shl-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Mul);</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  Mul-&gt;<a class="code" href="classllvm_1_1Instruction.html#a7bd545769621a0a9d2cfb074f86f4295">setDebugLoc</a>(Shl-&gt;<a class="code" href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">getDebugLoc</a>());</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="keywordflow">return</span> Mul;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;}</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="comment">/// FindInOperandList - Scan backwards and forwards among values with the same</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment">/// rank as element i to see if X exists.  If X does not exist, return i.  This</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment">/// is useful when scanning for &#39;x&#39; when we see &#39;-x&#39; because they both get the</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">/// same rank.</span></div><div class="line"><a name="l00969"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#a009b54c05762d1e08d2ed83a0f26865a">  969</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="Reassociate_8cpp.html#a009b54c05762d1e08d2ed83a0f26865a">FindInOperandList</a>(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops, <span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>,</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                                  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm.html#a6569d00d31a5d74e563e2f39f82271ab">X</a>) {</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keywordtype">unsigned</span> XRank = Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Rank;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="keywordtype">unsigned</span> e = Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>();</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> = i+1; <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> != e &amp;&amp; Ops[<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>].Rank == XRank; ++<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>)</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordflow">if</span> (Ops[<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>].Op == X)</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <span class="comment">// Scan backwards.</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> = i-1; <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> != ~0U &amp;&amp; Ops[<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>].Rank == XRank; --<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>)</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keywordflow">if</span> (Ops[<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>].Op == X)</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;}</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment">/// EmitAddTreeOfValues - Emit a tree of add instructions, summing Ops together</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment">/// and returning the result.  Insert the tree before I.</span></div><div class="line"><a name="l00985"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#aa5dd8cc53e4d4c3e0d2100880d874a7d">  985</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="Reassociate_8cpp.html#aa5dd8cc53e4d4c3e0d2100880d874a7d">EmitAddTreeOfValues</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I,</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                                  <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;WeakVH&gt;</a> &amp;Ops){</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keywordflow">if</span> (Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 1) <span class="keywordflow">return</span> Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>();</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *V1 = Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>();</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#a1f2303df9bbee2233c11d61c2f6f7930">pop_back</a>();</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a> = <a class="code" href="Reassociate_8cpp.html#aa5dd8cc53e4d4c3e0d2100880d874a7d">EmitAddTreeOfValues</a>(I, Ops);</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="keywordflow">return</span> BinaryOperator::CreateAdd(V2, V1, <span class="stringliteral">&quot;tmp&quot;</span>, I);</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;}</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment">/// RemoveFactorFromExpression - If V is an expression tree that is a</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="comment">/// multiplication sequence, and if this sequence contains a multiply by Factor,</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="comment">/// remove Factor from the tree and return the new tree.</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1Value.html">Value</a> *Reassociate::RemoveFactorFromExpression(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Value.html">Value</a> *Factor) {</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO = <a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(V, Instruction::Mul);</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="keywordflow">if</span> (!BO) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;RepeatedValue, 8&gt;</a> Tree;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  MadeChange |= <a class="code" href="Reassociate_8cpp.html#a628b394cb65dc0a50e31719469cad132">LinearizeExprTree</a>(BO, Tree);</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ValueEntry, 8&gt;</a> Factors;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  Factors.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a4786e64977a3af38f29adee46b70a863">reserve</a>(Tree.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>());</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Tree.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <a class="code" href="Reassociate_8cpp.html#a16254da0c95d3c3ade9165fca5e192b6">RepeatedValue</a> E = Tree[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    Factors.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a669d55980a7d4b6307b94596deeb0b1f">append</a>(E.second.getZExtValue(),</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                   ValueEntry(getRank(E.first), E.first));</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  }</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="keywordtype">bool</span> FoundFactor = <span class="keyword">false</span>;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="keywordtype">bool</span> NeedsNegate = <span class="keyword">false</span>;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Factors.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">if</span> (Factors[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op == Factor) {</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      FoundFactor = <span class="keyword">true</span>;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      Factors.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">erase</a>(Factors.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>()+<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    }</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="comment">// If this is a negative version of this factor, remove it.</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *FC1 = dyn_cast&lt;ConstantInt&gt;(Factor))</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *FC2 = dyn_cast&lt;ConstantInt&gt;(Factors[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op))</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        <span class="keywordflow">if</span> (FC1-&gt;getValue() == -FC2-&gt;getValue()) {</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;          FoundFactor = NeedsNegate = <span class="keyword">true</span>;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;          Factors.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">erase</a>(Factors.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>()+<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        }</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  }</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="keywordflow">if</span> (!FoundFactor) {</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="comment">// Make sure to restore the operands to the expression tree.</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    RewriteExprTree(BO, Factors);</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  }</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> InsertPt = BO; ++InsertPt;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  <span class="comment">// If this was just a single multiply, remove the multiply and return the only</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <span class="comment">// remaining operand.</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="keywordflow">if</span> (Factors.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 1) {</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    RedoInsts.insert(BO);</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    V = Factors[0].Op;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    RewriteExprTree(BO, Factors);</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    V = BO;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  }</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="keywordflow">if</span> (NeedsNegate)</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    V = <a class="code" href="classllvm_1_1BinaryOperator.html#ac0b4ab314244698be760dbe58b869956">BinaryOperator::CreateNeg</a>(V, <span class="stringliteral">&quot;neg&quot;</span>, InsertPt);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <span class="keywordflow">return</span> V;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;}</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">/// FindSingleUseMultiplyFactors - If V is a single-use multiply, recursively</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment">/// add its operands as factors, otherwise add V to the list of factors.</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment">/// Ops is the top-level list of add operands we&#39;re trying to factor.</span></div><div class="line"><a name="l01059"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#aa2fa38b27266e65a5b9940a0c3f00f1f"> 1059</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="Reassociate_8cpp.html#aa2fa38b27266e65a5b9940a0c3f00f1f">FindSingleUseMultiplyFactors</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V,</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                                         <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value*&gt;</a> &amp;Factors,</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                                       <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops) {</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO = <a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(V, Instruction::Mul);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <span class="keywordflow">if</span> (!BO) {</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    Factors.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(V);</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  }</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <span class="comment">// Otherwise, add the LHS and RHS to the list of factors.</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <a class="code" href="Reassociate_8cpp.html#aa2fa38b27266e65a5b9940a0c3f00f1f">FindSingleUseMultiplyFactors</a>(BO-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1), Factors, Ops);</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  <a class="code" href="Reassociate_8cpp.html#aa2fa38b27266e65a5b9940a0c3f00f1f">FindSingleUseMultiplyFactors</a>(BO-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), Factors, Ops);</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;}</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">/// OptimizeAndOrXor - Optimize a series of operands to an &#39;and&#39;, &#39;or&#39;, or &#39;xor&#39;</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment">/// instruction.  This optimizes based on identities.  If it can be reduced to</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">/// a single Value, it is returned, otherwise the Ops list is mutated as</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment">/// necessary.</span></div><div class="line"><a name="l01077"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#a9ebb022565fd67aef7b89a88b69dca9d"> 1077</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="Reassociate_8cpp.html#a9ebb022565fd67aef7b89a88b69dca9d">OptimizeAndOrXor</a>(<span class="keywordtype">unsigned</span> Opcode,</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;                               <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops) {</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="comment">// Scan the operand lists looking for X and ~X pairs, along with X,X pairs.</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <span class="comment">// If we find any, we can simplify the expression. X&amp;~X == 0, X|~X == -1.</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="comment">// First, check for X and ~X in the operand list.</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    assert(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>());</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BinaryOperator.html#a454128b3938d8b6c6305e9c74204cc53">BinaryOperator::isNot</a>(Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op)) {    <span class="comment">// Cannot occur for ^.</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm.html#a6569d00d31a5d74e563e2f39f82271ab">X</a> = <a class="code" href="classllvm_1_1BinaryOperator.html#a57781e19c89adc7ec1a5da6d156aced0">BinaryOperator::getNotArgument</a>(Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op);</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      <span class="keywordtype">unsigned</span> FoundX = <a class="code" href="Reassociate_8cpp.html#a009b54c05762d1e08d2ed83a0f26865a">FindInOperandList</a>(Ops, <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, X);</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      <span class="keywordflow">if</span> (FoundX != <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        <span class="keywordflow">if</span> (Opcode == <a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">Instruction::And</a>)   <span class="comment">// ...&amp;X&amp;~X = 0</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(X-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <span class="keywordflow">if</span> (Opcode == <a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a>)    <span class="comment">// ...|X|~X = -1</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1Constant.html#a4d51384de6e1798bb6aa875aebeea9f0">Constant::getAllOnesValue</a>(X-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      }</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    }</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="comment">// Next, check for duplicate pairs of values, which we assume are next to</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="comment">// each other, due to our sorting criteria.</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    assert(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>());</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>+1 != Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() &amp;&amp; Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>+1].Op == Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op) {</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;      <span class="keywordflow">if</span> (Opcode == <a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">Instruction::And</a> || Opcode == <a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a>) {</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        <span class="comment">// Drop duplicate values for And and Or.</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">erase</a>(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>()+<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>; --e;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        ++NumAnnihil;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      }</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      <span class="comment">// Drop pairs of values for Xor.</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      assert(Opcode == <a class="code" href="namespacellvm_1_1APIntOps.html#afc7c4d88d09cba0c5e920f8a3a3ace55">Instruction::Xor</a>);</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      <span class="keywordflow">if</span> (e == 2)</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Ops[0].Op-&gt;getType());</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      <span class="comment">// Y ^ X^X -&gt; Y</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">erase</a>(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>()+<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>()+<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>+2);</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> -= 1; e -= 2;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      ++NumAnnihil;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    }</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  }</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;}</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment">/// Helper funciton of CombineXorOpnd(). It creates a bitwise-and</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment">/// instruction with the given two operands, and return the resulting</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">/// instruction. There are two special cases: 1) if the constant operand is 0,</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">/// it will return NULL. 2) if the constant is ~0, the symbolic operand will</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">/// be returned.</span></div><div class="line"><a name="l01127"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#ad517e28695345579aa30fae8783953d2"> 1127</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="Reassociate_8cpp.html#ad517e28695345579aa30fae8783953d2">createAndInstr</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertBefore, <a class="code" href="classllvm_1_1Value.html">Value</a> *Opnd, </div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                             <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;ConstOpnd) {</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  <span class="keywordflow">if</span> (ConstOpnd != 0) {</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="keywordflow">if</span> (!ConstOpnd.<a class="code" href="classllvm_1_1APInt.html#a21260f8037e665d235ace5718cf68bc4">isAllOnesValue</a>()) {</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      <a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;Ctx = Opnd-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#af348d5ea83429d08ba891ca3dd0e92b2">getContext</a>();</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      I = BinaryOperator::CreateAnd(Opnd, <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(Ctx, ConstOpnd),</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                                    <span class="stringliteral">&quot;and.ra&quot;</span>, InsertBefore);</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a7bd545769621a0a9d2cfb074f86f4295">setDebugLoc</a>(InsertBefore-&gt;<a class="code" href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">getDebugLoc</a>());</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    }</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <span class="keywordflow">return</span> Opnd;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  }</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;}</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="comment">// Helper function of OptimizeXor(). It tries to simplify &quot;Opnd1 ^ ConstOpnd&quot;</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment">// into &quot;R ^ C&quot;, where C would be 0, and R is a symbolic value.</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment">// If it was successful, true is returned, and the &quot;R&quot; and &quot;C&quot; is returned</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment">// via &quot;Res&quot; and &quot;ConstOpnd&quot;, respectively; otherwise, false is returned,</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment">// and both &quot;Res&quot; and &quot;ConstOpnd&quot; remain unchanged.</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment">//  </span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="keywordtype">bool</span> Reassociate::CombineXorOpnd(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I, XorOpnd *Opnd1,</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                                 <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;ConstOpnd, <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;Res) {</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  <span class="comment">// Xor-Rule 1: (x | c1) ^ c2 = (x | c1) ^ (c1 ^ c1) ^ c2 </span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  <span class="comment">//                       = ((x | c1) ^ c1) ^ (c1 ^ c2)</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  <span class="comment">//                       = (x &amp; ~c1) ^ (c1 ^ c2)</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  <span class="comment">// It is useful only when c1 == c2.</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <span class="keywordflow">if</span> (Opnd1-&gt;isOrExpr() &amp;&amp; Opnd1-&gt;getConstPart() != 0) {</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keywordflow">if</span> (!Opnd1-&gt;getValue()-&gt;hasOneUse())</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;<a class="code" href="Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a> = Opnd1-&gt;getConstPart();</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="keywordflow">if</span> (C1 != ConstOpnd)</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm.html#a6569d00d31a5d74e563e2f39f82271ab">X</a> = Opnd1-&gt;getSymbolicPart();</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    Res = <a class="code" href="Reassociate_8cpp.html#ad517e28695345579aa30fae8783953d2">createAndInstr</a>(I, X, ~C1);</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="comment">// ConstOpnd was C2, now C1 ^ C2.</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    ConstOpnd ^= <a class="code" href="Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a>;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classT.html">T</a> = dyn_cast&lt;Instruction&gt;(Opnd1-&gt;getValue()))</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      RedoInsts.insert(<a class="code" href="classT.html">T</a>);</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  }</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;}</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                           </div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="comment">// Helper function of OptimizeXor(). It tries to simplify</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="comment">// &quot;Opnd1 ^ Opnd2 ^ ConstOpnd&quot; into &quot;R ^ C&quot;, where C would be 0, and R is a</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="comment">// symbolic value. </span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="comment">// </span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment">// If it was successful, true is returned, and the &quot;R&quot; and &quot;C&quot; is returned </span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment">// via &quot;Res&quot; and &quot;ConstOpnd&quot;, respectively (If the entire expression is</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment">// evaluated to a constant, the Res is set to NULL); otherwise, false is</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment">// returned, and both &quot;Res&quot; and &quot;ConstOpnd&quot; remain unchanged.</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="keywordtype">bool</span> Reassociate::CombineXorOpnd(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I, XorOpnd *Opnd1, XorOpnd *Opnd2,</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                                 <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;ConstOpnd, <a class="code" href="classllvm_1_1Value.html">Value</a> *&amp;Res) {</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm.html#a6569d00d31a5d74e563e2f39f82271ab">X</a> = Opnd1-&gt;getSymbolicPart();</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  <span class="keywordflow">if</span> (X != Opnd2-&gt;getSymbolicPart())</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  <span class="comment">// This many instruction become dead.(At least &quot;Opnd1 ^ Opnd2&quot; will die.)</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  <span class="keywordtype">int</span> DeadInstNum = 1;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <span class="keywordflow">if</span> (Opnd1-&gt;getValue()-&gt;hasOneUse())</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    DeadInstNum++;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  <span class="keywordflow">if</span> (Opnd2-&gt;getValue()-&gt;hasOneUse())</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    DeadInstNum++;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  <span class="comment">// Xor-Rule 2:</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  <span class="comment">//  (x | c1) ^ (x &amp; c2)</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <span class="comment">//   = (x|c1) ^ (x&amp;c2) ^ (c1 ^ c1) = ((x|c1) ^ c1) ^ (x &amp; c2) ^ c1</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  <span class="comment">//   = (x &amp; ~c1) ^ (x &amp; c2) ^ c1               // Xor-Rule 1</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  <span class="comment">//   = (x &amp; c3) ^ c1, where c3 = ~c1 ^ c2      // Xor-rule 3</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <span class="keywordflow">if</span> (Opnd1-&gt;isOrExpr() != Opnd2-&gt;isOrExpr()) {</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="keywordflow">if</span> (Opnd2-&gt;isOrExpr())</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;      <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Opnd1, Opnd2);</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;<a class="code" href="Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a> = Opnd1-&gt;getConstPart();</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;C2 = Opnd2-&gt;getConstPart();</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> C3((~C1) ^ C2);</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="comment">// Do not increase code size!</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="keywordflow">if</span> (C3 != 0 &amp;&amp; !C3.<a class="code" href="classllvm_1_1APInt.html#a21260f8037e665d235ace5718cf68bc4">isAllOnesValue</a>()) {</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;      <span class="keywordtype">int</span> NewInstNum = ConstOpnd != 0 ? 1 : 2;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      <span class="keywordflow">if</span> (NewInstNum &gt; DeadInstNum)</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    }</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    Res = <a class="code" href="Reassociate_8cpp.html#ad517e28695345579aa30fae8783953d2">createAndInstr</a>(I, X, C3);</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    ConstOpnd ^= <a class="code" href="Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a>;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Opnd1-&gt;isOrExpr()) {</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="comment">// Xor-Rule 3: (x | c1) ^ (x | c2) = (x &amp; c3) ^ c3 where c3 = c1 ^ c2</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;<a class="code" href="Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a> = Opnd1-&gt;getConstPart();</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;C2 = Opnd2-&gt;getConstPart();</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> C3 = C1 ^ C2;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    </div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="comment">// Do not increase code size</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="keywordflow">if</span> (C3 != 0 &amp;&amp; !C3.<a class="code" href="classllvm_1_1APInt.html#a21260f8037e665d235ace5718cf68bc4">isAllOnesValue</a>()) {</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      <span class="keywordtype">int</span> NewInstNum = ConstOpnd != 0 ? 1 : 2;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;      <span class="keywordflow">if</span> (NewInstNum &gt; DeadInstNum)</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    }</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    Res = <a class="code" href="Reassociate_8cpp.html#ad517e28695345579aa30fae8783953d2">createAndInstr</a>(I, X, C3);</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    ConstOpnd ^= C3;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="comment">// Xor-Rule 4: (x &amp; c1) ^ (x &amp; c2) = (x &amp; (c1^c2))</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;<a class="code" href="Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a> = Opnd1-&gt;getConstPart();</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;C2 = Opnd2-&gt;getConstPart();</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    <a class="code" href="classllvm_1_1APInt.html">APInt</a> C3 = C1 ^ C2;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    Res = <a class="code" href="Reassociate_8cpp.html#ad517e28695345579aa30fae8783953d2">createAndInstr</a>(I, X, C3);</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  }</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <span class="comment">// Put the original operands in the Redo list; hope they will be deleted</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <span class="comment">// as dead code.</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classT.html">T</a> = dyn_cast&lt;Instruction&gt;(Opnd1-&gt;getValue()))</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    RedoInsts.insert(<a class="code" href="classT.html">T</a>);</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classT.html">T</a> = dyn_cast&lt;Instruction&gt;(Opnd2-&gt;getValue()))</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    RedoInsts.insert(<a class="code" href="classT.html">T</a>);</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;}</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="comment">/// Optimize a series of operands to an &#39;xor&#39; instruction. If it can be reduced</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="comment">/// to a single Value, it is returned, otherwise the Ops list is mutated as</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="comment">/// necessary.</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1Value.html">Value</a> *Reassociate::OptimizeXor(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I,</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                                <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops) {</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="Reassociate_8cpp.html#a9ebb022565fd67aef7b89a88b69dca9d">OptimizeAndOrXor</a>(<a class="code" href="namespacellvm_1_1APIntOps.html#afc7c4d88d09cba0c5e920f8a3a3ace55">Instruction::Xor</a>, Ops))</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <span class="keywordflow">return</span> V;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;      </div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  <span class="keywordflow">if</span> (Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 1)</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;XorOpnd, 8&gt;</a> Opnds;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;XorOpnd*, 8&gt;</a> OpndPtrs;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = Ops[0].Op-&gt;getType();</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> ConstOpnd(Ty-&gt;<a class="code" href="classllvm_1_1Type.html#a0519dc6e2f153aaed61eed17d965a9f0">getIntegerBitWidth</a>(), 0);</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  <span class="comment">// Step 1: Convert ValueEntry to XorOpnd</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;ConstantInt&gt;(V)) {</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      XorOpnd O(V);</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      O.setSymbolicRank(getRank(O.getSymbolicPart()));</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      Opnds.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(O);</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    } <span class="keywordflow">else</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      ConstOpnd ^= cast&lt;ConstantInt&gt;(V)-&gt;getValue();</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  }</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="comment">// NOTE: From this point on, do *NOT* add/delete element to/from &quot;Opnds&quot;.</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <span class="comment">//  It would otherwise invalidate the &quot;Opnds&quot;&#39;s iterator, and hence invalidate</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  <span class="comment">//  the &quot;OpndPtrs&quot; as well. For the similar reason, do not fuse this loop</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="comment">//  with the previous loop --- the iterator of the &quot;Opnds&quot; may be invalidated</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  <span class="comment">//  when new elements are added to the vector.</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Opnds.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    OpndPtrs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(&amp;Opnds[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  <span class="comment">// Step 2: Sort the Xor-Operands in a way such that the operands containing</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  <span class="comment">//  the same symbolic value cluster together. For instance, the input operand</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  <span class="comment">//  sequence (&quot;x | 123&quot;, &quot;y &amp; 456&quot;, &quot;x &amp; 789&quot;) will be sorted into:</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  <span class="comment">//  (&quot;x | 123&quot;, &quot;x &amp; 789&quot;, &quot;y &amp; 456&quot;).</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;  std::sort(OpndPtrs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), OpndPtrs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(), XorOpnd::PtrSortFunctor());</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  <span class="comment">// Step 3: Combine adjacent operands</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  XorOpnd *PrevOpnd = 0;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0, e = Opnds.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); i &lt; e; i++) {</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    XorOpnd *CurrOpnd = OpndPtrs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <span class="comment">// The combined value</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *CV;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    <span class="comment">// Step 3.1: Try simplifying &quot;CurrOpnd ^ ConstOpnd&quot;</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <span class="keywordflow">if</span> (ConstOpnd != 0 &amp;&amp; CombineXorOpnd(I, CurrOpnd, ConstOpnd, CV)) {</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;      <span class="keywordflow">if</span> (CV)</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;        *CurrOpnd = XorOpnd(CV);</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        CurrOpnd-&gt;Invalidate();</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      }</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    }</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="keywordflow">if</span> (!PrevOpnd || CurrOpnd-&gt;getSymbolicPart() != PrevOpnd-&gt;getSymbolicPart()) {</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;      PrevOpnd = CurrOpnd;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    }</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="comment">// step 3.2: When previous and current operands share the same symbolic</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <span class="comment">//  value, try to simplify &quot;PrevOpnd ^ CurrOpnd ^ ConstOpnd&quot; </span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="comment">//    </span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="keywordflow">if</span> (CombineXorOpnd(I, CurrOpnd, PrevOpnd, ConstOpnd, CV)) {</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      <span class="comment">// Remove previous operand</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;      PrevOpnd-&gt;Invalidate();</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;      <span class="keywordflow">if</span> (CV) {</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        *CurrOpnd = XorOpnd(CV);</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        PrevOpnd = CurrOpnd;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        CurrOpnd-&gt;Invalidate();</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        PrevOpnd = 0;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;      }</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    }</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  }</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;  <span class="comment">// Step 4: Reassemble the Ops</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  <span class="keywordflow">if</span> (Changed) {</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0, e = Opnds.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); i &lt; e; i++) {</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;      XorOpnd &amp;O = Opnds[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      <span class="keywordflow">if</span> (O.isInvalid())</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;      ValueEntry VE(getRank(O.getValue()), O.getValue());</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;      Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(VE);</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    }</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="keywordflow">if</span> (ConstOpnd != 0) {</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(Ty-&gt;<a class="code" href="classllvm_1_1Type.html#af348d5ea83429d08ba891ca3dd0e92b2">getContext</a>(), ConstOpnd);</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;      ValueEntry VE(getRank(C), C);</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;      Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(VE);</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    }</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="keywordtype">int</span> Sz = Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>();</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <span class="keywordflow">if</span> (Sz == 1)</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;      <span class="keywordflow">return</span> Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>().Op;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Sz == 0) {</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;      assert(ConstOpnd == 0);</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(Ty-&gt;<a class="code" href="classllvm_1_1Type.html#af348d5ea83429d08ba891ca3dd0e92b2">getContext</a>(), ConstOpnd);</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    }</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  }</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;}</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment">/// OptimizeAdd - Optimize a series of operands to an &#39;add&#39; instruction.  This</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment">/// optimizes based on identities.  If it can be reduced to a single Value, it</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment">/// is returned, otherwise the Ops list is mutated as necessary.</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1Value.html">Value</a> *Reassociate::OptimizeAdd(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I,</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;                                <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops) {</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <span class="comment">// Scan the operand lists looking for X and -X pairs.  If we find any, we</span></div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  <span class="comment">// can simplify the expression. X+-X == 0.  While we&#39;re at it, scan for any</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;  <span class="comment">// duplicates.  We want to canonicalize Y+Y+Y+Z -&gt; 3*Y+Z.</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  <span class="comment">// TODO: We could handle &quot;X + ~X&quot; -&gt; &quot;-1&quot; if we wanted, since &quot;-X = ~X+1&quot;.</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *TheOp = Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    <span class="comment">// Check to see if we&#39;ve seen this operand before.  If so, we factor all</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    <span class="comment">// instances of the operand together.  Due to our sorting criteria, we know</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    <span class="comment">// that these need to be next to each other in the vector.</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>+1 != Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() &amp;&amp; Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>+1].Op == TheOp) {</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      <span class="comment">// Rescan the list, remove all instances of this operand from the expr.</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      <span class="keywordtype">unsigned</span> NumFound = 0;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;      <span class="keywordflow">do</span> {</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;        Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">erase</a>(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>()+<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        ++NumFound;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;      } <span class="keywordflow">while</span> (<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() &amp;&amp; Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op == TheOp);</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>() &lt;&lt; <span class="stringliteral">&quot;\nFACTORING [&quot;</span> &lt;&lt; NumFound &lt;&lt; <span class="stringliteral">&quot;]: &quot;</span> &lt;&lt; *TheOp &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;      ++NumFactor;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;      <span class="comment">// Insert a new multiply.</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Mul = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(cast&lt;IntegerType&gt;(I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()), NumFound);</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;      Mul = BinaryOperator::CreateMul(TheOp, Mul, <span class="stringliteral">&quot;factor&quot;</span>, I);</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;      <span class="comment">// Now that we have inserted a multiply, optimize it. This allows us to</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;      <span class="comment">// handle cases that require multiple factoring steps, such as this:</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;      <span class="comment">// (X*2) + (X*2) + (X*2) -&gt; (X*2)*3 -&gt; X*6</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;      RedoInsts.insert(cast&lt;Instruction&gt;(Mul));</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      <span class="comment">// If every add operand was a duplicate, return the multiply.</span></div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;      <span class="keywordflow">if</span> (Ops.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>())</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;        <span class="keywordflow">return</span> Mul;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      <span class="comment">// Otherwise, we had some input that didn&#39;t have the dupe, such as</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      <span class="comment">// &quot;A + A + B&quot; -&gt; &quot;A*2 + B&quot;.  Add the new multiply to the list of</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      <span class="comment">// things being added by this operation.</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;      Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#af622128e353515efebccad40eae495cb">insert</a>(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), ValueEntry(getRank(Mul), Mul));</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;      --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;      e = Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>();</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    }</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="comment">// Check for X and -X in the operand list.</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classllvm_1_1BinaryOperator.html#a2215d5a274d2cf9c064e69452ce17f03">BinaryOperator::isNeg</a>(TheOp))</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="namespacellvm.html#a6569d00d31a5d74e563e2f39f82271ab">X</a> = <a class="code" href="classllvm_1_1BinaryOperator.html#a983e52a82d604057b45a59101a7ef257">BinaryOperator::getNegArgument</a>(TheOp);</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordtype">unsigned</span> FoundX = <a class="code" href="Reassociate_8cpp.html#a009b54c05762d1e08d2ed83a0f26865a">FindInOperandList</a>(Ops, <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, X);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="keywordflow">if</span> (FoundX == <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <span class="comment">// Remove X and -X from the operand list.</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    <span class="keywordflow">if</span> (Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 2)</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(X-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">erase</a>(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>()+<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; FoundX)</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      --FoundX;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;   <span class="comment">// Need to back up an extra one.</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">erase</a>(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>()+FoundX);</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    ++NumAnnihil;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;     <span class="comment">// Revisit element.</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    e -= 2;  <span class="comment">// Removed two elements.</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  }</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="comment">// Scan the operand list, checking to see if there are any common factors</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  <span class="comment">// between operands.  Consider something like A*A+A*B*C+D.  We would like to</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  <span class="comment">// reassociate this to A*(A+B*C)+D, which reduces the number of multiplies.</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  <span class="comment">// To efficiently find this, we count the number of times a factor occurs</span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <span class="comment">// for any ADD operands that are MULs.</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value*, unsigned&gt;</a> FactorOccurrences;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <span class="comment">// Keep track of each multiply we see, to avoid triggering on (X*4)+(X*4)</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  <span class="comment">// where they are actually the same multiply.</span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  <span class="keywordtype">unsigned</span> MaxOcc = 0;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *MaxOccVal = 0;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BOp = <a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op, Instruction::Mul);</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <span class="keywordflow">if</span> (!BOp)</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <span class="comment">// Compute all of the factors of this added value.</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 8&gt;</a> Factors;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <a class="code" href="Reassociate_8cpp.html#aa2fa38b27266e65a5b9940a0c3f00f1f">FindSingleUseMultiplyFactors</a>(BOp, Factors, Ops);</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    assert(Factors.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() &gt; 1 &amp;&amp; <span class="stringliteral">&quot;Bad linearize!&quot;</span>);</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="comment">// Add one to FactorOccurrences for each unique factor in this op.</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Value*, 8&gt;</a> Duplicates;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Factors.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *Factor = Factors[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;      <span class="keywordflow">if</span> (!Duplicates.insert(Factor)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      <span class="keywordtype">unsigned</span> Occ = ++FactorOccurrences[Factor];</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      <span class="keywordflow">if</span> (Occ &gt; MaxOcc) { MaxOcc = Occ; MaxOccVal = Factor; }</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <span class="comment">// If Factor is a negative constant, add the negated value as a factor</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      <span class="comment">// because we can percolate the negate out.  Watch for minint, which</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;      <span class="comment">// cannot be positivified.</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = dyn_cast&lt;ConstantInt&gt;(Factor))</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        <span class="keywordflow">if</span> (CI-&gt;isNegative() &amp;&amp; !CI-&gt;isMinValue(<span class="keyword">true</span>)) {</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;          Factor = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(CI-&gt;getContext(), -CI-&gt;getValue());</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;          assert(!Duplicates.count(Factor) &amp;&amp;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;                 <span class="stringliteral">&quot;Shouldn&#39;t have two constant factors, missed a canonicalize&quot;</span>);</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;          <span class="keywordtype">unsigned</span> Occ = ++FactorOccurrences[Factor];</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;          <span class="keywordflow">if</span> (Occ &gt; MaxOcc) { MaxOcc = Occ; MaxOccVal = Factor; }</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;        }</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    }</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;  }</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;  <span class="comment">// If any factor occurred more than one time, we can pull it out.</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;  <span class="keywordflow">if</span> (MaxOcc &gt; 1) {</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>() &lt;&lt; <span class="stringliteral">&quot;\nFACTORING [&quot;</span> &lt;&lt; MaxOcc &lt;&lt; <span class="stringliteral">&quot;]: &quot;</span> &lt;&lt; *MaxOccVal &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    ++NumFactor;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    <span class="comment">// Create a new instruction that uses the MaxOccVal twice.  If we don&#39;t do</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="comment">// this, we could otherwise run into situations where removing a factor</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    <span class="comment">// from an expression will drop a use of maxocc, and this can cause</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    <span class="comment">// RemoveFactorFromExpression on successive values to behave differently.</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *DummyInst = BinaryOperator::CreateAdd(MaxOccVal, MaxOccVal);</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;WeakVH, 4&gt;</a> NewMulOps;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;      <span class="comment">// Only try to remove factors from expressions we&#39;re allowed to.</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BOp = <a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op, Instruction::Mul);</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;      <span class="keywordflow">if</span> (!BOp)</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = RemoveFactorFromExpression(Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op, MaxOccVal)) {</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        <span class="comment">// The factorized operand may occur several times.  Convert them all in</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        <span class="comment">// one fell swoop.</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> = Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a> != <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;) {</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;          --<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;          <span class="keywordflow">if</span> (Ops[<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>].Op == Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].Op) {</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;            NewMulOps.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(V);</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;            Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">erase</a>(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>()+<a class="code" href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a>);</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;          }</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;        }</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      }</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    }</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    <span class="comment">// No need for extra uses anymore.</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    <span class="keyword">delete</span> DummyInst;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    <span class="keywordtype">unsigned</span> NumAddedValues = NewMulOps.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>();</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="Reassociate_8cpp.html#aa5dd8cc53e4d4c3e0d2100880d874a7d">EmitAddTreeOfValues</a>(I, NewMulOps);</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <span class="comment">// Now that we have inserted the add tree, optimize it. This allows us to</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    <span class="comment">// handle cases that require multiple factoring steps, such as this:</span></div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    <span class="comment">// A*A*B + A*A*C   --&gt;   A*(A*B+A*C)   --&gt;   A*(A*(B+C))</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    assert(NumAddedValues &gt; 1 &amp;&amp; <span class="stringliteral">&quot;Each occurrence should contribute a value&quot;</span>);</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    (void)NumAddedValues;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *VI = dyn_cast&lt;Instruction&gt;(V))</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;      RedoInsts.insert(VI);</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="comment">// Create the multiply.</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">V2</a> = BinaryOperator::CreateMul(V, MaxOccVal, <span class="stringliteral">&quot;tmp&quot;</span>, I);</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <span class="comment">// Rerun associate on the multiply in case the inner expression turned into</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <span class="comment">// a multiply.  We want to make sure that we keep things in canonical form.</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    RedoInsts.insert(V2);</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <span class="comment">// If every add operand included the factor (e.g. &quot;A*B + A*C&quot;), then the</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    <span class="comment">// entire result expression is just the multiply &quot;A*(B+C)&quot;.</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    <span class="keywordflow">if</span> (Ops.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>())</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;      <span class="keywordflow">return</span> V2;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <span class="comment">// Otherwise, we had some input that didn&#39;t have the factor, such as</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <span class="comment">// &quot;A*B + A*C + D&quot; -&gt; &quot;A*(B+C) + D&quot;.  Add the new multiply to the list of</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <span class="comment">// things being added by this operation.</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#af622128e353515efebccad40eae495cb">insert</a>(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), ValueEntry(getRank(V2), V2));</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  }</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;}</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;<span class="comment">  /// \brief Predicate tests whether a ValueEntry&#39;s op is in a map.</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="comment"></span>  <span class="keyword">struct </span>IsValueInMap {</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, unsigned&gt;</a> &amp;Map;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    IsValueInMap(<span class="keyword">const</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value *, unsigned&gt;</a> &amp;Map) : Map(Map) {}</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    <span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> ValueEntry &amp;Entry) {</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;      <span class="keywordflow">return</span> Map.<a class="code" href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">find</a>(Entry.Op) != Map.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>();</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    }</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  };</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;}</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="comment">/// \brief Build up a vector of value/power pairs factoring a product.</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="comment">/// Given a series of multiplication operands, build a vector of factors and</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;<span class="comment">/// the powers each is raised to when forming the final product. Sort them in</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="comment">/// the order of descending power.</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="comment">///      (x*x)          -&gt; [(x, 2)]</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="comment">///     ((x*x)*x)       -&gt; [(x, 3)]</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="comment">///   ((((x*y)*x)*y)*x) -&gt; [(x, 3), (y, 2)]</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="comment">/// \returns Whether any factors have a power greater than one.</span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> Reassociate::collectMultiplyFactors(<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops,</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                                         <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Factor&gt;</a> &amp;Factors) {</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  <span class="comment">// FIXME: Have Ops be (ValueEntry, Multiplicity) pairs, simplifying this.</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  <span class="comment">// Compute the sum of powers of simplifiable factors.</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  <span class="keywordtype">unsigned</span> FactorPowerSum = 0;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx = 1, Size = Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); Idx &lt; Size; ++Idx) {</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Op = Ops[Idx-1].Op;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    <span class="comment">// Count the number of occurrences of this value.</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <span class="keywordtype">unsigned</span> Count = 1;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="keywordflow">for</span> (; Idx &lt; Size &amp;&amp; Ops[Idx].Op == Op; ++Idx)</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      ++Count;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <span class="comment">// Track for simplification all factors which occur 2 or more times.</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    <span class="keywordflow">if</span> (Count &gt; 1)</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      FactorPowerSum += Count;</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  }</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;  <span class="comment">// We can only simplify factors if the sum of the powers of our simplifiable</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  <span class="comment">// factors is 4 or higher. When that is the case, we will *always* have</span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;  <span class="comment">// a simplification. This is an important invariant to prevent cyclicly</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  <span class="comment">// trying to simplify already minimal formations.</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  <span class="keywordflow">if</span> (FactorPowerSum &lt; 4)</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;  <span class="comment">// Now gather the simplifiable factors, removing them from Ops.</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;  FactorPowerSum = 0;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx = 1; Idx &lt; Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); ++Idx) {</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Op = Ops[Idx-1].Op;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <span class="comment">// Count the number of occurrences of this value.</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="keywordtype">unsigned</span> Count = 1;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <span class="keywordflow">for</span> (; Idx &lt; Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() &amp;&amp; Ops[Idx].Op == Op; ++Idx)</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;      ++Count;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    <span class="keywordflow">if</span> (Count == 1)</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="comment">// Move an even number of occurrences to Factors.</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    Count &amp;= ~1U;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    Idx -= Count;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    FactorPowerSum += Count;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    Factors.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Factor(Op, Count));</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">erase</a>(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>()+Idx, Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>()+Idx+Count);</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  }</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;  <span class="comment">// None of the adjustments above should have reduced the sum of factor powers</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  <span class="comment">// below our mininum of &#39;4&#39;.</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;  assert(FactorPowerSum &gt;= 4);</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;  std::sort(Factors.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Factors.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(), Factor::PowerDescendingSorter());</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;}</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">/// \brief Build a tree of multiplies, computing the product of Ops.</span></div><div class="line"><a name="l01627"></a><span class="lineno"><a class="line" href="Reassociate_8cpp.html#a2a1544550a3fa7e797ff4dae2e6149ce"> 1627</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="Reassociate_8cpp.html#a2a1544550a3fa7e797ff4dae2e6149ce">buildMultiplyTree</a>(<a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder,</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                                <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Value*&gt;</a> &amp;Ops) {</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;  <span class="keywordflow">if</span> (Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 1)</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    <span class="keywordflow">return</span> Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>();</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *LHS = Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    LHS = Builder.<a class="code" href="classllvm_1_1IRBuilder.html#a94c18bf85a5105e0a22fba23b0bedafa">CreateMul</a>(LHS, Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>());</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;  } <span class="keywordflow">while</span> (!Ops.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>());</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;  <span class="keywordflow">return</span> LHS;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;}</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="comment">/// \brief Build a minimal multiplication DAG for (a^x)*(b^y)*(c^z)*...</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment">/// Given a vector of values raised to various powers, where no two values are</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="comment">/// equal and the powers are sorted in decreasing order, compute the minimal</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="comment">/// DAG of multiplies to compute the final product, and return that product</span></div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;<span class="comment">/// value.</span></div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1Value.html">Value</a> *Reassociate::buildMinimalMultiplyDAG(<a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> &amp;Builder,</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;                                            <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Factor&gt;</a> &amp;Factors) {</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;  assert(Factors[0].Power);</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 4&gt;</a> OuterProduct;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> LastIdx = 0, Idx = 1, Size = Factors.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>();</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;       Idx &lt; Size &amp;&amp; Factors[Idx].Power &gt; 0; ++Idx) {</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <span class="keywordflow">if</span> (Factors[Idx].Power != Factors[LastIdx].Power) {</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;      LastIdx = Idx;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    }</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <span class="comment">// We want to multiply across all the factors with the same power so that</span></div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    <span class="comment">// we can raise them to that power as a single entity. Build a mini tree</span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="comment">// for that.</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value *, 4&gt;</a> InnerProduct;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;    InnerProduct.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Factors[LastIdx].Base);</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    <span class="keywordflow">do</span> {</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;      InnerProduct.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Factors[Idx].Base);</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;      ++Idx;</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    } <span class="keywordflow">while</span> (Idx &lt; Size &amp;&amp; Factors[Idx].Power == Factors[LastIdx].Power);</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    <span class="comment">// Reset the base value of the first factor to the new expression tree.</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    <span class="comment">// We&#39;ll remove all the factors with the same power in a second pass.</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a> = Factors[LastIdx].Base = <a class="code" href="Reassociate_8cpp.html#a2a1544550a3fa7e797ff4dae2e6149ce">buildMultiplyTree</a>(Builder, InnerProduct);</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> = dyn_cast&lt;Instruction&gt;(M))</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;      RedoInsts.insert(<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>);</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    LastIdx = Idx;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  }</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;  <span class="comment">// Unique factors with equal powers -- we&#39;ve folded them into the first one&#39;s</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;  <span class="comment">// base.</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;  Factors.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">erase</a>(std::unique(Factors.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Factors.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(),</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;                            Factor::PowerEqual()),</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;                Factors.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>());</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;  <span class="comment">// Iteratively collect the base of each factor with an add power into the</span></div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;  <span class="comment">// outer product, and halve each power in preparation for squaring the</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;  <span class="comment">// expression.</span></div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> Idx = 0, Size = Factors.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); Idx != Size; ++Idx) {</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    <span class="keywordflow">if</span> (Factors[Idx].Power &amp; 1)</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;      OuterProduct.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Factors[Idx].Base);</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    Factors[Idx].Power &gt;&gt;= 1;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;  }</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;  <span class="keywordflow">if</span> (Factors[0].Power) {</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *SquareRoot = buildMinimalMultiplyDAG(Builder, Factors);</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    OuterProduct.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SquareRoot);</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    OuterProduct.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SquareRoot);</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  }</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;  <span class="keywordflow">if</span> (OuterProduct.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 1)</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    <span class="keywordflow">return</span> OuterProduct.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a58dc840fc84420b7f0b773794b8101c1">front</a>();</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="Reassociate_8cpp.html#a2a1544550a3fa7e797ff4dae2e6149ce">buildMultiplyTree</a>(Builder, OuterProduct);</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  <span class="keywordflow">return</span> V;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;}</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *Reassociate::OptimizeMul(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *I,</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;                                <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops) {</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;  <span class="comment">// We can only optimize the multiplies when there is a chain of more than</span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;  <span class="comment">// three, such that a balanced tree might require fewer total multiplies.</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;  <span class="keywordflow">if</span> (Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() &lt; 4)</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;  <span class="comment">// Try to turn linear trees of multiplies without other uses of the</span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;  <span class="comment">// intermediate stages into minimal multiply DAGs with perfect sub-expression</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;  <span class="comment">// re-use.</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Factor, 4&gt;</a> Factors;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  <span class="keywordflow">if</span> (!collectMultiplyFactors(Ops, Factors))</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="keywordflow">return</span> 0; <span class="comment">// All distinct factors, so nothing left for us to do.</span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  <a class="code" href="classllvm_1_1IRBuilder.html">IRBuilder&lt;&gt;</a> Builder(I);</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *V = buildMinimalMultiplyDAG(Builder, Factors);</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;  <span class="keywordflow">if</span> (Ops.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>())</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    <span class="keywordflow">return</span> V;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;  ValueEntry NewEntry = ValueEntry(getRank(V), V);</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#af622128e353515efebccad40eae495cb">insert</a>(std::lower_bound(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(), NewEntry), NewEntry);</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;}</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<a class="code" href="classllvm_1_1Value.html">Value</a> *Reassociate::OptimizeExpression(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *I,</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;                                       <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;ValueEntry&gt;</a> &amp;Ops) {</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;  <span class="comment">// Now that we have the linearized expression tree, try to optimize it.</span></div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;  <span class="comment">// Start by folding any constants that we found.</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Cst = 0;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;  <span class="keywordtype">unsigned</span> Opcode = I-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>();</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;  <span class="keywordflow">while</span> (!Ops.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>() &amp;&amp; isa&lt;Constant&gt;(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>().Op)) {</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = cast&lt;Constant&gt;(Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>().Op);</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    Cst = Cst ? <a class="code" href="classllvm_1_1ConstantExpr.html#afd44535c4ae204571d5721fa4a7042f2">ConstantExpr::get</a>(Opcode, C, Cst) : <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;  }</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;  <span class="comment">// If there was nothing but constants then we are done.</span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;  <span class="keywordflow">if</span> (Ops.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>())</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    <span class="keywordflow">return</span> Cst;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;  <span class="comment">// Put the combined constant back at the end of the operand list, except if</span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  <span class="comment">// there is no point.  For example, an add of 0 gets dropped here, while a</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;  <span class="comment">// multiplication by zero turns the whole expression into zero.</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;  <span class="keywordflow">if</span> (Cst &amp;&amp; Cst != <a class="code" href="classllvm_1_1ConstantExpr.html#a7ffd35e4b6d2f3455d4aedf18778e7c3">ConstantExpr::getBinOpIdentity</a>(Opcode, I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())) {</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    <span class="keywordflow">if</span> (Cst == <a class="code" href="classllvm_1_1ConstantExpr.html#aa395493c74905979f5653cc674d43283">ConstantExpr::getBinOpAbsorber</a>(Opcode, I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()))</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;      <span class="keywordflow">return</span> Cst;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(ValueEntry(0, Cst));</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;  }</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;  <span class="keywordflow">if</span> (Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 1) <span class="keywordflow">return</span> Ops[0].Op;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  <span class="comment">// Handle destructive annihilation due to identities between elements in the</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;  <span class="comment">// argument list here.</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;  <span class="keywordtype">unsigned</span> NumOps = Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>();</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;  <span class="keywordflow">switch</span> (Opcode) {</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;  <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">Instruction::And</a>:</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">Instruction::Or</a>:</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *Result = <a class="code" href="Reassociate_8cpp.html#a9ebb022565fd67aef7b89a88b69dca9d">OptimizeAndOrXor</a>(Opcode, Ops))</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      <span class="keywordflow">return</span> Result;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;  <span class="keywordflow">case</span> <a class="code" href="namespacellvm_1_1APIntOps.html#afc7c4d88d09cba0c5e920f8a3a3ace55">Instruction::Xor</a>:</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *Result = OptimizeXor(I, Ops))</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;      <span class="keywordflow">return</span> Result;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;  <span class="keywordflow">case</span> Instruction::Add:</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *Result = OptimizeAdd(I, Ops))</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;      <span class="keywordflow">return</span> Result;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  <span class="keywordflow">case</span> Instruction::Mul:</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *Result = OptimizeMul(I, Ops))</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;      <span class="keywordflow">return</span> Result;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;  }</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;  <span class="keywordflow">if</span> (Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() != NumOps)</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    <span class="keywordflow">return</span> OptimizeExpression(I, Ops);</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;}</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<span class="comment">/// EraseInst - Zap the given instruction, adding interesting operands to the</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="comment">/// work list.</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> Reassociate::EraseInst(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I) {</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;  assert(<a class="code" href="namespacellvm.html#abe283966f269761ee387642061c4451e">isInstructionTriviallyDead</a>(I) &amp;&amp; <span class="stringliteral">&quot;Trivially dead instructions only!&quot;</span>);</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 8&gt;</a> Ops(I-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>(), I-&gt;<a class="code" href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">op_end</a>());</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;  <span class="comment">// Erase the dead instruction.</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;  ValueRankMap.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">erase</a>(I);</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  RedoInsts.remove(I);</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;  I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;  <span class="comment">// Optimize its operands.</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Instruction *, 8&gt;</a> Visited; <span class="comment">// Detect self-referential nodes.</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Op = dyn_cast&lt;Instruction&gt;(Ops[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>])) {</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;      <span class="comment">// If this is a node in an expression tree, climb to the expression root</span></div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;      <span class="comment">// and add that since that&#39;s where optimization actually happens.</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;      <span class="keywordtype">unsigned</span> Opcode = Op-&gt;getOpcode();</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      <span class="keywordflow">while</span> (Op-&gt;hasOneUse() &amp;&amp; Op-&gt;use_back()-&gt;getOpcode() == Opcode &amp;&amp;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;             Visited.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(Op))</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        Op = Op-&gt;use_back();</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      RedoInsts.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(Op);</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    }</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;}</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="comment">/// OptimizeInst - Inspect and optimize the given instruction. Note that erasing</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="comment">/// instructions is not allowed.</span></div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> Reassociate::OptimizeInst(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I) {</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;  <span class="comment">// Only consider operations that we understand.</span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;BinaryOperator&gt;(I))</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;  <span class="keywordflow">if</span> (I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>() == Instruction::Shl &amp;&amp;</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;      isa&lt;ConstantInt&gt;(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1)))</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    <span class="comment">// If an operand of this shift is a reassociable multiply, or if the shift</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    <span class="comment">// is used by a reassociable multiply or add, turn into a multiply.</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), Instruction::Mul) ||</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;        (I-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>() &amp;&amp;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;         (<a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">use_back</a>(), Instruction::Mul) ||</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;          <a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">use_back</a>(), Instruction::Add)))) {</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NI = <a class="code" href="Reassociate_8cpp.html#a0f1f6d5922fdbea17fd61e9b033d0e0c">ConvertShiftToMul</a>(I);</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;      RedoInsts.insert(I);</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;      MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;      I = NI;</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    }</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;  <span class="comment">// Floating point binary operators are not associative, but we can still</span></div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;  <span class="comment">// commute (some) of them, to canonicalize the order of their operands.</span></div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;  <span class="comment">// This can potentially expose more CSE opportunities, and makes writing</span></div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  <span class="comment">// other transformations simpler.</span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  <span class="keywordflow">if</span> ((I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a40113570b0c52a18c34cabed8359e2c8">isFloatingPointTy</a>() || I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a6f725580f7834e2ca90762965866dad4">isVectorTy</a>())) {</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    <span class="comment">// FAdd and FMul can be commuted.</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    <span class="keywordflow">if</span> (I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>() != Instruction::FMul &amp;&amp;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;        I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>() != Instruction::FAdd)</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *LHS = I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0);</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *RHS = I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1);</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    <span class="keywordtype">unsigned</span> LHSRank = getRank(LHS);</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    <span class="keywordtype">unsigned</span> RHSRank = getRank(RHS);</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    <span class="comment">// Sort the operands by rank.</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    <span class="keywordflow">if</span> (RHSRank &lt; LHSRank) {</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;      I-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, RHS);</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      I-&gt;<a class="code" href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, LHS);</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    }</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;  }</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  <span class="comment">// Do not reassociate boolean (i1) expressions.  We want to preserve the</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  <span class="comment">// original order of evaluation for short-circuited comparisons that</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;  <span class="comment">// SimplifyCFG has folded to AND/OR expressions.  If the expression</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;  <span class="comment">// is not further optimized, it is likely to be transformed back to a</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  <span class="comment">// short-circuited form for code gen, and the source order may have been</span></div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;  <span class="comment">// optimized for the most likely conditions.</span></div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;  <span class="keywordflow">if</span> (I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a6e328feb83afa5cf1c966d6704e43fc1">isIntegerTy</a>(1))</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;  <span class="comment">// If this is a subtract instruction which is not already in negate form,</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;  <span class="comment">// see if we can convert it to X+-Y.</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;  <span class="keywordflow">if</span> (I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>() == Instruction::Sub) {</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="Reassociate_8cpp.html#a19d2abc5a580be68aa7751c0e1ce7263">ShouldBreakUpSubtract</a>(I)) {</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NI = <a class="code" href="Reassociate_8cpp.html#ae20b217e73a0ca8f5d8841ce09d7f144">BreakUpSubtract</a>(I);</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;      RedoInsts.insert(I);</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;      MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;      I = NI;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BinaryOperator.html#a2215d5a274d2cf9c064e69452ce17f03">BinaryOperator::isNeg</a>(I)) {</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;      <span class="comment">// Otherwise, this is a negation.  See if the operand is a multiply tree</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;      <span class="comment">// and if this is not an inner node of a multiply tree.</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1), Instruction::Mul) &amp;&amp;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;          (!I-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>() ||</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;           !<a class="code" href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a>(I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">use_back</a>(), Instruction::Mul))) {</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *NI = <a class="code" href="Reassociate_8cpp.html#abd28e5089281e47a20646dd504218f3b">LowerNegateToMultiply</a>(I);</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;        RedoInsts.insert(I);</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;        MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;        I = NI;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      }</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    }</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;  }</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;  <span class="comment">// If this instruction is an associative binary operator, process it.</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;  <span class="keywordflow">if</span> (!I-&gt;<a class="code" href="classllvm_1_1Instruction.html#aa113b8a9ef3de9c2f075a046ad658717">isAssociative</a>()) <span class="keywordflow">return</span>;</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;  <a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO = cast&lt;BinaryOperator&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;  <span class="comment">// If this is an interior node of a reassociable tree, ignore it until we</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;  <span class="comment">// get to the root of the tree, to avoid N^2 analysis.</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;  <span class="keywordtype">unsigned</span> Opcode = BO-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>();</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;  <span class="keywordflow">if</span> (BO-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>() &amp;&amp; BO-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">use_back</a>()-&gt;<a class="code" href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">getOpcode</a>() == Opcode)</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;  <span class="comment">// If this is an add tree that is used by a sub instruction, ignore it</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  <span class="comment">// until we process the subtract.</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;  <span class="keywordflow">if</span> (BO-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>() &amp;&amp; BO-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() == Instruction::Add &amp;&amp;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;      cast&lt;Instruction&gt;(BO-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">use_back</a>())-&gt;getOpcode() == Instruction::Sub)</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;  ReassociateExpression(BO);</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;}</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="keywordtype">void</span> Reassociate::ReassociateExpression(<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *I) {</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;  <span class="comment">// First, walk the expression tree, linearizing the tree, collecting the</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;  <span class="comment">// operand information.</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;RepeatedValue, 8&gt;</a> Tree;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;  MadeChange |= <a class="code" href="Reassociate_8cpp.html#a628b394cb65dc0a50e31719469cad132">LinearizeExprTree</a>(I, Tree);</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;ValueEntry, 8&gt;</a> Ops;</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;  Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a4786e64977a3af38f29adee46b70a863">reserve</a>(Tree.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>());</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Tree.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    <a class="code" href="Reassociate_8cpp.html#a16254da0c95d3c3ade9165fca5e192b6">RepeatedValue</a> E = Tree[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a669d55980a7d4b6307b94596deeb0b1f">append</a>(E.second.getZExtValue(),</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;               ValueEntry(getRank(E.first), E.first));</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;  }</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;RAIn:\t&quot;</span>; <a class="code" href="Reassociate_8cpp.html#a035830591fff503ea933e8c88c84f3f8">PrintOps</a>(I, Ops); <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;  <span class="comment">// Now that we have linearized the tree to a list and have gathered all of</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;  <span class="comment">// the operands and their ranks, sort the operands by their rank.  Use a</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;  <span class="comment">// stable_sort so that values with equal ranks will have their relative</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;  <span class="comment">// positions maintained (and so the compiler is deterministic).  Note that</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;  <span class="comment">// this sorts so that the highest ranking values end up at the beginning of</span></div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;  <span class="comment">// the vector.</span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;  std::stable_sort(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>());</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;  <span class="comment">// OptimizeExpression - Now that we have the expression tree in a convenient</span></div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;  <span class="comment">// sorted form, optimize it globally if possible.</span></div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = OptimizeExpression(I, Ops)) {</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    <span class="keywordflow">if</span> (V == I)</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      <span class="comment">// Self-referential expression in unreachable code.</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    <span class="comment">// This expression tree simplified to something that isn&#39;t a tree,</span></div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    <span class="comment">// eliminate it.</span></div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Reassoc to scalar: &quot;</span> &lt;&lt; *V &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    I-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *VI = dyn_cast&lt;Instruction&gt;(V))</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;      VI-&gt;setDebugLoc(I-&gt;<a class="code" href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">getDebugLoc</a>());</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    RedoInsts.insert(I);</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    ++NumAnnihil;</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;  }</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;  <span class="comment">// We want to sink immediates as deeply as possible except in the case where</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;  <span class="comment">// this is a multiply tree used only by an add, and the immediate is a -1.</span></div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;  <span class="comment">// In this case we reassociate to put the negation on the outside so that we</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;  <span class="comment">// can fold the negation into the add: (-X)*Y + Z -&gt; Z-X*Y</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;  <span class="keywordflow">if</span> (I-&gt;<a class="code" href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">getOpcode</a>() == Instruction::Mul &amp;&amp; I-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>() &amp;&amp;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;      cast&lt;Instruction&gt;(I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">use_back</a>())-&gt;getOpcode() == Instruction::Add &amp;&amp;</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;      isa&lt;ConstantInt&gt;(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>().Op) &amp;&amp;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      cast&lt;ConstantInt&gt;(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">back</a>().Op)-&gt;isAllOnesValue()) {</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    ValueEntry Tmp = Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;    Ops.<a class="code" href="classllvm_1_1SmallVectorImpl.html#af622128e353515efebccad40eae495cb">insert</a>(Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Tmp);</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;  }</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;RAOut:\t&quot;</span>; <a class="code" href="Reassociate_8cpp.html#a035830591fff503ea933e8c88c84f3f8">PrintOps</a>(I, Ops); <a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;  <span class="keywordflow">if</span> (Ops.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == 1) {</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    <span class="keywordflow">if</span> (Ops[0].Op == I)</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;      <span class="comment">// Self-referential expression in unreachable code.</span></div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    <span class="comment">// This expression tree simplified to something that isn&#39;t a tree,</span></div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;    <span class="comment">// eliminate it.</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    I-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Ops[0].Op);</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *OI = dyn_cast&lt;Instruction&gt;(Ops[0].Op))</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;      OI-&gt;setDebugLoc(I-&gt;<a class="code" href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">getDebugLoc</a>());</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    RedoInsts.insert(I);</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;  }</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;  <span class="comment">// Now that we ordered and optimized the expressions, splat them back into</span></div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;  <span class="comment">// the expression tree, removing any unneeded nodes.</span></div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;  RewriteExprTree(I, Ops);</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;}</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="keywordtype">bool</span> Reassociate::runOnFunction(<a class="code" href="classllvm_1_1Function.html">Function</a> &amp;F) {</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;  <span class="comment">// Calculate the rank map for F</span></div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;  BuildRankMap(F);</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;  MadeChange = <span class="keyword">false</span>;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Function::iterator</a> BI = F.<a class="code" href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">begin</a>(), BE = F.<a class="code" href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">end</a>(); BI != BE; ++BI) {</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    <span class="comment">// Optimize every instruction in the basic block.</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> II = BI-&gt;begin(), <a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a> = BI-&gt;end(); II != <a class="code" href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">IE</a>; )</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#abe283966f269761ee387642061c4451e">isInstructionTriviallyDead</a>(II)) {</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;        EraseInst(II++);</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        OptimizeInst(II);</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;        assert(II-&gt;getParent() == BI &amp;&amp; <span class="stringliteral">&quot;Moved to a different block!&quot;</span>);</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;        ++II;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;      }</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <span class="comment">// If this produced extra instructions to optimize, handle them now.</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    <span class="keywordflow">while</span> (!RedoInsts.empty()) {</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I = RedoInsts.pop_back_val();</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#abe283966f269761ee387642061c4451e">isInstructionTriviallyDead</a>(I))</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;        EraseInst(I);</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;        OptimizeInst(I);</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    }</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;  }</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;  <span class="comment">// We are done with the rank map.</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;  RankMap.clear();</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;  ValueRankMap.clear();</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;  <span class="keywordflow">return</span> MadeChange;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;}</div><div class="ttc" id="classllvm_1_1Instruction_html_ab3448ed426eb302864ffef6e1584a971"><div class="ttname"><a href="classllvm_1_1Instruction.html#ab3448ed426eb302864ffef6e1584a971">llvm::Instruction::isNilpotent</a></div><div class="ttdeci">bool isNilpotent() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00290">Instruction.h:290</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a075e34e98605d0e7c289763a104869ac"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">llvm::SmallVectorTemplateCommon&lt; T &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00114">SmallVector.h:114</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a22a311dfe4c28a897de8a9365a4f0a84"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">llvm::SmallVectorTemplateCommon&lt; T &gt;::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00127">SmallVector.h:127</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_ae1a10b90f22c0478960fb5798ff73916"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">llvm::SmallVectorTemplateBase&lt; T, isPodLike&lt; T &gt;::value &gt;::push_back</a></div><div class="ttdeci">void push_back(const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00236">SmallVector.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad86469939d2a8bdd4169be9403b89f5a"><div class="ttname"><a href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">llvm::Value::use_end</a></div><div class="ttdeci">use_iterator use_end()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00152">Value.h:152</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_accc461d406589e0d5f010481a3095dc5"><div class="ttname"><a href="Reassociate_8cpp.html#accc461d406589e0d5f010481a3095dc5">STATISTIC</a></div><div class="ttdeci">STATISTIC(NumChanged,&quot;Number of insts reassociated&quot;)</div></div>
<div class="ttc" id="namespacellvm_html_ab8e34eca3b0817ef7a127913fbf6d9e4"><div class="ttname"><a href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">llvm::errs</a></div><div class="ttdeci">raw_ostream &amp; errs()</div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8cpp_source.html#l00664">raw_ostream.cpp:664</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a4786e64977a3af38f29adee46b70a863"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a4786e64977a3af38f29adee46b70a863">llvm::SmallVectorImpl::reserve</a></div><div class="ttdeci">void reserve(unsigned N)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00425">SmallVector.h:425</a></div></div>
<div class="ttc" id="classllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00035">PassRegistry.cpp:35</a></div></div>
<div class="ttc" id="namespacellvm_1_1SPII_html_a11e9b8fca4a074643a6a21f444e51406a5069619ca8fdce305534f3fe85091a0f"><div class="ttname"><a href="namespacellvm_1_1SPII.html#a11e9b8fca4a074643a6a21f444e51406a5069619ca8fdce305534f3fe85091a0f">llvm::SPII::Load</a></div><div class="ttdef"><b>Definition:</b> <a href="SparcInstrInfo_8h_source.html#l00031">SparcInstrInfo.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a6fe2f06b8a4b2c3d6308afb223a0238a"><div class="ttname"><a href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">llvm::Instruction::eraseFromParent</a></div><div class="ttdeci">void eraseFromParent()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00072">Instruction.cpp:72</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a7dc983ebf0eb2d255fa90a67063c72e2"><div class="ttname"><a href="classllvm_1_1APInt.html#a7dc983ebf0eb2d255fa90a67063c72e2">llvm::APInt::getZExtValue</a></div><div class="ttdeci">uint64_t getZExtValue() const </div><div class="ttdoc">Get zero extended value. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01306">APInt.h:1306</a></div></div>
<div class="ttc" id="Instructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_abd28e5089281e47a20646dd504218f3b"><div class="ttname"><a href="Reassociate_8cpp.html#abd28e5089281e47a20646dd504218f3b">LowerNegateToMultiply</a></div><div class="ttdeci">static BinaryOperator * LowerNegateToMultiply(Instruction *Neg)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00319">Reassociate.cpp:319</a></div></div>
<div class="ttc" id="namespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">List of target independent CodeGen pass IDs. </div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l00022">APFloat.h:22</a></div></div>
<div class="ttc" id="DerivedTypes_8h_html"><div class="ttname"><a href="DerivedTypes_8h.html">DerivedTypes.h</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html"><div class="ttname"><a href="classllvm_1_1Module.html">llvm::Module</a></div><div class="ttdoc">The main container class for the LLVM Intermediate Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00112">Module.h:112</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_ae4ca2261b8b901e415fda7feac5051ea"><div class="ttname"><a href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">llvm::Function::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00397">Function.h:397</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a58dc840fc84420b7f0b773794b8101c1"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a58dc840fc84420b7f0b773794b8101c1">llvm::SmallVectorTemplateCommon&lt; T &gt;::front</a></div><div class="ttdeci">reference front()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00148">SmallVector.h:148</a></div></div>
<div class="ttc" id="IntrinsicInst_8h_html"><div class="ttname"><a href="IntrinsicInst_8h.html">IntrinsicInst.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a3f2f98c2a67c9e79f58aad9150a62e42"><div class="ttname"><a href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">llvm::dyn_cast</a></div><div class="ttdeci">enable_if_c&lt;!is_simple_type&lt; Y &gt;::value, typename cast_retty&lt; X, const Y &gt;::ret_type &gt;::type dyn_cast(const Y &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="Casting_8h_source.html#l00266">Casting.h:266</a></div></div>
<div class="ttc" id="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode_html_a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4"><div class="ttname"><a href="namespacellvm_1_1NVPTX_1_1PTXLdStInstCode.html#a91119cbee2be000c528a690252aee07ca24244a27b634ef3e256ab3c64c6fecd4">llvm::NVPTX::PTXLdStInstCode::V2</a></div><div class="ttdef"><b>Definition:</b> <a href="NVPTX_8h_source.html#l00127">NVPTX.h:127</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00534">DenseMap.h:534</a></div></div>
<div class="ttc" id="README-SSE_8txt_html_a63d206a063eefcdf8c318ded97b65020"><div class="ttname"><a href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a></div><div class="ttdeci">This currently compiles esp xmm0 movsd esp eax eax esp ret We should use not the dag combiner This is because dagcombine2 needs to be able to see through the X86ISD::Wrapper which DAGCombine can t really do The code for turning x load into a single vector load is target independent and should be moved to the dag combiner The code for turning x load into a vector load can only handle a direct load from a global or a direct load from the stack It should be generalized to handle any load from P</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00427">README-SSE.txt:427</a></div></div>
<div class="ttc" id="Debug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_a7ffd35e4b6d2f3455d4aedf18778e7c3"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#a7ffd35e4b6d2f3455d4aedf18778e7c3">llvm::ConstantExpr::getBinOpIdentity</a></div><div class="ttdeci">static Constant * getBinOpIdentity(unsigned Opcode, Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l02131">Constants.cpp:2131</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_a3a76669632041022e6976766a22bd2b0"><div class="ttname"><a href="Target_2README_8txt.html#a3a76669632041022e6976766a22bd2b0">j</a></div><div class="ttdeci">return j(j&lt;&lt; 16)</div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a9b6dd0fc7a648a939e571246045b673e"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">llvm::SmallPtrSet::insert</a></div><div class="ttdeci">bool insert(PtrType Ptr)</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00253">SmallPtrSet.h:253</a></div></div>
<div class="ttc" id="namespacellvm_html_a7c469a194119a14e5a018ebb9b847cf0"><div class="ttname"><a href="namespacellvm.html#a7c469a194119a14e5a018ebb9b847cf0">llvm::operator&lt;</a></div><div class="ttdeci">void operator&lt;(const Optional&lt; T &gt; &amp;X, const Optional&lt; U &gt; &amp;Y)</div><div class="ttdoc">Poison comparison between two Optional objects. Clients needs to explicitly compare the underlying va...</div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_af622128e353515efebccad40eae495cb"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#af622128e353515efebccad40eae495cb">llvm::SmallVectorImpl::insert</a></div><div class="ttdeci">iterator insert(iterator I, const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00537">SmallVector.h:537</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_aca229503e4f5c83a187a6a921c625fa8"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">llvm::BasicBlock::getParent</a></div><div class="ttdeci">const Function * getParent() const </div><div class="ttdoc">Return the enclosing method, or null if none. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00116">BasicBlock.h:116</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a8300ac1ef141b8a7c63c13fa9369d976"><div class="ttname"><a href="classllvm_1_1Function.html#a8300ac1ef141b8a7c63c13fa9369d976">llvm::Function::arg_end</a></div><div class="ttdeci">arg_iterator arg_end()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00418">Function.h:418</a></div></div>
<div class="ttc" id="LLParser_8cpp_html_a33ece1ef8074506a15d7f86eb76dbae6"><div class="ttname"><a href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a></div><div class="ttdeci">F(f)</div></div>
<div class="ttc" id="classllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00070">Function.h:70</a></div></div>
<div class="ttc" id="classllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00033">User.h:33</a></div></div>
<div class="ttc" id="Statistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a7bd545769621a0a9d2cfb074f86f4295"><div class="ttname"><a href="classllvm_1_1Instruction.html#a7bd545769621a0a9d2cfb074f86f4295">llvm::Instruction::setDebugLoc</a></div><div class="ttdeci">void setDebugLoc(const DebugLoc &amp;Loc)</div><div class="ttdoc">setDebugLoc - Set the debug location information for this instruction. </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00175">Instruction.h:175</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a2eeb1c7ed1cfe403f2ae0470e36c07e2"><div class="ttname"><a href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">llvm::User::op_begin</a></div><div class="ttdeci">op_iterator op_begin()</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00116">User.h:116</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARM__PROC_html_a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e"><div class="ttname"><a href="namespacellvm_1_1ARM__PROC.html#a1add7850fad3f66c140ecee871460ea4ae9d798593a4a6b5cc48486a453a59e5e">llvm::ARM_PROC::IE</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInfo_8h_source.html#l00091">ARMBaseInfo.h:91</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_aa2fa38b27266e65a5b9940a0c3f00f1f"><div class="ttname"><a href="Reassociate_8cpp.html#aa2fa38b27266e65a5b9940a0c3f00f1f">FindSingleUseMultiplyFactors</a></div><div class="ttdeci">static void FindSingleUseMultiplyFactors(Value *V, SmallVectorImpl&lt; Value * &gt; &amp;Factors, const SmallVectorImpl&lt; ValueEntry &gt; &amp;Ops)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l01059">Reassociate.cpp:1059</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html_aa6574d526b3e38a28f688a7bb4325c2c"><div class="ttname"><a href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">llvm::Constant::getNullValue</a></div><div class="ttdeci">static Constant * getNullValue(Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00111">Constants.cpp:111</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad452febc1ac0b394876e640ec03ffa38"><div class="ttname"><a href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00167">Value.cpp:167</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0ed5f3ab3c2e4196ee0cffffa080c062"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">llvm::BasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00193">BasicBlock.h:193</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_a80cc7c4bd4a37fc13e9765fd3a31dbfe"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a80cc7c4bd4a37fc13e9765fd3a31dbfe">llvm::BinaryOperator::swapOperands</a></div><div class="ttdeci">bool swapOperands()</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01990">Instructions.cpp:1990</a></div></div>
<div class="ttc" id="namespacellvm_html_ae712552495c21ee77ad82ced255ad6df"><div class="ttname"><a href="namespacellvm.html#ae712552495c21ee77ad82ced255ad6df">llvm::WriteAsOperand</a></div><div class="ttdeci">void WriteAsOperand(raw_ostream &amp;, const Value *, bool PrintTy=true, const Module *Context=0)</div><div class="ttdef"><b>Definition:</b> <a href="AsmWriter_8cpp_source.html#l01179">AsmWriter.cpp:1179</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_a983e52a82d604057b45a59101a7ef257"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a983e52a82d604057b45a59101a7ef257">llvm::BinaryOperator::getNegArgument</a></div><div class="ttdeci">static const Value * getNegArgument(const Value *BinOp)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01957">Instructions.cpp:1957</a></div></div>
<div class="ttc" id="namespacellvm_1_1RegState_html_a079b254e749130fbe5d740f314ca92daab502f975742e9bff6d6dd7b49439b806"><div class="ttname"><a href="namespacellvm_1_1RegState.html#a079b254e749130fbe5d740f314ca92daab502f975742e9bff6d6dd7b49439b806">llvm::RegState::Undef</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00035">MachineInstrBuilder.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1value__use__iterator_html"><div class="ttname"><a href="classllvm_1_1value__use__iterator.html">llvm::value_use_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00168">Use.h:168</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_afd44535c4ae204571d5721fa4a7042f2"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#afd44535c4ae204571d5721fa4a7042f2">llvm::ConstantExpr::get</a></div><div class="ttdeci">static Constant * get(unsigned Opcode, Constant *C1, Constant *C2, unsigned Flags=0)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01690">Constants.cpp:1690</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a400eaca9881c8dcab97e9f42b1ab1815"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">llvm::SmallVectorImpl::pop_back_val</a></div><div class="ttdeci">T LLVM_ATTRIBUTE_UNUSED_RESULT pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00430">SmallVector.h:430</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00035">APInt.h:35</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_a1916c6024adf200133717bb5227fcbf4"><div class="ttname"><a href="Reassociate_8cpp.html#a1916c6024adf200133717bb5227fcbf4">isUnmovableInstruction</a></div><div class="ttdeci">static bool isUnmovableInstruction(Instruction *I)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00243">Reassociate.cpp:243</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html"><div class="ttname"><a href="classllvm_1_1IRBuilder.html">llvm::IRBuilder</a></div><div class="ttdoc">This provides a uniform API for creating instructions and inserting them into a basic block: either a...</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00421">IRBuilder.h:421</a></div></div>
<div class="ttc" id="STLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="namespacellvm_html_abd087b119f6143ca14a6475168a91f54"><div class="ttname"><a href="namespacellvm.html#abd087b119f6143ca14a6475168a91f54">llvm::createReassociatePass</a></div><div class="ttdeci">FunctionPass * createReassociatePass()</div></div>
<div class="ttc" id="classllvm_1_1Value_html_a35ee267850af7c235474a8c46c7ac5af"><div class="ttname"><a href="classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">llvm::Value::setName</a></div><div class="ttdeci">void setName(const Twine &amp;Name)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00175">Value.cpp:175</a></div></div>
<div class="ttc" id="namespacellvm_1_1CallingConv_html_a4f861731fc6dbfdccc05af5968d98974"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">llvm::CallingConv::ID</a></div><div class="ttdeci">ID</div><div class="ttdoc">LLVM Calling Convention Representation. </div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00026">CallingConv.h:26</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00031">Instruction.h:31</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_a9ebb022565fd67aef7b89a88b69dca9d"><div class="ttname"><a href="Reassociate_8cpp.html#a9ebb022565fd67aef7b89a88b69dca9d">OptimizeAndOrXor</a></div><div class="ttdeci">static Value * OptimizeAndOrXor(unsigned Opcode, SmallVectorImpl&lt; ValueEntry &gt; &amp;Ops)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l01077">Reassociate.cpp:1077</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_af348d5ea83429d08ba891ca3dd0e92b2"><div class="ttname"><a href="classllvm_1_1Type.html#af348d5ea83429d08ba891ca3dd0e92b2">llvm::Type::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdoc">getContext - Return the LLVMContext in which this type was uniqued. </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00128">Type.h:128</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a2ced6343b8ad006a757059554bbf9f37"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">llvm::SmallPtrSet::count</a></div><div class="ttdeci">bool count(PtrType Ptr) const </div><div class="ttdoc">count - Return true if the specified pointer is in the set. </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00264">SmallPtrSet.h:264</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorBase_html_a8a8df4d85555c7954a95f86080cd3b64"><div class="ttname"><a href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">llvm::SmallVectorBase::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00056">SmallVector.h:56</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_ac26154a24f393f523c87cc5f8239f36c"><div class="ttname"><a href="classllvm_1_1Instruction.html#ac26154a24f393f523c87cc5f8239f36c">llvm::Instruction::BinaryOps</a></div><div class="ttdeci">BinaryOps</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00387">Instruction.h:387</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_a16254da0c95d3c3ade9165fca5e192b6"><div class="ttname"><a href="Reassociate_8cpp.html#a16254da0c95d3c3ade9165fca5e192b6">RepeatedValue</a></div><div class="ttdeci">std::pair&lt; Value *, APInt &gt; RepeatedValue</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00421">Reassociate.cpp:421</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_aa113b8a9ef3de9c2f075a046ad658717"><div class="ttname"><a href="classllvm_1_1Instruction.html#aa113b8a9ef3de9c2f075a046ad658717">llvm::Instruction::isAssociative</a></div><div class="ttdeci">bool isAssociative() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00482">Instruction.cpp:482</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_ad517e28695345579aa30fae8783953d2"><div class="ttname"><a href="Reassociate_8cpp.html#ad517e28695345579aa30fae8783953d2">createAndInstr</a></div><div class="ttdeci">static Value * createAndInstr(Instruction *InsertBefore, Value *Opnd, const APInt &amp;ConstOpnd)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l01127">Reassociate.cpp:1127</a></div></div>
<div class="ttc" id="namespacellvm_html_af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51"><div class="ttname"><a href="namespacellvm.html#af6d6a791770bad2303c4399986979e3eae411369b2f0d8f484fec62c3291b1b51">llvm::Call</a></div><div class="ttdef"><b>Definition:</b> <a href="CallingConvLower_8h_source.html#l00149">CallingConvLower.h:149</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a40113570b0c52a18c34cabed8359e2c8"><div class="ttname"><a href="classllvm_1_1Type.html#a40113570b0c52a18c34cabed8359e2c8">llvm::Type::isFloatingPointTy</a></div><div class="ttdeci">bool isFloatingPointTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00162">Type.h:162</a></div></div>
<div class="ttc" id="classllvm_1_1ReversePostOrderTraversal_html_ac958000d711f19778f1b40792821b5b3"><div class="ttname"><a href="classllvm_1_1ReversePostOrderTraversal.html#ac958000d711f19778f1b40792821b5b3">llvm::ReversePostOrderTraversal::begin</a></div><div class="ttdeci">rpo_iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="PostOrderIterator_8h_source.html#l00273">PostOrderIterator.h:273</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00303">Value.cpp:303</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ae855357b6c5e6e7ed1869272708a3a84"><div class="ttname"><a href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">llvm::Value::takeName</a></div><div class="ttdeci">void takeName(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00239">Value.cpp:239</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a88a5e60837674780a9d812d661897ac5"><div class="ttname"><a href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">llvm::Function::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00395">Function.h:395</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a3d95172e192ecd22f18b0b76da6d2320"><div class="ttname"><a href="classllvm_1_1Instruction.html#a3d95172e192ecd22f18b0b76da6d2320">llvm::Instruction::getOpcodeName</a></div><div class="ttdeci">const char * getOpcodeName() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00085">Instruction.h:85</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_a57781e19c89adc7ec1a5da6d156aced0"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a57781e19c89adc7ec1a5da6d156aced0">llvm::BinaryOperator::getNotArgument</a></div><div class="ttdeci">static const Value * getNotArgument(const Value *BinOp)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01980">Instructions.cpp:1980</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a1dc5339334162e650ff87e89629bf66c"><div class="ttname"><a href="classllvm_1_1APInt.html#a1dc5339334162e650ff87e89629bf66c">llvm::APInt::ult</a></div><div class="ttdeci">bool ult(const APInt &amp;RHS) const </div><div class="ttdoc">Unsigned less than comparison. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8cpp_source.html#l00515">APInt.cpp:515</a></div></div>
<div class="ttc" id="README__ALTIVEC_8txt_html_a9aacd9146afe44bf656cd664e2a88c8c"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div><div class="ttdeci">(vector float) vec_cmpeq(*A,*B) C</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00091">README_ALTIVEC.txt:91</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_a2a1544550a3fa7e797ff4dae2e6149ce"><div class="ttname"><a href="Reassociate_8cpp.html#a2a1544550a3fa7e797ff4dae2e6149ce">buildMultiplyTree</a></div><div class="ttdeci">static Value * buildMultiplyTree(IRBuilder&lt;&gt; &amp;Builder, SmallVectorImpl&lt; Value * &gt; &amp;Ops)</div><div class="ttdoc">Build a tree of multiplies, computing the product of Ops. </div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l01627">Reassociate.cpp:1627</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_acd9e771a3296c6b24146955754620557"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#acd9e771a3296c6b24146955754620557">llvm::SmallVectorTemplateCommon&lt; T &gt;::back</a></div><div class="ttdeci">reference back()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00157">SmallVector.h:157</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_ac2c09b1da0dee14d7f8c81a90992712e"><div class="ttname"><a href="Reassociate_8cpp.html#ac2c09b1da0dee14d7f8c81a90992712e">INITIALIZE_PASS</a></div><div class="ttdeci">INITIALIZE_PASS(Reassociate,&quot;reassociate&quot;,&quot;Reassociate expressions&quot;, false, false) FunctionPass *llvm</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00228">Reassociate.cpp:228</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_aac0ea55010b7b1a301e65a0baea057aa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">llvm::SmallVectorImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00396">SmallVector.h:396</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00072">BasicBlock.h:72</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html"><div class="ttname"><a href="classllvm_1_1Type.html">llvm::Type</a></div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00044">Type.h:44</a></div></div>
<div class="ttc" id="classllvm_1_1LLVMContext_html"><div class="ttname"><a href="classllvm_1_1LLVMContext.html">llvm::LLVMContext</a></div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00037">LLVMContext.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a6f725580f7834e2ca90762965866dad4"><div class="ttname"><a href="classllvm_1_1Type.html#a6f725580f7834e2ca90762965866dad4">llvm::Type::isVectorTy</a></div><div class="ttdeci">bool isVectorTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00229">Type.h:229</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html"><div class="ttname"><a href="classllvm_1_1Constant.html">llvm::Constant</a></div><div class="ttdoc">LLVM Constant Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Constant_8h_source.html#l00041">Constant.h:41</a></div></div>
<div class="ttc" id="classllvm_1_1ReversePostOrderTraversal_html"><div class="ttname"><a href="classllvm_1_1ReversePostOrderTraversal.html">llvm::ReversePostOrderTraversal</a></div><div class="ttdef"><b>Definition:</b> <a href="PostOrderIterator_8h_source.html#l00259">PostOrderIterator.h:259</a></div></div>
<div class="ttc" id="Support_2CFG_8h_html"><div class="ttname"><a href="Support_2CFG_8h.html">CFG.h</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_a48b0ec8ef22f4b5a509119d94069f7fb"><div class="ttname"><a href="Reassociate_8cpp.html#a48b0ec8ef22f4b5a509119d94069f7fb">NegateValue</a></div><div class="ttdeci">static Value * NegateValue(Value *V, Instruction *BI)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00836">Reassociate.cpp:836</a></div></div>
<div class="ttc" id="Constants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1APIntOps_html_a22f056804d2b9882f74adc905872bc39"><div class="ttname"><a href="namespacellvm_1_1APIntOps.html#a22f056804d2b9882f74adc905872bc39">llvm::APIntOps::Or</a></div><div class="ttdeci">APInt Or(const APInt &amp;LHS, const APInt &amp;RHS)</div><div class="ttdoc">Bitwise OR function for APInt. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01845">APInt.h:1845</a></div></div>
<div class="ttc" id="namespacellvm_html_abe283966f269761ee387642061c4451e"><div class="ttname"><a href="namespacellvm.html#abe283966f269761ee387642061c4451e">llvm::isInstructionTriviallyDead</a></div><div class="ttdeci">bool isInstructionTriviallyDead(Instruction *I, const TargetLibraryInfo *TLI=0)</div><div class="ttdef"><b>Definition:</b> <a href="Local_8cpp_source.html#l00266">Local.cpp:266</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_aa5dd8cc53e4d4c3e0d2100880d874a7d"><div class="ttname"><a href="Reassociate_8cpp.html#aa5dd8cc53e4d4c3e0d2100880d874a7d">EmitAddTreeOfValues</a></div><div class="ttdeci">static Value * EmitAddTreeOfValues(Instruction *I, SmallVectorImpl&lt; WeakVH &gt; &amp;Ops)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00985">Reassociate.cpp:985</a></div></div>
<div class="ttc" id="namespacellvm_1_1APIntOps_html_afc7c4d88d09cba0c5e920f8a3a3ace55"><div class="ttname"><a href="namespacellvm_1_1APIntOps.html#afc7c4d88d09cba0c5e920f8a3a3ace55">llvm::APIntOps::Xor</a></div><div class="ttdeci">APInt Xor(const APInt &amp;LHS, const APInt &amp;RHS)</div><div class="ttdoc">Bitwise XOR function for APInt. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01850">APInt.h:1850</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_aec662ee6ab1490a4cabebf2812e5b9ca"><div class="ttname"><a href="classllvm_1_1APInt.html#aec662ee6ab1490a4cabebf2812e5b9ca">llvm::APInt::getOneBitSet</a></div><div class="ttdeci">static APInt getOneBitSet(unsigned numBits, unsigned BitNo)</div><div class="ttdoc">Return an APInt with exactly one bit set in the result. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00476">APInt.h:476</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_aab8e16a35183ce39aad394714087bcff"><div class="ttname"><a href="classllvm_1_1Instruction.html#aab8e16a35183ce39aad394714087bcff">llvm::Instruction::getDebugLoc</a></div><div class="ttdeci">const DebugLoc &amp; getDebugLoc() const </div><div class="ttdoc">getDebugLoc - Return the debug location for this node as a DebugLoc. </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00178">Instruction.h:178</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00037">PassAnalysisSupport.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_af41f58e730804d10b91fcff39b035f74"><div class="ttname"><a href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">llvm::User::op_end</a></div><div class="ttdeci">op_iterator op_end()</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00118">User.h:118</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_ad081689e23a8f5dea78dedd623d6a8f8"><div class="ttname"><a href="classllvm_1_1APInt.html#ad081689e23a8f5dea78dedd623d6a8f8">llvm::APInt::getBitWidth</a></div><div class="ttdeci">unsigned getBitWidth() const </div><div class="ttdoc">Return the number of bits in the APInt. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01252">APInt.h:1252</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_ac0b4ab314244698be760dbe58b869956"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#ac0b4ab314244698be760dbe58b869956">llvm::BinaryOperator::CreateNeg</a></div><div class="ttdeci">NUW NUW NUW NUW Exact static Exact BinaryOperator * CreateNeg(Value *Op, const Twine &amp;Name=&quot;&quot;, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01850">Instructions.cpp:1850</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionPass_html"><div class="ttname"><a href="classllvm_1_1FunctionPass.html">llvm::FunctionPass</a></div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00293">Pass.h:293</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a321e37d79af8b4287f8a1dcf9aff9c01"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, KeyInfoT &gt;, KeyT, ValueT, KeyInfoT &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00057">DenseMap.h:57</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a997ff6a1758bf732b9b263fc61011644"><div class="ttname"><a href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">llvm::User::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00088">User.h:88</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a1c2048f254df730c4de1643ec791ddf9"><div class="ttname"><a href="classllvm_1_1Instruction.html#a1c2048f254df730c4de1643ec791ddf9">llvm::Instruction::isCommutative</a></div><div class="ttdeci">bool isCommutative() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00269">Instruction.h:269</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a8bf193a781a92cae52d7f9216d0824f8"><div class="ttname"><a href="classllvm_1_1Function.html#a8bf193a781a92cae52d7f9216d0824f8">llvm::Function::arg_begin</a></div><div class="ttdeci">arg_iterator arg_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00410">Function.h:410</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_a454128b3938d8b6c6305e9c74204cc53"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a454128b3938d8b6c6305e9c74204cc53">llvm::BinaryOperator::isNot</a></div><div class="ttdeci">static bool isNot(const Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01945">Instructions.cpp:1945</a></div></div>
<div class="ttc" id="Writer_8h_html"><div class="ttname"><a href="Writer_8h.html">Writer.h</a></div></div>
<div class="ttc" id="DenseMap_8h_html"><div class="ttname"><a href="DenseMap_8h.html">DenseMap.h</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html_a4d51384de6e1798bb6aa875aebeea9f0"><div class="ttname"><a href="classllvm_1_1Constant.html#a4d51384de6e1798bb6aa875aebeea9f0">llvm::Constant::getAllOnesValue</a></div><div class="ttdeci">static Constant * getAllOnesValue(Type *Ty)</div><div class="ttdoc">Get the all ones value. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00163">Constants.cpp:163</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a669d55980a7d4b6307b94596deeb0b1f"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a669d55980a7d4b6307b94596deeb0b1f">llvm::SmallVectorImpl::append</a></div><div class="ttdeci">void append(in_iter in_start, in_iter in_end)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00445">SmallVector.h:445</a></div></div>
<div class="ttc" id="classllvm_1_1UndefValue_html_a4ae5ff22b700a42bcc5d889233721335"><div class="ttname"><a href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">llvm::UndefValue::get</a></div><div class="ttdeci">static UndefValue * get(Type *T)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01334">Constants.cpp:1334</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a18c110c35e9133222a37b28d30f8a90f"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">llvm::SmallVectorImpl::erase</a></div><div class="ttdeci">iterator erase(iterator I)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00478">SmallVector.h:478</a></div></div>
<div class="ttc" id="classT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_a3b5239d08485869f6cb244badd0727fd"><div class="ttname"><a href="Reassociate_8cpp.html#a3b5239d08485869f6cb244badd0727fd">CarmichaelShift</a></div><div class="ttdeci">static unsigned CarmichaelShift(unsigned Bitwidth)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00336">Reassociate.cpp:336</a></div></div>
<div class="ttc" id="classllvm_1_1ReversePostOrderTraversal_html_aa447608e2881e813215c3f289496c6ea"><div class="ttname"><a href="classllvm_1_1ReversePostOrderTraversal.html#aa447608e2881e813215c3f289496c6ea">llvm::ReversePostOrderTraversal::rpo_iterator</a></div><div class="ttdeci">std::vector&lt; NodeType * &gt;::reverse_iterator rpo_iterator</div><div class="ttdef"><b>Definition:</b> <a href="PostOrderIterator_8h_source.html#l00266">PostOrderIterator.h:266</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_a88505baf41407782678a5df1702d2d31"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a88505baf41407782678a5df1702d2d31">llvm::BinaryOperator::getOpcode</a></div><div class="ttdeci">BinaryOps getOpcode() const </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00326">InstrTypes.h:326</a></div></div>
<div class="ttc" id="namespacellvm_1_1TargetOpcode_html_a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72"><div class="ttname"><a href="namespacellvm_1_1TargetOpcode.html#a348d4259b5fa6a8ecfe94e7ae512e1a8ae41f9ca68ba5e8b9613cea03652ebd72">llvm::TargetOpcode::PHI</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetOpcodes_8h_source.html#l00026">TargetOpcodes.h:26</a></div></div>
<div class="ttc" id="classllvm_1_1ilist__iterator_html"><div class="ttname"><a href="classllvm_1_1ilist__iterator.html">llvm::ilist_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00050">ilist.h:50</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html">llvm::SmallPtrSet</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00236">SmallPtrSet.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a0519dc6e2f153aaed61eed17d965a9f0"><div class="ttname"><a href="classllvm_1_1Type.html#a0519dc6e2f153aaed61eed17d965a9f0">llvm::Type::getIntegerBitWidth</a></div><div class="ttdeci">unsigned getIntegerBitWidth() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00178">Type.cpp:178</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html"><div class="ttname"><a href="classllvm_1_1ConstantInt.html">llvm::ConstantInt</a></div><div class="ttdoc">Class for constant integers. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00051">Constants.h:51</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00029">Target/README.txt:29</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0b4e7bee9b8575cc7db73329f1a561bd"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">llvm::BasicBlock::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00195">BasicBlock.h:195</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_a2a2df5a25b9c703e74e82b48a75d0c3d"><div class="ttname"><a href="Target_2README_8txt.html#a2a2df5a25b9c703e74e82b48a75d0c3d">C1</a></div><div class="ttdeci">instcombine should handle this C2 when C1</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00300">Target/README.txt:300</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00880">SmallVector.h:880</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a0cf3748dba54f931bb1241ae4adc76bc"><div class="ttname"><a href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00111">Value.h:111</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html">llvm::BinaryOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00138">InstrTypes.h:138</a></div></div>
<div class="ttc" id="classllvm_1_1IRBuilder_html_a94c18bf85a5105e0a22fba23b0bedafa"><div class="ttname"><a href="classllvm_1_1IRBuilder.html#a94c18bf85a5105e0a22fba23b0bedafa">llvm::IRBuilder::CreateMul</a></div><div class="ttdeci">Value * CreateMul(Value *LHS, Value *RHS, const Twine &amp;Name=&quot;&quot;, bool HasNUW=false, bool HasNSW=false)</div><div class="ttdef"><b>Definition:</b> <a href="IRBuilder_8h_source.html#l00659">IRBuilder.h:659</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a9105541412dab869e18b3cceebfff07d"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">llvm::ConstantInt::get</a></div><div class="ttdeci">static Constant * get(Type *Ty, uint64_t V, bool isSigned=false)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00492">Constants.cpp:492</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html_af11a6ebf7ab3c388234cb6d5378439a3"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#af11a6ebf7ab3c388234cb6d5378439a3">llvm::AnalysisUsage::setPreservesCFG</a></div><div class="ttdeci">void setPreservesCFG()</div><div class="ttdef"><b>Definition:</b> <a href="Pass_8cpp_source.html#l00249">Pass.cpp:249</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a30f2c362631e3728d2f47a8203071ade"><div class="ttname"><a href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">llvm::Function::getEntryBlock</a></div><div class="ttdeci">const BasicBlock &amp; getEntryBlock() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00380">Function.h:380</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a5fa9b8e1842b354f64c1ba6be0a4a17f"><div class="ttname"><a href="classllvm_1_1User.html#a5fa9b8e1842b354f64c1ba6be0a4a17f">llvm::User::setOperand</a></div><div class="ttdeci">void setOperand(unsigned i, Value *Val)</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00092">User.h:92</a></div></div>
<div class="ttc" id="namespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs - Return a circular-buffered debug stream. </div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00101">Debug.cpp:101</a></div></div>
<div class="ttc" id="namespacestd_html_ab8424022895aee3e366fb9a32f2883cb"><div class="ttname"><a href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a></div><div class="ttdeci">void swap(llvm::BitVector &amp;LHS, llvm::BitVector &amp;RHS)</div><div class="ttdoc">Implement std::swap in terms of BitVector swap. </div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00591">BitVector.h:591</a></div></div>
<div class="ttc" id="namespacellvm_html_a3365ab6a499cd47658f57dab9a8d4703"><div class="ttname"><a href="namespacellvm.html#a3365ab6a499cd47658f57dab9a8d4703">llvm::initializeReassociatePass</a></div><div class="ttdeci">void initializeReassociatePass(PassRegistry &amp;)</div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_a2215d5a274d2cf9c064e69452ce17f03"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a2215d5a274d2cf9c064e69452ce17f03">llvm::BinaryOperator::isNeg</a></div><div class="ttdeci">static bool isNeg(const Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01926">Instructions.cpp:1926</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html"><div class="ttname"><a href="classllvm_1_1APInt.html">llvm::APInt</a></div><div class="ttdoc">Class for arbitrary precision integers. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00075">APInt.h:75</a></div></div>
<div class="ttc" id="CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="CodeGen_2README_8txt_source.html#l00036">CodeGen/README.txt:36</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a6e328feb83afa5cf1c966d6704e43fc1"><div class="ttname"><a href="classllvm_1_1Type.html#a6e328feb83afa5cf1c966d6704e43fc1">llvm::Type::isIntegerTy</a></div><div class="ttdeci">bool isIntegerTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00196">Type.h:196</a></div></div>
<div class="ttc" id="Pass_8h_html"><div class="ttname"><a href="Pass_8h.html">Pass.h</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a5ac211f24970dea81fa9a7118a8ce36b"><div class="ttname"><a href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">llvm::Instruction::use_back</a></div><div class="ttdeci">Instruction * use_back()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00049">Instruction.h:49</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a963c4f881fbc3e316e8260bf98453ce4"><div class="ttname"><a href="classllvm_1_1APInt.html#a963c4f881fbc3e316e8260bf98453ce4">llvm::APInt::isMinValue</a></div><div class="ttdeci">bool isMinValue() const </div><div class="ttdoc">Determine if this is the smallest unsigned value. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00365">APInt.h:365</a></div></div>
<div class="ttc" id="Function_8h_html"><div class="ttname"><a href="Function_8h.html">Function.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1APIntOps_html_a684cfe02c582e8d75cd6d457e63e6c25"><div class="ttname"><a href="namespacellvm_1_1APIntOps.html#a684cfe02c582e8d75cd6d457e63e6c25">llvm::APIntOps::And</a></div><div class="ttdeci">APInt And(const APInt &amp;LHS, const APInt &amp;RHS)</div><div class="ttdoc">Bitwise AND function for APInt. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01840">APInt.h:1840</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a8a045d250952c0867382a9840ee18fdf"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">llvm::SmallVectorTemplateCommon&lt; T &gt;::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00112">SmallVector.h:112</a></div></div>
<div class="ttc" id="ValueHandle_8h_html"><div class="ttname"><a href="ValueHandle_8h.html">ValueHandle.h</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_afa29f0cd072ab9b3a2630681ffe5760f"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#afa29f0cd072ab9b3a2630681ffe5760f">llvm::ConstantExpr::getNeg</a></div><div class="ttdeci">static Constant * getNeg(Constant *C, bool HasNUW=false, bool HasNSW=false)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l02021">Constants.cpp:2021</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a413abcab8dbc3900fc2fde96a5d8fca6"><div class="ttname"><a href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">llvm::Value::use_begin</a></div><div class="ttdeci">use_iterator use_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00150">Value.h:150</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a21260f8037e665d235ace5718cf68bc4"><div class="ttname"><a href="classllvm_1_1APInt.html#a21260f8037e665d235ace5718cf68bc4">llvm::APInt::isAllOnesValue</a></div><div class="ttdeci">bool isAllOnesValue() const </div><div class="ttdoc">Determine if all bits are set. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00340">APInt.h:340</a></div></div>
<div class="ttc" id="Transforms_2Scalar_8h_html"><div class="ttname"><a href="Transforms_2Scalar_8h.html">Scalar.h</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_ae20b217e73a0ca8f5d8841ce09d7f144"><div class="ttname"><a href="Reassociate_8cpp.html#ae20b217e73a0ca8f5d8841ce09d7f144">BreakUpSubtract</a></div><div class="ttdeci">static BinaryOperator * BreakUpSubtract(Instruction *Sub)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00927">Reassociate.cpp:927</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_ade4b72d6a35be96766511e1c9c58b706"><div class="ttname"><a href="classllvm_1_1Instruction.html#ade4b72d6a35be96766511e1c9c58b706">llvm::Instruction::isIdempotent</a></div><div class="ttdeci">bool isIdempotent() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00278">Instruction.h:278</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_a035830591fff503ea933e8c88c84f3f8"><div class="ttname"><a href="Reassociate_8cpp.html#a035830591fff503ea933e8c88c84f3f8">PrintOps</a></div><div class="ttdeci">static void PrintOps(Instruction *I, const SmallVectorImpl&lt; ValueEntry &gt; &amp;Ops)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00064">Reassociate.cpp:64</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_a838450a1f01fb48a3cc7da747418a8c5"><div class="ttname"><a href="Reassociate_8cpp.html#a838450a1f01fb48a3cc7da747418a8c5">IncorporateWeight</a></div><div class="ttdeci">static void IncorporateWeight(APInt &amp;LHS, const APInt &amp;RHS, unsigned Opcode)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00349">Reassociate.cpp:349</a></div></div>
<div class="ttc" id="MD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00054">MD5.cpp:54</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a085b82f074c28030fb8e194377ed2d0c"><div class="ttname"><a href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">llvm::Value::hasOneUse</a></div><div class="ttdeci">bool hasOneUse() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00161">Value.h:161</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_a1f2303df9bbee2233c11d61c2f6f7930"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#a1f2303df9bbee2233c11d61c2f6f7930">llvm::SmallVectorTemplateBase&lt; T, isPodLike&lt; T &gt;::value &gt;::pop_back</a></div><div class="ttdeci">void pop_back()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00260">SmallVector.h:260</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_aa5ad9e9e7cc67e1675d8d1631a73e625"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#aa5ad9e9e7cc67e1675d8d1631a73e625">llvm::ConstantExpr::getShl</a></div><div class="ttdeci">static Constant * getShl(Constant *C1, Constant *C2, bool HasNUW=false, bool HasNSW=false)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l02111">Constants.cpp:2111</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a8eafa71cf399da8f21b2af5549f3f9e7"><div class="ttname"><a href="classllvm_1_1Type.html#a8eafa71cf399da8f21b2af5549f3f9e7">llvm::Type::getScalarType</a></div><div class="ttdeci">const Type * getScalarType() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00051">Type.cpp:51</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_a4a4628e91a9c6a339fa61105614fac76"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a4a4628e91a9c6a339fa61105614fac76">llvm::BinaryOperator::Create</a></div><div class="ttdeci">static BinaryOperator * Create(BinaryOps Op, Value *S1, Value *S2, const Twine &amp;Name=Twine(), Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01834">Instructions.cpp:1834</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a5a7cfa245af120b44ac8a86143bb9e57"><div class="ttname"><a href="classllvm_1_1Type.html#a5a7cfa245af120b44ac8a86143bb9e57">llvm::Type::getPrimitiveSizeInBits</a></div><div class="ttdeci">unsigned getPrimitiveSizeInBits() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00117">Type.cpp:117</a></div></div>
<div class="ttc" id="IRBuilder_8h_html"><div class="ttname"><a href="IRBuilder_8h.html">IRBuilder.h</a></div></div>
<div class="ttc" id="CaptureTracking_8cpp_html_ac30708db2a991631cbf3d95c6324d929"><div class="ttname"><a href="CaptureTracking_8cpp.html#ac30708db2a991631cbf3d95c6324d929">Threshold</a></div><div class="ttdeci">static int const Threshold</div><div class="ttdef"><b>Definition:</b> <a href="CaptureTracking_8cpp_source.html#l00080">CaptureTracking.cpp:80</a></div></div>
<div class="ttc" id="SetVector_8h_html"><div class="ttname"><a href="SetVector_8h.html">SetVector.h</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_a0f1f6d5922fdbea17fd61e9b033d0e0c"><div class="ttname"><a href="Reassociate_8cpp.html#a0f1f6d5922fdbea17fd61e9b033d0e0c">ConvertShiftToMul</a></div><div class="ttdeci">static BinaryOperator * ConvertShiftToMul(Instruction *Shl)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00952">Reassociate.cpp:952</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ac38c53f76ef532f91f1666c8a87370e9"><div class="ttname"><a href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">llvm::Value::use_empty</a></div><div class="ttdeci">bool use_empty() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00149">Value.h:149</a></div></div>
<div class="ttc" id="classllvm_1_1ReversePostOrderTraversal_html_ae945899e1218a9240c3fed1e5789cbba"><div class="ttname"><a href="classllvm_1_1ReversePostOrderTraversal.html#ae945899e1218a9240c3fed1e5789cbba">llvm::ReversePostOrderTraversal::end</a></div><div class="ttdeci">rpo_iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="PostOrderIterator_8h_source.html#l00274">PostOrderIterator.h:274</a></div></div>
<div class="ttc" id="Local_8h_html"><div class="ttname"><a href="Local_8h.html">Local.h</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_a9e1fc23a17e97d2d1732e753ae9251ac"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">llvm::GlobalValue::getParent</a></div><div class="ttdeci">Module * getParent()</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00286">GlobalValue.h:286</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00066">Value.h:66</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_a009b54c05762d1e08d2ed83a0f26865a"><div class="ttname"><a href="Reassociate_8cpp.html#a009b54c05762d1e08d2ed83a0f26865a">FindInOperandList</a></div><div class="ttdeci">static unsigned FindInOperandList(SmallVectorImpl&lt; ValueEntry &gt; &amp;Ops, unsigned i, Value *X)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00969">Reassociate.cpp:969</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a021bb7c9aad6003fe8089f6327356c6c"><div class="ttname"><a href="classllvm_1_1Instruction.html#a021bb7c9aad6003fe8089f6327356c6c">llvm::Instruction::getOpcode</a></div><div class="ttdeci">unsigned getOpcode() const </div><div class="ttdoc">getOpcode() returns a member of one of the enums like Instruction::Add. </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00083">Instruction.h:83</a></div></div>
<div class="ttc" id="Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="Target_2X86_2README_8txt_source.html#l00297">Target/X86/README.txt:297</a></div></div>
<div class="ttc" id="PostOrderIterator_8h_html"><div class="ttname"><a href="PostOrderIterator_8h.html">PostOrderIterator.h</a></div></div>
<div class="ttc" id="classllvm_1_1SetVector_html"><div class="ttname"><a href="classllvm_1_1SetVector.html">llvm::SetVector</a></div><div class="ttdoc">A vector that has set insertion semantics. </div><div class="ttdef"><b>Definition:</b> <a href="SetVector_8h_source.html#l00037">SetVector.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a48790dc28d4007833380faed30c9f44c"><div class="ttname"><a href="classllvm_1_1Value.html#a48790dc28d4007833380faed30c9f44c">llvm::Value::clearSubclassOptionalData</a></div><div class="ttdeci">void clearSubclassOptionalData()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00246">Value.h:246</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_af67d1f3a518964d80a109bb3d9d5cf1e"><div class="ttname"><a href="classllvm_1_1Instruction.html#af67d1f3a518964d80a109bb3d9d5cf1e">llvm::Instruction::moveBefore</a></div><div class="ttdeci">void moveBefore(Instruction *MovePos)</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00091">Instruction.cpp:91</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_a0bd7f001f64bd74e1ed4bc26d7e47b64"><div class="ttname"><a href="Reassociate_8cpp.html#a0bd7f001f64bd74e1ed4bc26d7e47b64">isReassociableOp</a></div><div class="ttdeci">static BinaryOperator * isReassociableOp(Value *V, unsigned Opcode)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00236">Reassociate.cpp:236</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">llvm::A64CC::MI</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00035">AArch64BaseInfo.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1InvokeInst_html"><div class="ttname"><a href="classllvm_1_1InvokeInst.html">llvm::InvokeInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02841">Instructions.h:2841</a></div></div>
<div class="ttc" id="Debug_8h_html_aef41e8aaf4c60819b30faf396cdf4978"><div class="ttname"><a href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a></div><div class="ttdeci">#define DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00097">Debug.h:97</a></div></div>
<div class="ttc" id="raw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_a19d2abc5a580be68aa7751c0e1ce7263"><div class="ttname"><a href="Reassociate_8cpp.html#a19d2abc5a580be68aa7751c0e1ce7263">ShouldBreakUpSubtract</a></div><div class="ttdeci">static bool ShouldBreakUpSubtract(Instruction *Sub)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00903">Reassociate.cpp:903</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_a4ba7d7f0a1e911c8384e236b5f6c1959"><div class="ttname"><a href="classllvm_1_1APInt.html#a4ba7d7f0a1e911c8384e236b5f6c1959">llvm::APInt::getNullValue</a></div><div class="ttdeci">static APInt getNullValue(unsigned numBits)</div><div class="ttdoc">Get the &amp;#39;0&amp;#39; value. </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00457">APInt.h:457</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a21cf94357e53cd1069aba475266fdb63"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, KeyInfoT &gt;, KeyT, ValueT, KeyInfoT &gt;::find</a></div><div class="ttdeci">iterator find(const KeyT &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00108">DenseMap.h:108</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_aa395493c74905979f5653cc674d43283"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#aa395493c74905979f5653cc674d43283">llvm::ConstantExpr::getBinOpAbsorber</a></div><div class="ttdeci">static Constant * getBinOpAbsorber(unsigned Opcode, Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l02154">Constants.cpp:2154</a></div></div>
<div class="ttc" id="Reassociate_8cpp_html_a628b394cb65dc0a50e31719469cad132"><div class="ttname"><a href="Reassociate_8cpp.html#a628b394cb65dc0a50e31719469cad132">LinearizeExprTree</a></div><div class="ttdeci">static bool LinearizeExprTree(BinaryOperator *I, SmallVectorImpl&lt; RepeatedValue &gt; &amp;Ops)</div><div class="ttdef"><b>Definition:</b> <a href="Reassociate_8cpp_source.html#l00497">Reassociate.cpp:497</a></div></div>
<div class="ttc" id="namespacellvm_html_a6569d00d31a5d74e563e2f39f82271ab"><div class="ttname"><a href="namespacellvm.html#a6569d00d31a5d74e563e2f39f82271ab">llvm::X</a></div><div class="ttdeci">static RegisterPass&lt; NVPTXAllocaHoisting &gt; X(&quot;alloca-hoisting&quot;,&quot;Hoisting alloca instructions in non-entry &quot;&quot;blocks to the entry block&quot;)</div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a9cd49851904f15060edb782ef4dd1b2d"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00052">Instruction.h:52</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<p class="footer">
Generated on Sat Nov 10 2018 23:01:03 for <a href="http://llvm.org/">LLVM</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.8.11</a><br>
Copyright &copy; 2003-2013 University of Illinois at Urbana-Champaign.
All Rights Reserved.</p>
<hr>
<!--#include virtual="/attrib.incl" -->
</body>
</html>
