<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="LLVM,Low Level Virtual Machine,C++,doxygen,API,documentation"/>
<meta name="description" content="C++ source code API documentation for LLVM."/>
<title>LLVM: SpillPlacement.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">LLVM API Documentation</p>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('SpillPlacement_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SpillPlacement.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="SpillPlacement_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===-- SpillPlacement.cpp - Optimal Spill Code Placement -----------------===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                     The LLVM Compiler Infrastructure</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is distributed under the University of Illinois Open Source</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License. See LICENSE.TXT for details.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// This file implements the spill code placement analysis.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// Each edge bundle corresponds to a node in a Hopfield network. Constraints on</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// basic blocks are weighted by the block frequency and added to become the node</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// bias.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// Transparent basic blocks have the variable live through, but don&#39;t care if it</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// is spilled or in a register. These blocks become connections in the Hopfield</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// network, again weighted by block frequency.</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">// The Hopfield network minimizes (possibly locally) its energy function:</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//   E = -sum_n V_n * ( B_n + sum_{n, m linked by b} V_m * F_b )</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">// The energy function represents the expected spill code execution frequency,</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">// or the cost of spilling. This is a Lyapunov function which never increases</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">// when a node is updated. It is guaranteed to converge to a local minimum.</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="SpillPlacement_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   30</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;spillplacement&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SpillPlacement_8h.html">SpillPlacement.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BitVector_8h.html">llvm/ADT/BitVector.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="EdgeBundles_8h.html">llvm/CodeGen/EdgeBundles.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineBasicBlock_8h.html">llvm/CodeGen/MachineBasicBlock.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineBlockFrequencyInfo_8h.html">llvm/CodeGen/MachineBlockFrequencyInfo.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineFunction_8h.html">llvm/CodeGen/MachineFunction.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MachineLoopInfo_8h.html">llvm/CodeGen/MachineLoopInfo.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CodeGen_2Passes_8h.html">llvm/CodeGen/Passes.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Format_8h.html">llvm/Support/Format.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keywordtype">char</span> <a class="code" href="classllvm_1_1SpillPlacement.html#aa34d3acfa03ca143b486fc4fd7604e76">SpillPlacement::ID</a> = 0;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<a class="code" href="SpillPlacement_8cpp.html#a9dc104a8d7f5c660db8fa0663ab7370c">INITIALIZE_PASS_BEGIN</a>(<a class="code" href="classllvm_1_1SpillPlacement.html">SpillPlacement</a>, <span class="stringliteral">&quot;spill-code-placement&quot;</span>,</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                      <span class="stringliteral">&quot;Spill Code Placement Analysis&quot;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>)</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<a class="code" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1EdgeBundles.html">EdgeBundles</a>)</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<a class="code" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1MachineLoopInfo.html">MachineLoopInfo</a>)</div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="SpillPlacement_8cpp.html#a2d6267cf7f5c0f19c63fb6e8d6be76b5">   49</a></span>&#160;<a class="code" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(<a class="code" href="classllvm_1_1SpillPlacement.html">SpillPlacement</a>, &quot;<a class="code" href="README-SSE_8txt.html#a7246178f42b1eaef4e9bba10a9f39323">spill</a>-<a class="code" href="README-Thumb_8txt.html#a5d98a8b5139e56ebf0d2ff4cbaa0dc5e">code</a>-<a class="code" href="SpillPlacement_8cpp.html#a6e1dbdf6b8d5e2d870e4a8d792f72299">placement</a>&quot;,</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                    &quot;Spill <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a4a6621856674f376740a1ba6efd809e3">Code</a> <a class="code" href="MachineBlockPlacement_8cpp.html#a80e0b1823bee9dff0d9cbc44bc76b701">Placement</a> <a class="code" href="SpillPlacement_8cpp.html#a93bcb766c9f83218cdbe371041d3d685">Analysis</a>&quot;, <a class="code" href="namespacetrue.html">true</a>, true)</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="namespacellvm.html#a373fdd0d6019e8e7de44c481bec8099f">   52</a></span>&#160;<span class="keywordtype">char</span> &amp;<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="namespacellvm.html#a373fdd0d6019e8e7de44c481bec8099f">SpillPlacementID</a> = SpillPlacement::<a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a>;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keywordtype">void</span> SpillPlacement::getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const </span>{</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  AU.setPreservesAll();</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  AU.addRequired&lt;<a class="code" href="classllvm_1_1MachineBlockFrequencyInfo.html">MachineBlockFrequencyInfo</a>&gt;();</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  AU.addRequiredTransitive&lt;<a class="code" href="classllvm_1_1EdgeBundles.html">EdgeBundles</a>&gt;();</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  AU.addRequiredTransitive&lt;<a class="code" href="classllvm_1_1MachineLoopInfo.html">MachineLoopInfo</a>&gt;();</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <a class="code" href="classllvm_1_1MachineFunctionPass.html#aa1eece37d175f86a6f4808c0c167f13b">MachineFunctionPass::getAnalysisUsage</a>(AU);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;}</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">/// Decision threshold. A node gets the output value 0 if the weighted sum of</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">/// its inputs falls in the open interval (-Threshold;Threshold).</span></div><div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="SpillPlacement_8cpp.html#a52be80b365d5f14d9c6485c978447c75">   64</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> <a class="code" href="SpillPlacement_8cpp.html#a52be80b365d5f14d9c6485c978447c75">Threshold</a> = 2;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">/// Node - Each edge bundle corresponds to a Hopfield node.</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">/// The node contains precomputed frequency data that only depends on the CFG,</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">/// but Bias and Links are computed each time placeSpills is called.</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">/// The node Value is positive when the variable should be in a register. The</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">/// value can change when linked nodes change, but convergence is very fast</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">/// because all weights are positive.</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="structSpillPlacement_1_1Node.html">   75</a></span>&#160;<span class="comment"></span><span class="keyword">struct </span><a class="code" href="structSpillPlacement_1_1Node.html">SpillPlacement::Node</a> {<span class="comment"></span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">  /// BiasN - Sum of blocks that prefer a spill.</span></div><div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="structSpillPlacement_1_1Node.html#a370ae71068f6725ac2c6b61cf66a05b4">   77</a></span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> <a class="code" href="structSpillPlacement_1_1Node.html#a370ae71068f6725ac2c6b61cf66a05b4">BiasN</a>;<span class="comment"></span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">  /// BiasP - Sum of blocks that prefer a register.</span></div><div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="structSpillPlacement_1_1Node.html#a67abf92d6eabc03f37e9a2bd422e290a">   79</a></span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> <a class="code" href="structSpillPlacement_1_1Node.html#a67abf92d6eabc03f37e9a2bd422e290a">BiasP</a>;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">  /// Value - Output value of this node computed from the Bias and links.</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">  /// This is always on of the values {-1, 0, 1}. A positive number means the</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">  /// variable should go in a register through this bundle.</span></div><div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="structSpillPlacement_1_1Node.html#a6155db02c64ef3abd03259a7dba04ea9">   84</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">int</span> <a class="code" href="structSpillPlacement_1_1Node.html#a6155db02c64ef3abd03259a7dba04ea9">Value</a>;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="structSpillPlacement_1_1Node.html#ae1178af760123ac5eba5bc01dacff54d">   86</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;BlockFrequency, unsigned&gt;</a>, 4&gt; <a class="code" href="structSpillPlacement_1_1Node.html#ae1178af760123ac5eba5bc01dacff54d">LinkVector</a>;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">  /// Links - (Weight, BundleNo) for all transparent blocks connecting to other</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">  /// bundles. The weights are all positive block frequencies.</span></div><div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="structSpillPlacement_1_1Node.html#a5a13362b22c15eb1235eacd5f8440ed4">   90</a></span>&#160;<span class="comment"></span>  LinkVector <a class="code" href="structSpillPlacement_1_1Node.html#a5a13362b22c15eb1235eacd5f8440ed4">Links</a>;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">  /// SumLinkWeights - Cached sum of the weights of all links + ThresHold.</span></div><div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="structSpillPlacement_1_1Node.html#a2b91674cb12c7e0eb5bddcd71213e4c6">   93</a></span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> <a class="code" href="structSpillPlacement_1_1Node.html#a2b91674cb12c7e0eb5bddcd71213e4c6">SumLinkWeights</a>;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">  /// preferReg - Return true when this node prefers to be in a register.</span></div><div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="structSpillPlacement_1_1Node.html#a66f813f27246b0ab617f707dd9a41bd5">   96</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="structSpillPlacement_1_1Node.html#a66f813f27246b0ab617f707dd9a41bd5">preferReg</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">// Undecided nodes (Value==0) go on the stack.</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">return</span> Value &gt; 0;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  }</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">  /// mustSpill - Return True if this node is so biased that it must spill.</span></div><div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="structSpillPlacement_1_1Node.html#a3e39fad04d92615f6ff0e6b4cbd9e0e8">  102</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="structSpillPlacement_1_1Node.html#a3e39fad04d92615f6ff0e6b4cbd9e0e8">mustSpill</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// We must spill if Bias &lt; -sum(weights) or the MustSpill flag was set.</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">// BiasN is saturated when MustSpill is set, make sure this still returns</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">// true when the RHS saturates. Note that SumLinkWeights includes Threshold.</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">return</span> BiasN &gt;= BiasP + <a class="code" href="structSpillPlacement_1_1Node.html#a2b91674cb12c7e0eb5bddcd71213e4c6">SumLinkWeights</a>;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">  /// clear - Reset per-query data, but preserve frequencies that only depend on</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"></span>  <span class="comment">// the CFG.</span></div><div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="structSpillPlacement_1_1Node.html#ad795c84b06a3426ff2df7c12485ddbe1">  111</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structSpillPlacement_1_1Node.html#ad795c84b06a3426ff2df7c12485ddbe1">clear</a>() {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    BiasN = BiasP = Value = 0;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    SumLinkWeights = <a class="code" href="SpillPlacement_8cpp.html#a52be80b365d5f14d9c6485c978447c75">Threshold</a>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    Links.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">  /// addLink - Add a link to bundle b with weight w.</span></div><div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="structSpillPlacement_1_1Node.html#a414c03213909b5fd790e6f1b505b7099">  118</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="structSpillPlacement_1_1Node.html#a414c03213909b5fd790e6f1b505b7099">addLink</a>(<span class="keywordtype">unsigned</span> <a class="code" href="Target_2ARM_2README_8txt.html#acdf5bf3bbc10f9331f56441a4d483bb1">b</a>, <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> w) {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">// Update cached sum.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    SumLinkWeights += w;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">// There can be multiple links to the same bundle, add them up.</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classT.html">LinkVector::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Links.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), E = Links.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second == b) {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first += w;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">// This must be the first link to b.</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    Links.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(w, b));</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  }</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">  /// addBias - Bias this node.</span></div><div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="structSpillPlacement_1_1Node.html#a03bf04c760f4e0dc8f8673a6dbbc1f37">  133</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="structSpillPlacement_1_1Node.html#a03bf04c760f4e0dc8f8673a6dbbc1f37">addBias</a>(<a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> <a class="code" href="BlockFrequencyInfo_8cpp.html#a6228da6ce1f2cdae97b17637c061011e">freq</a>, <a class="code" href="classllvm_1_1SpillPlacement.html#ab09623fee8a653165a7cc624b8eaaa8c">BorderConstraint</a> direction) {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">switch</span> (direction) {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1SpillPlacement.html#ab09623fee8a653165a7cc624b8eaaa8caca6da2dad218232636b80854d81a6e1c">PrefReg</a>:</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      BiasP += <a class="code" href="BlockFrequencyInfo_8cpp.html#a6228da6ce1f2cdae97b17637c061011e">freq</a>;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1SpillPlacement.html#ab09623fee8a653165a7cc624b8eaaa8caf5efe10871d66719c8668d09d768e740">PrefSpill</a>:</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      BiasN += <a class="code" href="BlockFrequencyInfo_8cpp.html#a6228da6ce1f2cdae97b17637c061011e">freq</a>;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1SpillPlacement.html#ab09623fee8a653165a7cc624b8eaaa8ca043a091e52f465df92623f5f17477837">MustSpill</a>:</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      BiasN = <a class="code" href="classllvm_1_1BlockFrequency.html#abfa4567a98b37bee439fc06ba54042b2">BlockFrequency::getMaxFrequency</a>();</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">  /// update - Recompute Value from Bias and Links. Return true when node</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">  /// preference changes.</span></div><div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="structSpillPlacement_1_1Node.html#aae56200b2eb032c0de30d580fe9c2fe2">  151</a></span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="structSpillPlacement_1_1Node.html#aae56200b2eb032c0de30d580fe9c2fe2">update</a>(<span class="keyword">const</span> <a class="code" href="structSpillPlacement_1_1Node.html">Node</a> nodes[]) {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// Compute the weighted sum of inputs.</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> SumN = <a class="code" href="structSpillPlacement_1_1Node.html#a370ae71068f6725ac2c6b61cf66a05b4">BiasN</a>;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> SumP = <a class="code" href="structSpillPlacement_1_1Node.html#a67abf92d6eabc03f37e9a2bd422e290a">BiasP</a>;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classT.html">LinkVector::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Links.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), E = Links.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="keywordflow">if</span> (nodes[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second].<a class="code" href="structSpillPlacement_1_1Node.html#a6155db02c64ef3abd03259a7dba04ea9">Value</a> == -1)</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        SumN += <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nodes[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second].<a class="code" href="structSpillPlacement_1_1Node.html#a6155db02c64ef3abd03259a7dba04ea9">Value</a> == 1)</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        SumP += <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">// Each weighted sum is going to be less than the total frequency of the</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// bundle. Ideally, we should simply set Value = sign(SumP - SumN), but we</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">// will add a dead zone around 0 for two reasons:</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">//  1. It avoids arbitrary bias when all links are 0 as is possible during</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">//     initial iterations.</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">//  2. It helps tame rounding errors when the links nominally sum to 0.</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordtype">bool</span> Before = <a class="code" href="structSpillPlacement_1_1Node.html#a66f813f27246b0ab617f707dd9a41bd5">preferReg</a>();</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">if</span> (SumN &gt;= SumP + Threshold)</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      Value = -1;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SumP &gt;= SumN + Threshold)</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      Value = 1;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      Value = 0;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">return</span> Before != <a class="code" href="structSpillPlacement_1_1Node.html#a66f813f27246b0ab617f707dd9a41bd5">preferReg</a>();</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;};</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="keywordtype">bool</span> SpillPlacement::runOnMachineFunction(<a class="code" href="classllvm_1_1MachineFunction.html">MachineFunction</a> &amp;mf) {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  MF = &amp;mf;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  bundles = &amp;getAnalysis&lt;EdgeBundles&gt;();</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <a class="code" href="MachineLoopInfo_8cpp.html#a59aa69fa39ee55438427bfc39852b9e6">loops</a> = &amp;getAnalysis&lt;MachineLoopInfo&gt;();</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  assert(!nodes &amp;&amp; <span class="stringliteral">&quot;Leaking node array&quot;</span>);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  nodes = <span class="keyword">new</span> <a class="code" href="structSpillPlacement_1_1Node.html">Node</a>[bundles-&gt;getNumBundles()];</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="comment">// Compute total ingoing and outgoing block frequencies for all bundles.</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  BlockFrequencies.resize(mf.<a class="code" href="classllvm_1_1MachineFunction.html#aef96789028634643aa76d32d0d2ac6c4">getNumBlockIDs</a>());</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <a class="code" href="classllvm_1_1MachineBlockFrequencyInfo.html">MachineBlockFrequencyInfo</a> &amp;MBFI = getAnalysis&lt;MachineBlockFrequencyInfo&gt;();</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">MachineFunction::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = mf.<a class="code" href="classllvm_1_1MachineFunction.html#ab0789854909cf47f640a85fa2bac29c7">begin</a>(), E = mf.<a class="code" href="classllvm_1_1MachineFunction.html#a9d017af749f76484cb9aec9ff6e4330c">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordtype">unsigned</span> Num = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNumber();</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    BlockFrequencies[Num] = MBFI.<a class="code" href="classllvm_1_1MachineBlockFrequencyInfo.html#acc5325cdcfb5ee2601e17646fac5b66c">getBlockFreq</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="comment">// We never change the function.</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="keywordtype">void</span> SpillPlacement::releaseMemory() {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keyword">delete</span>[] nodes;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  nodes = 0;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;}</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">/// activate - mark node n as active if it wasn&#39;t already.</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> SpillPlacement::activate(<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordflow">if</span> (ActiveNodes-&gt;test(n))</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  ActiveNodes-&gt;set(n);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  nodes[<a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>].clear();</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="comment">// Very large bundles usually come from big switches, indirect branches,</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="comment">// landing pads, or loops with many &#39;continue&#39; statements. It is difficult to</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="comment">// allocate registers when so many different blocks are involved.</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="comment">// Give a small negative bias to large bundles such that a substantial</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">// fraction of the connected blocks need to be interested before we consider</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="comment">// expanding the region through the bundle. This helps compile time by</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="comment">// limiting the number of blocks visited and the number of links in the</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="comment">// Hopfield network.</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">if</span> (bundles-&gt;getBlocks(n).size() &gt; 100) {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    nodes[<a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>].BiasP = 0;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    nodes[<a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>].BiasN = (<a class="code" href="classllvm_1_1BlockFrequency.html#a8e478a163436e8244ae136bef45a4fcf">BlockFrequency::getEntryFrequency</a>() / 16);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">/// addConstraints - Compute node biases and weights from a set of constraints.</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">/// Set a bit in NodeMask for each active node.</span></div><div class="line"><a name="l00231"></a><span class="lineno"><a class="line" href="classllvm_1_1SpillPlacement.html#a0d46b9b2cb2caf78e65bbd56644fc0f2">  231</a></span>&#160;<span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classllvm_1_1SpillPlacement.html#a0d46b9b2cb2caf78e65bbd56644fc0f2">SpillPlacement::addConstraints</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;BlockConstraint&gt;</a> LiveBlocks) {</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Attribute.html">ArrayRef&lt;BlockConstraint&gt;::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = LiveBlocks.<a class="code" href="classllvm_1_1ArrayRef.html#a836367b39ed630bf14db99923c22740e">begin</a>(),</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;       E = LiveBlocks.<a class="code" href="classllvm_1_1ArrayRef.html#a38ed8cc3c342ad6910e8c869d3e2b9cf">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> Freq = BlockFrequencies[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;Number];</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// Live-in to block?</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;Entry != <a class="code" href="classllvm_1_1SpillPlacement.html#ab09623fee8a653165a7cc624b8eaaa8ca49b6f21cf41c5b608cb5645bc70d36b8">DontCare</a>) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1ARM__AM.html#a37ea08d6fc20eb1ef1bfb3ad008261a5a142f78f7efc65a4326e455faf26fd4cc">ib</a> = bundles-&gt;getBundle(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;Number, 0);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      activate(ib);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      nodes[<a class="code" href="namespacellvm_1_1ARM__AM.html#a37ea08d6fc20eb1ef1bfb3ad008261a5a142f78f7efc65a4326e455faf26fd4cc">ib</a>].addBias(Freq, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;Entry);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">// Live-out from block?</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;Exit != <a class="code" href="classllvm_1_1SpillPlacement.html#ab09623fee8a653165a7cc624b8eaaa8ca49b6f21cf41c5b608cb5645bc70d36b8">DontCare</a>) {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordtype">unsigned</span> ob = bundles-&gt;getBundle(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;Number, 1);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      activate(ob);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      nodes[ob].addBias(Freq, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;Exit);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  }</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;}</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">/// addPrefSpill - Same as addConstraints(PrefSpill)</span></div><div class="line"><a name="l00253"></a><span class="lineno"><a class="line" href="classllvm_1_1SpillPlacement.html#a2bd552babf3d34952ed159b653515b5e">  253</a></span>&#160;<span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classllvm_1_1SpillPlacement.html#a2bd552babf3d34952ed159b653515b5e">SpillPlacement::addPrefSpill</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;unsigned&gt;</a> Blocks, <span class="keywordtype">bool</span> Strong) {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Attribute.html">ArrayRef&lt;unsigned&gt;::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Blocks.<a class="code" href="classllvm_1_1ArrayRef.html#a836367b39ed630bf14db99923c22740e">begin</a>(), E = Blocks.<a class="code" href="classllvm_1_1ArrayRef.html#a38ed8cc3c342ad6910e8c869d3e2b9cf">end</a>();</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> Freq = BlockFrequencies[*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>];</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">if</span> (Strong)</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      Freq += Freq;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1ARM__AM.html#a37ea08d6fc20eb1ef1bfb3ad008261a5a142f78f7efc65a4326e455faf26fd4cc">ib</a> = bundles-&gt;getBundle(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, 0);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordtype">unsigned</span> ob = bundles-&gt;getBundle(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, 1);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    activate(ib);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    activate(ob);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    nodes[<a class="code" href="namespacellvm_1_1ARM__AM.html#a37ea08d6fc20eb1ef1bfb3ad008261a5a142f78f7efc65a4326e455faf26fd4cc">ib</a>].addBias(Freq, <a class="code" href="classllvm_1_1SpillPlacement.html#ab09623fee8a653165a7cc624b8eaaa8caf5efe10871d66719c8668d09d768e740">PrefSpill</a>);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    nodes[ob].addBias(Freq, <a class="code" href="classllvm_1_1SpillPlacement.html#ab09623fee8a653165a7cc624b8eaaa8caf5efe10871d66719c8668d09d768e740">PrefSpill</a>);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  }</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;}</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno"><a class="line" href="classllvm_1_1SpillPlacement.html#a80ed1a6b4e8e7a1eb342ac71a24e842b">  268</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classllvm_1_1SpillPlacement.html#a80ed1a6b4e8e7a1eb342ac71a24e842b">SpillPlacement::addLinks</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;unsigned&gt;</a> <a class="code" href="structSpillPlacement_1_1Node.html#a5a13362b22c15eb1235eacd5f8440ed4">Links</a>) {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Attribute.html">ArrayRef&lt;unsigned&gt;::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Links.<a class="code" href="classllvm_1_1ArrayRef.html#a836367b39ed630bf14db99923c22740e">begin</a>(), E = Links.<a class="code" href="classllvm_1_1ArrayRef.html#a38ed8cc3c342ad6910e8c869d3e2b9cf">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;       ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordtype">unsigned</span> Number = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1ARM__AM.html#a37ea08d6fc20eb1ef1bfb3ad008261a5a142f78f7efc65a4326e455faf26fd4cc">ib</a> = bundles-&gt;getBundle(Number, 0);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordtype">unsigned</span> ob = bundles-&gt;getBundle(Number, 1);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">// Ignore self-loops.</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> (ib == ob)</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    activate(ib);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    activate(ob);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">if</span> (nodes[ib].Links.<a class="code" href="classllvm_1_1ArrayRef.html#a3aa55c9d9145cd6b3b21c466b18abd80">empty</a>() &amp;&amp; !nodes[<a class="code" href="namespacellvm_1_1ARM__AM.html#a37ea08d6fc20eb1ef1bfb3ad008261a5a142f78f7efc65a4326e455faf26fd4cc">ib</a>].mustSpill())</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      Linked.push_back(ib);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">if</span> (nodes[ob].Links.<a class="code" href="classllvm_1_1ArrayRef.html#a3aa55c9d9145cd6b3b21c466b18abd80">empty</a>() &amp;&amp; !nodes[ob].mustSpill())</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      Linked.push_back(ob);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <a class="code" href="classllvm_1_1BlockFrequency.html">BlockFrequency</a> Freq = BlockFrequencies[Number];</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    nodes[<a class="code" href="namespacellvm_1_1ARM__AM.html#a37ea08d6fc20eb1ef1bfb3ad008261a5a142f78f7efc65a4326e455faf26fd4cc">ib</a>].addLink(ob, Freq);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    nodes[ob].addLink(ib, Freq);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;}</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="classllvm_1_1SpillPlacement.html#a435b043e417bb3f4fc9ac0f6e0c6ebc8">  290</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classllvm_1_1SpillPlacement.html#a435b043e417bb3f4fc9ac0f6e0c6ebc8">SpillPlacement::scanActiveBundles</a>() {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  Linked.clear();</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  RecentPositive.clear();</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a> = ActiveNodes-&gt;find_first(); <a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>&gt;=0; <a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a> = ActiveNodes-&gt;find_next(<a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>)) {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    nodes[<a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>].update(nodes);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="comment">// A node that must spill, or a node without any links is not going to</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">// change its value ever again, so exclude it from iterations.</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">if</span> (nodes[<a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>].<a class="code" href="structSpillPlacement_1_1Node.html#a3e39fad04d92615f6ff0e6b4cbd9e0e8">mustSpill</a>())</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">if</span> (!nodes[<a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>].<a class="code" href="structSpillPlacement_1_1Node.html#a5a13362b22c15eb1235eacd5f8440ed4">Links</a>.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>())</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      Linked.push_back(<a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">if</span> (nodes[<a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>].<a class="code" href="structSpillPlacement_1_1Node.html#a66f813f27246b0ab617f707dd9a41bd5">preferReg</a>())</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      RecentPositive.push_back(<a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  }</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="keywordflow">return</span> !RecentPositive.empty();</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;}</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">/// iterate - Repeatedly update the Hopfield nodes until stability or the</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">/// maximum number of iterations is reached.</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">/// @param Linked - Numbers of linked nodes that need updating.</span></div><div class="line"><a name="l00310"></a><span class="lineno"><a class="line" href="classllvm_1_1SpillPlacement.html#a8d70270c78d36ddb40a8b782e141b63a">  310</a></span>&#160;<span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classllvm_1_1SpillPlacement.html#a8d70270c78d36ddb40a8b782e141b63a">SpillPlacement::iterate</a>() {</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="comment">// First update the recently positive nodes. They have likely received new</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">// negative bias that will turn them off.</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordflow">while</span> (!RecentPositive.empty())</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    nodes[RecentPositive.pop_back_val()].update(nodes);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keywordflow">if</span> (Linked.empty())</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="comment">// Run up to 10 iterations. The edge bundle numbering is closely related to</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="comment">// basic block numbering, so there is a strong tendency towards chains of</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="comment">// linked nodes with sequential numbers. By scanning the linked nodes</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="comment">// backwards and forwards, we make it very likely that a single node can</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="comment">// affect the entire network in a single iteration. That means very fast</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="comment">// convergence, usually in a single iteration.</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> iteration = 0; iteration != 10; ++iteration) {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">// Scan backwards, skipping the last node which was just updated.</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;unsigned&gt;::const_reverse_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> =</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;           <a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(Linked.rbegin()), E = Linked.rend(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a> = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="keywordflow">if</span> (nodes[n].<a class="code" href="structSpillPlacement_1_1Node.html#aae56200b2eb032c0de30d580fe9c2fe2">update</a>(nodes)) {</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordflow">if</span> (nodes[n].<a class="code" href="structSpillPlacement_1_1Node.html#a66f813f27246b0ab617f707dd9a41bd5">preferReg</a>())</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;          RecentPositive.push_back(n);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordflow">if</span> (!Changed || !RecentPositive.empty())</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment">// Scan forwards, skipping the first node which was just updated.</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;unsigned&gt;::const_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> =</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;           <a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(Linked.begin()), E = Linked.end(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a> = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="keywordflow">if</span> (nodes[n].<a class="code" href="structSpillPlacement_1_1Node.html#aae56200b2eb032c0de30d580fe9c2fe2">update</a>(nodes)) {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">if</span> (nodes[n].<a class="code" href="structSpillPlacement_1_1Node.html#a66f813f27246b0ab617f707dd9a41bd5">preferReg</a>())</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;          RecentPositive.push_back(n);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      }</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    }</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">if</span> (!Changed || !RecentPositive.empty())</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  }</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;}</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno"><a class="line" href="classllvm_1_1SpillPlacement.html#a329177b9cd260516a4aca8f55c199020">  356</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classllvm_1_1SpillPlacement.html#a329177b9cd260516a4aca8f55c199020">SpillPlacement::prepare</a>(<a class="code" href="classllvm_1_1BitVector.html">BitVector</a> &amp;RegBundles) {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  Linked.clear();</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  RecentPositive.clear();</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="comment">// Reuse RegBundles as our ActiveNodes vector.</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  ActiveNodes = &amp;RegBundles;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  ActiveNodes-&gt;<a class="code" href="classllvm_1_1BitVector.html#a35bbc237e4a675c5332103ac6e7dcce1">clear</a>();</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  ActiveNodes-&gt;resize(bundles-&gt;getNumBundles());</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;}</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00366"></a><span class="lineno"><a class="line" href="classllvm_1_1SpillPlacement.html#a2310373a95001e3677c0f0534cdfc0e1">  366</a></span>&#160;<a class="code" href="classllvm_1_1SpillPlacement.html#a2310373a95001e3677c0f0534cdfc0e1">SpillPlacement::finish</a>() {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  assert(ActiveNodes &amp;&amp; <span class="stringliteral">&quot;Call prepare() first&quot;</span>);</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="comment">// Write preferences back to ActiveNodes.</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordtype">bool</span> Perfect = <span class="keyword">true</span>;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a> = ActiveNodes-&gt;find_first(); <a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>&gt;=0; <a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a> = ActiveNodes-&gt;find_next(<a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>))</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">if</span> (!nodes[<a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>].<a class="code" href="structSpillPlacement_1_1Node.html#a66f813f27246b0ab617f707dd9a41bd5">preferReg</a>()) {</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      ActiveNodes-&gt;reset(<a class="code" href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a>);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      Perfect = <span class="keyword">false</span>;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  ActiveNodes = 0;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordflow">return</span> Perfect;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;}</div><div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a075e34e98605d0e7c289763a104869ac"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">llvm::SmallVectorTemplateCommon::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00114">SmallVector.h:114</a></div></div>
<div class="ttc" id="structSpillPlacement_1_1Node_html_a6155db02c64ef3abd03259a7dba04ea9"><div class="ttname"><a href="structSpillPlacement_1_1Node.html#a6155db02c64ef3abd03259a7dba04ea9">llvm::SpillPlacement::Node::Value</a></div><div class="ttdeci">int Value</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00084">SpillPlacement.cpp:84</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_ae1a10b90f22c0478960fb5798ff73916"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">llvm::SmallVectorTemplateBase::push_back</a></div><div class="ttdeci">void push_back(const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00236">SmallVector.h:236</a></div></div>
<div class="ttc" id="SpillPlacement_8cpp_html_a9dc104a8d7f5c660db8fa0663ab7370c"><div class="ttname"><a href="SpillPlacement_8cpp.html#a9dc104a8d7f5c660db8fa0663ab7370c">INITIALIZE_PASS_BEGIN</a></div><div class="ttdeci">INITIALIZE_PASS_BEGIN(SpillPlacement,&quot;spill-code-placement&quot;,&quot;Spill Code Placement Analysis&quot;, true, true) INITIALIZE_PASS_END(SpillPlacement</div></div>
<div class="ttc" id="namespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">List of target independent CodeGen pass IDs. </div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l00022">APFloat.h:22</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_a9d017af749f76484cb9aec9ff6e4330c"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#a9d017af749f76484cb9aec9ff6e4330c">llvm::MachineFunction::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00317">MachineFunction.h:317</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html"><div class="ttname"><a href="classllvm_1_1MachineFunction.html">llvm::MachineFunction</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00075">MachineFunction.h:75</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_ab0789854909cf47f640a85fa2bac29c7"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#ab0789854909cf47f640a85fa2bac29c7">llvm::MachineFunction::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00315">MachineFunction.h:315</a></div></div>
<div class="ttc" id="classllvm_1_1SpillPlacement_html_ab09623fee8a653165a7cc624b8eaaa8ca043a091e52f465df92623f5f17477837"><div class="ttname"><a href="classllvm_1_1SpillPlacement.html#ab09623fee8a653165a7cc624b8eaaa8ca043a091e52f465df92623f5f17477837">llvm::SpillPlacement::MustSpill</a></div><div class="ttdoc">A register is impossible, variable must be spilled. </div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8h_source.html#l00076">SpillPlacement.h:76</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayRef_html_a38ed8cc3c342ad6910e8c869d3e2b9cf"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a38ed8cc3c342ad6910e8c869d3e2b9cf">llvm::ArrayRef::end</a></div><div class="ttdeci">iterator end() const </div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00098">ArrayRef.h:98</a></div></div>
<div class="ttc" id="Debug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBlockFrequencyInfo_html"><div class="ttname"><a href="classllvm_1_1MachineBlockFrequencyInfo.html">llvm::MachineBlockFrequencyInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineBlockFrequencyInfo_8h_source.html#l00030">MachineBlockFrequencyInfo.h:30</a></div></div>
<div class="ttc" id="structSpillPlacement_1_1Node_html_a67abf92d6eabc03f37e9a2bd422e290a"><div class="ttname"><a href="structSpillPlacement_1_1Node.html#a67abf92d6eabc03f37e9a2bd422e290a">llvm::SpillPlacement::Node::BiasP</a></div><div class="ttdeci">BlockFrequency BiasP</div><div class="ttdoc">BiasP - Sum of blocks that prefer a register. </div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00079">SpillPlacement.cpp:79</a></div></div>
<div class="ttc" id="classllvm_1_1BlockFrequency_html_a8e478a163436e8244ae136bef45a4fcf"><div class="ttname"><a href="classllvm_1_1BlockFrequency.html#a8e478a163436e8244ae136bef45a4fcf">llvm::BlockFrequency::getEntryFrequency</a></div><div class="ttdeci">static uint64_t getEntryFrequency()</div><div class="ttdoc">Returns the frequency of the entry block of the function. </div><div class="ttdef"><b>Definition:</b> <a href="BlockFrequency_8h_source.html#l00039">BlockFrequency.h:39</a></div></div>
<div class="ttc" id="SpillPlacement_8h_html"><div class="ttname"><a href="SpillPlacement_8h.html">SpillPlacement.h</a></div></div>
<div class="ttc" id="classllvm_1_1MachineBlockFrequencyInfo_html_acc5325cdcfb5ee2601e17646fac5b66c"><div class="ttname"><a href="classllvm_1_1MachineBlockFrequencyInfo.html#acc5325cdcfb5ee2601e17646fac5b66c">llvm::MachineBlockFrequencyInfo::getBlockFreq</a></div><div class="ttdeci">BlockFrequency getBlockFreq(const MachineBasicBlock *MBB) const </div><div class="ttdef"><b>Definition:</b> <a href="MachineBlockFrequencyInfo_8cpp_source.html#l00054">MachineBlockFrequencyInfo.cpp:54</a></div></div>
<div class="ttc" id="Target_2ARM_2README_8txt_html_acdf5bf3bbc10f9331f56441a4d483bb1"><div class="ttname"><a href="Target_2ARM_2README_8txt.html#acdf5bf3bbc10f9331f56441a4d483bb1">b</a></div><div class="ttdeci">the resulting code requires compare and branches when and if the revised code is with conditional branches instead of More there is a byte word extend before each where there should be only and the condition codes are not remembered when the same two values are compared twice More LSR enhancements i8 and i32 load store addressing modes are identical int b</div><div class="ttdef"><b>Definition:</b> <a href="Target_2ARM_2README_8txt_source.html#l00396">Target/ARM/README.txt:396</a></div></div>
<div class="ttc" id="PassSupport_8h_html_a14724f1ccf528e73bb29bc9230737967"><div class="ttname"><a href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a></div><div class="ttdeci">#define INITIALIZE_PASS_DEPENDENCY(depName)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00167">PassSupport.h:167</a></div></div>
<div class="ttc" id="MachineFunction_8h_html"><div class="ttname"><a href="MachineFunction_8h.html">MachineFunction.h</a></div></div>
<div class="ttc" id="classllvm_1_1BitVector_html_a35bbc237e4a675c5332103ac6e7dcce1"><div class="ttname"><a href="classllvm_1_1BitVector.html#a35bbc237e4a675c5332103ac6e7dcce1">llvm::BitVector::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdoc">clear - Clear all bits. </div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00205">BitVector.h:205</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_aef96789028634643aa76d32d0d2ac6c4"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#aef96789028634643aa76d32d0d2ac6c4">llvm::MachineFunction::getNumBlockIDs</a></div><div class="ttdeci">unsigned getNumBlockIDs() const </div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00265">MachineFunction.h:265</a></div></div>
<div class="ttc" id="classllvm_1_1SpillPlacement_html_a2bd552babf3d34952ed159b653515b5e"><div class="ttname"><a href="classllvm_1_1SpillPlacement.html#a2bd552babf3d34952ed159b653515b5e">llvm::SpillPlacement::addPrefSpill</a></div><div class="ttdeci">void addPrefSpill(ArrayRef&lt; unsigned &gt; Blocks, bool Strong)</div><div class="ttdoc">addPrefSpill - Same as addConstraints(PrefSpill) </div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00253">SpillPlacement.cpp:253</a></div></div>
<div class="ttc" id="classllvm_1_1SpillPlacement_html_a435b043e417bb3f4fc9ac0f6e0c6ebc8"><div class="ttname"><a href="classllvm_1_1SpillPlacement.html#a435b043e417bb3f4fc9ac0f6e0c6ebc8">llvm::SpillPlacement::scanActiveBundles</a></div><div class="ttdeci">bool scanActiveBundles()</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00290">SpillPlacement.cpp:290</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00035">APInt.h:35</a></div></div>
<div class="ttc" id="PassSupport_8h_html_a74ce8276b89067e806f67c45a6d92575"><div class="ttname"><a href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a></div><div class="ttdeci">#define INITIALIZE_PASS_END(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00172">PassSupport.h:172</a></div></div>
<div class="ttc" id="MachineBasicBlock_8h_html"><div class="ttname"><a href="MachineBasicBlock_8h.html">MachineBasicBlock.h</a></div></div>
<div class="ttc" id="BitVector_8h_html"><div class="ttname"><a href="BitVector_8h.html">BitVector.h</a></div></div>
<div class="ttc" id="structSpillPlacement_1_1Node_html_a5a13362b22c15eb1235eacd5f8440ed4"><div class="ttname"><a href="structSpillPlacement_1_1Node.html#a5a13362b22c15eb1235eacd5f8440ed4">llvm::SpillPlacement::Node::Links</a></div><div class="ttdeci">LinkVector Links</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00090">SpillPlacement.cpp:90</a></div></div>
<div class="ttc" id="classllvm_1_1SpillPlacement_html_a8d70270c78d36ddb40a8b782e141b63a"><div class="ttname"><a href="classllvm_1_1SpillPlacement.html#a8d70270c78d36ddb40a8b782e141b63a">llvm::SpillPlacement::iterate</a></div><div class="ttdeci">void iterate()</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00310">SpillPlacement.cpp:310</a></div></div>
<div class="ttc" id="namespacellvm_1_1CallingConv_html_a4f861731fc6dbfdccc05af5968d98974"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">llvm::CallingConv::ID</a></div><div class="ttdeci">ID</div><div class="ttdoc">LLVM Calling Convention Representation. </div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00026">CallingConv.h:26</a></div></div>
<div class="ttc" id="classllvm_1_1EdgeBundles_html"><div class="ttname"><a href="classllvm_1_1EdgeBundles.html">llvm::EdgeBundles</a></div><div class="ttdef"><b>Definition:</b> <a href="EdgeBundles_8h_source.html#l00026">EdgeBundles.h:26</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorBase_html_a8a8df4d85555c7954a95f86080cd3b64"><div class="ttname"><a href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">llvm::SmallVectorBase::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00056">SmallVector.h:56</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayRef_html"><div class="ttname"><a href="classllvm_1_1ArrayRef.html">llvm::ArrayRef</a></div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00031">ArrayRef.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1BitVector_html"><div class="ttname"><a href="classllvm_1_1BitVector.html">llvm::BitVector</a></div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00027">BitVector.h:27</a></div></div>
<div class="ttc" id="structSpillPlacement_1_1Node_html_a2b91674cb12c7e0eb5bddcd71213e4c6"><div class="ttname"><a href="structSpillPlacement_1_1Node.html#a2b91674cb12c7e0eb5bddcd71213e4c6">llvm::SpillPlacement::Node::SumLinkWeights</a></div><div class="ttdeci">BlockFrequency SumLinkWeights</div><div class="ttdoc">SumLinkWeights - Cached sum of the weights of all links + ThresHold. </div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00093">SpillPlacement.cpp:93</a></div></div>
<div class="ttc" id="structSpillPlacement_1_1Node_html_a03bf04c760f4e0dc8f8673a6dbbc1f37"><div class="ttname"><a href="structSpillPlacement_1_1Node.html#a03bf04c760f4e0dc8f8673a6dbbc1f37">llvm::SpillPlacement::Node::addBias</a></div><div class="ttdeci">void addBias(BlockFrequency freq, BorderConstraint direction)</div><div class="ttdoc">addBias - Bias this node. </div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00133">SpillPlacement.cpp:133</a></div></div>
<div class="ttc" id="classllvm_1_1SpillPlacement_html_a80ed1a6b4e8e7a1eb342ac71a24e842b"><div class="ttname"><a href="classllvm_1_1SpillPlacement.html#a80ed1a6b4e8e7a1eb342ac71a24e842b">llvm::SpillPlacement::addLinks</a></div><div class="ttdeci">void addLinks(ArrayRef&lt; unsigned &gt; Links)</div><div class="ttdoc">addLinks - Add transparent blocks with the given numbers. </div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00268">SpillPlacement.cpp:268</a></div></div>
<div class="ttc" id="MachineBlockFrequencyInfo_8h_html"><div class="ttname"><a href="MachineBlockFrequencyInfo_8h.html">MachineBlockFrequencyInfo.h</a></div></div>
<div class="ttc" id="classllvm_1_1SpillPlacement_html_ab09623fee8a653165a7cc624b8eaaa8ca49b6f21cf41c5b608cb5645bc70d36b8"><div class="ttname"><a href="classllvm_1_1SpillPlacement.html#ab09623fee8a653165a7cc624b8eaaa8ca49b6f21cf41c5b608cb5645bc70d36b8">llvm::SpillPlacement::DontCare</a></div><div class="ttdoc">Block doesn&amp;#39;t care / variable not live. </div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8h_source.html#l00072">SpillPlacement.h:72</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_aac0ea55010b7b1a301e65a0baea057aa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">llvm::SmallVectorImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00396">SmallVector.h:396</a></div></div>
<div class="ttc" id="BlockFrequencyInfo_8cpp_html_a6228da6ce1f2cdae97b17637c061011e"><div class="ttname"><a href="BlockFrequencyInfo_8cpp.html#a6228da6ce1f2cdae97b17637c061011e">freq</a></div><div class="ttdeci">block freq</div><div class="ttdef"><b>Definition:</b> <a href="BlockFrequencyInfo_8cpp_source.html#l00109">BlockFrequencyInfo.cpp:109</a></div></div>
<div class="ttc" id="SpillPlacement_8cpp_html_a93bcb766c9f83218cdbe371041d3d685"><div class="ttname"><a href="SpillPlacement_8cpp.html#a93bcb766c9f83218cdbe371041d3d685">Analysis</a></div><div class="ttdeci">spill code Spill Code Placement Analysis</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00049">SpillPlacement.cpp:49</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00037">PassAnalysisSupport.h:37</a></div></div>
<div class="ttc" id="namespacellvm_html_aa1704159f75e6eacd595962ea6d93ffe"><div class="ttname"><a href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a></div><div class="ttdeci">ItTy next(ItTy it, Dist n)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00154">STLExtras.h:154</a></div></div>
<div class="ttc" id="SpillPlacement_8cpp_html_a6e1dbdf6b8d5e2d870e4a8d792f72299"><div class="ttname"><a href="SpillPlacement_8cpp.html#a6e1dbdf6b8d5e2d870e4a8d792f72299">placement</a></div><div class="ttdeci">spill code placement</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00049">SpillPlacement.cpp:49</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayRef_html_a836367b39ed630bf14db99923c22740e"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a836367b39ed630bf14db99923c22740e">llvm::ArrayRef::begin</a></div><div class="ttdeci">iterator begin() const </div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00097">ArrayRef.h:97</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARM__AM_html_a37ea08d6fc20eb1ef1bfb3ad008261a5a142f78f7efc65a4326e455faf26fd4cc"><div class="ttname"><a href="namespacellvm_1_1ARM__AM.html#a37ea08d6fc20eb1ef1bfb3ad008261a5a142f78f7efc65a4326e455faf26fd4cc">llvm::ARM_AM::ib</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMAddressingModes_8h_source.html#l00069">ARMAddressingModes.h:69</a></div></div>
<div class="ttc" id="structSpillPlacement_1_1Node_html_ad795c84b06a3426ff2df7c12485ddbe1"><div class="ttname"><a href="structSpillPlacement_1_1Node.html#ad795c84b06a3426ff2df7c12485ddbe1">llvm::SpillPlacement::Node::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdoc">clear - Reset per-query data, but preserve frequencies that only depend on </div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00111">SpillPlacement.cpp:111</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayRef_html_a3aa55c9d9145cd6b3b21c466b18abd80"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a3aa55c9d9145cd6b3b21c466b18abd80">llvm::ArrayRef::empty</a></div><div class="ttdeci">bool empty() const </div><div class="ttdoc">empty - Check if the array is empty. </div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00104">ArrayRef.h:104</a></div></div>
<div class="ttc" id="classT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="EdgeBundles_8h_html"><div class="ttname"><a href="EdgeBundles_8h.html">EdgeBundles.h</a></div></div>
<div class="ttc" id="classllvm_1_1SpillPlacement_html_a2310373a95001e3677c0f0534cdfc0e1"><div class="ttname"><a href="classllvm_1_1SpillPlacement.html#a2310373a95001e3677c0f0534cdfc0e1">llvm::SpillPlacement::finish</a></div><div class="ttdeci">bool finish()</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00366">SpillPlacement.cpp:366</a></div></div>
<div class="ttc" id="classllvm_1_1SpillPlacement_html_ab09623fee8a653165a7cc624b8eaaa8caca6da2dad218232636b80854d81a6e1c"><div class="ttname"><a href="classllvm_1_1SpillPlacement.html#ab09623fee8a653165a7cc624b8eaaa8caca6da2dad218232636b80854d81a6e1c">llvm::SpillPlacement::PrefReg</a></div><div class="ttdoc">Block entry/exit prefers a register. </div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8h_source.html#l00073">SpillPlacement.h:73</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_ab335e668fd33542ea14a2c7b527e64d3"><div class="ttname"><a href="Target_2README_8txt.html#ab335e668fd33542ea14a2c7b527e64d3">n</a></div><div class="ttdeci">The same transformation can work with an even modulo with the addition of a and shrink the compare RHS by the same amount Unless the target supports that transformation probably isn t worthwhile The transformation can also easily be made to work with non zero equality for n</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00723">Target/README.txt:723</a></div></div>
<div class="ttc" id="classllvm_1_1SpillPlacement_html_a0d46b9b2cb2caf78e65bbd56644fc0f2"><div class="ttname"><a href="classllvm_1_1SpillPlacement.html#a0d46b9b2cb2caf78e65bbd56644fc0f2">llvm::SpillPlacement::addConstraints</a></div><div class="ttdeci">void addConstraints(ArrayRef&lt; BlockConstraint &gt; LiveBlocks)</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00231">SpillPlacement.cpp:231</a></div></div>
<div class="ttc" id="classllvm_1_1Attribute_html"><div class="ttname"><a href="classllvm_1_1Attribute.html">llvm::Attribute</a></div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l00045">Attributes.h:45</a></div></div>
<div class="ttc" id="Format_8h_html"><div class="ttname"><a href="Format_8h.html">Format.h</a></div></div>
<div class="ttc" id="classllvm_1_1SpillPlacement_html"><div class="ttname"><a href="classllvm_1_1SpillPlacement.html">llvm::SpillPlacement</a></div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8h_source.html#l00042">SpillPlacement.h:42</a></div></div>
<div class="ttc" id="MachineBlockPlacement_8cpp_html_a80e0b1823bee9dff0d9cbc44bc76b701"><div class="ttname"><a href="MachineBlockPlacement_8cpp.html#a80e0b1823bee9dff0d9cbc44bc76b701">Placement</a></div><div class="ttdeci">block Branch Probability Basic Block Placement</div><div class="ttdef"><b>Definition:</b> <a href="MachineBlockPlacement_8cpp_source.html#l00251">MachineBlockPlacement.cpp:251</a></div></div>
<div class="ttc" id="namespacellvm_1_1tgtok_html_abbc5259d649363016626e2529fabe0c5a4a6621856674f376740a1ba6efd809e3"><div class="ttname"><a href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a4a6621856674f376740a1ba6efd809e3">llvm::tgtok::Code</a></div><div class="ttdef"><b>Definition:</b> <a href="TGLexer_8h_source.html#l00046">TGLexer.h:46</a></div></div>
<div class="ttc" id="classllvm_1_1SpillPlacement_html_ab09623fee8a653165a7cc624b8eaaa8caf5efe10871d66719c8668d09d768e740"><div class="ttname"><a href="classllvm_1_1SpillPlacement.html#ab09623fee8a653165a7cc624b8eaaa8caf5efe10871d66719c8668d09d768e740">llvm::SpillPlacement::PrefSpill</a></div><div class="ttdoc">Block entry/exit prefers a stack slot. </div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8h_source.html#l00074">SpillPlacement.h:74</a></div></div>
<div class="ttc" id="README-Thumb_8txt_html_a5d98a8b5139e56ebf0d2ff4cbaa0dc5e"><div class="ttname"><a href="README-Thumb_8txt.html#a5d98a8b5139e56ebf0d2ff4cbaa0dc5e">code</a></div><div class="ttdeci">*Add support for compiling functions in both ARM and Thumb then taking the smallest *Add support for compiling individual basic blocks in thumb when in a larger ARM function This can be used for presumed cold code</div><div class="ttdef"><b>Definition:</b> <a href="README-Thumb_8txt_source.html#l00005">README-Thumb.txt:5</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00880">SmallVector.h:880</a></div></div>
<div class="ttc" id="classllvm_1_1SpillPlacement_html_a329177b9cd260516a4aca8f55c199020"><div class="ttname"><a href="classllvm_1_1SpillPlacement.html#a329177b9cd260516a4aca8f55c199020">llvm::SpillPlacement::prepare</a></div><div class="ttdeci">void prepare(BitVector &amp;RegBundles)</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00356">SpillPlacement.cpp:356</a></div></div>
<div class="ttc" id="MachineLoopInfo_8cpp_html_a59aa69fa39ee55438427bfc39852b9e6"><div class="ttname"><a href="MachineLoopInfo_8cpp.html#a59aa69fa39ee55438427bfc39852b9e6">loops</a></div><div class="ttdeci">machine loops</div><div class="ttdef"><b>Definition:</b> <a href="MachineLoopInfo_8cpp_source.html#l00032">MachineLoopInfo.cpp:32</a></div></div>
<div class="ttc" id="structSpillPlacement_1_1Node_html_a414c03213909b5fd790e6f1b505b7099"><div class="ttname"><a href="structSpillPlacement_1_1Node.html#a414c03213909b5fd790e6f1b505b7099">llvm::SpillPlacement::Node::addLink</a></div><div class="ttdeci">void addLink(unsigned b, BlockFrequency w)</div><div class="ttdoc">addLink - Add a link to bundle b with weight w. </div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00118">SpillPlacement.cpp:118</a></div></div>
<div class="ttc" id="structSpillPlacement_1_1Node_html_aae56200b2eb032c0de30d580fe9c2fe2"><div class="ttname"><a href="structSpillPlacement_1_1Node.html#aae56200b2eb032c0de30d580fe9c2fe2">llvm::SpillPlacement::Node::update</a></div><div class="ttdeci">bool update(const Node nodes[])</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00151">SpillPlacement.cpp:151</a></div></div>
<div class="ttc" id="structSpillPlacement_1_1Node_html"><div class="ttname"><a href="structSpillPlacement_1_1Node.html">llvm::SpillPlacement::Node</a></div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00075">SpillPlacement.cpp:75</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a8a045d250952c0867382a9840ee18fdf"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">llvm::SmallVectorTemplateCommon::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00112">SmallVector.h:112</a></div></div>
<div class="ttc" id="README-SSE_8txt_html_a7246178f42b1eaef4e9bba10a9f39323"><div class="ttname"><a href="README-SSE_8txt.html#a7246178f42b1eaef4e9bba10a9f39323">spill</a></div><div class="ttdeci">the custom lowered code happens to be but we shouldn t have to custom lower anything This is probably related to&lt; 2 x i64 &gt; ops being so bad LLVM currently generates stack realignment when it is not necessary needed The problem is that we need to know about stack alignment too before RA runs At that point we don t whether there will be vector spill</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00515">README-SSE.txt:515</a></div></div>
<div class="ttc" id="classllvm_1_1BlockFrequency_html_abfa4567a98b37bee439fc06ba54042b2"><div class="ttname"><a href="classllvm_1_1BlockFrequency.html#abfa4567a98b37bee439fc06ba54042b2">llvm::BlockFrequency::getMaxFrequency</a></div><div class="ttdeci">static uint64_t getMaxFrequency()</div><div class="ttdoc">Returns the maximum possible frequency, the saturation value. </div><div class="ttdef"><b>Definition:</b> <a href="BlockFrequency_8h_source.html#l00042">BlockFrequency.h:42</a></div></div>
<div class="ttc" id="classllvm_1_1SpillPlacement_html_ab09623fee8a653165a7cc624b8eaaa8c"><div class="ttname"><a href="classllvm_1_1SpillPlacement.html#ab09623fee8a653165a7cc624b8eaaa8c">llvm::SpillPlacement::BorderConstraint</a></div><div class="ttdeci">BorderConstraint</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8h_source.html#l00071">SpillPlacement.h:71</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunctionPass_html_aa1eece37d175f86a6f4808c0c167f13b"><div class="ttname"><a href="classllvm_1_1MachineFunctionPass.html#aa1eece37d175f86a6f4808c0c167f13b">llvm::MachineFunctionPass::getAnalysisUsage</a></div><div class="ttdeci">virtual void getAnalysisUsage(AnalysisUsage &amp;AU) const </div><div class="ttdef"><b>Definition:</b> <a href="MachineFunctionPass_8cpp_source.html#l00036">MachineFunctionPass.cpp:36</a></div></div>
<div class="ttc" id="MD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00054">MD5.cpp:54</a></div></div>
<div class="ttc" id="namespacellvm_html_a373fdd0d6019e8e7de44c481bec8099f"><div class="ttname"><a href="namespacellvm.html#a373fdd0d6019e8e7de44c481bec8099f">llvm::SpillPlacementID</a></div><div class="ttdeci">char &amp; SpillPlacementID</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00052">SpillPlacement.cpp:52</a></div></div>
<div class="ttc" id="structSpillPlacement_1_1Node_html_ae1178af760123ac5eba5bc01dacff54d"><div class="ttname"><a href="structSpillPlacement_1_1Node.html#ae1178af760123ac5eba5bc01dacff54d">llvm::SpillPlacement::Node::LinkVector</a></div><div class="ttdeci">SmallVector&lt; std::pair&lt; BlockFrequency, unsigned &gt;, 4 &gt; LinkVector</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00086">SpillPlacement.cpp:86</a></div></div>
<div class="ttc" id="namespacetrue_html"><div class="ttname"><a href="namespacetrue.html">true</a></div><div class="ttdef"><b>Definition:</b> <a href="DominanceFrontier_8cpp_source.html#l00024">DominanceFrontier.cpp:24</a></div></div>
<div class="ttc" id="classllvm_1_1MachineFunction_html_a340712de3e78fec11c338735cab17df7"><div class="ttname"><a href="classllvm_1_1MachineFunction.html#a340712de3e78fec11c338735cab17df7">llvm::MachineFunction::iterator</a></div><div class="ttdeci">BasicBlockListType::iterator iterator</div><div class="ttdef"><b>Definition:</b> <a href="MachineFunction_8h_source.html#l00303">MachineFunction.h:303</a></div></div>
<div class="ttc" id="structSpillPlacement_1_1Node_html_a3e39fad04d92615f6ff0e6b4cbd9e0e8"><div class="ttname"><a href="structSpillPlacement_1_1Node.html#a3e39fad04d92615f6ff0e6b4cbd9e0e8">llvm::SpillPlacement::Node::mustSpill</a></div><div class="ttdeci">bool mustSpill() const </div><div class="ttdoc">mustSpill - Return True if this node is so biased that it must spill. </div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00102">SpillPlacement.cpp:102</a></div></div>
<div class="ttc" id="classllvm_1_1BlockFrequency_html"><div class="ttname"><a href="classllvm_1_1BlockFrequency.html">llvm::BlockFrequency</a></div><div class="ttdef"><b>Definition:</b> <a href="BlockFrequency_8h_source.html#l00025">BlockFrequency.h:25</a></div></div>
<div class="ttc" id="SpillPlacement_8cpp_html_a52be80b365d5f14d9c6485c978447c75"><div class="ttname"><a href="SpillPlacement_8cpp.html#a52be80b365d5f14d9c6485c978447c75">Threshold</a></div><div class="ttdeci">static const BlockFrequency Threshold</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00064">SpillPlacement.cpp:64</a></div></div>
<div class="ttc" id="classllvm_1_1MachineLoopInfo_html"><div class="ttname"><a href="classllvm_1_1MachineLoopInfo.html">llvm::MachineLoopInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineLoopInfo_8h_source.html#l00072">MachineLoopInfo.h:72</a></div></div>
<div class="ttc" id="CodeGen_2Passes_8h_html"><div class="ttname"><a href="CodeGen_2Passes_8h.html">Passes.h</a></div></div>
<div class="ttc" id="structSpillPlacement_1_1Node_html_a370ae71068f6725ac2c6b61cf66a05b4"><div class="ttname"><a href="structSpillPlacement_1_1Node.html#a370ae71068f6725ac2c6b61cf66a05b4">llvm::SpillPlacement::Node::BiasN</a></div><div class="ttdeci">BlockFrequency BiasN</div><div class="ttdoc">BiasN - Sum of blocks that prefer a spill. </div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00077">SpillPlacement.cpp:77</a></div></div>
<div class="ttc" id="structSpillPlacement_1_1Node_html_a66f813f27246b0ab617f707dd9a41bd5"><div class="ttname"><a href="structSpillPlacement_1_1Node.html#a66f813f27246b0ab617f707dd9a41bd5">llvm::SpillPlacement::Node::preferReg</a></div><div class="ttdeci">bool preferReg() const </div><div class="ttdoc">preferReg - Return true when this node prefers to be in a register. </div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8cpp_source.html#l00096">SpillPlacement.cpp:96</a></div></div>
<div class="ttc" id="classllvm_1_1SpillPlacement_html_aa34d3acfa03ca143b486fc4fd7604e76"><div class="ttname"><a href="classllvm_1_1SpillPlacement.html#aa34d3acfa03ca143b486fc4fd7604e76">llvm::SpillPlacement::ID</a></div><div class="ttdeci">static char ID</div><div class="ttdef"><b>Definition:</b> <a href="SpillPlacement_8h_source.html#l00064">SpillPlacement.h:64</a></div></div>
<div class="ttc" id="MachineLoopInfo_8h_html"><div class="ttname"><a href="MachineLoopInfo_8h.html">MachineLoopInfo.h</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<p class="footer">
Generated on Sat Nov 10 2018 23:02:25 for <a href="http://llvm.org/">LLVM</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.8.11</a><br>
Copyright &copy; 2003-2013 University of Illinois at Urbana-Champaign.
All Rights Reserved.</p>
<hr>
<!--#include virtual="/attrib.incl" -->
</body>
</html>
