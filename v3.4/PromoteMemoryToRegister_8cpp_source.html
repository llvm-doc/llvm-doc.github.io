<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="LLVM,Low Level Virtual Machine,C++,doxygen,API,documentation"/>
<meta name="description" content="C++ source code API documentation for LLVM."/>
<title>LLVM: PromoteMemoryToRegister.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">LLVM API Documentation</p>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('PromoteMemoryToRegister_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">PromoteMemoryToRegister.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="PromoteMemoryToRegister_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- PromoteMemoryToRegister.cpp - Convert allocas to registers ---------===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                     The LLVM Compiler Infrastructure</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is distributed under the University of Illinois Open Source</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License. See LICENSE.TXT for details.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// This file promotes memory references to be register references.  It promotes</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// alloca instructions which only have loads and stores as uses.  An alloca is</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// transformed by using iterated dominator frontiers to place PHI nodes, then</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// traversing the function in depth-first order to rewrite loads and stores as</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// appropriate.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// The algorithm used here is based on:</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//   Sreedhar and Gao. A linear time algorithm for placing phi-nodes.</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//   In Proceedings of the 22nd ACM SIGPLAN-SIGACT Symposium on Principles of</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//   Programming Languages</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//   POPL &#39;95. ACM, New York, NY, 62-73.</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">// It has been modified to not explicitly use the DJ graph data structure and to</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">// directly compute pruned SSA using per-variable liveness information.</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="PromoteMemoryToRegister_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   28</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;mem2reg&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="PromoteMemToReg_8h.html">llvm/Transforms/Utils/PromoteMemToReg.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ArrayRef_8h.html">llvm/ADT/ArrayRef.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseMap_8h.html">llvm/ADT/DenseMap.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallPtrSet_8h.html">llvm/ADT/SmallPtrSet.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallVector_8h.html">llvm/ADT/SmallVector.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AliasSetTracker_8h.html">llvm/Analysis/AliasSetTracker.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Dominators_8h.html">llvm/Analysis/Dominators.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="InstructionSimplify_8h.html">llvm/Analysis/InstructionSimplify.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueTracking_8h.html">llvm/Analysis/ValueTracking.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DIBuilder_8h.html">llvm/DIBuilder.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DebugInfo_8h.html">llvm/DebugInfo.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DerivedTypes_8h.html">llvm/IR/DerivedTypes.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Function_8h.html">llvm/IR/Function.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IntrinsicInst_8h.html">llvm/IR/IntrinsicInst.h</a>&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Metadata_8h.html">llvm/IR/Metadata.h</a>&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Support_2CFG_8h.html">llvm/Support/CFG.h</a>&quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Local_8h.html">llvm/Transforms/Utils/Local.h</a>&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &lt;queue&gt;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<a class="code" href="PromoteMemoryToRegister_8cpp.html#abe014602428675793f21d1dd21ef6d30">STATISTIC</a>(NumLocalPromoted, <span class="stringliteral">&quot;Number of alloca&#39;s promoted within one block&quot;</span>);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<a class="code" href="PromoteMemoryToRegister_8cpp.html#abe014602428675793f21d1dd21ef6d30">STATISTIC</a>(NumSingleStore,   <span class="stringliteral">&quot;Number of alloca&#39;s promoted with a single store&quot;</span>);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<a class="code" href="PromoteMemoryToRegister_8cpp.html#abe014602428675793f21d1dd21ef6d30">STATISTIC</a>(NumDeadAlloca,    <span class="stringliteral">&quot;Number of dead alloca&#39;s removed&quot;</span>);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<a class="code" href="PromoteMemoryToRegister_8cpp.html#abe014602428675793f21d1dd21ef6d30">STATISTIC</a>(NumPHIInsert,     <span class="stringliteral">&quot;Number of PHI nodes inserted&quot;</span>);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="namespacellvm.html#a5023b360abc7a5d1612061fba30003a6">   59</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacellvm.html#a5023b360abc7a5d1612061fba30003a6">llvm::isAllocaPromotable</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI) {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="comment">// FIXME: If the memory unit is of pointer or integer type, we can permit</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="comment">// assignments to subsections of the memory unit.</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="comment">// Only allow direct and non-volatile loads and stores...</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::const_use_iterator</a> UI = AI-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), UE = AI-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;       UI != UE; ++UI) { <span class="comment">// Loop over all of the uses of the alloca</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1User.html">User</a> *U = *UI;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(U)) {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      <span class="comment">// Note that atomic loads can be transformed; atomic semantics do</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      <span class="comment">// not have any meaning for a local alloca.</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      <span class="keywordflow">if</span> (LI-&gt;isVolatile())</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(U)) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <span class="keywordflow">if</span> (SI-&gt;getOperand(0) == AI)</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Don&#39;t allow a store OF the AI, only INTO the AI.</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      <span class="comment">// Note that atomic stores can be transformed; atomic semantics do</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      <span class="comment">// not have any meaning for a local alloca.</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      <span class="keywordflow">if</span> (SI-&gt;isVolatile())</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II = dyn_cast&lt;IntrinsicInst&gt;(U)) {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="keywordflow">if</span> (II-&gt;getIntrinsicID() != <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ae365354e47542c51f9bd46e329e3323e">Intrinsic::lifetime_start</a> &amp;&amp;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;          II-&gt;getIntrinsicID() != <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90aa332b90dd5e4ebf4bbbcc0964220d373">Intrinsic::lifetime_end</a>)</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BCI = dyn_cast&lt;BitCastInst&gt;(U)) {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      <span class="keywordflow">if</span> (BCI-&gt;getType() != <a class="code" href="classllvm_1_1Type.html#a7fe9ccd4893f4e2caa826126c09545ea">Type::getInt8PtrTy</a>(U-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()))</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a9d0a7040918ba81ef34046fd474cee10">onlyUsedByLifetimeMarkers</a>(BCI))</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI = dyn_cast&lt;GetElementPtrInst&gt;(U)) {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="keywordflow">if</span> (GEPI-&gt;getType() != <a class="code" href="classllvm_1_1Type.html#a7fe9ccd4893f4e2caa826126c09545ea">Type::getInt8PtrTy</a>(U-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()))</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <span class="keywordflow">if</span> (!GEPI-&gt;hasAllZeroIndices())</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a9d0a7040918ba81ef34046fd474cee10">onlyUsedByLifetimeMarkers</a>(GEPI))</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    }</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  }</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keyword">struct </span>AllocaInfo {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 32&gt;</a> DefiningBlocks;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 32&gt;</a> UsingBlocks;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *OnlyStore;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *OnlyBlock;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordtype">bool</span> OnlyUsedInOneBlock;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *AllocaPointerVal;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <a class="code" href="classllvm_1_1DbgDeclareInst.html">DbgDeclareInst</a> *DbgDeclare;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordtype">void</span> clear() {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    DefiningBlocks.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    UsingBlocks.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    OnlyStore = 0;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    OnlyBlock = 0;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    OnlyUsedInOneBlock = <span class="keyword">true</span>;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    AllocaPointerVal = 0;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    DbgDeclare = 0;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">  /// Scan the uses of the specified alloca, filling in the AllocaInfo used</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">  /// by the rest of the pass to reason about the uses of this alloca.</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"></span>  <span class="keywordtype">void</span> AnalyzeAlloca(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI) {</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    clear();</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">// As we scan the uses of the alloca instruction, keep track of stores,</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// and decide whether all of the loads and stores to the alloca are within</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">// the same basic block.</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = AI-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = AI-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;         UI != E;) {</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(*UI++);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(User)) {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="comment">// Remember the basic blocks which define new values for the alloca</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        DefiningBlocks.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(SI-&gt;getParent());</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        AllocaPointerVal = SI-&gt;getOperand(0);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        OnlyStore = SI;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = cast&lt;LoadInst&gt;(User);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="comment">// Otherwise it must be a load instruction, keep track of variable</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="comment">// reads.</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        UsingBlocks.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        AllocaPointerVal = LI;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      }</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="keywordflow">if</span> (OnlyUsedInOneBlock) {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordflow">if</span> (OnlyBlock == 0)</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;          OnlyBlock = User-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (OnlyBlock != User-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>())</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;          OnlyUsedInOneBlock = <span class="keyword">false</span>;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    DbgDeclare = <a class="code" href="namespacellvm.html#aabf35a012f84ad0dab49cd5b7dec7965">FindAllocaDbgDeclare</a>(AI);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;};</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">// Data package used by RenamePass()</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="keyword">class </span>RenamePassData {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keyword">typedef</span> std::vector&lt;Value *&gt; ValVector;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  RenamePassData() : <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>(NULL), Pred(NULL), Values() {}</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  RenamePassData(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a>, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>, <span class="keyword">const</span> ValVector &amp;V)</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      : <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>(B), Pred(P), Values(V) {}</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  ValVector Values;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#a39bdaf6372ed2ef16d951fc0f6d54dd4">swap</a>(RenamePassData &amp;RHS) {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(BB, RHS.BB);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Pred, RHS.Pred);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    Values.swap(RHS.Values);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;};</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">/// \brief This assigns and keeps a per-bb relative ordering of load/store</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">/// instructions in the block that directly load or store an alloca.</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">/// This functionality is important because it avoids scanning large basic</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">/// blocks multiple times when promoting many allocas in the same block.</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment"></span><span class="keyword">class </span>LargeBlockInfo {<span class="comment"></span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">  /// \brief For each instruction that we track, keep the index of the</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">  /// instruction.</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">  /// The index starts out as the number of the instruction from the start of</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">  /// the block.</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const Instruction *, unsigned&gt;</a> InstNumbers;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">  /// This code only looks at accesses to allocas.</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment"></span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> isInterestingInstruction(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">return</span> (isa&lt;LoadInst&gt;(I) &amp;&amp; isa&lt;AllocaInst&gt;(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0))) ||</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;           (isa&lt;StoreInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; isa&lt;AllocaInst&gt;(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1)));</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">  /// Get or calculate the index of the specified instruction.</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment"></span>  <span class="keywordtype">unsigned</span> getInstructionIndex(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I) {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    assert(isInterestingInstruction(I) &amp;&amp;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;           <span class="stringliteral">&quot;Not a load/store to/from an alloca?&quot;</span>);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">// If we already have this instruction number, return it.</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const Instruction *, unsigned&gt;::iterator</a> It = InstNumbers.<a class="code" href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">find</a>(I);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">if</span> (It != InstNumbers.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>())</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="keywordflow">return</span> It-&gt;second;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// Scan the whole block to get the instruction.  This accumulates</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">// information for every interesting instruction in the block, in order to</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">// avoid gratuitus rescans.</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keywordtype">unsigned</span> InstNo = 0;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::const_iterator</a> BBI = <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;begin(), E = <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>-&gt;end(); BBI != E;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;         ++BBI)</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="keywordflow">if</span> (isInterestingInstruction(BBI))</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        InstNumbers[BBI] = InstNo++;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    It = InstNumbers.<a class="code" href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">find</a>(I);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    assert(It != InstNumbers.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>() &amp;&amp; <span class="stringliteral">&quot;Didn&#39;t insert instruction?&quot;</span>);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">return</span> It-&gt;second;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordtype">void</span> deleteValue(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *I) { InstNumbers.<a class="code" href="classllvm_1_1DenseMapBase.html#a269c7b8adcd29645a4f901196fc08806">erase</a>(I); }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordtype">void</span> clear() { InstNumbers.<a class="code" href="classllvm_1_1DenseMapBase.html#a6467bd6bb128c8b69a478548fc17351c">clear</a>(); }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;};</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="keyword">struct </span>PromoteMem2Reg {<span class="comment"></span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">  /// The alloca instructions being promoted.</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment"></span>  std::vector&lt;AllocaInst *&gt; Allocas;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <a class="code" href="classllvm_1_1DIBuilder.html">DIBuilder</a> DIB;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">  /// An AliasSetTracker object to update.  If null, don&#39;t update it.</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1AliasSetTracker.html">AliasSetTracker</a> *AST;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">  /// Reverse mapping of Allocas.</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;AllocaInst *, unsigned&gt;</a> AllocaLookup;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">  /// \brief The PhiNodes we&#39;re adding.</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">  /// That map is used to simplify some Phi nodes as we iterate over it, so</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">  /// it should have deterministic iterators.  We could use a MapVector, but</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">  /// since we already maintain a map from BasicBlock* to a stable numbering</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">  /// (BBNumbers), the DenseMap is more efficient (also supports removal).</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;std::pair&lt;unsigned, unsigned&gt;</a>, <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *&gt; NewPhiNodes;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">  /// For each PHI node, keep track of which entry in Allocas it corresponds</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">  /// to.</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;PHINode *, unsigned&gt;</a> PhiToAllocaMap;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">  /// If we are updating an AliasSetTracker, then for each alloca that is of</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">  /// pointer type, we keep track of what to copyValue to the inserted PHI</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">  /// nodes here.</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment"></span>  std::vector&lt;Value *&gt; PointerAllocaValues;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">  /// For each alloca, we keep track of the dbg.declare intrinsic that</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">  /// describes it, if any, so that we can convert it to a dbg.value</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">  /// intrinsic if the alloca gets promoted.</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DbgDeclareInst *, 8&gt;</a> AllocaDbgDeclares;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">  /// The set of basic blocks the renamer has already visited.</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 16&gt;</a> Visited;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">  /// Contains a stable numbering of basic blocks to avoid non-determinstic</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">  /// behavior.</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;BasicBlock *, unsigned&gt;</a> BBNumbers;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">  /// Maps DomTreeNodes to their level in the dominator tree.</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;DomTreeNode *, unsigned&gt;</a> DomLevels;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">  /// Lazily compute the number of predecessors a block has.</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;const BasicBlock *, unsigned&gt;</a> BBNumPreds;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  PromoteMem2Reg(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;AllocaInst *&gt;</a> Allocas, <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT,</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                 <a class="code" href="classllvm_1_1AliasSetTracker.html">AliasSetTracker</a> *AST)</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      : Allocas(Allocas.<a class="code" href="classllvm_1_1ArrayRef.html#a836367b39ed630bf14db99923c22740e">begin</a>(), Allocas.<a class="code" href="classllvm_1_1ArrayRef.html#a38ed8cc3c342ad6910e8c869d3e2b9cf">end</a>()), DT(DT),</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        DIB(*DT.<a class="code" href="classllvm_1_1DominatorTree.html#a436392aa0ad025c20485feae48521c30">getRoot</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>()-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>()), AST(AST) {}</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordtype">void</span> run();</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordtype">void</span> RemoveFromAllocasList(<span class="keywordtype">unsigned</span> &amp;AllocaIdx) {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    Allocas[AllocaIdx] = Allocas.<a class="code" href="classllvm_1_1ArrayRef.html#ad863a11c0d0943aad3d7a51d02711c4e">back</a>();</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    Allocas.pop_back();</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    --AllocaIdx;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  }</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordtype">unsigned</span> getNumPreds(<span class="keyword">const</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>) {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordtype">unsigned</span> &amp;NP = BBNumPreds[<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>];</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">if</span> (NP == 0)</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      NP = std::distance(<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(BB), <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(BB)) + 1;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">return</span> NP - 1;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keywordtype">void</span> DetermineInsertionPoint(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI, <span class="keywordtype">unsigned</span> AllocaNum,</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                               AllocaInfo &amp;Info);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordtype">void</span> ComputeLiveInBlocks(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI, AllocaInfo &amp;Info,</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                           <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 32&gt;</a> &amp;DefBlocks,</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                           <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 32&gt;</a> &amp;LiveInBlocks);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="keywordtype">void</span> RenamePass(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred,</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                  RenamePassData::ValVector &amp;IncVals,</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                  std::vector&lt;RenamePassData&gt; &amp;Worklist);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keywordtype">bool</span> QueuePhiNode(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB, <span class="keywordtype">unsigned</span> AllocaIdx, <span class="keywordtype">unsigned</span> &amp;Version);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;};</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;} <span class="comment">// end of anonymous namespace</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno"><a class="line" href="PromoteMemoryToRegister_8cpp.html#a2e8693fb5ac5ae6cc079025486261792">  316</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="PromoteMemoryToRegister_8cpp.html#a2e8693fb5ac5ae6cc079025486261792">removeLifetimeIntrinsicUsers</a>(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI) {</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="comment">// Knowing that this alloca is promotable, we know that it&#39;s safe to kill all</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="comment">// instructions except for load and store.</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = AI-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), UE = AI-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;       UI != UE;) {</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = cast&lt;Instruction&gt;(*UI);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    ++UI;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordflow">if</span> (isa&lt;LoadInst&gt;(I) || isa&lt;StoreInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">if</span> (!I-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#af5c7041df3ad5edffe5da17b5264c1fc">isVoidTy</a>()) {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <span class="comment">// The only users of this bitcast/GEP instruction are lifetime intrinsics.</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="comment">// Follow the use/def chain to erase them now instead of leaving it for</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="comment">// dead code elimination later.</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = I-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), UE = I-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;           UI != UE;) {</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = cast&lt;Instruction&gt;(*UI);</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        ++UI;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        Inst-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    }</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;}</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">/// \brief Rewrite as many loads as possible given a single store.</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">/// When there is only a single store, we can use the domtree to trivially</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">/// replace all of the dominated loads with the stored value. Do so, and return</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">/// true if this has successfully promoted the alloca entirely. If this returns</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">/// false there were some loads which were not dominated by the single store</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">/// and thus must be phi-ed with undef. We fall back to the standard alloca</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">/// promotion algorithm in that case.</span></div><div class="line"><a name="l00350"></a><span class="lineno"><a class="line" href="PromoteMemoryToRegister_8cpp.html#aeeeb38b5af7c94ee5e59feafb87ad18c">  350</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="PromoteMemoryToRegister_8cpp.html#aeeeb38b5af7c94ee5e59feafb87ad18c">rewriteSingleStoreAlloca</a>(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI, AllocaInfo &amp;Info,</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                     LargeBlockInfo &amp;LBI,</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                                     <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT,</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                                     <a class="code" href="classllvm_1_1AliasSetTracker.html">AliasSetTracker</a> *AST) {</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *OnlyStore = Info.OnlyStore;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keywordtype">bool</span> StoringGlobalVal = !isa&lt;Instruction&gt;(OnlyStore-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0));</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *StoreBB = OnlyStore-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordtype">int</span> StoreIndex = -1;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="comment">// Clear out UsingBlocks.  We will reconstruct it here if needed.</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  Info.UsingBlocks.clear();</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = AI-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = AI-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI != E;) {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UserInst = cast&lt;Instruction&gt;(*UI++);</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;LoadInst&gt;(UserInst)) {</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      assert(UserInst == OnlyStore &amp;&amp; <span class="stringliteral">&quot;Should only have load/stores&quot;</span>);</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    }</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = cast&lt;LoadInst&gt;(UserInst);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">// Okay, if we have a load from the alloca, we want to replace it with the</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">// only value stored to the alloca.  We can do this if the value is</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">// dominated by the store.  If not, we use the rest of the mem2reg machinery</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">// to insert the phi nodes as needed.</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">if</span> (!StoringGlobalVal) { <span class="comment">// Non-instructions are always dominated.</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="keywordflow">if</span> (LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>() == StoreBB) {</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="comment">// If we have a use that is in the same block as the store, compare the</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="comment">// indices of the two instructions to see which one came first.  If the</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="comment">// load came before the store, we can&#39;t handle it.</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keywordflow">if</span> (StoreIndex == -1)</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;          StoreIndex = LBI.getInstructionIndex(OnlyStore);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">if</span> (<span class="keywordtype">unsigned</span>(StoreIndex) &gt; LBI.getInstructionIndex(LI)) {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;          <span class="comment">// Can&#39;t handle this load, bail out.</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;          Info.UsingBlocks.push_back(StoreBB);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>() != StoreBB &amp;&amp;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                 !DT.<a class="code" href="classllvm_1_1DominatorTree.html#a6fe9272dc67fe2ff4cafc33b895c4a6c">dominates</a>(StoreBB, LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>())) {</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="comment">// If the load and store are in different blocks, use BB dominance to</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="comment">// check their relationships.  If the store doesn&#39;t dom the use, bail</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="comment">// out.</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        Info.UsingBlocks.push_back(LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>());</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      }</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    }</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="comment">// Otherwise, we *can* safely rewrite this load.</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *ReplVal = OnlyStore-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="comment">// If the replacement value is the load, this must occur in unreachable</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">// code.</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">if</span> (ReplVal == LI)</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      ReplVal = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(LI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    LI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(ReplVal);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">if</span> (AST &amp;&amp; LI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>())</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      AST-&gt;<a class="code" href="classllvm_1_1AliasSetTracker.html#a8e27fd723c6fe8b3595d4d006acb39ea">deleteValue</a>(LI);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    LBI.deleteValue(LI);</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  }</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="comment">// Finally, after the scan, check to see if the store is all that is left.</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordflow">if</span> (!Info.UsingBlocks.empty())</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// If not, we&#39;ll have to fall back for the remainder.</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="comment">// Record debuginfo for the store and remove the declaration&#39;s</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="comment">// debuginfo.</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1DbgDeclareInst.html">DbgDeclareInst</a> *DDI = Info.DbgDeclare) {</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <a class="code" href="classllvm_1_1DIBuilder.html">DIBuilder</a> DIB(*AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>()-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>());</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <a class="code" href="namespacellvm.html#ab3d313ef442aae5b5bebf03c923506d0">ConvertDebugDeclareToDebugValue</a>(DDI, Info.OnlyStore, DIB);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    DDI-&gt;eraseFromParent();</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    LBI.deleteValue(DDI);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  }</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="comment">// Remove the (now dead) store and alloca.</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  Info.OnlyStore-&gt;eraseFromParent();</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  LBI.deleteValue(Info.OnlyStore);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="keywordflow">if</span> (AST)</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    AST-&gt;<a class="code" href="classllvm_1_1AliasSetTracker.html#a8e27fd723c6fe8b3595d4d006acb39ea">deleteValue</a>(AI);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  LBI.deleteValue(AI);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;}</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">/// Many allocas are only used within a single basic block.  If this is the</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">/// case, avoid traversing the CFG and inserting a lot of potentially useless</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">/// PHI nodes by just performing a single linear pass over the basic block</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">/// using the Alloca.</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">/// If we cannot promote this alloca (because it is read before it is written),</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">/// return true.  This is necessary in cases where, due to control flow, the</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">/// alloca is potentially undefined on some control flow paths.  e.g. code like</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">/// this is potentially correct:</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">///   for (...) { if (c) { A = undef; undef = B; } }</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">/// ... so long as A is not used before undef is set.</span></div><div class="line"><a name="l00447"></a><span class="lineno"><a class="line" href="PromoteMemoryToRegister_8cpp.html#acd74321a4d6c3a9b970e83cd7c4838e8">  447</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="PromoteMemoryToRegister_8cpp.html#acd74321a4d6c3a9b970e83cd7c4838e8">promoteSingleBlockAlloca</a>(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI, <span class="keyword">const</span> AllocaInfo &amp;Info,</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                                     LargeBlockInfo &amp;LBI,</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                                     <a class="code" href="classllvm_1_1AliasSetTracker.html">AliasSetTracker</a> *AST) {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="comment">// The trickiest case to handle is when we have large blocks. Because of this,</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="comment">// this code is optimized assuming that large blocks happen.  This does not</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="comment">// significantly pessimize the small block case.  This uses LargeBlockInfo to</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="comment">// make it efficient to get the index of various operations in the block.</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="comment">// Walk the use-def list of the alloca, getting the locations of all stores.</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;unsigned, StoreInst *&gt;</a>, 64&gt; StoresByIndexTy;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  StoresByIndexTy StoresByIndex;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = AI-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = AI-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI != E;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;       ++UI)</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(*UI))</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      StoresByIndex.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(LBI.getInstructionIndex(SI), SI));</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="comment">// Sort the stores by their index, making it efficient to do a lookup with a</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="comment">// binary search.</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  std::sort(StoresByIndex.begin(), StoresByIndex.end(), <a class="code" href="structllvm_1_1less__first.html">less_first</a>());</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="comment">// Walk all of the loads from this alloca, replacing them with the nearest</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="comment">// store above them, if any.</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = AI-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = AI-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI != E;) {</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>&gt;(*UI++);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">if</span> (!LI)</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordtype">unsigned</span> LoadIdx = LBI.getInstructionIndex(LI);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="comment">// Find the nearest store that has a lower index than this load.</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    StoresByIndexTy::iterator <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> =</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        std::lower_bound(StoresByIndex.begin(), StoresByIndex.end(),</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                         std::make_pair(LoadIdx, static_cast&lt;StoreInst *&gt;(0)),</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                         <a class="code" href="structllvm_1_1less__first.html">less_first</a>());</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">if</span> (I == StoresByIndex.begin())</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="comment">// If there is no store before this load, the load takes the undef value.</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      LI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(LI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()));</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <span class="comment">// Otherwise, there was a store before this load, the load takes its value.</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      LI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a class="code" href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a>(I)-&gt;second-&gt;getOperand(0));</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">if</span> (AST &amp;&amp; LI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>())</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      AST-&gt;<a class="code" href="classllvm_1_1AliasSetTracker.html#a8e27fd723c6fe8b3595d4d006acb39ea">deleteValue</a>(LI);</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    LBI.deleteValue(LI);</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  }</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="comment">// Remove the (now dead) stores and alloca.</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">while</span> (!AI-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = cast&lt;StoreInst&gt;(AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">use_back</a>());</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">// Record debuginfo for the store before removing it.</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1DbgDeclareInst.html">DbgDeclareInst</a> *DDI = Info.DbgDeclare) {</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <a class="code" href="classllvm_1_1DIBuilder.html">DIBuilder</a> DIB(*AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>()-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>());</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      <a class="code" href="namespacellvm.html#ab3d313ef442aae5b5bebf03c923506d0">ConvertDebugDeclareToDebugValue</a>(DDI, SI, DIB);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    }</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    LBI.deleteValue(SI);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  }</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keywordflow">if</span> (AST)</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    AST-&gt;<a class="code" href="classllvm_1_1AliasSetTracker.html#a8e27fd723c6fe8b3595d4d006acb39ea">deleteValue</a>(AI);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  LBI.deleteValue(AI);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="comment">// The alloca&#39;s debuginfo can be removed as well.</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1DbgDeclareInst.html">DbgDeclareInst</a> *DDI = Info.DbgDeclare) {</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    DDI-&gt;eraseFromParent();</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    LBI.deleteValue(DDI);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  }</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  ++NumLocalPromoted;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;}</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="keywordtype">void</span> PromoteMem2Reg::run() {</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> &amp;<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a> = *DT.getRoot()-&gt;getParent();</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordflow">if</span> (AST)</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    PointerAllocaValues.resize(Allocas.size());</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  AllocaDbgDeclares.resize(Allocas.size());</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  AllocaInfo Info;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  LargeBlockInfo LBI;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> AllocaNum = 0; AllocaNum != Allocas.size(); ++AllocaNum) {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI = Allocas[AllocaNum];</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    assert(<a class="code" href="namespacellvm.html#a5023b360abc7a5d1612061fba30003a6">isAllocaPromotable</a>(AI) &amp;&amp; <span class="stringliteral">&quot;Cannot promote non-promotable alloca!&quot;</span>);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    assert(AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>()-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>() == &amp;F &amp;&amp;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;           <span class="stringliteral">&quot;All allocas should be in the same function, which is same as DF!&quot;</span>);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <a class="code" href="PromoteMemoryToRegister_8cpp.html#a2e8693fb5ac5ae6cc079025486261792">removeLifetimeIntrinsicUsers</a>(AI);</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">if</span> (AI-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <span class="comment">// If there are no uses of the alloca, just delete it now.</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordflow">if</span> (AST)</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        AST-&gt;deleteValue(AI);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      AI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="comment">// Remove the alloca from the Allocas list, since it has been processed</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      RemoveFromAllocasList(AllocaNum);</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      ++NumDeadAlloca;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    }</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="comment">// Calculate the set of read and write-locations for each alloca.  This is</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="comment">// analogous to finding the &#39;uses&#39; and &#39;definitions&#39; of each variable.</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    Info.AnalyzeAlloca(AI);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="comment">// If there is only a single store to this value, replace any loads of</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">// it that are directly dominated by the definition with the value stored.</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">if</span> (Info.DefiningBlocks.size() == 1) {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="PromoteMemoryToRegister_8cpp.html#aeeeb38b5af7c94ee5e59feafb87ad18c">rewriteSingleStoreAlloca</a>(AI, Info, LBI, DT, AST)) {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="comment">// The alloca has been processed, move on.</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        RemoveFromAllocasList(AllocaNum);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        ++NumSingleStore;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      }</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    }</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="comment">// If the alloca is only read and written in one basic block, just perform a</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="comment">// linear sweep over the block to eliminate it.</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">if</span> (Info.OnlyUsedInOneBlock) {</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <a class="code" href="PromoteMemoryToRegister_8cpp.html#acd74321a4d6c3a9b970e83cd7c4838e8">promoteSingleBlockAlloca</a>(AI, Info, LBI, AST);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      <span class="comment">// The alloca has been processed, move on.</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      RemoveFromAllocasList(AllocaNum);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    }</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="comment">// If we haven&#39;t computed dominator tree levels, do so now.</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">if</span> (DomLevels.empty()) {</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DomTreeNode *, 32&gt;</a> Worklist;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNode</a> *Root = DT.getRootNode();</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      DomLevels[Root] = 0;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Root);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      <span class="keywordflow">while</span> (!Worklist.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNode</a> *Node = Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="keywordtype">unsigned</span> ChildLevel = DomLevels[Node] + 1;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a4d2422d22434aa1008a519a143364715">DomTreeNode::iterator</a> CI = Node-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a40b8345d54ada5dab71ae11d71e89d2f">begin</a>(), CE = Node-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a74111c67a831eb30b020ecf063bce406">end</a>();</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;             CI != CE; ++CI) {</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;          DomLevels[*CI] = ChildLevel;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;          Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(*CI);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        }</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      }</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    }</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="comment">// If we haven&#39;t computed a numbering for the BB&#39;s in the function, do so</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="comment">// now.</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">if</span> (BBNumbers.empty()) {</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <span class="keywordtype">unsigned</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a> = 0;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Function::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = F.<a class="code" href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">begin</a>(), E = F.<a class="code" href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        BBNumbers[<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>] = ID++;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    }</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">// If we have an AST to keep updated, remember some pointer value that is</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="comment">// stored into the alloca.</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">if</span> (AST)</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      PointerAllocaValues[AllocaNum] = Info.AllocaPointerVal;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="comment">// Remember the dbg.declare intrinsic describing this alloca, if any.</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">if</span> (Info.DbgDeclare)</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      AllocaDbgDeclares[AllocaNum] = Info.DbgDeclare;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="comment">// Keep the reverse mapping of the &#39;Allocas&#39; array for the rename pass.</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    AllocaLookup[Allocas[AllocaNum]] = AllocaNum;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="comment">// At this point, we&#39;re committed to promoting the alloca using IDF&#39;s, and</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="comment">// the standard SSA construction algorithm.  Determine which blocks need PHI</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="comment">// nodes and see if we can optimize out some work by avoiding insertion of</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="comment">// dead phi nodes.</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    DetermineInsertionPoint(AI, AllocaNum, Info);</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  }</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="keywordflow">if</span> (Allocas.empty())</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordflow">return</span>; <span class="comment">// All of the allocas must have been trivial!</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  LBI.clear();</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="comment">// Set the incoming values for the basic block to be null values for all of</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="comment">// the alloca&#39;s.  We do this in case there is a load of a value that has not</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="comment">// been stored yet.  In this case, it will get this null value.</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  RenamePassData::ValVector Values(Allocas.size());</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Allocas.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    Values[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(Allocas[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;getAllocatedType());</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="comment">// Walks all basic blocks in the function performing the SSA rename algorithm</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="comment">// and inserting the phi nodes we marked as necessary</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  std::vector&lt;RenamePassData&gt; RenamePassWorkList;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  RenamePassWorkList.push_back(RenamePassData(F.<a class="code" href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">begin</a>(), 0, Values));</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    RenamePassData RPD;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    RPD.swap(RenamePassWorkList.back());</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    RenamePassWorkList.pop_back();</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="comment">// RenamePass may add new worklist entries.</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    RenamePass(RPD.BB, RPD.Pred, RPD.Values, RenamePassWorkList);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  } <span class="keywordflow">while</span> (!RenamePassWorkList.empty());</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="comment">// The renamer uses the Visited set to avoid infinite loops.  Clear it now.</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  Visited.clear();</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="comment">// Remove the allocas themselves from the function.</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Allocas.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a> = Allocas[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="comment">// If there are any uses of the alloca instructions left, they must be in</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="comment">// unreachable basic blocks that were not processed by walking the dominator</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="comment">// tree. Just delete the users now.</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">if</span> (!A-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>())</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      A-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(A-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()));</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">if</span> (AST)</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      AST-&gt;deleteValue(A);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    A-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  }</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="comment">// Remove alloca&#39;s dbg.declare instrinsics from the function.</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = AllocaDbgDeclares.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1DbgDeclareInst.html">DbgDeclareInst</a> *DDI = AllocaDbgDeclares[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>])</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      DDI-&gt;eraseFromParent();</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <span class="comment">// Loop over all of the PHI nodes and see if there are any that we can get</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="comment">// rid of because they merge all of the same incoming values.  This can</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="comment">// happen due to undef values coming into the PHI nodes.  This process is</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="comment">// iterative, because eliminating one PHI node can cause others to be removed.</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="keywordtype">bool</span> EliminatedAPHI = <span class="keyword">true</span>;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keywordflow">while</span> (EliminatedAPHI) {</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    EliminatedAPHI = <span class="keyword">false</span>;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="comment">// Iterating over NewPhiNodes is deterministic, so it is safe to try to</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="comment">// simplify and RAUW them as we go.  If it was not, we could add uses to</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="comment">// the values we replace with in a non deterministic order, thus creating</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="comment">// non deterministic def-&gt;use chains.</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1DenseMap.html">DenseMap</a>&lt;std::pair&lt;unsigned, unsigned&gt;, <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *&gt;::iterator</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;             <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = NewPhiNodes.begin(),</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;             E = NewPhiNodes.end();</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;         <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E;) {</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <span class="comment">// If this PHI node merges one value and/or undefs, get the value.</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *V = <a class="code" href="namespacellvm.html#a50f8f41fccbea466816345520e9bfabb">SimplifyInstruction</a>(PN, 0, 0, &amp;DT)) {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        <span class="keywordflow">if</span> (AST &amp;&amp; PN-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>())</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;          AST-&gt;deleteValue(PN);</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        PN-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        PN-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        NewPhiNodes.erase(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        EliminatedAPHI = <span class="keyword">true</span>;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      }</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    }</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  }</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="comment">// At this point, the renamer has added entries to PHI nodes for all reachable</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="comment">// code.  Unfortunately, there may be unreachable blocks which the renamer</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="comment">// hasn&#39;t traversed.  If this is the case, the PHI nodes may not</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="comment">// have incoming values for all predecessors.  Loop over all PHI nodes we have</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <span class="comment">// created, inserting undef values if they are missing any incoming values.</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1DenseMap.html">DenseMap</a>&lt;std::pair&lt;unsigned, unsigned&gt;, <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *&gt;::iterator</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;           <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = NewPhiNodes.begin(),</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;           E = NewPhiNodes.end();</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="comment">// We want to do this once per basic block.  As such, only process a block</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="comment">// when we find the PHI that is the first entry in the block.</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *SomePHI = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = SomePHI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">if</span> (&amp;BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a33603355becfb1a050b62aa015c1cc57">front</a>() != SomePHI)</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="comment">// Only do work here if there the PHI nodes are missing incoming values.  We</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="comment">// know that all PHI nodes that were inserted in a block will have the same</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="comment">// number of incoming values, so we can just check any of them.</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keywordflow">if</span> (SomePHI-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>() == getNumPreds(BB))</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="comment">// Get the preds for BB.</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 16&gt;</a> Preds(<a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(BB), <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(BB));</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="comment">// Ok, now we know that all of the PHI nodes are missing entries for some</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="comment">// basic blocks.  Start by sorting the incoming predecessors for efficient</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="comment">// access.</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    std::sort(Preds.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Preds.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>());</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="comment">// Now we loop through all BB&#39;s which have entries in SomePHI and remove</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="comment">// them from the Preds list.</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0, e = SomePHI-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>(); i != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="comment">// Do a log(n) search of the Preds list for the entry we want.</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <a class="code" href="classT.html">SmallVectorImpl&lt;BasicBlock *&gt;::iterator</a> EntIt = std::lower_bound(</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;          Preds.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Preds.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(), SomePHI-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(i));</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      assert(EntIt != Preds.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>() &amp;&amp; *EntIt == SomePHI-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(i) &amp;&amp;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;             <span class="stringliteral">&quot;PHI node has entry for a block which is not a predecessor!&quot;</span>);</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      <span class="comment">// Remove the entry</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      Preds.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">erase</a>(EntIt);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    }</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="comment">// At this point, the blocks left in the preds list must have dummy</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="comment">// entries inserted into every PHI nodes for the block.  Update all the phi</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="comment">// nodes in this block that we are inserting (there could be phis before</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="comment">// mem2reg runs).</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="keywordtype">unsigned</span> NumBadPreds = SomePHI-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>();</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> BBI = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="keywordflow">while</span> ((SomePHI = dyn_cast&lt;PHINode&gt;(BBI++)) &amp;&amp;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;           SomePHI-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>() == NumBadPreds) {</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *UndefVal = <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(SomePHI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> pred = 0, e = Preds.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); pred != e; ++pred)</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        SomePHI-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(UndefVal, Preds[pred]);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    }</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  }</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  NewPhiNodes.clear();</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;}</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">/// \brief Determine which blocks the value is live in.</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="comment">/// These are blocks which lead to uses.  Knowing this allows us to avoid</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="comment">/// inserting PHI nodes into blocks which don&#39;t lead to uses (thus, the</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment">/// inserted phi nodes would be dead).</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> PromoteMem2Reg::ComputeLiveInBlocks(</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI, AllocaInfo &amp;Info,</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 32&gt;</a> &amp;DefBlocks,</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 32&gt;</a> &amp;LiveInBlocks) {</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="comment">// To determine liveness, we must iterate through the predecessors of blocks</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="comment">// where the def is live.  Blocks are added to the worklist if we need to</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="comment">// check their predecessors.  Start with all the using blocks.</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;BasicBlock *, 64&gt;</a> LiveInBlockWorklist(Info.UsingBlocks.begin(),</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                                                    Info.UsingBlocks.end());</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="comment">// If any of the using blocks is also a definition block, check to see if the</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="comment">// definition occurs before or after the use.  If it happens before the use,</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="comment">// the value isn&#39;t really live-in.</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = LiveInBlockWorklist.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = LiveInBlockWorklist[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keywordflow">if</span> (!DefBlocks.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(BB))</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="comment">// Okay, this is a block that both uses and defines the value.  If the first</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="comment">// reference to the alloca is a def (store), then we know it isn&#39;t live-in.</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="keywordflow">if</span> (SI-&gt;getOperand(1) != AI)</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="comment">// We found a store to the alloca before a load.  The alloca is not</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="comment">// actually live-in here.</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        LiveInBlockWorklist[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>] = LiveInBlockWorklist.back();</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        LiveInBlockWorklist.pop_back();</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, --e;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      }</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="keywordflow">if</span> (LI-&gt;getOperand(0) != AI)</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="comment">// Okay, we found a load before a store to the alloca.  It is actually</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <span class="comment">// live into this block.</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      }</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    }</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  }</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <span class="comment">// Now that we have a set of blocks where the phi is live-in, recursively add</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="comment">// their predecessors until we find the full region the value is live.</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="keywordflow">while</span> (!LiveInBlockWorklist.empty()) {</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = LiveInBlockWorklist.pop_back_val();</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="comment">// The block really is live in here, insert it into the set.  If already in</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="comment">// the set, then it has already been processed.</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">if</span> (!LiveInBlocks.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(BB))</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="comment">// Since the value is live into BB, it is either defined in a predecessor or</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="comment">// live into it to.  Add the preds to the worklist unless they are a</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="comment">// defining block.</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1PredIterator.html">pred_iterator</a> PI = <a class="code" href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">pred_begin</a>(BB), E = <a class="code" href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">pred_end</a>(BB); PI != E; ++PI) {</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = *PI;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <span class="comment">// The value is not live into a predecessor if it defines the value.</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      <span class="keywordflow">if</span> (DefBlocks.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(P))</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="comment">// Otherwise it is, add to the worklist.</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      LiveInBlockWorklist.push_back(P);</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    }</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  }</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;}</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">/// At this point, we&#39;re committed to promoting the alloca using IDF&#39;s, and the</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment">/// standard SSA construction algorithm.  Determine which blocks need phi nodes</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment">/// and see if we can optimize out some work by avoiding insertion of dead phi</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment">/// nodes.</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> PromoteMem2Reg::DetermineInsertionPoint(<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI, <span class="keywordtype">unsigned</span> AllocaNum,</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                                             AllocaInfo &amp;Info) {</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="comment">// Unique the set of defining blocks for efficient lookup.</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 32&gt;</a> DefBlocks;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  DefBlocks.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(Info.DefiningBlocks.begin(), Info.DefiningBlocks.end());</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="comment">// Determine which blocks the value is live in.  These are blocks which lead</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="comment">// to uses.</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 32&gt;</a> LiveInBlocks;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  ComputeLiveInBlocks(AI, Info, DefBlocks, LiveInBlocks);</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="comment">// Use a priority queue keyed on dominator tree level so that inserted nodes</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="comment">// are handled from the bottom of the dominator tree upwards.</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="keyword">typedef</span> std::pair&lt;DomTreeNode *, unsigned&gt; DomTreeNodePair;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keyword">typedef</span> std::priority_queue&lt;DomTreeNodePair, SmallVector&lt;DomTreeNodePair, 32&gt;,</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                              <a class="code" href="structllvm_1_1less__second.html">less_second</a>&gt; IDFPriorityQueue;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  IDFPriorityQueue PQ;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;BasicBlock *, 32&gt;::const_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = DefBlocks.<a class="code" href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">begin</a>(),</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                                                     E = DefBlocks.<a class="code" href="classllvm_1_1SmallPtrSet.html#a7f055d0b03ebf1d6a5988b178e9b8f4f">end</a>();</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNode</a> *Node = DT.getNode(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      PQ.push(std::make_pair(Node, DomLevels[Node]));</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  }</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;unsigned, BasicBlock *&gt;</a>, 32&gt; DFBlocks;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;DomTreeNode *, 32&gt;</a> Visited;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DomTreeNode *, 32&gt;</a> Worklist;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="keywordflow">while</span> (!PQ.empty()) {</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    DomTreeNodePair RootPair = PQ.top();</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    PQ.pop();</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNode</a> *Root = RootPair.first;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="keywordtype">unsigned</span> RootLevel = RootPair.second;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="comment">// Walk all dominator tree children of Root, inspecting their CFG edges with</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="comment">// targets elsewhere on the dominator tree. Only targets whose level is at</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="comment">// most Root&#39;s level are added to the iterated dominance frontier of the</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="comment">// definition set.</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Root);</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="keywordflow">while</span> (!Worklist.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>()) {</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      <a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNode</a> *Node = Worklist.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a> = Node-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a96fd2f0087c41942dd2618ff6e1b8640">getBlock</a>();</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SuccIterator.html">succ_iterator</a> SI = <a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(BB), SE = <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(BB); SI != SE;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;           ++SI) {</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <a class="code" href="classllvm_1_1DomTreeNodeBase.html">DomTreeNode</a> *SuccNode = DT.getNode(*SI);</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <span class="comment">// Quickly skip all CFG edges that are also dominator tree edges instead</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <span class="comment">// of catching them below.</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        <span class="keywordflow">if</span> (SuccNode-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a7519f9ffdda3ef1147e2563200587193">getIDom</a>() == Node)</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        <span class="keywordtype">unsigned</span> SuccLevel = DomLevels[SuccNode];</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        <span class="keywordflow">if</span> (SuccLevel &gt; RootLevel)</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <span class="keywordflow">if</span> (!Visited.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(SuccNode))</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *SuccBB = SuccNode-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a96fd2f0087c41942dd2618ff6e1b8640">getBlock</a>();</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="keywordflow">if</span> (!LiveInBlocks.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(SuccBB))</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        DFBlocks.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(BBNumbers[SuccBB], SuccBB));</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <span class="keywordflow">if</span> (!DefBlocks.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(SuccBB))</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;          PQ.push(std::make_pair(SuccNode, SuccLevel));</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      }</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a4d2422d22434aa1008a519a143364715">DomTreeNode::iterator</a> CI = Node-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a40b8345d54ada5dab71ae11d71e89d2f">begin</a>(), CE = Node-&gt;<a class="code" href="classllvm_1_1DomTreeNodeBase.html#a74111c67a831eb30b020ecf063bce406">end</a>(); CI != CE;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;           ++CI) {</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <span class="keywordflow">if</span> (!Visited.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(*CI))</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;          Worklist.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(*CI);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      }</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    }</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  }</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="keywordflow">if</span> (DFBlocks.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() &gt; 1)</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    std::sort(DFBlocks.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), DFBlocks.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>());</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="keywordtype">unsigned</span> CurrentVersion = 0;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = DFBlocks.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    QueuePhiNode(DFBlocks[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].second, AllocaNum, CurrentVersion);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;}</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment">/// \brief Queue a phi-node to be added to a basic-block for a specific Alloca.</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment">/// Returns true if there wasn&#39;t already a phi-node for that variable</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> PromoteMem2Reg::QueuePhiNode(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *<a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>, <span class="keywordtype">unsigned</span> AllocaNo,</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                                  <span class="keywordtype">unsigned</span> &amp;Version) {</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  <span class="comment">// Look up the basic-block in question.</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *&amp;PN = NewPhiNodes[std::make_pair(BBNumbers[BB], AllocaNo)];</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="comment">// If the BB already has a phi node added for the i&#39;th alloca then we&#39;re done!</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="keywordflow">if</span> (PN)</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <span class="comment">// Create a PhiNode using the dereferenced type... and add the phi-node to the</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="comment">// BasicBlock.</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  PN = <a class="code" href="classllvm_1_1PHINode.html#afb5e83bf5123ff7c51058eb0ebebcdc6">PHINode::Create</a>(Allocas[AllocaNo]-&gt;getAllocatedType(), getNumPreds(BB),</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                       Allocas[AllocaNo]-&gt;<a class="code" href="namespacellvm_1_1Intrinsic.html#a5d4ca65de6e43d76586fbdd89bf930d2">getName</a>() + <span class="stringliteral">&quot;.&quot;</span> + <a class="code" href="classllvm_1_1Twine.html">Twine</a>(Version++),</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                       BB-&gt;begin());</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  ++NumPHIInsert;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  PhiToAllocaMap[PN] = AllocaNo;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="keywordflow">if</span> (AST &amp;&amp; PN-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>())</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    AST-&gt;copyValue(PointerAllocaValues[AllocaNo], PN);</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;}</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">/// \brief Recursively traverse the CFG of the function, renaming loads and</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment">/// stores to the allocas which we are promoting.</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">/// IncomingVals indicates what value each Alloca contains on exit from the</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">/// predecessor block Pred.</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="comment"></span><span class="keywordtype">void</span> PromoteMem2Reg::RenamePass(<a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *BB, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *Pred,</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                                RenamePassData::ValVector &amp;IncomingVals,</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                                std::vector&lt;RenamePassData&gt; &amp;Worklist) {</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;NextIteration:</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="comment">// If we are inserting any phi nodes into this BB, they will already be in the</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  <span class="comment">// block.</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *APN = dyn_cast&lt;PHINode&gt;(BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>())) {</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="comment">// If we have PHI nodes to update, compute the number of edges from Pred to</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="comment">// BB.</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordflow">if</span> (PhiToAllocaMap.count(APN)) {</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      <span class="comment">// We want to be able to distinguish between PHI nodes being inserted by</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="comment">// this invocation of mem2reg from those phi nodes that already existed in</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="comment">// the IR before mem2reg was run.  We determine that APN is being inserted</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="comment">// because it is missing incoming edges.  All other PHI nodes being</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      <span class="comment">// inserted by this pass of mem2reg will have the same number of incoming</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      <span class="comment">// operands so far.  Remember this count.</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      <span class="keywordtype">unsigned</span> NewPHINumOperands = APN-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>();</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      <span class="keywordtype">unsigned</span> NumEdges = std::count(<a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(Pred), <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(Pred), BB);</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      assert(NumEdges &amp;&amp; <span class="stringliteral">&quot;Must be at least one edge from Pred to BB!&quot;</span>);</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      <span class="comment">// Add entries for all the phis.</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> PNI = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      <span class="keywordflow">do</span> {</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        <span class="keywordtype">unsigned</span> AllocaNo = PhiToAllocaMap[APN];</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <span class="comment">// Add N incoming values to the PHI node.</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != NumEdges; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;          APN-&gt;addIncoming(IncomingVals[AllocaNo], Pred);</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        <span class="comment">// The currently active variable for this block is now the PHI.</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        IncomingVals[AllocaNo] = APN;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="comment">// Get the next phi node.</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        ++PNI;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        APN = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(PNI);</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        <span class="keywordflow">if</span> (APN == 0)</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <span class="comment">// Verify that it is missing entries.  If not, it is not being inserted</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <span class="comment">// by this mem2reg invocation so we want to ignore it.</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      } <span class="keywordflow">while</span> (APN-&gt;getNumOperands() == NewPHINumOperands);</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    }</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  }</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <span class="comment">// Don&#39;t revisit blocks.</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="keywordflow">if</span> (!Visited.insert(BB))</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> II = BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); !isa&lt;TerminatorInst&gt;(II);) {</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = II++; <span class="comment">// get the instruction, increment iterator</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(I)) {</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *Src = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a>&gt;(LI-&gt;getPointerOperand());</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <span class="keywordflow">if</span> (!Src)</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;AllocaInst *, unsigned&gt;::iterator</a> AI = AllocaLookup.find(Src);</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <span class="keywordflow">if</span> (AI == AllocaLookup.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>())</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = IncomingVals[AI-&gt;second];</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      <span class="comment">// Anything using the load now uses the current value.</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      LI-&gt;replaceAllUsesWith(V);</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      <span class="keywordflow">if</span> (AST &amp;&amp; LI-&gt;getType()-&gt;isPointerTy())</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        AST-&gt;deleteValue(LI);</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#a5c2aa38108db7a66ac5e8da547f64ad7">erase</a>(LI);</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(I)) {</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <span class="comment">// Delete this instruction and mark the name as the current holder of the</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      <span class="comment">// value</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *Dest = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a>&gt;(SI-&gt;getPointerOperand());</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      <span class="keywordflow">if</span> (!Dest)</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;AllocaInst *, unsigned&gt;::iterator</a> ai = AllocaLookup.<a class="code" href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">find</a>(Dest);</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="keywordflow">if</span> (ai == AllocaLookup.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>())</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      <span class="comment">// what value were we writing?</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      IncomingVals[ai-&gt;second] = SI-&gt;getOperand(0);</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      <span class="comment">// Record debuginfo for the store before removing it.</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1DbgDeclareInst.html">DbgDeclareInst</a> *DDI = AllocaDbgDeclares[ai-&gt;second])</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        <a class="code" href="namespacellvm.html#ab3d313ef442aae5b5bebf03c923506d0">ConvertDebugDeclareToDebugValue</a>(DDI, SI, DIB);</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      BB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">getInstList</a>().<a class="code" href="classllvm_1_1iplist.html#a5c2aa38108db7a66ac5e8da547f64ad7">erase</a>(SI);</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    }</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  }</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="comment">// &#39;Recurse&#39; to our successors.</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <a class="code" href="classllvm_1_1SuccIterator.html">succ_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">succ_begin</a>(BB), E = <a class="code" href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">succ_end</a>(BB);</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  <span class="keywordflow">if</span> (I == E)</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  <span class="comment">// Keep track of the successors so we don&#39;t visit the same successor twice</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock *, 8&gt;</a> VisitedSuccs;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="comment">// Handle the first successor without using the worklist.</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  VisitedSuccs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(*I);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  Pred = <a class="code" href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a>;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  BB = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="keywordflow">for</span> (; I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="keywordflow">if</span> (VisitedSuccs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(*I))</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      Worklist.push_back(RenamePassData(*I, Pred, IncomingVals));</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  <span class="keywordflow">goto</span> NextIteration;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;}</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div><div class="line"><a name="l01072"></a><span class="lineno"><a class="line" href="namespacellvm.html#afd92ce3a3b5db58abf81981d3fcd95c6"> 1072</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacellvm.html#afd92ce3a3b5db58abf81981d3fcd95c6">llvm::PromoteMemToReg</a>(<a class="code" href="classllvm_1_1ArrayRef.html">ArrayRef&lt;AllocaInst *&gt;</a> Allocas, <a class="code" href="classllvm_1_1DominatorTree.html">DominatorTree</a> &amp;DT,</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;                           <a class="code" href="classllvm_1_1AliasSetTracker.html">AliasSetTracker</a> *AST) {</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <span class="comment">// If there is nothing to do, bail out...</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="keywordflow">if</span> (Allocas.<a class="code" href="classllvm_1_1ArrayRef.html#a3aa55c9d9145cd6b3b21c466b18abd80">empty</a>())</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  PromoteMem2Reg(Allocas, DT, AST).run();</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;}</div><div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a075e34e98605d0e7c289763a104869ac"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">llvm::SmallVectorTemplateCommon&lt; T &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00114">SmallVector.h:114</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a22a311dfe4c28a897de8a9365a4f0a84"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">llvm::SmallVectorTemplateCommon&lt; T &gt;::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00127">SmallVector.h:127</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_ae1a10b90f22c0478960fb5798ff73916"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">llvm::SmallVectorTemplateBase&lt; T, isPodLike&lt; T &gt;::value &gt;::push_back</a></div><div class="ttdeci">void push_back(const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00236">SmallVector.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad86469939d2a8bdd4169be9403b89f5a"><div class="ttname"><a href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">llvm::Value::use_end</a></div><div class="ttdeci">use_iterator use_end()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00152">Value.h:152</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a73349916f7e54a6b988a3646c7a02e90aa332b90dd5e4ebf4bbbcc0964220d373"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90aa332b90dd5e4ebf4bbbcc0964220d373">llvm::Intrinsic::lifetime_end</a></div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l01254">Intrinsics.h:1254</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARM__PROC_html_aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5"><div class="ttname"><a href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">llvm::ARM_PROC::A</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInfo_8h_source.html#l00098">ARMBaseInfo.h:98</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a089cccb6f231efee72abc76d0f9c695f"><div class="ttname"><a href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">llvm::PHINode::addIncoming</a></div><div class="ttdeci">void addIncoming(Value *V, BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02100">Instructions.h:2100</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a6fe2f06b8a4b2c3d6308afb223a0238a"><div class="ttname"><a href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">llvm::Instruction::eraseFromParent</a></div><div class="ttdeci">void eraseFromParent()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00072">Instruction.cpp:72</a></div></div>
<div class="ttc" id="Instructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="namespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">List of target independent CodeGen pass IDs. </div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l00022">APFloat.h:22</a></div></div>
<div class="ttc" id="PromoteMemoryToRegister_8cpp_html_acd74321a4d6c3a9b970e83cd7c4838e8"><div class="ttname"><a href="PromoteMemoryToRegister_8cpp.html#acd74321a4d6c3a9b970e83cd7c4838e8">promoteSingleBlockAlloca</a></div><div class="ttdeci">static void promoteSingleBlockAlloca(AllocaInst *AI, const AllocaInfo &amp;Info, LargeBlockInfo &amp;LBI, AliasSetTracker *AST)</div><div class="ttdef"><b>Definition:</b> <a href="PromoteMemoryToRegister_8cpp_source.html#l00447">PromoteMemoryToRegister.cpp:447</a></div></div>
<div class="ttc" id="DerivedTypes_8h_html"><div class="ttname"><a href="DerivedTypes_8h.html">DerivedTypes.h</a></div></div>
<div class="ttc" id="structllvm_1_1less__second_html"><div class="ttname"><a href="structllvm_1_1less__second.html">llvm::less_second</a></div><div class="ttdoc">Function object to check whether the second component of a std::pair compares less than the second co...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00230">STLExtras.h:230</a></div></div>
<div class="ttc" id="namespacellvm_html_aabf35a012f84ad0dab49cd5b7dec7965"><div class="ttname"><a href="namespacellvm.html#aabf35a012f84ad0dab49cd5b7dec7965">llvm::FindAllocaDbgDeclare</a></div><div class="ttdeci">DbgDeclareInst * FindAllocaDbgDeclare(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Local_8cpp_source.html#l01073">Local.cpp:1073</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_ae4ca2261b8b901e415fda7feac5051ea"><div class="ttname"><a href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">llvm::Function::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00397">Function.h:397</a></div></div>
<div class="ttc" id="IntrinsicInst_8h_html"><div class="ttname"><a href="IntrinsicInst_8h.html">IntrinsicInst.h</a></div></div>
<div class="ttc" id="PromoteMemoryToRegister_8cpp_html_a2e8693fb5ac5ae6cc079025486261792"><div class="ttname"><a href="PromoteMemoryToRegister_8cpp.html#a2e8693fb5ac5ae6cc079025486261792">removeLifetimeIntrinsicUsers</a></div><div class="ttdeci">static void removeLifetimeIntrinsicUsers(AllocaInst *AI)</div><div class="ttdef"><b>Definition:</b> <a href="PromoteMemoryToRegister_8cpp_source.html#l00316">PromoteMemoryToRegister.cpp:316</a></div></div>
<div class="ttc" id="namespacellvm_html_a3f2f98c2a67c9e79f58aad9150a62e42"><div class="ttname"><a href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">llvm::dyn_cast</a></div><div class="ttdeci">enable_if_c&lt;!is_simple_type&lt; Y &gt;::value, typename cast_retty&lt; X, const Y &gt;::ret_type &gt;::type dyn_cast(const Y &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="Casting_8h_source.html#l00266">Casting.h:266</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a2f81e0c1fc6554df7ad2eafabf5fc5a5"><div class="ttname"><a href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">llvm::User::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const </div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00108">User.h:108</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap&lt; const Instruction *, unsigned &gt;</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayRef_html_a38ed8cc3c342ad6910e8c869d3e2b9cf"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a38ed8cc3c342ad6910e8c869d3e2b9cf">llvm::ArrayRef::end</a></div><div class="ttdeci">iterator end() const </div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00098">ArrayRef.h:98</a></div></div>
<div class="ttc" id="README-SSE_8txt_html_a63d206a063eefcdf8c318ded97b65020"><div class="ttname"><a href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a></div><div class="ttdeci">This currently compiles esp xmm0 movsd esp eax eax esp ret We should use not the dag combiner This is because dagcombine2 needs to be able to see through the X86ISD::Wrapper which DAGCombine can t really do The code for turning x load into a single vector load is target independent and should be moved to the dag combiner The code for turning x load into a vector load can only handle a direct load from a global or a direct load from the stack It should be generalized to handle any load from P</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00427">README-SSE.txt:427</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html"><div class="ttname"><a href="classllvm_1_1PHINode.html">llvm::PHINode</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01978">Instructions.h:1978</a></div></div>
<div class="ttc" id="Metadata_8h_html"><div class="ttname"><a href="Metadata_8h.html">Metadata.h</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a9b6dd0fc7a648a939e571246045b673e"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">llvm::SmallPtrSet::insert</a></div><div class="ttdeci">bool insert(PtrType Ptr)</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00253">SmallPtrSet.h:253</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_aca229503e4f5c83a187a6a921c625fa8"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">llvm::BasicBlock::getParent</a></div><div class="ttdeci">const Function * getParent() const </div><div class="ttdoc">Return the enclosing method, or null if none. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00116">BasicBlock.h:116</a></div></div>
<div class="ttc" id="classllvm_1_1PredIterator_html"><div class="ttname"><a href="classllvm_1_1PredIterator.html">llvm::PredIterator</a></div><div class="ttdef"><b>Definition:</b> <a href="Support_2CFG_8h_source.html#l00029">Support/CFG.h:29</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a33603355becfb1a050b62aa015c1cc57"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a33603355becfb1a050b62aa015c1cc57">llvm::BasicBlock::front</a></div><div class="ttdeci">const Instruction &amp; front() const </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00205">BasicBlock.h:205</a></div></div>
<div class="ttc" id="namespacellvm_html_afd92ce3a3b5db58abf81981d3fcd95c6"><div class="ttname"><a href="namespacellvm.html#afd92ce3a3b5db58abf81981d3fcd95c6">llvm::PromoteMemToReg</a></div><div class="ttdeci">void PromoteMemToReg(ArrayRef&lt; AllocaInst * &gt; Allocas, DominatorTree &amp;DT, AliasSetTracker *AST=0)</div><div class="ttdoc">Promote the specified list of alloca instructions into scalar registers, inserting PHI nodes as appro...</div><div class="ttdef"><b>Definition:</b> <a href="PromoteMemoryToRegister_8cpp_source.html#l01072">PromoteMemoryToRegister.cpp:1072</a></div></div>
<div class="ttc" id="LLParser_8cpp_html_a33ece1ef8074506a15d7f86eb76dbae6"><div class="ttname"><a href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a></div><div class="ttdeci">F(f)</div></div>
<div class="ttc" id="classllvm_1_1DomTreeNodeBase_html_a40b8345d54ada5dab71ae11d71e89d2f"><div class="ttname"><a href="classllvm_1_1DomTreeNodeBase.html#a40b8345d54ada5dab71ae11d71e89d2f">llvm::DomTreeNodeBase::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00077">Dominators.h:77</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00070">Function.h:70</a></div></div>
<div class="ttc" id="classllvm_1_1LoadInst_html"><div class="ttname"><a href="classllvm_1_1LoadInst.html">llvm::LoadInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00136">Instructions.h:136</a></div></div>
<div class="ttc" id="InstructionSimplify_8h_html"><div class="ttname"><a href="InstructionSimplify_8h.html">InstructionSimplify.h</a></div></div>
<div class="ttc" id="classllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00033">User.h:33</a></div></div>
<div class="ttc" id="Statistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a5023b360abc7a5d1612061fba30003a6"><div class="ttname"><a href="namespacellvm.html#a5023b360abc7a5d1612061fba30003a6">llvm::isAllocaPromotable</a></div><div class="ttdeci">bool isAllocaPromotable(const AllocaInst *AI)</div><div class="ttdoc">Return true if this alloca is legal for promotion. </div><div class="ttdef"><b>Definition:</b> <a href="PromoteMemoryToRegister_8cpp_source.html#l00059">PromoteMemoryToRegister.cpp:59</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0ed5f3ab3c2e4196ee0cffffa080c062"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">llvm::BasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00193">BasicBlock.h:193</a></div></div>
<div class="ttc" id="namespacellvm_html_a39bdaf6372ed2ef16d951fc0f6d54dd4"><div class="ttname"><a href="namespacellvm.html#a39bdaf6372ed2ef16d951fc0f6d54dd4">llvm::swap</a></div><div class="ttdeci">void swap(OwningPtr&lt; T &gt; &amp;a, OwningPtr&lt; T &gt; &amp;b)</div><div class="ttdef"><b>Definition:</b> <a href="OwningPtr_8h_source.html#l00085">OwningPtr.h:85</a></div></div>
<div class="ttc" id="classllvm_1_1DIBuilder_html"><div class="ttname"><a href="classllvm_1_1DIBuilder.html">llvm::DIBuilder</a></div><div class="ttdef"><b>Definition:</b> <a href="DIBuilder_8h_source.html#l00055">DIBuilder.h:55</a></div></div>
<div class="ttc" id="classllvm_1_1DomTreeNodeBase_html_a7519f9ffdda3ef1147e2563200587193"><div class="ttname"><a href="classllvm_1_1DomTreeNodeBase.html#a7519f9ffdda3ef1147e2563200587193">llvm::DomTreeNodeBase::getIDom</a></div><div class="ttdeci">DomTreeNodeBase&lt; NodeT &gt; * getIDom() const </div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00083">Dominators.h:83</a></div></div>
<div class="ttc" id="PromoteMemToReg_8h_html"><div class="ttname"><a href="PromoteMemToReg_8h.html">PromoteMemToReg.h</a></div></div>
<div class="ttc" id="classllvm_1_1value__use__iterator_html"><div class="ttname"><a href="classllvm_1_1value__use__iterator.html">llvm::value_use_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00168">Use.h:168</a></div></div>
<div class="ttc" id="classllvm_1_1Twine_html"><div class="ttname"><a href="classllvm_1_1Twine.html">llvm::Twine</a></div><div class="ttdef"><b>Definition:</b> <a href="Twine_8h_source.html#l00081">Twine.h:81</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a400eaca9881c8dcab97e9f42b1ab1815"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">llvm::SmallVectorImpl::pop_back_val</a></div><div class="ttdeci">T LLVM_ATTRIBUTE_UNUSED_RESULT pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00430">SmallVector.h:430</a></div></div>
<div class="ttc" id="AliasSetTracker_8h_html"><div class="ttname"><a href="AliasSetTracker_8h.html">AliasSetTracker.h</a></div></div>
<div class="ttc" id="STLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1CallingConv_html_a4f861731fc6dbfdccc05af5968d98974"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">llvm::CallingConv::ID</a></div><div class="ttdeci">ID</div><div class="ttdoc">LLVM Calling Convention Representation. </div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00026">CallingConv.h:26</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00031">Instruction.h:31</a></div></div>
<div class="ttc" id="Dominators_8h_html"><div class="ttname"><a href="Dominators_8h.html">Dominators.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a3720211f6e6389ab53734b989bfb6fce"><div class="ttname"><a href="namespacellvm.html#a3720211f6e6389ab53734b989bfb6fce">llvm::succ_begin</a></div><div class="ttdeci">Interval::succ_iterator succ_begin(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00107">Interval.h:107</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a2ced6343b8ad006a757059554bbf9f37"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">llvm::SmallPtrSet::count</a></div><div class="ttdeci">bool count(PtrType Ptr) const </div><div class="ttdoc">count - Return true if the specified pointer is in the set. </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00264">SmallPtrSet.h:264</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorBase_html_a8a8df4d85555c7954a95f86080cd3b64"><div class="ttname"><a href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">llvm::SmallVectorBase::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00056">SmallVector.h:56</a></div></div>
<div class="ttc" id="DebugInfo_8h_html"><div class="ttname"><a href="DebugInfo_8h.html">DebugInfo.h</a></div></div>
<div class="ttc" id="SmallPtrSet_8h_html"><div class="ttname"><a href="SmallPtrSet_8h.html">SmallPtrSet.h</a></div></div>
<div class="ttc" id="classllvm_1_1BitCastInst_html"><div class="ttname"><a href="classllvm_1_1BitCastInst.html">llvm::BitCastInst</a></div><div class="ttdoc">This class represents a no-op cast from one type to another. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03587">Instructions.h:3587</a></div></div>
<div class="ttc" id="classllvm_1_1DomTreeNodeBase_html"><div class="ttname"><a href="classllvm_1_1DomTreeNodeBase.html">llvm::DomTreeNodeBase</a></div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00064">Dominators.h:64</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayRef_html"><div class="ttname"><a href="classllvm_1_1ArrayRef.html">llvm::ArrayRef</a></div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00031">ArrayRef.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1StoreInst_html"><div class="ttname"><a href="classllvm_1_1StoreInst.html">llvm::StoreInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00255">Instructions.h:255</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00303">Value.cpp:303</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a88a5e60837674780a9d812d661897ac5"><div class="ttname"><a href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">llvm::Function::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00395">Function.h:395</a></div></div>
<div class="ttc" id="classllvm_1_1DominatorTree_html"><div class="ttname"><a href="classllvm_1_1DominatorTree.html">llvm::DominatorTree</a></div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00740">Dominators.h:740</a></div></div>
<div class="ttc" id="classllvm_1_1DomTreeNodeBase_html_a96fd2f0087c41942dd2618ff6e1b8640"><div class="ttname"><a href="classllvm_1_1DomTreeNodeBase.html#a96fd2f0087c41942dd2618ff6e1b8640">llvm::DomTreeNodeBase::getBlock</a></div><div class="ttdeci">NodeT * getBlock() const </div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00082">Dominators.h:82</a></div></div>
<div class="ttc" id="namespacellvm_html_a069c4ae2290101bde0f8d6a5074dc72b"><div class="ttname"><a href="namespacellvm.html#a069c4ae2290101bde0f8d6a5074dc72b">llvm::succ_end</a></div><div class="ttdeci">Interval::succ_iterator succ_end(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00110">Interval.h:110</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_aa45f6c0433576e3858a6209a43750ad4"><div class="ttname"><a href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">llvm::PHINode::getNumIncomingValues</a></div><div class="ttdeci">unsigned getNumIncomingValues() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02055">Instructions.h:2055</a></div></div>
<div class="ttc" id="classllvm_1_1GetElementPtrInst_html"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html">llvm::GetElementPtrInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00709">Instructions.h:709</a></div></div>
<div class="ttc" id="classllvm_1_1DomTreeNodeBase_html_a74111c67a831eb30b020ecf063bce406"><div class="ttname"><a href="classllvm_1_1DomTreeNodeBase.html#a74111c67a831eb30b020ecf063bce406">llvm::DomTreeNodeBase::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00078">Dominators.h:78</a></div></div>
<div class="ttc" id="classllvm_1_1SuccIterator_html"><div class="ttname"><a href="classllvm_1_1SuccIterator.html">llvm::SuccIterator&lt; TerminatorInst *, BasicBlock &gt;</a></div></div>
<div class="ttc" id="classllvm_1_1AliasSetTracker_html"><div class="ttname"><a href="classllvm_1_1AliasSetTracker.html">llvm::AliasSetTracker</a></div><div class="ttdef"><b>Definition:</b> <a href="AliasSetTracker_8h_source.html#l00280">AliasSetTracker.h:280</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_aac0ea55010b7b1a301e65a0baea057aa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">llvm::SmallVectorImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00396">SmallVector.h:396</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00072">BasicBlock.h:72</a></div></div>
<div class="ttc" id="Support_2CFG_8h_html"><div class="ttname"><a href="Support_2CFG_8h.html">CFG.h</a></div></div>
<div class="ttc" id="Constants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a9d0a7040918ba81ef34046fd474cee10"><div class="ttname"><a href="namespacellvm.html#a9d0a7040918ba81ef34046fd474cee10">llvm::onlyUsedByLifetimeMarkers</a></div><div class="ttdeci">bool onlyUsedByLifetimeMarkers(const Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="ValueTracking_8cpp_source.html#l01961">ValueTracking.cpp:1961</a></div></div>
<div class="ttc" id="namespacellvm_html_a7e108932dc3da5294aed99a353aac9c4"><div class="ttname"><a href="namespacellvm.html#a7e108932dc3da5294aed99a353aac9c4">llvm::pred_begin</a></div><div class="ttdeci">Interval::pred_iterator pred_begin(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00117">Interval.h:117</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_afb5e83bf5123ff7c51058eb0ebebcdc6"><div class="ttname"><a href="classllvm_1_1PHINode.html#afb5e83bf5123ff7c51058eb0ebebcdc6">llvm::PHINode::Create</a></div><div class="ttdeci">static PHINode * Create(Type *Ty, unsigned NumReservedValues, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02013">Instructions.h:2013</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a4c25b6c00c4867281779c81ab64d2081"><div class="ttname"><a href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">llvm::PHINode::getIncomingBlock</a></div><div class="ttdeci">BasicBlock * getIncomingBlock(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02074">Instructions.h:2074</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a531d11ba36ed48d86057d507cc8d5567"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a531d11ba36ed48d86057d507cc8d5567">llvm::BasicBlock::getInstList</a></div><div class="ttdeci">const InstListType &amp; getInstList() const </div><div class="ttdoc">Return the underlying instruction list container. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00214">BasicBlock.h:214</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayRef_html_a836367b39ed630bf14db99923c22740e"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a836367b39ed630bf14db99923c22740e">llvm::ArrayRef::begin</a></div><div class="ttdeci">iterator begin() const </div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00097">ArrayRef.h:97</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a321e37d79af8b4287f8a1dcf9aff9c01"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">llvm::DenseMapBase::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00057">DenseMap.h:57</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a997ff6a1758bf732b9b263fc61011644"><div class="ttname"><a href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">llvm::User::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00088">User.h:88</a></div></div>
<div class="ttc" id="namespacellvm_html_a5eeaf08e96168c2cac8960f87f0ef360"><div class="ttname"><a href="namespacellvm.html#a5eeaf08e96168c2cac8960f87f0ef360">llvm::pred_end</a></div><div class="ttdeci">Interval::pred_iterator pred_end(Interval *I)</div><div class="ttdef"><b>Definition:</b> <a href="Interval_8h_source.html#l00120">Interval.h:120</a></div></div>
<div class="ttc" id="ArrayRef_8h_html"><div class="ttname"><a href="ArrayRef_8h.html">ArrayRef.h</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayRef_html_a3aa55c9d9145cd6b3b21c466b18abd80"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#a3aa55c9d9145cd6b3b21c466b18abd80">llvm::ArrayRef::empty</a></div><div class="ttdeci">bool empty() const </div><div class="ttdoc">empty - Check if the array is empty. </div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00104">ArrayRef.h:104</a></div></div>
<div class="ttc" id="DenseMap_8h_html"><div class="ttname"><a href="DenseMap_8h.html">DenseMap.h</a></div></div>
<div class="ttc" id="classllvm_1_1DominatorTree_html_a6fe9272dc67fe2ff4cafc33b895c4a6c"><div class="ttname"><a href="classllvm_1_1DominatorTree.html#a6fe9272dc67fe2ff4cafc33b895c4a6c">llvm::DominatorTree::dominates</a></div><div class="ttdeci">bool dominates(const DomTreeNode *A, const DomTreeNode *B) const </div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00801">Dominators.h:801</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a2eba483f5cc876e824aa6c085736086b"><div class="ttname"><a href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">llvm::Type::isPointerTy</a></div><div class="ttdeci">bool isPointerTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00220">Type.h:220</a></div></div>
<div class="ttc" id="classllvm_1_1UndefValue_html_a4ae5ff22b700a42bcc5d889233721335"><div class="ttname"><a href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">llvm::UndefValue::get</a></div><div class="ttdeci">static UndefValue * get(Type *T)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01334">Constants.cpp:1334</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a18c110c35e9133222a37b28d30f8a90f"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a18c110c35e9133222a37b28d30f8a90f">llvm::SmallVectorImpl::erase</a></div><div class="ttdeci">iterator erase(iterator I)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00478">SmallVector.h:478</a></div></div>
<div class="ttc" id="namespacellvm_html_a50f8f41fccbea466816345520e9bfabb"><div class="ttname"><a href="namespacellvm.html#a50f8f41fccbea466816345520e9bfabb">llvm::SimplifyInstruction</a></div><div class="ttdeci">Value * SimplifyInstruction(Instruction *I, const DataLayout *TD=0, const TargetLibraryInfo *TLI=0, const DominatorTree *DT=0)</div><div class="ttdef"><b>Definition:</b> <a href="InstructionSimplify_8cpp_source.html#l03036">InstructionSimplify.cpp:3036</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_af85a4828b6b5a8de7fc0a55cc0e5b52f"><div class="ttname"><a href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">llvm::Value::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdoc">All values hold a context through their type. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00517">Value.cpp:517</a></div></div>
<div class="ttc" id="classT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a7fe9ccd4893f4e2caa826126c09545ea"><div class="ttname"><a href="classllvm_1_1Type.html#a7fe9ccd4893f4e2caa826126c09545ea">llvm::Type::getInt8PtrTy</a></div><div class="ttdeci">static PointerType * getInt8PtrTy(LLVMContext &amp;C, unsigned AS=0)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00284">Type.cpp:284</a></div></div>
<div class="ttc" id="classllvm_1_1iplist_html_a5c2aa38108db7a66ac5e8da547f64ad7"><div class="ttname"><a href="classllvm_1_1iplist.html#a5c2aa38108db7a66ac5e8da547f64ad7">llvm::iplist::erase</a></div><div class="ttdeci">iterator erase(iterator where)</div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00465">ilist.h:465</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayRef_html_ad863a11c0d0943aad3d7a51d02711c4e"><div class="ttname"><a href="classllvm_1_1ArrayRef.html#ad863a11c0d0943aad3d7a51d02711c4e">llvm::ArrayRef::back</a></div><div class="ttdeci">const T &amp; back() const </div><div class="ttdoc">back - Get the last element. </div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00118">ArrayRef.h:118</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSetIterator_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSetIterator.html">llvm::SmallPtrSetIterator</a></div><div class="ttdoc">SmallPtrSetIterator - This implements a const_iterator for SmallPtrSet. </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00174">SmallPtrSet.h:174</a></div></div>
<div class="ttc" id="classllvm_1_1ilist__iterator_html"><div class="ttname"><a href="classllvm_1_1ilist__iterator.html">llvm::ilist_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00050">ilist.h:50</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html">llvm::SmallPtrSet</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00236">SmallPtrSet.h:236</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00029">Target/README.txt:29</a></div></div>
<div class="ttc" id="namespacellvm_html_ab3d313ef442aae5b5bebf03c923506d0"><div class="ttname"><a href="namespacellvm.html#ab3d313ef442aae5b5bebf03c923506d0">llvm::ConvertDebugDeclareToDebugValue</a></div><div class="ttdeci">bool ConvertDebugDeclareToDebugValue(DbgDeclareInst *DDI, StoreInst *SI, DIBuilder &amp;Builder)</div><div class="ttdef"><b>Definition:</b> <a href="Local_8cpp_source.html#l00971">Local.cpp:971</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00880">SmallVector.h:880</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a0cf3748dba54f931bb1241ae4adc76bc"><div class="ttname"><a href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00111">Value.h:111</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a269c7b8adcd29645a4f901196fc08806"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a269c7b8adcd29645a4f901196fc08806">llvm::DenseMapBase::erase</a></div><div class="ttdeci">bool erase(const KeyT &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00190">DenseMap.h:190</a></div></div>
<div class="ttc" id="classllvm_1_1DominatorTree_html_a436392aa0ad025c20485feae48521c30"><div class="ttname"><a href="classllvm_1_1DominatorTree.html#a436392aa0ad025c20485feae48521c30">llvm::DominatorTree::getRoot</a></div><div class="ttdeci">BasicBlock * getRoot() const </div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00764">Dominators.h:764</a></div></div>
<div class="ttc" id="PromoteMemoryToRegister_8cpp_html_abe014602428675793f21d1dd21ef6d30"><div class="ttname"><a href="PromoteMemoryToRegister_8cpp.html#abe014602428675793f21d1dd21ef6d30">STATISTIC</a></div><div class="ttdeci">STATISTIC(NumLocalPromoted,&quot;Number of alloca's promoted within one block&quot;)</div></div>
<div class="ttc" id="namespacestd_html_ab8424022895aee3e366fb9a32f2883cb"><div class="ttname"><a href="namespacestd.html#ab8424022895aee3e366fb9a32f2883cb">std::swap</a></div><div class="ttdeci">void swap(llvm::BitVector &amp;LHS, llvm::BitVector &amp;RHS)</div><div class="ttdoc">Implement std::swap in terms of BitVector swap. </div><div class="ttdef"><b>Definition:</b> <a href="BitVector_8h_source.html#l00591">BitVector.h:591</a></div></div>
<div class="ttc" id="CodeGen_2README_8txt_html_a09776db24cf586ec9f1e18f3bae14099"><div class="ttname"><a href="CodeGen_2README_8txt.html#a09776db24cf586ec9f1e18f3bae14099">BB</a></div><div class="ttdeci">Common register allocation spilling lr str ldr sxth r3 ldr mla r4 can lr mov lr str ldr sxth r3 mla r4 and then merge mul and lr str ldr sxth r3 mla r4 It also increase the likelihood the store may become dead bb27 Successors according to LLVM BB</div><div class="ttdef"><b>Definition:</b> <a href="CodeGen_2README_8txt_source.html#l00036">CodeGen/README.txt:36</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a5ac211f24970dea81fa9a7118a8ce36b"><div class="ttname"><a href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">llvm::Instruction::use_back</a></div><div class="ttdeci">Instruction * use_back()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00049">Instruction.h:49</a></div></div>
<div class="ttc" id="Function_8h_html"><div class="ttname"><a href="Function_8h.html">Function.h</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a8a045d250952c0867382a9840ee18fdf"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">llvm::SmallVectorTemplateCommon&lt; T &gt;::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00112">SmallVector.h:112</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a413abcab8dbc3900fc2fde96a5d8fca6"><div class="ttname"><a href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">llvm::Value::use_begin</a></div><div class="ttdeci">use_iterator use_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00150">Value.h:150</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a5d4ca65de6e43d76586fbdd89bf930d2"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a5d4ca65de6e43d76586fbdd89bf930d2">llvm::Intrinsic::getName</a></div><div class="ttdeci">std::string getName(ID id, ArrayRef&lt; Type * &gt; Tys=None)</div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00400">Function.cpp:400</a></div></div>
<div class="ttc" id="MD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00054">MD5.cpp:54</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a7f055d0b03ebf1d6a5988b178e9b8f4f"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a7f055d0b03ebf1d6a5988b178e9b8f4f">llvm::SmallPtrSet::end</a></div><div class="ttdeci">iterator end() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00279">SmallPtrSet.h:279</a></div></div>
<div class="ttc" id="DIBuilder_8h_html"><div class="ttname"><a href="DIBuilder_8h.html">DIBuilder.h</a></div></div>
<div class="ttc" id="ValueTracking_8h_html"><div class="ttname"><a href="ValueTracking_8h.html">ValueTracking.h</a></div></div>
<div class="ttc" id="PromoteMemoryToRegister_8cpp_html_aeeeb38b5af7c94ee5e59feafb87ad18c"><div class="ttname"><a href="PromoteMemoryToRegister_8cpp.html#aeeeb38b5af7c94ee5e59feafb87ad18c">rewriteSingleStoreAlloca</a></div><div class="ttdeci">static bool rewriteSingleStoreAlloca(AllocaInst *AI, AllocaInfo &amp;Info, LargeBlockInfo &amp;LBI, DominatorTree &amp;DT, AliasSetTracker *AST)</div><div class="ttdoc">Rewrite as many loads as possible given a single store. </div><div class="ttdef"><b>Definition:</b> <a href="PromoteMemoryToRegister_8cpp_source.html#l00350">PromoteMemoryToRegister.cpp:350</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ac38c53f76ef532f91f1666c8a87370e9"><div class="ttname"><a href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">llvm::Value::use_empty</a></div><div class="ttdeci">bool use_empty() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00149">Value.h:149</a></div></div>
<div class="ttc" id="Local_8h_html"><div class="ttname"><a href="Local_8h.html">Local.h</a></div></div>
<div class="ttc" id="classllvm_1_1DomTreeNodeBase_html_a4d2422d22434aa1008a519a143364715"><div class="ttname"><a href="classllvm_1_1DomTreeNodeBase.html#a4d2422d22434aa1008a519a143364715">llvm::DomTreeNodeBase::iterator</a></div><div class="ttdeci">std::vector&lt; DomTreeNodeBase&lt; NodeT &gt; * &gt;::iterator iterator</div><div class="ttdef"><b>Definition:</b> <a href="Dominators_8h_source.html#l00073">Dominators.h:73</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_a9e1fc23a17e97d2d1732e753ae9251ac"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">llvm::GlobalValue::getParent</a></div><div class="ttdeci">Module * getParent()</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00286">GlobalValue.h:286</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00066">Value.h:66</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a669d599eeacffd29a09050e2af83bf67"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">llvm::SmallPtrSet::begin</a></div><div class="ttdeci">iterator begin() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00276">SmallPtrSet.h:276</a></div></div>
<div class="ttc" id="SmallVector_8h_html"><div class="ttname"><a href="SmallVector_8h.html">SmallVector.h</a></div></div>
<div class="ttc" id="namespacellvm_html_a7923e3e207de8bc1d0d6a5091316ddde"><div class="ttname"><a href="namespacellvm.html#a7923e3e207de8bc1d0d6a5091316ddde">llvm::prior</a></div><div class="ttdeci">ItTy prior(ItTy it, Dist n)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00167">STLExtras.h:167</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a21cf94357e53cd1069aba475266fdb63"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a21cf94357e53cd1069aba475266fdb63">llvm::DenseMapBase::find</a></div><div class="ttdeci">iterator find(const KeyT &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00108">DenseMap.h:108</a></div></div>
<div class="ttc" id="Target_2ARM_2README_8txt_html_a90cca76dd78688687e0d697679dbc799"><div class="ttname"><a href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional ldr LCPI1_0 ldr ldr tst movne lsr ldr LCPI1_1 and r0 bx lr it saves an instruction and a register It might be profitable to cse MOVi16 if there are lots of bit immediates with the same bottom half Robert Muth started working on an alternate jump table implementation that does not put the tables in line in the text This is more like the llvm default jump table implementation This might be useful sometime Several revisions of patches are on the mailing beginning while CMP sets them like a subtract Therefore to be able to use CMN for comparisons other than the Z we ll need additional logic to reverse the conditionals associated with the comparison Perhaps a pseudo instruction for the with a post codegen pass to clean up and handle the condition codes See PR5694 for testcase Given the following on int B</div><div class="ttdef"><b>Definition:</b> <a href="Target_2ARM_2README_8txt_source.html#l00592">Target/ARM/README.txt:592</a></div></div>
<div class="ttc" id="classllvm_1_1DbgDeclareInst_html"><div class="ttname"><a href="classllvm_1_1DbgDeclareInst.html">llvm::DbgDeclareInst</a></div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00081">IntrinsicInst.h:81</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a6467bd6bb128c8b69a478548fc17351c"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a6467bd6bb128c8b69a478548fc17351c">llvm::DenseMapBase::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00078">DenseMap.h:78</a></div></div>
<div class="ttc" id="structllvm_1_1less__first_html"><div class="ttname"><a href="structllvm_1_1less__first.html">llvm::less_first</a></div><div class="ttdoc">Function object to check whether the first component of a std::pair compares less than the first comp...</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00222">STLExtras.h:222</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a9cd49851904f15060edb782ef4dd1b2d"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00052">Instruction.h:52</a></div></div>
<div class="ttc" id="classllvm_1_1AliasSetTracker_html_a8e27fd723c6fe8b3595d4d006acb39ea"><div class="ttname"><a href="classllvm_1_1AliasSetTracker.html#a8e27fd723c6fe8b3595d4d006acb39ea">llvm::AliasSetTracker::deleteValue</a></div><div class="ttdeci">void deleteValue(Value *PtrVal)</div><div class="ttdef"><b>Definition:</b> <a href="AliasSetTracker_8cpp_source.html#l00484">AliasSetTracker.cpp:484</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a73349916f7e54a6b988a3646c7a02e90ae365354e47542c51f9bd46e329e3323e"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ae365354e47542c51f9bd46e329e3323e">llvm::Intrinsic::lifetime_start</a></div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l01255">Intrinsics.h:1255</a></div></div>
<div class="ttc" id="classllvm_1_1IntrinsicInst_html"><div class="ttname"><a href="classllvm_1_1IntrinsicInst.html">llvm::IntrinsicInst</a></div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00036">IntrinsicInst.h:36</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_af5c7041df3ad5edffe5da17b5264c1fc"><div class="ttname"><a href="classllvm_1_1Type.html#af5c7041df3ad5edffe5da17b5264c1fc">llvm::Type::isVoidTy</a></div><div class="ttdeci">bool isVoidTy() const </div><div class="ttdoc">isVoidTy - Return true if this is &amp;#39;void&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00140">Type.h:140</a></div></div>
<div class="ttc" id="classllvm_1_1AllocaInst_html"><div class="ttname"><a href="classllvm_1_1AllocaInst.html">llvm::AllocaInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00058">Instructions.h:58</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<p class="footer">
Generated on Sat Nov 10 2018 23:00:54 for <a href="http://llvm.org/">LLVM</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.8.11</a><br>
Copyright &copy; 2003-2013 University of Illinois at Urbana-Champaign.
All Rights Reserved.</p>
<hr>
<!--#include virtual="/attrib.incl" -->
</body>
</html>
