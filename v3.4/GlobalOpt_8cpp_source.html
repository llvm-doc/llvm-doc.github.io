<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="LLVM,Low Level Virtual Machine,C++,doxygen,API,documentation"/>
<meta name="description" content="C++ source code API documentation for LLVM."/>
<title>LLVM: GlobalOpt.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">LLVM API Documentation</p>
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('GlobalOpt_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">GlobalOpt.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="GlobalOpt_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===- GlobalOpt.cpp - Optimize Global Variables --------------------------===//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                     The LLVM Compiler Infrastructure</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is distributed under the University of Illinois Open Source</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License. See LICENSE.TXT for details.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// This pass transforms simple global variables that never have their address</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// taken.  If obviously true, it marks read/write globals as constant, deletes</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// variables only stored to, etc.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">   16</a></span>&#160;<span class="preprocessor">#define DEBUG_TYPE &quot;globalopt&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Transforms_2IPO_8h.html">llvm/Transforms/IPO.h</a>&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DenseMap_8h.html">llvm/ADT/DenseMap.h</a>&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="STLExtras_8h.html">llvm/ADT/STLExtras.h</a>&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallPtrSet_8h.html">llvm/ADT/SmallPtrSet.h</a>&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SmallVector_8h.html">llvm/ADT/SmallVector.h</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Statistic_8h.html">llvm/ADT/Statistic.h</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ConstantFolding_8h.html">llvm/Analysis/ConstantFolding.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MemoryBuiltins_8h.html">llvm/Analysis/MemoryBuiltins.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CallingConv_8h.html">llvm/IR/CallingConv.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">llvm/IR/Constants.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DataLayout_8h.html">llvm/IR/DataLayout.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DerivedTypes_8h.html">llvm/IR/DerivedTypes.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Instructions_8h.html">llvm/IR/Instructions.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="IntrinsicInst_8h.html">llvm/IR/IntrinsicInst.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Module_8h.html">llvm/IR/Module.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Operator_8h.html">llvm/IR/Operator.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Pass_8h.html">llvm/Pass.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CallSite_8h.html">llvm/Support/CallSite.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Debug_8h.html">llvm/Support/Debug.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ErrorHandling_8h.html">llvm/Support/ErrorHandling.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GetElementPtrTypeIterator_8h.html">llvm/Support/GetElementPtrTypeIterator.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="MathExtras_8h.html">llvm/Support/MathExtras.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="raw__ostream_8h.html">llvm/Support/raw_ostream.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ValueHandle_8h.html">llvm/Support/ValueHandle.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="TargetLibraryInfo_8h.html">llvm/Target/TargetLibraryInfo.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GlobalStatus_8h.html">llvm/Transforms/Utils/GlobalStatus.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ModuleUtils_8h.html">llvm/Transforms/Utils/ModuleUtils.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumMarked    , <span class="stringliteral">&quot;Number of globals marked constant&quot;</span>);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumUnnamed   , <span class="stringliteral">&quot;Number of globals marked unnamed_addr&quot;</span>);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumSRA       , <span class="stringliteral">&quot;Number of aggregate globals broken into scalars&quot;</span>);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumHeapSRA   , <span class="stringliteral">&quot;Number of heap objects SRA&#39;d&quot;</span>);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumSubstitute,<span class="stringliteral">&quot;Number of globals with initializers stored into them&quot;</span>);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumDeleted   , <span class="stringliteral">&quot;Number of globals deleted&quot;</span>);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumFnDeleted , <span class="stringliteral">&quot;Number of functions deleted&quot;</span>);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumGlobUses  , <span class="stringliteral">&quot;Number of global uses devirtualized&quot;</span>);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumLocalized , <span class="stringliteral">&quot;Number of globals localized&quot;</span>);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumShrunkToBool  , <span class="stringliteral">&quot;Number of global vars shrunk to booleans&quot;</span>);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumFastCallFns   , <span class="stringliteral">&quot;Number of functions converted to fastcc&quot;</span>);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumCtorsEvaluated, <span class="stringliteral">&quot;Number of static ctors evaluated&quot;</span>);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumNestRemoved   , <span class="stringliteral">&quot;Number of nest attributes removed&quot;</span>);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumAliasesResolved, <span class="stringliteral">&quot;Number of global aliases resolved&quot;</span>);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumAliasesRemoved, <span class="stringliteral">&quot;Number of global aliases eliminated&quot;</span>);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a>(NumCXXDtorsRemoved, <span class="stringliteral">&quot;Number of global C++ destructors removed&quot;</span>);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keyword">struct </span>GlobalOpt : <span class="keyword">public</span> <a class="code" href="classllvm_1_1ModulePass.html">ModulePass</a> {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> getAnalysisUsage(<a class="code" href="classllvm_1_1AnalysisUsage.html">AnalysisUsage</a> &amp;AU)<span class="keyword"> const </span>{</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      AU.<a class="code" href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">addRequired</a>&lt;<a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a>&gt;();</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    }</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">ID</a>; <span class="comment">// Pass identification, replacement for typeid</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    GlobalOpt() : <a class="code" href="classllvm_1_1ModulePass.html">ModulePass</a>(ID) {</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      <a class="code" href="namespacellvm.html#a0926b34ae91e5bbb097a69c71472cc8d">initializeGlobalOptPass</a>(*<a class="code" href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    }</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordtype">bool</span> runOnModule(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="keyword">private</span>:</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *FindGlobalCtors(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordtype">bool</span> OptimizeFunctions(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordtype">bool</span> OptimizeGlobalVars(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordtype">bool</span> OptimizeGlobalAliases(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordtype">bool</span> OptimizeGlobalCtorsList(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *&amp;GCL);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordtype">bool</span> ProcessGlobal(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV,<a class="code" href="classllvm_1_1ilist__iterator.html">Module::global_iterator</a> &amp;GVI);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordtype">bool</span> ProcessInternalGlobal(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV,<a class="code" href="classllvm_1_1ilist__iterator.html">Module::global_iterator</a> &amp;GVI,</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                               <span class="keyword">const</span> <a class="code" href="structllvm_1_1GlobalStatus.html">GlobalStatus</a> &amp;<a class="code" href="namespacellvm_1_1X86II.html#a97dc14052814702ba0e2b14fb14dd02dacdc4d0fa74813b50797e25bab4febe70">GS</a>);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordtype">bool</span> OptimizeEmptyGlobalCXXDtors(<a class="code" href="classllvm_1_1Function.html">Function</a> *CXAAtExitFn);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  };</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;}</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">GlobalOpt::ID</a> = 0;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#ae7c164feceeaa7db7809c9c82c4b7568">INITIALIZE_PASS_BEGIN</a>(GlobalOpt, <span class="stringliteral">&quot;globalopt&quot;</span>,</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                <span class="stringliteral">&quot;Global Variable Optimizer&quot;</span>, <span class="keyword">false</span>, <span class="keyword">false</span>)</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<a class="code" href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a>(<a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a>)</div><div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a23fd01d07baea6623f8b2019dd8f2f21">   96</a></span>&#160;<a class="code" href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a>(GlobalOpt, &quot;<a class="code" href="GlobalOpt_8cpp.html#a549419dff8d79e0f9e6f6e76770ef251">globalopt</a>&quot;,</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                &quot;Global Variable <a class="code" href="GlobalOpt_8cpp.html#a23fd01d07baea6623f8b2019dd8f2f21">Optimizer</a>&quot;, <a class="code" href="namespacefalse.html">false</a>, false)</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="namespacellvm.html#ab3bf4dcd8619f4349d7bc20ad1c0fccc">   99</a></span>&#160;<a class="code" href="classllvm_1_1ModulePass.html">ModulePass</a> *<a class="code" href="namespacellvm.html">llvm</a>::<a class="code" href="namespacellvm.html#ab3bf4dcd8619f4349d7bc20ad1c0fccc">createGlobalOptimizerPass</a>() { <span class="keywordflow">return</span> <span class="keyword">new</span> GlobalOpt(); }</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">/// isLeakCheckerRoot - Is this global variable possibly used by a leak checker</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">/// as a root?  If so, we might not really want to eliminate the stores to it.</span></div><div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#ace2885fc42e68606f270bfd3180d5f26">  103</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#ace2885fc42e68606f270bfd3180d5f26">isLeakCheckerRoot</a>(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV) {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">// A global variable is a root if it is a pointer, or could plausibly contain</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">// a pointer.  There are two challenges; one is that we could have a struct</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="comment">// the has an inner member which is a pointer.  We recurse through the type to</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="comment">// detect these (up to a point).  The other is that we may actually be a union</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">// of a pointer and another type, and so our LLVM type is an integer which</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="comment">// gets converted into a pointer, or our type is an [i8 x #] with a pointer</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="comment">// potentially contained here.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keywordflow">if</span> (GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a2d8e04fc14cc2b3c6005d3baa8562639">hasPrivateLinkage</a>())</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Type *, 4&gt;</a> Types;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  Types.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(cast&lt;PointerType&gt;(GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>())-&gt;getElementType());</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordtype">unsigned</span> Limit = 20;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = Types.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">pop_back_val</a>();</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">switch</span> (Ty-&gt;<a class="code" href="classllvm_1_1Type.html#a8e08dfcb75ff1b4b38c352bc0d9db223">getTypeID</a>()) {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1Type.html#a5e9e1c0dd93557be1b4ad72860f3cbdaae68df805bc15b023748c2a78b80563ff">Type::PointerTyID</a>: <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1Type.html#a5e9e1c0dd93557be1b4ad72860f3cbdaa2989d3024a84b4dda9d77419b1648554">Type::ArrayTyID</a>:</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1Type.html#a5e9e1c0dd93557be1b4ad72860f3cbdaa1f19f6d0e474b9dce2d0574e12baec29">Type::VectorTyID</a>: {</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <a class="code" href="classllvm_1_1SequentialType.html">SequentialType</a> *STy = cast&lt;SequentialType&gt;(Ty);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        Types.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(STy-&gt;<a class="code" href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">getElementType</a>());</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      }</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1Type.html#a5e9e1c0dd93557be1b4ad72860f3cbdaa812a573d23fbb37aacd025e2a0588156">Type::StructTyID</a>: {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <a class="code" href="classllvm_1_1StructType.html">StructType</a> *STy = cast&lt;StructType&gt;(Ty);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="keywordflow">if</span> (STy-&gt;<a class="code" href="classllvm_1_1StructType.html#a47f8a52ece53e2e1ef08ab2d58f93c88">isOpaque</a>()) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1StructType.html#a93ee26a67ca79e4ba796dcccb55e8c19">StructType::element_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = STy-&gt;<a class="code" href="classllvm_1_1StructType.html#a8d85840dbf6b7eff52721aafae9df0f6">element_begin</a>(),</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                 E = STy-&gt;<a class="code" href="classllvm_1_1StructType.html#a1a716e87e6d2a1de3fcfd0682ed3fd1f">element_end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;          <a class="code" href="classllvm_1_1Type.html">Type</a> *InnerTy = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;          <span class="keywordflow">if</span> (isa&lt;PointerType&gt;(InnerTy)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;          <span class="keywordflow">if</span> (isa&lt;CompositeType&gt;(InnerTy))</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            Types.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(InnerTy);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    }</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">if</span> (--Limit == 0) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  } <span class="keywordflow">while</span> (!Types.<a class="code" href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">empty</a>());</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">/// Given a value that is stored to a global but never read, determine whether</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">/// it&#39;s safe to remove the store and the chain of computation that feeds the</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">/// store.</span></div><div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#ae32894671894c23afc705c218f76ea03">  151</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#ae32894671894c23afc705c218f76ea03">IsSafeComputationToRemove</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI) {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">if</span> (isa&lt;Constant&gt;(V))</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> (!V-&gt;<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>())</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">if</span> (isa&lt;LoadInst&gt;(V) || isa&lt;InvokeInst&gt;(V) || isa&lt;Argument&gt;(V) ||</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        isa&lt;GlobalValue&gt;(V))</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a455d82c49557ac1d6c8da8e8d86a94b5">isAllocationFn</a>(V, TLI))</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = cast&lt;Instruction&gt;(V);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">if</span> (I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a573063aad4c101462893d0490d867524">mayHaveSideEffects</a>())</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEP = dyn_cast&lt;GetElementPtrInst&gt;(I)) {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <span class="keywordflow">if</span> (!GEP-&gt;hasAllConstantIndices())</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (I-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>() != 1) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    }</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    V = I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  } <span class="keywordflow">while</span> (1);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;}</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">/// CleanupPointerRootUsers - This GV is a pointer root.  Loop over all users</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">/// of the global and clean up any that obviously don&#39;t assign the global a</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">/// value that isn&#39;t dynamically allocated.</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a60254fdb6128ce676768cdc8f7227433">  181</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a60254fdb6128ce676768cdc8f7227433">CleanupPointerRootUsers</a>(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV,</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="comment">// A brief explanation of leak checkers.  The goal is to find bugs where</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="comment">// pointers are forgotten, causing an accumulating growth in memory</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="comment">// usage over time.  The common strategy for leak checkers is to whitelist the</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="comment">// memory pointed to by globals at exit.  This is popular because it also</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="comment">// solves another problem where the main thread of a C++ program may shut down</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="comment">// before other threads that are still expecting to use those globals.  To</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="comment">// handle that case, we expect the program may create a singleton and never</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="comment">// destroy it.</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="comment">// If Dead[n].first is the only use of a malloc result, we can delete its</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="comment">// chain of computation and the store to the global in Dead[n].second.</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;std::pair&lt;Instruction *, Instruction *&gt;</a>, 32&gt; <a class="code" href="namespacellvm_1_1RegState.html#a079b254e749130fbe5d740f314ca92daa2fee1a7db4e84247a193a9af1f907013">Dead</a>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="comment">// Constants can&#39;t be pointers to dynamically allocated memory.</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = GV-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;       UI != E;) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <a class="code" href="classllvm_1_1User.html">User</a> *U = *UI++;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(U)) {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *V = SI-&gt;getValueOperand();</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="keywordflow">if</span> (isa&lt;Constant&gt;(V)) {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        SI-&gt;eraseFromParent();</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(V)) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse())</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;          Dead.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, SI));</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MemSetInst.html">MemSetInst</a> *MSI = dyn_cast&lt;MemSetInst&gt;(U)) {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">if</span> (isa&lt;Constant&gt;(MSI-&gt;getValue())) {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        MSI-&gt;eraseFromParent();</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(MSI-&gt;getValue())) {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse())</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;          Dead.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, MSI));</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MemTransferInst.html">MemTransferInst</a> *MTI = dyn_cast&lt;MemTransferInst&gt;(U)) {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *MemSrc = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>&gt;(MTI-&gt;getSource());</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <span class="keywordflow">if</span> (MemSrc &amp;&amp; MemSrc-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#a1500a3fe55cf38153aa1e0fbe7284e05">isConstant</a>()) {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        MTI-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(MemSrc)) {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse())</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;          Dead.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(std::make_pair(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, MTI));</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(U)) {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      <span class="keywordflow">if</span> (CE-&gt;use_empty()) {</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        CE-&gt;destroyConstant();</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      }</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;Constant&gt;(U)) {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a6b369f94d5ebc6e107a988f17b42b3eb">isSafeToDestroyConstant</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>)) {</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;destroyConstant();</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="comment">// This could have invalidated UI, start over from scratch.</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        Dead.<a class="code" href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <a class="code" href="GlobalOpt_8cpp.html#a60254fdb6128ce676768cdc8f7227433">CleanupPointerRootUsers</a>(GV, TLI);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Dead.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="GlobalOpt_8cpp.html#ae32894671894c23afc705c218f76ea03">IsSafeComputationToRemove</a>(Dead[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].first, TLI)) {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      Dead[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].second-&gt;eraseFromParent();</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Dead[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>].first;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keywordflow">do</span> {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a455d82c49557ac1d6c8da8e8d86a94b5">isAllocationFn</a>(I, TLI))</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *J = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(I-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0));</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keywordflow">if</span> (!J)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        I = J;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      } <span class="keywordflow">while</span> (1);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      I-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;}</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">/// CleanupConstantGlobalUsers - We just marked GV constant.  Loop over all</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">/// users of the global, cleaning up the obvious ones.  This is largely just a</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">/// quick scan over the use list to clean up the easy and obvious cruft.  This</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">/// returns true if it made a change.</span></div><div class="line"><a name="l00268"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a4c9b89709068175aa041524ee4bdc61f">  268</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a4c9b89709068175aa041524ee4bdc61f">CleanupConstantGlobalUsers</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="classllvm_1_1Init.html">Init</a>,</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                                       <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD, <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI) {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="comment">// Note that we need to use a weak value handle for the worklist items. When</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="comment">// we delete a constant array, we may also be holding pointer to one of its</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="comment">// elements (or an element of one of its elements if we&#39;re dealing with an</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="comment">// array of arrays) in the worklist.</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;WeakVH, 8&gt;</a> WorkList(V-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), V-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>());</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="keywordflow">while</span> (!WorkList.empty()) {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *UV = WorkList.pop_back_val();</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">if</span> (!UV)</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="classllvm_1_1User.html">User</a> *U = cast&lt;User&gt;(UV);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(U)) {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <span class="keywordflow">if</span> (Init) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="comment">// Replace the load with the initializer.</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        LI-&gt;replaceAllUsesWith(Init);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        LI-&gt;eraseFromParent();</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(U)) {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="comment">// Store must be unreachable or storing Init into the global.</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      SI-&gt;eraseFromParent();</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(U)) {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keywordflow">if</span> (CE-&gt;getOpcode() == Instruction::GetElementPtr) {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <a class="code" href="classllvm_1_1Constant.html">Constant</a> *SubInit = 0;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordflow">if</span> (Init)</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;          SubInit = <a class="code" href="namespacellvm.html#af2c14d2f82bff2130daf86f4e22ae14d">ConstantFoldLoadThroughGEPConstantExpr</a>(Init, CE);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        Changed |= <a class="code" href="GlobalOpt_8cpp.html#a4c9b89709068175aa041524ee4bdc61f">CleanupConstantGlobalUsers</a>(CE, SubInit, TD, TLI);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CE-&gt;getOpcode() == Instruction::BitCast &amp;&amp;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                 CE-&gt;getType()-&gt;isPointerTy()) {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="comment">// Pointer cast, delete any stores and memsets to the global.</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        Changed |= <a class="code" href="GlobalOpt_8cpp.html#a4c9b89709068175aa041524ee4bdc61f">CleanupConstantGlobalUsers</a>(CE, 0, TD, TLI);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="keywordflow">if</span> (CE-&gt;use_empty()) {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        CE-&gt;destroyConstant();</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEP = dyn_cast&lt;GetElementPtrInst&gt;(U)) {</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="comment">// Do not transform &quot;gepinst (gep constexpr (GV))&quot; here, because forming</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="comment">// &quot;gepconstexpr (gep constexpr (GV))&quot; will cause the two gep&#39;s to fold</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="comment">// and will invalidate our notion of what Init is.</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *SubInit = 0;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;ConstantExpr&gt;(GEP-&gt;getOperand(0))) {</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE =</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;          dyn_cast_or_null&lt;ConstantExpr&gt;(<a class="code" href="namespacellvm.html#afaf85770fdd46c58822741178d7fd03d">ConstantFoldInstruction</a>(GEP, TD, TLI));</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordflow">if</span> (Init &amp;&amp; CE &amp;&amp; CE-&gt;<a class="code" href="classllvm_1_1ConstantExpr.html#a9c029996bf40f01fdebc1dfdf1cec4df">getOpcode</a>() == Instruction::GetElementPtr)</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;          SubInit = <a class="code" href="namespacellvm.html#af2c14d2f82bff2130daf86f4e22ae14d">ConstantFoldLoadThroughGEPConstantExpr</a>(Init, CE);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="comment">// If the initializer is an all-null value and we have an inbounds GEP,</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="comment">// we already know what the result of any load from that GEP is.</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="comment">// TODO: Handle splats.</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keywordflow">if</span> (Init &amp;&amp; isa&lt;ConstantAggregateZero&gt;(Init) &amp;&amp; GEP-&gt;isInBounds())</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;          SubInit = <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(GEP-&gt;getType()-&gt;getElementType());</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      }</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      Changed |= <a class="code" href="GlobalOpt_8cpp.html#a4c9b89709068175aa041524ee4bdc61f">CleanupConstantGlobalUsers</a>(GEP, SubInit, TD, TLI);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="keywordflow">if</span> (GEP-&gt;use_empty()) {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        GEP-&gt;eraseFromParent();</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MemIntrinsic.html">MemIntrinsic</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a> = dyn_cast&lt;MemIntrinsic&gt;(U)) { <span class="comment">// memset/cpy/mv</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>-&gt;getRawDest() == V) {</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">MI</a>-&gt;eraseFromParent();</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      }</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;Constant&gt;(U)) {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <span class="comment">// If we have a chain of dead constantexprs or other things dangling from</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <span class="comment">// us, and if they are all dead, nuke them without remorse.</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacellvm.html#a6b369f94d5ebc6e107a988f17b42b3eb">isSafeToDestroyConstant</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>)) {</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>-&gt;destroyConstant();</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <a class="code" href="GlobalOpt_8cpp.html#a4c9b89709068175aa041524ee4bdc61f">CleanupConstantGlobalUsers</a>(V, Init, TD, TLI);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      }</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  }</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;}</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">/// isSafeSROAElementUse - Return true if the specified instruction is a safe</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">/// user of a derived expression from a global that we want to SROA.</span></div><div class="line"><a name="l00354"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#acc21b8049c491d3f4b42eaeec97f6cc7">  354</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#acc21b8049c491d3f4b42eaeec97f6cc7">isSafeSROAElementUse</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="comment">// We might have a dead and dangling constant hanging off of here.</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;Constant&gt;(V))</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#a6b369f94d5ebc6e107a988f17b42b3eb">isSafeToDestroyConstant</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&gt;(V);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">if</span> (!I) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="comment">// Loads are ok.</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordflow">if</span> (isa&lt;LoadInst&gt;(I)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="comment">// Stores *to* the pointer are ok.</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(I))</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">return</span> SI-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0) != V;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="comment">// Otherwise, it must be a GEP.</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a>&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="keywordflow">if</span> (GEPI == 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">if</span> (GEPI-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>() &lt; 3 || !isa&lt;Constant&gt;(GEPI-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1)) ||</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      !cast&lt;Constant&gt;(GEPI-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1))-&gt;isNullValue())</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> I = GEPI-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = GEPI-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;       I != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#acc21b8049c491d3f4b42eaeec97f6cc7">isSafeSROAElementUse</a>(*I))</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;}</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">/// IsUserOfGlobalSafeForSRA - U is a direct user of the specified global value.</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">/// Look at it and its uses and decide whether it is safe to SROA this global.</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00388"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a6407ecfeeaabe2cb5df433a895498b58">  388</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a6407ecfeeaabe2cb5df433a895498b58">IsUserOfGlobalSafeForSRA</a>(<a class="code" href="classllvm_1_1User.html">User</a> *U, <a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *GV) {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="comment">// The user of the global must be a GEP Inst or a ConstantExpr GEP.</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordflow">if</span> (!isa&lt;GetElementPtrInst&gt;(U) &amp;&amp;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      (!isa&lt;ConstantExpr&gt;(U) ||</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;       cast&lt;ConstantExpr&gt;(U)-&gt;getOpcode() != Instruction::GetElementPtr))</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="comment">// Check to see if this ConstantExpr GEP is SRA&#39;able.  In particular, we</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="comment">// don&#39;t like &lt; 3 operand CE&#39;s, and we don&#39;t like non-constant integer</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="comment">// indices.  This enforces that all uses are &#39;gep GV, 0, C, ...&#39; for some</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="comment">// value of C.</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordflow">if</span> (U-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>() &lt; 3 || !isa&lt;Constant&gt;(U-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1)) ||</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      !cast&lt;Constant&gt;(U-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1))-&gt;isNullValue() ||</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      !isa&lt;ConstantInt&gt;(U-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(2)))</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <a class="code" href="classllvm_1_1generic__gep__type__iterator.html">gep_type_iterator</a> GEPI = <a class="code" href="namespacellvm.html#ac828b9b52935f87659a4adf237f820a3">gep_type_begin</a>(U), E = <a class="code" href="namespacellvm.html#a43c6ebb4fd35ebd815d66a2df4eed0b9">gep_type_end</a>(U);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  ++GEPI;  <span class="comment">// Skip over the pointer index.</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="comment">// If this is a use of an array allocation, do a bit more checking for sanity.</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *AT = dyn_cast&lt;ArrayType&gt;(*GEPI)) {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    uint64_t NumElements = AT-&gt;getNumElements();</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Idx = cast&lt;ConstantInt&gt;(U-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(2));</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="comment">// Check to make sure that index falls within the array.  If not,</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="comment">// something funny is going on, so we won&#39;t do the optimization.</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">if</span> (Idx-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>() &gt;= NumElements)</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="comment">// We cannot scalar repl this level of the array unless any array</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="comment">// sub-indices are in-range constants.  In particular, consider:</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="comment">// A[0][i].  We cannot know that the user isn&#39;t doing invalid things like</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="comment">// allowing i to index an out-of-range subscript that accesses A[1].</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="comment">// Scalar replacing *just* the outer index of the array is probably not</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="comment">// going to be a win anyway, so just give up.</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">for</span> (++GEPI; <span class="comment">// Skip array index.</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;         GEPI != E;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;         ++GEPI) {</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      uint64_t NumElements;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *SubArrayTy = dyn_cast&lt;ArrayType&gt;(*GEPI))</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        NumElements = SubArrayTy-&gt;getNumElements();</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1VectorType.html">VectorType</a> *SubVectorTy = dyn_cast&lt;VectorType&gt;(*GEPI))</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        NumElements = SubVectorTy-&gt;getNumElements();</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        assert((*GEPI)-&gt;isStructTy() &amp;&amp;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;               <span class="stringliteral">&quot;Indexed GEP type is not array, vector, or struct!&quot;</span>);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      }</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *IdxVal = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(GEPI.<a class="code" href="classllvm_1_1generic__gep__type__iterator.html#a8ca2ac53bb7661363b852abc99971d74">getOperand</a>());</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="keywordflow">if</span> (!IdxVal || IdxVal-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>() &gt;= NumElements)</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    }</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  }</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = U-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = U-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#acc21b8049c491d3f4b42eaeec97f6cc7">isSafeSROAElementUse</a>(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;}</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">/// GlobalUsersSafeToSRA - Look at all uses of the global and decide whether it</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">/// is safe for us to perform this transformation.</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00454"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a732909ea600e927d4123ba6f844c4035">  454</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a732909ea600e927d4123ba6f844c4035">GlobalUsersSafeToSRA</a>(<a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *GV) {</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = GV-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;       UI != E; ++UI) {</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#a6407ecfeeaabe2cb5df433a895498b58">IsUserOfGlobalSafeForSRA</a>(*UI, GV))</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  }</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;}</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">/// SRAGlobal - Perform scalar replacement of aggregates on the specified global</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">/// variable.  This opens the door for other optimizations by exposing the</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">/// behavior of the program in a more fine-grained way.  We have determined that</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">/// this transformation is safe already.  We return the first global variable we</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">/// insert so that the caller can reprocess it.</span></div><div class="line"><a name="l00469"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#aecfe51ab31f2b93f6248121cb14de054">  469</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *<a class="code" href="GlobalOpt_8cpp.html#aecfe51ab31f2b93f6248121cb14de054">SRAGlobal</a>(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> &amp;TD) {</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="comment">// Make sure this global only has simple uses that we can SRA.</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#a732909ea600e927d4123ba6f844c4035">GlobalUsersSafeToSRA</a>(GV))</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  assert(GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#abefc2d8baa67d6f9e49c95912cfde480">hasLocalLinkage</a>() &amp;&amp; !GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#a1500a3fe55cf38153aa1e0fbe7284e05">isConstant</a>());</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="classllvm_1_1Init.html">Init</a> = GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>();</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = Init-&gt;getType();</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  std::vector&lt;GlobalVariable*&gt; NewGlobals;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <a class="code" href="classllvm_1_1iplist.html">Module::GlobalListType</a> &amp;Globals = GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>()-&gt;<a class="code" href="classllvm_1_1Module.html#a28c0310f56c2ea41ff7012df55ac6dc5">getGlobalList</a>();</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="comment">// Get the alignment of the global, either explicit or target-specific.</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="keywordtype">unsigned</span> StartAlignment = GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a8a69689cb8586761c6a7535a8f6618a5">getAlignment</a>();</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="keywordflow">if</span> (StartAlignment == 0)</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    StartAlignment = TD.<a class="code" href="classllvm_1_1DataLayout.html#abb381519d34dcb9ccf673bf7689d0721">getABITypeAlignment</a>(GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>());</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *STy = dyn_cast&lt;StructType&gt;(Ty)) {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    NewGlobals.reserve(STy-&gt;getNumElements());</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1StructLayout.html">StructLayout</a> &amp;Layout = *TD.<a class="code" href="classllvm_1_1DataLayout.html#a35c840104f32575e0d91422cf1ef3ce4">getStructLayout</a>(STy);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = STy-&gt;getNumElements(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a> = Init-&gt;getAggregateElement(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      assert(In &amp;&amp; <span class="stringliteral">&quot;Couldn&#39;t get element of initializer?&quot;</span>);</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *NGV = <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(STy-&gt;getElementType(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>), <span class="keyword">false</span>,</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                                               <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalVariable::InternalLinkage</a>,</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                                               <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>, GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.&quot;</span>+<a class="code" href="classllvm_1_1Twine.html">Twine</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>),</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                                               GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ab1b932862d7d88dae34cfd24f44847a3">getThreadLocalMode</a>(),</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                                              GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>()-&gt;<a class="code" href="classllvm_1_1PointerType.html#a921061a57ec3cfbaf6422f09f7d79fc3">getAddressSpace</a>());</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      Globals.<a class="code" href="classllvm_1_1iplist.html#a35c71de7e8bbe3c0353d042beb58263f">insert</a>(GV, NGV);</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      NewGlobals.push_back(NGV);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <span class="comment">// Calculate the known alignment of the field.  If the original aggregate</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="comment">// had 256 byte alignment for example, something might depend on that:</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      <span class="comment">// propagate info to each field.</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      uint64_t FieldOffset = Layout.<a class="code" href="classllvm_1_1StructLayout.html#ae10c4483372a357a0d3411b3d64be10c">getElementOffset</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <span class="keywordtype">unsigned</span> NewAlign = (unsigned)<a class="code" href="namespacellvm.html#af36d7e69ab16b64b2e3a48c83aa9f0f6">MinAlign</a>(StartAlignment, FieldOffset);</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      <span class="keywordflow">if</span> (NewAlign &gt; TD.<a class="code" href="classllvm_1_1DataLayout.html#abb381519d34dcb9ccf673bf7689d0721">getABITypeAlignment</a>(STy-&gt;getElementType(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)))</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        NGV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad7523221c38891e563047ab7fc044312">setAlignment</a>(NewAlign);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    }</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SequentialType.html">SequentialType</a> *STy = dyn_cast&lt;SequentialType&gt;(Ty)) {</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordtype">unsigned</span> NumElements = 0;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *ATy = dyn_cast&lt;ArrayType&gt;(STy))</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      NumElements = ATy-&gt;getNumElements();</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      NumElements = cast&lt;VectorType&gt;(STy)-&gt;getNumElements();</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">if</span> (NumElements &gt; 16 &amp;&amp; GV-&gt;<a class="code" href="classllvm_1_1Value.html#a9ea9a909185ecbf9fc81ab35ebfb11d6">hasNUsesOrMore</a>(16))</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordflow">return</span> 0; <span class="comment">// It&#39;s not worth it.</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    NewGlobals.reserve(NumElements);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    uint64_t EltSize = TD.<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(STy-&gt;getElementType());</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordtype">unsigned</span> EltAlign = TD.<a class="code" href="classllvm_1_1DataLayout.html#abb381519d34dcb9ccf673bf7689d0721">getABITypeAlignment</a>(STy-&gt;getElementType());</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = NumElements; <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a> = Init-&gt;getAggregateElement(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      assert(In &amp;&amp; <span class="stringliteral">&quot;Couldn&#39;t get element of initializer?&quot;</span>);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *NGV = <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(STy-&gt;getElementType(), <span class="keyword">false</span>,</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                                               <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalVariable::InternalLinkage</a>,</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                                               <a class="code" href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>, GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.&quot;</span>+<a class="code" href="classllvm_1_1Twine.html">Twine</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>),</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                                               GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ab1b932862d7d88dae34cfd24f44847a3">getThreadLocalMode</a>(),</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                                              GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>()-&gt;<a class="code" href="classllvm_1_1PointerType.html#a921061a57ec3cfbaf6422f09f7d79fc3">getAddressSpace</a>());</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      Globals.<a class="code" href="classllvm_1_1iplist.html#a35c71de7e8bbe3c0353d042beb58263f">insert</a>(GV, NGV);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      NewGlobals.push_back(NGV);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      <span class="comment">// Calculate the known alignment of the field.  If the original aggregate</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <span class="comment">// had 256 byte alignment for example, something might depend on that:</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="comment">// propagate info to each field.</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordtype">unsigned</span> NewAlign = (unsigned)<a class="code" href="namespacellvm.html#af36d7e69ab16b64b2e3a48c83aa9f0f6">MinAlign</a>(StartAlignment, EltSize*<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keywordflow">if</span> (NewAlign &gt; EltAlign)</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        NGV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad7523221c38891e563047ab7fc044312">setAlignment</a>(NewAlign);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    }</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  }</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keywordflow">if</span> (NewGlobals.empty())</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;PERFORMING GLOBAL SRA ON: &quot;</span> &lt;&lt; *GV);</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *NullInt =<a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(GV-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()));</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="comment">// Loop over all of the uses of the global, replacing the constantexpr geps,</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="comment">// with smaller constantexpr geps or direct references.</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="keywordflow">while</span> (!GV-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <a class="code" href="classllvm_1_1User.html">User</a> *GEP = GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad9a329f9f85bc896a726a628aa3f4e9d">use_back</a>();</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    assert(((isa&lt;ConstantExpr&gt;(GEP) &amp;&amp;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;             cast&lt;ConstantExpr&gt;(GEP)-&gt;getOpcode()==Instruction::GetElementPtr)||</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            isa&lt;GetElementPtrInst&gt;(GEP)) &amp;&amp; <span class="stringliteral">&quot;NonGEP CE&#39;s are not SRAable!&quot;</span>);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="comment">// Ignore the 1th operand, which has to be zero or else the program is quite</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">// broken (undefined).  Get the 2nd operand, which is the structure or array</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="comment">// index.</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordtype">unsigned</span> Val = cast&lt;ConstantInt&gt;(GEP-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(2))-&gt;getZExtValue();</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordflow">if</span> (Val &gt;= NewGlobals.size()) Val = 0; <span class="comment">// Out of bound array access.</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewPtr = NewGlobals[Val];</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="comment">// Form a shorter GEP if needed.</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">if</span> (GEP-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>() &gt; 3) {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(GEP)) {</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Constant*, 8&gt;</a> Idxs;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        Idxs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(NullInt);</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 3, e = CE-&gt;getNumOperands(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;          Idxs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(CE-&gt;getOperand(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        NewPtr = <a class="code" href="classllvm_1_1ConstantExpr.html#a51940249c228e46f1f97932e5f4b8450">ConstantExpr::getGetElementPtr</a>(cast&lt;Constant&gt;(NewPtr), Idxs);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        <a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI = cast&lt;GetElementPtrInst&gt;(GEP);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 8&gt;</a> Idxs;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        Idxs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(NullInt);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 3, e = GEPI-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;          Idxs.push_back(GEPI-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        NewPtr = <a class="code" href="classllvm_1_1GetElementPtrInst.html#a1585a1ee545bef997b3120f87fd992a0">GetElementPtrInst::Create</a>(NewPtr, Idxs,</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                                           GEPI-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.&quot;</span>+<a class="code" href="classllvm_1_1Twine.html">Twine</a>(Val),GEPI);</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    GEP-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewPtr);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI = dyn_cast&lt;GetElementPtrInst&gt;(GEP))</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      GEPI-&gt;eraseFromParent();</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      cast&lt;ConstantExpr&gt;(GEP)-&gt;destroyConstant();</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  }</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="comment">// Delete the old global, now that it is dead.</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  Globals.<a class="code" href="classllvm_1_1iplist.html#a5c2aa38108db7a66ac5e8da547f64ad7">erase</a>(GV);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  ++NumSRA;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <span class="comment">// Loop over the new globals array deleting any globals that are obviously</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="comment">// dead.  This can arise due to scalarization of a structure or an array that</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="comment">// has elements that are dead.</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keywordtype">unsigned</span> FirstGlobal = 0;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = NewGlobals.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">if</span> (NewGlobals[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;use_empty()) {</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      Globals.<a class="code" href="classllvm_1_1iplist.html#a5c2aa38108db7a66ac5e8da547f64ad7">erase</a>(NewGlobals[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      <span class="keywordflow">if</span> (FirstGlobal == i) ++FirstGlobal;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    }</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="keywordflow">return</span> FirstGlobal != NewGlobals.size() ? NewGlobals[FirstGlobal] : 0;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;}</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">/// AllUsesOfValueWillTrapIfNull - Return true if all users of the specified</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">/// value will trap if the value is dynamically null.  PHIs keeps track of any</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">/// phi nodes we&#39;ve seen to avoid reprocessing them.</span></div><div class="line"><a name="l00611"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a62584dc0c8f12c3b4fc85f84dbd08313">  611</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a62584dc0c8f12c3b4fc85f84dbd08313">AllUsesOfValueWillTrapIfNull</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *V,</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                                         <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const PHINode*, 8&gt;</a> &amp;PHIs) {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::const_use_iterator</a> UI = V-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = V-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI != E;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;       ++UI) {</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1User.html">User</a> *U = *UI;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">if</span> (isa&lt;LoadInst&gt;(U)) {</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="comment">// Will trap.</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(U)) {</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="keywordflow">if</span> (SI-&gt;getOperand(0) == V) {</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="comment">//cerr &lt;&lt; &quot;NONTRAPPING USE: &quot; &lt;&lt; *U;</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Storing the value.</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      }</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = dyn_cast&lt;CallInst&gt;(U)) {</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="keywordflow">if</span> (CI-&gt;getCalledValue() != V) {</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="comment">//cerr &lt;&lt; &quot;NONTRAPPING USE: &quot; &lt;&lt; *U;</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Not calling the ptr</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      }</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II = dyn_cast&lt;InvokeInst&gt;(U)) {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="keywordflow">if</span> (II-&gt;getCalledValue() != V) {</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <span class="comment">//cerr &lt;&lt; &quot;NONTRAPPING USE: &quot; &lt;&lt; *U;</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Not calling the ptr</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      }</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *CI = dyn_cast&lt;BitCastInst&gt;(U)) {</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#a62584dc0c8f12c3b4fc85f84dbd08313">AllUsesOfValueWillTrapIfNull</a>(CI, PHIs)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI = dyn_cast&lt;GetElementPtrInst&gt;(U)) {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#a62584dc0c8f12c3b4fc85f84dbd08313">AllUsesOfValueWillTrapIfNull</a>(GEPI, PHIs)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(U)) {</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="comment">// If we&#39;ve already seen this phi node, ignore it, it has already been</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <span class="comment">// checked.</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="keywordflow">if</span> (PHIs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(PN) &amp;&amp; !<a class="code" href="GlobalOpt_8cpp.html#a62584dc0c8f12c3b4fc85f84dbd08313">AllUsesOfValueWillTrapIfNull</a>(PN, PHIs))</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;ICmpInst&gt;(U) &amp;&amp;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;               isa&lt;ConstantPointerNull&gt;(UI-&gt;getOperand(1))) {</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="comment">// Ignore icmp X, null</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="comment">//cerr &lt;&lt; &quot;NONTRAPPING USE: &quot; &lt;&lt; *U;</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  }</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;}</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">/// AllUsesOfLoadedValueWillTrapIfNull - Return true if all uses of any loads</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">/// from GV will trap if the loaded value is null.  Note that this also permits</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment">/// comparisons of the loaded value against null, as a special case.</span></div><div class="line"><a name="l00657"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a6534eab7f2125fdeff4232f790c07e05">  657</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a6534eab7f2125fdeff4232f790c07e05">AllUsesOfLoadedValueWillTrapIfNull</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV) {</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::const_use_iterator</a> UI = GV-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;       UI != E; ++UI) {</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1User.html">User</a> *U = *UI;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(U)) {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const PHINode*, 8&gt;</a> PHIs;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#a62584dc0c8f12c3b4fc85f84dbd08313">AllUsesOfValueWillTrapIfNull</a>(LI, PHIs))</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;StoreInst&gt;(U)) {</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="comment">// Ignore stores to the global.</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="comment">// We don&#39;t know or understand this user, bail out.</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <span class="comment">//cerr &lt;&lt; &quot;UNKNOWN USER OF GLOBAL!: &quot; &lt;&lt; *U;</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    }</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  }</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;}</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#aef572ae661cf9f5b14651ef952629c10">  677</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#aef572ae661cf9f5b14651ef952629c10">OptimizeAwayTrappingUsesOfValue</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Constant.html">Constant</a> *NewV) {</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = V-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = V-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI != E; ) {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = cast&lt;Instruction&gt;(*UI++);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(I)) {</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      LI-&gt;setOperand(0, NewV);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(I)) {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <span class="keywordflow">if</span> (SI-&gt;getOperand(1) == V) {</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        SI-&gt;setOperand(1, NewV);</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      }</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;CallInst&gt;(I) || isa&lt;InvokeInst&gt;(I)) {</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <a class="code" href="classllvm_1_1CallSite.html">CallSite</a> CS(I);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="keywordflow">if</span> (CS.<a class="code" href="classllvm_1_1CallSiteBase.html#a1abce20a9eff3d23ce05331962b1997c">getCalledValue</a>() == V) {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        <span class="comment">// Calling through the pointer!  Turn into a direct call, but be careful</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="comment">// that the pointer is not also being passed as an argument.</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        CS.<a class="code" href="classllvm_1_1CallSiteBase.html#ae8db0b64d91fa18dfcc01a684708c00b">setCalledFunction</a>(NewV);</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="keywordtype">bool</span> PassedAsArg = <span class="keyword">false</span>;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = CS.<a class="code" href="classllvm_1_1CallSiteBase.html#a13ce8cb4c50c5b3505915467e14ad95a">arg_size</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;          <span class="keywordflow">if</span> (CS.<a class="code" href="classllvm_1_1CallSiteBase.html#a65a550af73bd99c96abea847916aa4e9">getArgument</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) == V) {</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            PassedAsArg = <span class="keyword">true</span>;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            CS.<a class="code" href="classllvm_1_1CallSiteBase.html#addab854f674836e5497dcfafff324e27">setArgument</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>, NewV);</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;          }</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="keywordflow">if</span> (PassedAsArg) {</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;          <span class="comment">// Being passed as an argument also.  Be careful to not invalidate UI!</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;          UI = V-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>();</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CastInst.html">CastInst</a> *CI = dyn_cast&lt;CastInst&gt;(I)) {</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      Changed |= <a class="code" href="GlobalOpt_8cpp.html#aef572ae661cf9f5b14651ef952629c10">OptimizeAwayTrappingUsesOfValue</a>(CI,</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                                <a class="code" href="classllvm_1_1ConstantExpr.html#a1e1ce75d651c76b6869b4218e34618c8">ConstantExpr::getCast</a>(CI-&gt;getOpcode(),</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                                                      NewV, CI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()));</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      <span class="keywordflow">if</span> (CI-&gt;use_empty()) {</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        CI-&gt;eraseFromParent();</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      }</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI = dyn_cast&lt;GetElementPtrInst&gt;(I)) {</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      <span class="comment">// Should handle GEP here.</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Constant*, 8&gt;</a> Idxs;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      Idxs.<a class="code" href="classllvm_1_1SmallVectorImpl.html#a4786e64977a3af38f29adee46b70a863">reserve</a>(GEPI-&gt;getNumOperands()-1);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = GEPI-&gt;op_begin() + 1, e = GEPI-&gt;op_end();</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;           <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a> = dyn_cast&lt;Constant&gt;(*<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>))</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;          Idxs.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="keywordflow">if</span> (Idxs.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>() == GEPI-&gt;getNumOperands()-1)</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        Changed |= <a class="code" href="GlobalOpt_8cpp.html#aef572ae661cf9f5b14651ef952629c10">OptimizeAwayTrappingUsesOfValue</a>(GEPI,</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                          <a class="code" href="classllvm_1_1ConstantExpr.html#a51940249c228e46f1f97932e5f4b8450">ConstantExpr::getGetElementPtr</a>(NewV, Idxs));</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="keywordflow">if</span> (GEPI-&gt;use_empty()) {</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        GEPI-&gt;eraseFromParent();</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    }</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  }</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;}</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment">/// OptimizeAwayTrappingUsesOfLoads - The specified global has only one non-null</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">/// value stored into it.  If there are uses of the loaded value that would trap</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">/// if the loaded value is dynamically null, then we know that they cannot be</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">/// reachable with a null optimize away the load.</span></div><div class="line"><a name="l00744"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a77f379dd4a6b268b3f574dc53301a6e8">  744</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a77f379dd4a6b268b3f574dc53301a6e8">OptimizeAwayTrappingUsesOfLoads</a>(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV, <a class="code" href="classllvm_1_1Constant.html">Constant</a> *LV,</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                                            <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD,</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                                            <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI) {</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <span class="comment">// Keep track of whether we are able to remove all the uses of the global</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="comment">// other than the store that defines it.</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="keywordtype">bool</span> AllNonStoreUsesGone = <span class="keyword">true</span>;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="comment">// Replace all uses of loads with uses of uses of the stored value.</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> GUI = GV-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); GUI != E;){</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <a class="code" href="classllvm_1_1User.html">User</a> *GlobalUser = *GUI++;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(GlobalUser)) {</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      Changed |= <a class="code" href="GlobalOpt_8cpp.html#aef572ae661cf9f5b14651ef952629c10">OptimizeAwayTrappingUsesOfValue</a>(LI, LV);</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      <span class="comment">// If we were able to delete all uses of the loads</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <span class="keywordflow">if</span> (LI-&gt;use_empty()) {</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        LI-&gt;eraseFromParent();</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        AllNonStoreUsesGone = <span class="keyword">false</span>;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      }</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;StoreInst&gt;(GlobalUser)) {</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="comment">// Ignore the store that stores &quot;LV&quot; to the global.</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;      assert(GlobalUser-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1) == GV &amp;&amp;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;             <span class="stringliteral">&quot;Must be storing *to* the global&quot;</span>);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      AllNonStoreUsesGone = <span class="keyword">false</span>;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      <span class="comment">// If we get here we could have other crazy uses that are transitively</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      <span class="comment">// loaded.</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      assert((isa&lt;PHINode&gt;(GlobalUser) || isa&lt;SelectInst&gt;(GlobalUser) ||</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;              isa&lt;ConstantExpr&gt;(GlobalUser) || isa&lt;CmpInst&gt;(GlobalUser) ||</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;              isa&lt;BitCastInst&gt;(GlobalUser) ||</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;              isa&lt;GetElementPtrInst&gt;(GlobalUser)) &amp;&amp;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;             <span class="stringliteral">&quot;Only expect load and stores!&quot;</span>);</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    }</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  }</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="keywordflow">if</span> (Changed) {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;OPTIMIZED LOADS FROM STORED ONCE POINTER: &quot;</span> &lt;&lt; *GV);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    ++NumGlobUses;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  }</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="comment">// If we nuked all of the loads, then none of the stores are needed either,</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="comment">// nor is the global.</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <span class="keywordflow">if</span> (AllNonStoreUsesGone) {</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="GlobalOpt_8cpp.html#ace2885fc42e68606f270bfd3180d5f26">isLeakCheckerRoot</a>(GV)) {</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      Changed |= <a class="code" href="GlobalOpt_8cpp.html#a60254fdb6128ce676768cdc8f7227433">CleanupPointerRootUsers</a>(GV, TLI);</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      <a class="code" href="GlobalOpt_8cpp.html#a4c9b89709068175aa041524ee4bdc61f">CleanupConstantGlobalUsers</a>(GV, 0, TD, TLI);</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    }</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="keywordflow">if</span> (GV-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;  *** GLOBAL NOW DEAD!\n&quot;</span>);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      ++NumDeleted;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    }</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  }</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;}</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="comment">/// ConstantPropUsersOf - Walk the use list of V, constant folding all of the</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment">/// instructions that are foldable.</span></div><div class="line"><a name="l00808"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#ac72641748365fe07282530999fea5230">  808</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="GlobalOpt_8cpp.html#ac72641748365fe07282530999fea5230">ConstantPropUsersOf</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V,</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                                <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD, <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI) {</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = V-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = V-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI != E; )</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = dyn_cast&lt;Instruction&gt;(*UI++))</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *NewC = <a class="code" href="namespacellvm.html#afaf85770fdd46c58822741178d7fd03d">ConstantFoldInstruction</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TD, TLI)) {</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(NewC);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="comment">// Advance UI to the next non-I use to avoid invalidating it!</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <span class="comment">// Instructions could multiply use V.</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="keywordflow">while</span> (UI != E &amp;&amp; *UI == <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;          ++UI;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      }</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;}</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment">/// OptimizeGlobalAddressOfMalloc - This function takes the specified global</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="comment">/// variable, and transforms the program as if it always contained the result of</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="comment">/// the specified malloc.  Because it is always the result of the specified</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment">/// malloc, there is no reason to actually DO the malloc.  Instead, turn the</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="comment">/// malloc into a global, and any loads of GV as uses of the new global.</span></div><div class="line"><a name="l00828"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a387ee79de1e991d8a1ebe6c495332eae">  828</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *<a class="code" href="GlobalOpt_8cpp.html#a387ee79de1e991d8a1ebe6c495332eae">OptimizeGlobalAddressOfMalloc</a>(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV,</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                                                     <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI,</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                                                     <a class="code" href="classllvm_1_1Type.html">Type</a> *AllocTy,</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                                                     <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *NElements,</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                                                     <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD,</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                                                     <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI) {</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">errs</a>() &lt;&lt; <span class="stringliteral">&quot;PROMOTING GLOBAL: &quot;</span> &lt;&lt; *GV &lt;&lt; <span class="stringliteral">&quot;  CALL = &quot;</span> &lt;&lt; *CI &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *GlobalType;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keywordflow">if</span> (NElements-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>() == 1)</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    GlobalType = AllocTy;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="comment">// If we have an array allocation, the global variable is of an array.</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    GlobalType = <a class="code" href="classllvm_1_1ArrayType.html#adf411edc4f135b570ab218079474ce77">ArrayType::get</a>(AllocTy, NElements-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>());</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="comment">// Create the new global variable.  The contents of the malloc&#39;d memory is</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="comment">// undefined, so initialize with an undef value.</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *NewGV = <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(*GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>(),</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                                             GlobalType, <span class="keyword">false</span>,</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                                             <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>,</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                                             <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(GlobalType),</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                                             GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.body&quot;</span>,</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                                             GV,</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                                             GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ab1b932862d7d88dae34cfd24f44847a3">getThreadLocalMode</a>());</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="comment">// If there are bitcast users of the malloc (which is typical, usually we have</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="comment">// a malloc + bitcast) then replace them with uses of the new global.  Update</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <span class="comment">// other users to use the global as well.</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *TheBC = 0;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="keywordflow">while</span> (!CI-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">use_back</a>());</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BCI = dyn_cast&lt;BitCastInst&gt;(User)) {</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <span class="keywordflow">if</span> (BCI-&gt;getType() == NewGV-&gt;getType()) {</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        BCI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewGV);</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        BCI-&gt;eraseFromParent();</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        BCI-&gt;setOperand(0, NewGV);</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      }</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordflow">if</span> (TheBC == 0)</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        TheBC = <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(NewGV, CI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), <span class="stringliteral">&quot;newgv&quot;</span>, CI);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      User-&gt;<a class="code" href="classllvm_1_1User.html#a1f0b9358936e3e00c42a460abbfb2868">replaceUsesOfWith</a>(CI, TheBC);</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    }</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  }</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *RepValue = NewGV;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="keywordflow">if</span> (NewGV-&gt;getType() != GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>()-&gt;<a class="code" href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">getElementType</a>())</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    RepValue = <a class="code" href="classllvm_1_1ConstantExpr.html#aba93ec4079f8d709a1d5b4745310782e">ConstantExpr::getBitCast</a>(RepValue,</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                                        GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>()-&gt;<a class="code" href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">getElementType</a>());</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <span class="comment">// If there is a comparison against null, we will insert a global bool to</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="comment">// keep track of whether the global was initialized yet or not.</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *InitBool =</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(<a class="code" href="classllvm_1_1Type.html#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(GV-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()), <span class="keyword">false</span>,</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                       GlobalValue::InternalLinkage,</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                       <a class="code" href="classllvm_1_1ConstantInt.html#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(GV-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()),</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                       GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.init&quot;</span>, GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ab1b932862d7d88dae34cfd24f44847a3">getThreadLocalMode</a>());</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="keywordtype">bool</span> InitBoolUsed = <span class="keyword">false</span>;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="comment">// Loop over all uses of GV, processing them in turn.</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordflow">while</span> (!GV-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad9a329f9f85bc896a726a628aa3f4e9d">use_back</a>())) {</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <span class="comment">// The global is initialized when the store to it occurs.</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(<a class="code" href="classllvm_1_1ConstantInt.html#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(GV-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()), InitBool, <span class="keyword">false</span>, 0,</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                    SI-&gt;getOrdering(), SI-&gt;getSynchScope(), SI);</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    }</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = cast&lt;LoadInst&gt;(GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad9a329f9f85bc896a726a628aa3f4e9d">use_back</a>());</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">while</span> (!LI-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      <a class="code" href="classllvm_1_1Use.html">Use</a> &amp;LoadUse = LI-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>().<a class="code" href="classllvm_1_1value__use__iterator.html#a94ea49d6aa255c31746f4f2b8cbf4443">getUse</a>();</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;ICmpInst&gt;(LoadUse.<a class="code" href="classllvm_1_1Use.html#ac3564961c33fa9f636c6444db4c7fa85">getUser</a>())) {</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        LoadUse = RepValue;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      }</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI = cast&lt;ICmpInst&gt;(LoadUse.<a class="code" href="classllvm_1_1Use.html#ac3564961c33fa9f636c6444db4c7fa85">getUser</a>());</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="comment">// Replace the cmp X, 0 with a use of the bool value.</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      <span class="comment">// Sink the load to where the compare was, if atomic rules allow us to.</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *LV = <span class="keyword">new</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>(InitBool, InitBool-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.val&quot;</span>, <span class="keyword">false</span>, 0,</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                               LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a8c0a29ecc14dc5afe7573bf616da2361">getOrdering</a>(), LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a4df7359cb36b166c0878e16291cbe183">getSynchScope</a>(),</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                               LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#af5ed72f95abe438ddf3dff1c76c9ea42">isUnordered</a>() ? (<a class="code" href="classllvm_1_1Instruction.html">Instruction</a>*)ICI : LI);</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      InitBoolUsed = <span class="keyword">true</span>;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      <span class="keywordflow">switch</span> (ICI-&gt;<a class="code" href="classllvm_1_1CmpInst.html#a8afd4995fae596b2c86eeed85b3d388b">getPredicate</a>()) {</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      <span class="keywordflow">default</span>: <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unknown ICmp Predicate!&quot;</span>);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP_ULT</a>:</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a15ae464950ac676919c2f0c7aafc706c">ICmpInst::ICMP_SLT</a>:   <span class="comment">// X &lt; null -&gt; always false</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        LV = <a class="code" href="classllvm_1_1ConstantInt.html#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(GV-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>());</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05ad92f160316221fd4090520bb2b3cefc5">ICmpInst::ICMP_ULE</a>:</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a2751d6136a2819749dcef65dc19a4246">ICmpInst::ICMP_SLE</a>:</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05aa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP_EQ</a>:</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        LV = <a class="code" href="classllvm_1_1BinaryOperator.html#a0ad1d1442a12b21931b730201f58ab5e">BinaryOperator::CreateNot</a>(LV, <span class="stringliteral">&quot;notinit&quot;</span>, ICI);</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05ac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP_NE</a>:</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a573bcd571c938fce863525330bbfc4b8">ICmpInst::ICMP_UGE</a>:</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05ac1aa7b798ba11d2e497d5cce6ce6d3dc">ICmpInst::ICMP_SGE</a>:</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a607cecdc5172814382033e001ed11fad">ICmpInst::ICMP_UGT</a>:</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a720a42e85f7e981afd61e28473b0000a">ICmpInst::ICMP_SGT</a>:</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <span class="keywordflow">break</span>;  <span class="comment">// no change.</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      }</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      ICI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(LV);</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      ICI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    }</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    LI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  }</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="comment">// If the initialization boolean was used, insert it, otherwise delete it.</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  <span class="keywordflow">if</span> (!InitBoolUsed) {</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="keywordflow">while</span> (!InitBool-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>())  <span class="comment">// Delete initializations</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      cast&lt;StoreInst&gt;(InitBool-&gt;<a class="code" href="classllvm_1_1Value.html#ad9a329f9f85bc896a726a628aa3f4e9d">use_back</a>())-&gt;eraseFromParent();</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keyword">delete</span> InitBool;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  } <span class="keywordflow">else</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>()-&gt;<a class="code" href="classllvm_1_1Module.html#a28c0310f56c2ea41ff7012df55ac6dc5">getGlobalList</a>().<a class="code" href="classllvm_1_1iplist.html#a35c71de7e8bbe3c0353d042beb58263f">insert</a>(GV, InitBool);</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <span class="comment">// Now the GV is dead, nuke it and the malloc..</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="comment">// To further other optimizations, loop over all users of NewGV and try to</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <span class="comment">// constant prop them.  This will promote GEP instructions with constant</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="comment">// indices into GEP constant-exprs, which will allow global-opt to hack on it.</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <a class="code" href="GlobalOpt_8cpp.html#ac72641748365fe07282530999fea5230">ConstantPropUsersOf</a>(NewGV, TD, TLI);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="keywordflow">if</span> (RepValue != NewGV)</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <a class="code" href="GlobalOpt_8cpp.html#ac72641748365fe07282530999fea5230">ConstantPropUsersOf</a>(RepValue, TD, TLI);</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="keywordflow">return</span> NewGV;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;}</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">/// ValueIsOnlyUsedLocallyOrStoredToOneGlobal - Scan the use-list of V checking</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment">/// to make sure that there are no complex uses of V.  We permit simple things</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">/// like dereferencing the pointer, but not storing through the address, unless</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">/// it is to the specified global.</span></div><div class="line"><a name="l00962"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#ad509f84445ce77b94e2d70042449202f">  962</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#ad509f84445ce77b94e2d70042449202f">ValueIsOnlyUsedLocallyOrStoredToOneGlobal</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *V,</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                                                      <span class="keyword">const</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV,</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                                         <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const PHINode*, 8&gt;</a> &amp;PHIs) {</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::const_use_iterator</a> UI = V-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = V-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;       UI != E; ++UI) {</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Inst = cast&lt;Instruction&gt;(*UI);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="keywordflow">if</span> (isa&lt;LoadInst&gt;(Inst) || isa&lt;CmpInst&gt;(Inst)) {</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <span class="keywordflow">continue</span>; <span class="comment">// Fine, ignore.</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    }</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(Inst)) {</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="keywordflow">if</span> (SI-&gt;getOperand(0) == V &amp;&amp; SI-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1) != GV)</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Storing the pointer itself... bad.</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="keywordflow">continue</span>; <span class="comment">// Otherwise, storing through it, or storing into GV... fine.</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    }</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="comment">// Must index into the array and into the struct.</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="keywordflow">if</span> (isa&lt;GetElementPtrInst&gt;(Inst) &amp;&amp; Inst-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>() &gt;= 3) {</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#ad509f84445ce77b94e2d70042449202f">ValueIsOnlyUsedLocallyOrStoredToOneGlobal</a>(Inst, GV, PHIs))</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    }</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(Inst)) {</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      <span class="comment">// PHIs are ok if all uses are ok.  Don&#39;t infinitely recurse through PHI</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      <span class="comment">// cycles.</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <span class="keywordflow">if</span> (PHIs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(PN))</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#ad509f84445ce77b94e2d70042449202f">ValueIsOnlyUsedLocallyOrStoredToOneGlobal</a>(PN, GV, PHIs))</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    }</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BCI = dyn_cast&lt;BitCastInst&gt;(Inst)) {</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#ad509f84445ce77b94e2d70042449202f">ValueIsOnlyUsedLocallyOrStoredToOneGlobal</a>(BCI, GV, PHIs))</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    }</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  }</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;}</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">/// ReplaceUsesOfMallocWithGlobal - The Alloc pointer is stored into GV</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment">/// somewhere.  Transform all uses of the allocation into loads from the</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment">/// global and uses of the resultant pointer.  Further, delete the store into</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment">/// GV.  This assumes that these value pass the</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">/// &#39;ValueIsOnlyUsedLocallyOrStoredToOneGlobal&#39; predicate.</span></div><div class="line"><a name="l01011"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a35445872809e31831849ca99f41540d0"> 1011</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="GlobalOpt_8cpp.html#a35445872809e31831849ca99f41540d0">ReplaceUsesOfMallocWithGlobal</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Alloc,</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                                          <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV) {</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="keywordflow">while</span> (!Alloc-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *U = cast&lt;Instruction&gt;(*Alloc-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>());</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *InsertPt = U;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(U)) {</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <span class="comment">// If this is the store of the allocation into the global, remove it.</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <span class="keywordflow">if</span> (SI-&gt;getOperand(1) == GV) {</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      }</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(U)) {</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="comment">// Insert the load in the corresponding predecessor, not right before the</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      <span class="comment">// PHI.</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      InsertPt = PN-&gt;getIncomingBlock(Alloc-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>())-&gt;getTerminator();</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;BitCastInst&gt;(U)) {</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      <span class="comment">// Must be bitcast between the malloc and store to initialize the global.</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      <a class="code" href="GlobalOpt_8cpp.html#a35445872809e31831849ca99f41540d0">ReplaceUsesOfMallocWithGlobal</a>(U, GV);</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      U-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI = dyn_cast&lt;GetElementPtrInst&gt;(U)) {</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <span class="comment">// If this is a &quot;GEP bitcast&quot; and the user is a store to the global, then</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      <span class="comment">// just process it as a bitcast.</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      <span class="keywordflow">if</span> (GEPI-&gt;hasAllZeroIndices() &amp;&amp; GEPI-&gt;hasOneUse())</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(GEPI-&gt;use_back()))</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;          <span class="keywordflow">if</span> (SI-&gt;getOperand(1) == GV) {</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            <span class="comment">// Must be bitcast GEP between the malloc and store to initialize</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            <span class="comment">// the global.</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;            <a class="code" href="GlobalOpt_8cpp.html#a35445872809e31831849ca99f41540d0">ReplaceUsesOfMallocWithGlobal</a>(GEPI, GV);</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            GEPI-&gt;eraseFromParent();</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;          }</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    }</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="comment">// Insert a load from the global, and use it instead of the malloc.</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NL = <span class="keyword">new</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>(GV, GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.val&quot;</span>, InsertPt);</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    U-&gt;<a class="code" href="classllvm_1_1User.html#a1f0b9358936e3e00c42a460abbfb2868">replaceUsesOfWith</a>(Alloc, NL);</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  }</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;}</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">/// LoadUsesSimpleEnoughForHeapSRA - Verify that all uses of V (a load, or a phi</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">/// of a load) are simple enough to perform heap SRA on.  This permits GEP&#39;s</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">/// that index through the array and struct field, icmps of null, and PHIs.</span></div><div class="line"><a name="l01054"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a5abddaa1ca2270d02c0344679d425538"> 1054</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a5abddaa1ca2270d02c0344679d425538">LoadUsesSimpleEnoughForHeapSRA</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *V,</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                        <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const PHINode*, 32&gt;</a> &amp;LoadUsingPHIs,</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                        <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const PHINode*, 32&gt;</a> &amp;LoadUsingPHIsPerLoad) {</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <span class="comment">// We permit two users of the load: setcc comparing against the null</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  <span class="comment">// pointer, and a getelementptr of a specific form.</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::const_use_iterator</a> UI = V-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = V-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI != E;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;       ++UI) {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(*UI);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="comment">// Comparison against null is ok.</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *ICI = dyn_cast&lt;ICmpInst&gt;(User)) {</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;ConstantPointerNull&gt;(ICI-&gt;getOperand(1)))</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    }</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="comment">// getelementptr is also ok, but only a simple form.</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI = dyn_cast&lt;GetElementPtrInst&gt;(User)) {</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      <span class="comment">// Must index into the array and into the struct.</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <span class="keywordflow">if</span> (GEPI-&gt;getNumOperands() &lt; 3)</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      <span class="comment">// Otherwise the GEP is ok.</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    }</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(User)) {</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      <span class="keywordflow">if</span> (!LoadUsingPHIsPerLoad.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(PN))</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        <span class="comment">// This means some phi nodes are dependent on each other.</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        <span class="comment">// Avoid infinite looping!</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      <span class="keywordflow">if</span> (!LoadUsingPHIs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(PN))</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        <span class="comment">// If we have already analyzed this PHI, then it is safe.</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      <span class="comment">// Make sure all uses of the PHI are simple enough to transform.</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#a5abddaa1ca2270d02c0344679d425538">LoadUsesSimpleEnoughForHeapSRA</a>(PN,</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                                          LoadUsingPHIs, LoadUsingPHIsPerLoad))</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    }</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="comment">// Otherwise we don&#39;t know what this is, not ok.</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  }</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;}</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment">/// AllGlobalLoadUsesSimpleEnoughForHeapSRA - If all users of values loaded from</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="comment">/// GV are simple enough to perform HeapSRA, return true.</span></div><div class="line"><a name="l01107"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#ab190ff057361c31a374b5feefc10f586"> 1107</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#ab190ff057361c31a374b5feefc10f586">AllGlobalLoadUsesSimpleEnoughForHeapSRA</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV,</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;                                                    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *StoredVal) {</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const PHINode*, 32&gt;</a> LoadUsingPHIs;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const PHINode*, 32&gt;</a> LoadUsingPHIsPerLoad;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::const_use_iterator</a> UI = GV-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;       UI != E; ++UI)</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(*UI)) {</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#a5abddaa1ca2270d02c0344679d425538">LoadUsesSimpleEnoughForHeapSRA</a>(LI, LoadUsingPHIs,</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                                          LoadUsingPHIsPerLoad))</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      LoadUsingPHIsPerLoad.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#aa72472422d95c7052d62432ec279ff85">clear</a>();</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    }</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  <span class="comment">// If we reach here, we know that all uses of the loads and transitive uses</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="comment">// (through PHI nodes) are simple enough to transform.  However, we don&#39;t know</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  <span class="comment">// that all inputs the to the PHI nodes are in the same equivalence sets.</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  <span class="comment">// Check to verify that all operands of the PHIs are either PHIS that can be</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  <span class="comment">// transformed, loads from GV, or MI itself.</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;const PHINode*, 32&gt;::const_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = LoadUsingPHIs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">begin</a>()</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;       , E = LoadUsingPHIs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a7f055d0b03ebf1d6a5988b178e9b8f4f">end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> op = 0, e = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>(); op != e; ++op) {</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *InVal = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(op);</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      <span class="comment">// PHI of the stored value itself is ok.</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      <span class="keywordflow">if</span> (InVal == StoredVal) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *InPN = dyn_cast&lt;PHINode&gt;(InVal)) {</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        <span class="comment">// One of the PHIs in our set is (optimistically) ok.</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        <span class="keywordflow">if</span> (LoadUsingPHIs.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(InPN))</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;      }</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      <span class="comment">// Load from GV is ok.</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(InVal))</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        <span class="keywordflow">if</span> (LI-&gt;getOperand(0) == GV)</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      <span class="comment">// UNDEF? NULL?</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      <span class="comment">// Anything else is rejected.</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    }</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  }</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;}</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div><div class="line"><a name="l01156"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a33f39e494317a93a9f9c798714c44029"> 1156</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Value.html">Value</a> *<a class="code" href="GlobalOpt_8cpp.html#a33f39e494317a93a9f9c798714c44029">GetHeapSROAValue</a>(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <span class="keywordtype">unsigned</span> FieldNo,</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;               <a class="code" href="classllvm_1_1DenseMap.html">DenseMap</a>&lt;<a class="code" href="classllvm_1_1Value.html">Value</a>*, std::vector&lt;Value*&gt; &gt; &amp;InsertedScalarizedValues,</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                   std::vector&lt;std::pair&lt;PHINode*, unsigned&gt; &gt; &amp;PHIsToRewrite) {</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  std::vector&lt;Value*&gt; &amp;FieldVals = InsertedScalarizedValues[V];</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="keywordflow">if</span> (FieldNo &gt;= FieldVals.size())</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    FieldVals.resize(FieldNo+1);</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <span class="comment">// If we already have this value, just reuse the previously scalarized</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="comment">// version.</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Value.html">Value</a> *FieldVal = FieldVals[FieldNo])</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">return</span> FieldVal;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <span class="comment">// Depending on what instruction this is, we have several cases.</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *Result;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(V)) {</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="comment">// This is a scalarized version of the load from the global.  Just create</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="comment">// a new Load of the scalarized global.</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    Result = <span class="keyword">new</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>(<a class="code" href="GlobalOpt_8cpp.html#a33f39e494317a93a9f9c798714c44029">GetHeapSROAValue</a>(LI-&gt;getOperand(0), FieldNo,</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;                                           InsertedScalarizedValues,</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                                           PHIsToRewrite),</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                          LI-&gt;getName()+<span class="stringliteral">&quot;.f&quot;</span>+<a class="code" href="classllvm_1_1Twine.html">Twine</a>(FieldNo), LI);</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(V)) {</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="comment">// PN&#39;s type is pointer to struct.  Make a new PHI of pointer to struct</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="comment">// field.</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <a class="code" href="classllvm_1_1StructType.html">StructType</a> *<a class="code" href="namespacellvm_1_1A64DB.html#a6fce8157775f3ec93f326b52b0f1e0f5a4916e736d6b7cc68359b39d5eb50f6db">ST</a> = cast&lt;StructType&gt;(PN-&gt;getType()-&gt;getPointerElementType());</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *NewPN =</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;     <a class="code" href="classllvm_1_1PHINode.html#afb5e83bf5123ff7c51058eb0ebebcdc6">PHINode::Create</a>(<a class="code" href="classllvm_1_1PointerType.html#a8db49fd5069f21d514e7bb0fd11f0902">PointerType::getUnqual</a>(ST-&gt;<a class="code" href="classllvm_1_1StructType.html#a2f54639fcb5162f6f51192eb1697d2ad">getElementType</a>(FieldNo)),</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                     PN-&gt;getNumIncomingValues(),</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                     PN-&gt;getName()+<span class="stringliteral">&quot;.f&quot;</span>+<a class="code" href="classllvm_1_1Twine.html">Twine</a>(FieldNo), PN);</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    Result = NewPN;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    PHIsToRewrite.push_back(std::make_pair(PN, FieldNo));</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <a class="code" href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a>(<span class="stringliteral">&quot;Unknown usable value&quot;</span>);</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  }</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <span class="keywordflow">return</span> FieldVals[FieldNo] = Result;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;}</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="comment">/// RewriteHeapSROALoadUser - Given a load instruction and a value derived from</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="comment">/// the load, rewrite the derived value to use the HeapSRoA&#39;d load.</span></div><div class="line"><a name="l01198"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a3b41afcb0ed58c8ecb4b49fc1554c583"> 1198</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="GlobalOpt_8cpp.html#a3b41afcb0ed58c8ecb4b49fc1554c583">RewriteHeapSROALoadUser</a>(<a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *LoadUser,</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;             <a class="code" href="classllvm_1_1DenseMap.html">DenseMap</a>&lt;<a class="code" href="classllvm_1_1Value.html">Value</a>*, std::vector&lt;Value*&gt; &gt; &amp;InsertedScalarizedValues,</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                   std::vector&lt;std::pair&lt;PHINode*, unsigned&gt; &gt; &amp;PHIsToRewrite) {</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  <span class="comment">// If this is a comparison against null, handle it.</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a> *SCI = dyn_cast&lt;ICmpInst&gt;(LoadUser)) {</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    assert(isa&lt;ConstantPointerNull&gt;(SCI-&gt;getOperand(1)));</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <span class="comment">// If we have a setcc of the loaded pointer, we can use a setcc of any</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="comment">// field.</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NPtr = <a class="code" href="GlobalOpt_8cpp.html#a33f39e494317a93a9f9c798714c44029">GetHeapSROAValue</a>(SCI-&gt;getOperand(0), 0,</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;                                   InsertedScalarizedValues, PHIsToRewrite);</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *New = <span class="keyword">new</span> <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a>(SCI, SCI-&gt;getPredicate(), NPtr,</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                              <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(NPtr-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()),</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                              SCI-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>());</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    SCI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(New);</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    SCI-&gt;eraseFromParent();</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  }</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  <span class="comment">// Handle &#39;getelementptr Ptr, Idx, i32 FieldNo ...&#39;</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEPI = dyn_cast&lt;GetElementPtrInst&gt;(LoadUser)) {</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    assert(GEPI-&gt;getNumOperands() &gt;= 3 &amp;&amp; isa&lt;ConstantInt&gt;(GEPI-&gt;getOperand(2))</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;           &amp;&amp; <span class="stringliteral">&quot;Unexpected GEPI!&quot;</span>);</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="comment">// Load the pointer for this field.</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="keywordtype">unsigned</span> FieldNo = cast&lt;ConstantInt&gt;(GEPI-&gt;getOperand(2))-&gt;getZExtValue();</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NewPtr = <a class="code" href="GlobalOpt_8cpp.html#a33f39e494317a93a9f9c798714c44029">GetHeapSROAValue</a>(GEPI-&gt;getOperand(0), FieldNo,</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;                                     InsertedScalarizedValues, PHIsToRewrite);</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="comment">// Create the new GEP idx vector.</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Value*, 8&gt;</a> GEPIdx;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    GEPIdx.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(GEPI-&gt;getOperand(1));</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    GEPIdx.append(GEPI-&gt;op_begin()+3, GEPI-&gt;op_end());</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NGEPI = <a class="code" href="classllvm_1_1GetElementPtrInst.html#a1585a1ee545bef997b3120f87fd992a0">GetElementPtrInst::Create</a>(NewPtr, GEPIdx,</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;                                             GEPI-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>(), GEPI);</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    GEPI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NGEPI);</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    GEPI-&gt;eraseFromParent();</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  }</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="comment">// Recursively transform the users of PHI nodes.  This will lazily create the</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;  <span class="comment">// PHIs that are needed for individual elements.  Keep track of what PHIs we</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;  <span class="comment">// see in InsertedScalarizedValues so that we don&#39;t get infinite loops (very</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  <span class="comment">// antisocial).  If the PHI is already in InsertedScalarizedValues, it has</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="comment">// already been seen first by another load, so its uses have already been</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="comment">// processed.</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = cast&lt;PHINode&gt;(LoadUser);</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="keywordflow">if</span> (!InsertedScalarizedValues.insert(std::make_pair(PN,</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                                              std::vector&lt;Value*&gt;())).second)</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  <span class="comment">// If this is the first time we&#39;ve seen this PHI, recursively process all</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  <span class="comment">// users.</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = PN-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = PN-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI != E; ) {</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(*UI++);</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <a class="code" href="GlobalOpt_8cpp.html#a3b41afcb0ed58c8ecb4b49fc1554c583">RewriteHeapSROALoadUser</a>(User, InsertedScalarizedValues, PHIsToRewrite);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  }</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;}</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="comment">/// RewriteUsesOfLoadForHeapSRoA - We are performing Heap SRoA on a global.  Ptr</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="comment">/// is a value loaded from the global.  Eliminate all uses of Ptr, making them</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment">/// use FieldGlobals instead.  All uses of loaded values satisfy</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment">/// AllGlobalLoadUsesSimpleEnoughForHeapSRA.</span></div><div class="line"><a name="l01262"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a423016bbd81dcc13bc4855bf1bebca9b"> 1262</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="GlobalOpt_8cpp.html#a423016bbd81dcc13bc4855bf1bebca9b">RewriteUsesOfLoadForHeapSRoA</a>(<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *<a class="code" href="namespacellvm_1_1SPII.html#a11e9b8fca4a074643a6a21f444e51406a5069619ca8fdce305534f3fe85091a0f">Load</a>,</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;               <a class="code" href="classllvm_1_1DenseMap.html">DenseMap</a>&lt;<a class="code" href="classllvm_1_1Value.html">Value</a>*, std::vector&lt;Value*&gt; &gt; &amp;InsertedScalarizedValues,</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                   std::vector&lt;std::pair&lt;PHINode*, unsigned&gt; &gt; &amp;PHIsToRewrite) {</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = Load-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = Load-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>();</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;       UI != E; ) {</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(*UI++);</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <a class="code" href="GlobalOpt_8cpp.html#a3b41afcb0ed58c8ecb4b49fc1554c583">RewriteHeapSROALoadUser</a>(User, InsertedScalarizedValues, PHIsToRewrite);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;  }</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <span class="keywordflow">if</span> (Load-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    Load-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    InsertedScalarizedValues.erase(Load);</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  }</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;}</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment">/// PerformHeapAllocSRoA - CI is an allocation of an array of structures.  Break</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment">/// it up into multiple allocations of arrays of the fields.</span></div><div class="line"><a name="l01279"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#abe4ad4318c31fcbade247fb28b4bf06d"> 1279</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *<a class="code" href="GlobalOpt_8cpp.html#abe4ad4318c31fcbade247fb28b4bf06d">PerformHeapAllocSRoA</a>(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV, <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI,</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;                                            <a class="code" href="classllvm_1_1Value.html">Value</a> *NElems, <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD,</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                                            <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI) {</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;SROA HEAP ALLOC: &quot;</span> &lt;&lt; *GV &lt;&lt; <span class="stringliteral">&quot;  MALLOC = &quot;</span> &lt;&lt; *CI &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *MAT = <a class="code" href="namespacellvm.html#adc3d427ae53571c61269b58488af05df">getMallocAllocatedType</a>(CI, TLI);</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <a class="code" href="classllvm_1_1StructType.html">StructType</a> *STy = cast&lt;StructType&gt;(MAT);</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  <span class="comment">// There is guaranteed to be at least one use of the malloc (storing</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  <span class="comment">// it into GV).  If there are other uses, change them to be uses of</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  <span class="comment">// the global to simplify later code.  This also deletes the store</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <span class="comment">// into GV.</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  <a class="code" href="GlobalOpt_8cpp.html#a35445872809e31831849ca99f41540d0">ReplaceUsesOfMallocWithGlobal</a>(CI, GV);</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;  <span class="comment">// Okay, at this point, there are no users of the malloc.  Insert N</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  <span class="comment">// new mallocs at the same place as CI, and N globals.</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  std::vector&lt;Value*&gt; FieldGlobals;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  std::vector&lt;Value*&gt; FieldMallocs;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> FieldNo = 0, e = STy-&gt;<a class="code" href="classllvm_1_1StructType.html#aa2113dcf8c96c19c9a2abf786b9ad3b7">getNumElements</a>(); FieldNo != e;++FieldNo){</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *FieldTy = STy-&gt;<a class="code" href="classllvm_1_1StructType.html#a2f54639fcb5162f6f51192eb1697d2ad">getElementType</a>(FieldNo);</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <a class="code" href="classllvm_1_1PointerType.html">PointerType</a> *PFieldTy = <a class="code" href="classllvm_1_1PointerType.html#a8db49fd5069f21d514e7bb0fd11f0902">PointerType::getUnqual</a>(FieldTy);</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *NGV =</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(*GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>(),</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;                         PFieldTy, <span class="keyword">false</span>, <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>,</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                         <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(PFieldTy),</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;                         GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() + <span class="stringliteral">&quot;.f&quot;</span> + <a class="code" href="classllvm_1_1Twine.html">Twine</a>(FieldNo), GV,</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                         GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ab1b932862d7d88dae34cfd24f44847a3">getThreadLocalMode</a>());</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    FieldGlobals.push_back(NGV);</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <span class="keywordtype">unsigned</span> TypeSize = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(FieldTy);</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *<a class="code" href="namespacellvm_1_1A64DB.html#a6fce8157775f3ec93f326b52b0f1e0f5a4916e736d6b7cc68359b39d5eb50f6db">ST</a> = dyn_cast&lt;StructType&gt;(FieldTy))</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      TypeSize = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a35c840104f32575e0d91422cf1ef3ce4">getStructLayout</a>(<a class="code" href="namespacellvm_1_1A64DB.html#a6fce8157775f3ec93f326b52b0f1e0f5a4916e736d6b7cc68359b39d5eb50f6db">ST</a>)-&gt;<a class="code" href="classllvm_1_1StructLayout.html#a582a5b21a8f91d7f713fa9d57c0525de">getSizeInBytes</a>();</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *IntPtrTy = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#ae84bb2408dfffa4e8b5fe2ce0714a3bd">getIntPtrType</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *NMI = <a class="code" href="classllvm_1_1CallInst.html#a698a8880c71364b5f9bc468a7b0e1fae">CallInst::CreateMalloc</a>(CI, IntPtrTy, FieldTy,</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;                                        <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(IntPtrTy, TypeSize),</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;                                        NElems, 0,</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;                                        CI-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() + <span class="stringliteral">&quot;.f&quot;</span> + <a class="code" href="classllvm_1_1Twine.html">Twine</a>(FieldNo));</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    FieldMallocs.push_back(NMI);</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(NMI, NGV, CI);</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  }</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  <span class="comment">// The tricky aspect of this transformation is handling the case when malloc</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  <span class="comment">// fails.  In the original code, malloc failing would set the result pointer</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  <span class="comment">// of malloc to null.  In this case, some mallocs could succeed and others</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  <span class="comment">// could fail.  As such, we emit code that looks like this:</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  <span class="comment">//    F0 = malloc(field0)</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <span class="comment">//    F1 = malloc(field1)</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <span class="comment">//    F2 = malloc(field2)</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  <span class="comment">//    if (F0 == 0 || F1 == 0 || F2 == 0) {</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  <span class="comment">//      if (F0) { free(F0); F0 = 0; }</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  <span class="comment">//      if (F1) { free(F1); F1 = 0; }</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;  <span class="comment">//      if (F2) { free(F2); F2 = 0; }</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;  <span class="comment">//    }</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  <span class="comment">// The malloc can also fail if its argument is too large.</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *ConstantZero = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), 0);</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *RunningOr = <span class="keyword">new</span> <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a>(CI, <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a15ae464950ac676919c2f0c7aafc706c">ICmpInst::ICMP_SLT</a>, CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(0),</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;                                  ConstantZero, <span class="stringliteral">&quot;isneg&quot;</span>);</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = FieldMallocs.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Cond = <span class="keyword">new</span> <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a>(CI, <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05aa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP_EQ</a>, FieldMallocs[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>],</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;                             <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(FieldMallocs[i]-&gt;<a class="code" href="namespacellvm_1_1Intrinsic.html#ac015f68d60ea67a2e31bc10bc720d3e8">getType</a>()),</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                               <span class="stringliteral">&quot;isnull&quot;</span>);</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    RunningOr = BinaryOperator::CreateOr(RunningOr, Cond, <span class="stringliteral">&quot;tmp&quot;</span>, CI);</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  }</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  <span class="comment">// Split the basic block at the old malloc.</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *OrigBB = CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">getParent</a>();</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ContBB = OrigBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a19445f836d9e1ecb32cba27ec4338fff">splitBasicBlock</a>(CI, <span class="stringliteral">&quot;malloc_cont&quot;</span>);</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  <span class="comment">// Create the block to check the first condition.  Put all these blocks at the</span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  <span class="comment">// end of the function as they are unlikely to be executed.</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NullPtrBlock = <a class="code" href="classllvm_1_1BasicBlock.html#ae1d53a21892854816885c7288f8b46f1">BasicBlock::Create</a>(OrigBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#ad652423d9d91271ba153eb86482b2f55">getContext</a>(),</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                                                <span class="stringliteral">&quot;malloc_ret_null&quot;</span>,</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                                                OrigBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>());</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  <span class="comment">// Remove the uncond branch from OrigBB to ContBB, turning it into a cond</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  <span class="comment">// branch on RunningOr.</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;  OrigBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>()-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html#ae9cbc599309fd2da33ec1c61df01ce1f">BranchInst::Create</a>(NullPtrBlock, ContBB, RunningOr, OrigBB);</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  <span class="comment">// Within the NullPtrBlock, we need to emit a comparison and branch for each</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;  <span class="comment">// pointer, because some may be null while others are not.</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = FieldGlobals.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *GVVal = <span class="keyword">new</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>(FieldGlobals[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], <span class="stringliteral">&quot;tmp&quot;</span>, NullPtrBlock);</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    <a class="code" href="classllvm_1_1Value.html">Value</a> *Cmp = <span class="keyword">new</span> <a class="code" href="classllvm_1_1ICmpInst.html">ICmpInst</a>(*NullPtrBlock, <a class="code" href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05ac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP_NE</a>, GVVal,</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                              <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(GVVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()));</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *FreeBlock = <a class="code" href="classllvm_1_1BasicBlock.html#ae1d53a21892854816885c7288f8b46f1">BasicBlock::Create</a>(Cmp-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), <span class="stringliteral">&quot;free_it&quot;</span>,</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                                               OrigBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>());</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NextBlock = <a class="code" href="classllvm_1_1BasicBlock.html#ae1d53a21892854816885c7288f8b46f1">BasicBlock::Create</a>(Cmp-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>(), <span class="stringliteral">&quot;next&quot;</span>,</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                                               OrigBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">getParent</a>());</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *BI = <a class="code" href="classllvm_1_1BranchInst.html#ae9cbc599309fd2da33ec1c61df01ce1f">BranchInst::Create</a>(FreeBlock, NextBlock,</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;                                         Cmp, NullPtrBlock);</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    <span class="comment">// Fill in FreeBlock.</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <a class="code" href="classllvm_1_1CallInst.html#a1d37f5425e608e65775ffe52c425a66c">CallInst::CreateFree</a>(GVVal, BI);</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(<a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(GVVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()), FieldGlobals[i],</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;                  FreeBlock);</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    <a class="code" href="classllvm_1_1BranchInst.html#ae9cbc599309fd2da33ec1c61df01ce1f">BranchInst::Create</a>(NextBlock, FreeBlock);</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    NullPtrBlock = NextBlock;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  }</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <a class="code" href="classllvm_1_1BranchInst.html#ae9cbc599309fd2da33ec1c61df01ce1f">BranchInst::Create</a>(ContBB, NullPtrBlock);</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="comment">// CI is no longer needed, remove it.</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">  /// InsertedScalarizedLoads - As we process loads, if we can&#39;t immediately</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">  /// update all uses of the load, keep track of what scalarized loads are</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment">  /// inserted for a given load.</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value*, std::vector&lt;Value*&gt;</a> &gt; InsertedScalarizedValues;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  InsertedScalarizedValues[GV] = FieldGlobals;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  std::vector&lt;std::pair&lt;PHINode*, unsigned&gt; &gt; PHIsToRewrite;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="comment">// Okay, the malloc site is completely handled.  All of the uses of GV are now</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  <span class="comment">// loads, and all uses of those loads are simple.  Rewrite them to use loads</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;  <span class="comment">// of the per-field globals instead.</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = GV-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI != E;) {</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *<a class="code" href="classllvm_1_1User.html">User</a> = cast&lt;Instruction&gt;(*UI++);</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(User)) {</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;      <a class="code" href="GlobalOpt_8cpp.html#a423016bbd81dcc13bc4855bf1bebca9b">RewriteUsesOfLoadForHeapSRoA</a>(LI, InsertedScalarizedValues, PHIsToRewrite);</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    }</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    <span class="comment">// Must be a store of null.</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = cast&lt;StoreInst&gt;(User);</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    assert(isa&lt;ConstantPointerNull&gt;(SI-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0)) &amp;&amp;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;           <span class="stringliteral">&quot;Unexpected heap-sra user!&quot;</span>);</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    <span class="comment">// Insert a store of null into each global.</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = FieldGlobals.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;      <a class="code" href="classllvm_1_1PointerType.html">PointerType</a> *PT = cast&lt;PointerType&gt;(FieldGlobals[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;getType());</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Null = <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(PT-&gt;<a class="code" href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">getElementType</a>());</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(Null, FieldGlobals[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>], SI);</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    }</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="comment">// Erase the original store.</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    SI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  }</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  <span class="comment">// While we have PHIs that are interesting to rewrite, do it.</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  <span class="keywordflow">while</span> (!PHIsToRewrite.empty()) {</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = PHIsToRewrite.back().first;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <span class="keywordtype">unsigned</span> FieldNo = PHIsToRewrite.back().second;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    PHIsToRewrite.pop_back();</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *FieldPN = cast&lt;PHINode&gt;(InsertedScalarizedValues[PN][FieldNo]);</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    assert(FieldPN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>() == 0 &amp;&amp;<span class="stringliteral">&quot;Already processed this phi&quot;</span>);</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <span class="comment">// Add all the incoming values.  This can materialize more phis.</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">getNumIncomingValues</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *InVal = PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">getIncomingValue</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      InVal = <a class="code" href="GlobalOpt_8cpp.html#a33f39e494317a93a9f9c798714c44029">GetHeapSROAValue</a>(InVal, FieldNo, InsertedScalarizedValues,</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;                               PHIsToRewrite);</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      FieldPN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(InVal, PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">getIncomingBlock</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    }</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  }</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;  <span class="comment">// Drop all inter-phi links and any loads that made it this far.</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1DenseMap.html">DenseMap</a>&lt;<a class="code" href="classllvm_1_1Value.html">Value</a>*, std::vector&lt;Value*&gt; &gt;::iterator</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = InsertedScalarizedValues.<a class="code" href="classllvm_1_1DenseMapBase.html#a432d7e955f44b118b4261eae03d7a8af">begin</a>(), E = InsertedScalarizedValues.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>();</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first))</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      PN-&gt;dropAllReferences();</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first))</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;      LI-&gt;dropAllReferences();</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  }</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <span class="comment">// Delete all the phis and loads now that inter-references are dead.</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1DenseMap.html">DenseMap</a>&lt;<a class="code" href="classllvm_1_1Value.html">Value</a>*, std::vector&lt;Value*&gt; &gt;::iterator</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = InsertedScalarizedValues.<a class="code" href="classllvm_1_1DenseMapBase.html#a432d7e955f44b118b4261eae03d7a8af">begin</a>(), E = InsertedScalarizedValues.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>();</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = dyn_cast&lt;PHINode&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first))</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      PN-&gt;eraseFromParent();</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first))</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      LI-&gt;eraseFromParent();</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  }</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;  <span class="comment">// The old global is now dead, remove it.</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;  GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;  ++NumHeapSRA;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="keywordflow">return</span> cast&lt;GlobalVariable&gt;(FieldGlobals[0]);</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;}</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="comment">/// TryToOptimizeStoreOfMallocToGlobal - This function is called when we see a</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="comment">/// pointer global variable with a single value stored it that is a malloc or</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="comment">/// cast of malloc.</span></div><div class="line"><a name="l01467"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a83ed3f5555682a0bac5a9454885f2bac"> 1467</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a83ed3f5555682a0bac5a9454885f2bac">TryToOptimizeStoreOfMallocToGlobal</a>(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV,</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;                                               <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI,</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;                                               <a class="code" href="classllvm_1_1Type.html">Type</a> *AllocTy,</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;                                               <a class="code" href="namespacellvm.html#abf74b2f0dbae96f4708d3e407b36df02">AtomicOrdering</a> Ordering,</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;                                               <a class="code" href="classllvm_1_1ilist__iterator.html">Module::global_iterator</a> &amp;GVI,</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;                                               <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD,</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;                                               <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI) {</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  <span class="keywordflow">if</span> (!TD)</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  <span class="comment">// If this is a malloc of an abstract type, don&#39;t touch it.</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  <span class="keywordflow">if</span> (!AllocTy-&gt;<a class="code" href="classllvm_1_1Type.html#a9dc5111b1a9b1d5c4652d50f74fe850b">isSized</a>())</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  <span class="comment">// We can&#39;t optimize this global unless all uses of it are *known* to be</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;  <span class="comment">// of the malloc value, not of the null initializer value (consider a use</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;  <span class="comment">// that compares the global&#39;s value against zero to see if the malloc has</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  <span class="comment">// been reached).  To do this, we check to see if all uses of the global</span></div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;  <span class="comment">// would trap if the global were null: this proves that they must all</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;  <span class="comment">// happen after the malloc.</span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#a6534eab7f2125fdeff4232f790c07e05">AllUsesOfLoadedValueWillTrapIfNull</a>(GV))</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  <span class="comment">// We can&#39;t optimize this if the malloc itself is used in a complex way,</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;  <span class="comment">// for example, being stored into multiple globals.  This allows the</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  <span class="comment">// malloc to be stored into the specified global, loaded icmp&#39;d, and</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;  <span class="comment">// GEP&#39;d.  These are all things we could transform to using the global</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  <span class="comment">// for.</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const PHINode*, 8&gt;</a> PHIs;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#ad509f84445ce77b94e2d70042449202f">ValueIsOnlyUsedLocallyOrStoredToOneGlobal</a>(CI, GV, PHIs))</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  <span class="comment">// If we have a global that is only initialized with a fixed size malloc,</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;  <span class="comment">// transform the program to use global memory instead of malloc&#39;d memory.</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;  <span class="comment">// This eliminates dynamic allocation, avoids an indirection accessing the</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;  <span class="comment">// data, and exposes the resultant global to further GlobalOpt.</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;  <span class="comment">// We cannot optimize the malloc if we cannot determine malloc array size.</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  <a class="code" href="classllvm_1_1Value.html">Value</a> *NElems = <a class="code" href="namespacellvm.html#ab2a615783bce35374d64da662869ac3d">getMallocArraySize</a>(CI, TD, TLI, <span class="keyword">true</span>);</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  <span class="keywordflow">if</span> (!NElems)</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *NElements = dyn_cast&lt;ConstantInt&gt;(NElems))</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    <span class="comment">// Restrict this transformation to only working on small allocations</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <span class="comment">// (2048 bytes currently), as we don&#39;t want to introduce a 16M global or</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    <span class="comment">// something.</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <span class="keywordflow">if</span> (NElements-&gt;getZExtValue() * TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">getTypeAllocSize</a>(AllocTy) &lt; 2048) {</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      GVI = <a class="code" href="GlobalOpt_8cpp.html#a387ee79de1e991d8a1ebe6c495332eae">OptimizeGlobalAddressOfMalloc</a>(GV, CI, AllocTy, NElements, TD, TLI);</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    }</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  <span class="comment">// If the allocation is an array of structures, consider transforming this</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  <span class="comment">// into multiple malloc&#39;d arrays, one for each field.  This is basically</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  <span class="comment">// SRoA for malloc&#39;d memory.</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;  <span class="keywordflow">if</span> (Ordering != <a class="code" href="namespacellvm.html#abf74b2f0dbae96f4708d3e407b36df02ad1fbbfdf093cdd213b0df02550ac94d0">NotAtomic</a>)</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;  <span class="comment">// If this is an allocation of a fixed size array of structs, analyze as a</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;  <span class="comment">// variable size array.  malloc [100 x struct],1 -&gt; malloc struct, 100</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;  <span class="keywordflow">if</span> (NElems == <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), 1))</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *AT = dyn_cast&lt;ArrayType&gt;(AllocTy))</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;      AllocTy = AT-&gt;getElementType();</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <a class="code" href="classllvm_1_1StructType.html">StructType</a> *AllocSTy = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1StructType.html">StructType</a>&gt;(AllocTy);</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  <span class="keywordflow">if</span> (!AllocSTy)</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  <span class="comment">// This the structure has an unreasonable number of fields, leave it</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;  <span class="comment">// alone.</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  <span class="keywordflow">if</span> (AllocSTy-&gt;<a class="code" href="classllvm_1_1StructType.html#aa2113dcf8c96c19c9a2abf786b9ad3b7">getNumElements</a>() &lt;= 16 &amp;&amp; AllocSTy-&gt;<a class="code" href="classllvm_1_1StructType.html#aa2113dcf8c96c19c9a2abf786b9ad3b7">getNumElements</a>() != 0 &amp;&amp;</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;      <a class="code" href="GlobalOpt_8cpp.html#ab190ff057361c31a374b5feefc10f586">AllGlobalLoadUsesSimpleEnoughForHeapSRA</a>(GV, CI)) {</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    <span class="comment">// If this is a fixed size array, transform the Malloc to be an alloc of</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    <span class="comment">// structs.  malloc [100 x struct],1 -&gt; malloc struct, 100</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *AT = dyn_cast&lt;ArrayType&gt;(<a class="code" href="namespacellvm.html#adc3d427ae53571c61269b58488af05df">getMallocAllocatedType</a>(CI, TLI))) {</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *IntPtrTy = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#ae84bb2408dfffa4e8b5fe2ce0714a3bd">getIntPtrType</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;      <span class="keywordtype">unsigned</span> TypeSize = TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a35c840104f32575e0d91422cf1ef3ce4">getStructLayout</a>(AllocSTy)-&gt;<a class="code" href="classllvm_1_1StructLayout.html#a582a5b21a8f91d7f713fa9d57c0525de">getSizeInBytes</a>();</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *AllocSize = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(IntPtrTy, TypeSize);</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *NumElements = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(IntPtrTy, AT-&gt;getNumElements());</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Malloc = <a class="code" href="classllvm_1_1CallInst.html#a698a8880c71364b5f9bc468a7b0e1fae">CallInst::CreateMalloc</a>(CI, IntPtrTy, AllocSTy,</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;                                                   AllocSize, NumElements,</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;                                                   0, CI-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>());</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;      <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *Cast = <span class="keyword">new</span> <a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a>(Malloc, CI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), <span class="stringliteral">&quot;tmp&quot;</span>, CI);</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;      CI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Cast);</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;      CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BitCastInst.html">BitCastInst</a> *BCI = dyn_cast&lt;BitCastInst&gt;(Malloc))</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        CI = cast&lt;CallInst&gt;(BCI-&gt;getOperand(0));</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        CI = cast&lt;CallInst&gt;(Malloc);</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    }</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    GVI = <a class="code" href="GlobalOpt_8cpp.html#abe4ad4318c31fcbade247fb28b4bf06d">PerformHeapAllocSRoA</a>(GV, CI, <a class="code" href="namespacellvm.html#ab2a615783bce35374d64da662869ac3d">getMallocArraySize</a>(CI, TD, TLI, <span class="keyword">true</span>),</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;                               TD, TLI);</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  }</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;}</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="comment">// OptimizeOnceStoredGlobal - Try to optimize globals based on the knowledge</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;<span class="comment">// that only one value (besides its initializer) is ever stored to the global.</span></div><div class="line"><a name="l01568"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a86bc8cc11d43b9268dafa031dd7343dd"> 1568</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a86bc8cc11d43b9268dafa031dd7343dd">OptimizeOnceStoredGlobal</a>(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV, <a class="code" href="classllvm_1_1Value.html">Value</a> *StoredOnceVal,</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                                     <a class="code" href="namespacellvm.html#abf74b2f0dbae96f4708d3e407b36df02">AtomicOrdering</a> Ordering,</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                                     <a class="code" href="classllvm_1_1ilist__iterator.html">Module::global_iterator</a> &amp;GVI,</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                                     <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD, <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI) {</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  <span class="comment">// Ignore no-op GEPs and bitcasts.</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  StoredOnceVal = StoredOnceVal-&gt;<a class="code" href="classllvm_1_1Value.html#a38ea12c04523d63adda732b9c5d6da0a">stripPointerCasts</a>();</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  <span class="comment">// If we are dealing with a pointer global that is initialized to null and</span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;  <span class="comment">// only has one (non-null) value stored into it, then we can optimize any</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  <span class="comment">// users of the loaded value (often calls and loads) that would trap if the</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  <span class="comment">// value was null.</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  <span class="keywordflow">if</span> (GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>() &amp;&amp;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;      GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>()-&gt;<a class="code" href="classllvm_1_1Constant.html#ad7ec8482f19e8e86e3de573b060a17e5">isNullValue</a>()) {</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *SOVC = dyn_cast&lt;Constant&gt;(StoredOnceVal)) {</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;      <span class="keywordflow">if</span> (GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() != SOVC-&gt;getType())</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;        SOVC = <a class="code" href="classllvm_1_1ConstantExpr.html#aba93ec4079f8d709a1d5b4745310782e">ConstantExpr::getBitCast</a>(SOVC, GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      <span class="comment">// Optimize away any trapping uses of the loaded value.</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="GlobalOpt_8cpp.html#a77f379dd4a6b268b3f574dc53301a6e8">OptimizeAwayTrappingUsesOfLoads</a>(GV, SOVC, TD, TLI))</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = <a class="code" href="namespacellvm.html#a557c0bd50d6a6439ad6a9afcf8e340b5">extractMallocCall</a>(StoredOnceVal, TLI)) {</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *MallocType = <a class="code" href="namespacellvm.html#adc3d427ae53571c61269b58488af05df">getMallocAllocatedType</a>(CI, TLI);</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      <span class="keywordflow">if</span> (MallocType &amp;&amp;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;          <a class="code" href="GlobalOpt_8cpp.html#a83ed3f5555682a0bac5a9454885f2bac">TryToOptimizeStoreOfMallocToGlobal</a>(GV, CI, MallocType, Ordering, GVI,</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;                                             TD, TLI))</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    }</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  }</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;}</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="comment">/// TryToShrinkGlobalToBoolean - At this point, we have learned that the only</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="comment">/// two values ever stored into GV are its initializer and OtherVal.  See if we</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="comment">/// can shrink the global into a boolean and select between the two values</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="comment">/// whenever it is used.  This exposes the values to other scalar optimizations.</span></div><div class="line"><a name="l01604"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a77de6d50432bef62e38fd24f2030026c"> 1604</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a77de6d50432bef62e38fd24f2030026c">TryToShrinkGlobalToBoolean</a>(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV, <a class="code" href="classllvm_1_1Constant.html">Constant</a> *OtherVal) {</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;  <a class="code" href="classllvm_1_1Type.html">Type</a> *GVElType = GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>()-&gt;<a class="code" href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">getElementType</a>();</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;  <span class="comment">// If GVElType is already i1, it is already shrunk.  If the type of the GV is</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;  <span class="comment">// an FP value, pointer or vector, don&#39;t do this optimization because a select</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;  <span class="comment">// between them is very expensive and unlikely to lead to later</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;  <span class="comment">// simplification.  In these cases, we typically end up with &quot;cond ? v1 : v2&quot;</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  <span class="comment">// where v1 and v2 both require constant pool loads, a big loss.</span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;  <span class="keywordflow">if</span> (GVElType == <a class="code" href="classllvm_1_1Type.html#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(GV-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()) ||</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      GVElType-&gt;<a class="code" href="classllvm_1_1Type.html#a40113570b0c52a18c34cabed8359e2c8">isFloatingPointTy</a>() ||</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;      GVElType-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>() || GVElType-&gt;<a class="code" href="classllvm_1_1Type.html#a6f725580f7834e2ca90762965866dad4">isVectorTy</a>())</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  <span class="comment">// Walk the use list of the global seeing if all the uses are load or store.</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;  <span class="comment">// If there is anything else, bail out.</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = GV-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>){</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <a class="code" href="classllvm_1_1User.html">User</a> *U = *<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;LoadInst&gt;(U) &amp;&amp; !isa&lt;StoreInst&gt;(U))</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  }</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;  <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;   *** SHRINKING TO BOOL: &quot;</span> &lt;&lt; *GV);</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;  <span class="comment">// Create the new global, initializing it to false.</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *NewGV = <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(<a class="code" href="classllvm_1_1Type.html#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(GV-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()),</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                                             <span class="keyword">false</span>,</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                                             <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>,</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                                        <a class="code" href="classllvm_1_1ConstantInt.html#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(GV-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()),</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                                             GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.b&quot;</span>,</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                                             GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ab1b932862d7d88dae34cfd24f44847a3">getThreadLocalMode</a>(),</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;                                             GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>()-&gt;<a class="code" href="classllvm_1_1PointerType.html#a921061a57ec3cfbaf6422f09f7d79fc3">getAddressSpace</a>());</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;  GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>()-&gt;<a class="code" href="classllvm_1_1Module.html#a28c0310f56c2ea41ff7012df55ac6dc5">getGlobalList</a>().<a class="code" href="classllvm_1_1iplist.html#a35c71de7e8bbe3c0353d042beb58263f">insert</a>(GV, NewGV);</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *InitVal = GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>();</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;  assert(InitVal-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() != <a class="code" href="classllvm_1_1Type.html#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(GV-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()) &amp;&amp;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;         <span class="stringliteral">&quot;No reason to shrink to bool!&quot;</span>);</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;  <span class="comment">// If initialized to zero and storing one into the global, we can use a cast</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;  <span class="comment">// instead of a select to synthesize the desired value.</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;  <span class="keywordtype">bool</span> IsOneZero = <span class="keyword">false</span>;</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = dyn_cast&lt;ConstantInt&gt;(OtherVal))</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    IsOneZero = InitVal-&gt;<a class="code" href="classllvm_1_1Constant.html#ad7ec8482f19e8e86e3de573b060a17e5">isNullValue</a>() &amp;&amp; CI-&gt;isOne();</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;  <span class="keywordflow">while</span> (!GV-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *UI = cast&lt;Instruction&gt;(GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad9a329f9f85bc896a726a628aa3f4e9d">use_back</a>());</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(UI)) {</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;      <span class="comment">// Change the store into a boolean store.</span></div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;      <span class="keywordtype">bool</span> StoringOther = SI-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0) == OtherVal;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;      <span class="comment">// Only do this if we weren&#39;t storing a loaded value.</span></div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *StoreVal;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;      <span class="keywordflow">if</span> (StoringOther || SI-&gt;getOperand(0) == InitVal) {</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        StoreVal = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(<a class="code" href="classllvm_1_1Type.html#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(GV-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()),</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;                                    StoringOther);</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        <span class="comment">// Otherwise, we are storing a previously loaded copy.  To do this,</span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        <span class="comment">// change the copy from copying the original value to just copying the</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        <span class="comment">// bool.</span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> *StoredVal = cast&lt;Instruction&gt;(SI-&gt;getOperand(0));</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        <span class="comment">// If we&#39;ve already replaced the input, StoredVal will be a cast or</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        <span class="comment">// select instruction.  If not, it will be a load of the original</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        <span class="comment">// global.</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(StoredVal)) {</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;          assert(LI-&gt;getOperand(0) == GV &amp;&amp; <span class="stringliteral">&quot;Not a copy!&quot;</span>);</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;          <span class="comment">// Insert a new load, to preserve the saved value.</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;          StoreVal = <span class="keyword">new</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>(NewGV, LI-&gt;getName()+<span class="stringliteral">&quot;.b&quot;</span>, <span class="keyword">false</span>, 0,</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;                                  LI-&gt;getOrdering(), LI-&gt;getSynchScope(), LI);</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;          assert((isa&lt;CastInst&gt;(StoredVal) || isa&lt;SelectInst&gt;(StoredVal)) &amp;&amp;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                 <span class="stringliteral">&quot;This is not a form that we understand!&quot;</span>);</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;          StoreVal = StoredVal-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0);</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;          assert(isa&lt;LoadInst&gt;(StoreVal) &amp;&amp; <span class="stringliteral">&quot;Not a load of NewGV!&quot;</span>);</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        }</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      }</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;      <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(StoreVal, NewGV, <span class="keyword">false</span>, 0,</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;                    SI-&gt;getOrdering(), SI-&gt;getSynchScope(), SI);</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      <span class="comment">// Change the load into a load of bool then a select.</span></div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;      <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = cast&lt;LoadInst&gt;(UI);</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;      <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *NLI = <span class="keyword">new</span> <a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a>(NewGV, LI-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()+<span class="stringliteral">&quot;.b&quot;</span>, <span class="keyword">false</span>, 0,</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;                                   LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a8c0a29ecc14dc5afe7573bf616da2361">getOrdering</a>(), LI-&gt;<a class="code" href="classllvm_1_1LoadInst.html#a4df7359cb36b166c0878e16291cbe183">getSynchScope</a>(), LI);</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;      <a class="code" href="classllvm_1_1Value.html">Value</a> *NSI;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;      <span class="keywordflow">if</span> (IsOneZero)</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;        NSI = <span class="keyword">new</span> <a class="code" href="classllvm_1_1ZExtInst.html">ZExtInst</a>(NLI, LI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), <span class="stringliteral">&quot;&quot;</span>, LI);</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;        NSI = <a class="code" href="classllvm_1_1SelectInst.html#a8bce457e977f23507c48c9dfd7052990">SelectInst::Create</a>(NLI, OtherVal, InitVal, <span class="stringliteral">&quot;&quot;</span>, LI);</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;      NSI-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(LI);</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;      LI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NSI);</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    }</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    UI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;  }</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;  <span class="comment">// Retain the name of the old global variable. People who are debugging their</span></div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  <span class="comment">// programs may expect these variables to be named the same.</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  NewGV-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(GV);</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;  GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;}</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;<span class="comment">/// ProcessGlobal - Analyze the specified global variable and optimize it if</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="comment">/// possible.  If we make a change, return true.</span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> GlobalOpt::ProcessGlobal(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV,</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                              <a class="code" href="classllvm_1_1ilist__iterator.html">Module::global_iterator</a> &amp;GVI) {</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;  <span class="keywordflow">if</span> (!GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#adcb86d621c23938671ad526d3bd1f9bd">isDiscardableIfUnused</a>())</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;  <span class="comment">// Do more involved optimizations if the global is internal.</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  GV-&gt;<a class="code" href="classllvm_1_1Constant.html#a50d0911852017f2168de329f53d8568d">removeDeadConstantUsers</a>();</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;  <span class="keywordflow">if</span> (GV-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;GLOBAL DEAD: &quot;</span> &lt;&lt; *GV);</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    ++NumDeleted;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;  }</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  <span class="keywordflow">if</span> (!GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#abefc2d8baa67d6f9e49c95912cfde480">hasLocalLinkage</a>())</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;  <a class="code" href="structllvm_1_1GlobalStatus.html">GlobalStatus</a> <a class="code" href="namespacellvm_1_1X86II.html#a97dc14052814702ba0e2b14fb14dd02dacdc4d0fa74813b50797e25bab4febe70">GS</a>;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="structllvm_1_1GlobalStatus.html#ae58ea7b3b03443e976cbef09ac25cf00">GlobalStatus::analyzeGlobal</a>(GV, GS))</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;  <span class="keywordflow">if</span> (!GS.<a class="code" href="structllvm_1_1GlobalStatus.html#a793ea7e324427fc88ccdf62294b63fad">IsCompared</a> &amp;&amp; !GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ac02b37f1016fb8ad589cf26a4e1e0b14">hasUnnamedAddr</a>()) {</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a91ebd7b5d66cc73396c43f4c056050d6">setUnnamedAddr</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    NumUnnamed++;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;  }</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;  <span class="keywordflow">if</span> (GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#a1500a3fe55cf38153aa1e0fbe7284e05">isConstant</a>() || !GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#a0d94a4e78681b58ae3b2dbbd0627a847">hasInitializer</a>())</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;  <span class="keywordflow">return</span> ProcessInternalGlobal(GV, GVI, GS);</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;}</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="comment">/// ProcessInternalGlobal - Analyze the specified global variable and optimize</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment">/// it if possible.  If we make a change, return true.</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> GlobalOpt::ProcessInternalGlobal(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV,</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;                                      <a class="code" href="classllvm_1_1ilist__iterator.html">Module::global_iterator</a> &amp;GVI,</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                                      <span class="keyword">const</span> <a class="code" href="structllvm_1_1GlobalStatus.html">GlobalStatus</a> &amp;<a class="code" href="namespacellvm_1_1X86II.html#a97dc14052814702ba0e2b14fb14dd02dacdc4d0fa74813b50797e25bab4febe70">GS</a>) {</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;  <span class="comment">// If this is a first class global and has only one accessing function</span></div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;  <span class="comment">// and this function is main (which we know is not recursive), we replace</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;  <span class="comment">// the global with a local alloca in this function.</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  <span class="comment">// NOTE: It doesn&#39;t make sense to promote non single-value types since we</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  <span class="comment">// are just replacing static memory to stack memory.</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;  <span class="comment">// If the global is in different address space, don&#39;t bring it to stack.</span></div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;  <span class="keywordflow">if</span> (!GS.<a class="code" href="structllvm_1_1GlobalStatus.html#a31d0dff181f81a41bb701e89600fe324">HasMultipleAccessingFunctions</a> &amp;&amp;</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;      GS.<a class="code" href="structllvm_1_1GlobalStatus.html#abdf22b304eab8994314a2a89c00103fc">AccessingFunction</a> &amp;&amp; !GS.<a class="code" href="structllvm_1_1GlobalStatus.html#a255b1838fd534fde4ec9f1779320613b">HasNonInstructionUser</a> &amp;&amp;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;      GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>()-&gt;<a class="code" href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">getElementType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a36e21267fe14e69d3251eab1cd3a0076">isSingleValueType</a>() &amp;&amp;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;      GS.<a class="code" href="structllvm_1_1GlobalStatus.html#abdf22b304eab8994314a2a89c00103fc">AccessingFunction</a>-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() == <span class="stringliteral">&quot;main&quot;</span> &amp;&amp;</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;      GS.<a class="code" href="structllvm_1_1GlobalStatus.html#abdf22b304eab8994314a2a89c00103fc">AccessingFunction</a>-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a0f606d92ce05aaf49a893d7a1f55da68">hasExternalLinkage</a>() &amp;&amp;</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>()-&gt;<a class="code" href="classllvm_1_1PointerType.html#a921061a57ec3cfbaf6422f09f7d79fc3">getAddressSpace</a>() == 0) {</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;LOCALIZING GLOBAL: &quot;</span> &lt;&lt; *GV);</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <a class="code" href="classllvm_1_1Instruction.html">Instruction</a> &amp;FirstI = <span class="keyword">const_cast&lt;</span><a class="code" href="classllvm_1_1Instruction.html">Instruction</a>&amp;<span class="keyword">&gt;</span>(*GS.<a class="code" href="structllvm_1_1GlobalStatus.html#abdf22b304eab8994314a2a89c00103fc">AccessingFunction</a></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;                                                   -&gt;<a class="code" href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">getEntryBlock</a>().<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <a class="code" href="classllvm_1_1Type.html">Type</a> *ElemTy = GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>()-&gt;<a class="code" href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">getElementType</a>();</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="comment">// FIXME: Pass Global&#39;s alignment when globals have alignment</span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *Alloca = <span class="keyword">new</span> <a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a>(ElemTy, NULL, GV-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>(), &amp;FirstI);</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;UndefValue&gt;(GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>()))</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      <span class="keyword">new</span> <a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a>(GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>(), Alloca, &amp;FirstI);</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    GV-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Alloca);</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    ++NumLocalized;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;  }</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  <span class="comment">// If the global is never loaded (but may be stored to), it is dead.</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;  <span class="comment">// Delete it now.</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;  <span class="keywordflow">if</span> (!GS.<a class="code" href="structllvm_1_1GlobalStatus.html#a0371d896aba2b285da63fca3b700b169">IsLoaded</a>) {</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;GLOBAL NEVER LOADED: &quot;</span> &lt;&lt; *GV);</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    <span class="keywordtype">bool</span> Changed;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="GlobalOpt_8cpp.html#ace2885fc42e68606f270bfd3180d5f26">isLeakCheckerRoot</a>(GV)) {</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;      <span class="comment">// Delete any constant stores to the global.</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;      Changed = <a class="code" href="GlobalOpt_8cpp.html#a60254fdb6128ce676768cdc8f7227433">CleanupPointerRootUsers</a>(GV, TLI);</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;      <span class="comment">// Delete any stores we can find to the global.  We may not be able to</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      <span class="comment">// make it completely dead though.</span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      Changed = <a class="code" href="GlobalOpt_8cpp.html#a4c9b89709068175aa041524ee4bdc61f">CleanupConstantGlobalUsers</a>(GV, GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>(), TD, TLI);</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    }</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    <span class="comment">// If the global is dead now, delete it.</span></div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="keywordflow">if</span> (GV-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;      GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;      ++NumDeleted;</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    }</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (GS.<a class="code" href="structllvm_1_1GlobalStatus.html#abe8cd5e07daf1b2bf532174823523ee7">StoredType</a> &lt;= <a class="code" href="structllvm_1_1GlobalStatus.html#abe8cd5e07daf1b2bf532174823523ee7adcbfa969dc654b5812a05827152a42c5">GlobalStatus::InitializerStored</a>) {</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;MARKING CONSTANT: &quot;</span> &lt;&lt; *GV &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#a40ae67d31da67ca17ed016839faf3390">setConstant</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    <span class="comment">// Clean up any obviously simplifiable users now.</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <a class="code" href="GlobalOpt_8cpp.html#a4c9b89709068175aa041524ee4bdc61f">CleanupConstantGlobalUsers</a>(GV, GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>(), TD, TLI);</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <span class="comment">// If the global is dead now, just nuke it.</span></div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    <span class="keywordflow">if</span> (GV-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;   *** Marking constant allowed us to simplify &quot;</span></div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;all users and delete global!\n&quot;</span>);</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;      GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;      ++NumDeleted;</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    }</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    ++NumMarked;</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a36e21267fe14e69d3251eab1cd3a0076">isSingleValueType</a>()) {</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD = getAnalysisIfAvailable&lt;DataLayout&gt;())</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *FirstNewGV = <a class="code" href="GlobalOpt_8cpp.html#aecfe51ab31f2b93f6248121cb14de054">SRAGlobal</a>(GV, *TD)) {</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;        GVI = FirstNewGV;  <span class="comment">// Don&#39;t skip the newly produced globals!</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;      }</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (GS.<a class="code" href="structllvm_1_1GlobalStatus.html#abe8cd5e07daf1b2bf532174823523ee7">StoredType</a> == <a class="code" href="structllvm_1_1GlobalStatus.html#abe8cd5e07daf1b2bf532174823523ee7aecd55f74522361f4b8056f8b6b745699">GlobalStatus::StoredOnce</a>) {</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    <span class="comment">// If the initial value for the global was an undef value, and if only</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    <span class="comment">// one other value was stored into it, we can just change the</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    <span class="comment">// initializer to be the stored value, then delete all stores to the</span></div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    <span class="comment">// global.  This allows us to mark it constant.</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *SOVConstant = dyn_cast&lt;Constant&gt;(GS.<a class="code" href="structllvm_1_1GlobalStatus.html#a43ef0bbeda0cb9e7aafb3f83e56665e3">StoredOnceValue</a>))</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;      <span class="keywordflow">if</span> (isa&lt;UndefValue&gt;(GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>())) {</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;        <span class="comment">// Change the initial value here.</span></div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;        GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#a095f8f031d99ce3c0b25478713293dea">setInitializer</a>(SOVConstant);</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;        <span class="comment">// Clean up any obviously simplifiable users now.</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;        <a class="code" href="GlobalOpt_8cpp.html#a4c9b89709068175aa041524ee4bdc61f">CleanupConstantGlobalUsers</a>(GV, GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>(), TD, TLI);</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;        <span class="keywordflow">if</span> (GV-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;   *** Substituting initializer allowed us to &quot;</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;                       &lt;&lt; <span class="stringliteral">&quot;simplify all users and delete global!\n&quot;</span>);</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;          GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;          ++NumDeleted;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;          GVI = GV;</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        }</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        ++NumSubstitute;</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;      }</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    <span class="comment">// Try to optimize globals based on the knowledge that only one value</span></div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;    <span class="comment">// (besides its initializer) is ever stored to the global.</span></div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="GlobalOpt_8cpp.html#a86bc8cc11d43b9268dafa031dd7343dd">OptimizeOnceStoredGlobal</a>(GV, GS.<a class="code" href="structllvm_1_1GlobalStatus.html#a43ef0bbeda0cb9e7aafb3f83e56665e3">StoredOnceValue</a>, GS.<a class="code" href="structllvm_1_1GlobalStatus.html#a1b1ce5881588fec97dfaaf3845b04640">Ordering</a>, GVI,</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;                                 TD, TLI))</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    <span class="comment">// Otherwise, if the global was not a boolean, we can shrink it to be a</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    <span class="comment">// boolean.</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *SOVConstant = dyn_cast&lt;Constant&gt;(GS.<a class="code" href="structllvm_1_1GlobalStatus.html#a43ef0bbeda0cb9e7aafb3f83e56665e3">StoredOnceValue</a>)) {</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;      <span class="keywordflow">if</span> (GS.<a class="code" href="structllvm_1_1GlobalStatus.html#a1b1ce5881588fec97dfaaf3845b04640">Ordering</a> == <a class="code" href="namespacellvm.html#abf74b2f0dbae96f4708d3e407b36df02ad1fbbfdf093cdd213b0df02550ac94d0">NotAtomic</a>) {</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="GlobalOpt_8cpp.html#a77de6d50432bef62e38fd24f2030026c">TryToShrinkGlobalToBoolean</a>(GV, SOVConstant)) {</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;          ++NumShrunkToBool;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        }</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      }</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    }</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;  }</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;}</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;<span class="comment">/// ChangeCalleesToFastCall - Walk all of the direct calls of the specified</span></div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="comment">/// function, changing them to FastCC.</span></div><div class="line"><a name="l01868"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a7b97d3981d965c0884878bca5be437ff"> 1868</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="GlobalOpt_8cpp.html#a7b97d3981d965c0884878bca5be437ff">ChangeCalleesToFastCall</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>) {</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = F-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = F-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI != E;++UI){</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;    <span class="keywordflow">if</span> (isa&lt;BlockAddress&gt;(*UI))</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    <a class="code" href="classllvm_1_1CallSite.html">CallSite</a> <a class="code" href="classllvm_1_1User.html">User</a>(cast&lt;Instruction&gt;(*UI));</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    User.<a class="code" href="classllvm_1_1CallSiteBase.html#ae767a25d53d50cf3995a4e0db25c09fa">setCallingConv</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974abc8e2ee40a84687a9e12fd08784b87ba">CallingConv::Fast</a>);</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;  }</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;}</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;</div><div class="line"><a name="l01877"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#acc3494615b004b675f8266605bcd0421"> 1877</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1AttributeSet.html">AttributeSet</a> <a class="code" href="GlobalOpt_8cpp.html#acc3494615b004b675f8266605bcd0421">StripNest</a>(<a class="code" href="classllvm_1_1LLVMContext.html">LLVMContext</a> &amp;<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>, <span class="keyword">const</span> <a class="code" href="classllvm_1_1AttributeSet.html">AttributeSet</a> &amp;Attrs) {</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Attrs.<a class="code" href="classllvm_1_1AttributeSet.html#a048066a2eb851073ae71cf3dc7a2bfe7">getNumSlots</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    <span class="keywordtype">unsigned</span> Index = Attrs.<a class="code" href="classllvm_1_1AttributeSet.html#a564314dce5264ab0cfe6ae3d9f3f9c12">getSlotIndex</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <span class="keywordflow">if</span> (!Attrs.<a class="code" href="classllvm_1_1AttributeSet.html#a43d638279385ef1f48cb3e4990482e4c">getSlotAttributes</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>).<a class="code" href="classllvm_1_1AttributeSet.html#a54abbe67d4a53c92652f1666dc19281f">hasAttribute</a>(Index, <a class="code" href="classllvm_1_1Attribute.html#aab7ee4b8fd1d3e7e4cea87868855e60ea26003dadfa771bce07fe0d9b38c51437">Attribute::Nest</a>))</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <span class="comment">// There can be only one.</span></div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <span class="keywordflow">return</span> Attrs.<a class="code" href="classllvm_1_1AttributeSet.html#a206bb7d4b3f7e63b4cc0e83b8c120b80">removeAttribute</a>(C, Index, <a class="code" href="classllvm_1_1Attribute.html#aab7ee4b8fd1d3e7e4cea87868855e60ea26003dadfa771bce07fe0d9b38c51437">Attribute::Nest</a>);</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;  }</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;  <span class="keywordflow">return</span> Attrs;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;}</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;</div><div class="line"><a name="l01890"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#ae7d5794196f5b9b7477429aec29ad157"> 1890</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="GlobalOpt_8cpp.html#ae7d5794196f5b9b7477429aec29ad157">RemoveNestAttribute</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>) {</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;  F-&gt;<a class="code" href="classllvm_1_1Function.html#ad1efd93bf021addd8ac8a48a0c5fa3dd">setAttributes</a>(<a class="code" href="GlobalOpt_8cpp.html#acc3494615b004b675f8266605bcd0421">StripNest</a>(F-&gt;<a class="code" href="classllvm_1_1Function.html#a2da53ac53516a3f16191f4c8a8eaa3e5">getContext</a>(), F-&gt;<a class="code" href="classllvm_1_1Function.html#a72873ed64b7be01507a2248b8e756ec8">getAttributes</a>()));</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1value__use__iterator.html">Value::use_iterator</a> UI = F-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(), E = F-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); UI != E;++UI){</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    <span class="keywordflow">if</span> (isa&lt;BlockAddress&gt;(*UI))</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    <a class="code" href="classllvm_1_1CallSite.html">CallSite</a> <a class="code" href="classllvm_1_1User.html">User</a>(cast&lt;Instruction&gt;(*UI));</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    User.<a class="code" href="classllvm_1_1CallSiteBase.html#a197c8829ed18e514133a98f8e9d8a574">setAttributes</a>(<a class="code" href="GlobalOpt_8cpp.html#acc3494615b004b675f8266605bcd0421">StripNest</a>(F-&gt;<a class="code" href="classllvm_1_1Function.html#a2da53ac53516a3f16191f4c8a8eaa3e5">getContext</a>(), User.<a class="code" href="classllvm_1_1CallSiteBase.html#a4e7c7828319bc9db0f49c3c6d8f56ac7">getAttributes</a>()));</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;  }</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;}</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="keywordtype">bool</span> GlobalOpt::OptimizeFunctions(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;<a class="code" href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a>) {</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;  <span class="comment">// Optimize functions.</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Module::iterator</a> FI = M.<a class="code" href="classllvm_1_1Module.html#a279174d137c1ef32aa5b627f5e06620f">begin</a>(), E = M.<a class="code" href="classllvm_1_1Module.html#aa608a2d900dd6c15c18f4236b6548496">end</a>(); FI != E; ) {</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a> = FI++;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    <span class="comment">// Functions without names cannot be referenced outside this module.</span></div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    <span class="keywordflow">if</span> (!F-&gt;<a class="code" href="classllvm_1_1Value.html#a9b6d1ca60deddf2f2c25cfea671f617c">hasName</a>() &amp;&amp; !F-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a4640d98233102674ddb6d6efaf2b7f97">isDeclaration</a>())</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;      F-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a687973de03d041e04b50a76d19d4fd36">setLinkage</a>(<a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>);</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    F-&gt;<a class="code" href="classllvm_1_1Constant.html#a50d0911852017f2168de329f53d8568d">removeDeadConstantUsers</a>();</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    <span class="keywordflow">if</span> (F-&gt;<a class="code" href="classllvm_1_1Function.html#a09f4de698936d7b646c9ef5a0cc0920d">isDefTriviallyDead</a>()) {</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;      F-&gt;<a class="code" href="classllvm_1_1Function.html#a8969dec86d24dd579f8ecc963e1dc8b4">eraseFromParent</a>();</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;      Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;      ++NumFnDeleted;</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (F-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#abefc2d8baa67d6f9e49c95912cfde480">hasLocalLinkage</a>()) {</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;      <span class="keywordflow">if</span> (F-&gt;<a class="code" href="classllvm_1_1Function.html#af4d5ada526cdf057f5f29047e058187d">getCallingConv</a>() == <a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974afd841a49aec1539bc88abc8ff9e170fb">CallingConv::C</a> &amp;&amp; !F-&gt;<a class="code" href="classllvm_1_1Function.html#ae0466120bfdf5b97b25aa06f3015cd51">isVarArg</a>() &amp;&amp;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;          !F-&gt;<a class="code" href="classllvm_1_1Function.html#aafc2232f97cd2d2fae9b4f5bda77a363">hasAddressTaken</a>()) {</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;        <span class="comment">// If this function has C calling conventions, is not a varargs</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;        <span class="comment">// function, and is only called directly, promote it to use the Fast</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;        <span class="comment">// calling convention.</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;        F-&gt;<a class="code" href="classllvm_1_1Function.html#ae6db8746934e6feae3649a8709fce3cc">setCallingConv</a>(<a class="code" href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974abc8e2ee40a84687a9e12fd08784b87ba">CallingConv::Fast</a>);</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;        <a class="code" href="GlobalOpt_8cpp.html#a7b97d3981d965c0884878bca5be437ff">ChangeCalleesToFastCall</a>(F);</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        ++NumFastCallFns;</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;      }</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;      <span class="keywordflow">if</span> (F-&gt;<a class="code" href="classllvm_1_1Function.html#a72873ed64b7be01507a2248b8e756ec8">getAttributes</a>().<a class="code" href="classllvm_1_1AttributeSet.html#a56a819e7d3cff2d80c8336ae93abec1b">hasAttrSomewhere</a>(<a class="code" href="classllvm_1_1Attribute.html#aab7ee4b8fd1d3e7e4cea87868855e60ea26003dadfa771bce07fe0d9b38c51437">Attribute::Nest</a>) &amp;&amp;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;          !F-&gt;<a class="code" href="classllvm_1_1Function.html#aafc2232f97cd2d2fae9b4f5bda77a363">hasAddressTaken</a>()) {</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        <span class="comment">// The function is not used by a trampoline intrinsic, so it is safe</span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;        <span class="comment">// to remove the &#39;nest&#39; attribute.</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;        <a class="code" href="GlobalOpt_8cpp.html#ae7d5794196f5b9b7477429aec29ad157">RemoveNestAttribute</a>(F);</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;        ++NumNestRemoved;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;        Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;      }</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    }</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;  }</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;}</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;<span class="keywordtype">bool</span> GlobalOpt::OptimizeGlobalVars(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M) {</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Module::global_iterator</a> GVI = M.<a class="code" href="classllvm_1_1Module.html#a0567b31cf5caa26522fcc2e7cadc1dde">global_begin</a>(), E = M.<a class="code" href="classllvm_1_1Module.html#a19b72cdd81bd792545e25466b43ac7c2">global_end</a>();</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;       GVI != E; ) {</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;    <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV = GVI++;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    <span class="comment">// Global variables without names cannot be referenced outside this module.</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    <span class="keywordflow">if</span> (!GV-&gt;<a class="code" href="classllvm_1_1Value.html#a9b6d1ca60deddf2f2c25cfea671f617c">hasName</a>() &amp;&amp; !GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a4640d98233102674ddb6d6efaf2b7f97">isDeclaration</a>())</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a687973de03d041e04b50a76d19d4fd36">setLinkage</a>(<a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>);</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    <span class="comment">// Simplify the initializer.</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    <span class="keywordflow">if</span> (GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#a0d94a4e78681b58ae3b2dbbd0627a847">hasInitializer</a>())</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>())) {</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;        <a class="code" href="classllvm_1_1Constant.html">Constant</a> *New = <a class="code" href="namespacellvm.html#a8891be7c27326c20a6dba7d98e9030b5">ConstantFoldConstantExpression</a>(CE, TD, TLI);</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;        <span class="keywordflow">if</span> (New &amp;&amp; New != CE)</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;          GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#a095f8f031d99ce3c0b25478713293dea">setInitializer</a>(New);</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;      }</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    Changed |= ProcessGlobal(GV, GVI);</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;  }</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;}</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;<span class="comment">/// FindGlobalCtors - Find the llvm.global_ctors list, verifying that all</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;<span class="comment">/// initializers have an init priority of 65535.</span></div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GlobalOpt::FindGlobalCtors(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M) {</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;  <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV = M.<a class="code" href="classllvm_1_1Module.html#a17ebd56685ee19e7761ae577cd511e25">getGlobalVariable</a>(<span class="stringliteral">&quot;llvm.global_ctors&quot;</span>);</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;  <span class="keywordflow">if</span> (GV == 0) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;  <span class="comment">// Verify that the initializer is simple enough for us to handle. We are</span></div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;  <span class="comment">// only allowed to optimize the initializer if it is unique.</span></div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;  <span class="keywordflow">if</span> (!GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aaf76909687fcdf2acb3cddab7db498f8">hasUniqueInitializer</a>()) <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ConstantAggregateZero&gt;(GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>()))</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    <span class="keywordflow">return</span> GV;</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;  <a class="code" href="classllvm_1_1ConstantArray.html">ConstantArray</a> *CA = cast&lt;ConstantArray&gt;(GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>());</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = CA-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>(), e = CA-&gt;<a class="code" href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">op_end</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    <span class="keywordflow">if</span> (isa&lt;ConstantAggregateZero&gt;(*<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>))</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    <a class="code" href="classllvm_1_1ConstantStruct.html">ConstantStruct</a> *CS = cast&lt;ConstantStruct&gt;(*i);</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    <span class="keywordflow">if</span> (isa&lt;ConstantPointerNull&gt;(CS-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1)))</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    <span class="comment">// Must have a function or null ptr.</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;Function&gt;(CS-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1)))</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    <span class="comment">// Init priority must be standard.</span></div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = cast&lt;ConstantInt&gt;(CS-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0));</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;    <span class="keywordflow">if</span> (CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>() != 65535)</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;  }</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;  <span class="keywordflow">return</span> GV;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;}</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="comment">/// ParseGlobalCtors - Given a llvm.global_ctors list that we can understand,</span></div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;<span class="comment">/// return a list of the functions and null terminator as a vector.</span></div><div class="line"><a name="l01995"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a026998887a46f3b53f04134c50d854d0"> 1995</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> std::vector&lt;Function*&gt; <a class="code" href="GlobalOpt_8cpp.html#a026998887a46f3b53f04134c50d854d0">ParseGlobalCtors</a>(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV) {</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;  <span class="keywordflow">if</span> (GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>()-&gt;<a class="code" href="classllvm_1_1Constant.html#ad7ec8482f19e8e86e3de573b060a17e5">isNullValue</a>())</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    <span class="keywordflow">return</span> std::vector&lt;Function*&gt;();</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;  <a class="code" href="classllvm_1_1ConstantArray.html">ConstantArray</a> *CA = cast&lt;ConstantArray&gt;(GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>());</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;  std::vector&lt;Function*&gt; Result;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;  Result.reserve(CA-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>());</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = CA-&gt;<a class="code" href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op_begin</a>(), e = CA-&gt;<a class="code" href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">op_end</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    <a class="code" href="classllvm_1_1ConstantStruct.html">ConstantStruct</a> *CS = cast&lt;ConstantStruct&gt;(*i);</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;    Result.push_back(dyn_cast&lt;Function&gt;(CS-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1)));</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;  }</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;  <span class="keywordflow">return</span> Result;</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;}</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;<span class="comment">/// InstallGlobalCtors - Given a specified llvm.global_ctors list, install the</span></div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;<span class="comment">/// specified array, returning the new global to use.</span></div><div class="line"><a name="l02010"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#abaaf9df519b65d0c6e0f40c8be7e10b9"> 2010</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *<a class="code" href="GlobalOpt_8cpp.html#abaaf9df519b65d0c6e0f40c8be7e10b9">InstallGlobalCtors</a>(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GCL,</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;                                          <span class="keyword">const</span> std::vector&lt;Function*&gt; &amp;Ctors) {</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  <span class="comment">// If we made a change, reassemble the initializer list.</span></div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *CSVals[2];</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;  CSVals[0] = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(<a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(GCL-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()), 65535);</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;  CSVals[1] = 0;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;  <a class="code" href="classllvm_1_1StructType.html">StructType</a> *StructTy =</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    cast&lt;StructType&gt;(GCL-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>()-&gt;<a class="code" href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">getElementType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#acae189c1d913af7e7f37a8b202070997">getArrayElementType</a>());</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;  <span class="comment">// Create the new init list.</span></div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;  std::vector&lt;Constant*&gt; CAList;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = Ctors.size(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    <span class="keywordflow">if</span> (Ctors[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>]) {</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;      CSVals[1] = Ctors[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *FTy = <a class="code" href="classllvm_1_1FunctionType.html#a7e89b55242c964ae61b7850e99cacef0">FunctionType::get</a>(<a class="code" href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(GCL-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()),</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;                                          <span class="keyword">false</span>);</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;      <a class="code" href="classllvm_1_1PointerType.html">PointerType</a> *PFTy = <a class="code" href="classllvm_1_1PointerType.html#a8db49fd5069f21d514e7bb0fd11f0902">PointerType::getUnqual</a>(FTy);</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;      CSVals[1] = <a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(PFTy);</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;      CSVals[0] = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(<a class="code" href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(GCL-&gt;<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>()),</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;                                   0x7fffffff);</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    }</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    CAList.push_back(<a class="code" href="classllvm_1_1ConstantStruct.html#a54fcfa620deb80373f489ba2fdad7643">ConstantStruct::get</a>(StructTy, CSVals));</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;  }</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;  <span class="comment">// Create the array initializer.</span></div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *CA = <a class="code" href="classllvm_1_1ConstantArray.html#a0900dacdc7ad8e3ea0cc92993c7fd422">ConstantArray::get</a>(<a class="code" href="classllvm_1_1ArrayType.html#adf411edc4f135b570ab218079474ce77">ArrayType::get</a>(StructTy,</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;                                                   CAList.size()), CAList);</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;  <span class="comment">// If we didn&#39;t change the number of elements, don&#39;t create a new GV.</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;  <span class="keywordflow">if</span> (CA-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() == GCL-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>()-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()) {</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;    GCL-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#a095f8f031d99ce3c0b25478713293dea">setInitializer</a>(CA);</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    <span class="keywordflow">return</span> GCL;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;  }</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;  <span class="comment">// Create the new global and insert it next to the existing list.</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;  <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *NGV = <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(CA-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>(), GCL-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#a1500a3fe55cf38153aa1e0fbe7284e05">isConstant</a>(),</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;                                           GCL-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a38ea691c2eeaf3facd74d5cfb0c725b0">getLinkage</a>(), CA, <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;                                           GCL-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ab1b932862d7d88dae34cfd24f44847a3">getThreadLocalMode</a>());</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;  GCL-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>()-&gt;<a class="code" href="classllvm_1_1Module.html#a28c0310f56c2ea41ff7012df55ac6dc5">getGlobalList</a>().<a class="code" href="classllvm_1_1iplist.html#a35c71de7e8bbe3c0353d042beb58263f">insert</a>(GCL, NGV);</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;  NGV-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(GCL);</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;  <span class="comment">// Nuke the old list, replacing any uses with the new one.</span></div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;  <span class="keywordflow">if</span> (!GCL-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) {</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *V = NGV;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    <span class="keywordflow">if</span> (V-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() != GCL-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>())</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;      V = <a class="code" href="classllvm_1_1ConstantExpr.html#aba93ec4079f8d709a1d5b4745310782e">ConstantExpr::getBitCast</a>(V, GCL-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>());</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;    GCL-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;  }</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;  GCL-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;  <span class="keywordflow">if</span> (Ctors.size())</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;    <span class="keywordflow">return</span> NGV;</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;}</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span></div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;<a class="code" href="GlobalOpt_8cpp.html#ad011637daf373ae9f4cbb34d7eaa0955">isSimpleEnoughValueToCommit</a>(<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>,</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;                            <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Constant*, 8&gt;</a> &amp;SimpleConstants,</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;                            <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD);</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;<span class="comment">/// isSimpleEnoughValueToCommit - Return true if the specified constant can be</span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;<span class="comment">/// handled by the code generator.  We don&#39;t want to generate something like:</span></div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;<span class="comment">///   void *X = &amp;X/42;</span></div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="comment">/// because the code generator doesn&#39;t have a relocation that can handle that.</span></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;<span class="comment">/// This function should be called if C was not found (but just got inserted)</span></div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="comment">/// in SimpleConstants to avoid having to rescan the same constants all the</span></div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;<span class="comment">/// time.</span></div><div class="line"><a name="l02083"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#ac63ac1be5217b4826ec97233f6bd8710"> 2083</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#ac63ac1be5217b4826ec97233f6bd8710">isSimpleEnoughValueToCommitHelper</a>(<a class="code" href="classllvm_1_1Constant.html">Constant</a> *C,</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;                                   <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Constant*, 8&gt;</a> &amp;SimpleConstants,</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD) {</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;  <span class="comment">// Simple integer, undef, constant aggregate zero, global addresses, etc are</span></div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;  <span class="comment">// all supported.</span></div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;  <span class="keywordflow">if</span> (C-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>() == 0 || isa&lt;BlockAddress&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>) ||</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;      isa&lt;GlobalValue&gt;(C))</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;  <span class="comment">// Aggregate values are safe if all their elements are.</span></div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;  <span class="keywordflow">if</span> (isa&lt;ConstantArray&gt;(C) || isa&lt;ConstantStruct&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>) ||</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;      isa&lt;ConstantVector&gt;(C)) {</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = C-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Op = cast&lt;Constant&gt;(C-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#ad011637daf373ae9f4cbb34d7eaa0955">isSimpleEnoughValueToCommit</a>(Op, SimpleConstants, TD))</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;    }</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;  }</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;  <span class="comment">// We don&#39;t know exactly what relocations are allowed in constant expressions,</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;  <span class="comment">// so we allow &amp;global+constantoffset, which is safe and uniformly supported</span></div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;  <span class="comment">// across targets.</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;  <a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = cast&lt;ConstantExpr&gt;(<a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>);</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;  <span class="keywordflow">switch</span> (CE-&gt;<a class="code" href="classllvm_1_1ConstantExpr.html#a9c029996bf40f01fdebc1dfdf1cec4df">getOpcode</a>()) {</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;  <span class="keywordflow">case</span> Instruction::BitCast:</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    <span class="comment">// Bitcast is fine if the casted value is fine.</span></div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="GlobalOpt_8cpp.html#ad011637daf373ae9f4cbb34d7eaa0955">isSimpleEnoughValueToCommit</a>(CE-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), SimpleConstants, TD);</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;  <span class="keywordflow">case</span> Instruction::IntToPtr:</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;  <span class="keywordflow">case</span> Instruction::PtrToInt:</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;    <span class="comment">// int &lt;=&gt; ptr is fine if the int type is the same size as the</span></div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;    <span class="comment">// pointer type.</span></div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;    <span class="keywordflow">if</span> (!TD || TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">getTypeSizeInBits</a>(CE-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()) !=</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;               TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">getTypeSizeInBits</a>(CE-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()))</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="GlobalOpt_8cpp.html#ad011637daf373ae9f4cbb34d7eaa0955">isSimpleEnoughValueToCommit</a>(CE-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), SimpleConstants, TD);</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;  <span class="comment">// GEP is fine if it is simple + constant offset.</span></div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;  <span class="keywordflow">case</span> Instruction::GetElementPtr:</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1, e = CE-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;      <span class="keywordflow">if</span> (!isa&lt;ConstantInt&gt;(CE-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)))</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="GlobalOpt_8cpp.html#ad011637daf373ae9f4cbb34d7eaa0955">isSimpleEnoughValueToCommit</a>(CE-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), SimpleConstants, TD);</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;  <span class="keywordflow">case</span> Instruction::Add:</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    <span class="comment">// We allow simple+cst.</span></div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    <span class="keywordflow">if</span> (!isa&lt;ConstantInt&gt;(CE-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(1)))</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="GlobalOpt_8cpp.html#ad011637daf373ae9f4cbb34d7eaa0955">isSimpleEnoughValueToCommit</a>(CE-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0), SimpleConstants, TD);</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;  }</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;}</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span></div><div class="line"><a name="l02138"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#ad011637daf373ae9f4cbb34d7eaa0955"> 2138</a></span>&#160;<a class="code" href="GlobalOpt_8cpp.html#ad011637daf373ae9f4cbb34d7eaa0955">isSimpleEnoughValueToCommit</a>(<a class="code" href="classllvm_1_1Constant.html">Constant</a> *C,</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;                            <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Constant*, 8&gt;</a> &amp;SimpleConstants,</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;                            <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD) {</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;  <span class="comment">// If we already checked this constant, we win.</span></div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;  <span class="keywordflow">if</span> (!SimpleConstants.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(C)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;  <span class="comment">// Check the constant.</span></div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="GlobalOpt_8cpp.html#ac63ac1be5217b4826ec97233f6bd8710">isSimpleEnoughValueToCommitHelper</a>(C, SimpleConstants, TD);</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;}</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;<span class="comment">/// isSimpleEnoughPointerToCommit - Return true if this constant is simple</span></div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;<span class="comment">/// enough for us to understand.  In particular, if it is a cast to anything</span></div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;<span class="comment">/// other than from one pointer type to another pointer type, we punt.</span></div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;<span class="comment">/// We basically just support direct accesses to globals and GEP&#39;s of</span></div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;<span class="comment">/// globals.  This should be kept up to date with CommitValueTo.</span></div><div class="line"><a name="l02153"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a3622348f4394efe3dbe9b1e6366e7235"> 2153</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a3622348f4394efe3dbe9b1e6366e7235">isSimpleEnoughPointerToCommit</a>(<a class="code" href="classllvm_1_1Constant.html">Constant</a> *C) {</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;  <span class="comment">// Conservatively, avoid aggregate types. This is because we don&#39;t</span></div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;  <span class="comment">// want to worry about them partially overlapping other stores.</span></div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;  <span class="keywordflow">if</span> (!cast&lt;PointerType&gt;(C-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())-&gt;getElementType()-&gt;isSingleValueType())</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV = dyn_cast&lt;GlobalVariable&gt;(C))</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    <span class="comment">// Do not allow weak/*_odr/linkonce/dllimport/dllexport linkage or</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;    <span class="comment">// external globals.</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;    <span class="keywordflow">return</span> GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aaf76909687fcdf2acb3cddab7db498f8">hasUniqueInitializer</a>();</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(C)) {</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    <span class="comment">// Handle a constantexpr gep.</span></div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    <span class="keywordflow">if</span> (CE-&gt;getOpcode() == Instruction::GetElementPtr &amp;&amp;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;        isa&lt;GlobalVariable&gt;(CE-&gt;getOperand(0)) &amp;&amp;</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;        cast&lt;GEPOperator&gt;(CE)-&gt;isInBounds()) {</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;      <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV = cast&lt;GlobalVariable&gt;(CE-&gt;getOperand(0));</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;      <span class="comment">// Do not allow weak/*_odr/linkonce/dllimport/dllexport linkage or</span></div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;      <span class="comment">// external globals.</span></div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;      <span class="keywordflow">if</span> (!GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aaf76909687fcdf2acb3cddab7db498f8">hasUniqueInitializer</a>())</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;      <span class="comment">// The first index must be zero.</span></div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;      <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(*<a class="code" href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a>(CE-&gt;op_begin()));</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      <span class="keywordflow">if</span> (!CI || !CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#ad4ea4748170f687710a54c919dde5625">isZero</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;      <span class="comment">// The remaining indices must be compile-time known integers within the</span></div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;      <span class="comment">// notional bounds of the corresponding static array types.</span></div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;      <span class="keywordflow">if</span> (!CE-&gt;isGEPWithNoNotionalOverIndexing())</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#af2c14d2f82bff2130daf86f4e22ae14d">ConstantFoldLoadThroughGEPConstantExpr</a>(GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>(), CE);</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    <span class="comment">// A constantexpr bitcast from a pointer to another pointer is a no-op,</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    <span class="comment">// and we know how to evaluate it by moving the bitcast from the pointer</span></div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;    <span class="comment">// operand to the value operand.</span></div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CE-&gt;getOpcode() == Instruction::BitCast &amp;&amp;</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;               isa&lt;GlobalVariable&gt;(CE-&gt;getOperand(0))) {</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;      <span class="comment">// Do not allow weak/*_odr/linkonce/dllimport/dllexport linkage or</span></div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;      <span class="comment">// external globals.</span></div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;      <span class="keywordflow">return</span> cast&lt;GlobalVariable&gt;(CE-&gt;getOperand(0))-&gt;hasUniqueInitializer();</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;    }</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;  }</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;}</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;<span class="comment">/// EvaluateStoreInto - Evaluate a piece of a constantexpr store into a global</span></div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;<span class="comment">/// initializer.  This returns &#39;Init&#39; modified to reflect &#39;Val&#39; stored into it.</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;<span class="comment">/// At this point, the GEP operands of Addr [0, OpNo) have been stepped into.</span></div><div class="line"><a name="l02203"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#ad5e0f87ba24074dd68abfa5a29e7db6a"> 2203</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="GlobalOpt_8cpp.html#ad5e0f87ba24074dd68abfa5a29e7db6a">EvaluateStoreInto</a>(<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="classllvm_1_1Init.html">Init</a>, <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Val,</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;                                   <a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *Addr, <span class="keywordtype">unsigned</span> OpNo) {</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;  <span class="comment">// Base case of the recursion.</span></div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;  <span class="keywordflow">if</span> (OpNo == Addr-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>()) {</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;    assert(Val-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() == Init-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>() &amp;&amp; <span class="stringliteral">&quot;Type mismatch!&quot;</span>);</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;    <span class="keywordflow">return</span> Val;</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;  }</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Constant*, 32&gt;</a> Elts;</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *STy = dyn_cast&lt;StructType&gt;(Init-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())) {</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;    <span class="comment">// Break up the constant into its elements.</span></div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = STy-&gt;getNumElements(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;      Elts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Init-&gt;<a class="code" href="classllvm_1_1Constant.html#a01fee21e2c679094ce5ab193369d5198">getAggregateElement</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;    <span class="comment">// Replace the element that we are supposed to.</span></div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *<a class="code" href="namespaceCU.html">CU</a> = cast&lt;ConstantInt&gt;(Addr-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(OpNo));</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;    <span class="keywordtype">unsigned</span> Idx = CU-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>();</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;    assert(Idx &lt; STy-&gt;getNumElements() &amp;&amp; <span class="stringliteral">&quot;Struct index out of range!&quot;</span>);</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;    Elts[Idx] = <a class="code" href="GlobalOpt_8cpp.html#ad5e0f87ba24074dd68abfa5a29e7db6a">EvaluateStoreInto</a>(Elts[Idx], Val, Addr, OpNo+1);</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    <span class="comment">// Return the modified struct.</span></div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1ConstantStruct.html#a54fcfa620deb80373f489ba2fdad7643">ConstantStruct::get</a>(STy, Elts);</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;  }</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;  <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *CI = cast&lt;ConstantInt&gt;(Addr-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(OpNo));</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;  <a class="code" href="classllvm_1_1SequentialType.html">SequentialType</a> *InitTy = cast&lt;SequentialType&gt;(Init-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>());</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;  uint64_t NumElts;</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *ATy = dyn_cast&lt;ArrayType&gt;(InitTy))</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;    NumElts = ATy-&gt;getNumElements();</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    NumElts = InitTy-&gt;<a class="code" href="classllvm_1_1Type.html#ad8f27f0b94a56abcd296b8461737a3af">getVectorNumElements</a>();</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;  <span class="comment">// Break up the array into elements.</span></div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;  <span class="keywordflow">for</span> (uint64_t <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0, e = NumElts; <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;    Elts.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Init-&gt;<a class="code" href="classllvm_1_1Constant.html#a01fee21e2c679094ce5ab193369d5198">getAggregateElement</a>(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;  assert(CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>() &lt; NumElts);</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;  Elts[CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>()] =</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;    <a class="code" href="GlobalOpt_8cpp.html#ad5e0f87ba24074dd68abfa5a29e7db6a">EvaluateStoreInto</a>(Elts[CI-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>()], Val, Addr, OpNo+1);</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;  <span class="keywordflow">if</span> (Init-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a9aae7c60b468bcf6db982dc76e6c703a">isArrayTy</a>())</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1ConstantArray.html#a0900dacdc7ad8e3ea0cc92993c7fd422">ConstantArray::get</a>(cast&lt;ArrayType&gt;(InitTy), Elts);</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1ConstantVector.html#ade9fa017ca3aa82f7694a47090547bc1">ConstantVector::get</a>(Elts);</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;}</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;<span class="comment">/// CommitValueTo - We have decided that Addr (which satisfies the predicate</span></div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;<span class="comment">/// isSimpleEnoughPointerToCommit) should get Val as its value.  Make it happen.</span></div><div class="line"><a name="l02251"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a261cccda692dd81df2689f3d494ad4d9"> 2251</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="GlobalOpt_8cpp.html#a261cccda692dd81df2689f3d494ad4d9">CommitValueTo</a>(<a class="code" href="classllvm_1_1Constant.html">Constant</a> *Val, <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Addr) {</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV = dyn_cast&lt;GlobalVariable&gt;(Addr)) {</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;    assert(GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#a0d94a4e78681b58ae3b2dbbd0627a847">hasInitializer</a>());</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;    GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#a095f8f031d99ce3c0b25478713293dea">setInitializer</a>(Val);</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;  }</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;  <a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = cast&lt;ConstantExpr&gt;(Addr);</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;  <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV = cast&lt;GlobalVariable&gt;(CE-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0));</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#a095f8f031d99ce3c0b25478713293dea">setInitializer</a>(<a class="code" href="GlobalOpt_8cpp.html#ad5e0f87ba24074dd68abfa5a29e7db6a">EvaluateStoreInto</a>(GV-&gt;getInitializer(), Val, CE, 2));</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;}</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;<span class="comment">/// Evaluator - This class evaluates LLVM IR, producing the Constant</span></div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;<span class="comment">/// representing each SSA instruction.  Changes to global variables are stored</span></div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;<span class="comment">/// in a mapping that can be iterated over after the evaluation is complete.</span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;<span class="comment">/// Once an evaluation call fails, the evaluation object should not be reused.</span></div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;<span class="comment"></span><span class="keyword">class </span><a class="code" href="AliasAnalysisEvaluator_8cpp.html#ad8b296a21110ccf9f34e73e4507dda2e">Evaluator</a> {</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;  <a class="code" href="AliasAnalysisEvaluator_8cpp.html#ad8b296a21110ccf9f34e73e4507dda2e">Evaluator</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD, <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI)</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;    : TD(TD), TLI(TLI) {</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    ValueStack.push_back(<span class="keyword">new</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value*, Constant*&gt;</a>);</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;  }</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;  ~<a class="code" href="AliasAnalysisEvaluator_8cpp.html#ad8b296a21110ccf9f34e73e4507dda2e">Evaluator</a>() {</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    <a class="code" href="namespacellvm.html#a557372a0f9217d7171352952ce9d75bc">DeleteContainerPointers</a>(ValueStack);</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;    <span class="keywordflow">while</span> (!AllocaTmps.empty()) {</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;      <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *Tmp = AllocaTmps.back();</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;      AllocaTmps.pop_back();</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;      <span class="comment">// If there are still users of the alloca, the program is doing something</span></div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;      <span class="comment">// silly, e.g. storing the address of the alloca somewhere and using it</span></div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;      <span class="comment">// later.  Since this is undefined, we&#39;ll just make it be null.</span></div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;      <span class="keywordflow">if</span> (!Tmp-&gt;<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>())</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;        Tmp-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Tmp-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>()));</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;      <span class="keyword">delete</span> Tmp;</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    }</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;  }</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;<span class="comment">  /// EvaluateFunction - Evaluate a call to function F, returning true if</span></div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;<span class="comment">  /// successful, false if we can&#39;t evaluate it.  ActualArgs contains the formal</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;<span class="comment">  /// arguments for the function.</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> EvaluateFunction(<a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>, <a class="code" href="classllvm_1_1Constant.html">Constant</a> *&amp;RetVal,</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;                        <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Constant*&gt;</a> &amp;ActualArgs);</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;<span class="comment">  /// EvaluateBlock - Evaluate all instructions in block BB, returning true if</span></div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;<span class="comment">  /// successful, false if we can&#39;t evaluate it.  NewBB returns the next BB that</span></div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;<span class="comment">  /// control flows into, or null upon return.</span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;<span class="comment"></span>  <span class="keywordtype">bool</span> EvaluateBlock(<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> CurInst, <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *&amp;NextBB);</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *getVal(<a class="code" href="classllvm_1_1Value.html">Value</a> *V) {</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *CV = dyn_cast&lt;Constant&gt;(V)) <span class="keywordflow">return</span> CV;</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *R = ValueStack.back()-&gt;lookup(V);</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    assert(R &amp;&amp; <span class="stringliteral">&quot;Reference to an uncomputed value!&quot;</span>);</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;    <span class="keywordflow">return</span> R;</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;  }</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;  <span class="keywordtype">void</span> setVal(<a class="code" href="classllvm_1_1Value.html">Value</a> *V, <a class="code" href="classllvm_1_1Constant.html">Constant</a> *C) {</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;    ValueStack.back()-&gt;operator[](V) = C;</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;  }</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Constant*, Constant*&gt;</a> &amp;getMutatedMemory()<span class="keyword"> const </span>{</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;    <span class="keywordflow">return</span> MutatedMemory;</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;  }</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;GlobalVariable*, 8&gt;</a> &amp;getInvariants()<span class="keyword"> const </span>{</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    <span class="keywordflow">return</span> Invariants;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;  }</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *ComputeLoadResult(<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>);</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;<span class="comment">  /// ValueStack - As we compute SSA register values, we store their contents</span></div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;<span class="comment">  /// here. The back of the vector contains the current function and the stack</span></div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;<span class="comment">  /// contains the values in the calling frames.</span></div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;DenseMap&lt;Value*, Constant*&gt;</a>*, 4&gt; ValueStack;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;<span class="comment">  /// CallStack - This is used to detect recursion.  In pathological situations</span></div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;<span class="comment">  /// we could hit exponential behavior, but at least there is nothing</span></div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;<span class="comment">  /// unbounded.</span></div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Function*, 4&gt;</a> CallStack;</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;<span class="comment">  /// MutatedMemory - For each store we execute, we update this map.  Loads</span></div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;<span class="comment">  /// check this to get the most up-to-date value.  If evaluation is successful,</span></div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;<span class="comment">  /// this state is committed to the process.</span></div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Constant*, Constant*&gt;</a> MutatedMemory;</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<span class="comment">  /// AllocaTmps - To &#39;execute&#39; an alloca, we create a temporary global variable</span></div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;<span class="comment">  /// to represent its body.  This vector is needed so we can delete the</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;<span class="comment">  /// temporary globals when we are done.</span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;GlobalVariable*, 32&gt;</a> AllocaTmps;</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;<span class="comment">  /// Invariants - These global variables have been marked invariant by the</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;<span class="comment">  /// static constructor.</span></div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;GlobalVariable*, 8&gt;</a> Invariants;</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;<span class="comment">  /// SimpleConstants - These are constants we have checked and know to be</span></div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;<span class="comment">  /// simple enough to live in a static initializer of a global.</span></div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;<span class="comment"></span>  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;Constant*, 8&gt;</a> SimpleConstants;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI;</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;};</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;}  <span class="comment">// anonymous namespace</span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;<span class="comment">/// ComputeLoadResult - Return the value that would be computed by a load from</span></div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;<span class="comment">/// P after the stores reflected by &#39;memory&#39; have been performed.  If we can&#39;t</span></div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;<span class="comment">/// decide, return null.</span></div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;<span class="comment"></span><a class="code" href="classllvm_1_1Constant.html">Constant</a> *Evaluator::ComputeLoadResult(<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>) {</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;  <span class="comment">// If this memory location has been recently stored, use the stored value: it</span></div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;  <span class="comment">// is the most up-to-date.</span></div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;  <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Constant*, Constant*&gt;::const_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MutatedMemory.find(P);</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;  <span class="keywordflow">if</span> (I != MutatedMemory.<a class="code" href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">end</a>()) <span class="keywordflow">return</span> I-&gt;second;</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  <span class="comment">// Access it.</span></div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;  <a class="code" href="LLParser_8cpp.html#aae58e3df0180401e8f3ab75c18fbc07a">if</a> (<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV = dyn_cast&lt;GlobalVariable&gt;(P)) {</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    <span class="keywordflow">if</span> (GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#abe4224c23f4544a70464c53056f00396">hasDefinitiveInitializer</a>())</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;      <span class="keywordflow">return</span> GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>();</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;  }</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;  <span class="comment">// Handle a constantexpr getelementptr.</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(P))</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;    <span class="keywordflow">if</span> (CE-&gt;getOpcode() == Instruction::GetElementPtr &amp;&amp;</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;        isa&lt;GlobalVariable&gt;(CE-&gt;getOperand(0))) {</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;      <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV = cast&lt;GlobalVariable&gt;(CE-&gt;getOperand(0));</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;      <span class="keywordflow">if</span> (GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#abe4224c23f4544a70464c53056f00396">hasDefinitiveInitializer</a>())</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#af2c14d2f82bff2130daf86f4e22ae14d">ConstantFoldLoadThroughGEPConstantExpr</a>(GV-&gt;<a class="code" href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">getInitializer</a>(), CE);</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;    }</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;  <span class="keywordflow">return</span> 0;  <span class="comment">// don&#39;t know how to evaluate.</span></div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;}</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;<span class="comment">/// EvaluateBlock - Evaluate all instructions in block BB, returning true if</span></div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;<span class="comment">/// successful, false if we can&#39;t evaluate it.  NewBB returns the next BB that</span></div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;<span class="comment">/// control flows into, or null upon return.</span></div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> Evaluator::EvaluateBlock(<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> CurInst,</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;                              <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *&amp;NextBB) {</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;  <span class="comment">// This is the main evaluation loop.</span></div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;  <span class="keywordflow">while</span> (1) {</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *InstResult = 0;</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Evaluating Instruction: &quot;</span> &lt;&lt; *CurInst &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StoreInst.html">StoreInst</a> *SI = dyn_cast&lt;StoreInst&gt;(CurInst)) {</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;      <span class="keywordflow">if</span> (!SI-&gt;isSimple()) {</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Store is not simple! Can not evaluate.\n&quot;</span>);</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// no volatile/atomic accesses.</span></div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;      }</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Ptr = getVal(SI-&gt;getOperand(1));</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(Ptr)) {</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Folding constant ptr expression: &quot;</span> &lt;&lt; *Ptr);</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;        Ptr = <a class="code" href="namespacellvm.html#a8891be7c27326c20a6dba7d98e9030b5">ConstantFoldConstantExpression</a>(CE, TD, TLI);</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;; To: &quot;</span> &lt;&lt; *Ptr &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;      }</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#a3622348f4394efe3dbe9b1e6366e7235">isSimpleEnoughPointerToCommit</a>(Ptr)) {</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;        <span class="comment">// If this is too complex for us to commit, reject it.</span></div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Pointer is too complex for us to evaluate store.&quot;</span>);</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;      }</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Val = getVal(SI-&gt;getOperand(0));</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;      <span class="comment">// If this might be too difficult for the backend to handle (e.g. the addr</span></div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;      <span class="comment">// of one global variable divided by another) then we can&#39;t commit it.</span></div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#ad011637daf373ae9f4cbb34d7eaa0955">isSimpleEnoughValueToCommit</a>(Val, SimpleConstants, TD)) {</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Store value is too complex to evaluate store. &quot;</span> &lt;&lt; *Val</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;      }</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(Ptr)) {</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;        <span class="keywordflow">if</span> (CE-&gt;getOpcode() == Instruction::BitCast) {</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Attempting to resolve bitcast on constant ptr.\n&quot;</span>);</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;          <span class="comment">// If we&#39;re evaluating a store through a bitcast, then we need</span></div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;          <span class="comment">// to pull the bitcast off the pointer type and push it onto the</span></div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;          <span class="comment">// stored value.</span></div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;          Ptr = CE-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0);</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;          <a class="code" href="classllvm_1_1Type.html">Type</a> *NewTy = cast&lt;PointerType&gt;(Ptr-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>())-&gt;getElementType();</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;          <span class="comment">// In order to push the bitcast onto the stored value, a bitcast</span></div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;          <span class="comment">// from NewTy to Val&#39;s type must be legal.  If it&#39;s not, we can try</span></div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;          <span class="comment">// introspecting NewTy to find a legal conversion.</span></div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;          <span class="keywordflow">while</span> (!Val-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#ab781fe09dd22fc9dec38dd0d40036e38">canLosslesslyBitCastTo</a>(NewTy)) {</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;            <span class="comment">// If NewTy is a struct, we can convert the pointer to the struct</span></div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;            <span class="comment">// into a pointer to its first member.</span></div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;            <span class="comment">// FIXME: This could be extended to support arrays as well.</span></div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1StructType.html">StructType</a> *STy = dyn_cast&lt;StructType&gt;(NewTy)) {</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;              NewTy = STy-&gt;getTypeAtIndex(0U);</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;              <a class="code" href="classllvm_1_1IntegerType.html">IntegerType</a> *IdxTy = <a class="code" href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(NewTy-&gt;<a class="code" href="classllvm_1_1Type.html#af348d5ea83429d08ba891ca3dd0e92b2">getContext</a>(), 32);</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;              <a class="code" href="classllvm_1_1Constant.html">Constant</a> *IdxZero = <a class="code" href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">ConstantInt::get</a>(IdxTy, 0, <span class="keyword">false</span>);</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;              <a class="code" href="classllvm_1_1Constant.html">Constant</a> * <span class="keyword">const</span> IdxList[] = {IdxZero, IdxZero};</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;              Ptr = <a class="code" href="classllvm_1_1ConstantExpr.html#a51940249c228e46f1f97932e5f4b8450">ConstantExpr::getGetElementPtr</a>(Ptr, IdxList);</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(Ptr))</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;                Ptr = <a class="code" href="namespacellvm.html#a8891be7c27326c20a6dba7d98e9030b5">ConstantFoldConstantExpression</a>(CE, TD, TLI);</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;            <span class="comment">// If we can&#39;t improve the situation by introspecting NewTy,</span></div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;            <span class="comment">// we have to give up.</span></div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;              <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Failed to bitcast constant ptr, can not &quot;</span></div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;                    <span class="stringliteral">&quot;evaluate.\n&quot;</span>);</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;              <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;            }</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;          }</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;          <span class="comment">// If we found compatible types, go ahead and push the bitcast</span></div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;          <span class="comment">// onto the stored value.</span></div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;          Val = <a class="code" href="classllvm_1_1ConstantExpr.html#aba93ec4079f8d709a1d5b4745310782e">ConstantExpr::getBitCast</a>(Val, NewTy);</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Evaluated bitcast: &quot;</span> &lt;&lt; *Val &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;        }</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;      }</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;      MutatedMemory[Ptr] = Val;</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BinaryOperator.html">BinaryOperator</a> *BO = dyn_cast&lt;BinaryOperator&gt;(CurInst)) {</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;      InstResult = <a class="code" href="classllvm_1_1ConstantExpr.html#afd44535c4ae204571d5721fa4a7042f2">ConstantExpr::get</a>(BO-&gt;getOpcode(),</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;                                     getVal(BO-&gt;getOperand(0)),</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;                                     getVal(BO-&gt;getOperand(1)));</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found a BinaryOperator! Simplifying: &quot;</span> &lt;&lt; *InstResult</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CmpInst.html">CmpInst</a> *CI = dyn_cast&lt;CmpInst&gt;(CurInst)) {</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;      InstResult = <a class="code" href="classllvm_1_1ConstantExpr.html#ac5728c914b7e92030243a21e49ab1552">ConstantExpr::getCompare</a>(CI-&gt;getPredicate(),</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;                                            getVal(CI-&gt;getOperand(0)),</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;                                            getVal(CI-&gt;getOperand(1)));</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found a CmpInst! Simplifying: &quot;</span> &lt;&lt; *InstResult</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1CastInst.html">CastInst</a> *CI = dyn_cast&lt;CastInst&gt;(CurInst)) {</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;      InstResult = <a class="code" href="classllvm_1_1ConstantExpr.html#a1e1ce75d651c76b6869b4218e34618c8">ConstantExpr::getCast</a>(CI-&gt;getOpcode(),</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;                                         getVal(CI-&gt;getOperand(0)),</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;                                         CI-&gt;getType());</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found a Cast! Simplifying: &quot;</span> &lt;&lt; *InstResult</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SelectInst.html">SelectInst</a> *SI = dyn_cast&lt;SelectInst&gt;(CurInst)) {</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;      InstResult = <a class="code" href="classllvm_1_1ConstantExpr.html#a0296d582257338d55fbf5cd3071207fc">ConstantExpr::getSelect</a>(getVal(SI-&gt;getOperand(0)),</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;                                           getVal(SI-&gt;getOperand(1)),</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;                                           getVal(SI-&gt;getOperand(2)));</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found a Select! Simplifying: &quot;</span> &lt;&lt; *InstResult</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GetElementPtrInst.html">GetElementPtrInst</a> *GEP = dyn_cast&lt;GetElementPtrInst&gt;(CurInst)) {</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *P = getVal(GEP-&gt;getOperand(0));</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Constant*, 8&gt;</a> GEPOps;</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = GEP-&gt;op_begin() + 1, e = GEP-&gt;op_end();</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;           <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;        GEPOps.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(getVal(*<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;      InstResult =</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;        <a class="code" href="classllvm_1_1ConstantExpr.html#a51940249c228e46f1f97932e5f4b8450">ConstantExpr::getGetElementPtr</a>(P, GEPOps,</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;                                       cast&lt;GEPOperator&gt;(GEP)-&gt;isInBounds());</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found a GEP! Simplifying: &quot;</span> &lt;&lt; *InstResult</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1LoadInst.html">LoadInst</a> *LI = dyn_cast&lt;LoadInst&gt;(CurInst)) {</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;      <span class="keywordflow">if</span> (!LI-&gt;isSimple()) {</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found a Load! Not a simple load, can not evaluate.\n&quot;</span>);</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// no volatile/atomic accesses.</span></div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;      }</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;      <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Ptr = getVal(LI-&gt;getOperand(0));</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(Ptr)) {</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;        Ptr = <a class="code" href="namespacellvm.html#a8891be7c27326c20a6dba7d98e9030b5">ConstantFoldConstantExpression</a>(CE, TD, TLI);</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found a constant pointer expression, constant &quot;</span></div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;              <span class="stringliteral">&quot;folding: &quot;</span> &lt;&lt; *Ptr &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;      }</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;      InstResult = ComputeLoadResult(Ptr);</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;      <span class="keywordflow">if</span> (InstResult == 0) {</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Failed to compute load result. Can not evaluate load.&quot;</span></div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;              <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Could not evaluate load.</span></div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;      }</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Evaluated load: &quot;</span> &lt;&lt; *InstResult &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1AllocaInst.html">AllocaInst</a> *AI = dyn_cast&lt;AllocaInst&gt;(CurInst)) {</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;      <span class="keywordflow">if</span> (AI-&gt;isArrayAllocation()) {</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found an array alloca. Can not evaluate.\n&quot;</span>);</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Cannot handle array allocs.</span></div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;      }</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;      <a class="code" href="classllvm_1_1Type.html">Type</a> *Ty = AI-&gt;getType()-&gt;getElementType();</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;      AllocaTmps.push_back(<span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(Ty, <span class="keyword">false</span>,</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;                                              <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>,</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;                                              <a class="code" href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(Ty),</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;                                              AI-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>()));</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;      InstResult = AllocaTmps.back();</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found an alloca. Result: &quot;</span> &lt;&lt; *InstResult &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;CallInst&gt;(CurInst) || isa&lt;InvokeInst&gt;(CurInst)) {</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;      <a class="code" href="classllvm_1_1CallSite.html">CallSite</a> CS(CurInst);</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;      <span class="comment">// Debug info can safely be ignored here.</span></div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;      <span class="keywordflow">if</span> (isa&lt;DbgInfoIntrinsic&gt;(CS.<a class="code" href="classllvm_1_1CallSiteBase.html#ae4c67f835911559821939fb23a2e7aff">getInstruction</a>())) {</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Ignoring debug info.\n&quot;</span>);</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;        ++CurInst;</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;      }</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;      <span class="comment">// Cannot handle inline asm.</span></div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;      <span class="keywordflow">if</span> (isa&lt;InlineAsm&gt;(CS.<a class="code" href="classllvm_1_1CallSiteBase.html#a1abce20a9eff3d23ce05331962b1997c">getCalledValue</a>())) {</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found inline asm, can not evaluate.\n&quot;</span>);</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;      }</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1IntrinsicInst.html">IntrinsicInst</a> *II = dyn_cast&lt;IntrinsicInst&gt;(CS.<a class="code" href="classllvm_1_1CallSiteBase.html#ae4c67f835911559821939fb23a2e7aff">getInstruction</a>())) {</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1MemSetInst.html">MemSetInst</a> *MSI = dyn_cast&lt;MemSetInst&gt;(II)) {</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;          <span class="keywordflow">if</span> (MSI-&gt;isVolatile()) {</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;            <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Can not optimize a volatile memset &quot;</span> &lt;&lt;</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;                  <span class="stringliteral">&quot;intrinsic.\n&quot;</span>);</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;          }</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;          <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Ptr = getVal(MSI-&gt;getDest());</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;          <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Val = getVal(MSI-&gt;getValue());</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;          <a class="code" href="classllvm_1_1Constant.html">Constant</a> *DestVal = ComputeLoadResult(getVal(Ptr));</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;          <span class="keywordflow">if</span> (Val-&gt;isNullValue() &amp;&amp; DestVal &amp;&amp; DestVal-&gt;isNullValue()) {</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;            <span class="comment">// This memset is a no-op.</span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;            <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Ignoring no-op memset.\n&quot;</span>);</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;            ++CurInst;</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;          }</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;        }</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;        <span class="keywordflow">if</span> (II-&gt;getIntrinsicID() == <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ae365354e47542c51f9bd46e329e3323e">Intrinsic::lifetime_start</a> ||</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;            II-&gt;getIntrinsicID() == <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90aa332b90dd5e4ebf4bbbcc0964220d373">Intrinsic::lifetime_end</a>) {</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Ignoring lifetime intrinsic.\n&quot;</span>);</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;          ++CurInst;</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;        }</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;        <span class="keywordflow">if</span> (II-&gt;getIntrinsicID() == <a class="code" href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90a39197eb94db0d5d99219a826fef11477">Intrinsic::invariant_start</a>) {</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;          <span class="comment">// We don&#39;t insert an entry into Values, as it doesn&#39;t have a</span></div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;          <span class="comment">// meaningful return value.</span></div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;          <span class="keywordflow">if</span> (!II-&gt;use_empty()) {</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;            <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found unused invariant_start. Cant evaluate.\n&quot;</span>);</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;          }</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;          <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Size = cast&lt;ConstantInt&gt;(II-&gt;getArgOperand(0));</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *PtrArg = getVal(II-&gt;getArgOperand(1));</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;          <a class="code" href="classllvm_1_1Value.html">Value</a> *Ptr = PtrArg-&gt;<a class="code" href="classllvm_1_1Value.html#a38ea12c04523d63adda732b9c5d6da0a">stripPointerCasts</a>();</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GV = dyn_cast&lt;GlobalVariable&gt;(Ptr)) {</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;            <a class="code" href="classllvm_1_1Type.html">Type</a> *ElemTy = cast&lt;PointerType&gt;(GV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">getType</a>())-&gt;getElementType();</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;            <span class="keywordflow">if</span> (TD &amp;&amp; !Size-&gt;<a class="code" href="classllvm_1_1Constant.html#ac8ddb745480a7e75a3862ddf0be3a298">isAllOnesValue</a>() &amp;&amp;</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;                Size-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">getValue</a>().<a class="code" href="classllvm_1_1APInt.html#ae0c5e70885cf005feb6707932774f99c">getLimitedValue</a>() &gt;=</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;                TD-&gt;<a class="code" href="classllvm_1_1DataLayout.html#a4b979cd93852fd44c48851c94ee00758">getTypeStoreSize</a>(ElemTy)) {</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;              Invariants.insert(GV);</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;              <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found a global var that is an invariant: &quot;</span> &lt;&lt; *GV</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;              <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found a global var, but can not treat it as an &quot;</span></div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;                    <span class="stringliteral">&quot;invariant.\n&quot;</span>);</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;            }</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;          }</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;          <span class="comment">// Continue even if we do nothing.</span></div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;          ++CurInst;</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;        }</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Unknown intrinsic. Can not evaluate.\n&quot;</span>);</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;      }</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;      <span class="comment">// Resolve function pointers.</span></div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;      <a class="code" href="classllvm_1_1Function.html">Function</a> *Callee = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Function.html">Function</a>&gt;(getVal(CS.<a class="code" href="classllvm_1_1CallSiteBase.html#a1abce20a9eff3d23ce05331962b1997c">getCalledValue</a>()));</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;      <span class="keywordflow">if</span> (!Callee || Callee-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a211c14a84be4519439d616f9027d86c9">mayBeOverridden</a>()) {</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Can not resolve function pointer.\n&quot;</span>);</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Cannot resolve.</span></div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;      }</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;      <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Constant*, 8&gt;</a> Formals;</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Use.html">User::op_iterator</a> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = CS.<a class="code" href="classllvm_1_1CallSiteBase.html#affa0f3ae92ab8696fccd107c0addf5a2">arg_begin</a>(), e = CS.<a class="code" href="classllvm_1_1CallSiteBase.html#acc2eeccdf71d83b3c08d6218317a1430">arg_end</a>(); <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != e; ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;        Formals.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(getVal(*<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;      <span class="keywordflow">if</span> (Callee-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a4640d98233102674ddb6d6efaf2b7f97">isDeclaration</a>()) {</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;        <span class="comment">// If this is a function we can constant fold, do it.</span></div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1Constant.html">Constant</a> *C = <a class="code" href="namespacellvm.html#abaa7bb099e75b4a5dba358a498783f83">ConstantFoldCall</a>(Callee, Formals, TLI)) {</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;          InstResult = <a class="code" href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a>;</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Constant folded function call. Result: &quot;</span> &lt;&lt;</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                *InstResult &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Can not constant fold function call.\n&quot;</span>);</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;        }</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;        <span class="keywordflow">if</span> (Callee-&gt;<a class="code" href="classllvm_1_1Function.html#adf66d58e85fb4e46e9c1ae55186a6930">getFunctionType</a>()-&gt;<a class="code" href="classllvm_1_1FunctionType.html#ab9b67f93a2231970abb3d95636660ffc">isVarArg</a>()) {</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Can not constant fold vararg function call.\n&quot;</span>);</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;        }</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;        <a class="code" href="classllvm_1_1Constant.html">Constant</a> *RetVal = 0;</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;        <span class="comment">// Execute the call, if successful, use the return value.</span></div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;        ValueStack.push_back(<span class="keyword">new</span> <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Value*, Constant*&gt;</a>);</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;        <span class="keywordflow">if</span> (!EvaluateFunction(Callee, RetVal, Formals)) {</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Failed to evaluate function.\n&quot;</span>);</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;        }</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;        <span class="keyword">delete</span> ValueStack.pop_back_val();</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;        InstResult = RetVal;</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;        <span class="keywordflow">if</span> (InstResult != NULL) {</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Successfully evaluated function. Result: &quot;</span> &lt;&lt;</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;                InstResult &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>);</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;          <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Successfully evaluated function. Result: 0\n\n&quot;</span>);</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;        }</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;      }</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;TerminatorInst&gt;(CurInst)) {</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found a terminator instruction.\n&quot;</span>);</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BranchInst.html">BranchInst</a> *BI = dyn_cast&lt;BranchInst&gt;(CurInst)) {</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;        <span class="keywordflow">if</span> (BI-&gt;isUnconditional()) {</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;          NextBB = BI-&gt;getSuccessor(0);</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;          <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Cond =</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;            <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(getVal(BI-&gt;getCondition()));</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;          <span class="keywordflow">if</span> (!Cond) <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Cannot determine.</span></div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;          NextBB = BI-&gt;getSuccessor(!Cond-&gt;<a class="code" href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">getZExtValue</a>());</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;        }</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1SwitchInst.html">SwitchInst</a> *SI = dyn_cast&lt;SwitchInst&gt;(CurInst)) {</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;        <a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a> *Val =</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;          <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1ConstantInt.html">ConstantInt</a>&gt;(getVal(SI-&gt;getCondition()));</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;        <span class="keywordflow">if</span> (!Val) <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Cannot determine.</span></div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;        NextBB = SI-&gt;findCaseValue(Val).getCaseSuccessor();</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1IndirectBrInst.html">IndirectBrInst</a> *IBI = dyn_cast&lt;IndirectBrInst&gt;(CurInst)) {</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;        <a class="code" href="classllvm_1_1Value.html">Value</a> *Val = getVal(IBI-&gt;getAddress())-&gt;stripPointerCasts();</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1BlockAddress.html">BlockAddress</a> *BA = dyn_cast&lt;BlockAddress&gt;(Val))</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;          NextBB = BA-&gt;getBasicBlock();</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Cannot determine.</span></div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;ReturnInst&gt;(CurInst)) {</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;        NextBB = 0;</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;        <span class="comment">// invoke, unwind, resume, unreachable.</span></div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;        <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Can not handle terminator.&quot;</span>);</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// Cannot handle this terminator.</span></div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;      }</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;      <span class="comment">// We succeeded at evaluating this block!</span></div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Successfully evaluated block.\n&quot;</span>);</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;      <span class="comment">// Did not know how to evaluate this!</span></div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Failed to evaluate block due to unhandled instruction.&quot;</span></div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;            <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;    }</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;    <span class="keywordflow">if</span> (!CurInst-&gt;use_empty()) {</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1ConstantExpr.html">ConstantExpr</a> *CE = dyn_cast&lt;ConstantExpr&gt;(InstResult))</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;        InstResult = <a class="code" href="namespacellvm.html#a8891be7c27326c20a6dba7d98e9030b5">ConstantFoldConstantExpression</a>(CE, TD, TLI);</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;      setVal(CurInst, InstResult);</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;    }</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;    <span class="comment">// If we just processed an invoke, we finished evaluating the block.</span></div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *II = dyn_cast&lt;InvokeInst&gt;(CurInst)) {</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;      NextBB = II-&gt;getNormalDest();</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;      <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Found an invoke instruction. Finished Block.\n\n&quot;</span>);</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    }</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;    <span class="comment">// Advance program counter.</span></div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;    ++CurInst;</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;  }</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;}</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;<span class="comment">/// EvaluateFunction - Evaluate a call to function F, returning true if</span></div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;<span class="comment">/// successful, false if we can&#39;t evaluate it.  ActualArgs contains the formal</span></div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;<span class="comment">/// arguments for the function.</span></div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> Evaluator::EvaluateFunction(<a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>, <a class="code" href="classllvm_1_1Constant.html">Constant</a> *&amp;RetVal,</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;                                 <span class="keyword">const</span> <a class="code" href="classllvm_1_1SmallVectorImpl.html">SmallVectorImpl&lt;Constant*&gt;</a> &amp;ActualArgs) {</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;  <span class="comment">// Check to see if this function is already executing (recursion).  If so,</span></div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;  <span class="comment">// bail out.  TODO: we might want to accept limited recursion.</span></div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;  <span class="keywordflow">if</span> (std::find(CallStack.begin(), CallStack.end(), <a class="code" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>) != CallStack.end())</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;  CallStack.push_back(F);</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;  <span class="comment">// Initialize arguments to the incoming values specified.</span></div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;  <span class="keywordtype">unsigned</span> ArgNo = 0;</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Function::arg_iterator</a> AI = F-&gt;<a class="code" href="classllvm_1_1Function.html#a8bf193a781a92cae52d7f9216d0824f8">arg_begin</a>(), E = F-&gt;<a class="code" href="classllvm_1_1Function.html#a8300ac1ef141b8a7c63c13fa9369d976">arg_end</a>(); AI != E;</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;       ++AI, ++ArgNo)</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;    setVal(AI, ActualArgs[ArgNo]);</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;  <span class="comment">// ExecutedBlocks - We only handle non-looping, non-recursive code.  As such,</span></div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;  <span class="comment">// we can only evaluate any one basic block at most once.  This set keeps</span></div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;  <span class="comment">// track of what we have executed so we can detect recursive cases etc.</span></div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;BasicBlock*, 32&gt;</a> ExecutedBlocks;</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;  <span class="comment">// CurBB - The current basic block we&#39;re evaluating.</span></div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;  <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *CurBB = F-&gt;<a class="code" href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">begin</a>();</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;  <a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::iterator</a> CurInst = CurBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;  <span class="keywordflow">while</span> (1) {</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;    <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *NextBB = 0; <span class="comment">// Initialized to avoid compiler warnings.</span></div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Trying to evaluate BB: &quot;</span> &lt;&lt; *CurBB &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;    <span class="keywordflow">if</span> (!EvaluateBlock(CurInst, NextBB))</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;    <span class="keywordflow">if</span> (NextBB == 0) {</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;      <span class="comment">// Successfully running until there&#39;s no next block means that we found</span></div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;      <span class="comment">// the return.  Fill it the return value and pop the call stack.</span></div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;      <a class="code" href="classllvm_1_1ReturnInst.html">ReturnInst</a> *RI = cast&lt;ReturnInst&gt;(CurBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">getTerminator</a>());</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;      <span class="keywordflow">if</span> (RI-&gt;<a class="code" href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">getNumOperands</a>())</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;        RetVal = getVal(RI-&gt;<a class="code" href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">getOperand</a>(0));</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;      CallStack.pop_back();</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;    }</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;    <span class="comment">// Okay, we succeeded in evaluating this control flow.  See if we have</span></div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;    <span class="comment">// executed the new block before.  If so, we have a looping function,</span></div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;    <span class="comment">// which we cannot evaluate in reasonable time.</span></div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    <span class="keywordflow">if</span> (!ExecutedBlocks.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(NextBB))</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;  <span class="comment">// looped!</span></div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;    <span class="comment">// Okay, we have never been in this block before.  Check to see if there</span></div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;    <span class="comment">// are any PHI nodes.  If so, evaluate them with information about where</span></div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;    <span class="comment">// we came from.</span></div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;    <a class="code" href="classllvm_1_1PHINode.html">PHINode</a> *PN = 0;</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;    <span class="keywordflow">for</span> (CurInst = NextBB-&gt;<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;         (PN = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1PHINode.html">PHINode</a>&gt;(CurInst)); ++CurInst)</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;      setVal(PN, getVal(PN-&gt;<a class="code" href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">getIncomingValueForBlock</a>(CurBB)));</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;    <span class="comment">// Advance to the next block.</span></div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;    CurBB = NextBB;</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;  }</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;}</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;<span class="comment">/// EvaluateStaticConstructor - Evaluate static constructors in the function, if</span></div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;<span class="comment">/// we can.  Return true if we can, false otherwise.</span></div><div class="line"><a name="l02782"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a4b4d2cfcbf78730693d389dd59f0c848"> 2782</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a4b4d2cfcbf78730693d389dd59f0c848">EvaluateStaticConstructor</a>(<a class="code" href="classllvm_1_1Function.html">Function</a> *F, <span class="keyword">const</span> <a class="code" href="classllvm_1_1DataLayout.html">DataLayout</a> *TD,</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;                                      <span class="keyword">const</span> <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI) {</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;  <span class="comment">// Call the function.</span></div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;  <a class="code" href="AliasAnalysisEvaluator_8cpp.html#ad8b296a21110ccf9f34e73e4507dda2e">Evaluator</a> <a class="code" href="namespacellvm.html#a26dc52adbcc98fa9f17b055b0025e41f">Eval</a>(TD, TLI);</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *RetValDummy;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;  <span class="keywordtype">bool</span> EvalSuccess = Eval.EvaluateFunction(F, RetValDummy,</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;                                           <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;Constant*, 0&gt;</a>());</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;  <span class="keywordflow">if</span> (EvalSuccess) {</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;    <span class="comment">// We succeeded at evaluation: commit the result.</span></div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;FULLY EVALUATED GLOBAL CTOR FUNCTION &#39;&quot;</span></div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;          &lt;&lt; F-&gt;<a class="code" href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">getName</a>() &lt;&lt; <span class="stringliteral">&quot;&#39; to &quot;</span> &lt;&lt; Eval.getMutatedMemory().size()</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; stores.\n&quot;</span>);</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;Constant*, Constant*&gt;::const_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> =</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;           Eval.getMutatedMemory().begin(), E = Eval.getMutatedMemory().end();</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;         <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;      <a class="code" href="GlobalOpt_8cpp.html#a261cccda692dd81df2689f3d494ad4d9">CommitValueTo</a>(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second, <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first);</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;GlobalVariable*, 8&gt;::const_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> =</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;           Eval.getInvariants().begin(), E = Eval.getInvariants().end();</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;         <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;      (*I)-&gt;setConstant(<span class="keyword">true</span>);</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;  }</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;  <span class="keywordflow">return</span> EvalSuccess;</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;}</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;<span class="comment">/// OptimizeGlobalCtorsList - Simplify and evaluation global ctors if possible.</span></div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;<span class="comment">/// Return true if anything changed.</span></div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> GlobalOpt::OptimizeGlobalCtorsList(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *&amp;GCL) {</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;  std::vector&lt;Function*&gt; Ctors = <a class="code" href="GlobalOpt_8cpp.html#a026998887a46f3b53f04134c50d854d0">ParseGlobalCtors</a>(GCL);</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;  <span class="keywordtype">bool</span> MadeChange = <span class="keyword">false</span>;</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;  <span class="keywordflow">if</span> (Ctors.empty()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;  <span class="comment">// Loop over global ctors, optimizing them when we can.</span></div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != Ctors.size(); ++<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> *F = Ctors[<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;    <span class="comment">// Found a null terminator in the middle of the list, prune off the rest of</span></div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;    <span class="comment">// the list.</span></div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;    <span class="keywordflow">if</span> (F == 0) {</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a> != Ctors.size()-1) {</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;        Ctors.resize(<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>+1);</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;        MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;      }</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;    }</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;    <a class="code" href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a>(<a class="code" href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <span class="stringliteral">&quot;Optimizing Global Constructor: &quot;</span> &lt;&lt; *F &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;    <span class="comment">// We cannot simplify external ctor functions.</span></div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;    <span class="keywordflow">if</span> (F-&gt;<a class="code" href="classllvm_1_1Function.html#a6a782b47efe4d6ad9a7a36b6525d9203">empty</a>()) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;    <span class="comment">// If we can evaluate the ctor at compile time, do.</span></div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="GlobalOpt_8cpp.html#a4b4d2cfcbf78730693d389dd59f0c848">EvaluateStaticConstructor</a>(F, TD, TLI)) {</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;      Ctors.erase(Ctors.begin()+<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;      MadeChange = <span class="keyword">true</span>;</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;      --<a class="code" href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;      ++NumCtorsEvaluated;</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;    }</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;  }</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;  <span class="keywordflow">if</span> (!MadeChange) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;  GCL = <a class="code" href="GlobalOpt_8cpp.html#abaaf9df519b65d0c6e0f40c8be7e10b9">InstallGlobalCtors</a>(GCL, Ctors);</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;}</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;</div><div class="line"><a name="l02848"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#ad9ef9dbac3fbf9cc30e63d86bf9d7e34"> 2848</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="GlobalOpt_8cpp.html#ad9ef9dbac3fbf9cc30e63d86bf9d7e34">compareNames</a>(<a class="code" href="classllvm_1_1Constant.html">Constant</a> *<span class="keyword">const</span> *<a class="code" href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">A</a>, <a class="code" href="classllvm_1_1Constant.html">Constant</a> *<span class="keyword">const</span> *<a class="code" href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a>) {</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;  <span class="keywordflow">return</span> (*A)-&gt;getName().compare((*B)-&gt;getName());</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;}</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;</div><div class="line"><a name="l02852"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a89e14161646470e3bf6e583ffe2f6bf8"> 2852</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="GlobalOpt_8cpp.html#a89e14161646470e3bf6e583ffe2f6bf8">setUsedInitializer</a>(<a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> &amp;V,</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;                               <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;GlobalValue *, 8&gt;</a> <a class="code" href="classllvm_1_1Init.html">Init</a>) {</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;  <span class="keywordflow">if</span> (Init.<a class="code" href="classllvm_1_1SmallPtrSetImpl.html#a095445850ef2c64e96b4c05120cecf66">empty</a>()) {</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;    V.<a class="code" href="classllvm_1_1GlobalVariable.html#ae0cf03d5de37330b1eb69dd22a1d5057">eraseFromParent</a>();</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;  }</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;  <a class="code" href="classllvm_1_1SmallVector.html">SmallVector&lt;llvm::Constant *, 8&gt;</a> UsedArray;</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;  <a class="code" href="classllvm_1_1PointerType.html">PointerType</a> *Int8PtrTy = <a class="code" href="classllvm_1_1Type.html#a7fe9ccd4893f4e2caa826126c09545ea">Type::getInt8PtrTy</a>(V.<a class="code" href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">getContext</a>());</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;GlobalValue *, 8&gt;::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Init.<a class="code" href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">begin</a>(), E = Init.<a class="code" href="classllvm_1_1SmallPtrSet.html#a7f055d0b03ebf1d6a5988b178e9b8f4f">end</a>();</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Cast = <a class="code" href="classllvm_1_1ConstantExpr.html#aba93ec4079f8d709a1d5b4745310782e">llvm::ConstantExpr::getBitCast</a>(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Int8PtrTy);</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;    UsedArray.<a class="code" href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">push_back</a>(Cast);</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;  }</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;  <span class="comment">// Sort to get deterministic order.</span></div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;  <a class="code" href="namespacellvm.html#add1eb5637dd671428b6f138ed3db6428">array_pod_sort</a>(UsedArray.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">begin</a>(), UsedArray.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">end</a>(), <a class="code" href="GlobalOpt_8cpp.html#ad9ef9dbac3fbf9cc30e63d86bf9d7e34">compareNames</a>);</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;  <a class="code" href="classllvm_1_1ArrayType.html">ArrayType</a> *ATy = <a class="code" href="classllvm_1_1ArrayType.html#adf411edc4f135b570ab218079474ce77">ArrayType::get</a>(Int8PtrTy, UsedArray.<a class="code" href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">size</a>());</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;  <a class="code" href="classllvm_1_1Module.html">Module</a> *M = V.<a class="code" href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">getParent</a>();</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;  V.<a class="code" href="classllvm_1_1GlobalVariable.html#a22e076c4cf000eba885dd00048641c6f">removeFromParent</a>();</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;  <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *<a class="code" href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8">NV</a> =</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;      <span class="keyword">new</span> <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a>(*M, ATy, <span class="keyword">false</span>, <a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca96ad6314ba9210b223b93dc3e15baf99">llvm::GlobalValue::AppendingLinkage</a>,</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;                         <a class="code" href="classllvm_1_1ConstantArray.html#a0900dacdc7ad8e3ea0cc92993c7fd422">llvm::ConstantArray::get</a>(ATy, UsedArray), <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;  NV-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(&amp;V);</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;  NV-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a3aa0bd764357e7ac9a9b7ca59189af79">setSection</a>(<span class="stringliteral">&quot;llvm.metadata&quot;</span>);</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;  <span class="keyword">delete</span> &amp;V;</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;}</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;<span class="keyword">namespace </span>{<span class="comment"></span></div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;<span class="comment">/// \brief An easy to access representation of llvm.used and llvm.compiler.used.</span></div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;<span class="comment"></span><span class="keyword">class </span>LLVMUsed {</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;GlobalValue *, 8&gt;</a> Used;</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;  <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;GlobalValue *, 8&gt;</a> CompilerUsed;</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;  <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *UsedV;</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;  <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *CompilerUsedV;</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;  LLVMUsed(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M) {</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;    UsedV = <a class="code" href="namespacellvm.html#ae208097838a5c90d99c76315b5b4a64e">collectUsedGlobalVariables</a>(M, Used, <span class="keyword">false</span>);</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;    CompilerUsedV = <a class="code" href="namespacellvm.html#ae208097838a5c90d99c76315b5b4a64e">collectUsedGlobalVariables</a>(M, CompilerUsed, <span class="keyword">true</span>);</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;  }</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;GlobalValue *, 8&gt;::iterator</a> iterator;</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;  iterator usedBegin() { <span class="keywordflow">return</span> Used.<a class="code" href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">begin</a>(); }</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;  iterator usedEnd() { <span class="keywordflow">return</span> Used.<a class="code" href="classllvm_1_1SmallPtrSet.html#a7f055d0b03ebf1d6a5988b178e9b8f4f">end</a>(); }</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;  iterator compilerUsedBegin() { <span class="keywordflow">return</span> CompilerUsed.<a class="code" href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">begin</a>(); }</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;  iterator compilerUsedEnd() { <span class="keywordflow">return</span> CompilerUsed.<a class="code" href="classllvm_1_1SmallPtrSet.html#a7f055d0b03ebf1d6a5988b178e9b8f4f">end</a>(); }</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;  <span class="keywordtype">bool</span> usedCount(<a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *GV)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Used.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(GV); }</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;  <span class="keywordtype">bool</span> compilerUsedCount(<a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *GV)<span class="keyword"> const </span>{</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;    <span class="keywordflow">return</span> CompilerUsed.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">count</a>(GV);</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;  }</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;  <span class="keywordtype">bool</span> usedErase(<a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *GV) { <span class="keywordflow">return</span> Used.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ce650c1d4a48661b501206d04b6ab04">erase</a>(GV); }</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;  <span class="keywordtype">bool</span> compilerUsedErase(<a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *GV) { <span class="keywordflow">return</span> CompilerUsed.<a class="code" href="classllvm_1_1SmallPtrSet.html#a2ce650c1d4a48661b501206d04b6ab04">erase</a>(GV); }</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;  <span class="keywordtype">bool</span> usedInsert(<a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *GV) { <span class="keywordflow">return</span> Used.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(GV); }</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;  <span class="keywordtype">bool</span> compilerUsedInsert(<a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *GV) { <span class="keywordflow">return</span> CompilerUsed.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(GV); }</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;  <span class="keywordtype">void</span> syncVariablesAndSets() {</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;    <span class="keywordflow">if</span> (UsedV)</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;      <a class="code" href="GlobalOpt_8cpp.html#a89e14161646470e3bf6e583ffe2f6bf8">setUsedInitializer</a>(*UsedV, Used);</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;    <span class="keywordflow">if</span> (CompilerUsedV)</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;      <a class="code" href="GlobalOpt_8cpp.html#a89e14161646470e3bf6e583ffe2f6bf8">setUsedInitializer</a>(*CompilerUsedV, CompilerUsed);</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;  }</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;};</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;}</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;</div><div class="line"><a name="l02917"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#afa93649aba5a7b6388adff903a4a6085"> 2917</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#afa93649aba5a7b6388adff903a4a6085">hasUseOtherThanLLVMUsed</a>(<a class="code" href="classllvm_1_1GlobalAlias.html">GlobalAlias</a> &amp;GA, <span class="keyword">const</span> LLVMUsed &amp;U) {</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;  <span class="keywordflow">if</span> (GA.<a class="code" href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">use_empty</a>()) <span class="comment">// No use at all.</span></div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;  assert((!U.usedCount(&amp;GA) || !U.compilerUsedCount(&amp;GA)) &amp;&amp;</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;         <span class="stringliteral">&quot;We should have removed the duplicated &quot;</span></div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;         <span class="stringliteral">&quot;element from llvm.compiler.used&quot;</span>);</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;  <span class="keywordflow">if</span> (!GA.<a class="code" href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">hasOneUse</a>())</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;    <span class="comment">// Strictly more than one use. So at least one is not in llvm.used and</span></div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    <span class="comment">// llvm.compiler.used.</span></div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;  <span class="comment">// Exactly one use. Check if it is in llvm.used or llvm.compiler.used.</span></div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;  <span class="keywordflow">return</span> !U.usedCount(&amp;GA) &amp;&amp; !U.compilerUsedCount(&amp;GA);</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;}</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;</div><div class="line"><a name="l02933"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a31232d0640fc51e777d8e48e48f45c89"> 2933</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a31232d0640fc51e777d8e48e48f45c89">hasMoreThanOneUseOtherThanLLVMUsed</a>(<a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> &amp;V,</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;                                               <span class="keyword">const</span> LLVMUsed &amp;U) {</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 2;</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;  assert((!U.usedCount(&amp;V) || !U.compilerUsedCount(&amp;V)) &amp;&amp;</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;         <span class="stringliteral">&quot;We should have removed the duplicated &quot;</span></div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;         <span class="stringliteral">&quot;element from llvm.compiler.used&quot;</span>);</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;  <span class="keywordflow">if</span> (U.usedCount(&amp;V) || U.compilerUsedCount(&amp;V))</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;    ++N;</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;  <span class="keywordflow">return</span> V.<a class="code" href="classllvm_1_1Value.html#a9ea9a909185ecbf9fc81ab35ebfb11d6">hasNUsesOrMore</a>(N);</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;}</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;</div><div class="line"><a name="l02944"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a6ef58549c87cd57b83dcd7ce2d92cc03"> 2944</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a6ef58549c87cd57b83dcd7ce2d92cc03">mayHaveOtherReferences</a>(<a class="code" href="classllvm_1_1GlobalAlias.html">GlobalAlias</a> &amp;GA, <span class="keyword">const</span> LLVMUsed &amp;U) {</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;  <span class="keywordflow">if</span> (!GA.<a class="code" href="classllvm_1_1GlobalValue.html#abefc2d8baa67d6f9e49c95912cfde480">hasLocalLinkage</a>())</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;  <span class="keywordflow">return</span> U.usedCount(&amp;GA) || U.compilerUsedCount(&amp;GA);</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;}</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;</div><div class="line"><a name="l02951"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#ac38a6c2bc68401a0464fc5f818ffc3a2"> 2951</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#ac38a6c2bc68401a0464fc5f818ffc3a2">hasUsesToReplace</a>(<a class="code" href="classllvm_1_1GlobalAlias.html">GlobalAlias</a> &amp;GA, LLVMUsed &amp;U, <span class="keywordtype">bool</span> &amp;RenameTarget) {</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;  RenameTarget = <span class="keyword">false</span>;</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">Ret</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="GlobalOpt_8cpp.html#afa93649aba5a7b6388adff903a4a6085">hasUseOtherThanLLVMUsed</a>(GA, U))</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    Ret = <span class="keyword">true</span>;</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;  <span class="comment">// If the alias is externally visible, we may still be able to simplify it.</span></div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#a6ef58549c87cd57b83dcd7ce2d92cc03">mayHaveOtherReferences</a>(GA, U))</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">Ret</a>;</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;  <span class="comment">// If the aliasee has internal linkage, give it the name and linkage</span></div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;  <span class="comment">// of the alias, and delete the alias.  This turns:</span></div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;  <span class="comment">//   define internal ... @f(...)</span></div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;  <span class="comment">//   @a = alias ... @f</span></div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;  <span class="comment">// into:</span></div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;  <span class="comment">//   define ... @a(...)</span></div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;  <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Aliasee = GA.<a class="code" href="classllvm_1_1GlobalAlias.html#a7b0b0296ad4af9b9847b4405c7885161">getAliasee</a>();</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;  <a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *<a class="code" href="classllvm_1_1Target.html">Target</a> = cast&lt;GlobalValue&gt;(Aliasee-&gt;<a class="code" href="classllvm_1_1Value.html#a38ea12c04523d63adda732b9c5d6da0a">stripPointerCasts</a>());</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;  <span class="keywordflow">if</span> (!Target-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#abefc2d8baa67d6f9e49c95912cfde480">hasLocalLinkage</a>())</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;    <span class="keywordflow">return</span> Ret;</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;  <span class="comment">// Do not perform the transform if multiple aliases potentially target the</span></div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;  <span class="comment">// aliasee. This check also ensures that it is safe to replace the section</span></div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;  <span class="comment">// and other attributes of the aliasee with those of the alias.</span></div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="GlobalOpt_8cpp.html#a31232d0640fc51e777d8e48e48f45c89">hasMoreThanOneUseOtherThanLLVMUsed</a>(*Target, U))</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;    <span class="keywordflow">return</span> Ret;</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;  RenameTarget = <span class="keyword">true</span>;</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;}</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;<span class="keywordtype">bool</span> GlobalOpt::OptimizeGlobalAliases(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M) {</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;  LLVMUsed Used(M);</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1SmallPtrSetIterator.html">SmallPtrSet&lt;GlobalValue *, 8&gt;::iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Used.usedBegin(),</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;                                               E = Used.usedEnd();</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;    Used.compilerUsedErase(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">Module::alias_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = M.<a class="code" href="classllvm_1_1Module.html#a755dbbd47c63c53cda3e93d9d608562a">alias_begin</a>(), E = M.<a class="code" href="classllvm_1_1Module.html#a6d03597beb9097fc781a6c723cff50d6">alias_end</a>();</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E;) {</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;    <a class="code" href="classllvm_1_1ilist__iterator.html">Module::alias_iterator</a> J = <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;    <span class="comment">// Aliases without names cannot be referenced outside this module.</span></div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;    <span class="keywordflow">if</span> (!J-&gt;hasName() &amp;&amp; !J-&gt;isDeclaration())</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;      J-&gt;setLinkage(<a class="code" href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>);</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;    <span class="comment">// If the aliasee may change at link time, nothing can be done - bail out.</span></div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;    <span class="keywordflow">if</span> (J-&gt;mayBeOverridden())</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;    <a class="code" href="classllvm_1_1Constant.html">Constant</a> *Aliasee = J-&gt;getAliasee();</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    <a class="code" href="classllvm_1_1GlobalValue.html">GlobalValue</a> *<a class="code" href="classllvm_1_1Target.html">Target</a> = cast&lt;GlobalValue&gt;(Aliasee-&gt;<a class="code" href="classllvm_1_1Value.html#a38ea12c04523d63adda732b9c5d6da0a">stripPointerCasts</a>());</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;    Target-&gt;<a class="code" href="classllvm_1_1Constant.html#a50d0911852017f2168de329f53d8568d">removeDeadConstantUsers</a>();</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    <span class="comment">// Make all users of the alias use the aliasee instead.</span></div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    <span class="keywordtype">bool</span> RenameTarget;</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#ac38a6c2bc68401a0464fc5f818ffc3a2">hasUsesToReplace</a>(*J, Used, RenameTarget))</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;    J-&gt;replaceAllUsesWith(Aliasee);</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;    ++NumAliasesResolved;</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;    <span class="keywordflow">if</span> (RenameTarget) {</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;      <span class="comment">// Give the aliasee the name, linkage and other attributes of the alias.</span></div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;      Target-&gt;<a class="code" href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(J);</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;      Target-&gt;<a class="code" href="classllvm_1_1GlobalValue.html#a687973de03d041e04b50a76d19d4fd36">setLinkage</a>(J-&gt;getLinkage());</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;      Target-&gt;GlobalValue::copyAttributesFrom(J);</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;      <span class="keywordflow">if</span> (Used.usedErase(J))</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;        Used.usedInsert(Target);</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;      <span class="keywordflow">if</span> (Used.compilerUsedErase(J))</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;        Used.compilerUsedInsert(Target);</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="GlobalOpt_8cpp.html#a6ef58549c87cd57b83dcd7ce2d92cc03">mayHaveOtherReferences</a>(*J, Used))</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;    <span class="comment">// Delete the alias.</span></div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;    M.<a class="code" href="classllvm_1_1Module.html#afff7dfa535b91b210da27046e98e165e">getAliasList</a>().<a class="code" href="classllvm_1_1iplist.html#a5c2aa38108db7a66ac5e8da547f64ad7">erase</a>(J);</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;    ++NumAliasesRemoved;</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;    Changed = <span class="keyword">true</span>;</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;  }</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;  Used.syncVariablesAndSets();</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;}</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;</div><div class="line"><a name="l03039"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#ad38e073a20e77512a43dcdc9d2dea742"> 3039</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classllvm_1_1Function.html">Function</a> *<a class="code" href="GlobalOpt_8cpp.html#ad38e073a20e77512a43dcdc9d2dea742">FindCXAAtExit</a>(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M, <a class="code" href="classllvm_1_1TargetLibraryInfo.html">TargetLibraryInfo</a> *TLI) {</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;  <span class="keywordflow">if</span> (!TLI-&gt;<a class="code" href="classllvm_1_1TargetLibraryInfo.html#a986085d3cd43522192d93e84bc660978">has</a>(<a class="code" href="namespacellvm_1_1LibFunc.html#abf8f6830387f338fed0bce2e65108c6fa75da4c0488acc8319e47f53d82822837">LibFunc::cxa_atexit</a>))</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;  <a class="code" href="classllvm_1_1Function.html">Function</a> *Fn = M.<a class="code" href="classllvm_1_1Module.html#a3f156c68d0efa530f05698ca15d66593">getFunction</a>(TLI-&gt;<a class="code" href="classllvm_1_1TargetLibraryInfo.html#a0fe1c6579053c75b2089f8c2e60c65e0">getName</a>(<a class="code" href="namespacellvm_1_1LibFunc.html#abf8f6830387f338fed0bce2e65108c6fa75da4c0488acc8319e47f53d82822837">LibFunc::cxa_atexit</a>));</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;  <span class="keywordflow">if</span> (!Fn)</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;  <a class="code" href="classllvm_1_1FunctionType.html">FunctionType</a> *FTy = Fn-&gt;<a class="code" href="classllvm_1_1Function.html#adf66d58e85fb4e46e9c1ae55186a6930">getFunctionType</a>();</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;  <span class="comment">// Checking that the function has the right return type, the right number of</span></div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;  <span class="comment">// parameters and that they all have pointer types should be enough.</span></div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;  <span class="keywordflow">if</span> (!FTy-&gt;<a class="code" href="classllvm_1_1FunctionType.html#a9eda832d6e80bc19b98f22f4ec714e3f">getReturnType</a>()-&gt;<a class="code" href="classllvm_1_1Type.html#a6e328feb83afa5cf1c966d6704e43fc1">isIntegerTy</a>() ||</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;      FTy-&gt;<a class="code" href="classllvm_1_1FunctionType.html#a97cf043af111c14bb4d03a99cf42af03">getNumParams</a>() != 3 ||</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;      !FTy-&gt;<a class="code" href="classllvm_1_1FunctionType.html#a176b84b12bc19326444728c6404dd068">getParamType</a>(0)-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>() ||</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;      !FTy-&gt;<a class="code" href="classllvm_1_1FunctionType.html#a176b84b12bc19326444728c6404dd068">getParamType</a>(1)-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>() ||</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;      !FTy-&gt;<a class="code" href="classllvm_1_1FunctionType.html#a176b84b12bc19326444728c6404dd068">getParamType</a>(2)-&gt;<a class="code" href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">isPointerTy</a>())</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;  <span class="keywordflow">return</span> Fn;</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;}</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;<span class="comment">/// cxxDtorIsEmpty - Returns whether the given function is an empty C++</span></div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;<span class="comment">/// destructor and can therefore be eliminated.</span></div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;<span class="comment">/// Note that we assume that other optimization passes have already simplified</span></div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;<span class="comment">/// the code so we only look for a function with a single basic block, where</span></div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;<span class="comment">/// the only allowed instructions are &#39;ret&#39;, &#39;call&#39; to an empty C++ dtor and</span></div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;<span class="comment">/// other side-effect free instructions.</span></div><div class="line"><a name="l03068"></a><span class="lineno"><a class="line" href="GlobalOpt_8cpp.html#a2ad94ee43b92bdf7558036edccd3fcaa"> 3068</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="GlobalOpt_8cpp.html#a2ad94ee43b92bdf7558036edccd3fcaa">cxxDtorIsEmpty</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1Function.html">Function</a> &amp;Fn,</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;                           <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const Function *, 8&gt;</a> &amp;CalledFunctions) {</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;  <span class="comment">// FIXME: We could eliminate C++ destructors if they&#39;re readonly/readnone and</span></div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;  <span class="comment">// nounwind, but that doesn&#39;t seem worth doing.</span></div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;  <span class="keywordflow">if</span> (Fn.<a class="code" href="classllvm_1_1GlobalValue.html#a4640d98233102674ddb6d6efaf2b7f97">isDeclaration</a>())</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;  <span class="keywordflow">if</span> (++Fn.<a class="code" href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">begin</a>() != Fn.<a class="code" href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">end</a>())</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1BasicBlock.html">BasicBlock</a> &amp;EntryBlock = Fn.<a class="code" href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">getEntryBlock</a>();</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1ilist__iterator.html">BasicBlock::const_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = EntryBlock.<a class="code" href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), E = EntryBlock.<a class="code" href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>();</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;       <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>) {</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = dyn_cast&lt;CallInst&gt;(<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) {</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;      <span class="comment">// Ignore debug intrinsics.</span></div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;      <span class="keywordflow">if</span> (isa&lt;DbgInfoIntrinsic&gt;(CI))</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;      <span class="keyword">const</span> <a class="code" href="classllvm_1_1Function.html">Function</a> *CalledFn = CI-&gt;getCalledFunction();</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;      <span class="keywordflow">if</span> (!CalledFn)</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;      <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const Function *, 8&gt;</a> NewCalledFunctions(CalledFunctions);</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;      <span class="comment">// Don&#39;t treat recursive functions as empty.</span></div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;      <span class="keywordflow">if</span> (!NewCalledFunctions.<a class="code" href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">insert</a>(CalledFn))</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#a2ad94ee43b92bdf7558036edccd3fcaa">cxxDtorIsEmpty</a>(*CalledFn, NewCalledFunctions))</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isa&lt;ReturnInst&gt;(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// We&#39;re done.</span></div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayHaveSideEffects())</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Destructor with side effects, bail.</span></div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;  }</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;}</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;<span class="keywordtype">bool</span> GlobalOpt::OptimizeEmptyGlobalCXXDtors(<a class="code" href="classllvm_1_1Function.html">Function</a> *CXAAtExitFn) {<span class="comment"></span></div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;<span class="comment">  /// Itanium C++ ABI p3.3.5:</span></div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;<span class="comment">  ///   After constructing a global (or local static) object, that will require</span></div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;<span class="comment">  ///   destruction on exit, a termination function is registered as follows:</span></div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;<span class="comment">  ///   extern &quot;C&quot; int __cxa_atexit ( void (*f)(void *), void *p, void *d );</span></div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;<span class="comment">  ///</span></div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;<span class="comment">  ///   This registration, e.g. __cxa_atexit(f,p,d), is intended to cause the</span></div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;<span class="comment">  ///   call f(p) when DSO d is unloaded, before all such termination calls</span></div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;<span class="comment">  ///   registered before this one. It returns zero if registration is</span></div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;<span class="comment">  ///   successful, nonzero on failure.</span></div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;  <span class="comment">// This pass will look for calls to __cxa_atexit where the function is trivial</span></div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;  <span class="comment">// and remove them.</span></div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classllvm_1_1Value.html#ac33c7ecbf1c0f1e8bf93403522e6976b">Function::use_iterator</a> <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> = CXAAtExitFn-&gt;<a class="code" href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">use_begin</a>(),</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;       E = CXAAtExitFn-&gt;<a class="code" href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">use_end</a>(); <a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E;) {</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;    <span class="comment">// We&#39;re only interested in calls. Theoretically, we could handle invoke</span></div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;    <span class="comment">// instructions as well, but neither llvm-gcc nor clang generate invokes</span></div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;    <span class="comment">// to __cxa_atexit.</span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;    <a class="code" href="classllvm_1_1CallInst.html">CallInst</a> *CI = <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1CallInst.html">CallInst</a>&gt;(*<a class="code" href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a>++);</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;    <span class="keywordflow">if</span> (!CI)</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> *DtorFn =</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;      <a class="code" href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">dyn_cast</a>&lt;<a class="code" href="classllvm_1_1Function.html">Function</a>&gt;(CI-&gt;<a class="code" href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">getArgOperand</a>(0)-&gt;<a class="code" href="classllvm_1_1Value.html#a38ea12c04523d63adda732b9c5d6da0a">stripPointerCasts</a>());</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;    <span class="keywordflow">if</span> (!DtorFn)</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;    <a class="code" href="classllvm_1_1SmallPtrSet.html">SmallPtrSet&lt;const Function *, 8&gt;</a> CalledFunctions;</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="GlobalOpt_8cpp.html#a2ad94ee43b92bdf7558036edccd3fcaa">cxxDtorIsEmpty</a>(*DtorFn, CalledFunctions))</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;    <span class="comment">// Just remove the call.</span></div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;    CI-&gt;<a class="code" href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a class="code" href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(CI-&gt;<a class="code" href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">getType</a>()));</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;    CI-&gt;<a class="code" href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">eraseFromParent</a>();</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;    ++NumCXXDtorsRemoved;</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;    Changed |= <span class="keyword">true</span>;</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;  }</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;}</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;<span class="keywordtype">bool</span> GlobalOpt::runOnModule(<a class="code" href="classllvm_1_1Module.html">Module</a> &amp;M) {</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;  <span class="keywordtype">bool</span> Changed = <span class="keyword">false</span>;</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;  TD = getAnalysisIfAvailable&lt;DataLayout&gt;();</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;  TLI = &amp;getAnalysis&lt;TargetLibraryInfo&gt;();</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;  <span class="comment">// Try to find the llvm.globalctors list.</span></div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;  <a class="code" href="classllvm_1_1GlobalVariable.html">GlobalVariable</a> *GlobalCtors = FindGlobalCtors(M);</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;  <span class="keywordtype">bool</span> LocalChange = <span class="keyword">true</span>;</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;  <span class="keywordflow">while</span> (LocalChange) {</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    LocalChange = <span class="keyword">false</span>;</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;    <span class="comment">// Delete functions that are trivially dead, ccc -&gt; fastcc</span></div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;    LocalChange |= OptimizeFunctions(M);</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;    <span class="comment">// Optimize global_ctors list.</span></div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;    <span class="keywordflow">if</span> (GlobalCtors)</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;      LocalChange |= OptimizeGlobalCtorsList(GlobalCtors);</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;    <span class="comment">// Optimize non-address-taken globals.</span></div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;    LocalChange |= OptimizeGlobalVars(M);</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    <span class="comment">// Resolve aliases, when possible.</span></div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;    LocalChange |= OptimizeGlobalAliases(M);</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;    <span class="comment">// Try to remove trivial global destructors if they are not removed</span></div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    <span class="comment">// already.</span></div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;    <a class="code" href="classllvm_1_1Function.html">Function</a> *CXAAtExitFn = <a class="code" href="GlobalOpt_8cpp.html#ad38e073a20e77512a43dcdc9d2dea742">FindCXAAtExit</a>(M, TLI);</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;    <span class="keywordflow">if</span> (CXAAtExitFn)</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;      LocalChange |= OptimizeEmptyGlobalCXXDtors(CXAAtExitFn);</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;    Changed |= LocalChange;</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;  }</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;  <span class="comment">// TODO: Move all global ctors functions to the end of the module for code</span></div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;  <span class="comment">// layout.</span></div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;  <span class="keywordflow">return</span> Changed;</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;}</div><div class="ttc" id="GlobalOpt_8cpp_html_a387ee79de1e991d8a1ebe6c495332eae"><div class="ttname"><a href="GlobalOpt_8cpp.html#a387ee79de1e991d8a1ebe6c495332eae">OptimizeGlobalAddressOfMalloc</a></div><div class="ttdeci">static GlobalVariable * OptimizeGlobalAddressOfMalloc(GlobalVariable *GV, CallInst *CI, Type *AllocTy, ConstantInt *NElements, DataLayout *TD, TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00828">GlobalOpt.cpp:828</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a09f4de698936d7b646c9ef5a0cc0920d"><div class="ttname"><a href="classllvm_1_1Function.html#a09f4de698936d7b646c9ef5a0cc0920d">llvm::Function::isDefTriviallyDead</a></div><div class="ttdeci">bool isDefTriviallyDead() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00712">Function.cpp:712</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a075e34e98605d0e7c289763a104869ac"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a075e34e98605d0e7c289763a104869ac">llvm::SmallVectorTemplateCommon&lt; T &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00114">SmallVector.h:114</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a22a311dfe4c28a897de8a9365a4f0a84"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a22a311dfe4c28a897de8a9365a4f0a84">llvm::SmallVectorTemplateCommon&lt; T &gt;::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00127">SmallVector.h:127</a></div></div>
<div class="ttc" id="namespacellvm_html_a557372a0f9217d7171352952ce9d75bc"><div class="ttname"><a href="namespacellvm.html#a557372a0f9217d7171352952ce9d75bc">llvm::DeleteContainerPointers</a></div><div class="ttdeci">void DeleteContainerPointers(Container &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00315">STLExtras.h:315</a></div></div>
<div class="ttc" id="classllvm_1_1ReturnInst_html"><div class="ttname"><a href="classllvm_1_1ReturnInst.html">llvm::ReturnInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02279">Instructions.h:2279</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateBase_html_ae1a10b90f22c0478960fb5798ff73916"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateBase.html#ae1a10b90f22c0478960fb5798ff73916">llvm::SmallVectorTemplateBase&lt; T, isPodLike&lt; T &gt;::value &gt;::push_back</a></div><div class="ttdeci">void push_back(const T &amp;Elt)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00236">SmallVector.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad86469939d2a8bdd4169be9403b89f5a"><div class="ttname"><a href="classllvm_1_1Value.html#ad86469939d2a8bdd4169be9403b89f5a">llvm::Value::use_end</a></div><div class="ttdeci">use_iterator use_end()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00152">Value.h:152</a></div></div>
<div class="ttc" id="namespacellvm_html_a455d82c49557ac1d6c8da8e8d86a94b5"><div class="ttname"><a href="namespacellvm.html#a455d82c49557ac1d6c8da8e8d86a94b5">llvm::isAllocationFn</a></div><div class="ttdeci">bool isAllocationFn(const Value *V, const TargetLibraryInfo *TLI, bool LookThroughBitCast=false)</div><div class="ttdoc">Tests if a value is a call or invoke to a library function that allocates or reallocates memory (eith...</div><div class="ttdef"><b>Definition:</b> <a href="MemoryBuiltins_8cpp_source.html#l00150">MemoryBuiltins.cpp:150</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a73349916f7e54a6b988a3646c7a02e90aa332b90dd5e4ebf4bbbcc0964220d373"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90aa332b90dd5e4ebf4bbbcc0964220d373">llvm::Intrinsic::lifetime_end</a></div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l01254">Intrinsics.h:1254</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html"><div class="ttname"><a href="classllvm_1_1DataLayout.html">llvm::DataLayout</a></div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00098">DataLayout.h:98</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_a38ea691c2eeaf3facd74d5cfb0c725b0"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a38ea691c2eeaf3facd74d5cfb0c725b0">llvm::GlobalValue::getLinkage</a></div><div class="ttdeci">LinkageTypes getLinkage() const </div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00218">GlobalValue.h:218</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_aa7cce62ac5cc6df09cce0535874336b7"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#aa7cce62ac5cc6df09cce0535874336b7">llvm::ConstantInt::getFalse</a></div><div class="ttdeci">static ConstantInt * getFalse(LLVMContext &amp;Context)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00445">Constants.cpp:445</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html"><div class="ttname"><a href="classllvm_1_1CmpInst.html">llvm::CmpInst</a></div><div class="ttdoc">Abstract base class of comparison instructions. </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00633">InstrTypes.h:633</a></div></div>
<div class="ttc" id="namespacellvm_1_1ARM__PROC_html_aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5"><div class="ttname"><a href="namespacellvm_1_1ARM__PROC.html#aac31dd660a6f18140efdd62b351cb11bad9577456b5bb7a03b7f42a710e122ab5">llvm::ARM_PROC::A</a></div><div class="ttdef"><b>Definition:</b> <a href="ARMBaseInfo_8h_source.html#l00098">ARMBaseInfo.h:98</a></div></div>
<div class="ttc" id="structllvm_1_1GlobalStatus_html_a0371d896aba2b285da63fca3b700b169"><div class="ttname"><a href="structllvm_1_1GlobalStatus.html#a0371d896aba2b285da63fca3b700b169">llvm::GlobalStatus::IsLoaded</a></div><div class="ttdeci">bool IsLoaded</div><div class="ttdef"><b>Definition:</b> <a href="GlobalStatus_8h_source.html#l00034">GlobalStatus.h:34</a></div></div>
<div class="ttc" id="namespacellvm_1_1tgtok_html_abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac"><div class="ttname"><a href="namespacellvm_1_1tgtok.html#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">llvm::tgtok::In</a></div><div class="ttdef"><b>Definition:</b> <a href="TGLexer_8h_source.html#l00046">TGLexer.h:46</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_ace2885fc42e68606f270bfd3180d5f26"><div class="ttname"><a href="GlobalOpt_8cpp.html#ace2885fc42e68606f270bfd3180d5f26">isLeakCheckerRoot</a></div><div class="ttdeci">static bool isLeakCheckerRoot(GlobalVariable *GV)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00103">GlobalOpt.cpp:103</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_aa75984a442f2379de0c66018201fa628"><div class="ttname"><a href="classllvm_1_1Type.html#aa75984a442f2379de0c66018201fa628">llvm::Type::getInt1Ty</a></div><div class="ttdeci">static IntegerType * getInt1Ty(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00238">Type.cpp:238</a></div></div>
<div class="ttc" id="namespacellvm_html_ab8e34eca3b0817ef7a127913fbf6d9e4"><div class="ttname"><a href="namespacellvm.html#ab8e34eca3b0817ef7a127913fbf6d9e4">llvm::errs</a></div><div class="ttdeci">raw_ostream &amp; errs()</div><div class="ttdef"><b>Definition:</b> <a href="raw__ostream_8cpp_source.html#l00664">raw_ostream.cpp:664</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a4786e64977a3af38f29adee46b70a863"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a4786e64977a3af38f29adee46b70a863">llvm::SmallVectorImpl::reserve</a></div><div class="ttdeci">void reserve(unsigned N)</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00425">SmallVector.h:425</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a089cccb6f231efee72abc76d0f9c695f"><div class="ttname"><a href="classllvm_1_1PHINode.html#a089cccb6f231efee72abc76d0f9c695f">llvm::PHINode::addIncoming</a></div><div class="ttdeci">void addIncoming(Value *V, BasicBlock *BB)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02100">Instructions.h:2100</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_aedfa75f0c85c4aa85b257f066fbea57ca96ad6314ba9210b223b93dc3e15baf99"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca96ad6314ba9210b223b93dc3e15baf99">llvm::GlobalValue::AppendingLinkage</a></div><div class="ttdoc">Special purpose, only applies to global arrays. </div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00040">GlobalValue.h:40</a></div></div>
<div class="ttc" id="classllvm_1_1PassRegistry_html_a05a729900b76c89e808c6c3094921b2f"><div class="ttname"><a href="classllvm_1_1PassRegistry.html#a05a729900b76c89e808c6c3094921b2f">llvm::PassRegistry::getPassRegistry</a></div><div class="ttdeci">static PassRegistry * getPassRegistry()</div><div class="ttdef"><b>Definition:</b> <a href="PassRegistry_8cpp_source.html#l00035">PassRegistry.cpp:35</a></div></div>
<div class="ttc" id="structllvm_1_1GlobalStatus_html_a43ef0bbeda0cb9e7aafb3f83e56665e3"><div class="ttname"><a href="structllvm_1_1GlobalStatus.html#a43ef0bbeda0cb9e7aafb3f83e56665e3">llvm::GlobalStatus::StoredOnceValue</a></div><div class="ttdeci">Value * StoredOnceValue</div><div class="ttdef"><b>Definition:</b> <a href="GlobalStatus_8h_source.html#l00058">GlobalStatus.h:58</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a2da53ac53516a3f16191f4c8a8eaa3e5"><div class="ttname"><a href="classllvm_1_1Function.html#a2da53ac53516a3f16191f4c8a8eaa3e5">llvm::Function::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00167">Function.cpp:167</a></div></div>
<div class="ttc" id="structllvm_1_1GlobalStatus_html_abdf22b304eab8994314a2a89c00103fc"><div class="ttname"><a href="structllvm_1_1GlobalStatus.html#abdf22b304eab8994314a2a89c00103fc">llvm::GlobalStatus::AccessingFunction</a></div><div class="ttdeci">const Function * AccessingFunction</div><div class="ttdef"><b>Definition:</b> <a href="GlobalStatus_8h_source.html#l00063">GlobalStatus.h:63</a></div></div>
<div class="ttc" id="classllvm_1_1CallSiteBase_html_a4e7c7828319bc9db0f49c3c6d8f56ac7"><div class="ttname"><a href="classllvm_1_1CallSiteBase.html#a4e7c7828319bc9db0f49c3c6d8f56ac7">llvm::CallSiteBase::getAttributes</a></div><div class="ttdeci">const AttributeSet &amp; getAttributes() const </div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00179">CallSite.h:179</a></div></div>
<div class="ttc" id="namespacellvm_1_1SPII_html_a11e9b8fca4a074643a6a21f444e51406a5069619ca8fdce305534f3fe85091a0f"><div class="ttname"><a href="namespacellvm_1_1SPII.html#a11e9b8fca4a074643a6a21f444e51406a5069619ca8fdce305534f3fe85091a0f">llvm::SPII::Load</a></div><div class="ttdef"><b>Definition:</b> <a href="SparcInstrInfo_8h_source.html#l00031">SparcInstrInfo.h:31</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a6fe2f06b8a4b2c3d6308afb223a0238a"><div class="ttname"><a href="classllvm_1_1Instruction.html#a6fe2f06b8a4b2c3d6308afb223a0238a">llvm::Instruction::eraseFromParent</a></div><div class="ttdeci">void eraseFromParent()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8cpp_source.html#l00072">Instruction.cpp:72</a></div></div>
<div class="ttc" id="Instructions_8h_html"><div class="ttname"><a href="Instructions_8h.html">Instructions.h</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalVariable_html_ab1b932862d7d88dae34cfd24f44847a3"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html#ab1b932862d7d88dae34cfd24f44847a3">llvm::GlobalVariable::getThreadLocalMode</a></div><div class="ttdeci">ThreadLocalMode getThreadLocalMode() const </div><div class="ttdef"><b>Definition:</b> <a href="GlobalVariable_8h_source.html#l00164">GlobalVariable.h:164</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a9b6d1ca60deddf2f2c25cfea671f617c"><div class="ttname"><a href="classllvm_1_1Value.html#a9b6d1ca60deddf2f2c25cfea671f617c">llvm::Value::hasName</a></div><div class="ttdeci">bool hasName() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00117">Value.h:117</a></div></div>
<div class="ttc" id="namespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">List of target independent CodeGen pass IDs. </div><div class="ttdef"><b>Definition:</b> <a href="APFloat_8h_source.html#l00022">APFloat.h:22</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_ae32894671894c23afc705c218f76ea03"><div class="ttname"><a href="GlobalOpt_8cpp.html#ae32894671894c23afc705c218f76ea03">IsSafeComputationToRemove</a></div><div class="ttdeci">static bool IsSafeComputationToRemove(Value *V, const TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00151">GlobalOpt.cpp:151</a></div></div>
<div class="ttc" id="classllvm_1_1StructType_html_a47f8a52ece53e2e1ef08ab2d58f93c88"><div class="ttname"><a href="classllvm_1_1StructType.html#a47f8a52ece53e2e1ef08ab2d58f93c88">llvm::StructType::isOpaque</a></div><div class="ttdeci">bool isOpaque() const </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00249">DerivedTypes.h:249</a></div></div>
<div class="ttc" id="namespacellvm_html_af2c14d2f82bff2130daf86f4e22ae14d"><div class="ttname"><a href="namespacellvm.html#af2c14d2f82bff2130daf86f4e22ae14d">llvm::ConstantFoldLoadThroughGEPConstantExpr</a></div><div class="ttdeci">Constant * ConstantFoldLoadThroughGEPConstantExpr(Constant *C, ConstantExpr *CE)</div><div class="ttdef"><b>Definition:</b> <a href="ConstantFolding_8cpp_source.html#l01142">ConstantFolding.cpp:1142</a></div></div>
<div class="ttc" id="DerivedTypes_8h_html"><div class="ttname"><a href="DerivedTypes_8h.html">DerivedTypes.h</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html"><div class="ttname"><a href="classllvm_1_1Module.html">llvm::Module</a></div><div class="ttdoc">The main container class for the LLVM Intermediate Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00112">Module.h:112</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionType_html_a97cf043af111c14bb4d03a99cf42af03"><div class="ttname"><a href="classllvm_1_1FunctionType.html#a97cf043af111c14bb4d03a99cf42af03">llvm::FunctionType::getNumParams</a></div><div class="ttdeci">unsigned getNumParams() const </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00133">DerivedTypes.h:133</a></div></div>
<div class="ttc" id="classllvm_1_1CallSiteBase_html_acc2eeccdf71d83b3c08d6218317a1430"><div class="ttname"><a href="classllvm_1_1CallSiteBase.html#acc2eeccdf71d83b3c08d6218317a1430">llvm::CallSiteBase::arg_end</a></div><div class="ttdeci">IterTy arg_end() const </div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00143">CallSite.h:143</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalAlias_html"><div class="ttname"><a href="classllvm_1_1GlobalAlias.html">llvm::GlobalAlias</a></div><div class="ttdef"><b>Definition:</b> <a href="GlobalAlias_8h_source.html#l00029">GlobalAlias.h:29</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_a8a69689cb8586761c6a7535a8f6618a5"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a8a69689cb8586761c6a7535a8f6618a5">llvm::GlobalValue::getAlignment</a></div><div class="ttdeci">unsigned getAlignment() const </div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00079">GlobalValue.h:79</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_ae4ca2261b8b901e415fda7feac5051ea"><div class="ttname"><a href="classllvm_1_1Function.html#ae4ca2261b8b901e415fda7feac5051ea">llvm::Function::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00397">Function.h:397</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a83ed3f5555682a0bac5a9454885f2bac"><div class="ttname"><a href="GlobalOpt_8cpp.html#a83ed3f5555682a0bac5a9454885f2bac">TryToOptimizeStoreOfMallocToGlobal</a></div><div class="ttdeci">static bool TryToOptimizeStoreOfMallocToGlobal(GlobalVariable *GV, CallInst *CI, Type *AllocTy, AtomicOrdering Ordering, Module::global_iterator &amp;GVI, DataLayout *TD, TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l01467">GlobalOpt.cpp:1467</a></div></div>
<div class="ttc" id="CallingConv_8h_html"><div class="ttname"><a href="CallingConv_8h.html">CallingConv.h</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_ae7c164feceeaa7db7809c9c82c4b7568"><div class="ttname"><a href="GlobalOpt_8cpp.html#ae7c164feceeaa7db7809c9c82c4b7568">INITIALIZE_PASS_BEGIN</a></div><div class="ttdeci">INITIALIZE_PASS_BEGIN(GlobalOpt,&quot;globalopt&quot;,&quot;Global Variable Optimizer&quot;, false, false) INITIALIZE_PASS_END(GlobalOpt</div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_a0296d582257338d55fbf5cd3071207fc"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#a0296d582257338d55fbf5cd3071207fc">llvm::ConstantExpr::getSelect</a></div><div class="ttdeci">static Constant * getSelect(Constant *C, Constant *V1, Constant *V2)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01831">Constants.cpp:1831</a></div></div>
<div class="ttc" id="classllvm_1_1SelectInst_html_a8bce457e977f23507c48c9dfd7052990"><div class="ttname"><a href="classllvm_1_1SelectInst.html#a8bce457e977f23507c48c9dfd7052990">llvm::SelectInst::Create</a></div><div class="ttdeci">static SelectInst * Create(Value *C, Value *S1, Value *S2, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01455">Instructions.h:1455</a></div></div>
<div class="ttc" id="IntrinsicInst_8h_html"><div class="ttname"><a href="IntrinsicInst_8h.html">IntrinsicInst.h</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a35445872809e31831849ca99f41540d0"><div class="ttname"><a href="GlobalOpt_8cpp.html#a35445872809e31831849ca99f41540d0">ReplaceUsesOfMallocWithGlobal</a></div><div class="ttdeci">static void ReplaceUsesOfMallocWithGlobal(Instruction *Alloc, GlobalVariable *GV)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l01011">GlobalOpt.cpp:1011</a></div></div>
<div class="ttc" id="classllvm_1_1CallSiteBase_html_a13ce8cb4c50c5b3505915467e14ad95a"><div class="ttname"><a href="classllvm_1_1CallSiteBase.html#a13ce8cb4c50c5b3505915467e14ad95a">llvm::CallSiteBase::arg_size</a></div><div class="ttdeci">unsigned arg_size() const </div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00145">CallSite.h:145</a></div></div>
<div class="ttc" id="namespacellvm_html_a3f2f98c2a67c9e79f58aad9150a62e42"><div class="ttname"><a href="namespacellvm.html#a3f2f98c2a67c9e79f58aad9150a62e42">llvm::dyn_cast</a></div><div class="ttdeci">enable_if_c&lt;!is_simple_type&lt; Y &gt;::value, typename cast_retty&lt; X, const Y &gt;::ret_type &gt;::type dyn_cast(const Y &amp;Val)</div><div class="ttdef"><b>Definition:</b> <a href="Casting_8h_source.html#l00266">Casting.h:266</a></div></div>
<div class="ttc" id="classllvm_1_1ZExtInst_html"><div class="ttname"><a href="classllvm_1_1ZExtInst.html">llvm::ZExtInst</a></div><div class="ttdoc">This class represents zero extension of integer types. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03211">Instructions.h:3211</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html_a28c0310f56c2ea41ff7012df55ac6dc5"><div class="ttname"><a href="classllvm_1_1Module.html#a28c0310f56c2ea41ff7012df55ac6dc5">llvm::Module::getGlobalList</a></div><div class="ttdeci">const GlobalListType &amp; getGlobalList() const </div><div class="ttdoc">Get the Module&amp;#39;s list of global variables (constant). </div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00485">Module.h:485</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a2f81e0c1fc6554df7ad2eafabf5fc5a5"><div class="ttname"><a href="classllvm_1_1User.html#a2f81e0c1fc6554df7ad2eafabf5fc5a5">llvm::User::getNumOperands</a></div><div class="ttdeci">unsigned getNumOperands() const </div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00108">User.h:108</a></div></div>
<div class="ttc" id="classllvm_1_1Attribute_html_aab7ee4b8fd1d3e7e4cea87868855e60ea26003dadfa771bce07fe0d9b38c51437"><div class="ttname"><a href="classllvm_1_1Attribute.html#aab7ee4b8fd1d3e7e4cea87868855e60ea26003dadfa771bce07fe0d9b38c51437">llvm::Attribute::Nest</a></div><div class="ttdoc">Nested function static chain. </div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l00079">Attributes.h:79</a></div></div>
<div class="ttc" id="DataLayout_8h_html"><div class="ttname"><a href="DataLayout_8h.html">DataLayout.h</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_a51940249c228e46f1f97932e5f4b8450"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#a51940249c228e46f1f97932e5f4b8450">llvm::ConstantExpr::getGetElementPtr</a></div><div class="ttdeci">static Constant * getGetElementPtr(Constant *C, ArrayRef&lt; Constant * &gt; IdxList, bool InBounds=false)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l01012">Constants.h:1012</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00534">DenseMap.h:534</a></div></div>
<div class="ttc" id="namespacellvm_1_1CallingConv_html_a4f861731fc6dbfdccc05af5968d98974afd841a49aec1539bc88abc8ff9e170fb"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974afd841a49aec1539bc88abc8ff9e170fb">llvm::CallingConv::C</a></div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00031">CallingConv.h:31</a></div></div>
<div class="ttc" id="README-SSE_8txt_html_a63d206a063eefcdf8c318ded97b65020"><div class="ttname"><a href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a></div><div class="ttdeci">This currently compiles esp xmm0 movsd esp eax eax esp ret We should use not the dag combiner This is because dagcombine2 needs to be able to see through the X86ISD::Wrapper which DAGCombine can t really do The code for turning x load into a single vector load is target independent and should be moved to the dag combiner The code for turning x load into a vector load can only handle a direct load from a global or a direct load from the stack It should be generalized to handle any load from P</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00427">README-SSE.txt:427</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_acc21b8049c491d3f4b42eaeec97f6cc7"><div class="ttname"><a href="GlobalOpt_8cpp.html#acc21b8049c491d3f4b42eaeec97f6cc7">isSafeSROAElementUse</a></div><div class="ttdeci">static bool isSafeSROAElementUse(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00354">GlobalOpt.cpp:354</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html"><div class="ttname"><a href="classllvm_1_1PHINode.html">llvm::PHINode</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01978">Instructions.h:1978</a></div></div>
<div class="ttc" id="Debug_8h_html"><div class="ttname"><a href="Debug_8h.html">Debug.h</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html"><div class="ttname"><a href="classllvm_1_1CallInst.html">llvm::CallInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01161">Instructions.h:1161</a></div></div>
<div class="ttc" id="classllvm_1_1CallSiteBase_html_ae8db0b64d91fa18dfcc01a684708c00b"><div class="ttname"><a href="classllvm_1_1CallSiteBase.html#ae8db0b64d91fa18dfcc01a684708c00b">llvm::CallSiteBase::setCalledFunction</a></div><div class="ttdeci">void setCalledFunction(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00099">CallSite.h:99</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a026998887a46f3b53f04134c50d854d0"><div class="ttname"><a href="GlobalOpt_8cpp.html#a026998887a46f3b53f04134c50d854d0">ParseGlobalCtors</a></div><div class="ttdeci">static std::vector&lt; Function * &gt; ParseGlobalCtors(GlobalVariable *GV)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l01995">GlobalOpt.cpp:1995</a></div></div>
<div class="ttc" id="namespacellvm_html_a43c6ebb4fd35ebd815d66a2df4eed0b9"><div class="ttname"><a href="namespacellvm.html#a43c6ebb4fd35ebd815d66a2df4eed0b9">llvm::gep_type_end</a></div><div class="ttdeci">gep_type_iterator gep_type_end(const User *GEP)</div><div class="ttdef"><b>Definition:</b> <a href="GetElementPtrTypeIterator_8h_source.html#l00089">GetElementPtrTypeIterator.h:89</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05ad92f160316221fd4090520bb2b3cefc5"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05ad92f160316221fd4090520bb2b3cefc5">llvm::CmpInst::ICMP_ULE</a></div><div class="ttdoc">unsigned less or equal </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00677">InstrTypes.h:677</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05a91d86a4753c8bd7624e01bf565d87f8e"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a91d86a4753c8bd7624e01bf565d87f8e">llvm::CmpInst::ICMP_ULT</a></div><div class="ttdoc">unsigned less than </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00676">InstrTypes.h:676</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a9b6dd0fc7a648a939e571246045b673e"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a9b6dd0fc7a648a939e571246045b673e">llvm::SmallPtrSet::insert</a></div><div class="ttdeci">bool insert(PtrType Ptr)</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00253">SmallPtrSet.h:253</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a573063aad4c101462893d0490d867524"><div class="ttname"><a href="classllvm_1_1Instruction.html#a573063aad4c101462893d0490d867524">llvm::Instruction::mayHaveSideEffects</a></div><div class="ttdeci">bool mayHaveSideEffects() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00324">Instruction.h:324</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_ad5e0f87ba24074dd68abfa5a29e7db6a"><div class="ttname"><a href="GlobalOpt_8cpp.html#ad5e0f87ba24074dd68abfa5a29e7db6a">EvaluateStoreInto</a></div><div class="ttdeci">static Constant * EvaluateStoreInto(Constant *Init, Constant *Val, ConstantExpr *Addr, unsigned OpNo)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l02203">GlobalOpt.cpp:2203</a></div></div>
<div class="ttc" id="structllvm_1_1GlobalStatus_html_a31d0dff181f81a41bb701e89600fe324"><div class="ttname"><a href="structllvm_1_1GlobalStatus.html#a31d0dff181f81a41bb701e89600fe324">llvm::GlobalStatus::HasMultipleAccessingFunctions</a></div><div class="ttdeci">bool HasMultipleAccessingFunctions</div><div class="ttdef"><b>Definition:</b> <a href="GlobalStatus_8h_source.html#l00064">GlobalStatus.h:64</a></div></div>
<div class="ttc" id="classllvm_1_1CallSiteBase_html_addab854f674836e5497dcfafff324e27"><div class="ttname"><a href="classllvm_1_1CallSiteBase.html#addab854f674836e5497dcfafff324e27">llvm::CallSiteBase::setArgument</a></div><div class="ttdeci">void setArgument(unsigned ArgNo, Value *newVal)</div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00116">CallSite.h:116</a></div></div>
<div class="ttc" id="classllvm_1_1APInt_html_ae0c5e70885cf005feb6707932774f99c"><div class="ttname"><a href="classllvm_1_1APInt.html#ae0c5e70885cf005feb6707932774f99c">llvm::APInt::getLimitedValue</a></div><div class="ttdeci">uint64_t getLimitedValue(uint64_t Limit=~0ULL) const </div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00408">APInt.h:408</a></div></div>
<div class="ttc" id="classllvm_1_1MemSetInst_html"><div class="ttname"><a href="classllvm_1_1MemSetInst.html">llvm::MemSetInst</a></div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00190">IntrinsicInst.h:190</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_a3aa0bd764357e7ac9a9b7ca59189af79"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a3aa0bd764357e7ac9a9b7ca59189af79">llvm::GlobalValue::setSection</a></div><div class="ttdeci">void setSection(StringRef S)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00097">GlobalValue.h:97</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_aca229503e4f5c83a187a6a921c625fa8"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#aca229503e4f5c83a187a6a921c625fa8">llvm::BasicBlock::getParent</a></div><div class="ttdeci">const Function * getParent() const </div><div class="ttdoc">Return the enclosing method, or null if none. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00116">BasicBlock.h:116</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a8300ac1ef141b8a7c63c13fa9369d976"><div class="ttname"><a href="classllvm_1_1Function.html#a8300ac1ef141b8a7c63c13fa9369d976">llvm::Function::arg_end</a></div><div class="ttdeci">arg_iterator arg_end()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00418">Function.h:418</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a5e9e1c0dd93557be1b4ad72860f3cbdaa812a573d23fbb37aacd025e2a0588156"><div class="ttname"><a href="classllvm_1_1Type.html#a5e9e1c0dd93557be1b4ad72860f3cbdaa812a573d23fbb37aacd025e2a0588156">llvm::Type::StructTyID</a></div><div class="ttdoc">12: Structures </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00070">Type.h:70</a></div></div>
<div class="ttc" id="LLParser_8cpp_html_a33ece1ef8074506a15d7f86eb76dbae6"><div class="ttname"><a href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a></div><div class="ttdeci">F(f)</div></div>
<div class="ttc" id="classllvm_1_1PointerType_html_a921061a57ec3cfbaf6422f09f7d79fc3"><div class="ttname"><a href="classllvm_1_1PointerType.html#a921061a57ec3cfbaf6422f09f7d79fc3">llvm::PointerType::getAddressSpace</a></div><div class="ttdeci">unsigned getAddressSpace() const </div><div class="ttdoc">Return the address space of the Pointer type. </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00445">DerivedTypes.h:445</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html"><div class="ttname"><a href="classllvm_1_1Function.html">llvm::Function</a></div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00070">Function.h:70</a></div></div>
<div class="ttc" id="classllvm_1_1LoadInst_html"><div class="ttname"><a href="classllvm_1_1LoadInst.html">llvm::LoadInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00136">Instructions.h:136</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_ac015f68d60ea67a2e31bc10bc720d3e8"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#ac015f68d60ea67a2e31bc10bc720d3e8">llvm::Intrinsic::getType</a></div><div class="ttdeci">FunctionType * getType(LLVMContext &amp;Context, ID id, ArrayRef&lt; Type * &gt; Tys=None)</div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00657">Function.cpp:657</a></div></div>
<div class="ttc" id="classllvm_1_1User_html"><div class="ttname"><a href="classllvm_1_1User.html">llvm::User</a></div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00033">User.h:33</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_a1d37f5425e608e65775ffe52c425a66c"><div class="ttname"><a href="classllvm_1_1CallInst.html#a1d37f5425e608e65775ffe52c425a66c">llvm::CallInst::CreateFree</a></div><div class="ttdeci">static Instruction * CreateFree(Value *Source, Instruction *InsertBefore)</div><div class="ttdoc">CreateFree - Generate the IR for a call to the builtin free function. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l00514">Instructions.cpp:514</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a5e9e1c0dd93557be1b4ad72860f3cbdaae68df805bc15b023748c2a78b80563ff"><div class="ttname"><a href="classllvm_1_1Type.html#a5e9e1c0dd93557be1b4ad72860f3cbdaae68df805bc15b023748c2a78b80563ff">llvm::Type::PointerTyID</a></div><div class="ttdoc">14: Pointers </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00072">Type.h:72</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalVariable_html_aa4d95acdd770e27036d21edb3cad65e1"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html#aa4d95acdd770e27036d21edb3cad65e1">llvm::GlobalVariable::getInitializer</a></div><div class="ttdeci">const Constant * getInitializer() const </div><div class="ttdef"><b>Definition:</b> <a href="GlobalVariable_8h_source.html#l00138">GlobalVariable.h:138</a></div></div>
<div class="ttc" id="classllvm_1_1AttributeSet_html_a54abbe67d4a53c92652f1666dc19281f"><div class="ttname"><a href="classllvm_1_1AttributeSet.html#a54abbe67d4a53c92652f1666dc19281f">llvm::AttributeSet::hasAttribute</a></div><div class="ttdeci">bool hasAttribute(unsigned Index, Attribute::AttrKind Kind) const </div><div class="ttdoc">Return true if the attribute exists at the given index. </div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8cpp_source.html#l00818">Attributes.cpp:818</a></div></div>
<div class="ttc" id="Statistic_8h_html"><div class="ttname"><a href="Statistic_8h.html">Statistic.h</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html_afff7dfa535b91b210da27046e98e165e"><div class="ttname"><a href="classllvm_1_1Module.html#afff7dfa535b91b210da27046e98e165e">llvm::Module::getAliasList</a></div><div class="ttdeci">const AliasListType &amp; getAliasList() const </div><div class="ttdoc">Get the Module&amp;#39;s list of aliases (constant). </div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00499">Module.h:499</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalAlias_html_a7b0b0296ad4af9b9847b4405c7885161"><div class="ttname"><a href="classllvm_1_1GlobalAlias.html#a7b0b0296ad4af9b9847b4405c7885161">llvm::GlobalAlias::getAliasee</a></div><div class="ttdeci">const Constant * getAliasee() const </div><div class="ttdef"><b>Definition:</b> <a href="GlobalAlias_8h_source.html#l00061">GlobalAlias.h:61</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_a9c029996bf40f01fdebc1dfdf1cec4df"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#a9c029996bf40f01fdebc1dfdf1cec4df">llvm::ConstantExpr::getOpcode</a></div><div class="ttdeci">unsigned getOpcode() const </div><div class="ttdoc">getOpcode - Return the opcode at the root of this constant expression </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l01057">Constants.h:1057</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a2eeb1c7ed1cfe403f2ae0470e36c07e2"><div class="ttname"><a href="classllvm_1_1User.html#a2eeb1c7ed1cfe403f2ae0470e36c07e2">llvm::User::op_begin</a></div><div class="ttdeci">op_iterator op_begin()</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00116">User.h:116</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html_a17ebd56685ee19e7761ae577cd511e25"><div class="ttname"><a href="classllvm_1_1Module.html#a17ebd56685ee19e7761ae577cd511e25">llvm::Module::getGlobalVariable</a></div><div class="ttdeci">const GlobalVariable * getGlobalVariable(StringRef Name, bool AllowInternal=false) const </div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00355">Module.h:355</a></div></div>
<div class="ttc" id="classllvm_1_1CallSiteBase_html_a65a550af73bd99c96abea847916aa4e9"><div class="ttname"><a href="classllvm_1_1CallSiteBase.html#a65a550af73bd99c96abea847916aa4e9">llvm::CallSiteBase::getArgument</a></div><div class="ttdeci">ValTy * getArgument(unsigned ArgNo) const </div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00111">CallSite.h:111</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_af4d5ada526cdf057f5f29047e058187d"><div class="ttname"><a href="classllvm_1_1Function.html#af4d5ada526cdf057f5f29047e058187d">llvm::Function::getCallingConv</a></div><div class="ttdeci">CallingConv::ID getCallingConv() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00161">Function.h:161</a></div></div>
<div class="ttc" id="structllvm_1_1GlobalStatus_html_abe8cd5e07daf1b2bf532174823523ee7adcbfa969dc654b5812a05827152a42c5"><div class="ttname"><a href="structllvm_1_1GlobalStatus.html#abe8cd5e07daf1b2bf532174823523ee7adcbfa969dc654b5812a05827152a42c5">llvm::GlobalStatus::InitializerStored</a></div><div class="ttdef"><b>Definition:</b> <a href="GlobalStatus_8h_source.html#l00043">GlobalStatus.h:43</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_ad9ef9dbac3fbf9cc30e63d86bf9d7e34"><div class="ttname"><a href="GlobalOpt_8cpp.html#ad9ef9dbac3fbf9cc30e63d86bf9d7e34">compareNames</a></div><div class="ttdeci">static int compareNames(Constant *const *A, Constant *const *B)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l02848">GlobalOpt.cpp:2848</a></div></div>
<div class="ttc" id="CallSite_8h_html"><div class="ttname"><a href="CallSite_8h.html">CallSite.h</a></div></div>
<div class="ttc" id="classllvm_1_1generic__gep__type__iterator_html"><div class="ttname"><a href="classllvm_1_1generic__gep__type__iterator.html">llvm::generic_gep_type_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="GetElementPtrTypeIterator_8h_source.html#l00023">GetElementPtrTypeIterator.h:23</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html_aa6574d526b3e38a28f688a7bb4325c2c"><div class="ttname"><a href="classllvm_1_1Constant.html#aa6574d526b3e38a28f688a7bb4325c2c">llvm::Constant::getNullValue</a></div><div class="ttdeci">static Constant * getNullValue(Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00111">Constants.cpp:111</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad452febc1ac0b394876e640ec03ffa38"><div class="ttname"><a href="classllvm_1_1Value.html#ad452febc1ac0b394876e640ec03ffa38">llvm::Value::getName</a></div><div class="ttdeci">StringRef getName() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00167">Value.cpp:167</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0ed5f3ab3c2e4196ee0cffffa080c062"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0ed5f3ab3c2e4196ee0cffffa080c062">llvm::BasicBlock::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00193">BasicBlock.h:193</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a36e21267fe14e69d3251eab1cd3a0076"><div class="ttname"><a href="classllvm_1_1Type.html#a36e21267fe14e69d3251eab1cd3a0076">llvm::Type::isSingleValueType</a></div><div class="ttdeci">bool isSingleValueType() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00259">Type.h:259</a></div></div>
<div class="ttc" id="classllvm_1_1StructType_html_a1a716e87e6d2a1de3fcfd0682ed3fd1f"><div class="ttname"><a href="classllvm_1_1StructType.html#a1a716e87e6d2a1de3fcfd0682ed3fd1f">llvm::StructType::element_end</a></div><div class="ttdeci">element_iterator element_end() const </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00279">DerivedTypes.h:279</a></div></div>
<div class="ttc" id="classllvm_1_1BlockAddress_html"><div class="ttname"><a href="classllvm_1_1BlockAddress.html">llvm::BlockAddress</a></div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00748">Constants.h:748</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html_ae5c60fd282ee894c87ea02c3f0fcb6d0"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html#ae5c60fd282ee894c87ea02c3f0fcb6d0">llvm::AnalysisUsage::addRequired</a></div><div class="ttdeci">AnalysisUsage &amp; addRequired()</div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00055">PassAnalysisSupport.h:55</a></div></div>
<div class="ttc" id="classllvm_1_1StructLayout_html"><div class="ttname"><a href="classllvm_1_1StructLayout.html">llvm::StructLayout</a></div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00418">DataLayout.h:418</a></div></div>
<div class="ttc" id="PassSupport_8h_html_a14724f1ccf528e73bb29bc9230737967"><div class="ttname"><a href="PassSupport_8h.html#a14724f1ccf528e73bb29bc9230737967">INITIALIZE_PASS_DEPENDENCY</a></div><div class="ttdeci">#define INITIALIZE_PASS_DEPENDENCY(depName)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00167">PassSupport.h:167</a></div></div>
<div class="ttc" id="classllvm_1_1AttributeSet_html_a206bb7d4b3f7e63b4cc0e83b8c120b80"><div class="ttname"><a href="classllvm_1_1AttributeSet.html#a206bb7d4b3f7e63b4cc0e83b8c120b80">llvm::AttributeSet::removeAttribute</a></div><div class="ttdeci">AttributeSet removeAttribute(LLVMContext &amp;C, unsigned Index, Attribute::AttrKind Attr) const </div><div class="ttdoc">Remove the specified attribute at the specified index from this attribute list. Since attribute lists...</div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8cpp_source.html#l00733">Attributes.cpp:733</a></div></div>
<div class="ttc" id="classllvm_1_1AttributeSet_html"><div class="ttname"><a href="classllvm_1_1AttributeSet.html">llvm::AttributeSet</a></div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8h_source.html#l00202">Attributes.h:202</a></div></div>
<div class="ttc" id="classllvm_1_1value__use__iterator_html"><div class="ttname"><a href="classllvm_1_1value__use__iterator.html">llvm::value_use_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00168">Use.h:168</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_ac72641748365fe07282530999fea5230"><div class="ttname"><a href="GlobalOpt_8cpp.html#ac72641748365fe07282530999fea5230">ConstantPropUsersOf</a></div><div class="ttdeci">static void ConstantPropUsersOf(Value *V, DataLayout *TD, TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00808">GlobalOpt.cpp:808</a></div></div>
<div class="ttc" id="classllvm_1_1SelectInst_html"><div class="ttname"><a href="classllvm_1_1SelectInst.html">llvm::SelectInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01430">Instructions.h:1430</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a6534eab7f2125fdeff4232f790c07e05"><div class="ttname"><a href="GlobalOpt_8cpp.html#a6534eab7f2125fdeff4232f790c07e05">AllUsesOfLoadedValueWillTrapIfNull</a></div><div class="ttdeci">static bool AllUsesOfLoadedValueWillTrapIfNull(const GlobalVariable *GV)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00657">GlobalOpt.cpp:657</a></div></div>
<div class="ttc" id="classllvm_1_1Twine_html"><div class="ttname"><a href="classllvm_1_1Twine.html">llvm::Twine</a></div><div class="ttdef"><b>Definition:</b> <a href="Twine_8h_source.html#l00081">Twine.h:81</a></div></div>
<div class="ttc" id="classllvm_1_1StructType_html_a93ee26a67ca79e4ba796dcccb55e8c19"><div class="ttname"><a href="classllvm_1_1StructType.html#a93ee26a67ca79e4ba796dcccb55e8c19">llvm::StructType::element_iterator</a></div><div class="ttdeci">Type::subtype_iterator element_iterator</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00277">DerivedTypes.h:277</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_a35c840104f32575e0d91422cf1ef3ce4"><div class="ttname"><a href="classllvm_1_1DataLayout.html#a35c840104f32575e0d91422cf1ef3ce4">llvm::DataLayout::getStructLayout</a></div><div class="ttdeci">const StructLayout * getStructLayout(StructType *Ty) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8cpp_source.html#l00445">DataLayout.cpp:445</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_afd44535c4ae204571d5721fa4a7042f2"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#afd44535c4ae204571d5721fa4a7042f2">llvm::ConstantExpr::get</a></div><div class="ttdeci">static Constant * get(unsigned Opcode, Constant *C1, Constant *C2, unsigned Flags=0)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01690">Constants.cpp:1690</a></div></div>
<div class="ttc" id="classllvm_1_1CastInst_html"><div class="ttname"><a href="classllvm_1_1CastInst.html">llvm::CastInst</a></div><div class="ttdoc">Base class of casting instructions. </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00387">InstrTypes.h:387</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_af8dde13a97efce293a7b04daf1e208fb"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#af8dde13a97efce293a7b04daf1e208fb">llvm::ConstantInt::getValue</a></div><div class="ttdeci">const APInt &amp; getValue() const </div><div class="ttdoc">Return the constant&amp;#39;s value. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00105">Constants.h:105</a></div></div>
<div class="ttc" id="classllvm_1_1LoadInst_html_af5ed72f95abe438ddf3dff1c76c9ea42"><div class="ttname"><a href="classllvm_1_1LoadInst.html#af5ed72f95abe438ddf3dff1c76c9ea42">llvm::LoadInst::isUnordered</a></div><div class="ttdeci">bool isUnordered() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00219">Instructions.h:219</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalVariable_html_a095f8f031d99ce3c0b25478713293dea"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html#a095f8f031d99ce3c0b25478713293dea">llvm::GlobalVariable::setInitializer</a></div><div class="ttdeci">void setInitializer(Constant *InitVal)</div><div class="ttdef"><b>Definition:</b> <a href="Globals_8cpp_source.html#l00166">Globals.cpp:166</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05ac17897ebf2f6a6986280fc3bdf28a30a"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05ac17897ebf2f6a6986280fc3bdf28a30a">llvm::CmpInst::ICMP_NE</a></div><div class="ttdoc">not equal </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00673">InstrTypes.h:673</a></div></div>
<div class="ttc" id="classllvm_1_1TargetLibraryInfo_html_a986085d3cd43522192d93e84bc660978"><div class="ttname"><a href="classllvm_1_1TargetLibraryInfo.html#a986085d3cd43522192d93e84bc660978">llvm::TargetLibraryInfo::has</a></div><div class="ttdeci">bool has(LibFunc::Func F) const </div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8h_source.html#l00688">TargetLibraryInfo.h:688</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_a400eaca9881c8dcab97e9f42b1ab1815"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#a400eaca9881c8dcab97e9f42b1ab1815">llvm::SmallVectorImpl::pop_back_val</a></div><div class="ttdeci">T LLVM_ATTRIBUTE_UNUSED_RESULT pop_back_val()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00430">SmallVector.h:430</a></div></div>
<div class="ttc" id="classllvm_1_1StructType_html"><div class="ttname"><a href="classllvm_1_1StructType.html">llvm::StructType</a></div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00187">DerivedTypes.h:187</a></div></div>
<div class="ttc" id="ErrorHandling_8h_html_ace243f5c25697a1107cce46626b3dc94"><div class="ttname"><a href="ErrorHandling_8h.html#ace243f5c25697a1107cce46626b3dc94">llvm_unreachable</a></div><div class="ttdeci">#define llvm_unreachable(msg)</div><div class="ttdef"><b>Definition:</b> <a href="ErrorHandling_8h_source.html#l00103">ErrorHandling.h:103</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_acae189c1d913af7e7f37a8b202070997"><div class="ttname"><a href="classllvm_1_1Type.html#acae189c1d913af7e7f37a8b202070997">llvm::Type::getArrayElementType</a></div><div class="ttdeci">Type * getArrayElementType() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00368">Type.h:368</a></div></div>
<div class="ttc" id="classllvm_1_1Use_html"><div class="ttname"><a href="classllvm_1_1Use.html">llvm::Use</a></div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00060">Use.h:60</a></div></div>
<div class="ttc" id="namespacellvm_html_a0926b34ae91e5bbb097a69c71472cc8d"><div class="ttname"><a href="namespacellvm.html#a0926b34ae91e5bbb097a69c71472cc8d">llvm::initializeGlobalOptPass</a></div><div class="ttdeci">void initializeGlobalOptPass(PassRegistry &amp;)</div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a62584dc0c8f12c3b4fc85f84dbd08313"><div class="ttname"><a href="GlobalOpt_8cpp.html#a62584dc0c8f12c3b4fc85f84dbd08313">AllUsesOfValueWillTrapIfNull</a></div><div class="ttdeci">static bool AllUsesOfValueWillTrapIfNull(const Value *V, SmallPtrSet&lt; const PHINode *, 8 &gt; &amp;PHIs)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00611">GlobalOpt.cpp:611</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html">llvm::SmallVectorImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00035">APInt.h:35</a></div></div>
<div class="ttc" id="PassSupport_8h_html_a74ce8276b89067e806f67c45a6d92575"><div class="ttname"><a href="PassSupport_8h.html#a74ce8276b89067e806f67c45a6d92575">INITIALIZE_PASS_END</a></div><div class="ttdeci">#define INITIALIZE_PASS_END(passName, arg, name, cfg, analysis)</div><div class="ttdef"><b>Definition:</b> <a href="PassSupport_8h_source.html#l00172">PassSupport.h:172</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_ab781fe09dd22fc9dec38dd0d40036e38"><div class="ttname"><a href="classllvm_1_1Type.html#ab781fe09dd22fc9dec38dd0d40036e38">llvm::Type::canLosslesslyBitCastTo</a></div><div class="ttdeci">bool canLosslesslyBitCastTo(Type *Ty) const </div><div class="ttdoc">Determine if this type could be losslessly bitcast to Ty. </div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00065">Type.cpp:65</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantVector_html_ade9fa017ca3aa82f7694a47090547bc1"><div class="ttname"><a href="classllvm_1_1ConstantVector.html#ade9fa017ca3aa82f7694a47090547bc1">llvm::ConstantVector::get</a></div><div class="ttdeci">static Constant * get(ArrayRef&lt; Constant * &gt; V)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00923">Constants.cpp:923</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html_ae9cbc599309fd2da33ec1c61df01ce1f"><div class="ttname"><a href="classllvm_1_1BranchInst.html#ae9cbc599309fd2da33ec1c61df01ce1f">llvm::BranchInst::Create</a></div><div class="ttdeci">static BranchInst * Create(BasicBlock *IfTrue, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02373">Instructions.h:2373</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a77f379dd4a6b268b3f574dc53301a6e8"><div class="ttname"><a href="GlobalOpt_8cpp.html#a77f379dd4a6b268b3f574dc53301a6e8">OptimizeAwayTrappingUsesOfLoads</a></div><div class="ttdeci">static bool OptimizeAwayTrappingUsesOfLoads(GlobalVariable *GV, Constant *LV, DataLayout *TD, TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00744">GlobalOpt.cpp:744</a></div></div>
<div class="ttc" id="STLExtras_8h_html"><div class="ttname"><a href="STLExtras_8h.html">STLExtras.h</a></div></div>
<div class="ttc" id="structllvm_1_1GlobalStatus_html_abe8cd5e07daf1b2bf532174823523ee7"><div class="ttname"><a href="structllvm_1_1GlobalStatus.html#abe8cd5e07daf1b2bf532174823523ee7">llvm::GlobalStatus::StoredType</a></div><div class="ttdeci">StoredType</div><div class="ttdoc">Keep track of what stores to the global look like. </div><div class="ttdef"><b>Definition:</b> <a href="GlobalStatus_8h_source.html#l00037">GlobalStatus.h:37</a></div></div>
<div class="ttc" id="ErrorHandling_8h_html"><div class="ttname"><a href="ErrorHandling_8h.html">ErrorHandling.h</a></div></div>
<div class="ttc" id="classllvm_1_1StructType_html_a8d85840dbf6b7eff52721aafae9df0f6"><div class="ttname"><a href="classllvm_1_1StructType.html#a8d85840dbf6b7eff52721aafae9df0f6">llvm::StructType::element_begin</a></div><div class="ttdeci">element_iterator element_begin() const </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00278">DerivedTypes.h:278</a></div></div>
<div class="ttc" id="namespacefalse_html"><div class="ttname"><a href="namespacefalse.html">false</a></div><div class="ttdef"><b>Definition:</b> <a href="StackSlotColoring_8cpp_source.html#l00126">StackSlotColoring.cpp:126</a></div></div>
<div class="ttc" id="structllvm_1_1GlobalStatus_html_a255b1838fd534fde4ec9f1779320613b"><div class="ttname"><a href="structllvm_1_1GlobalStatus.html#a255b1838fd534fde4ec9f1779320613b">llvm::GlobalStatus::HasNonInstructionUser</a></div><div class="ttdeci">bool HasNonInstructionUser</div><div class="ttdef"><b>Definition:</b> <a href="GlobalStatus_8h_source.html#l00068">GlobalStatus.h:68</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalVariable_html_aaf76909687fcdf2acb3cddab7db498f8"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html#aaf76909687fcdf2acb3cddab7db498f8">llvm::GlobalVariable::hasUniqueInitializer</a></div><div class="ttdeci">bool hasUniqueInitializer() const </div><div class="ttdef"><b>Definition:</b> <a href="GlobalVariable_8h_source.html#l00119">GlobalVariable.h:119</a></div></div>
<div class="ttc" id="namespacellvm_1_1CallingConv_html_a4f861731fc6dbfdccc05af5968d98974"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974">llvm::CallingConv::ID</a></div><div class="ttdeci">ID</div><div class="ttdoc">LLVM Calling Convention Representation. </div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00026">CallingConv.h:26</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a6ef58549c87cd57b83dcd7ce2d92cc03"><div class="ttname"><a href="GlobalOpt_8cpp.html#a6ef58549c87cd57b83dcd7ce2d92cc03">mayHaveOtherReferences</a></div><div class="ttdeci">static bool mayHaveOtherReferences(GlobalAlias &amp;GA, const LLVMUsed &amp;U)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l02944">GlobalOpt.cpp:2944</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html"><div class="ttname"><a href="classllvm_1_1Instruction.html">llvm::Instruction</a></div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00031">Instruction.h:31</a></div></div>
<div class="ttc" id="TargetLibraryInfo_8h_html"><div class="ttname"><a href="TargetLibraryInfo_8h.html">TargetLibraryInfo.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1LibFunc_html_abf8f6830387f338fed0bce2e65108c6fa75da4c0488acc8319e47f53d82822837"><div class="ttname"><a href="namespacellvm_1_1LibFunc.html#abf8f6830387f338fed0bce2e65108c6fa75da4c0488acc8319e47f53d82822837">llvm::LibFunc::cxa_atexit</a></div><div class="ttdoc">int __cxa_atexit(void (*f)(void *), void *p, void *d); </div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8h_source.html#l00054">TargetLibraryInfo.h:54</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a77de6d50432bef62e38fd24f2030026c"><div class="ttname"><a href="GlobalOpt_8cpp.html#a77de6d50432bef62e38fd24f2030026c">TryToShrinkGlobalToBoolean</a></div><div class="ttdeci">static bool TryToShrinkGlobalToBoolean(GlobalVariable *GV, Constant *OtherVal)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l01604">GlobalOpt.cpp:1604</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_afa93649aba5a7b6388adff903a4a6085"><div class="ttname"><a href="GlobalOpt_8cpp.html#afa93649aba5a7b6388adff903a4a6085">hasUseOtherThanLLVMUsed</a></div><div class="ttdeci">static bool hasUseOtherThanLLVMUsed(GlobalAlias &amp;GA, const LLVMUsed &amp;U)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l02917">GlobalOpt.cpp:2917</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_a2d8e04fc14cc2b3c6005d3baa8562639"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a2d8e04fc14cc2b3c6005d3baa8562639">llvm::GlobalValue::hasPrivateLinkage</a></div><div class="ttdeci">bool hasPrivateLinkage() const </div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00206">GlobalValue.h:206</a></div></div>
<div class="ttc" id="classllvm_1_1LoadInst_html_a4df7359cb36b166c0878e16291cbe183"><div class="ttname"><a href="classllvm_1_1LoadInst.html#a4df7359cb36b166c0878e16291cbe183">llvm::LoadInst::getSynchScope</a></div><div class="ttdeci">SynchronizationScope getSynchScope() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00199">Instructions.h:199</a></div></div>
<div class="ttc" id="namespacellvm_html_abf74b2f0dbae96f4708d3e407b36df02"><div class="ttname"><a href="namespacellvm.html#abf74b2f0dbae96f4708d3e407b36df02">llvm::AtomicOrdering</a></div><div class="ttdeci">AtomicOrdering</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00036">Instructions.h:36</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a6edd823ba5e4e1effc8280ca8a1194ef"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a6edd823ba5e4e1effc8280ca8a1194ef">llvm::ConstantInt::getZExtValue</a></div><div class="ttdeci">uint64_t getZExtValue() const </div><div class="ttdoc">Return the zero extended value. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00116">Constants.h:116</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html_a0567b31cf5caa26522fcc2e7cadc1dde"><div class="ttname"><a href="classllvm_1_1Module.html#a0567b31cf5caa26522fcc2e7cadc1dde">llvm::Module::global_begin</a></div><div class="ttdeci">global_iterator global_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00521">Module.h:521</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionType_html"><div class="ttname"><a href="classllvm_1_1FunctionType.html">llvm::FunctionType</a></div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00096">DerivedTypes.h:96</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html">llvm::ConstantExpr</a></div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00790">Constants.h:790</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_af348d5ea83429d08ba891ca3dd0e92b2"><div class="ttname"><a href="classllvm_1_1Type.html#af348d5ea83429d08ba891ca3dd0e92b2">llvm::Type::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdoc">getContext - Return the LLVMContext in which this type was uniqued. </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00128">Type.h:128</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a2ced6343b8ad006a757059554bbf9f37"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a2ced6343b8ad006a757059554bbf9f37">llvm::SmallPtrSet::count</a></div><div class="ttdeci">bool count(PtrType Ptr) const </div><div class="ttdoc">count - Return true if the specified pointer is in the set. </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00264">SmallPtrSet.h:264</a></div></div>
<div class="ttc" id="Operator_8h_html"><div class="ttname"><a href="Operator_8h.html">Operator.h</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorBase_html_a8a8df4d85555c7954a95f86080cd3b64"><div class="ttname"><a href="classllvm_1_1SmallVectorBase.html#a8a8df4d85555c7954a95f86080cd3b64">llvm::SmallVectorBase::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00056">SmallVector.h:56</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_abe4ad4318c31fcbade247fb28b4bf06d"><div class="ttname"><a href="GlobalOpt_8cpp.html#abe4ad4318c31fcbade247fb28b4bf06d">PerformHeapAllocSRoA</a></div><div class="ttdeci">static GlobalVariable * PerformHeapAllocSRoA(GlobalVariable *GV, CallInst *CI, Value *NElems, DataLayout *TD, const TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l01279">GlobalOpt.cpp:1279</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a7b97d3981d965c0884878bca5be437ff"><div class="ttname"><a href="GlobalOpt_8cpp.html#a7b97d3981d965c0884878bca5be437ff">ChangeCalleesToFastCall</a></div><div class="ttdeci">static void ChangeCalleesToFastCall(Function *F)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l01868">GlobalOpt.cpp:1868</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_ad38e073a20e77512a43dcdc9d2dea742"><div class="ttname"><a href="GlobalOpt_8cpp.html#ad38e073a20e77512a43dcdc9d2dea742">FindCXAAtExit</a></div><div class="ttdeci">static Function * FindCXAAtExit(Module &amp;M, TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l03039">GlobalOpt.cpp:3039</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a3b41afcb0ed58c8ecb4b49fc1554c583"><div class="ttname"><a href="GlobalOpt_8cpp.html#a3b41afcb0ed58c8ecb4b49fc1554c583">RewriteHeapSROALoadUser</a></div><div class="ttdeci">static void RewriteHeapSROALoadUser(Instruction *LoadUser, DenseMap&lt; Value *, std::vector&lt; Value * &gt; &gt; &amp;InsertedScalarizedValues, std::vector&lt; std::pair&lt; PHINode *, unsigned &gt; &gt; &amp;PHIsToRewrite)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l01198">GlobalOpt.cpp:1198</a></div></div>
<div class="ttc" id="namespacellvm_html_a8891be7c27326c20a6dba7d98e9030b5"><div class="ttname"><a href="namespacellvm.html#a8891be7c27326c20a6dba7d98e9030b5">llvm::ConstantFoldConstantExpression</a></div><div class="ttdeci">Constant * ConstantFoldConstantExpression(const ConstantExpr *CE, const DataLayout *TD=0, const TargetLibraryInfo *TLI=0)</div><div class="ttdef"><b>Definition:</b> <a href="ConstantFolding_8cpp_source.html#l00937">ConstantFolding.cpp:937</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayType_html"><div class="ttname"><a href="classllvm_1_1ArrayType.html">llvm::ArrayType</a></div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00332">DerivedTypes.h:332</a></div></div>
<div class="ttc" id="SmallPtrSet_8h_html"><div class="ttname"><a href="SmallPtrSet_8h.html">SmallPtrSet.h</a></div></div>
<div class="ttc" id="classllvm_1_1BitCastInst_html"><div class="ttname"><a href="classllvm_1_1BitCastInst.html">llvm::BitCastInst</a></div><div class="ttdoc">This class represents a no-op cast from one type to another. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l03587">Instructions.h:3587</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionType_html_a7e89b55242c964ae61b7850e99cacef0"><div class="ttname"><a href="classllvm_1_1FunctionType.html#a7e89b55242c964ae61b7850e99cacef0">llvm::FunctionType::get</a></div><div class="ttdeci">static FunctionType * get(Type *Result, ArrayRef&lt; Type * &gt; Params, bool isVarArg)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00361">Type.cpp:361</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a8e08dfcb75ff1b4b38c352bc0d9db223"><div class="ttname"><a href="classllvm_1_1Type.html#a8e08dfcb75ff1b4b38c352bc0d9db223">llvm::Type::getTypeID</a></div><div class="ttdeci">TypeID getTypeID() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00137">Type.h:137</a></div></div>
<div class="ttc" id="namespacellvm_html_afaf85770fdd46c58822741178d7fd03d"><div class="ttname"><a href="namespacellvm.html#afaf85770fdd46c58822741178d7fd03d">llvm::ConstantFoldInstruction</a></div><div class="ttdeci">Constant * ConstantFoldInstruction(Instruction *I, const DataLayout *TD=0, const TargetLibraryInfo *TLI=0)</div><div class="ttdef"><b>Definition:</b> <a href="ConstantFolding_8cpp_source.html#l00839">ConstantFolding.cpp:839</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a40113570b0c52a18c34cabed8359e2c8"><div class="ttname"><a href="classllvm_1_1Type.html#a40113570b0c52a18c34cabed8359e2c8">llvm::Type::isFloatingPointTy</a></div><div class="ttdeci">bool isFloatingPointTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00162">Type.h:162</a></div></div>
<div class="ttc" id="classllvm_1_1StoreInst_html"><div class="ttname"><a href="classllvm_1_1StoreInst.html">llvm::StoreInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00255">Instructions.h:255</a></div></div>
<div class="ttc" id="classllvm_1_1CallSiteBase_html_a1abce20a9eff3d23ce05331962b1997c"><div class="ttname"><a href="classllvm_1_1CallSiteBase.html#a1abce20a9eff3d23ce05331962b1997c">llvm::CallSiteBase::getCalledValue</a></div><div class="ttdeci">ValTy * getCalledValue() const </div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00085">CallSite.h:85</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalVariable_html_abe4224c23f4544a70464c53056f00396"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html#abe4224c23f4544a70464c53056f00396">llvm::GlobalVariable::hasDefinitiveInitializer</a></div><div class="ttdeci">bool hasDefinitiveInitializer() const </div><div class="ttdef"><b>Definition:</b> <a href="GlobalVariable_8h_source.html#l00107">GlobalVariable.h:107</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a3ab5fc45117b450e8bb04e564cb6e5f2"><div class="ttname"><a href="classllvm_1_1Value.html#a3ab5fc45117b450e8bb04e564cb6e5f2">llvm::Value::replaceAllUsesWith</a></div><div class="ttdeci">void replaceAllUsesWith(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00303">Value.cpp:303</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a9aae7c60b468bcf6db982dc76e6c703a"><div class="ttname"><a href="classllvm_1_1Type.html#a9aae7c60b468bcf6db982dc76e6c703a">llvm::Type::isArrayTy</a></div><div class="ttdeci">bool isArrayTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00216">Type.h:216</a></div></div>
<div class="ttc" id="AliasAnalysisEvaluator_8cpp_html_ad8b296a21110ccf9f34e73e4507dda2e"><div class="ttname"><a href="AliasAnalysisEvaluator_8cpp.html#ad8b296a21110ccf9f34e73e4507dda2e">Evaluator</a></div><div class="ttdeci">aa Exhaustive Alias Analysis Precision Evaluator</div><div class="ttdef"><b>Definition:</b> <a href="AliasAnalysisEvaluator_8cpp_source.html#l00086">AliasAnalysisEvaluator.cpp:86</a></div></div>
<div class="ttc" id="MathExtras_8h_html"><div class="ttname"><a href="MathExtras_8h.html">MathExtras.h</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ae855357b6c5e6e7ed1869272708a3a84"><div class="ttname"><a href="classllvm_1_1Value.html#ae855357b6c5e6e7ed1869272708a3a84">llvm::Value::takeName</a></div><div class="ttdeci">void takeName(Value *V)</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00239">Value.cpp:239</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a88a5e60837674780a9d812d661897ac5"><div class="ttname"><a href="classllvm_1_1Function.html#a88a5e60837674780a9d812d661897ac5">llvm::Function::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00395">Function.h:395</a></div></div>
<div class="ttc" id="classllvm_1_1SequentialType_html_a39f2c3a62f293faf11ac28b15bc53359"><div class="ttname"><a href="classllvm_1_1SequentialType.html#a39f2c3a62f293faf11ac28b15bc53359">llvm::SequentialType::getElementType</a></div><div class="ttdeci">Type * getElementType() const </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00319">DerivedTypes.h:319</a></div></div>
<div class="ttc" id="namespaceCU_html"><div class="ttname"><a href="namespaceCU.html">CU</a></div><div class="ttdef"><b>Definition:</b> <a href="X86AsmBackend_8cpp_source.html#l00394">X86AsmBackend.cpp:394</a></div></div>
<div class="ttc" id="classllvm_1_1PointerType_html"><div class="ttname"><a href="classllvm_1_1PointerType.html">llvm::PointerType</a></div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00425">DerivedTypes.h:425</a></div></div>
<div class="ttc" id="structllvm_1_1GlobalStatus_html_abe8cd5e07daf1b2bf532174823523ee7aecd55f74522361f4b8056f8b6b745699"><div class="ttname"><a href="structllvm_1_1GlobalStatus.html#abe8cd5e07daf1b2bf532174823523ee7aecd55f74522361f4b8056f8b6b745699">llvm::GlobalStatus::StoredOnce</a></div><div class="ttdef"><b>Definition:</b> <a href="GlobalStatus_8h_source.html#l00049">GlobalStatus.h:49</a></div></div>
<div class="ttc" id="Transforms_2IPO_8h_html"><div class="ttname"><a href="Transforms_2IPO_8h.html">IPO.h</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_aa45f6c0433576e3858a6209a43750ad4"><div class="ttname"><a href="classllvm_1_1PHINode.html#aa45f6c0433576e3858a6209a43750ad4">llvm::PHINode::getNumIncomingValues</a></div><div class="ttdeci">unsigned getNumIncomingValues() const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02055">Instructions.h:2055</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_aafc2232f97cd2d2fae9b4f5bda77a363"><div class="ttname"><a href="classllvm_1_1Function.html#aafc2232f97cd2d2fae9b4f5bda77a363">llvm::Function::hasAddressTaken</a></div><div class="ttdeci">bool hasAddressTaken(const User **=0) const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00698">Function.cpp:698</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a1f0b9358936e3e00c42a460abbfb2868"><div class="ttname"><a href="classllvm_1_1User.html#a1f0b9358936e3e00c42a460abbfb2868">llvm::User::replaceUsesOfWith</a></div><div class="ttdeci">void replaceUsesOfWith(Value *From, Value *To)</div><div class="ttdef"><b>Definition:</b> <a href="User_8cpp_source.html#l00026">User.cpp:26</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_ac63ac1be5217b4826ec97233f6bd8710"><div class="ttname"><a href="GlobalOpt_8cpp.html#ac63ac1be5217b4826ec97233f6bd8710">isSimpleEnoughValueToCommitHelper</a></div><div class="ttdeci">static bool isSimpleEnoughValueToCommitHelper(Constant *C, SmallPtrSet&lt; Constant *, 8 &gt; &amp;SimpleConstants, const DataLayout *TD)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l02083">GlobalOpt.cpp:2083</a></div></div>
<div class="ttc" id="namespacellvm_1_1X86II_html_a97dc14052814702ba0e2b14fb14dd02dacdc4d0fa74813b50797e25bab4febe70"><div class="ttname"><a href="namespacellvm_1_1X86II.html#a97dc14052814702ba0e2b14fb14dd02dacdc4d0fa74813b50797e25bab4febe70">llvm::X86II::GS</a></div><div class="ttdef"><b>Definition:</b> <a href="X86BaseInfo_8h_source.html#l00427">X86BaseInfo.h:427</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html_a3f156c68d0efa530f05698ca15d66593"><div class="ttname"><a href="classllvm_1_1Module.html#a3f156c68d0efa530f05698ca15d66593">llvm::Module::getFunction</a></div><div class="ttdeci">Function * getFunction(StringRef Name) const </div><div class="ttdef"><b>Definition:</b> <a href="Module_8cpp_source.html#l00221">Module.cpp:221</a></div></div>
<div class="ttc" id="namespacellvm_html_abaa7bb099e75b4a5dba358a498783f83"><div class="ttname"><a href="namespacellvm.html#abaa7bb099e75b4a5dba358a498783f83">llvm::ConstantFoldCall</a></div><div class="ttdeci">Constant * ConstantFoldCall(Function *F, ArrayRef&lt; Constant * &gt; Operands, const TargetLibraryInfo *TLI=0)</div><div class="ttdef"><b>Definition:</b> <a href="ConstantFolding_8cpp_source.html#l01321">ConstantFolding.cpp:1321</a></div></div>
<div class="ttc" id="classllvm_1_1StructLayout_html_ae10c4483372a357a0d3411b3d64be10c"><div class="ttname"><a href="classllvm_1_1StructLayout.html#ae10c4483372a357a0d3411b3d64be10c">llvm::StructLayout::getElementOffset</a></div><div class="ttdeci">uint64_t getElementOffset(unsigned Idx) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00442">DataLayout.h:442</a></div></div>
<div class="ttc" id="classllvm_1_1GetElementPtrInst_html"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html">llvm::GetElementPtrInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00709">Instructions.h:709</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64DB_html_a6fce8157775f3ec93f326b52b0f1e0f5a4916e736d6b7cc68359b39d5eb50f6db"><div class="ttname"><a href="namespacellvm_1_1A64DB.html#a6fce8157775f3ec93f326b52b0f1e0f5a4916e736d6b7cc68359b39d5eb50f6db">llvm::A64DB::ST</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00178">AArch64BaseInfo.h:178</a></div></div>
<div class="ttc" id="README__ALTIVEC_8txt_html_a9aacd9146afe44bf656cd664e2a88c8c"><div class="ttname"><a href="README__ALTIVEC_8txt.html#a9aacd9146afe44bf656cd664e2a88c8c">C</a></div><div class="ttdeci">(vector float) vec_cmpeq(*A,*B) C</div><div class="ttdef"><b>Definition:</b> <a href="README__ALTIVEC_8txt_source.html#l00091">README_ALTIVEC.txt:91</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_ae6db8746934e6feae3649a8709fce3cc"><div class="ttname"><a href="classllvm_1_1Function.html#ae6db8746934e6feae3649a8709fce3cc">llvm::Function::setCallingConv</a></div><div class="ttdeci">void setCallingConv(CallingConv::ID CC)</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00164">Function.h:164</a></div></div>
<div class="ttc" id="classllvm_1_1AttributeSet_html_a048066a2eb851073ae71cf3dc7a2bfe7"><div class="ttname"><a href="classllvm_1_1AttributeSet.html#a048066a2eb851073ae71cf3dc7a2bfe7">llvm::AttributeSet::getNumSlots</a></div><div class="ttdeci">unsigned getNumSlots() const </div><div class="ttdoc">Return the number of slots used in this attribute list. This is the number of arguments that have an ...</div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8cpp_source.html#l00906">Attributes.cpp:906</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionType_html_a176b84b12bc19326444728c6404dd068"><div class="ttname"><a href="classllvm_1_1FunctionType.html#a176b84b12bc19326444728c6404dd068">llvm::FunctionType::getParamType</a></div><div class="ttdeci">Type * getParamType(unsigned i) const </div><div class="ttdoc">Parameter type accessors. </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00128">DerivedTypes.h:128</a></div></div>
<div class="ttc" id="namespacellvm_html_add1eb5637dd671428b6f138ed3db6428"><div class="ttname"><a href="namespacellvm.html#add1eb5637dd671428b6f138ed3db6428">llvm::array_pod_sort</a></div><div class="ttdeci">void array_pod_sort(IteratorTy Start, IteratorTy End)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00289">STLExtras.h:289</a></div></div>
<div class="ttc" id="namespacellvm_1_1AArch64ISD_html_a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e"><div class="ttname"><a href="namespacellvm_1_1AArch64ISD.html#a246d89cb58f606179b1435937830bbdca84e96c468affe3b1fd3076b4fc5d063e">llvm::AArch64ISD::Ret</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64ISelLowering_8h_source.html#l00060">AArch64ISelLowering.h:60</a></div></div>
<div class="ttc" id="structllvm_1_1GlobalStatus_html"><div class="ttname"><a href="structllvm_1_1GlobalStatus.html">llvm::GlobalStatus</a></div><div class="ttdef"><b>Definition:</b> <a href="GlobalStatus_8h_source.html#l00028">GlobalStatus.h:28</a></div></div>
<div class="ttc" id="LLParser_8cpp_html_aae58e3df0180401e8f3ab75c18fbc07a"><div class="ttname"><a href="LLParser_8cpp.html#aae58e3df0180401e8f3ab75c18fbc07a">if</a></div><div class="ttdeci">* if(!EatIfPresent(lltok::kw_thread_local)) return false</div></div>
<div class="ttc" id="classllvm_1_1Module_html_a6d03597beb9097fc781a6c723cff50d6"><div class="ttname"><a href="classllvm_1_1Module.html#a6d03597beb9097fc781a6c723cff50d6">llvm::Module::alias_end</a></div><div class="ttdeci">alias_iterator alias_end()</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00544">Module.h:544</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ac33c7ecbf1c0f1e8bf93403522e6976b"><div class="ttname"><a href="classllvm_1_1Value.html#ac33c7ecbf1c0f1e8bf93403522e6976b">llvm::Value::use_iterator</a></div><div class="ttdeci">value_use_iterator&lt; User &gt; use_iterator</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00146">Value.h:146</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorImpl_html_aac0ea55010b7b1a301e65a0baea057aa"><div class="ttname"><a href="classllvm_1_1SmallVectorImpl.html#aac0ea55010b7b1a301e65a0baea057aa">llvm::SmallVectorImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00396">SmallVector.h:396</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html"><div class="ttname"><a href="classllvm_1_1BasicBlock.html">llvm::BasicBlock</a></div><div class="ttdoc">LLVM Basic Block Representation. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00072">BasicBlock.h:72</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a549419dff8d79e0f9e6f6e76770ef251"><div class="ttname"><a href="GlobalOpt_8cpp.html#a549419dff8d79e0f9e6f6e76770ef251">globalopt</a></div><div class="ttdeci">globalopt</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00096">GlobalOpt.cpp:96</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html"><div class="ttname"><a href="classllvm_1_1Type.html">llvm::Type</a></div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00044">Type.h:44</a></div></div>
<div class="ttc" id="classllvm_1_1CallSiteBase_html_ae4c67f835911559821939fb23a2e7aff"><div class="ttname"><a href="classllvm_1_1CallSiteBase.html#ae4c67f835911559821939fb23a2e7aff">llvm::CallSiteBase::getInstruction</a></div><div class="ttdeci">InstrTy * getInstruction() const </div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00079">CallSite.h:79</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_a211c14a84be4519439d616f9027d86c9"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a211c14a84be4519439d616f9027d86c9">llvm::GlobalValue::mayBeOverridden</a></div><div class="ttdeci">static bool mayBeOverridden(LinkageTypes Linkage)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00171">GlobalValue.h:171</a></div></div>
<div class="ttc" id="classllvm_1_1LLVMContext_html"><div class="ttname"><a href="classllvm_1_1LLVMContext.html">llvm::LLVMContext</a></div><div class="ttdef"><b>Definition:</b> <a href="LLVMContext_8h_source.html#l00037">LLVMContext.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1BranchInst_html"><div class="ttname"><a href="classllvm_1_1BranchInst.html">llvm::BranchInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02350">Instructions.h:2350</a></div></div>
<div class="ttc" id="classllvm_1_1AttributeSet_html_a43d638279385ef1f48cb3e4990482e4c"><div class="ttname"><a href="classllvm_1_1AttributeSet.html#a43d638279385ef1f48cb3e4990482e4c">llvm::AttributeSet::getSlotAttributes</a></div><div class="ttdeci">AttributeSet getSlotAttributes(unsigned Slot) const </div><div class="ttdoc">Return the attributes at the given slot. </div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8cpp_source.html#l00916">Attributes.cpp:916</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a6f725580f7834e2ca90762965866dad4"><div class="ttname"><a href="classllvm_1_1Type.html#a6f725580f7834e2ca90762965866dad4">llvm::Type::isVectorTy</a></div><div class="ttdeci">bool isVectorTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00229">Type.h:229</a></div></div>
<div class="ttc" id="classllvm_1_1StructType_html_a2f54639fcb5162f6f51192eb1697d2ad"><div class="ttname"><a href="classllvm_1_1StructType.html#a2f54639fcb5162f6f51192eb1697d2ad">llvm::StructType::getElementType</a></div><div class="ttdeci">Type * getElementType(unsigned N) const </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00287">DerivedTypes.h:287</a></div></div>
<div class="ttc" id="namespacellvm_html_a557c0bd50d6a6439ad6a9afcf8e340b5"><div class="ttname"><a href="namespacellvm.html#a557c0bd50d6a6439ad6a9afcf8e340b5">llvm::extractMallocCall</a></div><div class="ttdeci">const CallInst * extractMallocCall(const Value *I, const TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="MemoryBuiltins_8cpp_source.html#l00203">MemoryBuiltins.cpp:203</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html"><div class="ttname"><a href="classllvm_1_1Constant.html">llvm::Constant</a></div><div class="ttdoc">LLVM Constant Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Constant_8h_source.html#l00041">Constant.h:41</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a33f39e494317a93a9f9c798714c44029"><div class="ttname"><a href="GlobalOpt_8cpp.html#a33f39e494317a93a9f9c798714c44029">GetHeapSROAValue</a></div><div class="ttdeci">static Value * GetHeapSROAValue(Value *V, unsigned FieldNo, DenseMap&lt; Value *, std::vector&lt; Value * &gt; &gt; &amp;InsertedScalarizedValues, std::vector&lt; std::pair&lt; PHINode *, unsigned &gt; &gt; &amp;PHIsToRewrite)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l01156">GlobalOpt.cpp:1156</a></div></div>
<div class="ttc" id="Constants_8h_html"><div class="ttname"><a href="Constants_8h.html">Constants.h</a></div></div>
<div class="ttc" id="classllvm_1_1IndirectBrInst_html"><div class="ttname"><a href="classllvm_1_1IndirectBrInst.html">llvm::IndirectBrInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02743">Instructions.h:2743</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantArray_html_a0900dacdc7ad8e3ea0cc92993c7fd422"><div class="ttname"><a href="classllvm_1_1ConstantArray.html#a0900dacdc7ad8e3ea0cc92993c7fd422">llvm::ConstantArray::get</a></div><div class="ttdeci">static Constant * get(ArrayType *T, ArrayRef&lt; Constant * &gt; V)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00745">Constants.cpp:745</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a3622348f4394efe3dbe9b1e6366e7235"><div class="ttname"><a href="GlobalOpt_8cpp.html#a3622348f4394efe3dbe9b1e6366e7235">isSimpleEnoughPointerToCommit</a></div><div class="ttdeci">static bool isSimpleEnoughPointerToCommit(Constant *C)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l02153">GlobalOpt.cpp:2153</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalVariable_html_ae0cf03d5de37330b1eb69dd22a1d5057"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html#ae0cf03d5de37330b1eb69dd22a1d5057">llvm::GlobalVariable::eraseFromParent</a></div><div class="ttdeci">virtual void eraseFromParent()</div><div class="ttdef"><b>Definition:</b> <a href="Globals_8cpp_source.html#l00142">Globals.cpp:142</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_ae7d5794196f5b9b7477429aec29ad157"><div class="ttname"><a href="GlobalOpt_8cpp.html#ae7d5794196f5b9b7477429aec29ad157">RemoveNestAttribute</a></div><div class="ttdeci">static void RemoveNestAttribute(Function *F)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l01890">GlobalOpt.cpp:1890</a></div></div>
<div class="ttc" id="classllvm_1_1AnalysisUsage_html"><div class="ttname"><a href="classllvm_1_1AnalysisUsage.html">llvm::AnalysisUsage</a></div><div class="ttdef"><b>Definition:</b> <a href="PassAnalysisSupport_8h_source.html#l00037">PassAnalysisSupport.h:37</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_af41f58e730804d10b91fcff39b035f74"><div class="ttname"><a href="classllvm_1_1User.html#af41f58e730804d10b91fcff39b035f74">llvm::User::op_end</a></div><div class="ttdeci">op_iterator op_end()</div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00118">User.h:118</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_afb5e83bf5123ff7c51058eb0ebebcdc6"><div class="ttname"><a href="classllvm_1_1PHINode.html#afb5e83bf5123ff7c51058eb0ebebcdc6">llvm::PHINode::Create</a></div><div class="ttdeci">static PHINode * Create(Type *Ty, unsigned NumReservedValues, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02013">Instructions.h:2013</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a6e20e76960d952de088354cbcd14c3ab"><div class="ttname"><a href="classllvm_1_1Type.html#a6e20e76960d952de088354cbcd14c3ab">llvm::Type::getVoidTy</a></div><div class="ttdeci">static Type * getVoidTy(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00227">Type.cpp:227</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a4c25b6c00c4867281779c81ab64d2081"><div class="ttname"><a href="classllvm_1_1PHINode.html#a4c25b6c00c4867281779c81ab64d2081">llvm::PHINode::getIncomingBlock</a></div><div class="ttdeci">BasicBlock * getIncomingBlock(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02074">Instructions.h:2074</a></div></div>
<div class="ttc" id="namespacellvm_html_aa1704159f75e6eacd595962ea6d93ffe"><div class="ttname"><a href="namespacellvm.html#aa1704159f75e6eacd595962ea6d93ffe">llvm::next</a></div><div class="ttdeci">ItTy next(ItTy it, Dist n)</div><div class="ttdef"><b>Definition:</b> <a href="STLExtras_8h_source.html#l00154">STLExtras.h:154</a></div></div>
<div class="ttc" id="classllvm_1_1ICmpInst_html"><div class="ttname"><a href="classllvm_1_1ICmpInst.html">llvm::ICmpInst</a></div><div class="ttdoc">Represent an integer comparison operator. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00911">Instructions.h:911</a></div></div>
<div class="ttc" id="classllvm_1_1iplist_html_a35c71de7e8bbe3c0353d042beb58263f"><div class="ttname"><a href="classllvm_1_1iplist.html#a35c71de7e8bbe3c0353d042beb58263f">llvm::iplist::insert</a></div><div class="ttdeci">iterator insert(iterator where, NodeTy *New)</div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00412">ilist.h:412</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a4b4d2cfcbf78730693d389dd59f0c848"><div class="ttname"><a href="GlobalOpt_8cpp.html#a4b4d2cfcbf78730693d389dd59f0c848">EvaluateStaticConstructor</a></div><div class="ttdeci">static bool EvaluateStaticConstructor(Function *F, const DataLayout *TD, const TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l02782">GlobalOpt.cpp:2782</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_adcb86d621c23938671ad526d3bd1f9bd"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#adcb86d621c23938671ad526d3bd1f9bd">llvm::GlobalValue::isDiscardableIfUnused</a></div><div class="ttdeci">static bool isDiscardableIfUnused(LinkageTypes Linkage)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00164">GlobalValue.h:164</a></div></div>
<div class="ttc" id="classllvm_1_1Use_html_ac3564961c33fa9f636c6444db4c7fa85"><div class="ttname"><a href="classllvm_1_1Use.html#ac3564961c33fa9f636c6444db4c7fa85">llvm::Use::getUser</a></div><div class="ttdeci">User * getUser() const </div><div class="ttdef"><b>Definition:</b> <a href="Use_8cpp_source.html#l00137">Use.cpp:137</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a321e37d79af8b4287f8a1dcf9aff9c01"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a321e37d79af8b4287f8a1dcf9aff9c01">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, KeyInfoT &gt;, KeyT, ValueT, KeyInfoT &gt;::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00057">DenseMap.h:57</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a2ad94ee43b92bdf7558036edccd3fcaa"><div class="ttname"><a href="GlobalOpt_8cpp.html#a2ad94ee43b92bdf7558036edccd3fcaa">cxxDtorIsEmpty</a></div><div class="ttdeci">static bool cxxDtorIsEmpty(const Function &amp;Fn, SmallPtrSet&lt; const Function *, 8 &gt; &amp;CalledFunctions)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l03068">GlobalOpt.cpp:3068</a></div></div>
<div class="ttc" id="classllvm_1_1User_html_a997ff6a1758bf732b9b263fc61011644"><div class="ttname"><a href="classllvm_1_1User.html#a997ff6a1758bf732b9b263fc61011644">llvm::User::getOperand</a></div><div class="ttdeci">Value * getOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="User_8h_source.html#l00088">User.h:88</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a8bf193a781a92cae52d7f9216d0824f8"><div class="ttname"><a href="classllvm_1_1Function.html#a8bf193a781a92cae52d7f9216d0824f8">llvm::Function::arg_begin</a></div><div class="ttdeci">arg_iterator arg_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00410">Function.h:410</a></div></div>
<div class="ttc" id="classllvm_1_1IntegerType_html"><div class="ttname"><a href="classllvm_1_1IntegerType.html">llvm::IntegerType</a></div><div class="ttdoc">Integer representation type. </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00037">DerivedTypes.h:37</a></div></div>
<div class="ttc" id="namespacellvm_html_ab3bf4dcd8619f4349d7bc20ad1c0fccc"><div class="ttname"><a href="namespacellvm.html#ab3bf4dcd8619f4349d7bc20ad1c0fccc">llvm::createGlobalOptimizerPass</a></div><div class="ttdeci">ModulePass * createGlobalOptimizerPass()</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00099">GlobalOpt.cpp:99</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a8afd4995fae596b2c86eeed85b3d388b"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a8afd4995fae596b2c86eeed85b3d388b">llvm::CmpInst::getPredicate</a></div><div class="ttdeci">Predicate getPredicate() const </div><div class="ttdoc">Return the predicate for this instruction. </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00714">InstrTypes.h:714</a></div></div>
<div class="ttc" id="GlobalStatus_8h_html"><div class="ttname"><a href="GlobalStatus_8h.html">GlobalStatus.h</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantStruct_html_a54fcfa620deb80373f489ba2fdad7643"><div class="ttname"><a href="classllvm_1_1ConstantStruct.html#a54fcfa620deb80373f489ba2fdad7643">llvm::ConstantStruct::get</a></div><div class="ttdeci">static Constant * get(StructType *T, ArrayRef&lt; Constant * &gt; V)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00874">Constants.cpp:874</a></div></div>
<div class="ttc" id="structllvm_1_1GlobalStatus_html_ae58ea7b3b03443e976cbef09ac25cf00"><div class="ttname"><a href="structllvm_1_1GlobalStatus.html#ae58ea7b3b03443e976cbef09ac25cf00">llvm::GlobalStatus::analyzeGlobal</a></div><div class="ttdeci">static bool analyzeGlobal(const Value *V, GlobalStatus &amp;GS)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalStatus_8cpp_source.html#l00174">GlobalStatus.cpp:174</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html_a01fee21e2c679094ce5ab193369d5198"><div class="ttname"><a href="classllvm_1_1Constant.html#a01fee21e2c679094ce5ab193369d5198">llvm::Constant::getAggregateElement</a></div><div class="ttdeci">Constant * getAggregateElement(unsigned Elt) const </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00183">Constants.cpp:183</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSetImpl_html_a095445850ef2c64e96b4c05120cecf66"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#a095445850ef2c64e96b4c05120cecf66">llvm::SmallPtrSetImpl::empty</a></div><div class="ttdeci">bool LLVM_ATTRIBUTE_UNUSED_RESULT empty() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00074">SmallPtrSet.h:74</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a6407ecfeeaabe2cb5df433a895498b58"><div class="ttname"><a href="GlobalOpt_8cpp.html#a6407ecfeeaabe2cb5df433a895498b58">IsUserOfGlobalSafeForSRA</a></div><div class="ttdeci">static bool IsUserOfGlobalSafeForSRA(User *U, GlobalValue *GV)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00388">GlobalOpt.cpp:388</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalVariable_html_a40ae67d31da67ca17ed016839faf3390"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html#a40ae67d31da67ca17ed016839faf3390">llvm::GlobalVariable::setConstant</a></div><div class="ttdeci">void setConstant(bool Val)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalVariable_8h_source.html#l00156">GlobalVariable.h:156</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a31232d0640fc51e777d8e48e48f45c89"><div class="ttname"><a href="GlobalOpt_8cpp.html#a31232d0640fc51e777d8e48e48f45c89">hasMoreThanOneUseOtherThanLLVMUsed</a></div><div class="ttdeci">static bool hasMoreThanOneUseOtherThanLLVMUsed(GlobalValue &amp;V, const LLVMUsed &amp;U)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l02933">GlobalOpt.cpp:2933</a></div></div>
<div class="ttc" id="DenseMap_8h_html"><div class="ttname"><a href="DenseMap_8h.html">DenseMap.h</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalVariable_html"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html">llvm::GlobalVariable</a></div><div class="ttdef"><b>Definition:</b> <a href="GlobalVariable_8h_source.html#l00035">GlobalVariable.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a2eba483f5cc876e824aa6c085736086b"><div class="ttname"><a href="classllvm_1_1Type.html#a2eba483f5cc876e824aa6c085736086b">llvm::Type::isPointerTy</a></div><div class="ttdeci">bool isPointerTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00220">Type.h:220</a></div></div>
<div class="ttc" id="classllvm_1_1UndefValue_html_a4ae5ff22b700a42bcc5d889233721335"><div class="ttname"><a href="classllvm_1_1UndefValue.html#a4ae5ff22b700a42bcc5d889233721335">llvm::UndefValue::get</a></div><div class="ttdeci">static UndefValue * get(Type *T)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01334">Constants.cpp:1334</a></div></div>
<div class="ttc" id="namespacellvm_html_a6b369f94d5ebc6e107a988f17b42b3eb"><div class="ttname"><a href="namespacellvm.html#a6b369f94d5ebc6e107a988f17b42b3eb">llvm::isSafeToDestroyConstant</a></div><div class="ttdeci">bool isSafeToDestroyConstant(const Constant *C)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalStatus_8cpp_source.html#l00034">GlobalStatus.cpp:34</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_af85a4828b6b5a8de7fc0a55cc0e5b52f"><div class="ttname"><a href="classllvm_1_1Value.html#af85a4828b6b5a8de7fc0a55cc0e5b52f">llvm::Value::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdoc">All values hold a context through their type. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00517">Value.cpp:517</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a7fe9ccd4893f4e2caa826126c09545ea"><div class="ttname"><a href="classllvm_1_1Type.html#a7fe9ccd4893f4e2caa826126c09545ea">llvm::Type::getInt8PtrTy</a></div><div class="ttdeci">static PointerType * getInt8PtrTy(LLVMContext &amp;C, unsigned AS=0)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00284">Type.cpp:284</a></div></div>
<div class="ttc" id="classllvm_1_1iplist_html"><div class="ttname"><a href="classllvm_1_1iplist.html">llvm::iplist&lt; GlobalVariable &gt;</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalVariable_html_a22e076c4cf000eba885dd00048641c6f"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html#a22e076c4cf000eba885dd00048641c6f">llvm::GlobalVariable::removeFromParent</a></div><div class="ttdeci">virtual void removeFromParent()</div><div class="ttdef"><b>Definition:</b> <a href="Globals_8cpp_source.html#l00138">Globals.cpp:138</a></div></div>
<div class="ttc" id="classllvm_1_1iplist_html_a5c2aa38108db7a66ac5e8da547f64ad7"><div class="ttname"><a href="classllvm_1_1iplist.html#a5c2aa38108db7a66ac5e8da547f64ad7">llvm::iplist::erase</a></div><div class="ttdeci">iterator erase(iterator where)</div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00465">ilist.h:465</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05a720a42e85f7e981afd61e28473b0000a"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a720a42e85f7e981afd61e28473b0000a">llvm::CmpInst::ICMP_SGT</a></div><div class="ttdoc">signed greater than </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00678">InstrTypes.h:678</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html_a19b72cdd81bd792545e25466b43ac7c2"><div class="ttname"><a href="classllvm_1_1Module.html#a19b72cdd81bd792545e25466b43ac7c2">llvm::Module::global_end</a></div><div class="ttdeci">global_iterator global_end()</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00523">Module.h:523</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_ac38a6c2bc68401a0464fc5f818ffc3a2"><div class="ttname"><a href="GlobalOpt_8cpp.html#ac38a6c2bc68401a0464fc5f818ffc3a2">hasUsesToReplace</a></div><div class="ttdeci">static bool hasUsesToReplace(GlobalAlias &amp;GA, LLVMUsed &amp;U, bool &amp;RenameTarget)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l02951">GlobalOpt.cpp:2951</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSetIterator_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSetIterator.html">llvm::SmallPtrSetIterator</a></div><div class="ttdoc">SmallPtrSetIterator - This implements a const_iterator for SmallPtrSet. </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00174">SmallPtrSet.h:174</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a5e9e1c0dd93557be1b4ad72860f3cbdaa2989d3024a84b4dda9d77419b1648554"><div class="ttname"><a href="classllvm_1_1Type.html#a5e9e1c0dd93557be1b4ad72860f3cbdaa2989d3024a84b4dda9d77419b1648554">llvm::Type::ArrayTyID</a></div><div class="ttdoc">13: Arrays </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00071">Type.h:71</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_ae84bb2408dfffa4e8b5fe2ce0714a3bd"><div class="ttname"><a href="classllvm_1_1DataLayout.html#ae84bb2408dfffa4e8b5fe2ce0714a3bd">llvm::DataLayout::getIntPtrType</a></div><div class="ttdeci">IntegerType * getIntPtrType(LLVMContext &amp;C, unsigned AddressSpace=0) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8cpp_source.html#l00610">DataLayout.cpp:610</a></div></div>
<div class="ttc" id="classllvm_1_1SequentialType_html"><div class="ttname"><a href="classllvm_1_1SequentialType.html">llvm::SequentialType</a></div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00306">DerivedTypes.h:306</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSetImpl_html_aa72472422d95c7052d62432ec279ff85"><div class="ttname"><a href="classllvm_1_1SmallPtrSetImpl.html#aa72472422d95c7052d62432ec279ff85">llvm::SmallPtrSetImpl::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00077">SmallPtrSet.h:77</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_abb381519d34dcb9ccf673bf7689d0721"><div class="ttname"><a href="classllvm_1_1DataLayout.html#abb381519d34dcb9ccf673bf7689d0721">llvm::DataLayout::getABITypeAlignment</a></div><div class="ttdeci">unsigned getABITypeAlignment(Type *Ty) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8cpp_source.html#l00582">DataLayout.cpp:582</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_a0f606d92ce05aaf49a893d7a1f55da68"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a0f606d92ce05aaf49a893d7a1f55da68">llvm::GlobalValue::hasExternalLinkage</a></div><div class="ttdeci">bool hasExternalLinkage() const </div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00194">GlobalValue.h:194</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html"><div class="ttname"><a href="classllvm_1_1GlobalValue.html">llvm::GlobalValue</a></div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00029">GlobalValue.h:29</a></div></div>
<div class="ttc" id="classllvm_1_1IntegerType_html_a14f7b4f1aed38192fb6b7772eb506bdb"><div class="ttname"><a href="classllvm_1_1IntegerType.html#a14f7b4f1aed38192fb6b7772eb506bdb">llvm::IntegerType::get</a></div><div class="ttdeci">static IntegerType * get(LLVMContext &amp;C, unsigned NumBits)</div><div class="ttdoc">Get or create an IntegerType instance. </div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00305">Type.cpp:305</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_aba93ec4079f8d709a1d5b4745310782e"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#aba93ec4079f8d709a1d5b4745310782e">llvm::ConstantExpr::getBitCast</a></div><div class="ttdeci">static Constant * getBitCast(Constant *C, Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01672">Constants.cpp:1672</a></div></div>
<div class="ttc" id="classllvm_1_1MemIntrinsic_html"><div class="ttname"><a href="classllvm_1_1MemIntrinsic.html">llvm::MemIntrinsic</a></div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00118">IntrinsicInst.h:118</a></div></div>
<div class="ttc" id="classllvm_1_1ilist__iterator_html"><div class="ttname"><a href="classllvm_1_1ilist__iterator.html">llvm::ilist_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="ilist_8h_source.html#l00050">ilist.h:50</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a23fd01d07baea6623f8b2019dd8f2f21"><div class="ttname"><a href="GlobalOpt_8cpp.html#a23fd01d07baea6623f8b2019dd8f2f21">Optimizer</a></div><div class="ttdeci">Global Variable Optimizer</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00096">GlobalOpt.cpp:96</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html">llvm::SmallPtrSet</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00236">SmallPtrSet.h:236</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a2ce650c1d4a48661b501206d04b6ab04"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a2ce650c1d4a48661b501206d04b6ab04">llvm::SmallPtrSet::erase</a></div><div class="ttdeci">bool erase(PtrType Ptr)</div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00259">SmallPtrSet.h:259</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a4c9b89709068175aa041524ee4bdc61f"><div class="ttname"><a href="GlobalOpt_8cpp.html#a4c9b89709068175aa041524ee4bdc61f">CleanupConstantGlobalUsers</a></div><div class="ttdeci">static bool CleanupConstantGlobalUsers(Value *V, Constant *Init, DataLayout *TD, TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00268">GlobalOpt.cpp:268</a></div></div>
<div class="ttc" id="classllvm_1_1PointerType_html_a8db49fd5069f21d514e7bb0fd11f0902"><div class="ttname"><a href="classllvm_1_1PointerType.html#a8db49fd5069f21d514e7bb0fd11f0902">llvm::PointerType::getUnqual</a></div><div class="ttdeci">static PointerType * getUnqual(Type *ElementType)</div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00436">DerivedTypes.h:436</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html"><div class="ttname"><a href="classllvm_1_1ConstantInt.html">llvm::ConstantInt</a></div><div class="ttdoc">Class for constant integers. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00051">Constants.h:51</a></div></div>
<div class="ttc" id="namespacellvm_html_abf74b2f0dbae96f4708d3e407b36df02ad1fbbfdf093cdd213b0df02550ac94d0"><div class="ttname"><a href="namespacellvm.html#abf74b2f0dbae96f4708d3e407b36df02ad1fbbfdf093cdd213b0df02550ac94d0">llvm::NotAtomic</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00037">Instructions.h:37</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a261cccda692dd81df2689f3d494ad4d9"><div class="ttname"><a href="GlobalOpt_8cpp.html#a261cccda692dd81df2689f3d494ad4d9">CommitValueTo</a></div><div class="ttdeci">static void CommitValueTo(Constant *Val, Constant *Addr)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l02251">GlobalOpt.cpp:2251</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_aba6a4cc4ed6d6fef3664b8d65ef04820"><div class="ttname"><a href="classllvm_1_1PHINode.html#aba6a4cc4ed6d6fef3664b8d65ef04820">llvm::PHINode::getIncomingValue</a></div><div class="ttdeci">Value * getIncomingValue(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02059">Instructions.h:2059</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a5e9e1c0dd93557be1b4ad72860f3cbdaa1f19f6d0e474b9dce2d0574e12baec29"><div class="ttname"><a href="classllvm_1_1Type.html#a5e9e1c0dd93557be1b4ad72860f3cbdaa1f19f6d0e474b9dce2d0574e12baec29">llvm::Type::VectorTyID</a></div><div class="ttdoc">15: SIMD &amp;#39;packed&amp;#39; format, or other vector type </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00073">Type.h:73</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_a1d6fcc02e91ba24510aba42660c90e29"><div class="ttname"><a href="classllvm_1_1DataLayout.html#a1d6fcc02e91ba24510aba42660c90e29">llvm::DataLayout::getTypeAllocSize</a></div><div class="ttdeci">uint64_t getTypeAllocSize(Type *Ty) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00326">DataLayout.h:326</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_ad8f27f0b94a56abcd296b8461737a3af"><div class="ttname"><a href="classllvm_1_1Type.html#ad8f27f0b94a56abcd296b8461737a3af">llvm::Type::getVectorNumElements</a></div><div class="ttdeci">unsigned getVectorNumElements() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00214">Type.cpp:214</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantStruct_html"><div class="ttname"><a href="classllvm_1_1ConstantStruct.html">llvm::ConstantStruct</a></div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00378">Constants.h:378</a></div></div>
<div class="ttc" id="Target_2README_8txt_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="Target_2README_8txt.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="Target_2README_8txt_source.html#l00029">Target/README.txt:29</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a0b4e7bee9b8575cc7db73329f1a561bd"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a0b4e7bee9b8575cc7db73329f1a561bd">llvm::BasicBlock::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00195">BasicBlock.h:195</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_ad7523221c38891e563047ab7fc044312"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#ad7523221c38891e563047ab7fc044312">llvm::GlobalValue::setAlignment</a></div><div class="ttdeci">void setAlignment(unsigned Align)</div><div class="ttdef"><b>Definition:</b> <a href="Globals_8cpp_source.html#l00058">Globals.cpp:58</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVector_html"><div class="ttname"><a href="classllvm_1_1SmallVector.html">llvm::SmallVector</a></div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00880">SmallVector.h:880</a></div></div>
<div class="ttc" id="Module_8h_html"><div class="ttname"><a href="Module_8h.html">Module.h</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a0cf3748dba54f931bb1241ae4adc76bc"><div class="ttname"><a href="classllvm_1_1Value.html#a0cf3748dba54f931bb1241ae4adc76bc">llvm::Value::getType</a></div><div class="ttdeci">Type * getType() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00111">Value.h:111</a></div></div>
<div class="ttc" id="classllvm_1_1TargetLibraryInfo_html"><div class="ttname"><a href="classllvm_1_1TargetLibraryInfo.html">llvm::TargetLibraryInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8h_source.html#l00657">TargetLibraryInfo.h:657</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_a91ebd7b5d66cc73396c43f4c056050d6"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a91ebd7b5d66cc73396c43f4c056050d6">llvm::GlobalValue::setUnnamedAddr</a></div><div class="ttdeci">void setUnnamedAddr(bool Val)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00085">GlobalValue.h:85</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html">llvm::BinaryOperator</a></div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00138">InstrTypes.h:138</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05a15ae464950ac676919c2f0c7aafc706c"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a15ae464950ac676919c2f0c7aafc706c">llvm::CmpInst::ICMP_SLT</a></div><div class="ttdoc">signed less than </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00680">InstrTypes.h:680</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a89e14161646470e3bf6e583ffe2f6bf8"><div class="ttname"><a href="GlobalOpt_8cpp.html#a89e14161646470e3bf6e583ffe2f6bf8">setUsedInitializer</a></div><div class="ttdeci">static void setUsedInitializer(GlobalVariable &amp;V, SmallPtrSet&lt; GlobalValue *, 8 &gt; Init)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l02852">GlobalOpt.cpp:2852</a></div></div>
<div class="ttc" id="classllvm_1_1StructLayout_html_a582a5b21a8f91d7f713fa9d57c0525de"><div class="ttname"><a href="classllvm_1_1StructLayout.html#a582a5b21a8f91d7f713fa9d57c0525de">llvm::StructLayout::getSizeInBytes</a></div><div class="ttdeci">uint64_t getSizeInBytes() const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00425">DataLayout.h:425</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html_a755dbbd47c63c53cda3e93d9d608562a"><div class="ttname"><a href="classllvm_1_1Module.html#a755dbbd47c63c53cda3e93d9d608562a">llvm::Module::alias_begin</a></div><div class="ttdeci">alias_iterator alias_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00542">Module.h:542</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a38ea12c04523d63adda732b9c5d6da0a"><div class="ttname"><a href="classllvm_1_1Value.html#a38ea12c04523d63adda732b9c5d6da0a">llvm::Value::stripPointerCasts</a></div><div class="ttdeci">Value * stripPointerCasts()</div><div class="ttdoc">Strips off any unneeded pointer casts, all-zero GEPs and aliases from the specified value...</div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00385">Value.cpp:385</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a9105541412dab869e18b3cceebfff07d"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a9105541412dab869e18b3cceebfff07d">llvm::ConstantInt::get</a></div><div class="ttdeci">static Constant * get(Type *Ty, uint64_t V, bool isSigned=false)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00492">Constants.cpp:492</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_acc3494615b004b675f8266605bcd0421"><div class="ttname"><a href="GlobalOpt_8cpp.html#acc3494615b004b675f8266605bcd0421">StripNest</a></div><div class="ttdeci">static AttributeSet StripNest(LLVMContext &amp;C, const AttributeSet &amp;Attrs)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l01877">GlobalOpt.cpp:1877</a></div></div>
<div class="ttc" id="classllvm_1_1LoadInst_html_a8c0a29ecc14dc5afe7573bf616da2361"><div class="ttname"><a href="classllvm_1_1LoadInst.html#a8c0a29ecc14dc5afe7573bf616da2361">llvm::LoadInst::getOrdering</a></div><div class="ttdeci">AtomicOrdering getOrdering() const </div><div class="ttdoc">Returns the ordering effect of this fence. </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00188">Instructions.h:188</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_ad4ea4748170f687710a54c919dde5625"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#ad4ea4748170f687710a54c919dde5625">llvm::ConstantInt::isZero</a></div><div class="ttdeci">bool isZero() const </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00160">Constants.h:160</a></div></div>
<div class="ttc" id="classllvm_1_1GetElementPtrInst_html_a1585a1ee545bef997b3120f87fd992a0"><div class="ttname"><a href="classllvm_1_1GetElementPtrInst.html#a1585a1ee545bef997b3120f87fd992a0">llvm::GetElementPtrInst::Create</a></div><div class="ttdeci">static GetElementPtrInst * Create(Value *Ptr, ArrayRef&lt; Value * &gt; IdxList, const Twine &amp;NameStr=&quot;&quot;, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00726">Instructions.h:726</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a30f2c362631e3728d2f47a8203071ade"><div class="ttname"><a href="classllvm_1_1Function.html#a30f2c362631e3728d2f47a8203071ade">llvm::Function::getEntryBlock</a></div><div class="ttdeci">const BasicBlock &amp; getEntryBlock() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00380">Function.h:380</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html_ad7ec8482f19e8e86e3de573b060a17e5"><div class="ttname"><a href="classllvm_1_1Constant.html#ad7ec8482f19e8e86e3de573b060a17e5">llvm::Constant::isNullValue</a></div><div class="ttdeci">bool isNullValue() const </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00075">Constants.cpp:75</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantInt_html_a82dbbd8e3688b0bc1eedb338864d0d0c"><div class="ttname"><a href="classllvm_1_1ConstantInt.html#a82dbbd8e3688b0bc1eedb338864d0d0c">llvm::ConstantInt::getTrue</a></div><div class="ttdeci">static ConstantInt * getTrue(LLVMContext &amp;Context)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00438">Constants.cpp:438</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_a687973de03d041e04b50a76d19d4fd36"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a687973de03d041e04b50a76d19d4fd36">llvm::GlobalValue::setLinkage</a></div><div class="ttdeci">void setLinkage(LinkageTypes LT)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00217">GlobalValue.h:217</a></div></div>
<div class="ttc" id="namespacellvm_html_a7c46c742c31be54870e2038048e6b391"><div class="ttname"><a href="namespacellvm.html#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a></div><div class="ttdeci">raw_ostream &amp; dbgs()</div><div class="ttdoc">dbgs - Return a circular-buffered debug stream. </div><div class="ttdef"><b>Definition:</b> <a href="Debug_8cpp_source.html#l00101">Debug.cpp:101</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html_ac8ddb745480a7e75a3862ddf0be3a298"><div class="ttname"><a href="classllvm_1_1Constant.html#ac8ddb745480a7e75a3862ddf0be3a298">llvm::Constant::isAllOnesValue</a></div><div class="ttdeci">bool isAllOnesValue() const </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00088">Constants.cpp:88</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a72873ed64b7be01507a2248b8e756ec8"><div class="ttname"><a href="classllvm_1_1Function.html#a72873ed64b7be01507a2248b8e756ec8">llvm::Function::getAttributes</a></div><div class="ttdeci">AttributeSet getAttributes() const </div><div class="ttdoc">Return the attribute list for this Function. </div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00170">Function.h:170</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_a150b33ecedbc8c7803c2db8040fbe3f8"><div class="ttname"><a href="classllvm_1_1CallInst.html#a150b33ecedbc8c7803c2db8040fbe3f8">llvm::CallInst::getArgOperand</a></div><div class="ttdeci">Value * getArgOperand(unsigned i) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l01245">Instructions.h:1245</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05a2751d6136a2819749dcef65dc19a4246"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a2751d6136a2819749dcef65dc19a4246">llvm::CmpInst::ICMP_SLE</a></div><div class="ttdoc">signed less or equal </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00681">InstrTypes.h:681</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_ad011637daf373ae9f4cbb34d7eaa0955"><div class="ttname"><a href="GlobalOpt_8cpp.html#ad011637daf373ae9f4cbb34d7eaa0955">isSimpleEnoughValueToCommit</a></div><div class="ttdeci">static bool isSimpleEnoughValueToCommit(Constant *C, SmallPtrSet&lt; Constant *, 8 &gt; &amp;SimpleConstants, const DataLayout *TD)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l02138">GlobalOpt.cpp:2138</a></div></div>
<div class="ttc" id="classllvm_1_1VectorType_html"><div class="ttname"><a href="classllvm_1_1VectorType.html">llvm::VectorType</a></div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00358">DerivedTypes.h:358</a></div></div>
<div class="ttc" id="ModuleUtils_8h_html"><div class="ttname"><a href="ModuleUtils_8h.html">ModuleUtils.h</a></div></div>
<div class="ttc" id="classllvm_1_1Target_html"><div class="ttname"><a href="classllvm_1_1Target.html">llvm::Target</a></div><div class="ttdef"><b>Definition:</b> <a href="TargetRegistry_8h_source.html#l00078">TargetRegistry.h:78</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantArray_html"><div class="ttname"><a href="classllvm_1_1ConstantArray.html">llvm::ConstantArray</a></div><div class="ttdef"><b>Definition:</b> <a href="Constants_8h_source.html#l00340">Constants.h:340</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalVariable_html_a0d94a4e78681b58ae3b2dbbd0627a847"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html#a0d94a4e78681b58ae3b2dbbd0627a847">llvm::GlobalVariable::hasInitializer</a></div><div class="ttdeci">bool hasInitializer() const </div><div class="ttdef"><b>Definition:</b> <a href="GlobalVariable_8h_source.html#l00089">GlobalVariable.h:89</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalVariable_html_a1500a3fe55cf38153aa1e0fbe7284e05"><div class="ttname"><a href="classllvm_1_1GlobalVariable.html#a1500a3fe55cf38153aa1e0fbe7284e05">llvm::GlobalVariable::isConstant</a></div><div class="ttdeci">bool isConstant() const </div><div class="ttdef"><b>Definition:</b> <a href="GlobalVariable_8h_source.html#l00155">GlobalVariable.h:155</a></div></div>
<div class="ttc" id="classllvm_1_1PHINode_html_a21960167f529265a1cb02ac1e8ad10f6"><div class="ttname"><a href="classllvm_1_1PHINode.html#a21960167f529265a1cb02ac1e8ad10f6">llvm::PHINode::getIncomingValueForBlock</a></div><div class="ttdeci">Value * getIncomingValueForBlock(const BasicBlock *BB) const </div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02139">Instructions.h:2139</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a6e328feb83afa5cf1c966d6704e43fc1"><div class="ttname"><a href="classllvm_1_1Type.html#a6e328feb83afa5cf1c966d6704e43fc1">llvm::Type::isIntegerTy</a></div><div class="ttdeci">bool isIntegerTy() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00196">Type.h:196</a></div></div>
<div class="ttc" id="namespacellvm_html_adc3d427ae53571c61269b58488af05df"><div class="ttname"><a href="namespacellvm.html#adc3d427ae53571c61269b58488af05df">llvm::getMallocAllocatedType</a></div><div class="ttdeci">Type * getMallocAllocatedType(const CallInst *CI, const TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="MemoryBuiltins_8cpp_source.html#l00288">MemoryBuiltins.cpp:288</a></div></div>
<div class="ttc" id="Pass_8h_html"><div class="ttname"><a href="Pass_8h.html">Pass.h</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a5ac211f24970dea81fa9a7118a8ce36b"><div class="ttname"><a href="classllvm_1_1Instruction.html#a5ac211f24970dea81fa9a7118a8ce36b">llvm::Instruction::use_back</a></div><div class="ttdeci">Instruction * use_back()</div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00049">Instruction.h:49</a></div></div>
<div class="ttc" id="classllvm_1_1DenseMapBase_html_a432d7e955f44b118b4261eae03d7a8af"><div class="ttname"><a href="classllvm_1_1DenseMapBase.html#a432d7e955f44b118b4261eae03d7a8af">llvm::DenseMapBase&lt; DenseMap&lt; KeyT, ValueT, KeyInfoT &gt;, KeyT, ValueT, KeyInfoT &gt;::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00053">DenseMap.h:53</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a6a782b47efe4d6ad9a7a36b6525d9203"><div class="ttname"><a href="classllvm_1_1Function.html#a6a782b47efe4d6ad9a7a36b6525d9203">llvm::Function::empty</a></div><div class="ttdeci">bool empty() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00401">Function.h:401</a></div></div>
<div class="ttc" id="classllvm_1_1value__use__iterator_html_a94ea49d6aa255c31746f4f2b8cbf4443"><div class="ttname"><a href="classllvm_1_1value__use__iterator.html#a94ea49d6aa255c31746f4f2b8cbf4443">llvm::value_use_iterator::getUse</a></div><div class="ttdeci">Use &amp; getUse() const </div><div class="ttdef"><b>Definition:</b> <a href="Use_8h_source.html#l00210">Use.h:210</a></div></div>
<div class="ttc" id="namespacellvm_html_ab2a615783bce35374d64da662869ac3d"><div class="ttname"><a href="namespacellvm.html#ab2a615783bce35374d64da662869ac3d">llvm::getMallocArraySize</a></div><div class="ttdeci">Value * getMallocArraySize(CallInst *CI, const DataLayout *DL, const TargetLibraryInfo *TLI, bool LookThroughSExt=false)</div><div class="ttdef"><b>Definition:</b> <a href="MemoryBuiltins_8cpp_source.html#l00299">MemoryBuiltins.cpp:299</a></div></div>
<div class="ttc" id="ConstantFolding_8h_html"><div class="ttname"><a href="ConstantFolding_8h.html">ConstantFolding.h</a></div></div>
<div class="ttc" id="classllvm_1_1CallSiteBase_html_ae767a25d53d50cf3995a4e0db25c09fa"><div class="ttname"><a href="classllvm_1_1CallSiteBase.html#ae767a25d53d50cf3995a4e0db25c09fa">llvm::CallSiteBase::setCallingConv</a></div><div class="ttdeci">void setCallingConv(CallingConv::ID CC)</div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00173">CallSite.h:173</a></div></div>
<div class="ttc" id="classllvm_1_1SmallVectorTemplateCommon_html_a8a045d250952c0867382a9840ee18fdf"><div class="ttname"><a href="classllvm_1_1SmallVectorTemplateCommon.html#a8a045d250952c0867382a9840ee18fdf">llvm::SmallVectorTemplateCommon&lt; T &gt;::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="SmallVector_8h_source.html#l00112">SmallVector.h:112</a></div></div>
<div class="ttc" id="ValueHandle_8h_html"><div class="ttname"><a href="ValueHandle_8h.html">ValueHandle.h</a></div></div>
<div class="ttc" id="classllvm_1_1generic__gep__type__iterator_html_a8ca2ac53bb7661363b852abc99971d74"><div class="ttname"><a href="classllvm_1_1generic__gep__type__iterator.html#a8ca2ac53bb7661363b852abc99971d74">llvm::generic_gep_type_iterator::getOperand</a></div><div class="ttdeci">Value * getOperand() const </div><div class="ttdef"><b>Definition:</b> <a href="GetElementPtrTypeIterator_8h_source.html#l00066">GetElementPtrTypeIterator.h:66</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a413abcab8dbc3900fc2fde96a5d8fca6"><div class="ttname"><a href="classllvm_1_1Value.html#a413abcab8dbc3900fc2fde96a5d8fca6">llvm::Value::use_begin</a></div><div class="ttdeci">use_iterator use_begin()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00150">Value.h:150</a></div></div>
<div class="ttc" id="GetElementPtrTypeIterator_8h_html"><div class="ttname"><a href="GetElementPtrTypeIterator_8h.html">GetElementPtrTypeIterator.h</a></div></div>
<div class="ttc" id="namespacellvm_html_af36d7e69ab16b64b2e3a48c83aa9f0f6"><div class="ttname"><a href="namespacellvm.html#af36d7e69ab16b64b2e3a48c83aa9f0f6">llvm::MinAlign</a></div><div class="ttdeci">uint64_t MinAlign(uint64_t A, uint64_t B)</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00535">MathExtras.h:535</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_ab190ff057361c31a374b5feefc10f586"><div class="ttname"><a href="GlobalOpt_8cpp.html#ab190ff057361c31a374b5feefc10f586">AllGlobalLoadUsesSimpleEnoughForHeapSRA</a></div><div class="ttdeci">static bool AllGlobalLoadUsesSimpleEnoughForHeapSRA(const GlobalVariable *GV, Instruction *StoredVal)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l01107">GlobalOpt.cpp:1107</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_ad60ec7475b0ffe7fc1f68a8019780643"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#ad60ec7475b0ffe7fc1f68a8019780643">llvm::GlobalValue::getType</a></div><div class="ttdeci">PointerType * getType() const </div><div class="ttdoc">getType - Global values are always pointers. </div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00107">GlobalValue.h:107</a></div></div>
<div class="ttc" id="classllvm_1_1MemTransferInst_html"><div class="ttname"><a href="classllvm_1_1MemTransferInst.html">llvm::MemTransferInst</a></div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00213">IntrinsicInst.h:213</a></div></div>
<div class="ttc" id="namespacellvm_1_1RegState_html_a079b254e749130fbe5d740f314ca92daa2fee1a7db4e84247a193a9af1f907013"><div class="ttname"><a href="namespacellvm_1_1RegState.html#a079b254e749130fbe5d740f314ca92daa2fee1a7db4e84247a193a9af1f907013">llvm::RegState::Dead</a></div><div class="ttdef"><b>Definition:</b> <a href="MachineInstrBuilder_8h_source.html#l00034">MachineInstrBuilder.h:34</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a732909ea600e927d4123ba6f844c4035"><div class="ttname"><a href="GlobalOpt_8cpp.html#a732909ea600e927d4123ba6f844c4035">GlobalUsersSafeToSRA</a></div><div class="ttdeci">static bool GlobalUsersSafeToSRA(GlobalValue *GV)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00454">GlobalOpt.cpp:454</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html_aa608a2d900dd6c15c18f4236b6548496"><div class="ttname"><a href="classllvm_1_1Module.html#aa608a2d900dd6c15c18f4236b6548496">llvm::Module::end</a></div><div class="ttdeci">iterator end()</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00533">Module.h:533</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_aecfe51ab31f2b93f6248121cb14de054"><div class="ttname"><a href="GlobalOpt_8cpp.html#aecfe51ab31f2b93f6248121cb14de054">SRAGlobal</a></div><div class="ttdeci">static GlobalVariable * SRAGlobal(GlobalVariable *GV, const DataLayout &amp;TD)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00469">GlobalOpt.cpp:469</a></div></div>
<div class="ttc" id="classllvm_1_1TargetLibraryInfo_html_a0fe1c6579053c75b2089f8c2e60c65e0"><div class="ttname"><a href="classllvm_1_1TargetLibraryInfo.html#a0fe1c6579053c75b2089f8c2e60c65e0">llvm::TargetLibraryInfo::getName</a></div><div class="ttdeci">StringRef getName(LibFunc::Func F) const </div><div class="ttdef"><b>Definition:</b> <a href="TargetLibraryInfo_8h_source.html#l00722">TargetLibraryInfo.h:722</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a73349916f7e54a6b988a3646c7a02e90a39197eb94db0d5d99219a826fef11477"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90a39197eb94db0d5d99219a826fef11477">llvm::Intrinsic::invariant_start</a></div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l01253">Intrinsics.h:1253</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a30dd396c5b40cd86c1591872e574ccdf"><div class="ttname"><a href="classllvm_1_1Type.html#a30dd396c5b40cd86c1591872e574ccdf">llvm::Type::getInt32Ty</a></div><div class="ttdeci">static IntegerType * getInt32Ty(LLVMContext &amp;C)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00241">Type.cpp:241</a></div></div>
<div class="ttc" id="structllvm_1_1GlobalStatus_html_a793ea7e324427fc88ccdf62294b63fad"><div class="ttname"><a href="structllvm_1_1GlobalStatus.html#a793ea7e324427fc88ccdf62294b63fad">llvm::GlobalStatus::IsCompared</a></div><div class="ttdeci">bool IsCompared</div><div class="ttdoc">True if the global&amp;#39;s address is used in a comparison. </div><div class="ttdef"><b>Definition:</b> <a href="GlobalStatus_8h_source.html#l00030">GlobalStatus.h:30</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_a4640d98233102674ddb6d6efaf2b7f97"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a4640d98233102674ddb6d6efaf2b7f97">llvm::GlobalValue::isDeclaration</a></div><div class="ttdeci">bool isDeclaration() const </div><div class="ttdef"><b>Definition:</b> <a href="Globals_8cpp_source.html#l00066">Globals.cpp:66</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a5abddaa1ca2270d02c0344679d425538"><div class="ttname"><a href="GlobalOpt_8cpp.html#a5abddaa1ca2270d02c0344679d425538">LoadUsesSimpleEnoughForHeapSRA</a></div><div class="ttdeci">static bool LoadUsesSimpleEnoughForHeapSRA(const Value *V, SmallPtrSet&lt; const PHINode *, 32 &gt; &amp;LoadUsingPHIs, SmallPtrSet&lt; const PHINode *, 32 &gt; &amp;LoadUsingPHIsPerLoad)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l01054">GlobalOpt.cpp:1054</a></div></div>
<div class="ttc" id="classllvm_1_1AttributeSet_html_a56a819e7d3cff2d80c8336ae93abec1b"><div class="ttname"><a href="classllvm_1_1AttributeSet.html#a56a819e7d3cff2d80c8336ae93abec1b">llvm::AttributeSet::hasAttrSomewhere</a></div><div class="ttdeci">bool hasAttrSomewhere(Attribute::AttrKind Attr) const </div><div class="ttdoc">Return true if the specified attribute is set for at least one parameter or for the return value...</div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8cpp_source.html#l00835">Attributes.cpp:835</a></div></div>
<div class="ttc" id="classllvm_1_1AttributeSet_html_a564314dce5264ab0cfe6ae3d9f3f9c12"><div class="ttname"><a href="classllvm_1_1AttributeSet.html#a564314dce5264ab0cfe6ae3d9f3f9c12">llvm::AttributeSet::getSlotIndex</a></div><div class="ttdeci">unsigned getSlotIndex(unsigned Slot) const </div><div class="ttdoc">Return the index for the given slot. </div><div class="ttdef"><b>Definition:</b> <a href="Attributes_8cpp_source.html#l00910">Attributes.cpp:910</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ad9a329f9f85bc896a726a628aa3f4e9d"><div class="ttname"><a href="classllvm_1_1Value.html#ad9a329f9f85bc896a726a628aa3f4e9d">llvm::Value::use_back</a></div><div class="ttdeci">User * use_back()</div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00154">Value.h:154</a></div></div>
<div class="ttc" id="structllvm_1_1GlobalStatus_html_a1b1ce5881588fec97dfaaf3845b04640"><div class="ttname"><a href="structllvm_1_1GlobalStatus.html#a1b1ce5881588fec97dfaaf3845b04640">llvm::GlobalStatus::Ordering</a></div><div class="ttdeci">AtomicOrdering Ordering</div><div class="ttdoc">Set to the strongest atomic ordering requirement. </div><div class="ttdef"><b>Definition:</b> <a href="GlobalStatus_8h_source.html#l00071">GlobalStatus.h:71</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05a573bcd571c938fce863525330bbfc4b8"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a573bcd571c938fce863525330bbfc4b8">llvm::CmpInst::ICMP_UGE</a></div><div class="ttdoc">unsigned greater or equal </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00675">InstrTypes.h:675</a></div></div>
<div class="ttc" id="classllvm_1_1CallSiteBase_html_a197c8829ed18e514133a98f8e9d8a574"><div class="ttname"><a href="classllvm_1_1CallSiteBase.html#a197c8829ed18e514133a98f8e9d8a574">llvm::CallSiteBase::setAttributes</a></div><div class="ttdeci">void setAttributes(const AttributeSet &amp;PAL)</div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00182">CallSite.h:182</a></div></div>
<div class="ttc" id="MD5_8cpp_html_ac0eafdc9ee161b71e7af98af736952fd"><div class="ttname"><a href="MD5_8cpp.html#ac0eafdc9ee161b71e7af98af736952fd">I</a></div><div class="ttdeci">#define I(x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="MD5_8cpp_source.html#l00054">MD5.cpp:54</a></div></div>
<div class="ttc" id="regcomp_8c_html_a0240ac851181b84ac374872dc5434ee4"><div class="ttname"><a href="regcomp_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a></div><div class="ttdeci">#define N</div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a5cb76a65b6524dba1493dd2b9dc3abbe"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a5cb76a65b6524dba1493dd2b9dc3abbe">llvm::BasicBlock::getTerminator</a></div><div class="ttdeci">TerminatorInst * getTerminator()</div><div class="ttdoc">Returns the terminator instruction if the block is well formed or null if the block is not well forme...</div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00120">BasicBlock.cpp:120</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_adf66d58e85fb4e46e9c1ae55186a6930"><div class="ttname"><a href="classllvm_1_1Function.html#adf66d58e85fb4e46e9c1ae55186a6930">llvm::Function::getFunctionType</a></div><div class="ttdeci">FunctionType * getFunctionType() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00171">Function.cpp:171</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a085b82f074c28030fb8e194377ed2d0c"><div class="ttname"><a href="classllvm_1_1Value.html#a085b82f074c28030fb8e194377ed2d0c">llvm::Value::hasOneUse</a></div><div class="ttdeci">bool hasOneUse() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00161">Value.h:161</a></div></div>
<div class="ttc" id="classllvm_1_1ModulePass_html"><div class="ttname"><a href="classllvm_1_1ModulePass.html">llvm::ModulePass</a></div><div class="ttdef"><b>Definition:</b> <a href="Pass_8h_source.html#l00235">Pass.h:235</a></div></div>
<div class="ttc" id="classllvm_1_1Module_html_a279174d137c1ef32aa5b627f5e06620f"><div class="ttname"><a href="classllvm_1_1Module.html#a279174d137c1ef32aa5b627f5e06620f">llvm::Module::begin</a></div><div class="ttdeci">iterator begin()</div><div class="ttdef"><b>Definition:</b> <a href="Module_8h_source.html#l00531">Module.h:531</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a7f055d0b03ebf1d6a5988b178e9b8f4f"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a7f055d0b03ebf1d6a5988b178e9b8f4f">llvm::SmallPtrSet::end</a></div><div class="ttdeci">iterator end() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00279">SmallPtrSet.h:279</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_ae1d53a21892854816885c7288f8b46f1"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#ae1d53a21892854816885c7288f8b46f1">llvm::BasicBlock::Create</a></div><div class="ttdeci">static BasicBlock * Create(LLVMContext &amp;Context, const Twine &amp;Name=&quot;&quot;, Function *Parent=0, BasicBlock *InsertBefore=0)</div><div class="ttdoc">Creates a new BasicBlock. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8h_source.html#l00109">BasicBlock.h:109</a></div></div>
<div class="ttc" id="namespacellvm_html_a26dc52adbcc98fa9f17b055b0025e41f"><div class="ttname"><a href="namespacellvm.html#a26dc52adbcc98fa9f17b055b0025e41f">llvm::Eval</a></div><div class="ttdeci">GraphT::NodeType * Eval(DominatorTreeBase&lt; typename GraphT::NodeType &gt; &amp;DT, typename GraphT::NodeType *VIn, unsigned LastLinked)</div><div class="ttdef"><b>Definition:</b> <a href="DominatorInternals_8h_source.html#l00108">DominatorInternals.h:108</a></div></div>
<div class="ttc" id="MemoryBuiltins_8h_html"><div class="ttname"><a href="MemoryBuiltins_8h.html">MemoryBuiltins.h</a></div></div>
<div class="ttc" id="classllvm_1_1ArrayType_html_adf411edc4f135b570ab218079474ce77"><div class="ttname"><a href="classllvm_1_1ArrayType.html#adf411edc4f135b570ab218079474ce77">llvm::ArrayType::get</a></div><div class="ttdeci">static ArrayType * get(Type *ElementType, uint64_t NumElements)</div><div class="ttdef"><b>Definition:</b> <a href="Type_8cpp_source.html#l00679">Type.cpp:679</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">llvm::GlobalValue::InternalLinkage</a></div><div class="ttdoc">Rename collisions when linking (static functions). </div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00041">GlobalValue.h:41</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2a6c4724226f9ccea96d35fd4c131af8">llvm::A64CC::NV</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00046">AArch64BaseInfo.h:46</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_a8969dec86d24dd579f8ecc963e1dc8b4"><div class="ttname"><a href="classllvm_1_1Function.html#a8969dec86d24dd579f8ecc963e1dc8b4">llvm::Function::eraseFromParent</a></div><div class="ttdeci">virtual void eraseFromParent()</div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00187">Function.cpp:187</a></div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_a19445f836d9e1ecb32cba27ec4338fff"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#a19445f836d9e1ecb32cba27ec4338fff">llvm::BasicBlock::splitBasicBlock</a></div><div class="ttdeci">BasicBlock * splitBasicBlock(iterator I, const Twine &amp;BBName=&quot;&quot;)</div><div class="ttdoc">Split the basic block into two basic blocks at the specified instruction. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00298">BasicBlock.cpp:298</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_a4b979cd93852fd44c48851c94ee00758"><div class="ttname"><a href="classllvm_1_1DataLayout.html#a4b979cd93852fd44c48851c94ee00758">llvm::DataLayout::getTypeStoreSize</a></div><div class="ttdeci">uint64_t getTypeStoreSize(Type *Ty) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00311">DataLayout.h:311</a></div></div>
<div class="ttc" id="classllvm_1_1CallSiteBase_html_affa0f3ae92ab8696fccd107c0addf5a2"><div class="ttname"><a href="classllvm_1_1CallSiteBase.html#affa0f3ae92ab8696fccd107c0addf5a2">llvm::CallSiteBase::arg_begin</a></div><div class="ttdeci">IterTy arg_begin() const </div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00137">CallSite.h:137</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_ad1efd93bf021addd8ac8a48a0c5fa3dd"><div class="ttname"><a href="classllvm_1_1Function.html#ad1efd93bf021addd8ac8a48a0c5fa3dd">llvm::Function::setAttributes</a></div><div class="ttdeci">void setAttributes(AttributeSet attrs)</div><div class="ttdoc">Set the attribute list for this Function. </div><div class="ttdef"><b>Definition:</b> <a href="Function_8h_source.html#l00173">Function.h:173</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_a9ea9a909185ecbf9fc81ab35ebfb11d6"><div class="ttname"><a href="classllvm_1_1Value.html#a9ea9a909185ecbf9fc81ab35ebfb11d6">llvm::Value::hasNUsesOrMore</a></div><div class="ttdeci">bool hasNUsesOrMore(unsigned N) const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8cpp_source.html#l00103">Value.cpp:103</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_abaaf9df519b65d0c6e0f40c8be7e10b9"><div class="ttname"><a href="GlobalOpt_8cpp.html#abaaf9df519b65d0c6e0f40c8be7e10b9">InstallGlobalCtors</a></div><div class="ttdeci">static GlobalVariable * InstallGlobalCtors(GlobalVariable *GCL, const std::vector&lt; Function * &gt; &amp;Ctors)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l02010">GlobalOpt.cpp:2010</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_abefc2d8baa67d6f9e49c95912cfde480"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#abefc2d8baa67d6f9e49c95912cfde480">llvm::GlobalValue::hasLocalLinkage</a></div><div class="ttdeci">bool hasLocalLinkage() const </div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00211">GlobalValue.h:211</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionType_html_ab9b67f93a2231970abb3d95636660ffc"><div class="ttname"><a href="classllvm_1_1FunctionType.html#ab9b67f93a2231970abb3d95636660ffc">llvm::FunctionType::isVarArg</a></div><div class="ttdeci">bool isVarArg() const </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00120">DerivedTypes.h:120</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05aa719225e2de4059f93fd3209e1f48218"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05aa719225e2de4059f93fd3209e1f48218">llvm::CmpInst::ICMP_EQ</a></div><div class="ttdoc">equal </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00672">InstrTypes.h:672</a></div></div>
<div class="ttc" id="classllvm_1_1SwitchInst_html"><div class="ttname"><a href="classllvm_1_1SwitchInst.html">llvm::SwitchInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02449">Instructions.h:2449</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html_ac38c53f76ef532f91f1666c8a87370e9"><div class="ttname"><a href="classllvm_1_1Value.html#ac38c53f76ef532f91f1666c8a87370e9">llvm::Value::use_empty</a></div><div class="ttdeci">bool use_empty() const </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00149">Value.h:149</a></div></div>
<div class="ttc" id="classllvm_1_1Init_html"><div class="ttname"><a href="classllvm_1_1Init.html">llvm::Init</a></div><div class="ttdef"><b>Definition:</b> <a href="Record_8h_source.html#l00415">Record.h:415</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a423016bbd81dcc13bc4855bf1bebca9b"><div class="ttname"><a href="GlobalOpt_8cpp.html#a423016bbd81dcc13bc4855bf1bebca9b">RewriteUsesOfLoadForHeapSRoA</a></div><div class="ttdeci">static void RewriteUsesOfLoadForHeapSRoA(LoadInst *Load, DenseMap&lt; Value *, std::vector&lt; Value * &gt; &gt; &amp;InsertedScalarizedValues, std::vector&lt; std::pair&lt; PHINode *, unsigned &gt; &gt; &amp;PHIsToRewrite)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l01262">GlobalOpt.cpp:1262</a></div></div>
<div class="ttc" id="classllvm_1_1FunctionType_html_a9eda832d6e80bc19b98f22f4ec714e3f"><div class="ttname"><a href="classllvm_1_1FunctionType.html#a9eda832d6e80bc19b98f22f4ec714e3f">llvm::FunctionType::getReturnType</a></div><div class="ttdeci">Type * getReturnType() const </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00121">DerivedTypes.h:121</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a7c6c460a78701817b3c5a6bb5d788272"><div class="ttname"><a href="GlobalOpt_8cpp.html#a7c6c460a78701817b3c5a6bb5d788272">STATISTIC</a></div><div class="ttdeci">STATISTIC(NumMarked,&quot;Number of globals marked constant&quot;)</div></div>
<div class="ttc" id="classllvm_1_1BasicBlock_html_ad652423d9d91271ba153eb86482b2f55"><div class="ttname"><a href="classllvm_1_1BasicBlock.html#ad652423d9d91271ba153eb86482b2f55">llvm::BasicBlock::getContext</a></div><div class="ttdeci">LLVMContext &amp; getContext() const </div><div class="ttdoc">Get the context in which this basic block lives. </div><div class="ttdef"><b>Definition:</b> <a href="BasicBlock_8cpp_source.html#l00033">BasicBlock.cpp:33</a></div></div>
<div class="ttc" id="classllvm_1_1Constant_html_a50d0911852017f2168de329f53d8568d"><div class="ttname"><a href="classllvm_1_1Constant.html#a50d0911852017f2168de329f53d8568d">llvm::Constant::removeDeadConstantUsers</a></div><div class="ttdeci">void removeDeadConstantUsers() const </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l00395">Constants.cpp:395</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a86bc8cc11d43b9268dafa031dd7343dd"><div class="ttname"><a href="GlobalOpt_8cpp.html#a86bc8cc11d43b9268dafa031dd7343dd">OptimizeOnceStoredGlobal</a></div><div class="ttdeci">static bool OptimizeOnceStoredGlobal(GlobalVariable *GV, Value *StoredOnceVal, AtomicOrdering Ordering, Module::global_iterator &amp;GVI, DataLayout *TD, TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l01568">GlobalOpt.cpp:1568</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_a9e1fc23a17e97d2d1732e753ae9251ac"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#a9e1fc23a17e97d2d1732e753ae9251ac">llvm::GlobalValue::getParent</a></div><div class="ttdeci">Module * getParent()</div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00286">GlobalValue.h:286</a></div></div>
<div class="ttc" id="classllvm_1_1Value_html"><div class="ttname"><a href="classllvm_1_1Value.html">llvm::Value</a></div><div class="ttdoc">LLVM Value Representation. </div><div class="ttdef"><b>Definition:</b> <a href="Value_8h_source.html#l00066">Value.h:66</a></div></div>
<div class="ttc" id="classllvm_1_1GlobalValue_html_ac02b37f1016fb8ad589cf26a4e1e0b14"><div class="ttname"><a href="classllvm_1_1GlobalValue.html#ac02b37f1016fb8ad589cf26a4e1e0b14">llvm::GlobalValue::hasUnnamedAddr</a></div><div class="ttdeci">bool hasUnnamedAddr() const </div><div class="ttdef"><b>Definition:</b> <a href="GlobalValue_8h_source.html#l00084">GlobalValue.h:84</a></div></div>
<div class="ttc" id="Target_2X86_2README_8txt_html_ac88fe1d3a61b056a4f64fbbb156a62ff"><div class="ttname"><a href="Target_2X86_2README_8txt.html#ac88fe1d3a61b056a4f64fbbb156a62ff">M</a></div><div class="ttdeci">We currently emits eax Perhaps this is what we really should generate is Is imull three or four cycles eax eax The current instruction priority is based on pattern complexity The former is more complex because it folds a load so the latter will not be emitted Perhaps we should use AddedComplexity to give LEA32r a higher priority We should always try to match LEA first since the LEA matching code does some estimate to determine whether the match is profitable if we care more about code then imull is better It s two bytes shorter than movl leal On a Pentium M</div><div class="ttdef"><b>Definition:</b> <a href="Target_2X86_2README_8txt_source.html#l00297">Target/X86/README.txt:297</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_aef572ae661cf9f5b14651ef952629c10"><div class="ttname"><a href="GlobalOpt_8cpp.html#aef572ae661cf9f5b14651ef952629c10">OptimizeAwayTrappingUsesOfValue</a></div><div class="ttdeci">static bool OptimizeAwayTrappingUsesOfValue(Value *V, Constant *NewV)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00677">GlobalOpt.cpp:677</a></div></div>
<div class="ttc" id="classllvm_1_1SmallPtrSet_html_a669d599eeacffd29a09050e2af83bf67"><div class="ttname"><a href="classllvm_1_1SmallPtrSet.html#a669d599eeacffd29a09050e2af83bf67">llvm::SmallPtrSet::begin</a></div><div class="ttdeci">iterator begin() const </div><div class="ttdef"><b>Definition:</b> <a href="SmallPtrSet_8h_source.html#l00276">SmallPtrSet.h:276</a></div></div>
<div class="ttc" id="SmallVector_8h_html"><div class="ttname"><a href="SmallVector_8h.html">SmallVector.h</a></div></div>
<div class="ttc" id="namespacellvm_1_1CallingConv_html_a4f861731fc6dbfdccc05af5968d98974abc8e2ee40a84687a9e12fd08784b87ba"><div class="ttname"><a href="namespacellvm_1_1CallingConv.html#a4f861731fc6dbfdccc05af5968d98974abc8e2ee40a84687a9e12fd08784b87ba">llvm::CallingConv::Fast</a></div><div class="ttdef"><b>Definition:</b> <a href="CallingConv_8h_source.html#l00039">CallingConv.h:39</a></div></div>
<div class="ttc" id="namespacellvm_1_1A64CC_html_af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442"><div class="ttname"><a href="namespacellvm_1_1A64CC.html#af5804bc0518be9568f73db566e4d6f46a2db5e7546f960277ff98f96cd5624442">llvm::A64CC::MI</a></div><div class="ttdef"><b>Definition:</b> <a href="AArch64BaseInfo_8h_source.html#l00035">AArch64BaseInfo.h:35</a></div></div>
<div class="ttc" id="classllvm_1_1Type_html_a9dc5111b1a9b1d5c4652d50f74fe850b"><div class="ttname"><a href="classllvm_1_1Type.html#a9dc5111b1a9b1d5c4652d50f74fe850b">llvm::Type::isSized</a></div><div class="ttdeci">bool isSized() const </div><div class="ttdef"><b>Definition:</b> <a href="Type_8h_source.html#l00278">Type.h:278</a></div></div>
<div class="ttc" id="classllvm_1_1DataLayout_html_add914112e0b2935dda06ad5dfd3a31db"><div class="ttname"><a href="classllvm_1_1DataLayout.html#add914112e0b2935dda06ad5dfd3a31db">llvm::DataLayout::getTypeSizeInBits</a></div><div class="ttdeci">uint64_t getTypeSizeInBits(Type *Ty) const </div><div class="ttdef"><b>Definition:</b> <a href="DataLayout_8h_source.html#l00459">DataLayout.h:459</a></div></div>
<div class="ttc" id="classllvm_1_1InvokeInst_html"><div class="ttname"><a href="classllvm_1_1InvokeInst.html">llvm::InvokeInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l02841">Instructions.h:2841</a></div></div>
<div class="ttc" id="Debug_8h_html_aef41e8aaf4c60819b30faf396cdf4978"><div class="ttname"><a href="Debug_8h.html#aef41e8aaf4c60819b30faf396cdf4978">DEBUG</a></div><div class="ttdeci">#define DEBUG(X)</div><div class="ttdef"><b>Definition:</b> <a href="Debug_8h_source.html#l00097">Debug.h:97</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_ad509f84445ce77b94e2d70042449202f"><div class="ttname"><a href="GlobalOpt_8cpp.html#ad509f84445ce77b94e2d70042449202f">ValueIsOnlyUsedLocallyOrStoredToOneGlobal</a></div><div class="ttdeci">static bool ValueIsOnlyUsedLocallyOrStoredToOneGlobal(const Instruction *V, const GlobalVariable *GV, SmallPtrSet&lt; const PHINode *, 8 &gt; &amp;PHIs)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00962">GlobalOpt.cpp:962</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05a607cecdc5172814382033e001ed11fad"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05a607cecdc5172814382033e001ed11fad">llvm::CmpInst::ICMP_UGT</a></div><div class="ttdoc">unsigned greater than </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00674">InstrTypes.h:674</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_ac5728c914b7e92030243a21e49ab1552"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#ac5728c914b7e92030243a21e49ab1552">llvm::ConstantExpr::getCompare</a></div><div class="ttdeci">static Constant * getCompare(unsigned short pred, Constant *C1, Constant *C2)</div><div class="ttdoc">Return an ICmp or FCmp comparison operator constant expression. </div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01809">Constants.cpp:1809</a></div></div>
<div class="ttc" id="raw__ostream_8h_html"><div class="ttname"><a href="raw__ostream_8h.html">raw_ostream.h</a></div></div>
<div class="ttc" id="GlobalOpt_8cpp_html_a60254fdb6128ce676768cdc8f7227433"><div class="ttname"><a href="GlobalOpt_8cpp.html#a60254fdb6128ce676768cdc8f7227433">CleanupPointerRootUsers</a></div><div class="ttdeci">static bool CleanupPointerRootUsers(GlobalVariable *GV, const TargetLibraryInfo *TLI)</div><div class="ttdef"><b>Definition:</b> <a href="GlobalOpt_8cpp_source.html#l00181">GlobalOpt.cpp:181</a></div></div>
<div class="ttc" id="namespacellvm_html_ae208097838a5c90d99c76315b5b4a64e"><div class="ttname"><a href="namespacellvm.html#ae208097838a5c90d99c76315b5b4a64e">llvm::collectUsedGlobalVariables</a></div><div class="ttdeci">GlobalVariable * collectUsedGlobalVariables(Module &amp;M, SmallPtrSet&lt; GlobalValue *, 8 &gt; &amp;Set, bool CompilerUsed)</div><div class="ttdoc">Given &quot;llvm.used&quot; or &quot;llvm.compiler.used&quot; as a global name, collect the initializer elements of that ...</div><div class="ttdef"><b>Definition:</b> <a href="ModuleUtils_8cpp_source.html#l00068">ModuleUtils.cpp:68</a></div></div>
<div class="ttc" id="classllvm_1_1CallSite_html"><div class="ttname"><a href="classllvm_1_1CallSite.html">llvm::CallSite</a></div><div class="ttdef"><b>Definition:</b> <a href="CallSite_8h_source.html#l00295">CallSite.h:295</a></div></div>
<div class="ttc" id="classllvm_1_1StructType_html_aa2113dcf8c96c19c9a2abf786b9ad3b7"><div class="ttname"><a href="classllvm_1_1StructType.html#aa2113dcf8c96c19c9a2abf786b9ad3b7">llvm::StructType::getNumElements</a></div><div class="ttdeci">unsigned getNumElements() const </div><div class="ttdoc">Random access to the elements. </div><div class="ttdef"><b>Definition:</b> <a href="DerivedTypes_8h_source.html#l00286">DerivedTypes.h:286</a></div></div>
<div class="ttc" id="classllvm_1_1BinaryOperator_html_a0ad1d1442a12b21931b730201f58ab5e"><div class="ttname"><a href="classllvm_1_1BinaryOperator.html#a0ad1d1442a12b21931b730201f58ab5e">llvm::BinaryOperator::CreateNot</a></div><div class="ttdeci">static BinaryOperator * CreateNot(Value *Op, const Twine &amp;Name=&quot;&quot;, Instruction *InsertBefore=0)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l01904">Instructions.cpp:1904</a></div></div>
<div class="ttc" id="Target_2ARM_2README_8txt_html_a90cca76dd78688687e0d697679dbc799"><div class="ttname"><a href="Target_2ARM_2README_8txt.html#a90cca76dd78688687e0d697679dbc799">B</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional ldr LCPI1_0 ldr ldr tst movne lsr ldr LCPI1_1 and r0 bx lr it saves an instruction and a register It might be profitable to cse MOVi16 if there are lots of bit immediates with the same bottom half Robert Muth started working on an alternate jump table implementation that does not put the tables in line in the text This is more like the llvm default jump table implementation This might be useful sometime Several revisions of patches are on the mailing beginning while CMP sets them like a subtract Therefore to be able to use CMN for comparisons other than the Z we ll need additional logic to reverse the conditionals associated with the comparison Perhaps a pseudo instruction for the with a post codegen pass to clean up and handle the condition codes See PR5694 for testcase Given the following on int B</div><div class="ttdef"><b>Definition:</b> <a href="Target_2ARM_2README_8txt_source.html#l00592">Target/ARM/README.txt:592</a></div></div>
<div class="ttc" id="classllvm_1_1ConstantExpr_html_a1e1ce75d651c76b6869b4218e34618c8"><div class="ttname"><a href="classllvm_1_1ConstantExpr.html#a1e1ce75d651c76b6869b4218e34618c8">llvm::ConstantExpr::getCast</a></div><div class="ttdeci">static Constant * getCast(unsigned ops, Constant *C, Type *Ty)</div><div class="ttdef"><b>Definition:</b> <a href="Constants_8cpp_source.html#l01444">Constants.cpp:1444</a></div></div>
<div class="ttc" id="classllvm_1_1Function_html_ae0466120bfdf5b97b25aa06f3015cd51"><div class="ttname"><a href="classllvm_1_1Function.html#ae0466120bfdf5b97b25aa06f3015cd51">llvm::Function::isVarArg</a></div><div class="ttdeci">bool isVarArg() const </div><div class="ttdef"><b>Definition:</b> <a href="Function_8cpp_source.html#l00175">Function.cpp:175</a></div></div>
<div class="ttc" id="classllvm_1_1Instruction_html_a9cd49851904f15060edb782ef4dd1b2d"><div class="ttname"><a href="classllvm_1_1Instruction.html#a9cd49851904f15060edb782ef4dd1b2d">llvm::Instruction::getParent</a></div><div class="ttdeci">const BasicBlock * getParent() const </div><div class="ttdef"><b>Definition:</b> <a href="Instruction_8h_source.html#l00052">Instruction.h:52</a></div></div>
<div class="ttc" id="classllvm_1_1CallInst_html_a698a8880c71364b5f9bc468a7b0e1fae"><div class="ttname"><a href="classllvm_1_1CallInst.html#a698a8880c71364b5f9bc468a7b0e1fae">llvm::CallInst::CreateMalloc</a></div><div class="ttdeci">static Instruction * CreateMalloc(Instruction *InsertBefore, Type *IntPtrTy, Type *AllocTy, Value *AllocSize, Value *ArraySize=0, Function *MallocF=0, const Twine &amp;Name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8cpp_source.html#l00456">Instructions.cpp:456</a></div></div>
<div class="ttc" id="namespacellvm_1_1Intrinsic_html_a73349916f7e54a6b988a3646c7a02e90ae365354e47542c51f9bd46e329e3323e"><div class="ttname"><a href="namespacellvm_1_1Intrinsic.html#a73349916f7e54a6b988a3646c7a02e90ae365354e47542c51f9bd46e329e3323e">llvm::Intrinsic::lifetime_start</a></div><div class="ttdef"><b>Definition:</b> <a href="Intrinsics_8h_source.html#l01255">Intrinsics.h:1255</a></div></div>
<div class="ttc" id="classllvm_1_1CmpInst_html_a283f9a5d4d843d20c40bb4d3e364bb05ac1aa7b798ba11d2e497d5cce6ce6d3dc"><div class="ttname"><a href="classllvm_1_1CmpInst.html#a283f9a5d4d843d20c40bb4d3e364bb05ac1aa7b798ba11d2e497d5cce6ce6d3dc">llvm::CmpInst::ICMP_SGE</a></div><div class="ttdoc">signed greater or equal </div><div class="ttdef"><b>Definition:</b> <a href="InstrTypes_8h_source.html#l00679">InstrTypes.h:679</a></div></div>
<div class="ttc" id="classllvm_1_1IntrinsicInst_html"><div class="ttname"><a href="classllvm_1_1IntrinsicInst.html">llvm::IntrinsicInst</a></div><div class="ttdef"><b>Definition:</b> <a href="IntrinsicInst_8h_source.html#l00036">IntrinsicInst.h:36</a></div></div>
<div class="ttc" id="classllvm_1_1AllocaInst_html"><div class="ttname"><a href="classllvm_1_1AllocaInst.html">llvm::AllocaInst</a></div><div class="ttdef"><b>Definition:</b> <a href="Instructions_8h_source.html#l00058">Instructions.h:58</a></div></div>
<div class="ttc" id="namespacellvm_html_ac828b9b52935f87659a4adf237f820a3"><div class="ttname"><a href="namespacellvm.html#ac828b9b52935f87659a4adf237f820a3">llvm::gep_type_begin</a></div><div class="ttdeci">gep_type_iterator gep_type_begin(const User *GEP)</div><div class="ttdef"><b>Definition:</b> <a href="GetElementPtrTypeIterator_8h_source.html#l00085">GetElementPtrTypeIterator.h:85</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<p class="footer">
Generated on Sat Nov 10 2018 22:58:43 for <a href="http://llvm.org/">LLVM</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.8.11</a><br>
Copyright &copy; 2003-2013 University of Illinois at Urbana-Champaign.
All Rights Reserved.</p>
<hr>
<!--#include virtual="/attrib.incl" -->
</body>
</html>
